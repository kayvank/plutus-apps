<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-glyph">\</span><span class="hs-identifier">subsection</span><span class="hs-special">{</span><span class="hs-identifier">Cardano.BM.Backend.Prometheus</span><span class="hs-special">}</span><span>
</span><span id="line-3"></span><span class="hs-glyph">\</span><span class="hs-keyword">label</span><span class="hs-special">{</span><span class="hs-keyword">module</span><span class="hs-glyph">:</span><span class="hs-identifier">Cardano.BM.Backend.Prometheus</span><span class="hs-special">}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-operator">%</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">style</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">newcode</span><span>
</span><span id="line-6"></span><span class="hs-glyph">\</span><span class="hs-identifier">begin</span><span class="hs-special">{</span><span class="hs-identifier">code</span><span class="hs-special">}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.BM.Backend.Prometheus</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#spawnPrometheus"><span class="hs-identifier">spawnPrometheus</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../async/html/src"><span class="hs-identifier">Control.Concurrent.Async</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Async</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../unordered-containers/html/src"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Builder</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">find</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">partition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">encodeUtf8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">double</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Snap.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Snap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">route</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">writeLBS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">Snap.Http.Server</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">Config</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">ConfigLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">defaultConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">setAccessLog</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>                     </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">setBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">setErrorLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">setPort</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">simpleHttpServe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier">System.Metrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier">sampleAll</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ekg/html/src"><span class="hs-identifier">System.Remote.Monitoring</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-glyph">\</span><span class="hs-identifier">end</span><span class="hs-special">{</span><span class="hs-identifier">code</span><span class="hs-special">}</span><span>
</span><span id="line-37"></span><span class="hs-operator">%</span><span class="hs-identifier">endif</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-glyph">\</span><span class="hs-identifier">subsubsection</span><span class="hs-special">{</span><span class="hs-identifier">Spawn</span><span> </span><span class="hs-identifier">Prometheus</span><span> </span><span class="hs-identifier">client</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">existing</span><span> </span><span class="hs-identifier">EKG</span><span> </span><span class="hs-identifier">server</span><span class="hs-special">}</span><span>
</span><span id="line-40"></span><span class="hs-glyph">\</span><span class="hs-keyword">label</span><span class="hs-special">{</span><span class="hs-identifier">code</span><span class="hs-glyph">:</span><span class="hs-identifier">spawnPrometheus</span><span class="hs-special">}</span><span class="hs-glyph">\</span><span class="hs-identifier">index</span><span class="hs-special">{</span><span class="hs-identifier">spawnPrometheus</span><span class="hs-special">}</span><span>
</span><span id="line-41"></span><span class="hs-glyph">\</span><span class="hs-identifier">begin</span><span class="hs-special">{</span><span class="hs-identifier">code</span><span class="hs-special">}</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span id="local-6989586621679100388"><span id="local-6989586621679100389"></span></span><span class="hs-keyword">data</span><span> </span><span id="MetricsGroup"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#MetricsGroup"><span class="hs-identifier hs-var">MetricsGroup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MetricsGroup"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#MetricsGroup"><span class="hs-identifier hs-var">MetricsGroup</span></a></span></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="namespace"><span class="annot"><span class="annottext">MetricsGroup -&gt; Text
</span><a href="Cardano.BM.Backend.Prometheus.html#namespace"><span class="hs-identifier hs-var hs-var">namespace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="metrics"><span class="annot"><span class="annottext">MetricsGroup -&gt; [Metric]
</span><a href="Cardano.BM.Backend.Prometheus.html#metrics"><span class="hs-identifier hs-var hs-var">metrics</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-type">Metric</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. MetricsGroup -&gt; Rep MetricsGroup x)
-&gt; (forall x. Rep MetricsGroup x -&gt; MetricsGroup)
-&gt; Generic MetricsGroup
forall x. Rep MetricsGroup x -&gt; MetricsGroup
forall x. MetricsGroup -&gt; Rep MetricsGroup x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep MetricsGroup x -&gt; MetricsGroup
$cfrom :: forall x. MetricsGroup -&gt; Rep MetricsGroup x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679100374"><span id="local-6989586621679100376"><span id="local-6989586621679100378"><span id="local-6989586621679100380"><span class="annot"><span class="annottext">[MetricsGroup] -&gt; Encoding
[MetricsGroup] -&gt; Value
MetricsGroup -&gt; Encoding
MetricsGroup -&gt; Value
(MetricsGroup -&gt; Value)
-&gt; (MetricsGroup -&gt; Encoding)
-&gt; ([MetricsGroup] -&gt; Value)
-&gt; ([MetricsGroup] -&gt; Encoding)
-&gt; ToJSON MetricsGroup
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [MetricsGroup] -&gt; Encoding
$ctoEncodingList :: [MetricsGroup] -&gt; Encoding
toJSONList :: [MetricsGroup] -&gt; Value
$ctoJSONList :: [MetricsGroup] -&gt; Value
toEncoding :: MetricsGroup -&gt; Encoding
$ctoEncoding :: MetricsGroup -&gt; Encoding
toJSON :: MetricsGroup -&gt; Value
$ctoJSON :: MetricsGroup -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">A.ToJSON</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="Metric"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-var">Metric</span></a></span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="NoMetric"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NoMetric"><span class="hs-identifier hs-var">NoMetric</span></a></span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Metric"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-var">Metric</span></a></span></span><span>
</span><span id="line-51"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="mName"><span class="annot"><span class="annottext">Metric -&gt; Text
</span><a href="Cardano.BM.Backend.Prometheus.html#mName"><span class="hs-identifier hs-var hs-var">mName</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-52"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="mType"><span class="annot"><span class="annottext">Metric -&gt; Text
</span><a href="Cardano.BM.Backend.Prometheus.html#mType"><span class="hs-identifier hs-var hs-var">mType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-53"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="mValue"><span class="annot"><span class="annottext">Metric -&gt; Number
</span><a href="Cardano.BM.Backend.Prometheus.html#mValue"><span class="hs-identifier hs-var hs-var">mValue</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span>
</span><span id="line-54"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679100361"><span id="local-6989586621679100363"><span id="local-6989586621679100365"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">A.ToJSON</span></a></span><span> </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-type">Metric</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621679100360"><span class="annot"><span class="annottext">toJSON :: Metric -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="annot"><span class="annottext">Metric
</span><a href="Cardano.BM.Backend.Prometheus.html#NoMetric"><span class="hs-identifier hs-var">NoMetric</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">A.Null</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-type">Metric</span></a></span><span> </span><span id="local-6989586621679100357"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100357"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679100356"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100356"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679100355"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100355"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">A.object</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100357"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100356"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Number -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100355"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">data</span><span> </span><span id="Number"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Number"><span class="hs-identifier hs-var">Number</span></a></span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="NumberInt"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NumberInt"><span class="hs-identifier hs-var">NumberInt</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NumberReal"><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NumberReal"><span class="hs-identifier hs-var">NumberReal</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679100345"><span id="local-6989586621679100347"><span id="local-6989586621679100349"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">A.ToJSON</span></a></span><span> </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#Number"><span class="hs-identifier hs-type">Number</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679100344"><span class="annot"><span class="annottext">toJSON :: Number -&gt; Value
</span><a href="#local-6989586621679100344"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NumberInt"><span class="hs-identifier hs-type">NumberInt</span></a></span><span> </span><span id="local-6989586621679100343"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679100343"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">A.Number</span></a></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Value) -&gt; Scientific -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Scientific
forall a. Num a =&gt; Integer -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679100343"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NumberReal"><span class="hs-identifier hs-type">NumberReal</span></a></span><span> </span><span id="local-6989586621679100341"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679100341"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">A.Number</span></a></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Value) -&gt; Scientific -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Scientific
forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679100341"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#spawnPrometheus"><span class="hs-identifier hs-type">spawnPrometheus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ekg/html/src"><span class="hs-identifier hs-type">EKG.Server</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../async/html/src"><span class="hs-identifier hs-type">Async.Async</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span id="spawnPrometheus"><span class="annot"><span class="annottext">spawnPrometheus :: Server -&gt; ByteString -&gt; Int -&gt; Maybe Text -&gt; IO (Async ())
</span><a href="Cardano.BM.Backend.Prometheus.html#spawnPrometheus"><span class="hs-identifier hs-var hs-var">spawnPrometheus</span></a></span></span><span> </span><span id="local-6989586621679100340"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679100340"><span class="hs-identifier hs-var">ekg</span></a></span></span><span> </span><span id="local-6989586621679100339"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679100339"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span id="local-6989586621679100338"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100338"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span id="local-6989586621679100337"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679100337"><span class="hs-identifier hs-var">prometheusOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO (Async ())
forall a. IO a -&gt; IO (Async a)
</span><a href="../../../../async/html/src"><span class="hs-identifier hs-var">Async.async</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO (Async ())) -&gt; IO () -&gt; IO (Async ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">Config Snap Any -&gt; Snap () -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
Config m a -&gt; Snap () -&gt; IO ()
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">simpleHttpServe</span></a></span><span> </span><span class="annot"><span class="annottext">Config Snap Any
forall a. Config Snap a
</span><a href="#local-6989586621679100335"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Snap ()
</span><a href="#local-6989586621679100334"><span class="hs-identifier hs-var">site</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679100456"><span class="annot"><a href="#local-6989586621679100335"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">Snap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679100456"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679100335"><span class="annot"><span class="annottext">config :: Config Snap a
</span><a href="#local-6989586621679100335"><span class="hs-identifier hs-var hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. Int -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">setPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100338"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a)
-&gt; (Config Snap a -&gt; Config Snap a)
-&gt; Config Snap a
-&gt; Config Snap a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ByteString -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">setBind</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679100339"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a)
-&gt; (Config Snap a -&gt; Config Snap a)
-&gt; Config Snap a
-&gt; Config Snap a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigLog -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ConfigLog -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">setAccessLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigLog
</span><a href="#local-6989586621679100332"><span class="hs-identifier hs-var">lg</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a)
-&gt; (Config Snap a -&gt; Config Snap a)
-&gt; Config Snap a
-&gt; Config Snap a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigLog -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ConfigLog -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">setErrorLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigLog
</span><a href="#local-6989586621679100332"><span class="hs-identifier hs-var">lg</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Config Snap a
forall (m :: * -&gt; *) a. MonadSnap m =&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">defaultConfig</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679100332"><span class="annot"><span class="annottext">lg :: ConfigLog
</span><a href="#local-6989586621679100332"><span class="hs-identifier hs-var hs-var">lg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConfigLog
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">ConfigNoLog</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="#local-6989586621679100334"><span class="hs-identifier hs-type">site</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">Snap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679100334"><span class="annot"><span class="annottext">site :: Snap ()
</span><a href="#local-6989586621679100334"><span class="hs-identifier hs-var hs-var">site</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ByteString, Snap ())] -&gt; Snap ()
forall (m :: * -&gt; *) a. MonadSnap m =&gt; [(ByteString, m a)] -&gt; m a
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">route</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;/metrics/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Server -&gt; Snap ()
</span><a href="#local-6989586621679100330"><span class="hs-identifier hs-var">webhandler</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679100340"><span class="hs-identifier hs-var">ekg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="#local-6989586621679100330"><span class="hs-identifier hs-type">webhandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ekg/html/src"><span class="hs-identifier hs-type">EKG.Server</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">Snap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621679100330"><span class="annot"><span class="annottext">webhandler :: Server -&gt; Snap ()
</span><a href="#local-6989586621679100330"><span class="hs-identifier hs-var hs-var">webhandler</span></a></span></span><span> </span><span id="local-6989586621679100329"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679100329"><span class="hs-identifier hs-var">srv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>        </span><span id="local-6989586621679100328"><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679100328"><span class="hs-identifier hs-var">samples</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Sample -&gt; Snap Sample
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Sample -&gt; Snap Sample) -&gt; IO Sample -&gt; Snap Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Store -&gt; IO Sample
</span><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-var">sampleAll</span></a></span><span> </span><span class="annot"><span class="annottext">(Store -&gt; IO Sample) -&gt; Store -&gt; IO Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Server -&gt; Store
</span><a href="../../../../ekg/html/src"><span class="hs-identifier hs-var hs-var">EKG.serverMetricStore</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679100329"><span class="hs-identifier hs-var">srv</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100325"><span class="annot"><span class="annottext">output :: ByteString
</span><a href="#local-6989586621679100325"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679100337"><span class="hs-identifier hs-var">prometheusOutput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-81"></span><span>                         </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sample -&gt; ByteString
</span><a href="#local-6989586621679100324"><span class="hs-identifier hs-var">renderSimpleOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679100328"><span class="hs-identifier hs-var">samples</span></a></span><span>
</span><span id="line-82"></span><span>                         </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sample -&gt; ByteString
</span><a href="#local-6989586621679100323"><span class="hs-identifier hs-var">renderJSONOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679100328"><span class="hs-identifier hs-var">samples</span></a></span><span>
</span><span id="line-83"></span><span>                         </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sample -&gt; ByteString
</span><a href="#local-6989586621679100324"><span class="hs-identifier hs-var">renderSimpleOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679100328"><span class="hs-identifier hs-var">samples</span></a></span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Snap ()
forall (m :: * -&gt; *). MonadSnap m =&gt; ByteString -&gt; m ()
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">writeLBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679100325"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">() -&gt; Snap ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- Simple output: key value.</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679100324"><span class="annot"><span class="annottext">renderSimpleOutput :: Sample -&gt; ByteString
</span><a href="#local-6989586621679100324"><span class="hs-identifier hs-var hs-var">renderSimpleOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">toLazyByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; ByteString)
-&gt; (Sample -&gt; Builder) -&gt; Sample -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Value)] -&gt; Builder
</span><a href="#local-6989586621679100321"><span class="hs-identifier hs-var">renderSamples</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, Value)] -&gt; Builder)
-&gt; (Sample -&gt; [(Text, Value)]) -&gt; Sample -&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Sample -&gt; [(Text, Value)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><a href="../../../../unordered-containers/html/src"><span class="hs-identifier hs-var">HM.toList</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="#local-6989586621679100321"><span class="hs-identifier hs-type">renderSamples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679100321"><span class="annot"><span class="annottext">renderSamples :: [(Text, Value)] -&gt; Builder
</span><a href="#local-6989586621679100321"><span class="hs-identifier hs-var hs-var">renderSamples</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="#local-6989586621679100321"><span class="hs-identifier hs-var">renderSamples</span></a></span><span> </span><span id="local-6989586621679100319"><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100319"><span class="hs-identifier hs-var">samples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679100318"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Counter</span></a></span><span> </span><span id="local-6989586621679100316"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100316"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder -&gt; Builder
</span><a href="#local-6989586621679100315"><span class="hs-identifier hs-var">renderNamedValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100314"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Builder
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">int64Dec</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100316"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Gauge</span></a></span><span> </span><span id="local-6989586621679100311"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100311"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder -&gt; Builder
</span><a href="#local-6989586621679100315"><span class="hs-identifier hs-var">renderNamedValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100314"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Builder
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">int64Dec</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100311"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>            </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span id="local-6989586621679100309"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100309"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679100308"><span class="hs-identifier hs-var">isFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100309"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-98"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder -&gt; Builder
</span><a href="#local-6989586621679100315"><span class="hs-identifier hs-var">renderNamedValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100314"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">byteString</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Builder) -&gt; ByteString -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100309"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-100"></span><span>            </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100314"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100314"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679100318"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679100318"><span class="hs-identifier hs-var">sv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100319"><span class="hs-identifier hs-var">samples</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="#local-6989586621679100315"><span class="hs-identifier hs-type">renderNamedValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">Builder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679100315"><span class="annot"><span class="annottext">renderNamedValue :: Text -&gt; Builder -&gt; Builder
</span><a href="#local-6989586621679100315"><span class="hs-identifier hs-var hs-var">renderNamedValue</span></a></span></span><span> </span><span id="local-6989586621679100306"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100306"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621679100305"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679100305"><span class="hs-identifier hs-var">bld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Builder
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">byteString</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Builder) -&gt; ByteString -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="#local-6989586621679100304"><span class="hs-identifier hs-var">prepareName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100306"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">charUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679100305"><span class="hs-identifier hs-var">bld</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">charUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679100304"><span class="annot"><span class="annottext">prepareName :: Text -&gt; ByteString
</span><a href="#local-6989586621679100304"><span class="hs-identifier hs-var hs-var">prepareName</span></a></span></span><span> </span><span id="local-6989586621679100302"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100302"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Text -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; [Char] -&gt; Bool) -&gt; [Char] -&gt; Char -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; [Char] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">elem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'z'</span></span><span class="hs-special">]</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'Z'</span></span><span class="hs-special">]</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.replace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.replace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.replace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100302"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679100308"><span class="annot"><span class="annottext">isFloat :: Text -&gt; Bool
</span><a href="#local-6989586621679100308"><span class="hs-identifier hs-var hs-var">isFloat</span></a></span></span><span> </span><span id="local-6989586621679100297"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100297"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reader Double
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">double</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100297"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100296"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679100296"><span class="hs-identifier hs-var">_n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>  </span><span class="hs-comment">-- only floating point number parsed, no leftover</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">Either [Char] (Double, Text)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- JSON output</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679100323"><span class="annot"><span class="annottext">renderJSONOutput :: Sample -&gt; ByteString
</span><a href="#local-6989586621679100323"><span class="hs-identifier hs-var hs-var">renderJSONOutput</span></a></span></span><span> </span><span id="local-6989586621679100295"><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679100295"><span class="hs-identifier hs-var">samples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100294"><span class="annot"><span class="annottext">rtsNamespace :: Text
</span><a href="#local-6989586621679100294"><span class="hs-identifier hs-var hs-var">rtsNamespace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rts.gc&quot;</span></span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679100293"><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100293"><span class="hs-identifier hs-var">rtsSamples</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679100292"><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100292"><span class="hs-identifier hs-var">otherSamples</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Text, Value) -&gt; Bool)
-&gt; [(Text, Value)] -&gt; ([(Text, Value)], [(Text, Value)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679100291"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100291"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100294"><span class="hs-identifier hs-var">rtsNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><a href="../../../../text/html/src"><span class="hs-operator hs-var">`T.isPrefixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100291"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Text, Value)] -&gt; ([(Text, Value)], [(Text, Value)]))
-&gt; [(Text, Value)] -&gt; ([(Text, Value)], [(Text, Value)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Sample -&gt; [(Text, Value)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><a href="../../../../unordered-containers/html/src"><span class="hs-identifier hs-var">HM.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679100295"><span class="hs-identifier hs-var">samples</span></a></span><span>
</span><span id="line-118"></span><span>            </span><span id="local-6989586621679100289"><span class="annot"><span class="annottext">rtsMetrics :: MetricsGroup
</span><a href="#local-6989586621679100289"><span class="hs-identifier hs-var hs-var">rtsMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Text, Value)] -&gt; MetricsGroup
</span><a href="#local-6989586621679100288"><span class="hs-identifier hs-var">extractRtsGcMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100294"><span class="hs-identifier hs-var">rtsNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100293"><span class="hs-identifier hs-var">rtsSamples</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span id="local-6989586621679100287"><span class="annot"><span class="annottext">otherMetrics :: MetricsGroup
</span><a href="#local-6989586621679100287"><span class="hs-identifier hs-var hs-var">otherMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, Value)] -&gt; MetricsGroup
</span><a href="#local-6989586621679100286"><span class="hs-identifier hs-var">extractOtherMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100292"><span class="hs-identifier hs-var">otherSamples</span></a></span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[MetricsGroup] -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">A.encode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MetricsGroup
</span><a href="#local-6989586621679100289"><span class="hs-identifier hs-var">rtsMetrics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetricsGroup
</span><a href="#local-6989586621679100287"><span class="hs-identifier hs-var">otherMetrics</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- rts.gc metrics are always here because they are predefined in ekg-core,</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">-- so we can group them.</span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><a href="#local-6989586621679100288"><span class="hs-identifier hs-type">extractRtsGcMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#MetricsGroup"><span class="hs-identifier hs-type">MetricsGroup</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679100288"><span class="annot"><span class="annottext">extractRtsGcMetrics :: Text -&gt; [(Text, Value)] -&gt; MetricsGroup
</span><a href="#local-6989586621679100288"><span class="hs-identifier hs-var hs-var">extractRtsGcMetrics</span></a></span></span><span> </span><span id="local-6989586621679100284"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100284"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679100283"><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100283"><span class="hs-identifier hs-var">samples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetricsGroup :: Text -&gt; [Metric] -&gt; MetricsGroup
</span><a href="Cardano.BM.Backend.Prometheus.html#MetricsGroup"><span class="hs-identifier hs-type">MetricsGroup</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">namespace :: Text
</span><a href="Cardano.BM.Backend.Prometheus.html#namespace"><span class="hs-identifier hs-var">namespace</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100284"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metrics :: [Metric]
</span><a href="Cardano.BM.Backend.Prometheus.html#metrics"><span class="hs-identifier hs-var">metrics</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679100282"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>                </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Counter</span></a></span><span> </span><span id="local-6989586621679100281"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100281"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int64 -&gt; Metric
forall a. Integral a =&gt; Text -&gt; a -&gt; Metric
</span><a href="#local-6989586621679100280"><span class="hs-identifier hs-var">intMetric</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100279"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100281"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-130"></span><span>                </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Gauge</span></a></span><span> </span><span id="local-6989586621679100278"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100278"><span class="hs-identifier hs-var">g</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int64 -&gt; Metric
forall a. Integral a =&gt; Text -&gt; a -&gt; Metric
</span><a href="#local-6989586621679100280"><span class="hs-identifier hs-var">intMetric</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100279"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100278"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-131"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metric
</span><a href="Cardano.BM.Backend.Prometheus.html#NoMetric"><span class="hs-identifier hs-var">NoMetric</span></a></span><span> </span><span class="hs-comment">-- rts.gc can contain Counter or Gauge only.</span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100279"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100279"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679100282"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679100282"><span class="hs-identifier hs-var">sv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100283"><span class="hs-identifier hs-var">samples</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>        </span><span id="local-6989586621679100280"><span class="annot"><span class="annottext">intMetric :: Text -&gt; a -&gt; Metric
</span><a href="#local-6989586621679100280"><span class="hs-identifier hs-var hs-var">intMetric</span></a></span></span><span> </span><span id="local-6989586621679100277"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100277"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621679100276"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679100276"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>            </span><span class="annot"><span class="annottext">Metric :: Text -&gt; Text -&gt; Number -&gt; Metric
</span><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-type">Metric</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mName :: Text
</span><a href="Cardano.BM.Backend.Prometheus.html#mName"><span class="hs-identifier hs-var">mName</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.stripPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100284"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100277"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-138"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mType :: Text
</span><a href="Cardano.BM.Backend.Prometheus.html#mType"><span class="hs-identifier hs-var">mType</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;int&quot;</span></span><span> </span><span class="hs-comment">-- All values are Int64.</span><span>
</span><span id="line-139"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mValue :: Number
</span><a href="Cardano.BM.Backend.Prometheus.html#mValue"><span class="hs-identifier hs-var">mValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Number
</span><a href="Cardano.BM.Backend.Prometheus.html#NumberInt"><span class="hs-identifier hs-var">NumberInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679100276"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- We cannot make any assumptions about the format of 'sk' in other samples,</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- so group other samples into 'common' group.</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="#local-6989586621679100286"><span class="hs-identifier hs-type">extractOtherMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#MetricsGroup"><span class="hs-identifier hs-type">MetricsGroup</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679100286"><span class="annot"><span class="annottext">extractOtherMetrics :: [(Text, Value)] -&gt; MetricsGroup
</span><a href="#local-6989586621679100286"><span class="hs-identifier hs-var hs-var">extractOtherMetrics</span></a></span></span><span> </span><span id="local-6989586621679100272"><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100272"><span class="hs-identifier hs-var">samples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetricsGroup :: Text -&gt; [Metric] -&gt; MetricsGroup
</span><a href="Cardano.BM.Backend.Prometheus.html#MetricsGroup"><span class="hs-identifier hs-type">MetricsGroup</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">namespace :: Text
</span><a href="Cardano.BM.Backend.Prometheus.html#namespace"><span class="hs-identifier hs-var">namespace</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;common&quot;</span></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metrics :: [Metric]
</span><a href="Cardano.BM.Backend.Prometheus.html#metrics"><span class="hs-identifier hs-var">metrics</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>                </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Counter</span></a></span><span> </span><span id="local-6989586621679100270"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100270"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Number -&gt; Metric
</span><a href="#local-6989586621679100269"><span class="hs-identifier hs-var">mkMetric</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">(Number -&gt; Metric) -&gt; Number -&gt; Metric
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Number
</span><a href="Cardano.BM.Backend.Prometheus.html#NumberInt"><span class="hs-identifier hs-var">NumberInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100270"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>                </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Gauge</span></a></span><span> </span><span id="local-6989586621679100267"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100267"><span class="hs-identifier hs-var">g</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Number -&gt; Metric
</span><a href="#local-6989586621679100269"><span class="hs-identifier hs-var">mkMetric</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">(Number -&gt; Metric) -&gt; Number -&gt; Metric
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Number
</span><a href="Cardano.BM.Backend.Prometheus.html#NumberInt"><span class="hs-identifier hs-var">NumberInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679100267"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>                </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span id="local-6989586621679100266"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100266"><span class="hs-identifier hs-var">l</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reader Double
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">double</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100266"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>                                 </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metric
</span><a href="Cardano.BM.Backend.Prometheus.html#NoMetric"><span class="hs-identifier hs-var">NoMetric</span></a></span><span>
</span><span id="line-153"></span><span>                                 </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100265"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679100265"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Number -&gt; Metric
</span><a href="#local-6989586621679100269"><span class="hs-identifier hs-var">mkMetric</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">(Number -&gt; Metric) -&gt; Number -&gt; Metric
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Number
</span><a href="Cardano.BM.Backend.Prometheus.html#NumberReal"><span class="hs-identifier hs-var">NumberReal</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679100265"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-154"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metric
</span><a href="Cardano.BM.Backend.Prometheus.html#NoMetric"><span class="hs-identifier hs-var">NoMetric</span></a></span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100268"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679100271"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">sv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621679100272"><span class="hs-identifier hs-var">samples</span></a></span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>        </span><span id="local-6989586621679100269"><span class="annot"><span class="annottext">mkMetric :: Text -&gt; Number -&gt; Metric
</span><a href="#local-6989586621679100269"><span class="hs-identifier hs-var hs-var">mkMetric</span></a></span></span><span> </span><span id="local-6989586621679100264"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100264"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621679100263"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100263"><span class="hs-identifier hs-var">number</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100262"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100262"><span class="hs-identifier hs-var">withoutType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679100261"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100261"><span class="hs-identifier hs-var">typeSuffix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Number -&gt; (Text, Text)
</span><a href="#local-6989586621679100260"><span class="hs-identifier hs-var">stripTypeSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100264"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100263"><span class="hs-identifier hs-var">number</span></a></span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Metric :: Text -&gt; Text -&gt; Number -&gt; Metric
</span><a href="Cardano.BM.Backend.Prometheus.html#Metric"><span class="hs-identifier hs-type">Metric</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mName :: Text
</span><a href="Cardano.BM.Backend.Prometheus.html#mName"><span class="hs-identifier hs-var">mName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100262"><span class="hs-identifier hs-var">withoutType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mType :: Text
</span><a href="Cardano.BM.Backend.Prometheus.html#mType"><span class="hs-identifier hs-var">mType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100261"><span class="hs-identifier hs-var">typeSuffix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mValue :: Number
</span><a href="Cardano.BM.Backend.Prometheus.html#mValue"><span class="hs-identifier hs-var">mValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100263"><span class="hs-identifier hs-var">number</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span>        </span><span id="local-6989586621679100260"><span class="annot"><span class="annottext">stripTypeSuffix :: Text -&gt; Number -&gt; (Text, Text)
</span><a href="#local-6989586621679100260"><span class="hs-identifier hs-var hs-var">stripTypeSuffix</span></a></span></span><span> </span><span id="local-6989586621679100259"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100259"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span id="local-6989586621679100258"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100258"><span class="hs-identifier hs-var">number</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100257"><span class="annot"><span class="annottext">types :: [Text]
</span><a href="#local-6989586621679100257"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;us&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ns&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;s&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;B&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;int&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;real&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>                </span><span id="local-6989586621679100256"><span class="annot"><span class="annottext">parts :: [Text]
</span><a href="#local-6989586621679100256"><span class="hs-identifier hs-var hs-var">parts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [Text]
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100259"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-165"></span><span>                </span><span id="local-6989586621679100254"><span class="annot"><span class="annottext">typeSuffix :: Text
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var hs-var">typeSuffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ([Text] -&gt; Bool) -&gt; [Text] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Bool) -&gt; [Text] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679100256"><span class="hs-identifier hs-var">parts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679100256"><span class="hs-identifier hs-var">parts</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var">typeSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679100257"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-167"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.stripSuffix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var">typeSuffix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100259"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var">typeSuffix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679100258"><span class="hs-identifier hs-var">number</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>                            </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NumberInt"><span class="hs-identifier hs-type">NumberInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100259"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;int&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                            </span><span class="annot"><a href="Cardano.BM.Backend.Prometheus.html#NumberReal"><span class="hs-identifier hs-type">NumberReal</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679100259"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;real&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-glyph">\</span><span class="hs-identifier">end</span><span class="hs-special">{</span><span class="hs-identifier">code</span><span class="hs-special">}</span><span>
</span><span id="line-172"></span></pre></body></html>