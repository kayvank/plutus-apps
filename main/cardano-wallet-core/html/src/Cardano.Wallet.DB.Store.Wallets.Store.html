<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">{- |
Copyright: &#169; 2022 IOHK
License: Apache-2.0

Implementation of a store for 'TxWalletsHistory'

-}</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.DB.Store.Wallets.Store</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreTxWalletsHistory"><span class="hs-identifier">mkStoreTxWalletsHistory</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier">DeltaTxWalletsHistory</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier">mkStoreWalletsMeta</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html"><span class="hs-identifier">Cardano.Wallet.DB.Sqlite.Schema</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">EntityField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMetaWalletId"><span class="hs-identifier">TxMetaWalletId</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMeta"><span class="hs-identifier">TxMeta</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Meta.Model</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#DeltaTxMetaHistory"><span class="hs-identifier">DeltaTxMetaHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#Manipulate"><span class="hs-identifier">Manipulate</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier">TxMetaHistory</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#mkTxMetaHistory"><span class="hs-identifier">mkTxMetaHistory</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Store.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Meta.Store</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Store.html#mkStoreMetaTransactions"><span class="hs-identifier">mkStoreMetaTransactions</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Transactions.Model</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeltaTxHistory"><span class="hs-identifier">DeltaTxHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier">TxHistoryF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier">mkTxHistory</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Store.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Transactions.Store</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Store.html#mkStoreTransactions"><span class="hs-identifier">mkStoreTransactions</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Wallets.Model</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier">DeltaTxWalletsHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#walletsLinkedTransactions"><span class="hs-identifier">walletsLinkedTransactions</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftA2</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">SomeException</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM_</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">ExceptT</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">runExceptT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.DBVar</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Store</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.DeltaMap</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">DeltaMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">nub</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">Database.Persist.Sql</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">SqlPersistT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">deleteWhere</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">entityVal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">selectList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-operator">(==.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Meta.Model</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TxMetaStore</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Transactions.Model</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TxStore</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Store for a map of 'DeltaTxMetaHistory' of multiple different wallets.</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-type">mkStoreWalletsMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier hs-type">SqlPersistT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">DeltaMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#DeltaTxMetaHistory"><span class="hs-identifier hs-type">DeltaTxMetaHistory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span id="mkStoreWalletsMeta"><span class="annot"><span class="annottext">mkStoreWalletsMeta :: Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-var hs-var">mkStoreWalletsMeta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">Store :: forall (m :: * -&gt; *) da.
m (Either SomeException (Base da))
-&gt; (Base da -&gt; m ()) -&gt; (Base da -&gt; da -&gt; m ()) -&gt; Store m da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">loadS :: SqlPersistT
  IO
  (Either
     SomeException (Base (DeltaMap WalletId DeltaTxMetaHistory)))
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">loadS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlPersistT IO (Either SomeException (Map WalletId TxMetaHistory))
SqlPersistT
  IO
  (Either
     SomeException (Base (DeltaMap WalletId DeltaTxMetaHistory)))
</span><a href="#local-6989586621682458397"><span class="hs-identifier hs-var">load</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">writeS :: Base (DeltaMap WalletId DeltaTxMetaHistory) -&gt; SqlPersistT IO ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">writeS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory -&gt; SqlPersistT IO ()
Base (DeltaMap WalletId DeltaTxMetaHistory) -&gt; SqlPersistT IO ()
</span><a href="#local-6989586621682458395"><span class="hs-identifier hs-var">write</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">updateS :: Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">updateS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
forall p.
p -&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
</span><a href="#local-6989586621682458393"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621682458395"><span class="annot"><span class="annottext">write :: Map WalletId TxMetaHistory -&gt; SqlPersistT IO ()
</span><a href="#local-6989586621682458395"><span class="hs-identifier hs-var hs-var">write</span></a></span></span><span> </span><span id="local-6989586621682458392"><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458392"><span class="hs-identifier hs-var">reset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(WalletId, TxMetaHistory)]
-&gt; ((WalletId, TxMetaHistory) -&gt; SqlPersistT IO ())
-&gt; SqlPersistT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory -&gt; [(WalletId, TxMetaHistory)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.assocs</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458392"><span class="hs-identifier hs-var">reset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((WalletId, TxMetaHistory) -&gt; SqlPersistT IO ())
 -&gt; SqlPersistT IO ())
-&gt; ((WalletId, TxMetaHistory) -&gt; SqlPersistT IO ())
-&gt; SqlPersistT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682458390"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458390"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682458389"><span class="annot"><span class="annottext">TxMetaHistory
</span><a href="#local-6989586621682458389"><span class="hs-identifier hs-var">metas</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxMetaHistory
-&gt; Base DeltaTxMetaHistory -&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">writeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; Store (SqlPersistT IO) DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Store.html#mkStoreMetaTransactions"><span class="hs-identifier hs-var">mkStoreMetaTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458390"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Base DeltaTxMetaHistory
TxMetaHistory
</span><a href="#local-6989586621682458389"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621682458393"><span class="annot"><span class="annottext">update :: p -&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
</span><a href="#local-6989586621682458393"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Insert</span></a></span><span> </span><span id="local-6989586621682458387"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458387"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682458386"><span class="annot"><span class="annottext">Base DeltaTxMetaHistory
</span><a href="#local-6989586621682458386"><span class="hs-identifier hs-var">metas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxMetaHistory
-&gt; Base DeltaTxMetaHistory -&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">writeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; Store (SqlPersistT IO) DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Store.html#mkStoreMetaTransactions"><span class="hs-identifier hs-var">mkStoreMetaTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458387"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Base DeltaTxMetaHistory
</span><a href="#local-6989586621682458386"><span class="hs-identifier hs-var">metas</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="#local-6989586621682458393"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span id="local-6989586621682458384"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458384"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">[Filter TxMeta] -&gt; SqlPersistT IO ()
forall backend (m :: * -&gt; *) record.
(PersistQueryWrite backend, MonadIO m,
 PersistRecordBackend record backend) =&gt;
[Filter record] -&gt; ReaderT backend m ()
</span><a href="../../../../persistent/html/src"><span class="hs-identifier hs-var">deleteWhere</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EntityField TxMeta WalletId
forall typ. (typ ~ WalletId) =&gt; EntityField TxMeta typ
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMetaWalletId"><span class="hs-identifier hs-var">TxMetaWalletId</span></a></span><span> </span><span class="annot"><span class="annottext">EntityField TxMeta WalletId -&gt; WalletId -&gt; Filter TxMeta
forall v typ.
PersistField typ =&gt;
EntityField v typ -&gt; typ -&gt; Filter v
</span><a href="../../../../persistent/html/src"><span class="hs-operator hs-var">==.</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458384"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="#local-6989586621682458393"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Adjust</span></a></span><span> </span><span id="local-6989586621682458382"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458382"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682458381"><span class="annot"><span class="annottext">DeltaTxMetaHistory
</span><a href="#local-6989586621682458381"><span class="hs-identifier hs-var">da</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxMetaHistory
-&gt; Base DeltaTxMetaHistory
-&gt; DeltaTxMetaHistory
-&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; Store (SqlPersistT IO) DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Store.html#mkStoreMetaTransactions"><span class="hs-identifier hs-var">mkStoreMetaTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458382"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Base DeltaTxMetaHistory
forall a. HasCallStack =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaTxMetaHistory
</span><a href="#local-6989586621682458381"><span class="hs-identifier hs-var">da</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="#local-6989586621682458397"><span class="hs-identifier hs-type">load</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier hs-type">SqlPersistT</span></a></span><span>
</span><span id="line-80"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-81"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621682458397"><span class="annot"><span class="annottext">load :: SqlPersistT IO (Either SomeException (Map WalletId TxMetaHistory))
</span><a href="#local-6989586621682458397"><span class="hs-identifier hs-var hs-var">load</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>        </span><span id="local-6989586621682458379"><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682458379"><span class="hs-identifier hs-var">wids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[WalletId] -&gt; [WalletId]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([WalletId] -&gt; [WalletId])
-&gt; ([Entity TxMeta] -&gt; [WalletId]) -&gt; [Entity TxMeta] -&gt; [WalletId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Entity TxMeta -&gt; WalletId) -&gt; [Entity TxMeta] -&gt; [WalletId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((WalletId -&gt; Const WalletId WalletId)
 -&gt; TxMeta -&gt; Const WalletId TxMeta)
-&gt; TxMeta -&gt; WalletId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetaWalletId&quot;
  ((WalletId -&gt; Const WalletId WalletId)
   -&gt; TxMeta -&gt; Const WalletId TxMeta)
(WalletId -&gt; Const WalletId WalletId)
-&gt; TxMeta -&gt; Const WalletId TxMeta
</span><a href="#local-6989586621682458377"><span class="hs-var">#txMetaWalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMeta -&gt; WalletId)
-&gt; (Entity TxMeta -&gt; TxMeta) -&gt; Entity TxMeta -&gt; WalletId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Entity TxMeta -&gt; TxMeta
forall record. Entity record -&gt; record
</span><a href="../../../../persistent/html/src"><span class="hs-identifier hs-var hs-var">entityVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>            </span><span class="annot"><span class="annottext">([Entity TxMeta] -&gt; [WalletId])
-&gt; ReaderT SqlBackend IO [Entity TxMeta]
-&gt; ReaderT SqlBackend IO [WalletId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Filter TxMeta]
-&gt; [SelectOpt TxMeta] -&gt; ReaderT SqlBackend IO [Entity TxMeta]
forall record backend (m :: * -&gt; *).
(MonadIO m, PersistQueryRead backend,
 PersistRecordBackend record backend) =&gt;
[Filter record]
-&gt; [SelectOpt record] -&gt; ReaderT backend m [Entity record]
</span><a href="../../../../persistent/html/src"><span class="hs-identifier hs-var">selectList</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">ExceptT SomeException (SqlPersistT IO) (Map WalletId TxMetaHistory)
-&gt; SqlPersistT
     IO (Either SomeException (Map WalletId TxMetaHistory))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   SomeException (SqlPersistT IO) (Map WalletId TxMetaHistory)
 -&gt; SqlPersistT
      IO (Either SomeException (Map WalletId TxMetaHistory)))
-&gt; ExceptT
     SomeException (SqlPersistT IO) (Map WalletId TxMetaHistory)
-&gt; SqlPersistT
     IO (Either SomeException (Map WalletId TxMetaHistory))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>            </span><span id="local-6989586621682458375"><span class="annot"><span class="annottext">[TxMetaHistory]
</span><a href="#local-6989586621682458375"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[WalletId]
-&gt; (WalletId
    -&gt; ExceptT SomeException (SqlPersistT IO) TxMetaHistory)
-&gt; ExceptT SomeException (SqlPersistT IO) [TxMetaHistory]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682458379"><span class="hs-identifier hs-var">wids</span></a></span><span> </span><span class="annot"><span class="annottext">((WalletId -&gt; ExceptT SomeException (SqlPersistT IO) TxMetaHistory)
 -&gt; ExceptT SomeException (SqlPersistT IO) [TxMetaHistory])
-&gt; (WalletId
    -&gt; ExceptT SomeException (SqlPersistT IO) TxMetaHistory)
-&gt; ExceptT SomeException (SqlPersistT IO) [TxMetaHistory]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT SqlBackend IO (Either SomeException TxMetaHistory)
-&gt; ExceptT SomeException (SqlPersistT IO) TxMetaHistory
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT SqlBackend IO (Either SomeException TxMetaHistory)
 -&gt; ExceptT SomeException (SqlPersistT IO) TxMetaHistory)
-&gt; (WalletId
    -&gt; ReaderT SqlBackend IO (Either SomeException TxMetaHistory))
-&gt; WalletId
-&gt; ExceptT SomeException (SqlPersistT IO) TxMetaHistory
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxMetaHistory
-&gt; ReaderT SqlBackend IO (Either SomeException TxMetaHistory)
forall (m :: * -&gt; *) da.
Store m da -&gt; m (Either SomeException (Base da))
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">loadS</span></a></span><span> </span><span class="annot"><span class="annottext">(Store (SqlPersistT IO) DeltaTxMetaHistory
 -&gt; ReaderT SqlBackend IO (Either SomeException TxMetaHistory))
-&gt; (WalletId -&gt; Store (SqlPersistT IO) DeltaTxMetaHistory)
-&gt; WalletId
-&gt; ReaderT SqlBackend IO (Either SomeException TxMetaHistory)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Store (SqlPersistT IO) DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Store.html#mkStoreMetaTransactions"><span class="hs-identifier hs-var">mkStoreMetaTransactions</span></a></span><span>
</span><span id="line-87"></span><span>            </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
-&gt; ExceptT
     SomeException (SqlPersistT IO) (Map WalletId TxMetaHistory)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Map WalletId TxMetaHistory
 -&gt; ExceptT
      SomeException (SqlPersistT IO) (Map WalletId TxMetaHistory))
-&gt; Map WalletId TxMetaHistory
-&gt; ExceptT
     SomeException (SqlPersistT IO) (Map WalletId TxMetaHistory)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(WalletId, TxMetaHistory)] -&gt; Map WalletId TxMetaHistory
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(WalletId, TxMetaHistory)] -&gt; Map WalletId TxMetaHistory)
-&gt; [(WalletId, TxMetaHistory)] -&gt; Map WalletId TxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletId] -&gt; [TxMetaHistory] -&gt; [(WalletId, TxMetaHistory)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682458379"><span class="hs-identifier hs-var">wids</span></a></span><span> </span><span class="annot"><span class="annottext">[TxMetaHistory]
</span><a href="#local-6989586621682458375"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Store for 'DeltaTxWalletsHistory'.</span><span>
</span><span id="line-90"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreTxWalletsHistory"><span class="hs-identifier hs-type">mkStoreTxWalletsHistory</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier hs-type">SqlPersistT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier hs-type">DeltaTxWalletsHistory</span></a></span><span>
</span><span id="line-92"></span><span id="mkStoreTxWalletsHistory"><span class="annot"><span class="annottext">mkStoreTxWalletsHistory :: Store (SqlPersistT IO) DeltaTxWalletsHistory
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreTxWalletsHistory"><span class="hs-identifier hs-var hs-var">mkStoreTxWalletsHistory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">Store :: forall (m :: * -&gt; *) da.
m (Either SomeException (Base da))
-&gt; (Base da -&gt; m ()) -&gt; (Base da -&gt; da -&gt; m ()) -&gt; Store m da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">loadS :: SqlPersistT IO (Either SomeException (Base DeltaTxWalletsHistory))
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">loadS</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><span class="annottext">(TxHistory
 -&gt; Map WalletId TxMetaHistory
 -&gt; (TxHistory, Map WalletId TxMetaHistory))
-&gt; Either SomeException TxHistory
-&gt; Either SomeException (Map WalletId TxMetaHistory)
-&gt; Either SomeException (TxHistory, Map WalletId TxMetaHistory)
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftA2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either SomeException TxHistory
 -&gt; Either SomeException (Map WalletId TxMetaHistory)
 -&gt; Either SomeException (TxHistory, Map WalletId TxMetaHistory))
-&gt; SqlPersistT IO (Either SomeException TxHistory)
-&gt; SqlPersistT
     IO
     (Either SomeException (Map WalletId TxMetaHistory)
      -&gt; Either SomeException (TxHistory, Map WalletId TxMetaHistory))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
-&gt; SqlPersistT IO (Either SomeException (Base DeltaTxHistory))
forall (m :: * -&gt; *) da.
Store m da -&gt; m (Either SomeException (Base da))
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">loadS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Store.html#mkStoreTransactions"><span class="hs-identifier hs-var">mkStoreTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">SqlPersistT
  IO
  (Either SomeException (Map WalletId TxMetaHistory)
   -&gt; Either SomeException (TxHistory, Map WalletId TxMetaHistory))
-&gt; SqlPersistT
     IO (Either SomeException (Map WalletId TxMetaHistory))
-&gt; SqlPersistT
     IO (Either SomeException (TxHistory, Map WalletId TxMetaHistory))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; SqlPersistT
     IO
     (Either
        SomeException (Base (DeltaMap WalletId DeltaTxMetaHistory)))
forall (m :: * -&gt; *) da.
Store m da -&gt; m (Either SomeException (Base da))
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">loadS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-var">mkStoreWalletsMeta</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">writeS :: Base DeltaTxWalletsHistory -&gt; SqlPersistT IO ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">writeS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682458373"><span class="annot"><a href="#local-6989586621682458373"><span class="hs-identifier hs-var">txHistory</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682458372"><span class="annot"><a href="#local-6989586621682458372"><span class="hs-identifier hs-var">txMetaHistory</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>            </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
-&gt; Base DeltaTxHistory -&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">writeS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Store.html#mkStoreTransactions"><span class="hs-identifier hs-var">mkStoreTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">Base DeltaTxHistory
TxHistory
</span><a href="#local-6989586621682458373"><span class="hs-identifier hs-var">txHistory</span></a></span><span>
</span><span id="line-98"></span><span>            </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory) -&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">writeS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-var">mkStoreWalletsMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
Base (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="#local-6989586621682458372"><span class="hs-identifier hs-var">txMetaHistory</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">updateS :: Base DeltaTxWalletsHistory
-&gt; DeltaTxWalletsHistory -&gt; SqlPersistT IO ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">updateS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682458371"><span class="annot"><a href="#local-6989586621682458371"><span class="hs-identifier hs-var">txh</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682458369"><span class="annot"><a href="#local-6989586621682458369"><span class="hs-identifier hs-var">mtxh</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621682458368"><span class="annot"><a href="#local-6989586621682458368"><span class="hs-identifier hs-var">mtxmh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-100"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#ExpandTxWalletsHistory"><span class="hs-identifier hs-type">ExpandTxWalletsHistory</span></a></span><span> </span><span id="local-6989586621682458366"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458366"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682458365"><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458365"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>                </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
-&gt; Base DeltaTxHistory -&gt; DeltaTxHistory -&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Store.html#mkStoreTransactions"><span class="hs-identifier hs-var">mkStoreTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">Base DeltaTxHistory
TxHistory
</span><a href="#local-6989586621682458371"><span class="hs-identifier hs-var">txh</span></a></span><span>
</span><span id="line-102"></span><span>                    </span><span class="annot"><span class="annottext">(DeltaTxHistory -&gt; SqlPersistT IO ())
-&gt; DeltaTxHistory -&gt; SqlPersistT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxHistory -&gt; DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Append"><span class="hs-identifier hs-var">TxStore.Append</span></a></span><span>
</span><span id="line-103"></span><span>                    </span><span class="annot"><span class="annottext">(TxHistory -&gt; DeltaTxHistory) -&gt; TxHistory -&gt; DeltaTxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Tx] -&gt; TxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier hs-var">mkTxHistory</span></a></span><span>
</span><span id="line-104"></span><span>                    </span><span class="annot"><span class="annottext">([Tx] -&gt; TxHistory) -&gt; [Tx] -&gt; TxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx, TxMeta) -&gt; Tx
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Tx, TxMeta) -&gt; Tx) -&gt; [(Tx, TxMeta)] -&gt; [Tx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458365"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-105"></span><span>                </span><span class="hs-comment">-- see also Store.Wallets.Model.garbageCollectEmptyWallets</span><span>
</span><span id="line-106"></span><span>                </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaMap WalletId DeltaTxMetaHistory
-&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-var">mkStoreWalletsMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
Base (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="#local-6989586621682458368"><span class="hs-identifier hs-var">mtxmh</span></a></span><span>
</span><span id="line-107"></span><span>                    </span><span class="annot"><span class="annottext">(DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ())
-&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Map WalletId TxMetaHistory -&gt; Maybe TxMetaHistory
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458366"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458368"><span class="hs-identifier hs-var">mtxmh</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>                        </span><span class="annot"><span class="annottext">Maybe TxMetaHistory
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-109"></span><span>                            </span><span class="annot"><span class="annottext">WalletId
-&gt; Base DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; Base da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Insert</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458366"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(Base DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; [(Tx, TxMeta)] -&gt; TxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#mkTxMetaHistory"><span class="hs-identifier hs-var">mkTxMetaHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458366"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458365"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-110"></span><span>                        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetaHistory
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-111"></span><span>                            </span><span class="annot"><span class="annottext">WalletId
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Adjust</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458366"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-112"></span><span>                            </span><span class="annot"><span class="annottext">(DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetaHistory -&gt; DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#Expand"><span class="hs-identifier hs-var">TxMetaStore.Expand</span></a></span><span>
</span><span id="line-113"></span><span>                            </span><span class="annot"><span class="annottext">(TxMetaHistory -&gt; DeltaTxMetaHistory)
-&gt; TxMetaHistory -&gt; DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; [(Tx, TxMeta)] -&gt; TxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#mkTxMetaHistory"><span class="hs-identifier hs-var">mkTxMetaHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458366"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458365"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#ChangeTxMetaWalletsHistory"><span class="hs-identifier hs-type">ChangeTxMetaWalletsHistory</span></a></span><span> </span><span id="local-6989586621682458360"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458360"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682458359"><span class="annot"><span class="annottext">ManipulateTxMetaHistory
</span><a href="#local-6989586621682458359"><span class="hs-identifier hs-var">change</span></a></span></span><span>
</span><span id="line-115"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaMap WalletId DeltaTxMetaHistory
-&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-var">mkStoreWalletsMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
Base (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="#local-6989586621682458368"><span class="hs-identifier hs-var">mtxmh</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="annot"><span class="annottext">(DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ())
-&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Adjust</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458360"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-117"></span><span>                </span><span class="annot"><span class="annottext">(DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ManipulateTxMetaHistory -&gt; DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#Manipulate"><span class="hs-identifier hs-var">Manipulate</span></a></span><span> </span><span class="annot"><span class="annottext">ManipulateTxMetaHistory
</span><a href="#local-6989586621682458359"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-118"></span><span>            </span><span class="annot"><span class="annottext">DeltaTxWalletsHistory
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#GarbageCollectTxWalletsHistory"><span class="hs-identifier hs-var">GarbageCollectTxWalletsHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxId -&gt; SqlPersistT IO ()) -&gt; [TxId] -&gt; SqlPersistT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span>
</span><span id="line-119"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
-&gt; Base DeltaTxHistory -&gt; DeltaTxHistory -&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Store.html#mkStoreTransactions"><span class="hs-identifier hs-var">mkStoreTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">Base DeltaTxHistory
TxHistory
</span><a href="#local-6989586621682458371"><span class="hs-identifier hs-var">txh</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaTxHistory -&gt; SqlPersistT IO ())
-&gt; (TxId -&gt; DeltaTxHistory) -&gt; TxId -&gt; SqlPersistT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxId -&gt; DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeleteTx"><span class="hs-identifier hs-var">DeleteTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                </span><span class="annot"><span class="annottext">([TxId] -&gt; SqlPersistT IO ()) -&gt; [TxId] -&gt; SqlPersistT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; [TxId]
forall k a. Map k a -&gt; [k]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.keys</span></a></span><span>
</span><span id="line-121"></span><span>                </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'Without) -&gt; [TxId])
-&gt; Map TxId (TxRelationF 'Without) -&gt; [TxId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
-&gt; Set TxId -&gt; Map TxId (TxRelationF 'Without)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.withoutKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682458369"><span class="hs-identifier hs-var">mtxh</span></a></span><span>
</span><span id="line-122"></span><span>                </span><span class="annot"><span class="annottext">(Set TxId -&gt; Map TxId (TxRelationF 'Without))
-&gt; Set TxId -&gt; Map TxId (TxRelationF 'Without)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory -&gt; Set TxId
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#walletsLinkedTransactions"><span class="hs-identifier hs-var">walletsLinkedTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458368"><span class="hs-identifier hs-var">mtxmh</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#RemoveWallet"><span class="hs-identifier hs-type">RemoveWallet</span></a></span><span> </span><span id="local-6989586621682458352"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458352"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaMap WalletId DeltaTxMetaHistory
-&gt; SqlPersistT IO ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="annot"><span class="annottext">Store (SqlPersistT IO) (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="Cardano.Wallet.DB.Store.Wallets.Store.html#mkStoreWalletsMeta"><span class="hs-identifier hs-var">mkStoreWalletsMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
Base (DeltaMap WalletId DeltaTxMetaHistory)
</span><a href="#local-6989586621682458368"><span class="hs-identifier hs-var">mtxmh</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ())
-&gt; DeltaMap WalletId DeltaTxMetaHistory -&gt; SqlPersistT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Delete</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458352"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span></pre></body></html>