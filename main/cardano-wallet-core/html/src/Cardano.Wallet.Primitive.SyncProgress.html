<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE Rank2Types #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | Functionality for calculating @SyncProgress@ of wallets.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.Primitive.SyncProgress</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-12"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier">SyncProgress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier">SyncTolerance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#mkSyncTolerance"><span class="hs-identifier">mkSyncTolerance</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Implementations</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#syncProgress"><span class="hs-identifier">syncProgress</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Slotting</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier">TimeInterpreter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier">interpretQuery</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#slotToRelTime"><span class="hs-identifier">slotToRelTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Bifunctor</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">bimap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Either</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromRight</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Quantity.html"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Quantity.html#Percentage"><span class="hs-identifier">Percentage</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Quantity.html#mkPercentage"><span class="hs-identifier">mkPercentage</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Ratio</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(%)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">Data.Text.Class</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">FromText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">TextDecodingError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">ToText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">NominalDiffTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">Buildable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">build</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Stack</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">HasCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks.Class</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime.WallClock.Types</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">RelativeTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier">diffRelTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span id="local-6989586621682442390"><span id="local-6989586621682442391"></span></span><span class="hs-keyword">data</span><span> </span><span id="SyncProgress"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-var">SyncProgress</span></a></span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Ready"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Syncing"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-var">Syncing</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;percent&quot;</span></span><span> </span><span class="annot"><a href="Data.Quantity.html#Percentage"><span class="hs-identifier hs-type">Percentage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NotResponding"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#NotResponding"><span class="hs-identifier hs-var">NotResponding</span></a></span></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. SyncProgress -&gt; Rep SyncProgress x)
-&gt; (forall x. Rep SyncProgress x -&gt; SyncProgress)
-&gt; Generic SyncProgress
forall x. Rep SyncProgress x -&gt; SyncProgress
forall x. SyncProgress -&gt; Rep SyncProgress x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SyncProgress x -&gt; SyncProgress
$cfrom :: forall x. SyncProgress -&gt; Rep SyncProgress x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682442380"><span id="local-6989586621682442382"><span class="annot"><span class="annottext">SyncProgress -&gt; SyncProgress -&gt; Bool
(SyncProgress -&gt; SyncProgress -&gt; Bool)
-&gt; (SyncProgress -&gt; SyncProgress -&gt; Bool) -&gt; Eq SyncProgress
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SyncProgress -&gt; SyncProgress -&gt; Bool
$c/= :: SyncProgress -&gt; SyncProgress -&gt; Bool
== :: SyncProgress -&gt; SyncProgress -&gt; Bool
$c== :: SyncProgress -&gt; SyncProgress -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682442373"><span id="local-6989586621682442375"><span id="local-6989586621682442377"><span class="annot"><span class="annottext">Int -&gt; SyncProgress -&gt; ShowS
[SyncProgress] -&gt; ShowS
SyncProgress -&gt; String
(Int -&gt; SyncProgress -&gt; ShowS)
-&gt; (SyncProgress -&gt; String)
-&gt; ([SyncProgress] -&gt; ShowS)
-&gt; Show SyncProgress
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SyncProgress] -&gt; ShowS
$cshowList :: [SyncProgress] -&gt; ShowS
show :: SyncProgress -&gt; String
$cshow :: SyncProgress -&gt; String
showsPrec :: Int -&gt; SyncProgress -&gt; ShowS
$cshowsPrec :: Int -&gt; SyncProgress -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682442366"><span id="local-6989586621682442368"><span id="local-6989586621682442370"><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span></span></span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682442363"><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682442348"><span id="local-6989586621682442350"><span id="local-6989586621682442352"><span id="local-6989586621682442354"><span id="local-6989586621682442357"><span id="local-6989586621682442359"><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#NotResponding"><span class="hs-identifier hs-var">NotResponding</span></a></span><span> </span><span id="local-6989586621682442346"><span class="annot"><span class="annottext">&lt;= :: SyncProgress -&gt; SyncProgress -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;=</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="annottext">SyncProgress
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#NotResponding"><span class="hs-identifier hs-var">NotResponding</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-type">Syncing</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-type">Syncing</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-type">Syncing</span></a></span><span> </span><span id="local-6989586621682442344"><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
</span><a href="#local-6989586621682442344"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-type">Syncing</span></a></span><span> </span><span id="local-6989586621682442343"><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
</span><a href="#local-6989586621682442343"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
</span><a href="#local-6989586621682442344"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
-&gt; Quantity &quot;percent&quot; Percentage -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage
</span><a href="#local-6989586621682442343"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621682442340"><span class="annot"><span class="annottext">build :: SyncProgress -&gt; Builder
</span><a href="#local-6989586621682442340"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;restored&quot;</span></span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-type">Syncing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682442338"><span class="annot"><span class="annottext">Percentage
</span><a href="#local-6989586621682442338"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-74"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;still restoring (&quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Percentage -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Percentage
</span><a href="#local-6989586621682442338"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#NotResponding"><span class="hs-identifier hs-var">NotResponding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;not responding&quot;</span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span id="local-6989586621682442335"><span id="local-6989586621682442336"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="SyncTolerance"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-var">SyncTolerance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SyncTolerance"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-var">SyncTolerance</span></a></span></span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. SyncTolerance -&gt; Rep SyncTolerance x)
-&gt; (forall x. Rep SyncTolerance x -&gt; SyncTolerance)
-&gt; Generic SyncTolerance
forall x. Rep SyncTolerance x -&gt; SyncTolerance
forall x. SyncTolerance -&gt; Rep SyncTolerance x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SyncTolerance x -&gt; SyncTolerance
$cfrom :: forall x. SyncTolerance -&gt; Rep SyncTolerance x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682442328"><span id="local-6989586621682442330"><span class="annot"><span class="annottext">SyncTolerance -&gt; SyncTolerance -&gt; Bool
(SyncTolerance -&gt; SyncTolerance -&gt; Bool)
-&gt; (SyncTolerance -&gt; SyncTolerance -&gt; Bool) -&gt; Eq SyncTolerance
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SyncTolerance -&gt; SyncTolerance -&gt; Bool
$c/= :: SyncTolerance -&gt; SyncTolerance -&gt; Bool
== :: SyncTolerance -&gt; SyncTolerance -&gt; Bool
$c== :: SyncTolerance -&gt; SyncTolerance -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682442322"><span id="local-6989586621682442324"><span id="local-6989586621682442326"><span class="annot"><span class="annottext">Int -&gt; SyncTolerance -&gt; ShowS
[SyncTolerance] -&gt; ShowS
SyncTolerance -&gt; String
(Int -&gt; SyncTolerance -&gt; ShowS)
-&gt; (SyncTolerance -&gt; String)
-&gt; ([SyncTolerance] -&gt; ShowS)
-&gt; Show SyncTolerance
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SyncTolerance] -&gt; ShowS
$cshowList :: [SyncTolerance] -&gt; ShowS
show :: SyncTolerance -&gt; String
$cshow :: SyncTolerance -&gt; String
showsPrec :: Int -&gt; SyncTolerance -&gt; ShowS
$cshowsPrec :: Int -&gt; SyncTolerance -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | Construct a 'SyncTolerance' from a number of __seconds__</span><span>
</span><span id="line-83"></span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#mkSyncTolerance"><span class="hs-identifier hs-type">mkSyncTolerance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-type">SyncTolerance</span></a></span><span>
</span><span id="line-84"></span><span id="mkSyncTolerance"><span class="annot"><span class="annottext">mkSyncTolerance :: Int -&gt; SyncTolerance
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#mkSyncTolerance"><span class="hs-identifier hs-var hs-var">mkSyncTolerance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; SyncTolerance
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-var">SyncTolerance</span></a></span><span> </span><span class="annot"><span class="annottext">(NominalDiffTime -&gt; SyncTolerance)
-&gt; (Int -&gt; NominalDiffTime) -&gt; Int -&gt; SyncTolerance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; NominalDiffTime
forall a. Enum a =&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toEnum</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; NominalDiffTime) -&gt; (Int -&gt; Int) -&gt; Int -&gt; NominalDiffTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682442318"><span class="hs-identifier hs-var">pico</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621682442318"><span class="annot"><span class="annottext">pico :: Int
</span><a href="#local-6989586621682442318"><span class="hs-identifier hs-var hs-var">pico</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1_000_000_000_000</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-type">SyncTolerance</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621682442315"><span class="annot"><span class="annottext">toText :: SyncTolerance -&gt; Text
</span><a href="#local-6989586621682442315"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-type">SyncTolerance</span></a></span><span> </span><span id="local-6989586621682442314"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682442314"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682442314"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">FromText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-type">SyncTolerance</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621682442311"><span class="annot"><span class="annottext">fromText :: Text -&gt; Either TextDecodingError SyncTolerance
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TextDecodingError -&gt; TextDecodingError)
-&gt; (NominalDiffTime -&gt; SyncTolerance)
-&gt; Either TextDecodingError NominalDiffTime
-&gt; Either TextDecodingError SyncTolerance
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TextDecodingError -&gt; TextDecodingError -&gt; TextDecodingError
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">TextDecodingError
</span><a href="#local-6989586621682442308"><span class="hs-identifier hs-var">errSyncTolerance</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; SyncTolerance
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-var">SyncTolerance</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TextDecodingError NominalDiffTime
 -&gt; Either TextDecodingError SyncTolerance)
-&gt; (Text -&gt; Either TextDecodingError NominalDiffTime)
-&gt; Text
-&gt; Either TextDecodingError SyncTolerance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either TextDecodingError NominalDiffTime
forall a. FromText a =&gt; Text -&gt; Either TextDecodingError a
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">fromText</span></a></span><span>
</span><span id="line-93"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>        </span><span id="local-6989586621682442308"><span class="annot"><span class="annottext">errSyncTolerance :: TextDecodingError
</span><a href="#local-6989586621682442308"><span class="hs-identifier hs-var hs-var">errSyncTolerance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TextDecodingError
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">TextDecodingError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TextDecodingError) -&gt; String -&gt; TextDecodingError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unwords</span></a></span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot parse given time duration. Here are a few examples of&quot;</span></span><span>
</span><span id="line-96"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;valid text representing a sync tolerance: '3s', '3600s', '42s'.&quot;</span></span><span>
</span><span id="line-97"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Estimate restoration progress based on:</span><span>
</span><span id="line-100"></span><span class="hs-comment">--</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- - The slot of the latest block consumed (our progress)</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- - The slot corresponding to the latest wall-clock time (our target)</span><span>
</span><span id="line-103"></span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- The estimated progress is the quotient of these two quantities.</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- In the Cardano consensus protocol, only a fraction of slots contains blocks.</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- Hence, the progress percentage will often be &lt; 100%,</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- as the slot corresponding to the current wall-clock time</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- may not be filled with a block.</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- The sync tolerance should be large enough to accommodate this issue.</span><span>
</span><span id="line-111"></span><span id="local-6989586621682442305"><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#syncProgress"><span class="hs-identifier hs-type">syncProgress</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682442305"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-type">SyncTolerance</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-comment">-- ^ A time tolerance inside which we consider ourselves synced</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682442305"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-comment">-- ^ Converts slots to actual time.</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-comment">-- ^ Slot of latest block consumed</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">RelativeTime</span></a></span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-comment">-- ^ Current wall clock time</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682442305"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span></span><span>
</span><span id="line-122"></span><span id="syncProgress"><span class="annot"><span class="annottext">syncProgress :: SyncTolerance
-&gt; TimeInterpreter m -&gt; SlotNo -&gt; RelativeTime -&gt; m SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#syncProgress"><span class="hs-identifier hs-var hs-var">syncProgress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncTolerance"><span class="hs-identifier hs-type">SyncTolerance</span></a></span><span> </span><span id="local-6989586621682442304"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682442304"><span class="hs-identifier hs-var">tolerance</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682442303"><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682442303"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682442302"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682442302"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621682442301"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442301"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621682442300"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442300"><span class="hs-identifier hs-var">timeCovered</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; Qry RelativeTime -&gt; m RelativeTime
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682442303"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry RelativeTime -&gt; m RelativeTime)
-&gt; Qry RelativeTime -&gt; m RelativeTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Qry RelativeTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#slotToRelTime"><span class="hs-identifier hs-var">slotToRelTime</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682442302"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682442299"><span class="annot"><span class="annottext">progress :: Ratio Int
</span><a href="#local-6989586621682442299"><span class="hs-identifier hs-var hs-var">progress</span></a></span></span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442301"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; RelativeTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442298"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-126"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; Int
</span><a href="#local-6989586621682442297"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442300"><span class="hs-identifier hs-var">timeCovered</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; Int
</span><a href="#local-6989586621682442297"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442301"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; RelativeTime -&gt; Bool
</span><a href="#local-6989586621682442296"><span class="hs-identifier hs-var">withinTolerance</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442300"><span class="hs-identifier hs-var">timeCovered</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442301"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="annottext">SyncProgress -&gt; m SyncProgress
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Ready"><span class="hs-identifier hs-var">Ready</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">SyncProgress -&gt; m SyncProgress
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">(SyncProgress -&gt; m SyncProgress)
-&gt; (Ratio Int -&gt; SyncProgress) -&gt; Ratio Int -&gt; m SyncProgress
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;percent&quot; Percentage -&gt; SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#Syncing"><span class="hs-identifier hs-var">Syncing</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">(Quantity &quot;percent&quot; Percentage -&gt; SyncProgress)
-&gt; (Ratio Int -&gt; Quantity &quot;percent&quot; Percentage)
-&gt; Ratio Int
-&gt; SyncProgress
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Percentage -&gt; Quantity &quot;percent&quot; Percentage
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">(Percentage -&gt; Quantity &quot;percent&quot; Percentage)
-&gt; (Ratio Int -&gt; Percentage)
-&gt; Ratio Int
-&gt; Quantity &quot;percent&quot; Percentage
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Percentage -&gt; Either MkPercentageError Percentage -&gt; Percentage
forall b a. b -&gt; Either a b -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Percentage
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Percentage) -&gt; String -&gt; Percentage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="#local-6989586621682442294"><span class="hs-identifier hs-var">errMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621682442299"><span class="hs-identifier hs-var">progress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">(Either MkPercentageError Percentage -&gt; Percentage)
-&gt; (Ratio Int -&gt; Either MkPercentageError Percentage)
-&gt; Ratio Int
-&gt; Percentage
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Either MkPercentageError Percentage
</span><a href="Data.Quantity.html#mkPercentage"><span class="hs-identifier hs-var">mkPercentage</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">(Rational -&gt; Either MkPercentageError Percentage)
-&gt; (Ratio Int -&gt; Rational)
-&gt; Ratio Int
-&gt; Either MkPercentageError Percentage
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toRational</span></a></span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="annottext">(Ratio Int -&gt; m SyncProgress) -&gt; Ratio Int -&gt; m SyncProgress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621682442299"><span class="hs-identifier hs-var">progress</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621682442298"><span class="annot"><span class="annottext">start :: RelativeTime
</span><a href="#local-6989586621682442298"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; RelativeTime
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var">RelativeTime</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="#local-6989586621682442297"><span class="hs-identifier hs-type">convert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">RelativeTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621682442297"><span class="annot"><span class="annottext">convert :: RelativeTime -&gt; Int
</span><a href="#local-6989586621682442297"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">round</span></a></span><span> </span><span class="annot"><span class="annottext">(NominalDiffTime -&gt; Int)
-&gt; (RelativeTime -&gt; NominalDiffTime) -&gt; RelativeTime -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NominalDiffTime -&gt; NominalDiffTime)
-&gt; (RelativeTime -&gt; NominalDiffTime)
-&gt; RelativeTime
-&gt; NominalDiffTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; NominalDiffTime
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var hs-var">getRelativeTime</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621682442296"><span class="annot"><span class="annottext">withinTolerance :: RelativeTime -&gt; RelativeTime -&gt; Bool
</span><a href="#local-6989586621682442296"><span class="hs-identifier hs-var hs-var">withinTolerance</span></a></span></span><span> </span><span id="local-6989586621682442290"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442290"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682442289"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442289"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442289"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; RelativeTime -&gt; NominalDiffTime
</span><a href="../../../../ouroboros-consensus/html/src"><span class="hs-operator hs-var">`diffRelTime`</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682442290"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682442304"><span class="hs-identifier hs-var">tolerance</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621682442294"><span class="annot"><span class="annottext">errMsg :: a -&gt; String
</span><a href="#local-6989586621682442294"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span id="local-6989586621682442288"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682442288"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;syncProgress: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682442288"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is out of bounds&quot;</span></span><span>
</span><span id="line-147"></span></pre></body></html>