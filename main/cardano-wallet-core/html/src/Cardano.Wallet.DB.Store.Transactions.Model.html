<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">{- |
Copyright: &#169; 2022 IOHK
License: Apache-2.0

Data type 'TxHistory' for storing a set of transactions.
Transactions are encoded &quot;as&quot; expressed in DB tables.

-}</span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.DB.Store.Transactions.Model</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeltaTxHistory"><span class="hs-identifier">DeltaTxHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier">TxHistory</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier">TxHistoryF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier">TxHistoryF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier">TxRelationF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenCollateralOrd"><span class="hs-identifier">tokenCollateralOrd</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenOutOrd"><span class="hs-identifier">tokenOutOrd</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier">mkTxHistory</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Decoration"><span class="hs-identifier">Decoration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier">WithTxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateWithTxOuts"><span class="hs-identifier">decorateWithTxOuts</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxIn"><span class="hs-identifier">mkTxIn</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateral"><span class="hs-identifier">mkTxCollateral</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOut"><span class="hs-identifier">mkTxOut</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#undecorateFromTxOuts"><span class="hs-identifier">undecorateFromTxOuts</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html"><span class="hs-identifier">Cardano.Wallet.DB.Sqlite.Schema</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier">TxCollateral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOut"><span class="hs-identifier">TxCollateralOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier">TxCollateralOutToken</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier">TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier">TxOutToken</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxWithdrawal"><span class="hs-identifier">TxWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html"><span class="hs-identifier">Cardano.Wallet.DB.Sqlite.Types</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier">TxId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.RewardAccount</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier">RewardAccount</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier">AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier">AssetId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenPolicy</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenName"><span class="hs-identifier">TokenName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier">TokenPolicyId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenQuantity</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier">TokenQuantity</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Arrow</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;&amp;&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.Delta</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Delta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fold</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">toList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">sortOn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word32</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">build</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenBundle</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | A context that carries a TxOut together with its tokens</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- (this will be needed in the future for the DB Layer</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- to reconstruct 'TransactionInfo').</span><span>
</span><span id="line-88"></span><span class="hs-keyword">data</span><span> </span><span id="WithTxOut"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-var">WithTxOut</span></a></span></span><span> </span><span id="local-6989586621682457275"><span class="annot"><a href="#local-6989586621682457275"><span class="hs-identifier hs-type">txin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WithTxOut"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-var">WithTxOut</span></a></span></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtxIn%3AWithTxOut"><span class="annot"><span class="annottext">WithTxOut txin -&gt; txin
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AtxIn%3AWithTxOut"><span class="hs-identifier hs-var hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682457275"><span class="hs-identifier hs-type">txin</span></a></span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acontext%3AWithTxOut"><span class="annot"><span class="annottext">WithTxOut txin -&gt; Maybe (TxOut, [TxOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Acontext%3AWithTxOut"><span class="hs-identifier hs-var hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621682457245"><span id="local-6989586621682457247"><span id="local-6989586621682457249"><span class="annot"><span class="annottext">Int -&gt; WithTxOut txin -&gt; ShowS
[WithTxOut txin] -&gt; ShowS
WithTxOut txin -&gt; String
(Int -&gt; WithTxOut txin -&gt; ShowS)
-&gt; (WithTxOut txin -&gt; String)
-&gt; ([WithTxOut txin] -&gt; ShowS)
-&gt; Show (WithTxOut txin)
forall txin. Show txin =&gt; Int -&gt; WithTxOut txin -&gt; ShowS
forall txin. Show txin =&gt; [WithTxOut txin] -&gt; ShowS
forall txin. Show txin =&gt; WithTxOut txin -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WithTxOut txin] -&gt; ShowS
$cshowList :: forall txin. Show txin =&gt; [WithTxOut txin] -&gt; ShowS
show :: WithTxOut txin -&gt; String
$cshow :: forall txin. Show txin =&gt; WithTxOut txin -&gt; String
showsPrec :: Int -&gt; WithTxOut txin -&gt; ShowS
$cshowsPrec :: forall txin. Show txin =&gt; Int -&gt; WithTxOut txin -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682457240"><span id="local-6989586621682457242"><span class="annot"><span class="annottext">WithTxOut txin -&gt; WithTxOut txin -&gt; Bool
(WithTxOut txin -&gt; WithTxOut txin -&gt; Bool)
-&gt; (WithTxOut txin -&gt; WithTxOut txin -&gt; Bool)
-&gt; Eq (WithTxOut txin)
forall txin. Eq txin =&gt; WithTxOut txin -&gt; WithTxOut txin -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: WithTxOut txin -&gt; WithTxOut txin -&gt; Bool
$c/= :: forall txin. Eq txin =&gt; WithTxOut txin -&gt; WithTxOut txin -&gt; Bool
== :: WithTxOut txin -&gt; WithTxOut txin -&gt; Bool
$c== :: forall txin. Eq txin =&gt; WithTxOut txin -&gt; WithTxOut txin -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682457235"><span id="local-6989586621682457237"><span class="annot"><span class="annottext">a -&gt; WithTxOut b -&gt; WithTxOut a
(a -&gt; b) -&gt; WithTxOut a -&gt; WithTxOut b
(forall a b. (a -&gt; b) -&gt; WithTxOut a -&gt; WithTxOut b)
-&gt; (forall a b. a -&gt; WithTxOut b -&gt; WithTxOut a)
-&gt; Functor WithTxOut
forall a b. a -&gt; WithTxOut b -&gt; WithTxOut a
forall a b. (a -&gt; b) -&gt; WithTxOut a -&gt; WithTxOut b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; WithTxOut b -&gt; WithTxOut a
$c&lt;$ :: forall a b. a -&gt; WithTxOut b -&gt; WithTxOut a
fmap :: (a -&gt; b) -&gt; WithTxOut a -&gt; WithTxOut b
$cfmap :: forall a b. (a -&gt; b) -&gt; WithTxOut a -&gt; WithTxOut b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- | A kind to index the 2 flavours of a 'TxRelationF', with or without 'TxOuts'</span><span>
</span><span id="line-93"></span><span class="hs-keyword">data</span><span> </span><span id="Decoration"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Decoration"><span class="hs-identifier hs-var">Decoration</span></a></span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Without"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-var">Without</span></a></span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="With"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-var">With</span></a></span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | Define the TxOut context type</span><span>
</span><span id="line-98"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="DecorateWithTxOut"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-var">DecorateWithTxOut</span></a></span></span><span> </span><span id="local-6989586621682457233"><span class="annot"><a href="#local-6989586621682457233"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621682457232"><span class="annot"><a href="#local-6989586621682457232"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="DecorateWithTxOut"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-var">DecorateWithTxOut</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span> </span><span id="local-6989586621682457231"><span class="annot"><a href="#local-6989586621682457231"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682457231"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span id="DecorateWithTxOut"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-var">DecorateWithTxOut</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-type">With</span></a></span><span> </span><span id="local-6989586621682457230"><span class="annot"><a href="#local-6989586621682457230"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-type">WithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457230"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">{- | A low level definition of a transaction covering all transaction content
 by collecting all related-to-index database rows.
 Normalization is performed anyway after the first relation level.
 All values used here are records in the database.
 Foreign keys are used to group data correctly,
 but they are not removed from the data.
-}</span><span>
</span><span id="line-109"></span><span id="local-6989586621682457228"><span id="local-6989586621682457229"></span></span><span class="hs-keyword">data</span><span> </span><span id="TxRelationF"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-var">TxRelationF</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457301"><span class="annot"><a href="#local-6989586621682457301"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Decoration"><span class="hs-identifier hs-type">Decoration</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>    </span><span id="TxRelationF"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-var">TxRelationF</span></a></span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Ains%3ATxRelationF"><span class="annot"><span class="annottext">TxRelationF f -&gt; [DecorateWithTxOut f TxIn]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Ains%3ATxRelationF"><span class="hs-identifier hs-var hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457301"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcollateralIns%3ATxRelationF"><span class="annot"><span class="annottext">TxRelationF f -&gt; [DecorateWithTxOut f TxCollateral]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralIns%3ATxRelationF"><span class="hs-identifier hs-var hs-var">collateralIns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457301"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aouts%3ATxRelationF"><span class="annot"><span class="annottext">TxRelationF f -&gt; [(TxOut, [TxOutToken])]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Aouts%3ATxRelationF"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcollateralOuts%3ATxRelationF"><span class="annot"><span class="annottext">TxRelationF f -&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralOuts%3ATxRelationF"><span class="hs-identifier hs-var hs-var">collateralOuts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOut"><span class="hs-identifier hs-type">TxCollateralOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier hs-type">TxCollateralOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Awithdrawals%3ATxRelationF"><span class="annot"><span class="annottext">TxRelationF f -&gt; [TxWithdrawal]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Awithdrawals%3ATxRelationF"><span class="hs-identifier hs-var hs-var">withdrawals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxWithdrawal"><span class="hs-identifier hs-type">TxWithdrawal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(forall x. TxRelationF f -&gt; Rep (TxRelationF f) x)
-&gt; (forall x. Rep (TxRelationF f) x -&gt; TxRelationF f)
-&gt; Generic (TxRelationF f)
forall x. Rep (TxRelationF f) x -&gt; TxRelationF f
forall x. TxRelationF f -&gt; Rep (TxRelationF f) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (f :: Decoration) x. Rep (TxRelationF f) x -&gt; TxRelationF f
forall (f :: Decoration) x. TxRelationF f -&gt; Rep (TxRelationF f) x
$cto :: forall (f :: Decoration) x. Rep (TxRelationF f) x -&gt; TxRelationF f
$cfrom :: forall (f :: Decoration) x. TxRelationF f -&gt; Rep (TxRelationF f) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span id="local-6989586621682457214"><span id="local-6989586621682457216"><span id="local-6989586621682457218"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457218"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457218"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457218"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621682457207"><span id="local-6989586621682457209"><span id="local-6989586621682457211"><span id="local-6989586621682457213"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457213"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457213"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457213"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Transactions history is 'TxRelationF's indexed by 'TxId'</span><span>
</span><span id="line-128"></span><span id="local-6989586621682457205"><span id="local-6989586621682457206"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="TxHistoryF"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span></span><span> </span><span id="local-6989586621682457351"><span class="annot"><a href="#local-6989586621682457351"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>    </span><span id="TxHistoryF"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Arelations%3ATxHistoryF"><span class="annot"><span class="annottext">TxHistoryF f -&gt; Map TxId (TxRelationF f)
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Arelations%3ATxHistoryF"><span class="hs-identifier hs-var hs-var">relations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457351"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(forall x. TxHistoryF f -&gt; Rep (TxHistoryF f) x)
-&gt; (forall x. Rep (TxHistoryF f) x -&gt; TxHistoryF f)
-&gt; Generic (TxHistoryF f)
forall x. Rep (TxHistoryF f) x -&gt; TxHistoryF f
forall x. TxHistoryF f -&gt; Rep (TxHistoryF f) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (f :: Decoration) x. Rep (TxHistoryF f) x -&gt; TxHistoryF f
forall (f :: Decoration) x. TxHistoryF f -&gt; Rep (TxHistoryF f) x
$cto :: forall (f :: Decoration) x. Rep (TxHistoryF f) x -&gt; TxHistoryF f
$cfrom :: forall (f :: Decoration) x. TxHistoryF f -&gt; Rep (TxHistoryF f) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span id="local-6989586621682457197"><span id="local-6989586621682457199"><span id="local-6989586621682457201"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457201"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457201"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457201"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span id="local-6989586621682457190"><span id="local-6989586621682457192"><span id="local-6989586621682457194"><span id="local-6989586621682457196"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457196"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457196"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457196"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span id="local-6989586621682457189"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682457183"><span id="local-6989586621682457185"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457189"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621682457181"><span class="annot"><span class="annottext">mempty :: TxHistoryF f
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF f) -&gt; TxHistoryF f
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF f)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span id="local-6989586621682457180"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682457175"><span id="local-6989586621682457177"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457180"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682457173"><span class="annot"><span class="annottext">Map TxId (TxRelationF f)
</span><a href="#local-6989586621682457173"><span class="hs-identifier hs-var">h1</span></a></span></span><span> </span><span id="local-6989586621682457172"><span class="annot"><span class="annottext">&lt;&gt; :: TxHistoryF f -&gt; TxHistoryF f -&gt; TxHistoryF f
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682457171"><span class="annot"><span class="annottext">Map TxId (TxRelationF f)
</span><a href="#local-6989586621682457171"><span class="hs-identifier hs-var">h2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Map TxId (TxRelationF f) -&gt; TxHistoryF f
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF f) -&gt; TxHistoryF f)
-&gt; Map TxId (TxRelationF f) -&gt; TxHistoryF f
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF f)
</span><a href="#local-6989586621682457173"><span class="hs-identifier hs-var">h1</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF f)
-&gt; Map TxId (TxRelationF f) -&gt; Map TxId (TxRelationF f)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF f)
</span><a href="#local-6989586621682457171"><span class="hs-identifier hs-var">h2</span></a></span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621682457170"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457170"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DecorateWithTxOut"><span class="hs-identifier hs-type">DecorateWithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457170"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457170"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621682457167"><span class="annot"><span class="annottext">build :: TxHistoryF f -&gt; Builder
</span><a href="#local-6989586621682457167"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621682457166"><span class="annot"><span class="annottext">TxHistoryF f
</span><a href="#local-6989586621682457166"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;TxHistory &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxId (TxRelationF f) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF f) -&gt; String)
-&gt; Map TxId (TxRelationF f) -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxHistoryF f -&gt; Map TxId (TxRelationF f)
forall (f :: Decoration). TxHistoryF f -&gt; Map TxId (TxRelationF f)
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Arelations%3ATxHistoryF"><span class="hs-identifier hs-var hs-var">relations</span></a></span><span> </span><span class="annot"><span class="annottext">TxHistoryF f
</span><a href="#local-6989586621682457166"><span class="hs-identifier hs-var">txs</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- | Shortcut type for transaction history where inputs are not</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- decorated with their corresponding `TxOut`.</span><span>
</span><span id="line-154"></span><span class="hs-keyword">type</span><span> </span><span id="TxHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier hs-var">TxHistory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Verbs to change a 'TxHistory'.</span><span>
</span><span id="line-157"></span><span id="local-6989586621682457163"><span id="local-6989586621682457164"></span></span><span class="hs-keyword">data</span><span> </span><span id="DeltaTxHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeltaTxHistory"><span class="hs-identifier hs-var">DeltaTxHistory</span></a></span></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Append"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Append"><span class="hs-identifier hs-var">Append</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier hs-type">TxHistory</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- ^ Add new set of transactions.</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- Overwrites transactions whose id is already present in the 'TxHistory'.</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DeleteTx"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeleteTx"><span class="hs-identifier hs-var">DeleteTx</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- ^ Try to remove the transaction at the given transaction id.</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621682457155"><span id="local-6989586621682457157"><span id="local-6989586621682457159"><span class="annot"><span class="annottext">Int -&gt; DeltaTxHistory -&gt; ShowS
[DeltaTxHistory] -&gt; ShowS
DeltaTxHistory -&gt; String
(Int -&gt; DeltaTxHistory -&gt; ShowS)
-&gt; (DeltaTxHistory -&gt; String)
-&gt; ([DeltaTxHistory] -&gt; ShowS)
-&gt; Show DeltaTxHistory
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DeltaTxHistory] -&gt; ShowS
$cshowList :: [DeltaTxHistory] -&gt; ShowS
show :: DeltaTxHistory -&gt; String
$cshow :: DeltaTxHistory -&gt; String
showsPrec :: Int -&gt; DeltaTxHistory -&gt; ShowS
$cshowsPrec :: Int -&gt; DeltaTxHistory -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682457151"><span id="local-6989586621682457153"><span class="annot"><span class="annottext">DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool
(DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool)
-&gt; (DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool) -&gt; Eq DeltaTxHistory
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool
$c/= :: DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool
== :: DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool
$c== :: DeltaTxHistory -&gt; DeltaTxHistory -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. DeltaTxHistory -&gt; Rep DeltaTxHistory x)
-&gt; (forall x. Rep DeltaTxHistory x -&gt; DeltaTxHistory)
-&gt; Generic DeltaTxHistory
forall x. Rep DeltaTxHistory x -&gt; DeltaTxHistory
forall x. DeltaTxHistory -&gt; Rep DeltaTxHistory x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep DeltaTxHistory x -&gt; DeltaTxHistory
$cfrom :: forall x. DeltaTxHistory -&gt; Rep DeltaTxHistory x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeltaTxHistory"><span class="hs-identifier hs-type">DeltaTxHistory</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621682457147"><span class="annot"><span class="annottext">build :: DeltaTxHistory -&gt; Builder
</span><a href="#local-6989586621682457147"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621682457146"><span class="annot"><span class="annottext">DeltaTxHistory
</span><a href="#local-6989586621682457146"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Builder) -&gt; String -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaTxHistory -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaTxHistory
</span><a href="#local-6989586621682457146"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeltaTxHistory"><span class="hs-identifier hs-type">DeltaTxHistory</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeltaTxHistory"><span class="hs-identifier hs-type">DeltaTxHistory</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier hs-type">TxHistory</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- transactions are immutable so here there should happen no rewriting</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- but we mimic the repsert in the store</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621682457143"><span class="annot"><span class="annottext">apply :: DeltaTxHistory -&gt; Base DeltaTxHistory -&gt; Base DeltaTxHistory
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">apply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Append"><span class="hs-identifier hs-type">Append</span></a></span><span> </span><span id="local-6989586621682457141"><span class="annot"><span class="annottext">TxHistory
</span><a href="#local-6989586621682457141"><span class="hs-identifier hs-var">txs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682457140"><span class="annot"><span class="annottext">Base DeltaTxHistory
</span><a href="#local-6989586621682457140"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxHistory
</span><a href="#local-6989586621682457141"><span class="hs-identifier hs-var">txs</span></a></span><span> </span><span class="annot"><span class="annottext">TxHistory -&gt; TxHistory -&gt; TxHistory
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Base DeltaTxHistory
TxHistory
</span><a href="#local-6989586621682457140"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#DeleteTx"><span class="hs-identifier hs-type">DeleteTx</span></a></span><span> </span><span id="local-6989586621682457139"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457139"><span class="hs-identifier hs-var">tid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682457138"><span class="annot"><a href="#local-6989586621682457138"><span class="hs-identifier hs-var">txs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'Without) -&gt; TxHistory)
-&gt; Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
-&gt; Map TxId (TxRelationF 'Without)
-&gt; Map TxId (TxRelationF 'Without)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.delete</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457139"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682457138"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxIn"><span class="hs-identifier hs-type">mkTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">W.TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">W.Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-177"></span><span id="mkTxIn"><span class="annot"><span class="annottext">mkTxIn :: TxId -&gt; (Int, (TxIn, Coin)) -&gt; TxIn
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxIn"><span class="hs-identifier hs-var hs-var">mkTxIn</span></a></span></span><span> </span><span id="local-6989586621682457136"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457136"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682457135"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621682457134"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457134"><span class="hs-identifier hs-var">txIn</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457133"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682457133"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">TxIn :: TxId -&gt; Int -&gt; TxId -&gt; Word32 -&gt; Coin -&gt; TxIn
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txInputTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputTxId"><span class="hs-identifier hs-var">txInputTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457136"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txInputOrder :: Int
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputOrder"><span class="hs-identifier hs-var">txInputOrder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682457135"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txInputSourceTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceTxId"><span class="hs-identifier hs-var">txInputSourceTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-var">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputId%3ATxIn"><span class="hs-identifier hs-var hs-var">W.inputId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457134"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txInputSourceIndex :: Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceIndex"><span class="hs-identifier hs-var">txInputSourceIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputIx%3ATxIn"><span class="hs-identifier hs-var hs-var">W.inputIx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457134"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txInputSourceAmount :: Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceAmount"><span class="hs-identifier hs-var">txInputSourceAmount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682457133"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateral"><span class="hs-identifier hs-type">mkTxCollateral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">W.TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">W.Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span>
</span><span id="line-189"></span><span id="mkTxCollateral"><span class="annot"><span class="annottext">mkTxCollateral :: TxId -&gt; (Int, (TxIn, Coin)) -&gt; TxCollateral
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateral"><span class="hs-identifier hs-var hs-var">mkTxCollateral</span></a></span></span><span> </span><span id="local-6989586621682457124"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457124"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457123"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682457123"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621682457122"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457122"><span class="hs-identifier hs-var">txCollateral</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457121"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682457121"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">TxCollateral :: TxId -&gt; Int -&gt; TxId -&gt; Word32 -&gt; Coin -&gt; TxCollateral
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier hs-type">TxCollateral</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txCollateralTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralTxId"><span class="hs-identifier hs-var">txCollateralTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457124"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralOrder :: Int
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOrder"><span class="hs-identifier hs-var">txCollateralOrder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682457123"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralSourceTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceTxId"><span class="hs-identifier hs-var">txCollateralSourceTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-var">TxId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;Tx&quot; -&gt; TxId) -&gt; Hash &quot;Tx&quot; -&gt; TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputId%3ATxIn"><span class="hs-identifier hs-var hs-var">W.inputId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457122"><span class="hs-identifier hs-var">txCollateral</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralSourceIndex :: Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceIndex"><span class="hs-identifier hs-var">txCollateralSourceIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputIx%3ATxIn"><span class="hs-identifier hs-var hs-var">W.inputIx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457122"><span class="hs-identifier hs-var">txCollateral</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralSourceAmount :: Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceAmount"><span class="hs-identifier hs-var">txCollateralSourceAmount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682457121"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- The key to sort TxCollateralOutToken</span><span>
</span><span id="line-199"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenCollateralOrd"><span class="hs-identifier hs-type">tokenCollateralOrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier hs-type">TxCollateralOutToken</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier hs-type">TokenPolicyId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenName"><span class="hs-identifier hs-type">TokenName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span id="tokenCollateralOrd"><span class="annot"><span class="annottext">tokenCollateralOrd :: TxCollateralOutToken -&gt; (TokenPolicyId, TokenName)
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenCollateralOrd"><span class="hs-identifier hs-var hs-var">tokenCollateralOrd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; TokenPolicyId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenPolicyId"><span class="hs-identifier hs-var hs-var">txCollateralOutTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(TxCollateralOutToken -&gt; TokenPolicyId)
-&gt; (TxCollateralOutToken -&gt; TokenName)
-&gt; TxCollateralOutToken
-&gt; (TokenPolicyId, TokenName)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; TokenName
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenName"><span class="hs-identifier hs-var hs-var">txCollateralOutTokenName</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- The key to sort TxOutToken</span><span>
</span><span id="line-203"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenOutOrd"><span class="hs-identifier hs-type">tokenOutOrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier hs-type">TokenPolicyId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenName"><span class="hs-identifier hs-type">TokenName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span id="tokenOutOrd"><span class="annot"><span class="annottext">tokenOutOrd :: TxOutToken -&gt; (TokenPolicyId, TokenName)
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenOutOrd"><span class="hs-identifier hs-var hs-var">tokenOutOrd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutToken -&gt; TokenPolicyId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenPolicyId"><span class="hs-identifier hs-var hs-var">txOutTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutToken -&gt; TokenPolicyId)
-&gt; (TxOutToken -&gt; TokenName)
-&gt; TxOutToken
-&gt; (TokenPolicyId, TokenName)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutToken -&gt; TokenName
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenName"><span class="hs-identifier hs-var hs-var">txOutTokenName</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOut"><span class="hs-identifier hs-type">mkTxOut</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">W.TxOut</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (index, txout)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span id="mkTxOut"><span class="annot"><span class="annottext">mkTxOut :: TxId -&gt; (Word32, TxOut) -&gt; (TxOut, [TxOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOut"><span class="hs-identifier hs-var hs-var">mkTxOut</span></a></span></span><span> </span><span id="local-6989586621682457110"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457110"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457109"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457109"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457108"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457108"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457107"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxOutToken -&gt; (TokenPolicyId, TokenName))
-&gt; [TxOutToken] -&gt; [TxOutToken]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sortOn</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutToken -&gt; (TokenPolicyId, TokenName)
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenOutOrd"><span class="hs-identifier hs-var">tokenOutOrd</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOutToken]
</span><a href="#local-6989586621682457106"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621682457107"><span class="annot"><span class="annottext">out :: TxOut
</span><a href="#local-6989586621682457107"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="annottext">TxOut :: TxId -&gt; Word32 -&gt; Address -&gt; Coin -&gt; TxOut
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txOutputTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputTxId"><span class="hs-identifier hs-var">txOutputTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457110"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutputIndex :: Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputIndex"><span class="hs-identifier hs-var">txOutputIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457109"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutputAddress :: Address
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputAddress"><span class="hs-identifier hs-var">txOutputAddress</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; TxOut -&gt; Const Address TxOut)
-&gt; TxOut -&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; TxOut -&gt; Const Address TxOut)
(Address -&gt; Const Address Address) -&gt; TxOut -&gt; Const Address TxOut
</span><a href="#local-6989586621682457101"><span class="hs-var">#address</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457108"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutputAmount :: Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputAmount"><span class="hs-identifier hs-var">txOutputAmount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier hs-var">W.txOutCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457108"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621682457106"><span class="annot"><span class="annottext">tokens :: [TxOutToken]
</span><a href="#local-6989586621682457106"><span class="hs-identifier hs-var hs-var">tokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><span class="annottext">TxId -&gt; Word32 -&gt; (AssetId, TokenQuantity) -&gt; TxOutToken
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOutToken"><span class="hs-identifier hs-var">mkTxOutToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457110"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457109"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">((AssetId, TokenQuantity) -&gt; TxOutToken)
-&gt; [(AssetId, TokenQuantity)] -&gt; [TxOutToken]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin, [(AssetId, TokenQuantity)]) -&gt; [(AssetId, TokenQuantity)]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; (Coin, [(AssetId, TokenQuantity)])
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#toFlatList"><span class="hs-identifier hs-var">TokenBundle.toFlatList</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; (Coin, [(AssetId, TokenQuantity)]))
-&gt; TokenBundle -&gt; (Coin, [(AssetId, TokenQuantity)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; TxOut -&gt; Const TokenBundle TxOut)
-&gt; TxOut -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; TxOut -&gt; Const TokenBundle TxOut)
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; TxOut -&gt; Const TokenBundle TxOut
</span><a href="#local-6989586621682457095"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457108"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOutToken"><span class="hs-identifier hs-type">mkTxOutToken</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span> </span><span class="hs-comment">-- ^ index</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">AssetId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier hs-type">TokenQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span>
</span><span id="line-228"></span><span id="mkTxOutToken"><span class="annot"><span class="annottext">mkTxOutToken :: TxId -&gt; Word32 -&gt; (AssetId, TokenQuantity) -&gt; TxOutToken
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOutToken"><span class="hs-identifier hs-var hs-var">mkTxOutToken</span></a></span></span><span> </span><span id="local-6989586621682457094"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457094"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span id="local-6989586621682457093"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457093"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">AssetId</span></a></span><span> </span><span id="local-6989586621682457092"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682457092"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span id="local-6989586621682457091"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682457091"><span class="hs-identifier hs-var">token</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457090"><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682457090"><span class="hs-identifier hs-var">quantity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">TxOutToken :: TxId
-&gt; Word32
-&gt; TokenPolicyId
-&gt; TokenName
-&gt; TokenQuantity
-&gt; TxOutToken
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txOutTokenTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenTxId"><span class="hs-identifier hs-var">txOutTokenTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457094"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutTokenTxIndex :: Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenTxIndex"><span class="hs-identifier hs-var">txOutTokenTxIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457093"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutTokenPolicyId :: TokenPolicyId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenPolicyId"><span class="hs-identifier hs-var">txOutTokenPolicyId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682457092"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutTokenName :: TokenName
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenName"><span class="hs-identifier hs-var">txOutTokenName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682457091"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOutTokenQuantity :: TokenQuantity
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenQuantity"><span class="hs-identifier hs-var">txOutTokenQuantity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682457090"><span class="hs-identifier hs-var">quantity</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateralOut"><span class="hs-identifier hs-type">mkTxCollateralOut</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">W.TxOut</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOut"><span class="hs-identifier hs-type">TxCollateralOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier hs-type">TxCollateralOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span id="mkTxCollateralOut"><span class="annot"><span class="annottext">mkTxCollateralOut :: TxId -&gt; TxOut -&gt; (TxCollateralOut, [TxCollateralOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateralOut"><span class="hs-identifier hs-var hs-var">mkTxCollateralOut</span></a></span></span><span> </span><span id="local-6989586621682457084"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457084"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span id="local-6989586621682457083"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457083"><span class="hs-identifier hs-var">txCollateralOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateralOut
</span><a href="#local-6989586621682457082"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxCollateralOutToken -&gt; (TokenPolicyId, TokenName))
-&gt; [TxCollateralOutToken] -&gt; [TxCollateralOutToken]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sortOn</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; (TokenPolicyId, TokenName)
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#tokenCollateralOrd"><span class="hs-identifier hs-var">tokenCollateralOrd</span></a></span><span> </span><span class="annot"><span class="annottext">[TxCollateralOutToken]
</span><a href="#local-6989586621682457081"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621682457082"><span class="annot"><span class="annottext">out :: TxCollateralOut
</span><a href="#local-6989586621682457082"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">TxCollateralOut :: TxId -&gt; Address -&gt; Coin -&gt; TxCollateralOut
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOut"><span class="hs-identifier hs-type">TxCollateralOut</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txCollateralOutTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTxId"><span class="hs-identifier hs-var">txCollateralOutTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457084"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralOutAddress :: Address
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutAddress"><span class="hs-identifier hs-var">txCollateralOutAddress</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; TxOut -&gt; Const Address TxOut)
-&gt; TxOut -&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; TxOut -&gt; Const Address TxOut)
(Address -&gt; Const Address Address) -&gt; TxOut -&gt; Const Address TxOut
</span><a href="#local-6989586621682457077"><span class="hs-var">#address</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457083"><span class="hs-identifier hs-var">txCollateralOut</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralOutAmount :: Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutAmount"><span class="hs-identifier hs-var">txCollateralOutAmount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier hs-var">W.txOutCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457083"><span class="hs-identifier hs-var">txCollateralOut</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621682457081"><span class="annot"><span class="annottext">tokens :: [TxCollateralOutToken]
</span><a href="#local-6989586621682457081"><span class="hs-identifier hs-var hs-var">tokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><span class="annottext">TxId -&gt; (AssetId, TokenQuantity) -&gt; TxCollateralOutToken
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateralOutToken"><span class="hs-identifier hs-var">mkTxCollateralOutToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457084"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">((AssetId, TokenQuantity) -&gt; TxCollateralOutToken)
-&gt; [(AssetId, TokenQuantity)] -&gt; [TxCollateralOutToken]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin, [(AssetId, TokenQuantity)]) -&gt; [(AssetId, TokenQuantity)]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; (Coin, [(AssetId, TokenQuantity)])
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#toFlatList"><span class="hs-identifier hs-var">TokenBundle.toFlatList</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; (Coin, [(AssetId, TokenQuantity)]))
-&gt; TokenBundle -&gt; (Coin, [(AssetId, TokenQuantity)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; TxOut -&gt; Const TokenBundle TxOut)
-&gt; TxOut -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; TxOut -&gt; Const TokenBundle TxOut)
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; TxOut -&gt; Const TokenBundle TxOut
</span><a href="#local-6989586621682457074"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457083"><span class="hs-identifier hs-var">txCollateralOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateralOutToken"><span class="hs-identifier hs-type">mkTxCollateralOutToken</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">AssetId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier hs-type">TokenQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier hs-type">TxCollateralOutToken</span></a></span><span>
</span><span id="line-255"></span><span id="mkTxCollateralOutToken"><span class="annot"><span class="annottext">mkTxCollateralOutToken :: TxId -&gt; (AssetId, TokenQuantity) -&gt; TxCollateralOutToken
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateralOutToken"><span class="hs-identifier hs-var hs-var">mkTxCollateralOutToken</span></a></span></span><span> </span><span id="local-6989586621682457073"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457073"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">AssetId</span></a></span><span> </span><span id="local-6989586621682457072"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682457072"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span id="local-6989586621682457071"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682457071"><span class="hs-identifier hs-var">token</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457070"><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682457070"><span class="hs-identifier hs-var">quantity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">TxCollateralOutToken :: TxId
-&gt; TokenPolicyId
-&gt; TokenName
-&gt; TokenQuantity
-&gt; TxCollateralOutToken
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier hs-type">TxCollateralOutToken</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txCollateralOutTokenTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenTxId"><span class="hs-identifier hs-var">txCollateralOutTokenTxId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457073"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralOutTokenPolicyId :: TokenPolicyId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenPolicyId"><span class="hs-identifier hs-var">txCollateralOutTokenPolicyId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682457072"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralOutTokenName :: TokenName
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenName"><span class="hs-identifier hs-var">txCollateralOutTokenName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682457071"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCollateralOutTokenQuantity :: TokenQuantity
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenQuantity"><span class="hs-identifier hs-var">txCollateralOutTokenQuantity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682457070"><span class="hs-identifier hs-var">quantity</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxWithdrawal"><span class="hs-identifier hs-type">mkTxWithdrawal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">W.Coin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxWithdrawal"><span class="hs-identifier hs-type">TxWithdrawal</span></a></span><span>
</span><span id="line-264"></span><span id="mkTxWithdrawal"><span class="annot"><span class="annottext">mkTxWithdrawal :: TxId -&gt; (RewardAccount, Coin) -&gt; TxWithdrawal
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxWithdrawal"><span class="hs-identifier hs-var hs-var">mkTxWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682457065"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457065"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457064"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682457064"><span class="hs-identifier hs-var">txWithdrawalAccount</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457063"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682457063"><span class="hs-identifier hs-var">txWithdrawalAmount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">TxWithdrawal :: TxId -&gt; Coin -&gt; RewardAccount -&gt; TxWithdrawal
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxWithdrawal"><span class="hs-identifier hs-type">TxWithdrawal</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TxId
txWithdrawalTxId :: TxId
txWithdrawalTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txWithdrawalTxId"><span class="hs-identifier hs-var hs-var">txWithdrawalTxId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccount
txWithdrawalAccount :: RewardAccount
txWithdrawalAccount :: RewardAccount
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txWithdrawalAccount"><span class="hs-identifier hs-var hs-var">txWithdrawalAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
txWithdrawalAmount :: Coin
txWithdrawalAmount :: Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txWithdrawalAmount"><span class="hs-identifier hs-var hs-var">txWithdrawalAmount</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621682457061"><span class="annot"><span class="annottext">txWithdrawalTxId :: TxId
</span><a href="#local-6989586621682457061"><span class="hs-identifier hs-var hs-var">txWithdrawalTxId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457065"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxRelation"><span class="hs-identifier hs-type">mkTxRelation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">W.Tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span>
</span><span id="line-270"></span><span id="mkTxRelation"><span class="annot"><span class="annottext">mkTxRelation :: Tx -&gt; TxRelationF 'Without
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxRelation"><span class="hs-identifier hs-var hs-var">mkTxRelation</span></a></span></span><span> </span><span id="local-6989586621682457056"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="annottext">TxRelationF :: forall (f :: Decoration).
[DecorateWithTxOut f TxIn]
-&gt; [DecorateWithTxOut f TxCollateral]
-&gt; [(TxOut, [TxOutToken])]
-&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
-&gt; [TxWithdrawal]
-&gt; TxRelationF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:ins:TxRelationF :: [DecorateWithTxOut 'Without TxIn]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Ains%3ATxRelationF"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, (TxIn, Coin)) -&gt; TxIn) -&gt; [(Int, (TxIn, Coin))] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxId -&gt; (Int, (TxIn, Coin)) -&gt; TxIn
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxIn"><span class="hs-identifier hs-var">mkTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457055"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, (TxIn, Coin))] -&gt; [TxIn])
-&gt; [(Int, (TxIn, Coin))] -&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)] -&gt; [(Int, (TxIn, Coin))]
forall a b. (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]
</span><a href="#local-6989586621682457054"><span class="hs-identifier hs-var">indexed</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, Coin)] -&gt; [(Int, (TxIn, Coin))])
-&gt; (Tx -&gt; [(TxIn, Coin)]) -&gt; Tx -&gt; [(Int, (TxIn, Coin))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [(TxIn, Coin)]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AresolvedInputs%3ATx"><span class="hs-identifier hs-var hs-var">W.resolvedInputs</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx -&gt; [(Int, (TxIn, Coin))]) -&gt; Tx -&gt; [(Int, (TxIn, Coin))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralIns:TxRelationF :: [DecorateWithTxOut 'Without TxCollateral]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralIns%3ATxRelationF"><span class="hs-identifier hs-var">collateralIns</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><span class="annottext">((Int, (TxIn, Coin)) -&gt; TxCollateral)
-&gt; [(Int, (TxIn, Coin))] -&gt; [TxCollateral]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxId -&gt; (Int, (TxIn, Coin)) -&gt; TxCollateral
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateral"><span class="hs-identifier hs-var">mkTxCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457055"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, (TxIn, Coin))] -&gt; [TxCollateral])
-&gt; [(Int, (TxIn, Coin))] -&gt; [TxCollateral]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)] -&gt; [(Int, (TxIn, Coin))]
forall a b. (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]
</span><a href="#local-6989586621682457054"><span class="hs-identifier hs-var">indexed</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, Coin)] -&gt; [(Int, (TxIn, Coin))])
-&gt; [(TxIn, Coin)] -&gt; [(Int, (TxIn, Coin))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [(TxIn, Coin)]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AresolvedCollateralInputs%3ATx"><span class="hs-identifier hs-var hs-var">W.resolvedCollateralInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outs:TxRelationF :: [(TxOut, [TxOutToken])]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Aouts%3ATxRelationF"><span class="hs-identifier hs-var">outs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word32, TxOut) -&gt; (TxOut, [TxOutToken]))
-&gt; [(Word32, TxOut)] -&gt; [(TxOut, [TxOutToken])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxId -&gt; (Word32, TxOut) -&gt; (TxOut, [TxOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxOut"><span class="hs-identifier hs-var">mkTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457055"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Word32, TxOut)] -&gt; [(TxOut, [TxOutToken])])
-&gt; [(Word32, TxOut)] -&gt; [(TxOut, [TxOutToken])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut] -&gt; [(Word32, TxOut)]
forall a b. (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]
</span><a href="#local-6989586621682457054"><span class="hs-identifier hs-var">indexed</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; [(Word32, TxOut)]) -&gt; [TxOut] -&gt; [(Word32, TxOut)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [TxOut]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aoutputs%3ATx"><span class="hs-identifier hs-var hs-var">W.outputs</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralOuts:TxRelationF :: Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralOuts%3ATxRelationF"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxOut -&gt; (TxCollateralOut, [TxCollateralOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxCollateralOut"><span class="hs-identifier hs-var">mkTxCollateralOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457055"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; (TxCollateralOut, [TxCollateralOutToken]))
-&gt; Maybe TxOut -&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Maybe TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AcollateralOutput%3ATx"><span class="hs-identifier hs-var hs-var">W.collateralOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:TxRelationF :: [TxWithdrawal]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Awithdrawals%3ATxRelationF"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>          </span><span class="annot"><span class="annottext">((RewardAccount, Coin) -&gt; TxWithdrawal)
-&gt; [(RewardAccount, Coin)] -&gt; [TxWithdrawal]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxId -&gt; (RewardAccount, Coin) -&gt; TxWithdrawal
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxWithdrawal"><span class="hs-identifier hs-var">mkTxWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457055"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(RewardAccount, Coin)] -&gt; [TxWithdrawal])
-&gt; [(RewardAccount, Coin)] -&gt; [TxWithdrawal]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin -&gt; [(RewardAccount, Coin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map RewardAccount Coin -&gt; [(RewardAccount, Coin)])
-&gt; Map RewardAccount Coin -&gt; [(RewardAccount, Coin)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Map RewardAccount Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Awithdrawals%3ATx"><span class="hs-identifier hs-var hs-var">W.withdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621682457055"><span class="annot"><span class="annottext">tid :: TxId
</span><a href="#local-6989586621682457055"><span class="hs-identifier hs-var hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-var">TxId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;Tx&quot; -&gt; TxId) -&gt; Hash &quot;Tx&quot; -&gt; TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457056"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682457046"><span class="hs-var">#txId</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621682457299"><span id="local-6989586621682457300"><span class="annot"><a href="#local-6989586621682457054"><span class="hs-identifier hs-type">indexed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Num</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682457299"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682457300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682457299"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621682457054"><span class="annot"><span class="annottext">indexed :: [b] -&gt; [(a, b)]
</span><a href="#local-6989586621682457054"><span class="hs-identifier hs-var hs-var">indexed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [b] -&gt; [(a, b)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="hs-comment">-- | Convert high level transactions definition in low level DB history</span><span>
</span><span id="line-286"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier hs-type">mkTxHistory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">W.Tx</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier hs-type">TxHistory</span></a></span><span>
</span><span id="line-287"></span><span id="mkTxHistory"><span class="annot"><span class="annottext">mkTxHistory :: [Tx] -&gt; TxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier hs-var hs-var">mkTxHistory</span></a></span></span><span> </span><span id="local-6989586621682457045"><span class="annot"><span class="annottext">[Tx]
</span><a href="#local-6989586621682457045"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'Without) -&gt; TxHistory)
-&gt; Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Map TxId (TxRelationF 'Without)]
-&gt; Map TxId (TxRelationF 'Without)
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">([Map TxId (TxRelationF 'Without)]
 -&gt; Map TxId (TxRelationF 'Without))
-&gt; [Map TxId (TxRelationF 'Without)]
-&gt; Map TxId (TxRelationF 'Without)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621682457044"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457044"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Tx]
</span><a href="#local-6989586621682457045"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682457043"><span class="annot"><span class="annottext">relation :: TxRelationF 'Without
</span><a href="#local-6989586621682457043"><span class="hs-identifier hs-var hs-var">relation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxRelationF 'Without
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxRelation"><span class="hs-identifier hs-var">mkTxRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457044"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
-&gt; [Map TxId (TxRelationF 'Without)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'Without)
 -&gt; [Map TxId (TxRelationF 'Without)])
-&gt; Map TxId (TxRelationF 'Without)
-&gt; [Map TxId (TxRelationF 'Without)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxRelationF 'Without -&gt; Map TxId (TxRelationF 'Without)
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-var">TxId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;Tx&quot; -&gt; TxId) -&gt; Hash &quot;Tx&quot; -&gt; TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682457044"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682457041"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxRelationF 'Without
</span><a href="#local-6989586621682457043"><span class="hs-identifier hs-var">relation</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-keyword">type</span><span> </span><span id="TxOutKey"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxOutKey"><span class="hs-identifier hs-var">TxOutKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateWithTxOuts"><span class="hs-identifier hs-type">decorateWithTxOuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-type">With</span></a></span><span>
</span><span id="line-295"></span><span id="decorateWithTxOuts"><span class="annot"><span class="annottext">decorateWithTxOuts :: TxHistory -&gt; TxHistoryF 'With
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateWithTxOuts"><span class="hs-identifier hs-var hs-var">decorateWithTxOuts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682457040"><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682457040"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><a href="#local-6989586621682457039"><span class="hs-identifier hs-type">txouts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxOutKey"><span class="hs-identifier hs-type">TxOutKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>        </span><span id="local-6989586621682457039"><span class="annot"><span class="annottext">txouts :: Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457039"><span class="hs-identifier hs-var hs-var">txouts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxOutKey, (TxOut, [TxOutToken]))]
-&gt; Map TxOutKey (TxOut, [TxOutToken])
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxOutKey, (TxOut, [TxOutToken]))]
 -&gt; Map TxOutKey (TxOut, [TxOutToken]))
-&gt; [(TxOutKey, (TxOut, [TxOutToken]))]
-&gt; Map TxOutKey (TxOut, [TxOutToken])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682457033"><span id="local-6989586621682457034"><span id="local-6989586621682457035"><span id="local-6989586621682457036"><span id="local-6989586621682457037"><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
[TxWithdrawal]
[DecorateWithTxOut 'Without TxCollateral]
[DecorateWithTxOut 'Without TxIn]
Maybe (TxCollateralOut, [TxCollateralOutToken])
withdrawals :: [TxWithdrawal]
collateralOuts :: Maybe (TxCollateralOut, [TxCollateralOutToken])
outs :: [(TxOut, [TxOutToken])]
collateralIns :: [DecorateWithTxOut 'Without TxCollateral]
ins :: [DecorateWithTxOut 'Without TxIn]
$sel:withdrawals:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [TxWithdrawal]
$sel:collateralOuts:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
$sel:outs:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [(TxOut, [TxOutToken])]
$sel:collateralIns:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxCollateral]
$sel:ins:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxIn]
</span><a href="#local-6989586621682457033"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; [TxRelationF 'Without]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682457040"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputTxId"><span class="hs-identifier hs-var hs-var">txOutputTxId</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; TxId) -&gt; (TxOut -&gt; Word32) -&gt; TxOut -&gt; TxOutKey
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputIndex"><span class="hs-identifier hs-var hs-var">txOutputIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; TxOutKey) -&gt; TxOut -&gt; TxOutKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457032"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxOut, [TxOutToken])
</span><a href="#local-6989586621682457031"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682457031"><span class="annot"><span class="annottext">x :: (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457031"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682457032"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457032"><span class="hs-identifier hs-var">txout</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[TxOutToken]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
</span><a href="#local-6989586621682457035"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'With) -&gt; TxHistoryF 'With
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'With) -&gt; TxHistoryF 'With)
-&gt; Map TxId (TxRelationF 'With) -&gt; TxHistoryF 'With
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxRelationF 'Without -&gt; TxRelationF 'With)
-&gt; Map TxId (TxRelationF 'Without) -&gt; Map TxId (TxRelationF 'With)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
-&gt; TxRelationF 'Without -&gt; TxRelationF 'With
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#solveTxOut"><span class="hs-identifier hs-var">solveTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457039"><span class="hs-identifier hs-var">txouts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682457040"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span id="local-6989586621682457272"><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateInputs"><span class="hs-identifier hs-type">decorateInputs</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682457272"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxOutKey"><span class="hs-identifier hs-type">TxOutKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxOutKey"><span class="hs-identifier hs-type">TxOutKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682457272"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-type">WithTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457272"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-308"></span><span id="decorateInputs"><span class="annot"><span class="annottext">decorateInputs :: (t -&gt; TxOutKey)
-&gt; Map TxOutKey (TxOut, [TxOutToken]) -&gt; [t] -&gt; [WithTxOut t]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateInputs"><span class="hs-identifier hs-var hs-var">decorateInputs</span></a></span></span><span> </span><span id="local-6989586621682457028"><span class="annot"><span class="annottext">t -&gt; TxOutKey
</span><a href="#local-6989586621682457028"><span class="hs-identifier hs-var">keyOf</span></a></span></span><span> </span><span id="local-6989586621682457027"><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457027"><span class="hs-identifier hs-var">txOutMap</span></a></span></span><span> </span><span id="local-6989586621682457026"><span class="annot"><span class="annottext">[t]
</span><a href="#local-6989586621682457026"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621682457025"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682457025"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[t]
</span><a href="#local-6989586621682457026"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="annottext">WithTxOut t -&gt; [WithTxOut t]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(WithTxOut t -&gt; [WithTxOut t]) -&gt; WithTxOut t -&gt; [WithTxOut t]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; Maybe (TxOut, [TxOutToken]) -&gt; WithTxOut t
forall txin. txin -&gt; Maybe (TxOut, [TxOutToken]) -&gt; WithTxOut txin
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-var">WithTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682457025"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (TxOut, [TxOutToken]) -&gt; WithTxOut t)
-&gt; Maybe (TxOut, [TxOutToken]) -&gt; WithTxOut t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutKey
-&gt; Map TxOutKey (TxOut, [TxOutToken])
-&gt; Maybe (TxOut, [TxOutToken])
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; TxOutKey
</span><a href="#local-6989586621682457028"><span class="hs-identifier hs-var">keyOf</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682457025"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457027"><span class="hs-identifier hs-var">txOutMap</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#solveTxOut"><span class="hs-identifier hs-type">solveTxOut</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxOutKey"><span class="hs-identifier hs-type">TxOutKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier hs-type">TxOutToken</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-type">With</span></a></span><span>
</span><span id="line-316"></span><span id="solveTxOut"><span class="annot"><span class="annottext">solveTxOut :: Map TxOutKey (TxOut, [TxOutToken])
-&gt; TxRelationF 'Without -&gt; TxRelationF 'With
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#solveTxOut"><span class="hs-identifier hs-var hs-var">solveTxOut</span></a></span></span><span> </span><span id="local-6989586621682457023"><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457023"><span class="hs-identifier hs-var">txOutMap</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682457018"><span id="local-6989586621682457019"><span id="local-6989586621682457020"><span id="local-6989586621682457021"><span id="local-6989586621682457022"><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
[TxWithdrawal]
[DecorateWithTxOut 'Without TxCollateral]
[DecorateWithTxOut 'Without TxIn]
Maybe (TxCollateralOut, [TxCollateralOutToken])
withdrawals :: [TxWithdrawal]
collateralOuts :: Maybe (TxCollateralOut, [TxCollateralOutToken])
outs :: [(TxOut, [TxOutToken])]
collateralIns :: [DecorateWithTxOut 'Without TxCollateral]
ins :: [DecorateWithTxOut 'Without TxIn]
$sel:withdrawals:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [TxWithdrawal]
$sel:collateralOuts:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
$sel:outs:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [(TxOut, [TxOutToken])]
$sel:collateralIns:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxCollateral]
$sel:ins:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxIn]
</span><a href="#local-6989586621682457018"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxRelationF :: forall (f :: Decoration).
[DecorateWithTxOut f TxIn]
-&gt; [DecorateWithTxOut f TxCollateral]
-&gt; [(TxOut, [TxOutToken])]
-&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
-&gt; [TxWithdrawal]
-&gt; TxRelationF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:ins:TxRelationF :: [DecorateWithTxOut 'With TxIn]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Ains%3ATxRelationF"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">(TxIn -&gt; TxOutKey)
-&gt; Map TxOutKey (TxOut, [TxOutToken]) -&gt; [TxIn] -&gt; [WithTxOut TxIn]
forall t.
(t -&gt; TxOutKey)
-&gt; Map TxOutKey (TxOut, [TxOutToken]) -&gt; [t] -&gt; [WithTxOut t]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateInputs"><span class="hs-identifier hs-var">decorateInputs</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceTxId"><span class="hs-identifier hs-var hs-var">txInputSourceTxId</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; TxId) -&gt; (TxIn -&gt; Word32) -&gt; TxIn -&gt; TxOutKey
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceIndex"><span class="hs-identifier hs-var hs-var">txInputSourceIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>            </span><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457023"><span class="hs-identifier hs-var">txOutMap</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span class="annot"><span class="annottext">[TxIn]
[DecorateWithTxOut 'Without TxIn]
</span><a href="#local-6989586621682457022"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralIns:TxRelationF :: [DecorateWithTxOut 'With TxCollateral]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralIns%3ATxRelationF"><span class="hs-identifier hs-var">collateralIns</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="annottext">(TxCollateral -&gt; TxOutKey)
-&gt; Map TxOutKey (TxOut, [TxOutToken])
-&gt; [TxCollateral]
-&gt; [WithTxOut TxCollateral]
forall t.
(t -&gt; TxOutKey)
-&gt; Map TxOutKey (TxOut, [TxOutToken]) -&gt; [t] -&gt; [WithTxOut t]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#decorateInputs"><span class="hs-identifier hs-var">decorateInputs</span></a></span><span>
</span><span id="line-324"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateral -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceTxId"><span class="hs-identifier hs-var hs-var">txCollateralSourceTxId</span></a></span><span> </span><span class="annot"><span class="annottext">(TxCollateral -&gt; TxId)
-&gt; (TxCollateral -&gt; Word32) -&gt; TxCollateral -&gt; TxOutKey
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateral -&gt; Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceIndex"><span class="hs-identifier hs-var hs-var">txCollateralSourceIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>            </span><span class="annot"><span class="annottext">Map TxOutKey (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457023"><span class="hs-identifier hs-var">txOutMap</span></a></span><span>
</span><span id="line-326"></span><span>            </span><span class="annot"><span class="annottext">[TxCollateral]
[DecorateWithTxOut 'Without TxCollateral]
</span><a href="#local-6989586621682457021"><span class="hs-identifier hs-var">collateralIns</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outs:TxRelationF :: [(TxOut, [TxOutToken])]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Aouts%3ATxRelationF"><span class="hs-identifier hs-var">outs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
</span><a href="#local-6989586621682457020"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralOuts:TxRelationF :: Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralOuts%3ATxRelationF"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="#local-6989586621682457019"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:TxRelationF :: [TxWithdrawal]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Awithdrawals%3ATxRelationF"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxWithdrawal]
</span><a href="#local-6989586621682457018"><span class="hs-identifier hs-var">withdrawals</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#undecorateFromTxOuts"><span class="hs-identifier hs-type">undecorateFromTxOuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-type">With</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span>
</span><span id="line-333"></span><span id="undecorateFromTxOuts"><span class="annot"><span class="annottext">undecorateFromTxOuts :: TxHistoryF 'With -&gt; TxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#undecorateFromTxOuts"><span class="hs-identifier hs-var hs-var">undecorateFromTxOuts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682457017"><span class="annot"><span class="annottext">Map TxId (TxRelationF 'With)
</span><a href="#local-6989586621682457017"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'Without) -&gt; TxHistory)
-&gt; Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxRelationF 'With -&gt; TxRelationF 'Without)
-&gt; Map TxId (TxRelationF 'With) -&gt; Map TxId (TxRelationF 'Without)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TxRelationF 'With -&gt; TxRelationF 'Without
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#unsolveTxOut"><span class="hs-identifier hs-var">unsolveTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'With)
</span><a href="#local-6989586621682457017"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#unsolveTxOut"><span class="hs-identifier hs-type">unsolveTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-type">With</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Without"><span class="hs-identifier hs-type">Without</span></a></span><span>
</span><span id="line-336"></span><span id="unsolveTxOut"><span class="annot"><span class="annottext">unsolveTxOut :: TxRelationF 'With -&gt; TxRelationF 'Without
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#unsolveTxOut"><span class="hs-identifier hs-var hs-var">unsolveTxOut</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682457011"><span id="local-6989586621682457012"><span id="local-6989586621682457013"><span id="local-6989586621682457014"><span id="local-6989586621682457015"><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
[TxWithdrawal]
[DecorateWithTxOut 'With TxCollateral]
[DecorateWithTxOut 'With TxIn]
Maybe (TxCollateralOut, [TxCollateralOutToken])
withdrawals :: [TxWithdrawal]
collateralOuts :: Maybe (TxCollateralOut, [TxCollateralOutToken])
outs :: [(TxOut, [TxOutToken])]
collateralIns :: [DecorateWithTxOut 'With TxCollateral]
ins :: [DecorateWithTxOut 'With TxIn]
$sel:withdrawals:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [TxWithdrawal]
$sel:collateralOuts:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
$sel:outs:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [(TxOut, [TxOutToken])]
$sel:collateralIns:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxCollateral]
$sel:ins:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxIn]
</span><a href="#local-6989586621682457011"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxRelationF :: forall (f :: Decoration).
[DecorateWithTxOut f TxIn]
-&gt; [DecorateWithTxOut f TxCollateral]
-&gt; [(TxOut, [TxOutToken])]
-&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
-&gt; [TxWithdrawal]
-&gt; TxRelationF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:ins:TxRelationF :: [DecorateWithTxOut 'Without TxIn]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Ains%3ATxRelationF"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithTxOut TxIn -&gt; TxIn) -&gt; [WithTxOut TxIn] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">WithTxOut TxIn -&gt; TxIn
forall txin. WithTxOut txin -&gt; txin
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AtxIn%3AWithTxOut"><span class="hs-identifier hs-var hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">[DecorateWithTxOut 'With TxIn]
[WithTxOut TxIn]
</span><a href="#local-6989586621682457015"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralIns:TxRelationF :: [DecorateWithTxOut 'Without TxCollateral]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralIns%3ATxRelationF"><span class="hs-identifier hs-var">collateralIns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithTxOut TxCollateral -&gt; TxCollateral)
-&gt; [WithTxOut TxCollateral] -&gt; [TxCollateral]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">WithTxOut TxCollateral -&gt; TxCollateral
forall txin. WithTxOut txin -&gt; txin
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AtxIn%3AWithTxOut"><span class="hs-identifier hs-var hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">[DecorateWithTxOut 'With TxCollateral]
[WithTxOut TxCollateral]
</span><a href="#local-6989586621682457014"><span class="hs-identifier hs-var">collateralIns</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outs:TxRelationF :: [(TxOut, [TxOutToken])]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Aouts%3ATxRelationF"><span class="hs-identifier hs-var">outs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
</span><a href="#local-6989586621682457013"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralOuts:TxRelationF :: Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3AcollateralOuts%3ATxRelationF"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="#local-6989586621682457012"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:TxRelationF :: [TxWithdrawal]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Awithdrawals%3ATxRelationF"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxWithdrawal]
</span><a href="#local-6989586621682457011"><span class="hs-identifier hs-var">withdrawals</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-343"></span></pre></body></html>