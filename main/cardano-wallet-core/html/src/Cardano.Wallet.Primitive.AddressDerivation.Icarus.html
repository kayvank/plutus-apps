<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RoleAnnotations #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Copyright: &#169; 2018-2020 IOHK</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Implementation of address derivation for 'Icarus' keys. This uses the Byron</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- derivation for addresses, but on top of the derivation scheme V2.</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Icarus</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-23"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier">IcarusKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Generation and derivation</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromSeed"><span class="hs-identifier">generateKeyFromSeed</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromHardwareLedger"><span class="hs-identifier">generateKeyFromHardwareLedger</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#minSeedLengthBytes"><span class="hs-identifier">minSeedLengthBytes</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">DerivationScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">XPrv</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">XPub</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">deriveXPrv</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">deriveXPub</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">generateNew</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">toXPub</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">unXPrv</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">unXPub</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">xPrvChangePass</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">xprv</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">SomeMnemonic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">entropyToBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">mnemonicToEntropy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">mnemonicToText</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier">BoundedAddressLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier">Depth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationType"><span class="hs-identifier">DerivationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#ErrMkKeyFingerprint"><span class="hs-identifier">ErrMkKeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier">HardDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier">KeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier">MkKeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier">NetworkDiscriminant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPrivateKey"><span class="hs-identifier">PersistPrivateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPublicKey"><span class="hs-identifier">PersistPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier">RewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier">SoftDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier">WalletKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier">fromHex</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier">hex</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#DiscoverTxs"><span class="hs-identifier">DiscoverTxs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier">GetPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier">IsOurs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier">MaybeLight</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Sequential</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier">SeqState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#coinTypeAda"><span class="hs-identifier">coinTypeAda</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#discoverSeq"><span class="hs-identifier">discoverSeq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeBIP44"><span class="hs-identifier">purposeBIP44</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier">Passphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier">PassphraseHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#changePassphraseXPrv"><span class="hs-identifier">changePassphraseXPrv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Address</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.ProtocolMagic</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#ProtocolMagic"><span class="hs-identifier">ProtocolMagic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#testnetMagic"><span class="hs-identifier">testnetMagic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Util.html"><span class="hs-identifier">Cardano.Wallet.Util</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Util.html#invariant"><span class="hs-identifier">invariant</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Arrow</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">first</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">left</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;=&lt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Error</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">eitherCryptoError</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">hash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash.Algorithms</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">SHA256</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">SHA512</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.MAC.HMAC</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">HMAC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">hmac</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Bifunctor</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">bimap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Bits</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">clearBit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">setBit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">testBit</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Coerce</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">coerce</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.TypeLits</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">KnownNat</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Byron.Codec.Cbor.html"><span class="hs-identifier">Cardano.Byron.Codec.Cbor</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">Codec.CBOR.Write</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.ECC.Edwards25519</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ed25519</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.KDF.PBKDF2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PBKDF2</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier">Data.ByteArray</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | A cryptographic key for sequential-scheme address derivation, with</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- phantom-types to disambiguate key types.</span><span>
</span><span id="line-125"></span><span class="hs-comment">--</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- let rootPrivateKey = IcarusKey 'RootK XPrv</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- let accountPubKey = IcarusKey 'AccountK XPub</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- let addressPubKey = IcarusKey 'AddressK XPub</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-131"></span><span id="local-6989586621682447507"><span id="local-6989586621682447508"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="IcarusKey"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682447741"><span class="annot"><a href="#local-6989586621682447741"><span class="hs-identifier hs-type">depth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier hs-type">Depth</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682447742"><span class="annot"><a href="#local-6989586621682447742"><span class="hs-identifier hs-type">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-132"></span><span>    </span><span id="IcarusKey"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getKey"><span class="annot"><span class="annottext">IcarusKey depth key -&gt; key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682447742"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. IcarusKey depth key -&gt; Rep (IcarusKey depth key) x)
-&gt; (forall x. Rep (IcarusKey depth key) x -&gt; IcarusKey depth key)
-&gt; Generic (IcarusKey depth key)
forall x. Rep (IcarusKey depth key) x -&gt; IcarusKey depth key
forall x. IcarusKey depth key -&gt; Rep (IcarusKey depth key) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (depth :: Depth) key x.
Rep (IcarusKey depth key) x -&gt; IcarusKey depth key
forall (depth :: Depth) key x.
IcarusKey depth key -&gt; Rep (IcarusKey depth key) x
$cto :: forall (depth :: Depth) key x.
Rep (IcarusKey depth key) x -&gt; IcarusKey depth key
$cfrom :: forall (depth :: Depth) key x.
IcarusKey depth key -&gt; Rep (IcarusKey depth key) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447496"><span id="local-6989586621682447498"><span id="local-6989586621682447500"><span class="annot"><span class="annottext">Int -&gt; IcarusKey depth key -&gt; ShowS
[IcarusKey depth key] -&gt; ShowS
IcarusKey depth key -&gt; String
(Int -&gt; IcarusKey depth key -&gt; ShowS)
-&gt; (IcarusKey depth key -&gt; String)
-&gt; ([IcarusKey depth key] -&gt; ShowS)
-&gt; Show (IcarusKey depth key)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (depth :: Depth) key.
Show key =&gt;
Int -&gt; IcarusKey depth key -&gt; ShowS
forall (depth :: Depth) key.
Show key =&gt;
[IcarusKey depth key] -&gt; ShowS
forall (depth :: Depth) key.
Show key =&gt;
IcarusKey depth key -&gt; String
showList :: [IcarusKey depth key] -&gt; ShowS
$cshowList :: forall (depth :: Depth) key.
Show key =&gt;
[IcarusKey depth key] -&gt; ShowS
show :: IcarusKey depth key -&gt; String
$cshow :: forall (depth :: Depth) key.
Show key =&gt;
IcarusKey depth key -&gt; String
showsPrec :: Int -&gt; IcarusKey depth key -&gt; ShowS
$cshowsPrec :: forall (depth :: Depth) key.
Show key =&gt;
Int -&gt; IcarusKey depth key -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447491"><span id="local-6989586621682447493"><span class="annot"><span class="annottext">IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool
(IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool)
-&gt; (IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool)
-&gt; Eq (IcarusKey depth key)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall (depth :: Depth) key.
Eq key =&gt;
IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool
/= :: IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool
$c/= :: forall (depth :: Depth) key.
Eq key =&gt;
IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool
== :: IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool
$c== :: forall (depth :: Depth) key.
Eq key =&gt;
IcarusKey depth key -&gt; IcarusKey depth key -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span id="local-6989586621682447488"><span id="local-6989586621682447489"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682447486"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447489"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447488"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447489"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | The minimum seed length for 'generateKeyFromSeed' and 'unsafeGenerateKeyFromSeed'.</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#minSeedLengthBytes"><span class="hs-identifier hs-type">minSeedLengthBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-139"></span><span id="minSeedLengthBytes"><span class="annot"><span class="annottext">minSeedLengthBytes :: Int
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#minSeedLengthBytes"><span class="hs-identifier hs-var hs-var">minSeedLengthBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                               Key Generation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- | Generate a root key from a corresponding seed.</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- The seed should be at least 16 bytes.</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromSeed"><span class="hs-identifier hs-type">generateKeyFromSeed</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-comment">-- ^ The root mnemonic</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-comment">-- ^ Master encryption passphrase</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-153"></span><span id="generateKeyFromSeed"><span class="annot"><span class="annottext">generateKeyFromSeed :: SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromSeed"><span class="hs-identifier hs-var hs-var">generateKeyFromSeed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey 'RootK XPrv
forall (depth :: Depth).
SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-var">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- | Hardware Ledger devices generates keys from mnemonic using a different</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- approach (different from the rest of Cardano).</span><span>
</span><span id="line-157"></span><span class="hs-comment">--</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- It is a combination of:</span><span>
</span><span id="line-159"></span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- - [SLIP 0010](https://github.com/satoshilabs/slips/blob/master/slip-0010.md)</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- - [BIP 0032](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki)</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- - [BIP 0039](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- - [RFC 8032](https://tools.ietf.org/html/rfc8032#section-5.1.5)</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- - What seems to be arbitrary changes from Ledger regarding the calculation of</span><span>
</span><span id="line-165"></span><span class="hs-comment">--   the initial chain code and generation of the root private key.</span><span>
</span><span id="line-166"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromHardwareLedger"><span class="hs-identifier hs-type">generateKeyFromHardwareLedger</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-comment">-- ^ The root mnemonic</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-comment">-- ^ Master encryption passphrase</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-172"></span><span id="generateKeyFromHardwareLedger"><span class="annot"><span class="annottext">generateKeyFromHardwareLedger :: SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromHardwareLedger"><span class="hs-identifier hs-var hs-var">generateKeyFromHardwareLedger</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span> </span><span id="local-6989586621682447483"><span class="annot"><span class="annottext">Mnemonic mw
</span><a href="#local-6989586621682447483"><span class="hs-identifier hs-var">mw</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682447481"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447481"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either String (IcarusKey 'RootK XPrv) -&gt; IcarusKey 'RootK XPrv
forall a. Either String a -&gt; a
</span><a href="#local-6989586621682447480"><span class="hs-identifier hs-var">unsafeFromRight</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String (IcarusKey 'RootK XPrv) -&gt; IcarusKey 'RootK XPrv)
-&gt; Either String (IcarusKey 'RootK XPrv) -&gt; IcarusKey 'RootK XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682447479"><span class="annot"><span class="annottext">seed :: ByteString
</span><a href="#local-6989586621682447479"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621682447478"><span class="hs-identifier hs-var">pbkdf2HmacSha512</span></a></span><span>
</span><span id="line-174"></span><span>            </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Text -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic mw -&gt; [Text]
forall (mw :: Nat). Mnemonic mw -&gt; [Text]
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mnemonicToText</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic mw
</span><a href="#local-6989586621682447483"><span class="hs-identifier hs-var">mw</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- NOTE</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- SLIP-0010 refers to `iR` as the chain code. Here however, the chain code</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- is obtained as a hash of the initial seed whereas iR is used to make part</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- of the root private key itself.</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682447475"><span class="annot"><span class="annottext">cc :: ByteString
</span><a href="#local-6989586621682447475"><span class="hs-identifier hs-var hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621682447474"><span class="hs-identifier hs-var">hmacSha256</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.pack</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447479"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682447472"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447472"><span class="hs-identifier hs-var">iL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447471"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447471"><span class="hs-identifier hs-var">iR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString, ByteString) -&gt; (ByteString, ByteString)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621682447470"><span class="hs-identifier hs-var">pruneBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString, ByteString) -&gt; (ByteString, ByteString))
-&gt; (ByteString, ByteString) -&gt; (ByteString, ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (ByteString, ByteString)
</span><a href="#local-6989586621682447469"><span class="hs-identifier hs-var">hashRepeatedly</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447479"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621682447468"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447468"><span class="hs-identifier hs-var">pA</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ByteString
</span><a href="#local-6989586621682447467"><span class="hs-identifier hs-var">ed25519ScalarMult</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447472"><span class="hs-identifier hs-var">iL</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621682447466"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447466"><span class="hs-identifier hs-var">prv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; Either String XPrv -&gt; Either String XPrv
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String XPrv -&gt; Either String XPrv)
-&gt; Either String XPrv -&gt; Either String XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPrv
forall bin. ByteArrayAccess bin =&gt; bin -&gt; Either String XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String XPrv)
-&gt; ByteString -&gt; Either String XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447472"><span class="hs-identifier hs-var">iL</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447471"><span class="hs-identifier hs-var">iR</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447468"><span class="hs-identifier hs-var">pA</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447475"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv -&gt; Either String (IcarusKey 'RootK XPrv)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(IcarusKey 'RootK XPrv -&gt; Either String (IcarusKey 'RootK XPrv))
-&gt; IcarusKey 'RootK XPrv -&gt; Either String (IcarusKey 'RootK XPrv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; IcarusKey 'RootK XPrv
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes -&gt; XPrv -&gt; XPrv
forall oldPassPhrase newPassPhrase.
(ByteArrayAccess oldPassPhrase, ByteArrayAccess newPassPhrase) =&gt;
oldPassPhrase -&gt; newPassPhrase -&gt; XPrv -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">xPrvChangePass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447481"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447466"><span class="hs-identifier hs-var">prv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- Errors yielded in the body of 'generateKeyFromHardwareLedger' are</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- programmer errors (out-of-range byte buffer access or, invalid length for</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">-- cryptographic operations). Therefore, we throw badly if we encounter any.</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621682447764"><span class="annot"><a href="#local-6989586621682447480"><span class="hs-identifier hs-type">unsafeFromRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682447764"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682447480"><span class="annot"><span class="annottext">unsafeFromRight :: Either String a -&gt; a
</span><a href="#local-6989586621682447480"><span class="hs-identifier hs-var hs-var">unsafeFromRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; (a -&gt; a) -&gt; Either String a -&gt; a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- This is the algorithm described in SLIP 0010 for master key generation</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">-- with an extra step to discard _some_ of the potential private keys. Why</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">-- this extra step remains a mystery as of today.</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">--      1. Generate a seed byte sequence S of 512 bits according to BIP-0039.</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">--         (done in a previous step, passed as argument).</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">--      2. Calculate I = HMAC-SHA512(Key = &quot;ed25519 seed&quot;, Data = S)</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">--      3. Split I into two 32-byte sequences, IL and IR.</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- extra *******************************************************************</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- *                                                                       *</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- *    3.5 If the third highest bit of the last byte of IL is not zero    *</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- *        S = I and go back to step 2.                                   *</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- *                                                                       *</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- *************************************************************************</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">--      4. Use parse256(IL) as master secret key, and IR as master chain code.</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="#local-6989586621682447469"><span class="hs-identifier hs-type">hashRepeatedly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621682447469"><span class="annot"><span class="annottext">hashRepeatedly :: ByteString -&gt; (ByteString, ByteString)
</span><a href="#local-6989586621682447469"><span class="hs-identifier hs-var hs-var">hashRepeatedly</span></a></span></span><span> </span><span id="local-6989586621682447461"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447461"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (ByteString, ByteString)
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621682447459"><span class="hs-identifier hs-var">hmacSha512</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447461"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682447458"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447458"><span class="hs-identifier hs-var">iL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447457"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447457"><span class="hs-identifier hs-var">iR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="#local-6989586621682447456"><span class="hs-identifier hs-var">isInvalidKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447458"><span class="hs-identifier hs-var">iL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (ByteString, ByteString)
</span><a href="#local-6989586621682447469"><span class="hs-identifier hs-var">hashRepeatedly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447458"><span class="hs-identifier hs-var">iL</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447457"><span class="hs-identifier hs-var">iR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682447455"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447455"><span class="hs-identifier hs-var">iL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447454"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447454"><span class="hs-identifier hs-var">iR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447455"><span class="hs-identifier hs-var">iL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447454"><span class="hs-identifier hs-var">iR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>        </span><span id="local-6989586621682447456"><span class="annot"><span class="annottext">isInvalidKey :: ByteString -&gt; Bool
</span><a href="#local-6989586621682447456"><span class="hs-identifier hs-var hs-var">isInvalidKey</span></a></span></span><span> </span><span id="local-6989586621682447453"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447453"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Bool
forall a. Bits a =&gt; a -&gt; Int -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">testBit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447453"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int -&gt; Word8
</span><a href="../../../../bytestring/html/src"><span class="hs-operator hs-var">`BS.index`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- - Clear the lowest 3 bits of the first byte</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-comment">-- - Clear the highest bit of the last byte</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-comment">-- - Set the second highest bit of the last byte</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-comment">-- As described in [RFC 8032 - 5.1.5](https://tools.ietf.org/html/rfc8032#section-5.1.5)</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="#local-6989586621682447470"><span class="hs-identifier hs-type">pruneBuffer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621682447470"><span class="annot"><span class="annottext">pruneBuffer :: ByteString -&gt; ByteString
</span><a href="#local-6989586621682447470"><span class="hs-identifier hs-var hs-var">pruneBuffer</span></a></span></span><span> </span><span id="local-6989586621682447451"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447451"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682447450"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682447450"><span class="hs-identifier hs-var">firstByte</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447449"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447449"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8, ByteString)
-&gt; Maybe (Word8, ByteString) -&gt; (Word8, ByteString)
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; (Word8, ByteString)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pruneBuffer: no first byte&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Word8, ByteString) -&gt; (Word8, ByteString))
-&gt; Maybe (Word8, ByteString) -&gt; (Word8, ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-230"></span><span>                </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Word8, ByteString)
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.uncons</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447451"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682447447"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447447"><span class="hs-identifier hs-var">rest'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447446"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682447446"><span class="hs-identifier hs-var">lastByte</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString, Word8)
-&gt; Maybe (ByteString, Word8) -&gt; (ByteString, Word8)
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; (ByteString, Word8)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pruneBuffer: no last byte&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (ByteString, Word8) -&gt; (ByteString, Word8))
-&gt; Maybe (ByteString, Word8) -&gt; (ByteString, Word8)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-233"></span><span>                </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (ByteString, Word8)
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.unsnoc</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447449"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>            </span><span id="local-6989586621682447444"><span class="annot"><span class="annottext">firstPruned :: Word8
</span><a href="#local-6989586621682447444"><span class="hs-identifier hs-var hs-var">firstPruned</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682447450"><span class="hs-identifier hs-var">firstByte</span></a></span><span>
</span><span id="line-236"></span><span>                </span><span class="annot"><span class="annottext">Word8 -&gt; (Word8 -&gt; Word8) -&gt; Word8
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`clearBit`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                </span><span class="annot"><span class="annottext">Word8 -&gt; (Word8 -&gt; Word8) -&gt; Word8
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`clearBit`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                </span><span class="annot"><span class="annottext">Word8 -&gt; (Word8 -&gt; Word8) -&gt; Word8
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`clearBit`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>            </span><span id="local-6989586621682447443"><span class="annot"><span class="annottext">lastPruned :: Word8
</span><a href="#local-6989586621682447443"><span class="hs-identifier hs-var hs-var">lastPruned</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682447446"><span class="hs-identifier hs-var">lastByte</span></a></span><span>
</span><span id="line-241"></span><span>                </span><span class="annot"><span class="annottext">Word8 -&gt; (Word8 -&gt; Word8) -&gt; Word8
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`setBit`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>                </span><span class="annot"><span class="annottext">Word8 -&gt; (Word8 -&gt; Word8) -&gt; Word8
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`clearBit`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682447444"><span class="hs-identifier hs-var">firstPruned</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-operator hs-var">`BS.cons`</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Word8 -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.snoc</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447447"><span class="hs-identifier hs-var">rest'</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682447443"><span class="hs-identifier hs-var">lastPruned</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="#local-6989586621682447467"><span class="hs-identifier hs-type">ed25519ScalarMult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621682447467"><span class="annot"><span class="annottext">ed25519ScalarMult :: ByteString -&gt; Either String ByteString
</span><a href="#local-6989586621682447467"><span class="hs-identifier hs-var hs-var">ed25519ScalarMult</span></a></span></span><span> </span><span id="local-6989586621682447440"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447440"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>        </span><span id="local-6989586621682447439"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621682447439"><span class="hs-identifier hs-var">scalar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CryptoError -&gt; String)
-&gt; Either CryptoError Scalar -&gt; Either String Scalar
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">CryptoError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Either CryptoError Scalar -&gt; Either String Scalar)
-&gt; Either CryptoError Scalar -&gt; Either String Scalar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CryptoFailable Scalar -&gt; Either CryptoError Scalar
forall a. CryptoFailable a -&gt; Either CryptoError a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">eitherCryptoError</span></a></span><span> </span><span class="annot"><span class="annottext">(CryptoFailable Scalar -&gt; Either CryptoError Scalar)
-&gt; CryptoFailable Scalar -&gt; Either CryptoError Scalar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; CryptoFailable Scalar
forall bs. ByteArrayAccess bs =&gt; bs -&gt; CryptoFailable Scalar
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">Ed25519.scalarDecodeLong</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447440"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ByteString
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String ByteString)
-&gt; ByteString -&gt; Either String ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Point -&gt; ByteString
forall bs. ByteArray bs =&gt; Point -&gt; bs
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">Ed25519.pointEncode</span></a></span><span> </span><span class="annot"><span class="annottext">(Point -&gt; ByteString) -&gt; Point -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar -&gt; Point
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">Ed25519.toPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621682447439"><span class="hs-identifier hs-var">scalar</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-comment">-- As described in [BIP 0039 - From Mnemonic to Seed](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki#from-mnemonic-to-seed)</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="#local-6989586621682447478"><span class="hs-identifier hs-type">pbkdf2HmacSha512</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621682447478"><span class="annot"><span class="annottext">pbkdf2HmacSha512 :: ByteString -&gt; ByteString
</span><a href="#local-6989586621682447478"><span class="hs-identifier hs-var hs-var">pbkdf2HmacSha512</span></a></span></span><span> </span><span id="local-6989586621682447435"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447435"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PRF ByteString
-&gt; Parameters -&gt; ByteString -&gt; ByteString -&gt; ByteString
forall password salt ba.
(ByteArrayAccess password, ByteArrayAccess salt, ByteArray ba) =&gt;
PRF password -&gt; Parameters -&gt; password -&gt; salt -&gt; ba
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">PBKDF2.generate</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SHA512 -&gt; PRF ByteString
forall a password.
(HashAlgorithm a, ByteArrayAccess password) =&gt;
a -&gt; PRF password
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">PBKDF2.prfHMAC</span></a></span><span> </span><span class="annot"><span class="annottext">SHA512
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">SHA512</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Parameters
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">PBKDF2.Parameters</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2048</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447435"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;mnemonic&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="#local-6989586621682447474"><span class="hs-identifier hs-type">hmacSha256</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621682447474"><span class="annot"><span class="annottext">hmacSha256 :: ByteString -&gt; ByteString
</span><a href="#local-6989586621682447474"><span class="hs-identifier hs-var hs-var">hmacSha256</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">forall bout.
(ByteArrayAccess (HMAC SHA256), ByteArray bout) =&gt;
HMAC SHA256 -&gt; bout
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-type">HMAC</span></a></span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-type">SHA256</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HMAC SHA256 -&gt; ByteString)
-&gt; (ByteString -&gt; HMAC SHA256) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; HMAC SHA256
forall key message a.
(ByteArrayAccess key, ByteArrayAccess message, HashAlgorithm a) =&gt;
key -&gt; message -&gt; HMAC a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hmac</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447428"><span class="hs-identifier hs-var">salt</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- As described in [SLIP 0010 - Master Key Generation](https://github.com/satoshilabs/slips/blob/master/slip-0010.md#master-key-generation)</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621682447459"><span class="hs-identifier hs-type">hmacSha512</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621682447459"><span class="annot"><span class="annottext">hmacSha512 :: ByteString -&gt; ByteString
</span><a href="#local-6989586621682447459"><span class="hs-identifier hs-var hs-var">hmacSha512</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>        </span><span class="annot"><span class="annottext">forall bout.
(ByteArrayAccess (HMAC SHA512), ByteArray bout) =&gt;
HMAC SHA512 -&gt; bout
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-type">HMAC</span></a></span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-type">SHA512</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HMAC SHA512 -&gt; ByteString)
-&gt; (ByteString -&gt; HMAC SHA512) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; HMAC SHA512
forall key message a.
(ByteArrayAccess key, ByteArrayAccess message, HashAlgorithm a) =&gt;
key -&gt; message -&gt; HMAC a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hmac</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447428"><span class="hs-identifier hs-var">salt</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="#local-6989586621682447428"><span class="hs-identifier hs-type">salt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621682447428"><span class="annot"><span class="annottext">salt :: ByteString
</span><a href="#local-6989586621682447428"><span class="hs-identifier hs-var hs-var">salt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;ed25519 seed&quot;</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- | Generate a new key from seed. Note that the @depth@ is left open so that</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- the caller gets to decide what type of key this is. This is mostly for</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- testing, in practice, seeds are used to represent root keys, and one should</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- use 'generateKeyFromSeed'.</span><span>
</span><span id="line-275"></span><span id="local-6989586621682447768"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-type">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-comment">-- ^ The root mnemonic</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-comment">-- ^ Master encryption passphrase</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447768"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span></span><span>
</span><span id="line-281"></span><span id="unsafeGenerateKeyFromSeed"><span class="annot"><span class="annottext">unsafeGenerateKeyFromSeed :: SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-var hs-var">unsafeGenerateKeyFromSeed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span> </span><span id="local-6989586621682447427"><span class="annot"><span class="annottext">Mnemonic mw
</span><a href="#local-6989586621682447427"><span class="hs-identifier hs-var">mw</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682447426"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447426"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-283"></span><span>        </span><span id="local-6989586621682447425"><span class="annot"><span class="annottext">seed :: ScrubbedBytes
</span><a href="#local-6989586621682447425"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Entropy (EntropySize mw) -&gt; ScrubbedBytes
forall (n :: Nat). Entropy n -&gt; ScrubbedBytes
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">entropyToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Entropy (EntropySize mw) -&gt; ScrubbedBytes)
-&gt; Entropy (EntropySize mw) -&gt; ScrubbedBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic mw -&gt; Entropy (EntropySize mw)
forall (mw :: Nat). Mnemonic mw -&gt; Entropy (EntropySize mw)
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var hs-var">mnemonicToEntropy</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic mw
</span><a href="#local-6989586621682447427"><span class="hs-identifier hs-var">mw</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621682447424"><span class="annot"><span class="annottext">seed' :: ScrubbedBytes
</span><a href="#local-6989586621682447424"><span class="hs-identifier hs-var hs-var">seed'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ScrubbedBytes -&gt; (ScrubbedBytes -&gt; Bool) -&gt; ScrubbedBytes
forall a. HasCallStack =&gt; String -&gt; a -&gt; (a -&gt; Bool) -&gt; a
</span><a href="Cardano.Wallet.Util.html#invariant"><span class="hs-identifier hs-var">invariant</span></a></span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;seed length : &quot;</span></span><span>
</span><span id="line-286"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Int
forall ba. ByteArrayAccess ba =&gt; ba -&gt; Int
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.length</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447425"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in (Passphrase \&quot;seed\&quot;) is not valid&quot;</span></span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>            </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447425"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-290"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682447422"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447422"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Int
forall ba. ByteArrayAccess ba =&gt; ba -&gt; Int
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.length</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447422"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#minSeedLengthBytes"><span class="hs-identifier hs-var">minSeedLengthBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Int
forall ba. ByteArrayAccess ba =&gt; ba -&gt; Int
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.length</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447422"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; IcarusKey depth XPrv
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; IcarusKey depth XPrv) -&gt; XPrv -&gt; IcarusKey depth XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ByteString -&gt; ScrubbedBytes -&gt; XPrv
forall keyPassPhrase generationPassPhrase seed.
(ByteArrayAccess keyPassPhrase,
 ByteArrayAccess generationPassPhrase, ByteArrayAccess seed) =&gt;
seed -&gt; generationPassPhrase -&gt; keyPassPhrase -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">generateNew</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447424"><span class="hs-identifier hs-var">seed'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447426"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                          Hard / Soft Key Derivation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="AddressIndexDerivationType"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-var">AddressIndexDerivationType</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621682447416"><span class="annot"><span class="annottext">deriveAccountPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; IcarusKey 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; IcarusKey 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAccountPrivateKey</span></a></span></span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682447414"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447414"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span id="local-6989586621682447413"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447413"><span class="hs-identifier hs-var">rootXPrv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682447411"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447411"><span class="hs-identifier hs-var">accIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-303"></span><span>            </span><span id="local-6989586621682447410"><span class="annot"><span class="annottext">purposeXPrv :: XPrv
</span><a href="#local-6989586621682447410"><span class="hs-identifier hs-var hs-var">purposeXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- lvl1 derivation; hardened derivation of purpose'</span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447414"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447413"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeBIP44"><span class="hs-identifier hs-var">purposeBIP44</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>            </span><span id="local-6989586621682447407"><span class="annot"><span class="annottext">coinTypeXPrv :: XPrv
</span><a href="#local-6989586621682447407"><span class="hs-identifier hs-var hs-var">coinTypeXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- lvl2 derivation; hardened derivation of coin_type'</span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447414"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447410"><span class="hs-identifier hs-var">purposeXPrv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'CoinTypeK -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'CoinTypeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#coinTypeAda"><span class="hs-identifier hs-var">coinTypeAda</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>            </span><span id="local-6989586621682447406"><span class="annot"><span class="annottext">acctXPrv :: XPrv
</span><a href="#local-6989586621682447406"><span class="hs-identifier hs-var hs-var">acctXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- lvl3 derivation; hardened derivation of account' index</span><span>
</span><span id="line-308"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447414"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447407"><span class="hs-identifier hs-var">coinTypeXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447411"><span class="hs-identifier hs-var">accIx</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-310"></span><span>            </span><span class="annot"><span class="annottext">XPrv -&gt; IcarusKey 'AccountK XPrv
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447406"><span class="hs-identifier hs-var">acctXPrv</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621682447405"><span class="annot"><span class="annottext">deriveAddressPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; IcarusKey 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType IcarusKey) 'AddressK
-&gt; IcarusKey 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPrivateKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAddressPrivateKey</span></a></span></span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682447403"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447403"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span id="local-6989586621682447402"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447402"><span class="hs-identifier hs-var">accXPrv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682447401"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682447401"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682447400"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447400"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-315"></span><span>            </span><span id="local-6989586621682447399"><span class="annot"><span class="annottext">changeCode :: Word32
</span><a href="#local-6989586621682447399"><span class="hs-identifier hs-var hs-var">changeCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word32) -&gt; Int -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromEnum</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682447401"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-317"></span><span>            </span><span id="local-6989586621682447397"><span class="annot"><span class="annottext">changeXPrv :: XPrv
</span><a href="#local-6989586621682447397"><span class="hs-identifier hs-var hs-var">changeXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- lvl4 derivation; soft derivation of change chain</span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447403"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447402"><span class="hs-identifier hs-var">accXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447399"><span class="hs-identifier hs-var">changeCode</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span id="local-6989586621682447396"><span class="annot"><span class="annottext">addrXPrv :: XPrv
</span><a href="#local-6989586621682447396"><span class="hs-identifier hs-var hs-var">addrXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- lvl5 derivation; soft derivation of address index</span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682447403"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447397"><span class="hs-identifier hs-var">changeXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447400"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-322"></span><span>            </span><span class="annot"><span class="annottext">XPrv -&gt; IcarusKey 'AddressK XPrv
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447396"><span class="hs-identifier hs-var">addrXPrv</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621682447392"><span class="annot"><span class="annottext">deriveAddressPublicKey :: IcarusKey 'AccountK XPub
-&gt; Role -&gt; Index 'Soft 'AddressK -&gt; IcarusKey 'AddressK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPublicKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAddressPublicKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span id="local-6989586621682447390"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447390"><span class="hs-identifier hs-var">accXPub</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682447389"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682447389"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682447388"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447388"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
-&gt; Maybe (IcarusKey 'AddressK XPub) -&gt; IcarusKey 'AddressK XPub
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447387"><span class="hs-identifier hs-var">errWrongIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (IcarusKey 'AddressK XPub) -&gt; IcarusKey 'AddressK XPub)
-&gt; Maybe (IcarusKey 'AddressK XPub) -&gt; IcarusKey 'AddressK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682447386"><span class="annot"><span class="annottext">changeCode :: Word32
</span><a href="#local-6989586621682447386"><span class="hs-identifier hs-var hs-var">changeCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word32) -&gt; Int -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromEnum</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682447389"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-328"></span><span>            </span><span id="local-6989586621682447385"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447385"><span class="hs-identifier hs-var">changeXPub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-comment">-- lvl4 derivation in bip44 is derivation of change chain</span><span>
</span><span id="line-329"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; XPub -&gt; Word32 -&gt; Maybe XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPub</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447390"><span class="hs-identifier hs-var">accXPub</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447386"><span class="hs-identifier hs-var">changeCode</span></a></span><span>
</span><span id="line-330"></span><span>            </span><span id="local-6989586621682447384"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447384"><span class="hs-identifier hs-var">addrXPub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-comment">-- lvl5 derivation in bip44 is derivation of address chain</span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><span class="annottext">DerivationScheme -&gt; XPub -&gt; Word32 -&gt; Maybe XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPub</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme2</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447385"><span class="hs-identifier hs-var">changeXPub</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447388"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub -&gt; Maybe (IcarusKey 'AddressK XPub)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(IcarusKey 'AddressK XPub -&gt; Maybe (IcarusKey 'AddressK XPub))
-&gt; IcarusKey 'AddressK XPub -&gt; Maybe (IcarusKey 'AddressK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; IcarusKey 'AddressK XPub
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447384"><span class="hs-identifier hs-var">addrXPub</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-334"></span><span>        </span><span id="local-6989586621682447387"><span class="annot"><span class="annottext">errWrongIndex :: IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447387"><span class="hs-identifier hs-var hs-var">errWrongIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IcarusKey 'AddressK XPub
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IcarusKey 'AddressK XPub)
-&gt; String -&gt; IcarusKey 'AddressK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-335"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;deriveAddressPublicKey failed: was given an hardened (or too big) \
            \index for soft path derivation ( &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682447388"><span class="hs-identifier hs-var">addrIx</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;). This is \
            \either a programmer error, or, we may have reached the maximum \
            \number of addresses for a given wallet.&quot;</span></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                            WalletKey implementation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621682447376"><span class="annot"><span class="annottext">keyTypeDescriptor :: Proxy IcarusKey -&gt; String
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#keyTypeDescriptor"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyTypeDescriptor</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy IcarusKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ica&quot;</span></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621682447374"><span class="annot"><span class="annottext">changePassphrase :: (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; IcarusKey depth XPrv
-&gt; IcarusKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#changePassphrase"><span class="hs-identifier hs-var hs-var hs-var hs-var">changePassphrase</span></a></span></span><span> </span><span id="local-6989586621682447372"><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682447372"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621682447371"><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682447371"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span id="local-6989586621682447370"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447370"><span class="hs-identifier hs-var">prv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="annottext">XPrv -&gt; IcarusKey depth XPrv
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; IcarusKey depth XPrv) -&gt; XPrv -&gt; IcarusKey depth XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;) -&gt; XPrv -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#changePassphraseXPrv"><span class="hs-identifier hs-var">changePassphraseXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682447372"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682447371"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447370"><span class="hs-identifier hs-var">prv</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621682447369"><span class="annot"><span class="annottext">publicKey :: IcarusKey depth XPrv -&gt; IcarusKey depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span id="local-6989586621682447367"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447367"><span class="hs-identifier hs-var">prv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">XPub -&gt; IcarusKey depth XPub
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682447367"><span class="hs-identifier hs-var">prv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621682447366"><span class="annot"><span class="annottext">digest :: IcarusKey depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var hs-var hs-var hs-var">digest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span id="local-6989586621682447364"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447364"><span class="hs-identifier hs-var">prv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Digest a
forall ba a.
(ByteArrayAccess ba, HashAlgorithm a) =&gt;
ba -&gt; Digest a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447364"><span class="hs-identifier hs-var">prv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621682447363"><span class="annot"><span class="annottext">getRawKey :: IcarusKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">getRawKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="annottext">IcarusKey depth raw -&gt; raw
forall (depth :: Depth) raw. IcarusKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621682447361"><span class="annot"><span class="annottext">liftRawKey :: raw -&gt; IcarusKey depth raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftRawKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftRawKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">raw -&gt; IcarusKey depth raw
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                         Relationship Key / Address
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier hs-type">GetPurpose</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621682447357"><span class="annot"><span class="annottext">getPurpose :: Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getPurpose"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPurpose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeBIP44"><span class="hs-identifier hs-var">purposeBIP44</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Mainnet"><span class="hs-identifier hs-type">Mainnet</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621682447351"><span class="annot"><span class="annottext">paymentAddress :: IcarusKey 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentAddress"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentAddress</span></a></span></span><span> </span><span id="local-6989586621682447349"><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447349"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; [Encoding] -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeAddress"><span class="hs-identifier hs-var">CBOR.encodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub -&gt; XPub
forall (depth :: Depth) raw. IcarusKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447349"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621682447345"><span class="annot"><span class="annottext">liftPaymentAddress :: KeyFingerprint &quot;payment&quot; IcarusKey -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftPaymentAddress"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftPaymentAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-type">KeyFingerprint</span></a></span><span> </span><span id="local-6989586621682447342"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447342"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447342"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span id="local-6989586621682447341"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">KnownNat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447341"><span class="hs-identifier hs-type">pm</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Testnet"><span class="hs-identifier hs-type">Testnet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447341"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621682447337"><span class="annot"><span class="annottext">paymentAddress :: IcarusKey 'AddressK XPub -&gt; Address
</span><a href="#local-6989586621682447337"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentAddress</span></a></span></span><span> </span><span id="local-6989586621682447336"><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447336"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; [Encoding] -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeAddress"><span class="hs-identifier hs-var">CBOR.encodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub -&gt; XPub
forall (depth :: Depth) raw. IcarusKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447336"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ProtocolMagic -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeProtocolMagicAttr"><span class="hs-identifier hs-var">CBOR.encodeProtocolMagicAttr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownNat pm =&gt; ProtocolMagic
forall (pm :: Nat). KnownNat pm =&gt; ProtocolMagic
</span><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#testnetMagic"><span class="hs-identifier hs-var">testnetMagic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682447341"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>    </span><span id="local-6989586621682447334"><span class="annot"><span class="annottext">liftPaymentAddress :: KeyFingerprint &quot;payment&quot; IcarusKey -&gt; Address
</span><a href="#local-6989586621682447334"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftPaymentAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-type">KeyFingerprint</span></a></span><span> </span><span id="local-6989586621682447333"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447333"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447333"><span class="hs-identifier hs-var">bytes</span></a></span></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-386"></span><span>    </span><span id="local-6989586621682447329"><span class="annot"><span class="annottext">paymentKeyFingerprint :: Address
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentKeyFingerprint"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentKeyFingerprint</span></a></span></span><span> </span><span id="local-6989586621682447327"><span class="annot"><span class="annottext">addr :: Address
</span><a href="#local-6989586621682447327"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span id="local-6989586621682447326"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447326"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a. (forall s. Decoder s a) -&gt; ByteString -&gt; Maybe a
</span><a href="Cardano.Byron.Codec.Cbor.html#deserialiseCbor"><span class="hs-identifier hs-var">CBOR.deserialiseCbor</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s ByteString
</span><a href="Cardano.Byron.Codec.Cbor.html#decodeAddressPayload"><span class="hs-identifier hs-var">CBOR.decodeAddressPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447326"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; IcarusKey
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyFingerprint &quot;payment&quot; IcarusKey
 -&gt; Either
      (ErrMkKeyFingerprint IcarusKey Address)
      (KeyFingerprint &quot;payment&quot; IcarusKey))
-&gt; KeyFingerprint &quot;payment&quot; IcarusKey
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; KeyFingerprint &quot;payment&quot; IcarusKey
forall k (s :: Symbol) (key :: k).
ByteString -&gt; KeyFingerprint s key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-var">KeyFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447326"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-389"></span><span>            </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrMkKeyFingerprint IcarusKey Address
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMkKeyFingerprint IcarusKey Address
 -&gt; Either
      (ErrMkKeyFingerprint IcarusKey Address)
      (KeyFingerprint &quot;payment&quot; IcarusKey))
-&gt; ErrMkKeyFingerprint IcarusKey Address
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Proxy IcarusKey -&gt; ErrMkKeyFingerprint IcarusKey Address
forall k (key :: k) from.
from -&gt; Proxy key -&gt; ErrMkKeyFingerprint key from
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#ErrInvalidAddress"><span class="hs-identifier hs-var">ErrInvalidAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682447327"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy IcarusKey
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span id="local-6989586621682447321"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447321"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682447321"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621682447318"><span class="annot"><span class="annottext">paymentKeyFingerprint :: (Proxy n, IcarusKey 'AddressK XPub)
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; IcarusKey)
</span><a href="#local-6989586621682447318"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentKeyFingerprint</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682447317"><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621682447317"><span class="hs-identifier hs-var">proxy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447316"><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447316"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-395"></span><span>        </span><span class="annot"><span class="annottext">(ErrMkKeyFingerprint IcarusKey Address
 -&gt; ErrMkKeyFingerprint
      IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
-&gt; (KeyFingerprint &quot;payment&quot; IcarusKey
    -&gt; KeyFingerprint &quot;payment&quot; IcarusKey)
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub)
-&gt; ErrMkKeyFingerprint IcarusKey Address
-&gt; ErrMkKeyFingerprint
     IcarusKey (Proxy n, IcarusKey 'AddressK XPub)
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub)
</span><a href="#local-6989586621682447314"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; IcarusKey
-&gt; KeyFingerprint &quot;payment&quot; IcarusKey
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span>
</span><span id="line-396"></span><span>        </span><span class="annot"><span class="annottext">(Either
   (ErrMkKeyFingerprint IcarusKey Address)
   (KeyFingerprint &quot;payment&quot; IcarusKey)
 -&gt; Either
      (ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
      (KeyFingerprint &quot;payment&quot; IcarusKey))
-&gt; (IcarusKey 'AddressK XPub
    -&gt; Either
         (ErrMkKeyFingerprint IcarusKey Address)
         (KeyFingerprint &quot;payment&quot; IcarusKey))
-&gt; IcarusKey 'AddressK XPub
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall from.
MkKeyFingerprint IcarusKey from =&gt;
from
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey from)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall (key :: Depth -&gt; * -&gt; *) from.
MkKeyFingerprint key from =&gt;
from
-&gt; Either
     (ErrMkKeyFingerprint key from) (KeyFingerprint &quot;payment&quot; key)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentKeyFingerprint"><span class="hs-identifier hs-var">paymentKeyFingerprint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span class="annot"><span class="annottext">(Address
 -&gt; Either
      (ErrMkKeyFingerprint IcarusKey Address)
      (KeyFingerprint &quot;payment&quot; IcarusKey))
-&gt; (IcarusKey 'AddressK XPub -&gt; Address)
-&gt; IcarusKey 'AddressK XPub
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey Address)
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (network :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
PaymentAddress network key =&gt;
key 'AddressK XPub -&gt; Address
forall (key :: Depth -&gt; * -&gt; *).
PaymentAddress n key =&gt;
key 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentAddress"><span class="hs-identifier hs-var">paymentAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682447321"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">(IcarusKey 'AddressK XPub
 -&gt; Either
      (ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
      (KeyFingerprint &quot;payment&quot; IcarusKey))
-&gt; IcarusKey 'AddressK XPub
-&gt; Either
     (ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; IcarusKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447316"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-400"></span><span>        </span><span id="local-6989586621682447314"><span class="annot"><span class="annottext">err :: ErrMkKeyFingerprint IcarusKey (Proxy n, IcarusKey 'AddressK XPub)
</span><a href="#local-6989586621682447314"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Proxy n, IcarusKey 'AddressK XPub)
-&gt; Proxy IcarusKey
-&gt; ErrMkKeyFingerprint
     IcarusKey (Proxy n, IcarusKey 'AddressK XPub)
forall k (key :: k) from.
from -&gt; Proxy key -&gt; ErrMkKeyFingerprint key from
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#ErrInvalidAddress"><span class="hs-identifier hs-var">ErrInvalidAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621682447317"><span class="hs-identifier hs-var">proxy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IcarusKey 'AddressK XPub
</span><a href="#local-6989586621682447316"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy IcarusKey
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span id="local-6989586621682447313"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447313"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621682447310"><span class="annot"><span class="annottext">isOurs :: RewardAccount
-&gt; SeqState n IcarusKey
-&gt; (Maybe (NonEmpty DerivationIndex), SeqState n IcarusKey)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOurs"><span class="hs-identifier hs-var hs-var hs-var hs-var">isOurs</span></a></span></span><span> </span><span id="local-6989586621682447308"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682447308"><span class="hs-identifier hs-var">_account</span></a></span></span><span> </span><span id="local-6989586621682447307"><span class="annot"><span class="annottext">SeqState n IcarusKey
</span><a href="#local-6989586621682447307"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (NonEmpty DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SeqState n IcarusKey
</span><a href="#local-6989586621682447307"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span id="local-6989586621682447306"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447306"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447306"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621682447303"><span class="annot"><span class="annottext">maybeDiscover :: Maybe (LightDiscoverTxs (SeqState n IcarusKey))
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#maybeDiscover"><span class="hs-identifier hs-var hs-var hs-var hs-var">maybeDiscover</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LightDiscoverTxs (SeqState n IcarusKey)
-&gt; Maybe (LightDiscoverTxs (SeqState n IcarusKey))
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(LightDiscoverTxs (SeqState n IcarusKey)
 -&gt; Maybe (LightDiscoverTxs (SeqState n IcarusKey)))
-&gt; LightDiscoverTxs (SeqState n IcarusKey)
-&gt; Maybe (LightDiscoverTxs (SeqState n IcarusKey))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (m :: * -&gt; *).
 Monad m =&gt;
 (Either Address RewardAccount -&gt; m ChainEvents)
 -&gt; SeqState n IcarusKey -&gt; m (ChainEvents, SeqState n IcarusKey))
-&gt; LightDiscoverTxs (SeqState n IcarusKey)
forall addr txs s.
(forall (m :: * -&gt; *).
 Monad m =&gt;
 (addr -&gt; m txs) -&gt; s -&gt; m (txs, s))
-&gt; DiscoverTxs addr txs s
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#DiscoverTxs"><span class="hs-identifier hs-var">DiscoverTxs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *)
       (m :: * -&gt; *).
(PaymentAddress n k, Monad m) =&gt;
(Either Address RewardAccount -&gt; m ChainEvents)
-&gt; SeqState n k -&gt; m (ChainEvents, SeqState n k)
forall (m :: * -&gt; *).
Monad m =&gt;
(Either Address RewardAccount -&gt; m ChainEvents)
-&gt; SeqState n IcarusKey -&gt; m (ChainEvents, SeqState n IcarusKey)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#discoverSeq"><span class="hs-identifier hs-var">discoverSeq</span></a></span></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-comment">-- Matching 'paymentAddress' above.</span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621682447298"><span class="annot"><span class="annottext">maxLengthAddressFor :: Proxy IcarusKey -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#maxLengthAddressFor"><span class="hs-identifier hs-var hs-var hs-var hs-var">maxLengthAddressFor</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy IcarusKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; [Encoding] -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeAddress"><span class="hs-identifier hs-var">CBOR.encodeAddress</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682447296"><span class="hs-identifier hs-var">xpub</span></a></span><span>
</span><span id="line-413"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ProtocolMagic -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeProtocolMagicAttr"><span class="hs-identifier hs-var">CBOR.encodeProtocolMagicAttr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; ProtocolMagic
</span><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#ProtocolMagic"><span class="hs-identifier hs-var">ProtocolMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-416"></span><span>        </span><span class="annot"><a href="#local-6989586621682447296"><span class="hs-identifier hs-type">xpub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">CC.XPub</span></a></span><span>
</span><span id="line-417"></span><span>        </span><span id="local-6989586621682447296"><span class="annot"><span class="annottext">xpub :: XPub
</span><a href="#local-6989586621682447296"><span class="hs-identifier hs-var hs-var">xpub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">CC.toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; XPub) -&gt; XPrv -&gt; XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; XPrv
forall passPhrase seed.
(ByteArrayAccess passPhrase, ByteArrayAccess seed) =&gt;
seed -&gt; passPhrase -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">CC.generate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word8 -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447291"><span class="hs-identifier hs-var">xprvPass</span></a></span><span>
</span><span id="line-418"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-419"></span><span>            </span><span id="local-6989586621682447291"><span class="annot"><span class="annottext">xprvPass :: ByteString
</span><a href="#local-6989586621682447291"><span class="hs-identifier hs-var hs-var">xprvPass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                          Storing and retrieving keys
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPrivateKey"><span class="hs-identifier hs-type">PersistPrivateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621682447287"><span class="annot"><span class="annottext">serializeXPrv :: (IcarusKey 'RootK XPrv, PassphraseHash) -&gt; (ByteString, ByteString)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#serializeXPrv"><span class="hs-identifier hs-var hs-var hs-var hs-var">serializeXPrv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682447285"><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682447285"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447284"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682447284"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (IcarusKey 'RootK XPrv -&gt; ByteString)
-&gt; IcarusKey 'RootK XPrv
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; ByteString)
-&gt; (IcarusKey 'RootK XPrv -&gt; XPrv)
-&gt; IcarusKey 'RootK XPrv
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv -&gt; XPrv
forall (depth :: Depth) raw. IcarusKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">(IcarusKey 'RootK XPrv -&gt; ByteString)
-&gt; IcarusKey 'RootK XPrv -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682447285"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; ByteString)
-&gt; (PassphraseHash -&gt; ScrubbedBytes)
-&gt; PassphraseHash
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash -&gt; ScrubbedBytes
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#getPassphraseHash"><span class="hs-identifier hs-var hs-var">getPassphraseHash</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseHash -&gt; ByteString) -&gt; PassphraseHash -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682447284"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>    </span><span id="local-6989586621682447282"><span class="annot"><span class="annottext">unsafeDeserializeXPrv :: (ByteString, ByteString) -&gt; (IcarusKey 'RootK XPrv, PassphraseHash)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#unsafeDeserializeXPrv"><span class="hs-identifier hs-var hs-var hs-var hs-var">unsafeDeserializeXPrv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682447280"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447280"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682447279"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447279"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; (IcarusKey 'RootK XPrv, PassphraseHash))
-&gt; ((IcarusKey 'RootK XPrv, PassphraseHash)
    -&gt; (IcarusKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (IcarusKey 'RootK XPrv, PassphraseHash)
-&gt; (IcarusKey 'RootK XPrv, PassphraseHash)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; (IcarusKey 'RootK XPrv, PassphraseHash)
forall p a. p -&gt; a
</span><a href="#local-6989586621682447278"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(IcarusKey 'RootK XPrv, PassphraseHash)
-&gt; (IcarusKey 'RootK XPrv, PassphraseHash)
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String (IcarusKey 'RootK XPrv, PassphraseHash)
 -&gt; (IcarusKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (IcarusKey 'RootK XPrv, PassphraseHash)
-&gt; (IcarusKey 'RootK XPrv, PassphraseHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>        </span><span class="annot"><span class="annottext">(IcarusKey 'RootK XPrv
 -&gt; PassphraseHash -&gt; (IcarusKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (IcarusKey 'RootK XPrv)
-&gt; Either
     String (PassphraseHash -&gt; (IcarusKey 'RootK XPrv, PassphraseHash))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; IcarusKey 'RootK XPrv)
-&gt; Either String XPrv -&gt; Either String (IcarusKey 'RootK XPrv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; IcarusKey 'RootK XPrv
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPrv
</span><a href="#local-6989586621682447276"><span class="hs-identifier hs-var">xprvFromText</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447280"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="annottext">Either
  String (PassphraseHash -&gt; (IcarusKey 'RootK XPrv, PassphraseHash))
-&gt; Either String PassphraseHash
-&gt; Either String (IcarusKey 'RootK XPrv, PassphraseHash)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; PassphraseHash)
-&gt; Either String ScrubbedBytes -&gt; Either String PassphraseHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; PassphraseHash
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-var">PassphraseHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either String ScrubbedBytes
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682447279"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-435"></span><span>        </span><span id="local-6989586621682447276"><span class="annot"><span class="annottext">xprvFromText :: ByteString -&gt; Either String XPrv
</span><a href="#local-6989586621682447276"><span class="hs-identifier hs-var hs-var">xprvFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPrv
forall bin. ByteArrayAccess bin =&gt; bin -&gt; Either String XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String XPrv)
-&gt; (ByteString -&gt; Either String ByteString)
-&gt; ByteString
-&gt; Either String XPrv
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray ByteString =&gt; ByteString -&gt; Either String ByteString
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span id="local-6989586621682447278"><span class="annot"><span class="annottext">err :: p -&gt; a
</span><a href="#local-6989586621682447278"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeDeserializeXPrv: unable to deserialize IcarusKey&quot;</span></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span id="local-6989586621682447274"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPublicKey"><span class="hs-identifier hs-type">PersistPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682447274"><span class="hs-identifier hs-type">depth</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621682447270"><span class="annot"><span class="annottext">serializeXPub :: IcarusKey depth XPub -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#serializeXPub"><span class="hs-identifier hs-var hs-var hs-var hs-var">serializeXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (IcarusKey depth XPub -&gt; ByteString)
-&gt; IcarusKey depth XPub
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ByteString)
-&gt; (IcarusKey depth XPub -&gt; XPub)
-&gt; IcarusKey depth XPub
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IcarusKey depth XPub -&gt; XPub
forall (depth :: Depth) raw. IcarusKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>    </span><span id="local-6989586621682447268"><span class="annot"><span class="annottext">unsafeDeserializeXPub :: ByteString -&gt; IcarusKey depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#unsafeDeserializeXPub"><span class="hs-identifier hs-var hs-var hs-var hs-var">unsafeDeserializeXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; IcarusKey depth XPub)
-&gt; (XPub -&gt; IcarusKey depth XPub)
-&gt; Either String XPub
-&gt; IcarusKey depth XPub
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IcarusKey depth XPub
forall p a. p -&gt; a
</span><a href="#local-6989586621682447266"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; IcarusKey depth XPub
forall (depth :: Depth) key. key -&gt; IcarusKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-var">IcarusKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String XPub -&gt; IcarusKey depth XPub)
-&gt; (ByteString -&gt; Either String XPub)
-&gt; ByteString
-&gt; IcarusKey depth XPub
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPub
</span><a href="#local-6989586621682447265"><span class="hs-identifier hs-var">xpubFromText</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-445"></span><span>        </span><span id="local-6989586621682447265"><span class="annot"><span class="annottext">xpubFromText :: ByteString -&gt; Either String XPub
</span><a href="#local-6989586621682447265"><span class="hs-identifier hs-var hs-var">xpubFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">CC.xpub</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String XPub)
-&gt; (ByteString -&gt; Either String ByteString)
-&gt; ByteString
-&gt; Either String XPub
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray ByteString =&gt; ByteString -&gt; Either String ByteString
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span id="local-6989586621682447266"><span class="annot"><span class="annottext">err :: p -&gt; a
</span><a href="#local-6989586621682447266"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeDeserializeXPub: unable to deserialize IcarusKey&quot;</span></span></span><span>
</span><span id="line-447"></span></pre></body></html>