<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- Copyright: &#169; 2018-2020 IOHK</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Provides wallet layer functions that are used by API layer. Uses both</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- &quot;Cardano.Wallet.DB&quot; and &quot;Cardano.Wallet.Network&quot; to realize its role as</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- being intermediary between the three.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- Functions of the wallet layer are often parameterized with variables</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- following the convention below:</span><span>
</span><span id="line-31"></span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- - @s@: A __s__tate used to keep track of known addresses. Typically, possible</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   values for this parameter are described in 'Cardano.Wallet.AddressDiscovery' sub-modules.</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   For instance @SeqState@ or @Rnd State@.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- - @k@: A __k__ey derivation scheme intrinsically connected to the underlying discovery</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   state @s@. This describes how the hierarchical structure of a wallet is</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   defined as well as the relationship between secret keys and public</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   addresses.</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Development</span></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- $Development</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- * WalletLayer</span></span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#WalletLayer"><span class="hs-identifier">WalletLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Capabilities</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="hs-comment">-- $Capabilities</span></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier">HasDBLayer</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier">dbLayer</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier">HasLogger</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#logger"><span class="hs-identifier">logger</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier">HasNetworkLayer</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier">networkLayer</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier">HasTransactionLayer</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier">transactionLayer</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasGenesisData"><span class="hs-identifier">HasGenesisData</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier">genesisData</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Interface</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Wallet</span></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier">createWallet</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#createIcarusWallet"><span class="hs-identifier">createIcarusWallet</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#attachPrivateKeyFromPwd"><span class="hs-identifier">attachPrivateKeyFromPwd</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdHash"><span class="hs-identifier">attachPrivateKeyFromPwdHash</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#getWalletUtxoSnapshot"><span class="hs-identifier">getWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#listUtxoStatistics"><span class="hs-identifier">listUtxoStatistics</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier">readWallet</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#deleteWallet"><span class="hs-identifier">deleteWallet</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#restoreWallet"><span class="hs-identifier">restoreWallet</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#updateWallet"><span class="hs-identifier">updateWallet</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#updateWalletPassphraseWithOldPassphrase"><span class="hs-identifier">updateWalletPassphraseWithOldPassphrase</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#updateWalletPassphraseWithMnemonic"><span class="hs-identifier">updateWalletPassphraseWithMnemonic</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#walletSyncProgress"><span class="hs-identifier">walletSyncProgress</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#fetchRewardBalance"><span class="hs-identifier">fetchRewardBalance</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier">manageRewardBalance</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#rollbackBlocks"><span class="hs-identifier">rollbackBlocks</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#checkWalletIntegrity"><span class="hs-identifier">checkWalletIntegrity</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#readNextWithdrawal"><span class="hs-identifier">readNextWithdrawal</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier">readRewardAccount</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#someRewardAccount"><span class="hs-identifier">someRewardAccount</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier">readPolicyPublicKey</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#writePolicyPublicKey"><span class="hs-identifier">writePolicyPublicKey</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#queryRewardBalance"><span class="hs-identifier">queryRewardBalance</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier">ErrWalletAlreadyExists</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatistics"><span class="hs-identifier">ErrListUTxOStatistics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphrase"><span class="hs-identifier">ErrUpdatePassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewards"><span class="hs-identifier">ErrFetchRewards</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCheckWalletIntegrity"><span class="hs-identifier">ErrCheckWalletIntegrity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier">ErrWalletNotResponding</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier">ErrReadRewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKey"><span class="hs-identifier">ErrReadPolicyPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKey"><span class="hs-identifier">ErrWritePolicyPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyId"><span class="hs-identifier">ErrGetPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Shared Wallet</span></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#updateCosigner"><span class="hs-identifier">updateCosigner</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier">ErrAddCosignerKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWallet"><span class="hs-identifier">ErrConstructSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#normalizeSharedAddress"><span class="hs-identifier">normalizeSharedAddress</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#constructSharedTransaction"><span class="hs-identifier">constructSharedTransaction</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Address</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#createRandomAddress"><span class="hs-identifier">createRandomAddress</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#importRandomAddresses"><span class="hs-identifier">importRandomAddresses</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#listAddresses"><span class="hs-identifier">listAddresses</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#normalizeDelegationAddress"><span class="hs-identifier">normalizeDelegationAddress</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier">lookupTxIns</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#lookupTxOuts"><span class="hs-identifier">lookupTxOuts</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateRandomAddress"><span class="hs-identifier">ErrCreateRandomAddress</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrImportRandomAddress"><span class="hs-identifier">ErrImportRandomAddress</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#ErrImportAddress"><span class="hs-identifier">ErrImportAddress</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTx"><span class="hs-identifier">ErrDecodeTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Payment</span></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier">getTxExpiry</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier">SelectAssetsParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier">selectAssets</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier">readWalletUTxOIndex</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier">assignChangeAddresses</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#assignChangeAddressesAndUpdateDb"><span class="hs-identifier">assignChangeAddressesAndUpdateDb</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#assignChangeAddressesWithoutDbUpdate"><span class="hs-identifier">assignChangeAddressesWithoutDbUpdate</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier">selectionToUnsignedTx</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier">buildAndSignTransaction</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#signTransaction"><span class="hs-identifier">signTransaction</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#constructTransaction"><span class="hs-identifier">constructTransaction</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#constructTxMeta"><span class="hs-identifier">constructTxMeta</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier">ErrSelectAssets</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPayment"><span class="hs-identifier">ErrSignPayment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrNotASequentialWallet"><span class="hs-identifier">ErrNotASequentialWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier">ErrWithdrawalNotWorth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier">ErrConstructTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrMintBurnAssets"><span class="hs-identifier">ErrMintBurnAssets</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier">ErrBalanceTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier">ErrBalanceTxInternalError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrUpdateSealedTx"><span class="hs-identifier">ErrUpdateSealedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotJoin"><span class="hs-identifier">ErrCannotJoin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotQuit"><span class="hs-identifier">ErrCannotQuit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransaction"><span class="hs-identifier">ErrSubmitTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Migration</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#createMigrationPlan"><span class="hs-identifier">createMigrationPlan</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#migrationPlanToSelectionWithdrawals"><span class="hs-identifier">migrationPlanToSelectionWithdrawals</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#SelectionWithoutChange"><span class="hs-identifier">SelectionWithoutChange</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlan"><span class="hs-identifier">ErrCreateMigrationPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Delegation</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PoolRetirementEpochInfo"><span class="hs-identifier">PoolRetirementEpochInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#joinStakePool"><span class="hs-identifier">joinStakePool</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#quitStakePool"><span class="hs-identifier">quitStakePool</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#guardJoin"><span class="hs-identifier">guardJoin</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#guardQuit"><span class="hs-identifier">guardQuit</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegation"><span class="hs-identifier">ErrStakePoolDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Fee Estimation</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier">FeeEstimation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier">estimateFee</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#calcMinimumDeposit"><span class="hs-identifier">calcMinimumDeposit</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#calcMinimumCoinValues"><span class="hs-identifier">calcMinimumCoinValues</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Transaction</span></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#forgetTx"><span class="hs-identifier">forgetTx</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#listTransactions"><span class="hs-identifier">listTransactions</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#listAssets"><span class="hs-identifier">listAssets</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#getTransaction"><span class="hs-identifier">getTransaction</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#submitExternalTx"><span class="hs-identifier">submitExternalTx</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier">submitTx</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#balanceTransaction"><span class="hs-identifier">balanceTransaction</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier">PartialTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#LocalTxSubmissionConfig"><span class="hs-identifier">LocalTxSubmissionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#defaultLocalTxSubmissionConfig"><span class="hs-identifier">defaultLocalTxSubmissionConfig</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#runLocalTxSubmissionPool"><span class="hs-identifier">runLocalTxSubmissionPool</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransaction"><span class="hs-identifier">ErrMkTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTx"><span class="hs-identifier">ErrSubmitTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier">ErrRemoveTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier">ErrPostTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactions"><span class="hs-identifier">ErrListTransactions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransaction"><span class="hs-identifier">ErrGetTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier">ErrNoSuchTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier">ErrStartTimeLaterThanEndTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTx"><span class="hs-identifier">ErrWitnessTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Root Key</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier">withRootKey</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#derivePublicKey"><span class="hs-identifier">derivePublicKey</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#getAccountPublicKeyAtIndex"><span class="hs-identifier">getAccountPublicKeyAtIndex</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#readAccountPublicKey"><span class="hs-identifier">readAccountPublicKey</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#signMetadataWith"><span class="hs-identifier">signMetadataWith</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier">ErrWithRootKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#ErrWrongPassphrase"><span class="hs-identifier">ErrWrongPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWith"><span class="hs-identifier">ErrSignMetadataWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKey"><span class="hs-identifier">ErrDerivePublicKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKey"><span class="hs-identifier">ErrReadAccountPublicKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier">ErrInvalidDerivationIndex</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Utilities</span></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#throttle"><span class="hs-identifier">throttle</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier">guardHardIndex</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier">withNoSuchWallet</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#posAndNegFromCardanoValue"><span class="hs-identifier">posAndNegFromCardanoValue</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Logging</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier">WalletWorkerLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier">WalletFollowLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletLog"><span class="hs-identifier">WalletLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier">TxSubmitLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">log</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Derivation</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">XPub</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Script</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cosigner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">KeyHash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Style.Shared</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">deriveDelegationPublicKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">serialiseToCBOR</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Data.Severity</span></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Severity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Data.Tracer</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">HasPrivacyAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HasSeverityAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">toXPub</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">Cardano.Slotting.Slot</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html"><span class="hs-identifier">Cardano.Wallet.Address.Book</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier">AddressBookIso</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Prologue"><span class="hs-identifier">Prologue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier">getPrologue</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html"><span class="hs-identifier">Cardano.Wallet.Checkpoints</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#DeltaCheckpoints"><span class="hs-identifier">DeltaCheckpoints</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#SparseCheckpointsConfig"><span class="hs-identifier">SparseCheckpointsConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#defaultSparseCheckpointsConfig"><span class="hs-identifier">defaultSparseCheckpointsConfig</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#sparseCheckpoints"><span class="hs-identifier">sparseCheckpoints</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html"><span class="hs-identifier">Cardano.Wallet.CoinSelection</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier">Selection</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionBalanceError"><span class="hs-identifier">SelectionBalanceError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionCollateralRequirement"><span class="hs-identifier">SelectionCollateralRequirement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionConstraints"><span class="hs-identifier">SelectionConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionError"><span class="hs-identifier">SelectionError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier">SelectionOf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputError"><span class="hs-identifier">SelectionOutputError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionParams"><span class="hs-identifier">SelectionParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionReportDetailed"><span class="hs-identifier">SelectionReportDetailed</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionReportSummarized"><span class="hs-identifier">SelectionReportSummarized</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionSkeleton"><span class="hs-identifier">SelectionSkeleton</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategy"><span class="hs-identifier">SelectionStrategy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#UnableToConstructChangeError"><span class="hs-identifier">UnableToConstructChangeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier">WalletSelectionContext</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier">WalletUTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#emptySkeleton"><span class="hs-identifier">emptySkeleton</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#makeSelectionReportDetailed"><span class="hs-identifier">makeSelectionReportDetailed</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#makeSelectionReportSummarized"><span class="hs-identifier">makeSelectionReportSummarized</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#performSelection"><span class="hs-identifier">performSelection</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html"><span class="hs-identifier">Cardano.Wallet.CoinSelection.Internal.Balance</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionLimitOf"><span class="hs-identifier">SelectionLimitOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#NoLimit"><span class="hs-identifier">NoLimit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html"><span class="hs-identifier">Cardano.Wallet.DB</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier">DBLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier">ErrNoSuchTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmission"><span class="hs-identifier">ErrPutLocalTxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier">ErrRemoveTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier">ErrWalletAlreadyExists</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html"><span class="hs-identifier">Cardano.Wallet.DB.WalletState</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier">DeltaWalletState1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier">adjustNoSuchWallet</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#fromWallet"><span class="hs-identifier">fromWallet</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier">getLatest</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getSlot"><span class="hs-identifier">getSlot</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html"><span class="hs-identifier">Cardano.Wallet.Logging</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketLog"><span class="hs-identifier">BracketLog</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketLog%27"><span class="hs-identifier">BracketLog'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#bracketTracer"><span class="hs-identifier">bracketTracer</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#formatResultMsg"><span class="hs-identifier">formatResultMsg</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#resultSeverity"><span class="hs-identifier">resultSeverity</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#traceResult"><span class="hs-identifier">traceResult</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#unliftIOTracer"><span class="hs-identifier">unliftIOTracer</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html"><span class="hs-identifier">Cardano.Wallet.Network</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ChainFollowLog"><span class="hs-identifier">ChainFollowLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ChainFollower"><span class="hs-identifier">ChainFollower</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier">ErrPostTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier">NetworkLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier">BoundedAddressLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier">DelegationAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier">Depth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationPrefix"><span class="hs-identifier">DerivationPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationType"><span class="hs-identifier">DerivationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier">HardDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier">MkKeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier">NetworkDiscriminant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier">Role</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier">SoftDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#ToRewardAccount"><span class="hs-identifier">ToRewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier">WalletKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveRewardAccount"><span class="hs-identifier">deriveRewardAccount</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hashVerificationKey"><span class="hs-identifier">hashVerificationKey</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftIndex"><span class="hs-identifier">liftIndex</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#stakeDerivationPath"><span class="hs-identifier">stakeDerivationPath</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Byron</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier">ByronKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Icarus</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier">IcarusKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.MintBurn</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#derivePolicyPrivateKey"><span class="hs-identifier">derivePolicyPrivateKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#policyDerivationPath"><span class="hs-identifier">policyDerivationPath</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.SharedKey</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier">SharedKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Shelley</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier">ShelleyKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAccountPrivateKeyShelley"><span class="hs-identifier">deriveAccountPrivateKeyShelley</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#CompareDiscovery"><span class="hs-identifier">CompareDiscovery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier">GenChange</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier">GetAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier">GetPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier">IsOurs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier">IsOwned</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#KnownAddresses"><span class="hs-identifier">KnownAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier">MaybeLight</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Random</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#ErrImportAddress"><span class="hs-identifier">ErrImportAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndStateLike"><span class="hs-identifier">RndStateLike</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Sequential</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier">SeqState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier">defaultAddressPoolGap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#mkSeqStateFromRootXPrv"><span class="hs-identifier">mkSeqStateFromRootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeBIP44"><span class="hs-identifier">purposeBIP44</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Shared</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#CredentialType"><span class="hs-identifier">CredentialType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrAddCosigner"><span class="hs-identifier">ErrAddCosigner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrScriptTemplate"><span class="hs-identifier">ErrScriptTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier">SharedState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#addCosignerAccXPub"><span class="hs-identifier">addCosignerAccXPub</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.BlockSummary.html"><span class="hs-identifier">Cardano.Wallet.Primitive.BlockSummary</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.BlockSummary.html#ChainEvents"><span class="hs-identifier">ChainEvents</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Migration</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html#MigrationPlan"><span class="hs-identifier">MigrationPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Model</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#BlockData"><span class="hs-identifier">BlockData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier">Wallet</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#applyBlocks"><span class="hs-identifier">applyBlocks</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier">availableUTxO</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier">currentTip</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#firstHeader"><span class="hs-identifier">firstHeader</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier">getState</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#initWallet"><span class="hs-identifier">initWallet</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#totalUTxO"><span class="hs-identifier">totalUTxO</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#ErrWrongPassphrase"><span class="hs-identifier">ErrWrongPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier">Passphrase</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier">PassphraseHash</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier">PassphraseScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#WalletPassphraseInfo"><span class="hs-identifier">WalletPassphraseInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#checkPassphrase"><span class="hs-identifier">checkPassphrase</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier">currentPassphraseScheme</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#encryptPassphrase%27"><span class="hs-identifier">encryptPassphrase'</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier">preparePassphrase</span></a></span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Slotting</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier">PastHorizonException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier">TimeInterpreter</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier">addRelTime</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#ceilingSlotAt"><span class="hs-identifier">ceilingSlotAt</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#currentRelativeTime"><span class="hs-identifier">currentRelativeTime</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier">interpretQuery</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier">neverFails</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#slotRangeFromTimeRange"><span class="hs-identifier">slotRangeFromTimeRange</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier">slotToUTCTime</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier">unsafeExtendSafeZone</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html"><span class="hs-identifier">Cardano.Wallet.Primitive.SyncProgress</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier">SyncProgress</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ActiveSlotCoefficient"><span class="hs-identifier">ActiveSlotCoefficient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier">Block</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier">BlockHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ChainPoint"><span class="hs-identifier">ChainPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#DelegationCertificate"><span class="hs-identifier">DelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#FeePolicy"><span class="hs-identifier">FeePolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#LinearFee"><span class="hs-identifier">LinearFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#GenesisParameters"><span class="hs-identifier">GenesisParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#IsDelegatingTo"><span class="hs-identifier">IsDelegatingTo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#LinearFunction"><span class="hs-identifier">LinearFunction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#LinearFunction"><span class="hs-identifier">LinearFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier">NetworkParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier">PoolId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier">PoolLifeCycleStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ProtocolParameters"><span class="hs-identifier">ProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Range"><span class="hs-identifier">Range</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Signature"><span class="hs-identifier">Signature</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier">Slot</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SlottingParameters"><span class="hs-identifier">SlottingParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier">SortOrder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier">WalletDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegationStatus"><span class="hs-identifier">WalletDelegationStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier">WalletId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier">WalletMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletName"><span class="hs-identifier">WalletName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">WithOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#dlgCertPoolId"><span class="hs-identifier">dlgCertPoolId</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#toSlot"><span class="hs-identifier">toSlot</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#wholeRange"><span class="hs-identifier">wholeRange</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Address</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#AddressState"><span class="hs-identifier">AddressState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Hash</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier">Hash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Redeemer.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Redeemer</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#Redeemer"><span class="hs-identifier">Redeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.RewardAccount</span></a></span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier">RewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier">TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenPolicy</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenName"><span class="hs-identifier">TokenName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#UnsafeTokenName"><span class="hs-identifier">UnsafeTokenName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier">TokenPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#UnsafeTokenPolicyId"><span class="hs-identifier">UnsafeTokenPolicyId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenQuantity</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier">TokenQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier">TokenQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Direction"><span class="hs-identifier">Direction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#LocalTxSubmissionStatus"><span class="hs-identifier">LocalTxSubmissionStatus</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier">SealedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier">TransactionInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier">Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxChange"><span class="hs-identifier">TxChange</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier">TxMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier">TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxSize"><span class="hs-identifier">TxSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxStatus"><span class="hs-identifier">TxStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#UnsignedTx"><span class="hs-identifier">UnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#fromTransactionInfo"><span class="hs-identifier">fromTransactionInfo</span></a></span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#sealedTxFromCardano"><span class="hs-identifier">sealedTxFromCardano</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier">txOutCoin</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Awithdrawals%3ATx"><span class="hs-identifier">withdrawals</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxO</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxO"><span class="hs-identifier">UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxOStatistics"><span class="hs-identifier">UTxOStatistics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#computeUtxoStatistics"><span class="hs-identifier">computeUtxoStatistics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#log10"><span class="hs-identifier">log10</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxOIndex</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#UTxOIndex"><span class="hs-identifier">UTxOIndex</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxOSelection</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#UTxOSelection"><span class="hs-identifier">UTxOSelection</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html"><span class="hs-identifier">Cardano.Wallet.Transaction</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#DelegationAction"><span class="hs-identifier">DelegationAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemers"><span class="hs-identifier">ErrAssignRedeemers</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotJoin"><span class="hs-identifier">ErrCannotJoin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotQuit"><span class="hs-identifier">ErrCannotQuit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransaction"><span class="hs-identifier">ErrMkTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMoreSurplusNeeded"><span class="hs-identifier">ErrMoreSurplusNeeded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMoreSurplusNeeded"><span class="hs-identifier">ErrMoreSurplusNeeded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrSignTx"><span class="hs-identifier">ErrSignTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrUpdateSealedTx"><span class="hs-identifier">ErrUpdateSealedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier">TransactionCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier">TransactionLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TxFeeAndChange"><span class="hs-identifier">TxFeeAndChange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TxFeeAndChange"><span class="hs-identifier">TxFeeAndChange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TxFeeUpdate"><span class="hs-identifier">TxFeeUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TxUpdate"><span class="hs-identifier">TxUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier">Withdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier">defaultTransactionCtx</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#withdrawalToCoin"><span class="hs-identifier">withdrawalToCoin</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Arrow</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">first</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">left</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">NFData</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">replicateM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">when</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">DiffTime</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadMonotonicTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">Time</span></a></span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">diffTime</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">getCurrentTime</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">Control.Monad.IO.Unlift</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">MonadUnliftIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier">Control.Monad.Random.Class</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier">MonadRandom</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Random.Extra.html"><span class="hs-identifier">Control.Monad.Random.Extra</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Control.Monad.Random.Extra.html#StdGenSeed"><span class="hs-identifier">StdGenSeed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Random.Extra.html#stdGenFromSeed"><span class="hs-identifier">stdGenFromSeed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Random.Extra.html#stdGenSeed"><span class="hs-identifier">stdGenSeed</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier">Control.Monad.Random.Strict</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier">evalRand</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Class</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">lift</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Except</span></a></span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">catchE</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">except</span></a></span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">mapExceptT</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">runExceptT</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">throwE</span></a></span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">withExceptT</span></a></span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">MaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">maybeToExceptT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.State</span></a></span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">evalState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">runState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">state</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">Control.Tracer</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">Tracer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">contramap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">traceWith</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash</span></a></span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Blake2b_256</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">hash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.DBVar</span></a></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">modifyDBMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Either</span></a></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">partitionEithers</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">Data.Either.Extra</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">eitherToMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fold</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor</span></a></span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">($&gt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL.Lens</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Lens'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(.~)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Labels</span></a></span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Product.Typed</span></a></span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">HasType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">typed</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../int-cast/html/src"><span class="hs-identifier">Data.IntCast</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../int-cast/html/src"><span class="hs-identifier">intCast</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../int-cast/html/src"><span class="hs-identifier">intCastMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Kind</span></a></span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">Type</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">foldl'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isJust</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Quantity.html"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span>
</span><span id="line-554"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">Data.Text.Class</span></a></span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">ToText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">NominalDiffTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">UTCTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Type.Equality</span></a></span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(:~:)</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">testEquality</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Void</span></a></span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word64</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-566"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">Buildable</span></a></span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Builder</span></a></span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">blockListF</span></a></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">blockMapF</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">build</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">listF'</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">nameF</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">pretty</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">unlinesF</span></a></span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-operator">(+|)</span></a></span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-operator">(+||)</span></a></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-operator">(|+)</span></a></span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-operator">(||+)</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Numeric.Natural</span></a></span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Natural</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../safe/html/src"><span class="hs-identifier">Safe</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../safe/html/src"><span class="hs-identifier">lastMay</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../statistics/html/src"><span class="hs-identifier">Statistics.Quantile</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../statistics/html/src"><span class="hs-identifier">medianUnbiased</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../statistics/html/src"><span class="hs-identifier">quantiles</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../pretty-simple/html/src"><span class="hs-identifier">Text.Pretty.Simple</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../pretty-simple/html/src"><span class="hs-identifier">pShow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Type.Reflection</span></a></span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">typeRep</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span>
</span><span id="line-593"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">catch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">throwIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.MVar</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">modifyMVar_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">newMVar</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Script</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CA</span></span><span>
</span><span id="line-598"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Style.Shared</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CA</span></span><span>
</span><span id="line-599"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-600"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api.Shelley</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-601"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-602"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.Policy.html"><span class="hs-identifier">Cardano.Wallet.Checkpoints.Policy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CP</span></span><span>
</span><span id="line-603"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html"><span class="hs-identifier">Cardano.Wallet.CoinSelection</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CS</span></span><span>
</span><span id="line-604"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Random</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rnd</span></span><span>
</span><span id="line-605"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Sequential</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-606"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Shared</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shared</span></span><span>
</span><span id="line-607"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Migration</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Migration</span></span><span>
</span><span id="line-608"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-609"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Coin</span></span><span>
</span><span id="line-610"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenBundle</span></span><span>
</span><span id="line-611"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenMap</span></span><span>
</span><span id="line-612"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxO</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-613"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxOIndex</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxOIndex</span></span><span>
</span><span id="line-614"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxOSelection</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxOSelection</span></span><span>
</span><span id="line-615"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier">Data.ByteArray</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-616"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-617"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-618"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-619"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-620"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-621"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../vector/html/src"><span class="hs-identifier">Data.Vector</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="hs-comment">-- $Development</span><span>
</span><span id="line-624"></span><span class="hs-comment">-- __Naming Conventions__</span><span>
</span><span id="line-625"></span><span class="hs-comment">--</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- Components inside a particular context `ctx` can be called via dedicated</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- lenses (see Cardano.Wallet#Capabilities). These components are extracted from the context</span><span>
</span><span id="line-628"></span><span class="hs-comment">-- in a @where@ clause according to the following naming convention:</span><span>
</span><span id="line-629"></span><span class="hs-comment">--</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- - @db = ctx ^. dbLayer \@s \\@k@ for the 'DBLayer'.</span><span>
</span><span id="line-631"></span><span class="hs-comment">-- - @tr = ctx ^. logger@ for the Logger.</span><span>
</span><span id="line-632"></span><span class="hs-comment">-- - @nw = ctx ^. networkLayer@ for the 'NetworkLayer'.</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- - @tl = ctx ^. transactionLayer \\@k@ for the 'TransactionLayer'.</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- - @re = ctx ^. workerRegistry@ for the 'WorkerRegistry'.</span><span>
</span><span id="line-635"></span><span class="hs-comment">--</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- __TroubleShooting__</span><span>
</span><span id="line-637"></span><span class="hs-comment">--</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- &#8226; Overlapping instances for HasType (DBLayer IO s k) ctx</span><span>
</span><span id="line-640"></span><span class="hs-comment">--     arising from a use of &#8216;myFunction&#8217;</span><span>
</span><span id="line-641"></span><span class="hs-comment">--   Matching instances:</span><span>
</span><span id="line-642"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-643"></span><span class="hs-comment">--</span><span>
</span><span id="line-644"></span><span class="hs-comment">-- Occurs when a particular function is missing a top-level constraint</span><span>
</span><span id="line-645"></span><span class="hs-comment">-- (because it uses another function that demands such constraint). Here,</span><span>
</span><span id="line-646"></span><span class="hs-comment">-- `myFunction` needs its surrounding context `ctx` to have a `DBLayer` but</span><span>
</span><span id="line-647"></span><span class="hs-comment">-- the constraint is missing from its host function.</span><span>
</span><span id="line-648"></span><span class="hs-comment">--</span><span>
</span><span id="line-649"></span><span class="hs-comment">-- __Fix__: Add &quot;@HasDBLayer s k@&quot; as a class-constraint to the surrounding function.</span><span>
</span><span id="line-650"></span><span class="hs-comment">--</span><span>
</span><span id="line-651"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-652"></span><span class="hs-comment">-- &#8226; Overlapping instances for HasType (DBLayer IO s t0 k0) ctx</span><span>
</span><span id="line-653"></span><span class="hs-comment">--     arising from a use of &#8216;myFunction&#8217;</span><span>
</span><span id="line-654"></span><span class="hs-comment">--   Matching givens (or their superclasses):</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-656"></span><span class="hs-comment">--</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- Occurs when a function is called in a context where type-level parameters</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- can be inferred. Here, `myFunction` is called but it is unclear</span><span>
</span><span id="line-659"></span><span class="hs-comment">-- whether the parameter `t0` and `k0` of its context are the same as the ones</span><span>
</span><span id="line-660"></span><span class="hs-comment">-- from the function at the call-site.</span><span>
</span><span id="line-661"></span><span class="hs-comment">--</span><span>
</span><span id="line-662"></span><span class="hs-comment">-- __Fix__: Add type-applications at the call-site &quot;@myFunction \@ctx \@s \\@k@&quot;</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span id="local-6989586621682463934"><span id="local-6989586621682463935"></span></span><span class="hs-keyword">data</span><span> </span><span id="WalletLayer"><span class="annot"><a href="Cardano.Wallet.html#WalletLayer"><span class="hs-identifier hs-var">WalletLayer</span></a></span></span><span> </span><span id="local-6989586621682463933"><span class="annot"><a href="#local-6989586621682463933"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682463932"><span class="annot"><a href="#local-6989586621682463932"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463931"><span class="annot"><a href="#local-6989586621682463931"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier hs-type">Depth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="WalletLayer"><span class="annot"><a href="Cardano.Wallet.html#WalletLayer"><span class="hs-identifier hs-var">WalletLayer</span></a></span></span><span>
</span><span id="line-666"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463931"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463932"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463931"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. WalletLayer m s k -&gt; Rep (WalletLayer m s k) x)
-&gt; (forall x. Rep (WalletLayer m s k) x -&gt; WalletLayer m s k)
-&gt; Generic (WalletLayer m s k)
forall x. Rep (WalletLayer m s k) x -&gt; WalletLayer m s k
forall x. WalletLayer m s k -&gt; Rep (WalletLayer m s k) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) x.
Rep (WalletLayer m s k) x -&gt; WalletLayer m s k
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) x.
WalletLayer m s k -&gt; Rep (WalletLayer m s k) x
$cto :: forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) x.
Rep (WalletLayer m s k) x -&gt; WalletLayer m s k
$cfrom :: forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) x.
WalletLayer m s k -&gt; Rep (WalletLayer m s k) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                 Capabilities
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="hs-comment">-- $Capabilities</span><span>
</span><span id="line-678"></span><span class="hs-comment">-- Each function in the wallet layer is defined in function of a non-specialized</span><span>
</span><span id="line-679"></span><span class="hs-comment">-- context `ctx`. That context may require some extra capabilities via</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- class-constraints in the function signature. Capabilities are expressed in the</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- form of a &quot;@HasXXX@&quot; class-constraints sometimes with extra type parameters.</span><span>
</span><span id="line-682"></span><span class="hs-comment">--</span><span>
</span><span id="line-683"></span><span class="hs-comment">-- For example:</span><span>
</span><span id="line-684"></span><span class="hs-comment">--</span><span>
</span><span id="line-685"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-686"></span><span class="hs-comment">-- listWallets</span><span>
</span><span id="line-687"></span><span class="hs-comment">--     :: forall ctx s k.</span><span>
</span><span id="line-688"></span><span class="hs-comment">--         ( HasDBLayer s k ctx</span><span>
</span><span id="line-689"></span><span class="hs-comment">--         )</span><span>
</span><span id="line-690"></span><span class="hs-comment">--     =&gt; ctx</span><span>
</span><span id="line-691"></span><span class="hs-comment">--     -&gt; IO [WalletId]</span><span>
</span><span id="line-692"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-693"></span><span class="hs-comment">--</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- Requires that the given context has an access to a database layer 'DBLayer'</span><span>
</span><span id="line-695"></span><span class="hs-comment">-- parameterized over the wallet state, a network target and a key derivation</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- scheme. Components are pulled from the context generically (i.e. the concrete</span><span>
</span><span id="line-697"></span><span class="hs-comment">-- `ctx` must derive 'Generic') using their associated type. The concrete `ctx`</span><span>
</span><span id="line-698"></span><span class="hs-comment">-- is therefore expected to be a product-type of all the necessary components.</span><span>
</span><span id="line-699"></span><span class="hs-comment">--</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- One can build an interface using only a subset of the wallet layer</span><span>
</span><span id="line-701"></span><span class="hs-comment">-- capabilities and functions, for instance, something to fiddle with wallets</span><span>
</span><span id="line-702"></span><span class="hs-comment">-- and their metadata does not require any networking layer.</span><span>
</span><span id="line-703"></span><span class="hs-keyword">type</span><span> </span><span id="HasDBLayer"><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-var">HasDBLayer</span></a></span></span><span> </span><span id="local-6989586621682463926"><span class="annot"><a href="#local-6989586621682463926"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682463925"><span class="annot"><a href="#local-6989586621682463925"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463924"><span class="annot"><a href="#local-6989586621682463924"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">HasType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463926"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463925"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463924"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-keyword">type</span><span> </span><span id="HasGenesisData"><span class="annot"><a href="Cardano.Wallet.html#HasGenesisData"><span class="hs-identifier hs-var">HasGenesisData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">HasType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-keyword">type</span><span> </span><span id="HasLogger"><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-var">HasLogger</span></a></span></span><span> </span><span id="local-6989586621682463923"><span class="annot"><a href="#local-6989586621682463923"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682463922"><span class="annot"><a href="#local-6989586621682463922"><span class="hs-identifier hs-type">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">HasType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463923"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463922"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="hs-comment">-- | This module is only interested in one block-, and tx-type. This constraint</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- hides that choice, for some ease of use.</span><span>
</span><span id="line-711"></span><span class="hs-keyword">type</span><span> </span><span id="HasNetworkLayer"><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-var">HasNetworkLayer</span></a></span></span><span> </span><span id="local-6989586621682463921"><span class="annot"><a href="#local-6989586621682463921"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">HasType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-keyword">type</span><span> </span><span id="HasTransactionLayer"><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-var">HasTransactionLayer</span></a></span></span><span> </span><span id="local-6989586621682463920"><span class="annot"><a href="#local-6989586621682463920"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">HasType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463920"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="annot"><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-type">dbLayer</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465269"><span class="annot"><a href="#local-6989586621682465269"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682465268"><span class="annot"><a href="#local-6989586621682465268"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682465267"><span class="annot"><a href="#local-6989586621682465267"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682465271"><span class="annot"><a href="#local-6989586621682465271"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465269"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465267"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465271"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465271"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465269"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465267"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span id="dbLayer"><span class="annot"><span class="annottext">dbLayer :: Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var hs-var">dbLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-719"></span><span>    </span><span class="annot"><span class="annottext">forall s.
HasType (DBLayer m s k) s =&gt;
Lens s s (DBLayer m s k) (DBLayer m s k)
forall a s. HasType a s =&gt; Lens s s a a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">typed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465269"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465267"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="annot"><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier hs-type">genesisData</span></a></span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463919"><span class="annot"><a href="#local-6989586621682463919"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasGenesisData"><span class="hs-identifier hs-type">HasGenesisData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463919"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463919"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span id="genesisData"><span class="annot"><span class="annottext">genesisData :: Lens' ctx (Block, NetworkParameters)
</span><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier hs-var hs-var">genesisData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-725"></span><span>    </span><span class="annot"><span class="annottext">forall s.
HasType (Block, NetworkParameters) s =&gt;
Lens s s (Block, NetworkParameters) (Block, NetworkParameters)
forall a s. HasType a s =&gt; Lens s s a a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">typed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span class="annot"><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465095"><span class="annot"><a href="#local-6989586621682465095"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682465094"><span class="annot"><a href="#local-6989586621682465094"><span class="hs-identifier hs-type">msg</span></a></span></span><span> </span><span id="local-6989586621682465097"><span class="annot"><a href="#local-6989586621682465097"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465095"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465094"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465097"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465097"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465095"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465094"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span id="logger"><span class="annot"><span class="annottext">logger :: Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><span class="annottext">forall s.
HasType (Tracer m msg) s =&gt;
Lens s s (Tracer m msg) (Tracer m msg)
forall a s. HasType a s =&gt; Lens s s a a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">typed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465095"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465094"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span class="annot"><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-type">networkLayer</span></a></span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465203"><span class="annot"><a href="#local-6989586621682465203"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682465202"><span class="annot"><a href="#local-6989586621682465202"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465203"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465202"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465202"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465203"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span id="networkLayer"><span class="annot"><span class="annottext">networkLayer :: Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var hs-var">networkLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-737"></span><span>    </span><span class="annot"><span class="annottext">forall s.
HasType (NetworkLayer m Block) s =&gt;
Lens s s (NetworkLayer m Block) (NetworkLayer m Block)
forall a s. HasType a s =&gt; Lens s s a a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">typed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465203"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="annot"><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-type">transactionLayer</span></a></span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465150"><span class="annot"><a href="#local-6989586621682465150"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682465152"><span class="annot"><a href="#local-6989586621682465152"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465150"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465152"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465152"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465150"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span id="transactionLayer"><span class="annot"><span class="annottext">transactionLayer :: Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var hs-var">transactionLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-743"></span><span>    </span><span class="annot"><span class="annottext">forall s.
HasType (TransactionLayer k SealedTx) s =&gt;
Lens
  s s (TransactionLayer k SealedTx) (TransactionLayer k SealedTx)
forall a s. HasType a s =&gt; Lens s s a a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">typed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465150"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                   Wallet
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">-- | Initialise and store a new wallet, returning its ID.</span><span>
</span><span id="line-750"></span><span class="annot"><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-type">createWallet</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463918"><span class="annot"><a href="#local-6989586621682463918"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463917"><span class="annot"><a href="#local-6989586621682463917"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682463916"><span class="annot"><a href="#local-6989586621682463916"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463915"><span class="annot"><a href="#local-6989586621682463915"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463917"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-753"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463917"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-754"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasGenesisData"><span class="hs-identifier hs-type">HasGenesisData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463918"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-755"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463916"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463915"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463918"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-756"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463916"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463916"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463918"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletName"><span class="hs-identifier hs-type">WalletName</span></a></span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463916"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-764"></span><span id="createWallet"><span class="annot"><span class="annottext">createWallet :: ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var hs-var">createWallet</span></a></span></span><span> </span><span id="local-6989586621682463914"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463914"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463913"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463913"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463912"><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682463912"><span class="hs-identifier hs-var">wname</span></a></span></span><span> </span><span id="local-6989586621682463911"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463911"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer m s k
</span><a href="#local-6989586621682463910"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer m s k
-&gt; (DBLayer m s k -&gt; ExceptT ErrWalletAlreadyExists m WalletId)
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463883"><span id="local-6989586621682463884"><span id="local-6989586621682463885"><span id="local-6989586621682463886"><span id="local-6989586621682463887"><span id="local-6989586621682463888"><span id="local-6989586621682463889"><span id="local-6989586621682463890"><span id="local-6989586621682463891"><span id="local-6989586621682463892"><span id="local-6989586621682463893"><span id="local-6989586621682463894"><span id="local-6989586621682463895"><span id="local-6989586621682463896"><span id="local-6989586621682463897"><span id="local-6989586621682463898"><span id="local-6989586621682463899"><span id="local-6989586621682463900"><span id="local-6989586621682463901"><span id="local-6989586621682463902"><span id="local-6989586621682463903"><span id="local-6989586621682463904"><span id="local-6989586621682463905"><span id="local-6989586621682463906"><span id="local-6989586621682463907"><span id="local-6989586621682463908"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; m a
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
atomically :: forall a. stm a -&gt; m a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
</span><a href="Cardano.Wallet.DB.html#atomically"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463856"><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463856"><span class="hs-identifier hs-var">hist</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463855"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463855"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block -&gt; s -&gt; ([(Tx, TxMeta)], Wallet s)
forall s.
(IsOurs s Address, IsOurs s RewardAccount) =&gt;
Block -&gt; s -&gt; ([(Tx, TxMeta)], Wallet s)
</span><a href="Cardano.Wallet.Primitive.Model.html#initWallet"><span class="hs-identifier hs-var">initWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621682463854"><span class="hs-identifier hs-var">block0</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463911"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span id="local-6989586621682463853"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682463853"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m UTCTime -&gt; ExceptT ErrWalletAlreadyExists m UTCTime
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">m UTCTime
forall (m :: * -&gt; *). MonadTime m =&gt; m UTCTime
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463852"><span class="annot"><span class="annottext">meta :: WalletMetadata
</span><a href="#local-6989586621682463852"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletMetadata :: WalletName
-&gt; UTCTime
-&gt; Maybe WalletPassphraseInfo
-&gt; WalletDelegation
-&gt; WalletMetadata
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-768"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:name:WalletMetadata :: WalletName
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Aname%3AWalletMetadata"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682463912"><span class="hs-identifier hs-var">wname</span></a></span><span>
</span><span id="line-769"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:creationTime:WalletMetadata :: UTCTime
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AcreationTime%3AWalletMetadata"><span class="hs-identifier hs-var">creationTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682463853"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-770"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:passphraseInfo:WalletMetadata :: Maybe WalletPassphraseInfo
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3ApassphraseInfo%3AWalletMetadata"><span class="hs-identifier hs-var">passphraseInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe WalletPassphraseInfo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-771"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegation:WalletMetadata :: WalletDelegation
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Adelegation%3AWalletMetadata"><span class="hs-identifier hs-var">delegation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
-&gt; [WalletDelegationNext] -&gt; WalletDelegation
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-var">WalletDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="Cardano.Wallet.Primitive.Types.html#NotDelegating"><span class="hs-identifier hs-var">NotDelegating</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-772"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrWalletAlreadyExists WalletId)
 -&gt; m (Either ErrWalletAlreadyExists WalletId))
-&gt; ExceptT ErrWalletAlreadyExists stm WalletId
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWalletAlreadyExists WalletId)
-&gt; m (Either ErrWalletAlreadyExists WalletId)
forall a. stm a -&gt; m a
</span><a href="#local-6989586621682463883"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWalletAlreadyExists stm WalletId
 -&gt; ExceptT ErrWalletAlreadyExists m WalletId)
-&gt; ExceptT ErrWalletAlreadyExists stm WalletId
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-774"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
</span><a href="#local-6989586621682463908"><span class="hs-identifier hs-var">initializeWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463913"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463855"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682463852"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463856"><span class="hs-identifier hs-var">hist</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463844"><span class="hs-identifier hs-var">gp</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrWalletAlreadyExists stm ()
-&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists stm WalletId
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463913"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-776"></span><span>    </span><span id="local-6989586621682463910"><span class="annot"><span class="annottext">db :: DBLayer m s k
</span><a href="#local-6989586621682463910"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463914"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer m s k -&gt; Const (DBLayer m s k) (DBLayer m s k))
    -&gt; ctx -&gt; Const (DBLayer m s k) ctx)
-&gt; DBLayer m s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer m s k ctx =&gt; Lens' ctx (DBLayer m s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463916"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463915"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-777"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682463854"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621682463854"><span class="hs-identifier hs-var">block0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span> </span><span id="local-6989586621682463844"><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463844"><span class="hs-identifier hs-var">gp</span></a></span></span><span> </span><span id="local-6989586621682463842"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682463842"><span class="hs-identifier hs-var">_sp</span></a></span></span><span> </span><span id="local-6989586621682463841"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463841"><span class="hs-identifier hs-var">_pp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463914"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; (((Block, NetworkParameters)
     -&gt; Const (Block, NetworkParameters) (Block, NetworkParameters))
    -&gt; ctx -&gt; Const (Block, NetworkParameters) ctx)
-&gt; (Block, NetworkParameters)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">((Block, NetworkParameters)
 -&gt; Const (Block, NetworkParameters) (Block, NetworkParameters))
-&gt; ctx -&gt; Const (Block, NetworkParameters) ctx
forall s.
HasType (Block, NetworkParameters) s =&gt;
Lens s s (Block, NetworkParameters) (Block, NetworkParameters)
</span><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier hs-var">genesisData</span></a></span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span class="hs-comment">-- | Initialise and store a new legacy Icarus wallet. These wallets are</span><span>
</span><span id="line-780"></span><span class="hs-comment">-- intrinsically sequential, but, in the incentivized testnet, we only have</span><span>
</span><span id="line-781"></span><span class="hs-comment">-- access to the a snapshot of the MainNet.</span><span>
</span><span id="line-782"></span><span class="hs-comment">--</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- To work-around this, we scan the genesis block with an arbitrary big gap and</span><span>
</span><span id="line-784"></span><span class="hs-comment">-- resort to a default gap afterwards.</span><span>
</span><span id="line-785"></span><span class="annot"><a href="Cardano.Wallet.html#createIcarusWallet"><span class="hs-identifier hs-type">createIcarusWallet</span></a></span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463840"><span class="annot"><a href="#local-6989586621682463840"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463839"><span class="annot"><a href="#local-6989586621682463839"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463838"><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682463837"><span class="annot"><a href="#local-6989586621682463837"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasGenesisData"><span class="hs-identifier hs-type">HasGenesisData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463840"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463839"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463840"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463837"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682463839"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463837"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-792"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463837"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463840"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-795"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-796"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletName"><span class="hs-identifier hs-type">WalletName</span></a></span><span>
</span><span id="line-797"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-799"></span><span id="createIcarusWallet"><span class="annot"><span class="annottext">createIcarusWallet :: ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="Cardano.Wallet.html#createIcarusWallet"><span class="hs-identifier hs-var hs-var">createIcarusWallet</span></a></span></span><span> </span><span id="local-6989586621682463836"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463836"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463835"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463835"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463834"><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682463834"><span class="hs-identifier hs-var">wname</span></a></span></span><span> </span><span id="local-6989586621682463833"><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682463833"><span class="hs-identifier hs-var">credentials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463832"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463806"><span id="local-6989586621682463807"><span id="local-6989586621682463808"><span id="local-6989586621682463809"><span id="local-6989586621682463810"><span id="local-6989586621682463811"><span id="local-6989586621682463812"><span id="local-6989586621682463813"><span id="local-6989586621682463814"><span id="local-6989586621682463815"><span id="local-6989586621682463816"><span id="local-6989586621682463817"><span id="local-6989586621682463818"><span id="local-6989586621682463819"><span id="local-6989586621682463820"><span id="local-6989586621682463821"><span id="local-6989586621682463822"><span id="local-6989586621682463823"><span id="local-6989586621682463824"><span id="local-6989586621682463825"><span id="local-6989586621682463826"><span id="local-6989586621682463827"><span id="local-6989586621682463828"><span id="local-6989586621682463829"><span id="local-6989586621682463830"><span id="local-6989586621682463831"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463806"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463805"><span class="annot"><span class="annottext">g :: AddressPoolGap
</span><a href="#local-6989586621682463805"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier hs-var">defaultAddressPoolGap</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463804"><span class="annot"><span class="annottext">s :: SeqState n k
</span><a href="#local-6989586621682463804"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Index 'Hardened 'PurposeK -&gt; AddressPoolGap -&gt; SeqState n k
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
(WalletKey k, SupportsDiscovery n k, (k == SharedKey) ~ 'False) =&gt;
(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Index 'Hardened 'PurposeK -&gt; AddressPoolGap -&gt; SeqState n k
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#mkSeqStateFromRootXPrv"><span class="hs-identifier hs-var">mkSeqStateFromRootXPrv</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463837"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682463833"><span class="hs-identifier hs-var">credentials</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeBIP44"><span class="hs-identifier hs-var">purposeBIP44</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="#local-6989586621682463805"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463803"><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463803"><span class="hs-identifier hs-var">hist</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463802"><span class="annot"><span class="annottext">Wallet (SeqState n k)
</span><a href="#local-6989586621682463802"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block -&gt; SeqState n k -&gt; ([(Tx, TxMeta)], Wallet (SeqState n k))
forall s.
(IsOurs s Address, IsOurs s RewardAccount) =&gt;
Block -&gt; s -&gt; ([(Tx, TxMeta)], Wallet s)
</span><a href="Cardano.Wallet.Primitive.Model.html#initWallet"><span class="hs-identifier hs-var">initWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621682463801"><span class="hs-identifier hs-var">block0</span></a></span><span> </span><span class="annot"><span class="annottext">SeqState n k
</span><a href="#local-6989586621682463804"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-803"></span><span>    </span><span id="local-6989586621682463800"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682463800"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; ExceptT ErrWalletAlreadyExists IO UTCTime
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
forall (m :: * -&gt; *). MonadTime m =&gt; m UTCTime
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-804"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463799"><span class="annot"><span class="annottext">meta :: WalletMetadata
</span><a href="#local-6989586621682463799"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletMetadata :: WalletName
-&gt; UTCTime
-&gt; Maybe WalletPassphraseInfo
-&gt; WalletDelegation
-&gt; WalletMetadata
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-805"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:name:WalletMetadata :: WalletName
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Aname%3AWalletMetadata"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682463834"><span class="hs-identifier hs-var">wname</span></a></span><span>
</span><span id="line-806"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:creationTime:WalletMetadata :: UTCTime
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AcreationTime%3AWalletMetadata"><span class="hs-identifier hs-var">creationTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682463800"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-807"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:passphraseInfo:WalletMetadata :: Maybe WalletPassphraseInfo
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3ApassphraseInfo%3AWalletMetadata"><span class="hs-identifier hs-var">passphraseInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe WalletPassphraseInfo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-808"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegation:WalletMetadata :: WalletDelegation
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Adelegation%3AWalletMetadata"><span class="hs-identifier hs-var">delegation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
-&gt; [WalletDelegationNext] -&gt; WalletDelegation
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-var">WalletDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="Cardano.Wallet.Primitive.Types.html#NotDelegating"><span class="hs-identifier hs-var">NotDelegating</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-809"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-810"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrWalletAlreadyExists WalletId)
 -&gt; IO (Either ErrWalletAlreadyExists WalletId))
-&gt; ExceptT ErrWalletAlreadyExists stm WalletId
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWalletAlreadyExists WalletId)
-&gt; IO (Either ErrWalletAlreadyExists WalletId)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463806"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWalletAlreadyExists stm WalletId
 -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; ExceptT ErrWalletAlreadyExists stm WalletId
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-811"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
</span><a href="#local-6989586621682463831"><span class="hs-identifier hs-var">initializeWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463835"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
Wallet (SeqState n k)
</span><a href="#local-6989586621682463802"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682463799"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463803"><span class="hs-identifier hs-var">hist</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463798"><span class="hs-identifier hs-var">gp</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrWalletAlreadyExists stm ()
-&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists stm WalletId
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463835"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-812"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-813"></span><span>    </span><span id="local-6989586621682463832"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463832"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463836"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463839"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463838"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-814"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682463801"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621682463801"><span class="hs-identifier hs-var">block0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span> </span><span id="local-6989586621682463798"><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463798"><span class="hs-identifier hs-var">gp</span></a></span></span><span> </span><span id="local-6989586621682463797"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682463797"><span class="hs-identifier hs-var">_sp</span></a></span></span><span> </span><span id="local-6989586621682463796"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463796"><span class="hs-identifier hs-var">_pp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463836"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; (((Block, NetworkParameters)
     -&gt; Const (Block, NetworkParameters) (Block, NetworkParameters))
    -&gt; ctx -&gt; Const (Block, NetworkParameters) ctx)
-&gt; (Block, NetworkParameters)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">((Block, NetworkParameters)
 -&gt; Const (Block, NetworkParameters) (Block, NetworkParameters))
-&gt; ctx -&gt; Const (Block, NetworkParameters) ctx
forall s.
HasType (Block, NetworkParameters) s =&gt;
Lens s s (Block, NetworkParameters) (Block, NetworkParameters)
</span><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier hs-var">genesisData</span></a></span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span class="hs-comment">-- | Check whether a wallet is in good shape when restarting a worker.</span><span>
</span><span id="line-817"></span><span class="annot"><a href="Cardano.Wallet.html#checkWalletIntegrity"><span class="hs-identifier hs-type">checkWalletIntegrity</span></a></span><span>
</span><span id="line-818"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463795"><span class="annot"><a href="#local-6989586621682463795"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463794"><span class="annot"><a href="#local-6989586621682463794"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463793"><span class="annot"><a href="#local-6989586621682463793"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463794"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463793"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463795"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-819"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463795"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-821"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#GenesisParameters"><span class="hs-identifier hs-type">GenesisParameters</span></a></span><span>
</span><span id="line-822"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCheckWalletIntegrity"><span class="hs-identifier hs-type">ErrCheckWalletIntegrity</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span id="checkWalletIntegrity"><span class="annot"><span class="annottext">checkWalletIntegrity :: ctx
-&gt; WalletId
-&gt; GenesisParameters
-&gt; ExceptT ErrCheckWalletIntegrity IO ()
</span><a href="Cardano.Wallet.html#checkWalletIntegrity"><span class="hs-identifier hs-var hs-var">checkWalletIntegrity</span></a></span></span><span> </span><span id="local-6989586621682463792"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463792"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463791"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463791"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463790"><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463790"><span class="hs-identifier hs-var">gp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463789"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrCheckWalletIntegrity IO ())
-&gt; ExceptT ErrCheckWalletIntegrity IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463763"><span id="local-6989586621682463764"><span id="local-6989586621682463765"><span id="local-6989586621682463766"><span id="local-6989586621682463767"><span id="local-6989586621682463768"><span id="local-6989586621682463769"><span id="local-6989586621682463770"><span id="local-6989586621682463771"><span id="local-6989586621682463772"><span id="local-6989586621682463773"><span id="local-6989586621682463774"><span id="local-6989586621682463775"><span id="local-6989586621682463776"><span id="local-6989586621682463777"><span id="local-6989586621682463778"><span id="local-6989586621682463779"><span id="local-6989586621682463780"><span id="local-6989586621682463781"><span id="local-6989586621682463782"><span id="local-6989586621682463783"><span id="local-6989586621682463784"><span id="local-6989586621682463785"><span id="local-6989586621682463786"><span id="local-6989586621682463787"><span id="local-6989586621682463788"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463763"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrCheckWalletIntegrity ())
 -&gt; IO (Either ErrCheckWalletIntegrity ()))
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
-&gt; ExceptT ErrCheckWalletIntegrity IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrCheckWalletIntegrity ())
-&gt; IO (Either ErrCheckWalletIntegrity ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463763"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCheckWalletIntegrity stm ()
 -&gt; ExceptT ErrCheckWalletIntegrity IO ())
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
-&gt; ExceptT ErrCheckWalletIntegrity IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-824"></span><span>    </span><span id="local-6989586621682463762"><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463762"><span class="hs-identifier hs-var">gp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrCheckWalletIntegrity)
-&gt; ExceptT ErrNoSuchWallet stm GenesisParameters
-&gt; ExceptT ErrCheckWalletIntegrity stm GenesisParameters
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrCheckWalletIntegrity
</span><a href="Cardano.Wallet.html#ErrCheckWalletIntegrityNoSuchWallet"><span class="hs-identifier hs-var">ErrCheckWalletIntegrityNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm GenesisParameters
 -&gt; ExceptT ErrCheckWalletIntegrity stm GenesisParameters)
-&gt; ExceptT ErrNoSuchWallet stm GenesisParameters
-&gt; ExceptT ErrCheckWalletIntegrity stm GenesisParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe GenesisParameters)
-&gt; ExceptT ErrNoSuchWallet stm GenesisParameters
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463791"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe GenesisParameters)
 -&gt; ExceptT ErrNoSuchWallet stm GenesisParameters)
-&gt; stm (Maybe GenesisParameters)
-&gt; ExceptT ErrNoSuchWallet stm GenesisParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-825"></span><span>        </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe GenesisParameters)
</span><a href="#local-6989586621682463766"><span class="hs-identifier hs-var">readGenesisParameters</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463791"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><span class="annottext">GenesisParameters
-&gt; GenesisParameters
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
forall (f :: * -&gt; *) a a s s.
(Applicative f, Eq a, Eq a, HasField' &quot;getGenesisBlockDate&quot; s a,
 HasField' &quot;getGenesisBlockDate&quot; s a,
 HasField' &quot;getGenesisBlockHash&quot; s a,
 HasField' &quot;getGenesisBlockHash&quot; s a) =&gt;
s -&gt; s -&gt; f () -&gt; f ()
</span><a href="#local-6989586621682463760"><span class="hs-identifier hs-var">whenDifferentGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463790"><span class="hs-identifier hs-var">gp</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463790"><span class="hs-identifier hs-var">gp</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCheckWalletIntegrity stm ()
 -&gt; ExceptT ErrCheckWalletIntegrity stm ())
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCheckWalletIntegrity -&gt; ExceptT ErrCheckWalletIntegrity stm ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrCheckWalletIntegrity -&gt; ExceptT ErrCheckWalletIntegrity stm ())
-&gt; ErrCheckWalletIntegrity
-&gt; ExceptT ErrCheckWalletIntegrity stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-828"></span><span>        </span><span class="annot"><span class="annottext">Hash &quot;Genesis&quot; -&gt; Hash &quot;Genesis&quot; -&gt; ErrCheckWalletIntegrity
</span><a href="Cardano.Wallet.html#ErrCheckIntegrityDifferentGenesis"><span class="hs-identifier hs-var">ErrCheckIntegrityDifferentGenesis</span></a></span><span>
</span><span id="line-829"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenesisParameters -&gt; Hash &quot;Genesis&quot;
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AgetGenesisBlockHash%3AGenesisParameters"><span class="hs-identifier hs-var hs-var">getGenesisBlockHash</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463790"><span class="hs-identifier hs-var">gp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenesisParameters -&gt; Hash &quot;Genesis&quot;
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AgetGenesisBlockHash%3AGenesisParameters"><span class="hs-identifier hs-var hs-var">getGenesisBlockHash</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682463762"><span class="hs-identifier hs-var">gp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-832"></span><span>    </span><span id="local-6989586621682463789"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463789"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463792"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463794"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463793"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-833"></span><span>    </span><span id="local-6989586621682463760"><span class="annot"><span class="annottext">whenDifferentGenesis :: s -&gt; s -&gt; f () -&gt; f ()
</span><a href="#local-6989586621682463760"><span class="hs-identifier hs-var hs-var">whenDifferentGenesis</span></a></span></span><span> </span><span id="local-6989586621682463757"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463757"><span class="hs-identifier hs-var">bp1</span></a></span></span><span> </span><span id="local-6989586621682463756"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463756"><span class="hs-identifier hs-var">bp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; f () -&gt; f ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; f () -&gt; f ()) -&gt; Bool -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-834"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463757"><span class="hs-identifier hs-var">bp1</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;getGenesisBlockHash&quot; ((a -&gt; Const a a) -&gt; s -&gt; Const a s)
(a -&gt; Const a a) -&gt; s -&gt; Const a s
</span><a href="#local-6989586621682463755"><span class="hs-var">#getGenesisBlockHash</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463756"><span class="hs-identifier hs-var">bp2</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;getGenesisBlockHash&quot; ((a -&gt; Const a a) -&gt; s -&gt; Const a s)
(a -&gt; Const a a) -&gt; s -&gt; Const a s
</span><a href="#local-6989586621682463753"><span class="hs-var">#getGenesisBlockHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-835"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463757"><span class="hs-identifier hs-var">bp1</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;getGenesisBlockDate&quot; ((a -&gt; Const a a) -&gt; s -&gt; Const a s)
(a -&gt; Const a a) -&gt; s -&gt; Const a s
</span><a href="#local-6989586621682463751"><span class="hs-var">#getGenesisBlockDate</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463756"><span class="hs-identifier hs-var">bp2</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;getGenesisBlockDate&quot; ((a -&gt; Const a a) -&gt; s -&gt; Const a s)
(a -&gt; Const a a) -&gt; s -&gt; Const a s
</span><a href="#local-6989586621682463750"><span class="hs-var">#getGenesisBlockDate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span class="hs-comment">-- | Retrieve the wallet state for the wallet with the given ID.</span><span>
</span><span id="line-838"></span><span class="annot"><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-type">readWallet</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465173"><span class="annot"><a href="#local-6989586621682465173"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682465175"><span class="annot"><a href="#local-6989586621682465175"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682465174"><span class="annot"><a href="#local-6989586621682465174"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465175"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465174"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465173"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465173"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-841"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-842"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465175"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span id="readWallet"><span class="annot"><span class="annottext">readWallet :: ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var hs-var">readWallet</span></a></span></span><span> </span><span id="local-6989586621682463749"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463749"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463748"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463748"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463747"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463721"><span id="local-6989586621682463722"><span id="local-6989586621682463723"><span id="local-6989586621682463724"><span id="local-6989586621682463725"><span id="local-6989586621682463726"><span id="local-6989586621682463727"><span id="local-6989586621682463728"><span id="local-6989586621682463729"><span id="local-6989586621682463730"><span id="local-6989586621682463731"><span id="local-6989586621682463732"><span id="local-6989586621682463733"><span id="local-6989586621682463734"><span id="local-6989586621682463735"><span id="local-6989586621682463736"><span id="local-6989586621682463737"><span id="local-6989586621682463738"><span id="local-6989586621682463739"><span id="local-6989586621682463740"><span id="local-6989586621682463741"><span id="local-6989586621682463742"><span id="local-6989586621682463743"><span id="local-6989586621682463744"><span id="local-6989586621682463745"><span id="local-6989586621682463746"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463721"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s, WalletMetadata, Set Tx))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s, WalletMetadata, Set Tx)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s, WalletMetadata, Set Tx))
-&gt; IO (Either ErrNoSuchWallet (Wallet s, WalletMetadata, Set Tx))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463721"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s, WalletMetadata, Set Tx)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-844"></span><span>    </span><span id="local-6989586621682463720"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463720"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463748"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463741"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463748"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-845"></span><span>    </span><span id="local-6989586621682463719"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682463719"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463748"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe WalletMetadata)
 -&gt; ExceptT ErrNoSuchWallet stm WalletMetadata)
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe WalletMetadata)
</span><a href="#local-6989586621682463738"><span class="hs-identifier hs-var">readWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463748"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-846"></span><span>    </span><span id="local-6989586621682463718"><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682463718"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">stm [TransactionInfo]
-&gt; ExceptT ErrNoSuchWallet stm [TransactionInfo]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(stm [TransactionInfo]
 -&gt; ExceptT ErrNoSuchWallet stm [TransactionInfo])
-&gt; stm [TransactionInfo]
-&gt; ExceptT ErrNoSuchWallet stm [TransactionInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
</span><a href="#local-6989586621682463732"><span class="hs-identifier hs-var">readTxHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463748"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">SortOrder
</span><a href="Cardano.Wallet.Primitive.Types.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span> </span><span class="annot"><span class="annottext">Range SlotNo
forall a. Range a
</span><a href="Cardano.Wallet.Primitive.Types.html#wholeRange"><span class="hs-identifier hs-var">wholeRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; Maybe TxStatus
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>    </span><span class="annot"><span class="annottext">(Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s, WalletMetadata, Set Tx)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463720"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682463719"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Tx] -&gt; Set Tx
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionInfo -&gt; Tx
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#fromTransactionInfo"><span class="hs-identifier hs-var">fromTransactionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(TransactionInfo -&gt; Tx) -&gt; [TransactionInfo] -&gt; [Tx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682463718"><span class="hs-identifier hs-var">pending</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621682463747"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463747"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463749"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465175"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465174"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="annot"><a href="Cardano.Wallet.html#walletSyncProgress"><span class="hs-identifier hs-type">walletSyncProgress</span></a></span><span>
</span><span id="line-852"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463713"><span class="annot"><a href="#local-6989586621682463713"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463712"><span class="annot"><a href="#local-6989586621682463712"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463713"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-853"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463713"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-854"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463712"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-855"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span><span>
</span><span id="line-856"></span><span id="walletSyncProgress"><span class="annot"><span class="annottext">walletSyncProgress :: ctx -&gt; Wallet s -&gt; IO SyncProgress
</span><a href="Cardano.Wallet.html#walletSyncProgress"><span class="hs-identifier hs-var hs-var">walletSyncProgress</span></a></span></span><span> </span><span id="local-6989586621682463711"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463711"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463710"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463710"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-857"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463709"><span class="annot"><span class="annottext">tip :: SlotNo
</span><a href="#local-6989586621682463709"><span class="hs-identifier hs-var hs-var">tip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SlotNo -&gt; Const SlotNo SlotNo)
 -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; BlockHeader -&gt; SlotNo
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682463708"><span class="hs-var">#slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; SlotNo) -&gt; BlockHeader -&gt; SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463710"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-858"></span><span>    </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; SlotNo -&gt; IO SyncProgress
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; SlotNo -&gt; m SyncProgress
</span><a href="Cardano.Wallet.Network.html#syncProgress"><span class="hs-identifier hs-var hs-var">syncProgress</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463706"><span class="hs-identifier hs-var">nl</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682463709"><span class="hs-identifier hs-var">tip</span></a></span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-860"></span><span>    </span><span id="local-6989586621682463706"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682463706"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463711"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span class="hs-comment">-- | Update a wallet's metadata with the given update function.</span><span>
</span><span id="line-863"></span><span class="annot"><a href="Cardano.Wallet.html#updateWallet"><span class="hs-identifier hs-type">updateWallet</span></a></span><span>
</span><span id="line-864"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463705"><span class="annot"><a href="#local-6989586621682463705"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463704"><span class="annot"><a href="#local-6989586621682463704"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463703"><span class="annot"><a href="#local-6989586621682463703"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-865"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463704"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463703"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463705"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-866"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463705"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span id="updateWallet"><span class="annot"><span class="annottext">updateWallet :: ctx
-&gt; WalletId
-&gt; (WalletMetadata -&gt; WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#updateWallet"><span class="hs-identifier hs-var hs-var">updateWallet</span></a></span></span><span> </span><span id="local-6989586621682463702"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463702"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463701"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463701"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463700"><span class="annot"><span class="annottext">WalletMetadata -&gt; WalletMetadata
</span><a href="#local-6989586621682463700"><span class="hs-identifier hs-var">modify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463699"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463673"><span id="local-6989586621682463674"><span id="local-6989586621682463675"><span id="local-6989586621682463676"><span id="local-6989586621682463677"><span id="local-6989586621682463678"><span id="local-6989586621682463679"><span id="local-6989586621682463680"><span id="local-6989586621682463681"><span id="local-6989586621682463682"><span id="local-6989586621682463683"><span id="local-6989586621682463684"><span id="local-6989586621682463685"><span id="local-6989586621682463686"><span id="local-6989586621682463687"><span id="local-6989586621682463688"><span id="local-6989586621682463689"><span id="local-6989586621682463690"><span id="local-6989586621682463691"><span id="local-6989586621682463692"><span id="local-6989586621682463693"><span id="local-6989586621682463694"><span id="local-6989586621682463695"><span id="local-6989586621682463696"><span id="local-6989586621682463697"><span id="local-6989586621682463698"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463673"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ()))
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463673"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>    </span><span id="local-6989586621682463672"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682463672"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463701"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe WalletMetadata)
 -&gt; ExceptT ErrNoSuchWallet stm WalletMetadata)
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe WalletMetadata)
</span><a href="#local-6989586621682463690"><span class="hs-identifier hs-var">readWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463701"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-873"></span><span>    </span><span class="annot"><span class="annottext">WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463691"><span class="hs-identifier hs-var">putWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463701"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata -&gt; WalletMetadata
</span><a href="#local-6989586621682463700"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682463672"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-875"></span><span>    </span><span id="local-6989586621682463699"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463699"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463702"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463704"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463703"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span class="hs-comment">-- | Change a wallet's passphrase to the given passphrase.</span><span>
</span><span id="line-878"></span><span class="annot"><a href="Cardano.Wallet.html#updateWalletPassphraseWithOldPassphrase"><span class="hs-identifier hs-type">updateWalletPassphraseWithOldPassphrase</span></a></span><span>
</span><span id="line-879"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463671"><span class="annot"><a href="#local-6989586621682463671"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463670"><span class="annot"><a href="#local-6989586621682463670"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463669"><span class="annot"><a href="#local-6989586621682463669"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-880"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463670"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463669"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463671"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463669"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-882"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463671"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-885"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphrase"><span class="hs-identifier hs-type">ErrUpdatePassphrase</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span id="updateWalletPassphraseWithOldPassphrase"><span class="annot"><span class="annottext">updateWalletPassphraseWithOldPassphrase :: ctx
-&gt; WalletId
-&gt; (Passphrase &quot;user&quot;, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
</span><a href="Cardano.Wallet.html#updateWalletPassphraseWithOldPassphrase"><span class="hs-identifier hs-var hs-var">updateWalletPassphraseWithOldPassphrase</span></a></span></span><span> </span><span id="local-6989586621682463668"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463668"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463667"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463667"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463666"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463666"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463665"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463665"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-888"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrUpdatePassphrase)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme -&gt; ExceptT ErrUpdatePassphrase IO ())
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463671"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463670"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463669"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463668"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463667"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463666"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrUpdatePassphrase
</span><a href="Cardano.Wallet.html#ErrUpdatePassphraseWithRootKey"><span class="hs-identifier hs-var">ErrUpdatePassphraseWithRootKey</span></a></span><span>
</span><span id="line-889"></span><span>        </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme -&gt; ExceptT ErrUpdatePassphrase IO ())
 -&gt; ExceptT ErrUpdatePassphrase IO ())
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme -&gt; ExceptT ErrUpdatePassphrase IO ())
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682463663"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682463663"><span class="hs-identifier hs-var">xprv</span></a></span></span><span> </span><span id="local-6989586621682463662"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682463662"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrUpdatePassphrase)
-&gt; ExceptT ErrNoSuchWallet IO ()
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrUpdatePassphrase
</span><a href="Cardano.Wallet.html#ErrUpdatePassphraseNoSuchWallet"><span class="hs-identifier hs-var">ErrUpdatePassphraseNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO ()
 -&gt; ExceptT ErrUpdatePassphrase IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-890"></span><span>            </span><span class="hs-comment">-- IMPORTANT NOTE:</span><span>
</span><span id="line-891"></span><span>            </span><span class="hs-comment">-- This use 'EncryptWithPBKDF2', regardless of the passphrase</span><span>
</span><span id="line-892"></span><span>            </span><span class="hs-comment">-- current scheme, we'll re-encrypt it using the current scheme,</span><span>
</span><span id="line-893"></span><span>            </span><span class="hs-comment">-- always.</span><span>
</span><span id="line-894"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463660"><span class="annot"><span class="annottext">new' :: (PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682463660"><span class="hs-identifier hs-var hs-var">new'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463665"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463659"><span class="annot"><span class="annottext">xprv' :: k 'RootK XPrv
</span><a href="#local-6989586621682463659"><span class="hs-identifier hs-var hs-var">xprv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; k 'RootK XPrv
-&gt; k 'RootK XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; key depth XPrv
-&gt; key depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#changePassphrase"><span class="hs-identifier hs-var">changePassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682463662"><span class="hs-identifier hs-var">scheme</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463666"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682463660"><span class="hs-identifier hs-var">new'</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682463663"><span class="hs-identifier hs-var">xprv</span></a></span><span>
</span><span id="line-896"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdScheme"><span class="hs-identifier hs-var">attachPrivateKeyFromPwdScheme</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463671"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463670"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463669"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463668"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463667"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682463659"><span class="hs-identifier hs-var">xprv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682463660"><span class="hs-identifier hs-var">new'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="annot"><a href="Cardano.Wallet.html#updateWalletPassphraseWithMnemonic"><span class="hs-identifier hs-type">updateWalletPassphraseWithMnemonic</span></a></span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463656"><span class="annot"><a href="#local-6989586621682463656"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463655"><span class="annot"><a href="#local-6989586621682463655"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463654"><span class="annot"><a href="#local-6989586621682463654"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-900"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463655"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463654"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463656"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463656"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-903"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-904"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682463654"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphrase"><span class="hs-identifier hs-type">ErrUpdatePassphrase</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span id="updateWalletPassphraseWithMnemonic"><span class="annot"><span class="annottext">updateWalletPassphraseWithMnemonic :: ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
</span><a href="Cardano.Wallet.html#updateWalletPassphraseWithMnemonic"><span class="hs-identifier hs-var hs-var">updateWalletPassphraseWithMnemonic</span></a></span></span><span> </span><span id="local-6989586621682463653"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463653"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463652"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463652"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463651"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682463651"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463650"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463650"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-907"></span><span>    </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrUpdatePassphrase)
-&gt; ExceptT ErrNoSuchWallet IO ()
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrUpdatePassphrase
</span><a href="Cardano.Wallet.html#ErrUpdatePassphraseNoSuchWallet"><span class="hs-identifier hs-var">ErrUpdatePassphraseNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO ()
 -&gt; ExceptT ErrUpdatePassphrase IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-908"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdScheme"><span class="hs-identifier hs-var">attachPrivateKeyFromPwdScheme</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463656"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463655"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463654"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463653"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463652"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-909"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682463651"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463650"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span class="annot"><a href="Cardano.Wallet.html#getWalletUtxoSnapshot"><span class="hs-identifier hs-type">getWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-912"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463649"><span class="annot"><a href="#local-6989586621682463649"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463648"><span class="annot"><a href="#local-6989586621682463648"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463647"><span class="annot"><a href="#local-6989586621682463647"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463648"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463647"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463649"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-914"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463649"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463647"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463649"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-916"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463649"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-918"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-920"></span><span id="getWalletUtxoSnapshot"><span class="annot"><span class="annottext">getWalletUtxoSnapshot :: ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
</span><a href="Cardano.Wallet.html#getWalletUtxoSnapshot"><span class="hs-identifier hs-var hs-var">getWalletUtxoSnapshot</span></a></span></span><span> </span><span id="local-6989586621682463646"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463646"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463645"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463645"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-921"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682463644"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463644"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463643"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682463643"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrNoSuchWallet)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrNoSuchWallet
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463649"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463648"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463647"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463646"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463645"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>    </span><span id="local-6989586621682463641"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463641"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters
-&gt; ExceptT ErrNoSuchWallet IO ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters
 -&gt; ExceptT ErrNoSuchWallet IO ProtocolParameters)
-&gt; IO ProtocolParameters
-&gt; ExceptT ErrNoSuchWallet IO ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463638"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-923"></span><span>    </span><span id="local-6989586621682463637"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463637"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; ExceptT ErrNoSuchWallet IO AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; ExceptT ErrNoSuchWallet IO AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; ExceptT ErrNoSuchWallet IO AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463638"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-924"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463635"><span class="annot"><span class="annottext">txOuts :: [TxOut]
</span><a href="#local-6989586621682463635"><span class="hs-identifier hs-var hs-var">txOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier hs-var">availableUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463648"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682463643"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463644"><span class="hs-identifier hs-var">wallet</span></a></span><span>
</span><span id="line-925"></span><span>            </span><span class="annot"><span class="annottext">UTxO -&gt; (UTxO -&gt; Map TxIn TxOut) -&gt; Map TxIn TxOut
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Map TxIn TxOut
</span><a href="Cardano.Wallet.Primitive.Types.UTxO.html#unUTxO"><span class="hs-identifier hs-var hs-var">unUTxO</span></a></span><span>
</span><span id="line-926"></span><span>            </span><span class="annot"><span class="annottext">Map TxIn TxOut -&gt; (Map TxIn TxOut -&gt; [TxOut]) -&gt; [TxOut]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span>
</span><span id="line-927"></span><span>    </span><span class="annot"><span class="annottext">[(TokenBundle, Coin)]
-&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(TokenBundle, Coin)]
 -&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)])
-&gt; [(TokenBundle, Coin)]
-&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; TokenBundle) -&gt; (TxOut, Coin) -&gt; (TokenBundle, Coin)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; TxOut -&gt; Const TokenBundle TxOut)
-&gt; TxOut -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; TxOut -&gt; Const TokenBundle TxOut)
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; TxOut -&gt; Const TokenBundle TxOut
</span><a href="#local-6989586621682463632"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TxOut, Coin) -&gt; (TokenBundle, Coin))
-&gt; (TxOut -&gt; (TxOut, Coin)) -&gt; TxOut -&gt; (TokenBundle, Coin)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra -&gt; ProtocolParameters -&gt; TxOut -&gt; (TxOut, Coin)
</span><a href="#local-6989586621682463630"><span class="hs-identifier hs-var">pairTxOutWithMinAdaQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463637"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463641"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; (TokenBundle, Coin)) -&gt; [TxOut] -&gt; [(TokenBundle, Coin)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682463635"><span class="hs-identifier hs-var">txOuts</span></a></span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-929"></span><span>    </span><span id="local-6989586621682463638"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682463638"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463646"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-930"></span><span>    </span><span id="local-6989586621682463629"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682463629"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463646"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463647"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><a href="#local-6989586621682463630"><span class="hs-identifier hs-type">pairTxOutWithMinAdaQuantity</span></a></span><span>
</span><span id="line-933"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-934"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ProtocolParameters"><span class="hs-identifier hs-type">ProtocolParameters</span></a></span><span>
</span><span id="line-935"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>    </span><span id="local-6989586621682463630"><span class="annot"><span class="annottext">pairTxOutWithMinAdaQuantity :: AnyCardanoEra -&gt; ProtocolParameters -&gt; TxOut -&gt; (TxOut, Coin)
</span><a href="#local-6989586621682463630"><span class="hs-identifier hs-var hs-var">pairTxOutWithMinAdaQuantity</span></a></span></span><span> </span><span id="local-6989586621682463628"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463628"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682463627"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463627"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621682463626"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682463626"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-938"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682463626"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="#local-6989586621682463625"><span class="hs-identifier hs-var">computeMinAdaQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682463626"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-940"></span><span>        </span><span class="annot"><a href="#local-6989586621682463625"><span class="hs-identifier hs-type">computeMinAdaQuantity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-941"></span><span>        </span><span id="local-6989586621682463625"><span class="annot"><span class="annottext">computeMinAdaQuantity :: TxOut -&gt; Coin
</span><a href="#local-6989586621682463625"><span class="hs-identifier hs-var hs-var">computeMinAdaQuantity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682463623"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463623"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682463622"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682463622"><span class="hs-identifier hs-var">bundle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-942"></span><span>            </span><span class="annot"><span class="annottext">(((Address -&gt; TokenMap -&gt; Coin)
  -&gt; Const
       (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
 -&gt; TxConstraints
 -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
-&gt; TxConstraints -&gt; Address -&gt; TokenMap -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputMinimumAdaQuantity&quot;
  (((Address -&gt; TokenMap -&gt; Coin)
    -&gt; Const
         (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
   -&gt; TxConstraints
   -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
((Address -&gt; TokenMap -&gt; Coin)
 -&gt; Const
      (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
-&gt; TxConstraints
-&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints
</span><a href="#local-6989586621682463621"><span class="hs-var">#txOutputMinimumAdaQuantity</span></a></span><span>
</span><span id="line-943"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682463629"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463628"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463627"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463623"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenMap -&gt; Const TokenMap TokenMap)
 -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenBundle -&gt; TokenMap
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682463619"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682463622"><span class="hs-identifier hs-var">bundle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="hs-comment">-- | List the wallet's UTxO statistics.</span><span>
</span><span id="line-948"></span><span class="annot"><a href="Cardano.Wallet.html#listUtxoStatistics"><span class="hs-identifier hs-type">listUtxoStatistics</span></a></span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463618"><span class="annot"><a href="#local-6989586621682463618"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463617"><span class="annot"><a href="#local-6989586621682463617"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463616"><span class="annot"><a href="#local-6989586621682463616"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463617"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463616"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463618"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-950"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463618"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-951"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-952"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatistics"><span class="hs-identifier hs-type">ErrListUTxOStatistics</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxOStatistics"><span class="hs-identifier hs-type">UTxOStatistics</span></a></span><span>
</span><span id="line-953"></span><span id="listUtxoStatistics"><span class="annot"><span class="annottext">listUtxoStatistics :: ctx -&gt; WalletId -&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics
</span><a href="Cardano.Wallet.html#listUtxoStatistics"><span class="hs-identifier hs-var hs-var">listUtxoStatistics</span></a></span></span><span> </span><span id="local-6989586621682463615"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463615"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463614"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463614"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-954"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682463613"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463613"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463612"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682463612"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrListUTxOStatistics)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT
     ErrListUTxOStatistics IO (Wallet s, WalletMetadata, Set Tx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span>
</span><span id="line-955"></span><span>        </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrListUTxOStatistics
</span><a href="Cardano.Wallet.html#ErrListUTxOStatisticsNoSuchWallet"><span class="hs-identifier hs-var">ErrListUTxOStatisticsNoSuchWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463618"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463617"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463616"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463615"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463614"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463610"><span class="annot"><span class="annottext">utxo :: UTxO
</span><a href="#local-6989586621682463610"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier hs-var">availableUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463617"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682463612"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463613"><span class="hs-identifier hs-var">wal</span></a></span><span>
</span><span id="line-957"></span><span>    </span><span class="annot"><span class="annottext">UTxOStatistics -&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxOStatistics -&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics)
-&gt; UTxOStatistics
-&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BoundType -&gt; UTxO -&gt; UTxOStatistics
</span><a href="Cardano.Wallet.Primitive.Types.UTxO.html#computeUtxoStatistics"><span class="hs-identifier hs-var">computeUtxoStatistics</span></a></span><span> </span><span class="annot"><span class="annottext">BoundType
</span><a href="Cardano.Wallet.Primitive.Types.UTxO.html#log10"><span class="hs-identifier hs-var">log10</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682463610"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span class="hs-comment">-- | Restore a wallet from its current tip.</span><span>
</span><span id="line-960"></span><span class="hs-comment">--</span><span>
</span><span id="line-961"></span><span class="hs-comment">-- After the wallet has been restored,</span><span>
</span><span id="line-962"></span><span class="hs-comment">-- this action will continue to fetch newly created blocks</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- and apply them, or roll back to a previous point whenever</span><span>
</span><span id="line-964"></span><span class="hs-comment">-- the chain switches.</span><span>
</span><span id="line-965"></span><span class="annot"><a href="Cardano.Wallet.html#restoreWallet"><span class="hs-identifier hs-type">restoreWallet</span></a></span><span>
</span><span id="line-966"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463609"><span class="annot"><a href="#local-6989586621682463609"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463608"><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463607"><span class="annot"><a href="#local-6989586621682463607"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-967"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463609"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-968"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463607"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463609"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-969"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463609"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-970"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-971"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-972"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-973"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-974"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463609"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-976"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-977"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span id="restoreWallet"><span class="annot"><span class="annottext">restoreWallet :: ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#restoreWallet"><span class="hs-identifier hs-var hs-var">restoreWallet</span></a></span></span><span> </span><span id="local-6989586621682463606"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463606"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463605"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463605"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463604"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463578"><span id="local-6989586621682463579"><span id="local-6989586621682463580"><span id="local-6989586621682463581"><span id="local-6989586621682463582"><span id="local-6989586621682463583"><span id="local-6989586621682463584"><span id="local-6989586621682463585"><span id="local-6989586621682463586"><span id="local-6989586621682463587"><span id="local-6989586621682463588"><span id="local-6989586621682463589"><span id="local-6989586621682463590"><span id="local-6989586621682463591"><span id="local-6989586621682463592"><span id="local-6989586621682463593"><span id="local-6989586621682463594"><span id="local-6989586621682463595"><span id="local-6989586621682463596"><span id="local-6989586621682463597"><span id="local-6989586621682463598"><span id="local-6989586621682463599"><span id="local-6989586621682463600"><span id="local-6989586621682463601"><span id="local-6989586621682463602"><span id="local-6989586621682463603"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463578"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-979"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463577"><span class="annot"><span class="annottext">checkpointPolicy :: BlockHeight -&gt; CheckpointPolicy
</span><a href="#local-6989586621682463577"><span class="hs-identifier hs-var hs-var">checkpointPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; CheckpointPolicy
</span><a href="Cardano.Wallet.Checkpoints.Policy.html#defaultPolicy"><span class="hs-identifier hs-var">CP.defaultPolicy</span></a></span><span>
</span><span id="line-980"></span><span>        </span><span id="local-6989586621682463575"><span class="annot"><span class="annottext">readChainPoints :: IO [ChainPoint]
</span><a href="#local-6989586621682463575"><span class="hs-identifier hs-var hs-var">readChainPoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">stm [ChainPoint] -&gt; IO [ChainPoint]
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463578"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm [ChainPoint] -&gt; IO [ChainPoint])
-&gt; stm [ChainPoint] -&gt; IO [ChainPoint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm [ChainPoint]
</span><a href="#local-6989586621682463597"><span class="hs-identifier hs-var">listCheckpoints</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463605"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-981"></span><span>        </span><span id="local-6989586621682463574"><span class="annot"><span class="annottext">rollBackward :: ChainPoint -&gt; IO ChainPoint
</span><a href="#local-6989586621682463574"><span class="hs-identifier hs-var hs-var">rollBackward</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-982"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO ChainPoint -&gt; IO ChainPoint
forall a. ExceptT ErrNoSuchWallet IO a -&gt; IO a
</span><a href="#local-6989586621682463573"><span class="hs-identifier hs-var">throwInIO</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO ChainPoint -&gt; IO ChainPoint)
-&gt; (ChainPoint -&gt; ExceptT ErrNoSuchWallet IO ChainPoint)
-&gt; ChainPoint
-&gt; IO ChainPoint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ctx -&gt; WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet IO ChainPoint
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx -&gt; WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet IO ChainPoint
</span><a href="Cardano.Wallet.html#rollbackBlocks"><span class="hs-identifier hs-var">rollbackBlocks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463607"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463606"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463605"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; ExceptT ErrNoSuchWallet IO ChainPoint)
-&gt; (ChainPoint -&gt; Slot)
-&gt; ChainPoint
-&gt; ExceptT ErrNoSuchWallet IO ChainPoint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; Slot
</span><a href="Cardano.Wallet.Primitive.Types.html#toSlot"><span class="hs-identifier hs-var">toSlot</span></a></span><span>
</span><span id="line-983"></span><span>        </span><span id="local-6989586621682463572"><span class="annot"><span class="annottext">rollForward' :: BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader -&gt; IO ()
</span><a href="#local-6989586621682463572"><span class="hs-identifier hs-var hs-var">rollForward'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682463571"><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
</span><a href="#local-6989586621682463571"><span class="hs-identifier hs-var">blockdata</span></a></span></span><span> </span><span id="local-6989586621682463570"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463570"><span class="hs-identifier hs-var">tip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; IO ()
forall a. ExceptT ErrNoSuchWallet IO a -&gt; IO a
</span><a href="#local-6989586621682463573"><span class="hs-identifier hs-var">throwInIO</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; IO ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-984"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; Tracer IO WalletFollowLog
-&gt; WalletId
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx, IsOurs s Address,
 IsOurs s RewardAccount, AddressBookIso s) =&gt;
ctx
-&gt; Tracer IO WalletFollowLog
-&gt; WalletId
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#restoreBlocks"><span class="hs-identifier hs-var">restoreBlocks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463607"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-985"></span><span>                </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463606"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WalletFollowLog -&gt; WalletWorkerLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO WalletFollowLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">WalletFollowLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWalletFollow"><span class="hs-identifier hs-var">MsgWalletFollow</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletWorkerLog
</span><a href="#local-6989586621682463567"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463605"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
</span><a href="#local-6989586621682463571"><span class="hs-identifier hs-var">blockdata</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463570"><span class="hs-identifier hs-var">tip</span></a></span><span>
</span><span id="line-986"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-987"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a. IO a -&gt; ExceptT ErrNoSuchWallet IO a
</span><a href="#local-6989586621682463566"><span class="hs-identifier hs-var">catchFromIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; IO () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (LightDiscoverTxs s)
forall s. MaybeLight s =&gt; Maybe (LightDiscoverTxs s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#maybeDiscover"><span class="hs-identifier hs-var">maybeDiscover</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; Maybe
     (ChainFollower IO ChainPoint BlockHeader (LightBlocks IO Block)
      -&gt; IO ())
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; Maybe
     (ChainFollower m ChainPoint BlockHeader (LightBlocks m Block)
      -&gt; m ())
</span><a href="Cardano.Wallet.Network.html#lightSync"><span class="hs-identifier hs-var hs-var">lightSync</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463563"><span class="hs-identifier hs-var">nw</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-988"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682463562"><span class="annot"><span class="annottext">LightDiscoverTxs s
</span><a href="#local-6989586621682463562"><span class="hs-identifier hs-var">discover</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682463561"><span class="annot"><span class="annottext">ChainFollower IO ChainPoint BlockHeader (LightBlocks IO Block)
-&gt; IO ()
</span><a href="#local-6989586621682463561"><span class="hs-identifier hs-var">sync</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-989"></span><span>            </span><span class="annot"><span class="annottext">ChainFollower IO ChainPoint BlockHeader (LightBlocks IO Block)
-&gt; IO ()
</span><a href="#local-6989586621682463561"><span class="hs-identifier hs-var">sync</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainFollower IO ChainPoint BlockHeader (LightBlocks IO Block)
 -&gt; IO ())
-&gt; ChainFollower IO ChainPoint BlockHeader (LightBlocks IO Block)
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainFollower :: forall (m :: * -&gt; *) point tip blocks.
(BlockHeight -&gt; CheckpointPolicy)
-&gt; m [point]
-&gt; (blocks -&gt; tip -&gt; m ())
-&gt; (point -&gt; m point)
-&gt; ChainFollower m point tip blocks
</span><a href="Cardano.Wallet.Network.html#ChainFollower"><span class="hs-identifier hs-type">ChainFollower</span></a></span><span>
</span><span id="line-990"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; CheckpointPolicy
checkpointPolicy :: BlockHeight -&gt; CheckpointPolicy
checkpointPolicy :: BlockHeight -&gt; CheckpointPolicy
</span><a href="Cardano.Wallet.Network.html#checkpointPolicy"><span class="hs-identifier hs-var hs-var">checkpointPolicy</span></a></span><span>
</span><span id="line-991"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IO [ChainPoint]
readChainPoints :: IO [ChainPoint]
readChainPoints :: IO [ChainPoint]
</span><a href="Cardano.Wallet.Network.html#readChainPoints"><span class="hs-identifier hs-var hs-var">readChainPoints</span></a></span><span>
</span><span id="line-992"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rollForward :: LightBlocks IO Block -&gt; BlockHeader -&gt; IO ()
</span><a href="Cardano.Wallet.Network.html#rollForward"><span class="hs-identifier hs-var">rollForward</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader -&gt; IO ()
</span><a href="#local-6989586621682463572"><span class="hs-identifier hs-var">rollForward'</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockData IO (Either Address RewardAccount) ChainEvents s
 -&gt; BlockHeader -&gt; IO ())
-&gt; (LightBlocks IO Block
    -&gt; BlockData IO (Either Address RewardAccount) ChainEvents s)
-&gt; LightBlocks IO Block
-&gt; BlockHeader
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Block
 -&gt; BlockData IO (Either Address RewardAccount) ChainEvents s)
-&gt; (BlockSummary IO (Either Address RewardAccount) ChainEvents
    -&gt; BlockData IO (Either Address RewardAccount) ChainEvents s)
-&gt; LightBlocks IO Block
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Block
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
forall (m :: * -&gt; *) addr tx s.
NonEmpty Block -&gt; BlockData m addr tx s
</span><a href="Cardano.Wallet.Primitive.Model.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LightDiscoverTxs s
-&gt; BlockSummary IO (Either Address RewardAccount) ChainEvents
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
forall (m :: * -&gt; *) addr tx s.
DiscoverTxs addr tx s
-&gt; BlockSummary m addr tx -&gt; BlockData m addr tx s
</span><a href="Cardano.Wallet.Primitive.Model.html#Summary"><span class="hs-identifier hs-var">Summary</span></a></span><span> </span><span class="annot"><span class="annottext">LightDiscoverTxs s
</span><a href="#local-6989586621682463562"><span class="hs-identifier hs-var">discover</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; IO ChainPoint
rollBackward :: ChainPoint -&gt; IO ChainPoint
rollBackward :: ChainPoint -&gt; IO ChainPoint
</span><a href="Cardano.Wallet.Network.html#rollBackward"><span class="hs-identifier hs-var hs-var">rollBackward</span></a></span><span>
</span><span id="line-994"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-995"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (LightDiscoverTxs s)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe
  (ChainFollower IO ChainPoint BlockHeader (LightBlocks IO Block)
   -&gt; IO ())
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- light-mode not available</span><span>
</span><span id="line-996"></span><span>            </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; Tracer IO ChainFollowLog
-&gt; ChainFollower IO ChainPoint BlockHeader (NonEmpty Block)
-&gt; IO ()
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; Tracer IO ChainFollowLog
-&gt; ChainFollower m ChainPoint BlockHeader (NonEmpty block)
-&gt; m ()
</span><a href="Cardano.Wallet.Network.html#chainSync"><span class="hs-identifier hs-var hs-var">chainSync</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463563"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ChainFollowLog -&gt; WalletWorkerLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO ChainFollowLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">ChainFollowLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgChainFollow"><span class="hs-identifier hs-var">MsgChainFollow</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletWorkerLog
</span><a href="#local-6989586621682463567"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ChainFollower IO ChainPoint BlockHeader (NonEmpty Block) -&gt; IO ())
-&gt; ChainFollower IO ChainPoint BlockHeader (NonEmpty Block)
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainFollower :: forall (m :: * -&gt; *) point tip blocks.
(BlockHeight -&gt; CheckpointPolicy)
-&gt; m [point]
-&gt; (blocks -&gt; tip -&gt; m ())
-&gt; (point -&gt; m point)
-&gt; ChainFollower m point tip blocks
</span><a href="Cardano.Wallet.Network.html#ChainFollower"><span class="hs-identifier hs-type">ChainFollower</span></a></span><span>
</span><span id="line-997"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; CheckpointPolicy
checkpointPolicy :: BlockHeight -&gt; CheckpointPolicy
checkpointPolicy :: BlockHeight -&gt; CheckpointPolicy
</span><a href="Cardano.Wallet.Network.html#checkpointPolicy"><span class="hs-identifier hs-var hs-var">checkpointPolicy</span></a></span><span>
</span><span id="line-998"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IO [ChainPoint]
readChainPoints :: IO [ChainPoint]
readChainPoints :: IO [ChainPoint]
</span><a href="Cardano.Wallet.Network.html#readChainPoints"><span class="hs-identifier hs-var hs-var">readChainPoints</span></a></span><span>
</span><span id="line-999"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rollForward :: NonEmpty Block -&gt; BlockHeader -&gt; IO ()
</span><a href="Cardano.Wallet.Network.html#rollForward"><span class="hs-identifier hs-var">rollForward</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader -&gt; IO ()
</span><a href="#local-6989586621682463572"><span class="hs-identifier hs-var">rollForward'</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockData IO (Either Address RewardAccount) ChainEvents s
 -&gt; BlockHeader -&gt; IO ())
-&gt; (NonEmpty Block
    -&gt; BlockData IO (Either Address RewardAccount) ChainEvents s)
-&gt; NonEmpty Block
-&gt; BlockHeader
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Block
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
forall (m :: * -&gt; *) addr tx s.
NonEmpty Block -&gt; BlockData m addr tx s
</span><a href="Cardano.Wallet.Primitive.Model.html#List"><span class="hs-identifier hs-var">List</span></a></span><span>
</span><span id="line-1000"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; IO ChainPoint
rollBackward :: ChainPoint -&gt; IO ChainPoint
rollBackward :: ChainPoint -&gt; IO ChainPoint
</span><a href="Cardano.Wallet.Network.html#rollBackward"><span class="hs-identifier hs-var hs-var">rollBackward</span></a></span><span>
</span><span id="line-1001"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1003"></span><span>    </span><span id="local-6989586621682463604"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463604"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463606"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463607"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1004"></span><span>    </span><span id="local-6989586621682463563"><span class="annot"><span class="annottext">nw :: NetworkLayer IO Block
</span><a href="#local-6989586621682463563"><span class="hs-identifier hs-var hs-var">nw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463606"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasNetworkLayer IO ctx =&gt;
Lens' ctx (NetworkLayer IO Block)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-1005"></span><span>    </span><span id="local-6989586621682463567"><span class="annot"><span class="annottext">tr :: Tracer IO WalletWorkerLog
</span><a href="#local-6989586621682463567"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463606"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer IO WalletWorkerLog
     -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx)
-&gt; Tracer IO WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasLogger IO WalletWorkerLog ctx =&gt;
Lens' ctx (Tracer IO WalletWorkerLog)
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>    </span><span class="hs-comment">-- See Note [CheckedExceptionsAndCallbacks]</span><span>
</span><span id="line-1008"></span><span>    </span><span id="local-6989586621682465134"><span class="annot"><a href="#local-6989586621682463573"><span class="hs-identifier hs-type">throwInIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465134"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465134"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1009"></span><span>    </span><span id="local-6989586621682463573"><span class="annot"><span class="annottext">throwInIO :: ExceptT ErrNoSuchWallet IO a -&gt; IO a
</span><a href="#local-6989586621682463573"><span class="hs-identifier hs-var hs-var">throwInIO</span></a></span></span><span> </span><span id="local-6989586621682463550"><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO a
</span><a href="#local-6989586621682463550"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO a -&gt; IO (Either ErrNoSuchWallet a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO a
</span><a href="#local-6989586621682463550"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either ErrNoSuchWallet a)
-&gt; (Either ErrNoSuchWallet a -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1010"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682463549"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682463549"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682463549"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1011"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span id="local-6989586621682463548"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682463548"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UncheckErrNoSuchWallet -&gt; IO a
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(UncheckErrNoSuchWallet -&gt; IO a) -&gt; UncheckErrNoSuchWallet -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; UncheckErrNoSuchWallet
</span><a href="Cardano.Wallet.html#UncheckErrNoSuchWallet"><span class="hs-identifier hs-var">UncheckErrNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682463548"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>    </span><span id="local-6989586621682465118"><span class="annot"><a href="#local-6989586621682463566"><span class="hs-identifier hs-type">catchFromIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465118"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465118"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1014"></span><span>    </span><span id="local-6989586621682463566"><span class="annot"><span class="annottext">catchFromIO :: IO a -&gt; ExceptT ErrNoSuchWallet IO a
</span><a href="#local-6989586621682463566"><span class="hs-identifier hs-var hs-var">catchFromIO</span></a></span></span><span> </span><span id="local-6989586621682463546"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682463546"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either ErrNoSuchWallet a) -&gt; ExceptT ErrNoSuchWallet IO a
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrNoSuchWallet a) -&gt; ExceptT ErrNoSuchWallet IO a)
-&gt; IO (Either ErrNoSuchWallet a) -&gt; ExceptT ErrNoSuchWallet IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1015"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either ErrNoSuchWallet a
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either ErrNoSuchWallet a)
-&gt; IO a -&gt; IO (Either ErrNoSuchWallet a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682463546"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either ErrNoSuchWallet a)
-&gt; (UncheckErrNoSuchWallet -&gt; IO (Either ErrNoSuchWallet a))
-&gt; IO (Either ErrNoSuchWallet a)
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-operator hs-var">`catch`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#UncheckErrNoSuchWallet"><span class="hs-identifier hs-type">UncheckErrNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682463544"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682463544"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ErrNoSuchWallet a -&gt; IO (Either ErrNoSuchWallet a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrNoSuchWallet a -&gt; IO (Either ErrNoSuchWallet a))
-&gt; Either ErrNoSuchWallet a -&gt; IO (Either ErrNoSuchWallet a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Either ErrNoSuchWallet a
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682463544"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="hs-keyword">newtype</span><span> </span><span id="UncheckErrNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#UncheckErrNoSuchWallet"><span class="hs-identifier hs-var">UncheckErrNoSuchWallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UncheckErrNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#UncheckErrNoSuchWallet"><span class="hs-identifier hs-var">UncheckErrNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463540"><span id="local-6989586621682463542"><span class="annot"><span class="annottext">UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool
(UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool)
-&gt; (UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool)
-&gt; Eq UncheckErrNoSuchWallet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool
$c/= :: UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool
== :: UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool
$c== :: UncheckErrNoSuchWallet -&gt; UncheckErrNoSuchWallet -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463533"><span id="local-6989586621682463535"><span id="local-6989586621682463537"><span class="annot"><span class="annottext">Int -&gt; UncheckErrNoSuchWallet -&gt; ShowS
[UncheckErrNoSuchWallet] -&gt; ShowS
UncheckErrNoSuchWallet -&gt; String
(Int -&gt; UncheckErrNoSuchWallet -&gt; ShowS)
-&gt; (UncheckErrNoSuchWallet -&gt; String)
-&gt; ([UncheckErrNoSuchWallet] -&gt; ShowS)
-&gt; Show UncheckErrNoSuchWallet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [UncheckErrNoSuchWallet] -&gt; ShowS
$cshowList :: [UncheckErrNoSuchWallet] -&gt; ShowS
show :: UncheckErrNoSuchWallet -&gt; String
$cshow :: UncheckErrNoSuchWallet -&gt; String
showsPrec :: Int -&gt; UncheckErrNoSuchWallet -&gt; ShowS
$cshowsPrec :: Int -&gt; UncheckErrNoSuchWallet -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682463524"><span id="local-6989586621682463526"><span id="local-6989586621682463528"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#UncheckErrNoSuchWallet"><span class="hs-identifier hs-type">UncheckErrNoSuchWallet</span></a></span></span></span></span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span class="hs-comment">{- NOTE [CheckedExceptionsAndCallbacks]

Callback functions (such as the fields of 'ChainFollower')
may throw exceptions. Such exceptions typically cause the thread
(such as 'chainSync') which calls the callbacks to exit and
to return control to its parent.

Ideally, we would like these exceptions to be \&quot;checked exceptions\&quot;,
which means that they are visible on the type level.
In our codebase, we (should) make sure that exceptions which are checked
cannot be instances of the 'Exception' class -- in this way,
it is statically guaranteed that they cannot be thrown in the 'IO' monad.

On the flip side, visibility on the type level does imply that
the calling thread (here 'chainSync') needs to be either polymorphic
in the checked exceptions or aware of them.
Making 'chainSync' aware of the checked exception is currently
not a good idea, because this function is used in different contexts,
which have different checked exceptions.
So, it would need to be polymorphic in the underlying monad,
but at present, 'chainSync' is restricted to 'IO' because some
of its constituents are also restricted to 'IO'.

As a workaround / solution, we wrap the checked exception into a new type
which can be thrown in the 'IO' monad.
When the calling thread exits, we catch the exception again
and present it as a checked exception.

-}</span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span class="hs-comment">-- | Rewind the UTxO snapshots, transaction history and other information to a</span><span>
</span><span id="line-1052"></span><span class="hs-comment">-- the earliest point in the past that is before or is the point of rollback.</span><span>
</span><span id="line-1053"></span><span class="annot"><a href="Cardano.Wallet.html#rollbackBlocks"><span class="hs-identifier hs-type">rollbackBlocks</span></a></span><span>
</span><span id="line-1054"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465131"><span class="annot"><a href="#local-6989586621682465131"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682465133"><span class="annot"><a href="#local-6989586621682465133"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682465132"><span class="annot"><a href="#local-6989586621682465132"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1055"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465133"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465132"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465131"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1056"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1057"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465131"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1058"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1059"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span>
</span><span id="line-1060"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ChainPoint"><span class="hs-identifier hs-type">ChainPoint</span></a></span><span>
</span><span id="line-1061"></span><span id="rollbackBlocks"><span class="annot"><span class="annottext">rollbackBlocks :: ctx -&gt; WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet IO ChainPoint
</span><a href="Cardano.Wallet.html#rollbackBlocks"><span class="hs-identifier hs-var hs-var">rollbackBlocks</span></a></span></span><span> </span><span id="local-6989586621682463522"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463522"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463521"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463521"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463520"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621682463520"><span class="hs-identifier hs-var">point</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463519"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ChainPoint)
-&gt; ExceptT ErrNoSuchWallet IO ChainPoint
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463493"><span id="local-6989586621682463494"><span id="local-6989586621682463495"><span id="local-6989586621682463496"><span id="local-6989586621682463497"><span id="local-6989586621682463498"><span id="local-6989586621682463499"><span id="local-6989586621682463500"><span id="local-6989586621682463501"><span id="local-6989586621682463502"><span id="local-6989586621682463503"><span id="local-6989586621682463504"><span id="local-6989586621682463505"><span id="local-6989586621682463506"><span id="local-6989586621682463507"><span id="local-6989586621682463508"><span id="local-6989586621682463509"><span id="local-6989586621682463510"><span id="local-6989586621682463511"><span id="local-6989586621682463512"><span id="local-6989586621682463513"><span id="local-6989586621682463514"><span id="local-6989586621682463515"><span id="local-6989586621682463516"><span id="local-6989586621682463517"><span id="local-6989586621682463518"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463493"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1062"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ChainPoint)
 -&gt; IO (Either ErrNoSuchWallet ChainPoint))
-&gt; ExceptT ErrNoSuchWallet stm ChainPoint
-&gt; ExceptT ErrNoSuchWallet IO ChainPoint
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ChainPoint)
-&gt; IO (Either ErrNoSuchWallet ChainPoint)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463493"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm ChainPoint
 -&gt; ExceptT ErrNoSuchWallet IO ChainPoint)
-&gt; ExceptT ErrNoSuchWallet stm ChainPoint
-&gt; ExceptT ErrNoSuchWallet IO ChainPoint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
</span><a href="#local-6989586621682463495"><span class="hs-identifier hs-var">rollbackTo</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463521"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621682463520"><span class="hs-identifier hs-var">point</span></a></span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1064"></span><span>    </span><span id="local-6989586621682463519"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463519"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463522"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465133"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465132"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span class="hs-comment">-- | Apply the given blocks to the wallet and update the wallet state,</span><span>
</span><span id="line-1067"></span><span class="hs-comment">-- transaction history and corresponding metadata.</span><span>
</span><span id="line-1068"></span><span class="hs-comment">--</span><span>
</span><span id="line-1069"></span><span class="hs-comment">-- Concurrency: `restoreBlocks` is not atomic; we assume that</span><span>
</span><span id="line-1070"></span><span class="hs-comment">-- it is called in a sequential fashion for each wallet.</span><span>
</span><span id="line-1071"></span><span class="annot"><a href="Cardano.Wallet.html#restoreBlocks"><span class="hs-identifier hs-type">restoreBlocks</span></a></span><span>
</span><span id="line-1072"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465125"><span class="annot"><a href="#local-6989586621682465125"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682465127"><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682465126"><span class="annot"><a href="#local-6989586621682465126"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1073"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465126"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465125"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465125"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1075"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1078"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465125"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1080"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier hs-type">WalletFollowLog</span></a></span><span>
</span><span id="line-1081"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1082"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#BlockData"><span class="hs-identifier hs-type">BlockData</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.BlockSummary.html#ChainEvents"><span class="hs-identifier hs-type">ChainEvents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1083"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1085"></span><span id="restoreBlocks"><span class="annot"><span class="annottext">restoreBlocks :: ctx
-&gt; Tracer IO WalletFollowLog
-&gt; WalletId
-&gt; BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#restoreBlocks"><span class="hs-identifier hs-var hs-var">restoreBlocks</span></a></span></span><span> </span><span id="local-6989586621682463492"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463492"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463491"><span class="annot"><span class="annottext">Tracer IO WalletFollowLog
</span><a href="#local-6989586621682463491"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621682463490"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463489"><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
</span><a href="#local-6989586621682463489"><span class="hs-identifier hs-var">blocks</span></a></span></span><span> </span><span id="local-6989586621682463488"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463488"><span class="hs-identifier hs-var">nodeTip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463487"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463461"><span id="local-6989586621682463462"><span id="local-6989586621682463463"><span id="local-6989586621682463464"><span id="local-6989586621682463465"><span id="local-6989586621682463466"><span id="local-6989586621682463467"><span id="local-6989586621682463468"><span id="local-6989586621682463469"><span id="local-6989586621682463470"><span id="local-6989586621682463471"><span id="local-6989586621682463472"><span id="local-6989586621682463473"><span id="local-6989586621682463474"><span id="local-6989586621682463475"><span id="local-6989586621682463476"><span id="local-6989586621682463477"><span id="local-6989586621682463478"><span id="local-6989586621682463479"><span id="local-6989586621682463480"><span id="local-6989586621682463481"><span id="local-6989586621682463482"><span id="local-6989586621682463483"><span id="local-6989586621682463484"><span id="local-6989586621682463485"><span id="local-6989586621682463486"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463461"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1086"></span><span>    </span><span id="local-6989586621682463460"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682463460"><span class="hs-identifier hs-var">sp</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlottingParameters
-&gt; ExceptT ErrNoSuchWallet IO SlottingParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlottingParameters
 -&gt; ExceptT ErrNoSuchWallet IO SlottingParameters)
-&gt; IO SlottingParameters
-&gt; ExceptT ErrNoSuchWallet IO SlottingParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO SlottingParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m SlottingParameters
</span><a href="Cardano.Wallet.Network.html#currentSlottingParameters"><span class="hs-identifier hs-var hs-var">currentSlottingParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463458"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-1087"></span><span>    </span><span id="local-6989586621682463457"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463457"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s))
-&gt; IO (Either ErrNoSuchWallet (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463461"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1088"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463481"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; ExceptT ErrNoSuchWallet IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463457"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader -&gt; Bool
</span><a href="#local-6989586621682463456"><span class="hs-operator hs-var">`isParentOf`</span></a></span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader
forall (m :: * -&gt; *) addr txs s.
BlockData m addr txs s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#firstHeader"><span class="hs-identifier hs-var">firstHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
</span><a href="#local-6989586621682463489"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ExceptT ErrNoSuchWallet IO ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; String -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-1090"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;restoreBlocks: given chain isn't a valid continuation.&quot;</span></span><span>
</span><span id="line-1091"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Wallet is at:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463457"><span class="hs-identifier hs-var">cp0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;but the given chain continues starting from:&quot;</span></span><span>
</span><span id="line-1093"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; BlockHeader
forall (m :: * -&gt; *) addr txs s.
BlockData m addr txs s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#firstHeader"><span class="hs-identifier hs-var">firstHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
</span><a href="#local-6989586621682463489"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>    </span><span class="hs-comment">-- NOTE on concurrency:</span><span>
</span><span id="line-1097"></span><span>    </span><span class="hs-comment">-- In light-mode, 'applyBlocks' may take some time to retrieve</span><span>
</span><span id="line-1098"></span><span>    </span><span class="hs-comment">-- transaction data. We avoid blocking the database by</span><span>
</span><span id="line-1099"></span><span>    </span><span class="hs-comment">-- not wrapping this into a call to 'atomically'.</span><span>
</span><span id="line-1100"></span><span>    </span><span class="hs-comment">-- However, this only works if the latest database checkpoint, `cp0`,</span><span>
</span><span id="line-1101"></span><span>    </span><span class="hs-comment">-- does not change in the meantime.</span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682463453"><span class="annot"><span class="annottext">NonEmpty [FilteredBlock]
</span><a href="#local-6989586621682463453"><span class="hs-identifier hs-var">filteredBlocks'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463452"><span class="annot"><span class="annottext">NonEmpty (DeltaWallet s, Wallet s)
</span><a href="#local-6989586621682463452"><span class="hs-identifier hs-var">cps'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
 -&gt; ExceptT
      ErrNoSuchWallet
      IO
      (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s)))
-&gt; IO
     (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ([FilteredBlock], (DeltaWallet s, Wallet s))
-&gt; (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
forall (f :: * -&gt; *) a b. Functor f =&gt; f (a, b) -&gt; (f a, f b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.unzip</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty ([FilteredBlock], (DeltaWallet s, Wallet s))
 -&gt; (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s)))
-&gt; IO (NonEmpty ([FilteredBlock], (DeltaWallet s, Wallet s)))
-&gt; IO
     (NonEmpty [FilteredBlock], NonEmpty (DeltaWallet s, Wallet s))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
-&gt; Wallet s
-&gt; IO (NonEmpty ([FilteredBlock], (DeltaWallet s, Wallet s)))
forall s (m :: * -&gt; *).
(IsOurs s Address, IsOurs s RewardAccount, Monad m) =&gt;
BlockData m (Either Address RewardAccount) ChainEvents s
-&gt; Wallet s
-&gt; m (NonEmpty ([FilteredBlock], (DeltaWallet s, Wallet s)))
</span><a href="Cardano.Wallet.Primitive.Model.html#applyBlocks"><span class="hs-identifier hs-var">applyBlocks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">BlockData IO (Either Address RewardAccount) ChainEvents s
</span><a href="#local-6989586621682463489"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463457"><span class="hs-identifier hs-var">cp0</span></a></span><span>
</span><span id="line-1103"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463450"><span class="annot"><span class="annottext">cps :: NonEmpty (Wallet s)
</span><a href="#local-6989586621682463450"><span class="hs-identifier hs-var hs-var">cps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((DeltaWallet s, Wallet s) -&gt; Wallet s)
-&gt; NonEmpty (DeltaWallet s, Wallet s) -&gt; NonEmpty (Wallet s)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaWallet s, Wallet s) -&gt; Wallet s
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (DeltaWallet s, Wallet s)
</span><a href="#local-6989586621682463452"><span class="hs-identifier hs-var">cps'</span></a></span><span>
</span><span id="line-1104"></span><span>        </span><span id="local-6989586621682463448"><span class="annot"><span class="annottext">filteredBlocks :: [FilteredBlock]
</span><a href="#local-6989586621682463448"><span class="hs-identifier hs-var hs-var">filteredBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty [FilteredBlock] -&gt; [FilteredBlock]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty [FilteredBlock]
</span><a href="#local-6989586621682463453"><span class="hs-identifier hs-var">filteredBlocks'</span></a></span><span>
</span><span id="line-1105"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463446"><span class="annot"><span class="annottext">slotPoolDelegations :: [(SlotNo, DelegationCertificate)]
</span><a href="#local-6989586621682463446"><span class="hs-identifier hs-var hs-var">slotPoolDelegations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1106"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; SlotNo
forall p. Num p =&gt; WithOrigin p -&gt; p
</span><a href="#local-6989586621682463445"><span class="hs-identifier hs-var">pseudoSlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilteredBlock
</span><a href="#local-6989586621682463444"><span class="hs-identifier hs-var">fblock</span></a></span><span> </span><span class="annot"><span class="annottext">FilteredBlock
-&gt; ((Slot -&gt; Const Slot Slot)
    -&gt; FilteredBlock -&gt; Const Slot FilteredBlock)
-&gt; Slot
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slot&quot;
  ((Slot -&gt; Const Slot Slot)
   -&gt; FilteredBlock -&gt; Const Slot FilteredBlock)
(Slot -&gt; Const Slot Slot)
-&gt; FilteredBlock -&gt; Const Slot FilteredBlock
</span><a href="#local-6989586621682463443"><span class="hs-var">#slot</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682463442"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682463444"><span class="annot"><span class="annottext">FilteredBlock
</span><a href="#local-6989586621682463444"><span class="hs-identifier hs-var">fblock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilteredBlock]
</span><a href="#local-6989586621682463448"><span class="hs-identifier hs-var">filteredBlocks</span></a></span><span>
</span><span id="line-1108"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463442"><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682463442"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(([DelegationCertificate]
  -&gt; Const [DelegationCertificate] [DelegationCertificate])
 -&gt; FilteredBlock -&gt; Const [DelegationCertificate] FilteredBlock)
-&gt; FilteredBlock -&gt; [DelegationCertificate]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegations&quot;
  (([DelegationCertificate]
    -&gt; Const [DelegationCertificate] [DelegationCertificate])
   -&gt; FilteredBlock -&gt; Const [DelegationCertificate] FilteredBlock)
([DelegationCertificate]
 -&gt; Const [DelegationCertificate] [DelegationCertificate])
-&gt; FilteredBlock -&gt; Const [DelegationCertificate] FilteredBlock
</span><a href="#local-6989586621682463441"><span class="hs-var">#delegations</span></a></span><span> </span><span class="annot"><span class="annottext">FilteredBlock
</span><a href="#local-6989586621682463444"><span class="hs-identifier hs-var">fblock</span></a></span><span>
</span><span id="line-1109"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1110"></span><span>        </span><span id="local-6989586621682463445"><span class="annot"><span class="annottext">pseudoSlotNo :: WithOrigin p -&gt; p
</span><a href="#local-6989586621682463445"><span class="hs-identifier hs-var hs-var">pseudoSlotNo</span></a></span></span><span> </span><span class="annot"><span class="annottext">WithOrigin p
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var">Origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1111"></span><span>        </span><span class="annot"><a href="#local-6989586621682463445"><span class="hs-identifier hs-var">pseudoSlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">At</span></a></span><span> </span><span id="local-6989586621682463438"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682463438"><span class="hs-identifier hs-var">sl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682463438"><span class="hs-identifier hs-var">sl</span></a></span><span>
</span><span id="line-1112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463437"><span class="annot"><span class="annottext">txs :: [(Tx, TxMeta)]
</span><a href="#local-6989586621682463437"><span class="hs-identifier hs-var hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Tx, TxMeta)]] -&gt; [(Tx, TxMeta)]
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">([[(Tx, TxMeta)]] -&gt; [(Tx, TxMeta)])
-&gt; [[(Tx, TxMeta)]] -&gt; [(Tx, TxMeta)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([(Tx, TxMeta)] -&gt; Const [(Tx, TxMeta)] [(Tx, TxMeta)])
 -&gt; FilteredBlock -&gt; Const [(Tx, TxMeta)] FilteredBlock)
-&gt; FilteredBlock -&gt; [(Tx, TxMeta)]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transactions&quot;
  (([(Tx, TxMeta)] -&gt; Const [(Tx, TxMeta)] [(Tx, TxMeta)])
   -&gt; FilteredBlock -&gt; Const [(Tx, TxMeta)] FilteredBlock)
([(Tx, TxMeta)] -&gt; Const [(Tx, TxMeta)] [(Tx, TxMeta)])
-&gt; FilteredBlock -&gt; Const [(Tx, TxMeta)] FilteredBlock
</span><a href="#local-6989586621682463436"><span class="hs-var">#transactions</span></a></span><span> </span><span class="annot"><span class="annottext">(FilteredBlock -&gt; [(Tx, TxMeta)])
-&gt; [FilteredBlock] -&gt; [[(Tx, TxMeta)]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[FilteredBlock]
</span><a href="#local-6989586621682463448"><span class="hs-identifier hs-var">filteredBlocks</span></a></span><span>
</span><span id="line-1113"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463435"><span class="annot"><span class="annottext">epochStability :: Quantity &quot;block&quot; Word32
</span><a href="#local-6989586621682463435"><span class="hs-identifier hs-var hs-var">epochStability</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">3</span></span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32)
-&gt; Quantity &quot;block&quot; Word32 -&gt; Quantity &quot;block&quot; Word32
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SlottingParameters -&gt; Quantity &quot;block&quot; Word32
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AgetSecurityParameter%3ASlottingParameters"><span class="hs-identifier hs-var hs-var">getSecurityParameter</span></a></span><span> </span><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682463460"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463432"><span class="annot"><span class="annottext">localTip :: BlockHeader
</span><a href="#local-6989586621682463432"><span class="hs-identifier hs-var hs-var">localTip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; BlockHeader) -&gt; Wallet s -&gt; BlockHeader
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Wallet s) -&gt; Wallet s
forall a. NonEmpty a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Wallet s)
</span><a href="#local-6989586621682463450"><span class="hs-identifier hs-var">cps</span></a></span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>    </span><span class="hs-comment">-- FIXME LATER during ADP-1403</span><span>
</span><span id="line-1117"></span><span>    </span><span class="hs-comment">-- We need to rethink checkpoint creation and consider the case</span><span>
</span><span id="line-1118"></span><span>    </span><span class="hs-comment">-- where the blocks are given as a 'Summary' and not a full 'List'</span><span>
</span><span id="line-1119"></span><span>    </span><span class="hs-comment">-- of blocks. In this case, it could happen that the current</span><span>
</span><span id="line-1120"></span><span>    </span><span class="hs-comment">-- scheme fails to create sufficiently many checkpoint as</span><span>
</span><span id="line-1121"></span><span>    </span><span class="hs-comment">-- it was never able to touch the corresponding block.</span><span>
</span><span id="line-1122"></span><span>    </span><span class="hs-comment">-- For now, we avoid this situation by being always supplied a 'List'</span><span>
</span><span id="line-1123"></span><span>    </span><span class="hs-comment">-- in the unstable region close to the tip.</span><span>
</span><span id="line-1124"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463430"><span class="annot"><span class="annottext">unstable :: Set Word32
</span><a href="#local-6989586621682463430"><span class="hs-identifier hs-var hs-var">unstable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word32] -&gt; Set Word32
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Word32] -&gt; Set Word32) -&gt; [Word32] -&gt; Set Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SparseCheckpointsConfig -&gt; Quantity &quot;block&quot; Word32 -&gt; [Word32]
</span><a href="Cardano.Wallet.Checkpoints.html#sparseCheckpoints"><span class="hs-identifier hs-var">sparseCheckpoints</span></a></span><span> </span><span class="annot"><span class="annottext">SparseCheckpointsConfig
</span><a href="#local-6989586621682463429"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463488"><span class="hs-identifier hs-var">nodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
-&gt; Quantity &quot;block&quot; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
   -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
(Quantity &quot;block&quot; Word32
 -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader
</span><a href="#local-6989586621682463428"><span class="hs-var">#blockHeight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1126"></span><span>                </span><span class="hs-comment">-- NOTE</span><span>
</span><span id="line-1127"></span><span>                </span><span class="hs-comment">-- The edge really is an optimization to avoid rolling back too</span><span>
</span><span id="line-1128"></span><span>                </span><span class="hs-comment">-- &quot;far&quot; in the past. Yet, we let the edge construct itself</span><span>
</span><span id="line-1129"></span><span>                </span><span class="hs-comment">-- organically once we reach the tip of the chain and start</span><span>
</span><span id="line-1130"></span><span>                </span><span class="hs-comment">-- processing blocks one by one.</span><span>
</span><span id="line-1131"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-1132"></span><span>                </span><span class="hs-comment">-- This prevents the wallet from trying to create too many</span><span>
</span><span id="line-1133"></span><span>                </span><span class="hs-comment">-- checkpoints at once during restoration which causes massive</span><span>
</span><span id="line-1134"></span><span>                </span><span class="hs-comment">-- performance degradation on large wallets.</span><span>
</span><span id="line-1135"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-1136"></span><span>                </span><span class="hs-comment">-- Rollback may still occur during this short period, but</span><span>
</span><span id="line-1137"></span><span>                </span><span class="hs-comment">-- rolling back from a few hundred blocks is relatively fast</span><span>
</span><span id="line-1138"></span><span>                </span><span class="hs-comment">-- anyway.</span><span>
</span><span id="line-1139"></span><span>                </span><span id="local-6989586621682463429"><span class="annot"><span class="annottext">cfg :: SparseCheckpointsConfig
</span><a href="#local-6989586621682463429"><span class="hs-identifier hs-var hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Word32 -&gt; SparseCheckpointsConfig
</span><a href="Cardano.Wallet.Checkpoints.html#defaultSparseCheckpointsConfig"><span class="hs-identifier hs-var">defaultSparseCheckpointsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Word32
</span><a href="#local-6989586621682463435"><span class="hs-identifier hs-var">epochStability</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">edgeSize :: Word8
</span><a href="Cardano.Wallet.Checkpoints.html#edgeSize"><span class="hs-identifier hs-var">edgeSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>        </span><span id="local-6989586621682463426"><span class="annot"><span class="annottext">getBlockHeight :: s -&gt; b
</span><a href="#local-6989586621682463426"><span class="hs-identifier hs-var hs-var">getBlockHeight</span></a></span></span><span> </span><span id="local-6989586621682463425"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463425"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; a -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1142"></span><span>            </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463425"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;currentTip&quot; ((s -&gt; Const a t) -&gt; s -&gt; Const a s)
(s -&gt; Const a t) -&gt; s -&gt; Const a s
</span><a href="#local-6989586621682463424"><span class="hs-var">#currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">((s -&gt; Const a t) -&gt; s -&gt; Const a s)
-&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a t)
-&gt; (a -&gt; Const a a)
-&gt; s
-&gt; Const a s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;blockHeight&quot; ((s -&gt; Const a t) -&gt; s -&gt; Const a t)
(s -&gt; Const a t) -&gt; s -&gt; Const a t
</span><a href="#local-6989586621682463423"><span class="hs-var">#blockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">((s -&gt; Const a t) -&gt; s -&gt; Const a t)
-&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a t)
-&gt; (a -&gt; Const a a)
-&gt; s
-&gt; Const a t
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;getQuantity&quot; ((a -&gt; Const a a) -&gt; s -&gt; Const a t)
(a -&gt; Const a a) -&gt; s -&gt; Const a t
</span><a href="#local-6989586621682463422"><span class="hs-var">#getQuantity</span></a></span><span>
</span><span id="line-1143"></span><span>        </span><span id="local-6989586621682463421"><span class="annot"><span class="annottext">willKeep :: Wallet s -&gt; Bool
</span><a href="#local-6989586621682463421"><span class="hs-identifier hs-var hs-var">willKeep</span></a></span></span><span> </span><span id="local-6989586621682463420"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463420"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; Word32
forall a s t s t s b.
(Integral a, HasField &quot;blockHeight&quot; s t s t,
 HasField &quot;currentTip&quot; s s s t, HasField &quot;getQuantity&quot; s t a a,
 Num b) =&gt;
s -&gt; b
</span><a href="#local-6989586621682463426"><span class="hs-identifier hs-var">getBlockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463420"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Set Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Word32
</span><a href="#local-6989586621682463430"><span class="hs-identifier hs-var">unstable</span></a></span><span>
</span><span id="line-1144"></span><span>        </span><span id="local-6989586621682463418"><span class="annot"><span class="annottext">cpsKeep :: [Wallet s]
</span><a href="#local-6989586621682463418"><span class="hs-identifier hs-var hs-var">cpsKeep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; Bool) -&gt; [Wallet s] -&gt; [Wallet s]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; Bool
</span><a href="#local-6989586621682463421"><span class="hs-identifier hs-var">willKeep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Wallet s) -&gt; [Wallet s]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.init</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Wallet s)
</span><a href="#local-6989586621682463450"><span class="hs-identifier hs-var">cps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wallet s] -&gt; [Wallet s] -&gt; [Wallet s]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">NonEmpty (Wallet s) -&gt; Wallet s
forall a. NonEmpty a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Wallet s)
</span><a href="#local-6989586621682463450"><span class="hs-identifier hs-var">cps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>        </span><span class="hs-comment">-- NOTE: We have to update the 'Prologue' as well,</span><span>
</span><span id="line-1147"></span><span>        </span><span class="hs-comment">-- as it can contain addresses for pending transactions,</span><span>
</span><span id="line-1148"></span><span>        </span><span class="hs-comment">-- which are removed from the 'Prologue' once the</span><span>
</span><span id="line-1149"></span><span>        </span><span class="hs-comment">-- transactions are accepted onto the chain and discovered.</span><span>
</span><span id="line-1150"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1151"></span><span>        </span><span class="hs-comment">-- I'm not so sure that the approach here is correct with</span><span>
</span><span id="line-1152"></span><span>        </span><span class="hs-comment">-- respect to rollbacks, but it is functionally the same</span><span>
</span><span id="line-1153"></span><span>        </span><span class="hs-comment">-- as the code that came before.</span><span>
</span><span id="line-1154"></span><span>        </span><span id="local-6989586621682463416"><span class="annot"><span class="annottext">deltaPrologue :: DeltaWalletState s
</span><a href="#local-6989586621682463416"><span class="hs-identifier hs-var hs-var">deltaPrologue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1155"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Prologue s -&gt; DeltaWalletState1 s
forall s. Prologue s -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(Prologue s -&gt; DeltaWalletState1 s)
-&gt; Prologue s -&gt; DeltaWalletState1 s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Prologue s
forall s. AddressBookIso s =&gt; s -&gt; Prologue s
</span><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier hs-var">getPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; Prologue s) -&gt; s -&gt; Prologue s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; s) -&gt; Wallet s -&gt; s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Wallet s) -&gt; Wallet s
forall a. NonEmpty a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Wallet s)
</span><a href="#local-6989586621682463450"><span class="hs-identifier hs-var">cps</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1156"></span><span>        </span><span id="local-6989586621682463414"><span class="annot"><span class="annottext">delta :: DeltaWalletState s
</span><a href="#local-6989586621682463414"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeltaWalletState s
</span><a href="#local-6989586621682463416"><span class="hs-identifier hs-var">deltaPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaWalletState s -&gt; DeltaWalletState s -&gt; DeltaWalletState s
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaWalletState s -&gt; DeltaWalletState s
forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span>
</span><span id="line-1157"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s) -&gt; DeltaWalletState1 s
forall s.
DeltasCheckpoints (WalletCheckpoint s) -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#UpdateCheckpoints"><span class="hs-identifier hs-var">UpdateCheckpoints</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; WalletCheckpoint s -&gt; DeltaCheckpoints (WalletCheckpoint s)
forall a. Slot -&gt; a -&gt; DeltaCheckpoints a
</span><a href="Cardano.Wallet.Checkpoints.html#PutCheckpoint"><span class="hs-identifier hs-var">PutCheckpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletCheckpoint s -&gt; Slot
forall s. WalletCheckpoint s -&gt; Slot
</span><a href="Cardano.Wallet.DB.WalletState.html#getSlot"><span class="hs-identifier hs-var">getSlot</span></a></span><span> </span><span class="annot"><span class="annottext">WalletCheckpoint s
</span><a href="#local-6989586621682463410"><span class="hs-identifier hs-var">wcp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WalletCheckpoint s
</span><a href="#local-6989586621682463410"><span class="hs-identifier hs-var">wcp</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1158"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682463410"><span class="annot"><span class="annottext">WalletCheckpoint s
</span><a href="#local-6989586621682463410"><span class="hs-identifier hs-var">wcp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; WalletCheckpoint s)
-&gt; [Wallet s] -&gt; [WalletCheckpoint s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Prologue s, WalletCheckpoint s) -&gt; WalletCheckpoint s
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Prologue s, WalletCheckpoint s) -&gt; WalletCheckpoint s)
-&gt; (Wallet s -&gt; (Prologue s, WalletCheckpoint s))
-&gt; Wallet s
-&gt; WalletCheckpoint s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; (Prologue s, WalletCheckpoint s)
forall s.
AddressBookIso s =&gt;
Wallet s -&gt; (Prologue s, WalletCheckpoint s)
</span><a href="Cardano.Wallet.DB.WalletState.html#fromWallet"><span class="hs-identifier hs-var">fromWallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wallet s]
</span><a href="#local-6989586621682463418"><span class="hs-identifier hs-var">cpsKeep</span></a></span><span>
</span><span id="line-1159"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ()))
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463461"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>        </span><span class="annot"><span class="annottext">WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463473"><span class="hs-identifier hs-var">putTxHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463437"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-1163"></span><span>        </span><span class="annot"><span class="annottext">WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463468"><span class="hs-identifier hs-var">updatePendingTxForExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((SlotNo -&gt; Const SlotNo SlotNo)
 -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; BlockHeader -&gt; SlotNo
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682463409"><span class="hs-var">#slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463432"><span class="hs-identifier hs-var">localTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>        </span><span class="annot"><span class="annottext">[(SlotNo, DelegationCertificate)]
-&gt; ((SlotNo, DelegationCertificate)
    -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; ExceptT ErrNoSuchWallet stm ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(SlotNo, DelegationCertificate)]
</span><a href="#local-6989586621682463446"><span class="hs-identifier hs-var">slotPoolDelegations</span></a></span><span> </span><span class="annot"><span class="annottext">(((SlotNo, DelegationCertificate)
  -&gt; ExceptT ErrNoSuchWallet stm ())
 -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; ((SlotNo, DelegationCertificate)
    -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; ExceptT ErrNoSuchWallet stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682463408"><span class="annot"><span class="annottext">delegation :: (SlotNo, DelegationCertificate)
</span><a href="#local-6989586621682463408"><span class="hs-identifier hs-var">delegation</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682463407"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682463407"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463406"><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682463406"><span class="hs-identifier hs-var">cert</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1165"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; ExceptT ErrNoSuchWallet stm ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; IO () -&gt; ExceptT ErrNoSuchWallet stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo, DelegationCertificate) -&gt; IO ()
</span><a href="#local-6989586621682463405"><span class="hs-identifier hs-var">logDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo, DelegationCertificate)
</span><a href="#local-6989586621682463408"><span class="hs-identifier hs-var">delegation</span></a></span><span>
</span><span id="line-1166"></span><span>            </span><span class="annot"><span class="annottext">WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463476"><span class="hs-identifier hs-var">putDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682463406"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682463407"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ExceptT ErrNoSuchWallet stm ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; IO () -&gt; ExceptT ErrNoSuchWallet stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; IO ()) -&gt; [Wallet s] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; IO ()
</span><a href="#local-6989586621682463403"><span class="hs-identifier hs-var">logCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">[Wallet s]
</span><a href="#local-6989586621682463418"><span class="hs-identifier hs-var">cpsKeep</span></a></span><span>
</span><span id="line-1169"></span><span>        </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ()) -&gt; ExceptT ErrNoSuchWallet stm ()
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ()) -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; stm (Either ErrNoSuchWallet ())
-&gt; ExceptT ErrNoSuchWallet stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrNoSuchWallet ()))
-&gt; stm (Either ErrNoSuchWallet ())
forall da (m :: * -&gt; *) a b.
(Delta da, Monad m, a ~ Base da) =&gt;
DBVar m da -&gt; (a -&gt; (Maybe da, b)) -&gt; m b
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">modifyDBMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
</span><a href="#local-6989586621682463483"><span class="hs-identifier hs-var">walletsDB</span></a></span><span> </span><span class="annot"><span class="annottext">((Map WalletId (WalletState s)
  -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
      Either ErrNoSuchWallet ()))
 -&gt; stm (Either ErrNoSuchWallet ()))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrNoSuchWallet ()))
-&gt; stm (Either ErrNoSuchWallet ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1170"></span><span>            </span><span class="annot"><span class="annottext">WalletId
-&gt; (ErrNoSuchWallet -&gt; ErrNoSuchWallet)
-&gt; (WalletState s
    -&gt; Either ErrNoSuchWallet (DeltaWalletState s, ()))
-&gt; Map WalletId (WalletState s)
-&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
    Either ErrNoSuchWallet ())
forall e w dw b.
WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var">adjustNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrNoSuchWallet
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">((WalletState s -&gt; Either ErrNoSuchWallet (DeltaWalletState s, ()))
 -&gt; Map WalletId (WalletState s)
 -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
     Either ErrNoSuchWallet ()))
-&gt; (WalletState s
    -&gt; Either ErrNoSuchWallet (DeltaWalletState s, ()))
-&gt; Map WalletId (WalletState s)
-&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
    Either ErrNoSuchWallet ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">WalletState s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DeltaWalletState s, ())
-&gt; Either ErrNoSuchWallet (DeltaWalletState s, ())
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">DeltaWalletState s
</span><a href="#local-6989586621682463414"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1171"></span><span>
</span><span id="line-1172"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463462"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463490"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Word32
</span><a href="#local-6989586621682463435"><span class="hs-identifier hs-var">epochStability</span></a></span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ExceptT ErrNoSuchWallet stm ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; IO () -&gt; ExceptT ErrNoSuchWallet stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1175"></span><span>            </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog -&gt; WalletFollowLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog
</span><a href="#local-6989586621682463491"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletFollowLog -&gt; IO ()) -&gt; WalletFollowLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)] -&gt; WalletFollowLog
</span><a href="Cardano.Wallet.html#MsgDiscoveredTxs"><span class="hs-identifier hs-var">MsgDiscoveredTxs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463437"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-1176"></span><span>            </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog -&gt; WalletFollowLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog
</span><a href="#local-6989586621682463491"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletFollowLog -&gt; IO ()) -&gt; WalletFollowLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)] -&gt; WalletFollowLog
</span><a href="Cardano.Wallet.html#MsgDiscoveredTxsContent"><span class="hs-identifier hs-var">MsgDiscoveredTxsContent</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682463437"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-1177"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1178"></span><span>    </span><span id="local-6989586621682463458"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682463458"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463492"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-1179"></span><span>    </span><span id="local-6989586621682463487"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463487"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463492"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465126"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1180"></span><span>
</span><span id="line-1181"></span><span>    </span><span class="annot"><a href="#local-6989586621682463403"><span class="hs-identifier hs-type">logCheckpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span>    </span><span id="local-6989586621682463403"><span class="annot"><span class="annottext">logCheckpoint :: Wallet s -&gt; IO ()
</span><a href="#local-6989586621682463403"><span class="hs-identifier hs-var hs-var">logCheckpoint</span></a></span></span><span> </span><span id="local-6989586621682463400"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463400"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog -&gt; WalletFollowLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog
</span><a href="#local-6989586621682463491"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletFollowLog -&gt; IO ()) -&gt; WalletFollowLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; WalletFollowLog
</span><a href="Cardano.Wallet.html#MsgCheckpoint"><span class="hs-identifier hs-var">MsgCheckpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463400"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span>    </span><span class="annot"><a href="#local-6989586621682463405"><span class="hs-identifier hs-type">logDelegation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#DelegationCertificate"><span class="hs-identifier hs-type">DelegationCertificate</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1185"></span><span>    </span><span id="local-6989586621682463405"><span class="annot"><span class="annottext">logDelegation :: (SlotNo, DelegationCertificate) -&gt; IO ()
</span><a href="#local-6989586621682463405"><span class="hs-identifier hs-var hs-var">logDelegation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog -&gt; WalletFollowLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletFollowLog
</span><a href="#local-6989586621682463491"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletFollowLog -&gt; IO ())
-&gt; ((SlotNo, DelegationCertificate) -&gt; WalletFollowLog)
-&gt; (SlotNo, DelegationCertificate)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; DelegationCertificate -&gt; WalletFollowLog)
-&gt; (SlotNo, DelegationCertificate) -&gt; WalletFollowLog
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; DelegationCertificate -&gt; WalletFollowLog
</span><a href="Cardano.Wallet.html#MsgDiscoveredDelegationCert"><span class="hs-identifier hs-var">MsgDiscoveredDelegationCert</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>    </span><span class="annot"><a href="#local-6989586621682463456"><span class="hs-identifier hs-type">isParentOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465127"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1188"></span><span>    </span><span id="local-6989586621682463456"><span class="annot"><span class="annottext">isParentOf :: Wallet s -&gt; BlockHeader -&gt; Bool
</span><a href="#local-6989586621682463456"><span class="hs-identifier hs-var hs-var">isParentOf</span></a></span></span><span> </span><span id="local-6989586621682463396"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463396"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Hash &quot;BlockHeader&quot;) -&gt; Maybe (Hash &quot;BlockHeader&quot;) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;BlockHeader&quot; -&gt; Maybe (Hash &quot;BlockHeader&quot;)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;BlockHeader&quot;
</span><a href="#local-6989586621682463395"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Hash &quot;BlockHeader&quot;) -&gt; Bool)
-&gt; (BlockHeader -&gt; Maybe (Hash &quot;BlockHeader&quot;))
-&gt; BlockHeader
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Maybe (Hash &quot;BlockHeader&quot;)
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AparentHeaderHash%3ABlockHeader"><span class="hs-identifier hs-var hs-var">parentHeaderHash</span></a></span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682463395"><span class="annot"><span class="annottext">parent :: Hash &quot;BlockHeader&quot;
</span><a href="#local-6989586621682463395"><span class="hs-identifier hs-var hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Hash &quot;BlockHeader&quot;
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AheaderHash%3ABlockHeader"><span class="hs-identifier hs-var hs-var">headerHash</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; Hash &quot;BlockHeader&quot;)
-&gt; BlockHeader -&gt; Hash &quot;BlockHeader&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463396"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span class="hs-comment">-- | Remove an existing wallet. Note that there's no particular work to</span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- be done regarding the restoration worker as it will simply terminate</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- on the next tick when noticing that the corresponding wallet is gone.</span><span>
</span><span id="line-1194"></span><span class="annot"><a href="Cardano.Wallet.html#deleteWallet"><span class="hs-identifier hs-type">deleteWallet</span></a></span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463392"><span class="annot"><a href="#local-6989586621682463392"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463391"><span class="annot"><a href="#local-6989586621682463391"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463390"><span class="annot"><a href="#local-6989586621682463390"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1196"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463391"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463390"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463392"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1197"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463392"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1199"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1200"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span id="deleteWallet"><span class="annot"><span class="annottext">deleteWallet :: ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#deleteWallet"><span class="hs-identifier hs-var hs-var">deleteWallet</span></a></span></span><span> </span><span id="local-6989586621682463389"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463389"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463388"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463388"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463387"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463361"><span id="local-6989586621682463362"><span id="local-6989586621682463363"><span id="local-6989586621682463364"><span id="local-6989586621682463365"><span id="local-6989586621682463366"><span id="local-6989586621682463367"><span id="local-6989586621682463368"><span id="local-6989586621682463369"><span id="local-6989586621682463370"><span id="local-6989586621682463371"><span id="local-6989586621682463372"><span id="local-6989586621682463373"><span id="local-6989586621682463374"><span id="local-6989586621682463375"><span id="local-6989586621682463376"><span id="local-6989586621682463377"><span id="local-6989586621682463378"><span id="local-6989586621682463379"><span id="local-6989586621682463380"><span id="local-6989586621682463381"><span id="local-6989586621682463382"><span id="local-6989586621682463383"><span id="local-6989586621682463384"><span id="local-6989586621682463385"><span id="local-6989586621682463386"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463361"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1202"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ()))
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463361"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463385"><span class="hs-identifier hs-var">removeWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463388"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1203"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1204"></span><span>    </span><span id="local-6989586621682463387"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463387"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463389"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463391"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463390"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span class="hs-comment">-- | Fetch the cached reward balance of a given wallet from the database.</span><span>
</span><span id="line-1207"></span><span class="annot"><a href="Cardano.Wallet.html#fetchRewardBalance"><span class="hs-identifier hs-type">fetchRewardBalance</span></a></span><span>
</span><span id="line-1208"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682464388"><span class="annot"><a href="#local-6989586621682464388"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682464390"><span class="annot"><a href="#local-6989586621682464390"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682464389"><span class="annot"><a href="#local-6989586621682464389"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1209"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464390"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464389"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464388"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1210"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464388"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1212"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1213"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-1214"></span><span id="fetchRewardBalance"><span class="annot"><span class="annottext">fetchRewardBalance :: ctx -&gt; WalletId -&gt; IO Coin
</span><a href="Cardano.Wallet.html#fetchRewardBalance"><span class="hs-identifier hs-var hs-var">fetchRewardBalance</span></a></span></span><span> </span><span id="local-6989586621682463360"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463360"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463359"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463359"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463358"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k -&gt; (DBLayer IO s k -&gt; IO Coin) -&gt; IO Coin
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463332"><span id="local-6989586621682463333"><span id="local-6989586621682463334"><span id="local-6989586621682463335"><span id="local-6989586621682463336"><span id="local-6989586621682463337"><span id="local-6989586621682463338"><span id="local-6989586621682463339"><span id="local-6989586621682463340"><span id="local-6989586621682463341"><span id="local-6989586621682463342"><span id="local-6989586621682463343"><span id="local-6989586621682463344"><span id="local-6989586621682463345"><span id="local-6989586621682463346"><span id="local-6989586621682463347"><span id="local-6989586621682463348"><span id="local-6989586621682463349"><span id="local-6989586621682463350"><span id="local-6989586621682463351"><span id="local-6989586621682463352"><span id="local-6989586621682463353"><span id="local-6989586621682463354"><span id="local-6989586621682463355"><span id="local-6989586621682463356"><span id="local-6989586621682463357"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463332"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1215"></span><span>    </span><span class="annot"><span class="annottext">stm Coin -&gt; IO Coin
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463332"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm Coin -&gt; IO Coin) -&gt; stm Coin -&gt; IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm Coin
</span><a href="#local-6989586621682463345"><span class="hs-identifier hs-var">readDelegationRewardBalance</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463359"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1216"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1217"></span><span>    </span><span id="local-6989586621682463358"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463358"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463360"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464390"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464389"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1218"></span><span>
</span><span id="line-1219"></span><span class="hs-comment">-- | Read the current withdrawal capacity of a wallet. Note that, this simply</span><span>
</span><span id="line-1220"></span><span class="hs-comment">-- returns 0 if:</span><span>
</span><span id="line-1221"></span><span class="hs-comment">--</span><span>
</span><span id="line-1222"></span><span class="hs-comment">-- a) There's no reward account for this type of wallet.</span><span>
</span><span id="line-1223"></span><span class="hs-comment">-- b) The current reward value is too small to be considered (adding it would</span><span>
</span><span id="line-1224"></span><span class="hs-comment">-- cost more than its value).</span><span>
</span><span id="line-1225"></span><span class="annot"><a href="Cardano.Wallet.html#readNextWithdrawal"><span class="hs-identifier hs-type">readNextWithdrawal</span></a></span><span>
</span><span id="line-1226"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463331"><span class="annot"><a href="#local-6989586621682463331"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463330"><span class="annot"><a href="#local-6989586621682463330"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1227"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463330"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463331"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1228"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463331"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1229"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463331"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-1232"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-1233"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-1234"></span><span id="readNextWithdrawal"><span class="annot"><span class="annottext">readNextWithdrawal :: ctx -&gt; AnyCardanoEra -&gt; Coin -&gt; IO Coin
</span><a href="Cardano.Wallet.html#readNextWithdrawal"><span class="hs-identifier hs-var hs-var">readNextWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682463329"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463329"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463328"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463328"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621682463326"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682463326"><span class="hs-identifier hs-var">withdrawal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1235"></span><span>    </span><span id="local-6989586621682463325"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463325"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463324"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463323"><span class="annot"><span class="annottext">costWith :: Coin
</span><a href="#local-6989586621682463323"><span class="hs-identifier hs-var hs-var">costWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1238"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AcalcMinimumCost%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">calcMinimumCost</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682463321"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463328"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463325"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; TransactionCtx
</span><a href="#local-6989586621682463320"><span class="hs-identifier hs-var">mkTxCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TransactionCtx) -&gt; Coin -&gt; TransactionCtx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682463326"><span class="hs-identifier hs-var">withdrawal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectionSkeleton
</span><a href="Cardano.Wallet.CoinSelection.html#emptySkeleton"><span class="hs-identifier hs-var">emptySkeleton</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463319"><span class="annot"><span class="annottext">costWithout :: Coin
</span><a href="#local-6989586621682463319"><span class="hs-identifier hs-var hs-var">costWithout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1241"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AcalcMinimumCost%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">calcMinimumCost</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682463321"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682463328"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682463325"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; TransactionCtx
</span><a href="#local-6989586621682463320"><span class="hs-identifier hs-var">mkTxCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TransactionCtx) -&gt; Coin -&gt; TransactionCtx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectionSkeleton
</span><a href="Cardano.Wallet.CoinSelection.html#emptySkeleton"><span class="hs-identifier hs-var">emptySkeleton</span></a></span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463318"><span class="annot"><span class="annottext">costOfWithdrawal :: BlockHeight
</span><a href="#local-6989586621682463318"><span class="hs-identifier hs-var hs-var">costOfWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1244"></span><span>            </span><span class="annot"><span class="annottext">Coin -&gt; BlockHeight
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#toInteger"><span class="hs-identifier hs-var">Coin.toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682463323"><span class="hs-identifier hs-var">costWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; BlockHeight
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; BlockHeight
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#toInteger"><span class="hs-identifier hs-var">Coin.toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682463319"><span class="hs-identifier hs-var">costWithout</span></a></span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; BlockHeight
forall a. Integral a =&gt; a -&gt; BlockHeight
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682463326"><span class="hs-identifier hs-var">withdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; BlockHeight
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682463318"><span class="hs-identifier hs-var">costOfWithdrawal</span></a></span><span>
</span><span id="line-1247"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; IO Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1248"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; IO Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682463326"><span class="hs-identifier hs-var">withdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1250"></span><span>    </span><span id="local-6989586621682463321"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682463321"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463329"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463330"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1251"></span><span>    </span><span id="local-6989586621682463324"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682463324"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463329"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span>    </span><span id="local-6989586621682463320"><span class="annot"><span class="annottext">mkTxCtx :: Coin -&gt; TransactionCtx
</span><a href="#local-6989586621682463320"><span class="hs-identifier hs-var hs-var">mkTxCtx</span></a></span></span><span> </span><span id="local-6989586621682463315"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682463315"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-1254"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; NonEmpty DerivationIndex -&gt; Coin -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-var">WithdrawalSelf</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682463312"><span class="hs-identifier hs-var">dummyAcct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682463311"><span class="hs-identifier hs-var">dummyPath</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682463315"><span class="hs-identifier hs-var">wdrl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1255"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1256"></span><span>        </span><span id="local-6989586621682463312"><span class="annot"><span class="annottext">dummyAcct :: RewardAccount
</span><a href="#local-6989586621682463312"><span class="hs-identifier hs-var hs-var">dummyAcct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1257"></span><span>            </span><span class="annot"><span class="annottext">ByteString -&gt; RewardAccount
</span><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-var">RewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1258"></span><span>        </span><span id="local-6989586621682463311"><span class="annot"><span class="annottext">dummyPath :: NonEmpty DerivationIndex
</span><a href="#local-6989586621682463311"><span class="hs-identifier hs-var hs-var">dummyPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1259"></span><span>            </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; [DerivationIndex] -&gt; NonEmpty DerivationIndex
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span class="annot"><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-type">readRewardAccount</span></a></span><span>
</span><span id="line-1262"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682464913"><span class="annot"><a href="#local-6989586621682464913"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682464915"><span class="annot"><a href="#local-6989586621682464915"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682464914"><span class="annot"><a href="#local-6989586621682464914"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682464911"><span class="annot"><a href="#local-6989586621682464911"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682464912"><span class="annot"><a href="#local-6989586621682464912"><span class="hs-identifier hs-type">shelley</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1263"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464915"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464914"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464913"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1264"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682464912"><span class="hs-identifier hs-type">shelley</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464911"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-1265"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464911"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1266"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464915"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464913"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1269"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1270"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier hs-type">ErrReadRewardAccount</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span id="readRewardAccount"><span class="annot"><span class="annottext">readRewardAccount :: ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var hs-var">readRewardAccount</span></a></span></span><span> </span><span id="local-6989586621682463307"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463307"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463306"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463306"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463305"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrReadRewardAccount
         IO
         (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463279"><span id="local-6989586621682463280"><span id="local-6989586621682463281"><span id="local-6989586621682463282"><span id="local-6989586621682463283"><span id="local-6989586621682463284"><span id="local-6989586621682463285"><span id="local-6989586621682463286"><span id="local-6989586621682463287"><span id="local-6989586621682463288"><span id="local-6989586621682463289"><span id="local-6989586621682463290"><span id="local-6989586621682463291"><span id="local-6989586621682463292"><span id="local-6989586621682463293"><span id="local-6989586621682463294"><span id="local-6989586621682463295"><span id="local-6989586621682463296"><span id="local-6989586621682463297"><span id="local-6989586621682463298"><span id="local-6989586621682463299"><span id="local-6989586621682463300"><span id="local-6989586621682463301"><span id="local-6989586621682463302"><span id="local-6989586621682463303"><span id="local-6989586621682463304"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463279"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1272"></span><span>    </span><span id="local-6989586621682463278"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463278"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrReadRewardAccount)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
-&gt; ExceptT ErrReadRewardAccount IO (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrReadRewardAccount
</span><a href="Cardano.Wallet.html#ErrReadRewardAccountNoSuchWallet"><span class="hs-identifier hs-var">ErrReadRewardAccountNoSuchWallet</span></a></span><span>
</span><span id="line-1273"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s)
 -&gt; ExceptT ErrReadRewardAccount IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
-&gt; ExceptT ErrReadRewardAccount IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s))
-&gt; IO (Either ErrNoSuchWallet (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463279"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-1274"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463306"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1275"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463299"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463306"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1276"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeRep s -&gt; TypeRep shelley -&gt; Maybe (s :~: shelley)
forall k (f :: k -&gt; *) (a :: k) (b :: k).
TestEquality f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">testEquality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typeable s =&gt; TypeRep s
forall k (a :: k). Typeable a =&gt; TypeRep a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464915"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typeable shelley =&gt; TypeRep shelley
forall k (a :: k). Typeable a =&gt; TypeRep a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464912"><span class="hs-identifier hs-type">shelley</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1277"></span><span>        </span><span class="annot"><span class="annottext">Maybe (s :~: shelley)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1278"></span><span>            </span><span class="annot"><span class="annottext">ErrReadRewardAccount
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="Cardano.Wallet.html#ErrReadRewardAccountNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadRewardAccountNotAShelleyWallet</span></a></span><span>
</span><span id="line-1279"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">s :~: shelley
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1280"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463274"><span class="annot"><span class="annottext">s :: s
</span><a href="#local-6989586621682463274"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463278"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1281"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463273"><span class="annot"><span class="annottext">xpub :: ShelleyKey 'AddressK XPub
</span><a href="#local-6989586621682463273"><span class="hs-identifier hs-var hs-var">xpub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey -&gt; ShelleyKey 'AddressK XPub
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SeqState n k -&gt; k 'AddressK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#rewardAccountKey"><span class="hs-identifier hs-var hs-var">Seq.rewardAccountKey</span></a></span><span> </span><span class="annot"><span class="annottext">s
SeqState n ShelleyKey
</span><a href="#local-6989586621682463274"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1282"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463271"><span class="annot"><span class="annottext">acct :: RewardAccount
</span><a href="#local-6989586621682463271"><span class="hs-identifier hs-var hs-var">acct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPub -&gt; RewardAccount
forall (k :: Depth -&gt; * -&gt; *).
ToRewardAccount k =&gt;
k 'AddressK XPub -&gt; RewardAccount
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#toRewardAccount"><span class="hs-identifier hs-var">toRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPub
</span><a href="#local-6989586621682463273"><span class="hs-identifier hs-var">xpub</span></a></span><span>
</span><span id="line-1283"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463269"><span class="annot"><span class="annottext">path :: NonEmpty DerivationIndex
</span><a href="#local-6989586621682463269"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationPrefix -&gt; NonEmpty DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#stakeDerivationPath"><span class="hs-identifier hs-var">stakeDerivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationPrefix -&gt; NonEmpty DerivationIndex)
-&gt; DerivationPrefix -&gt; NonEmpty DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey -&gt; DerivationPrefix
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SeqState n k -&gt; DerivationPrefix
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#derivationPrefix"><span class="hs-identifier hs-var hs-var">Seq.derivationPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">s
SeqState n ShelleyKey
</span><a href="#local-6989586621682463274"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1284"></span><span>            </span><span class="annot"><span class="annottext">(RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682463271"><span class="hs-identifier hs-var">acct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPub
</span><a href="#local-6989586621682463273"><span class="hs-identifier hs-var">xpub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682463269"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1286"></span><span>    </span><span id="local-6989586621682463305"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463305"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463307"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464915"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464914"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span class="annot"><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier hs-type">readPolicyPublicKey</span></a></span><span>
</span><span id="line-1289"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463266"><span class="annot"><a href="#local-6989586621682463266"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463265"><span class="annot"><a href="#local-6989586621682463265"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463264"><span class="annot"><a href="#local-6989586621682463264"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463263"><span class="annot"><a href="#local-6989586621682463263"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682463262"><span class="annot"><a href="#local-6989586621682463262"><span class="hs-identifier hs-type">shelley</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1290"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463265"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463264"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463266"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1291"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682463262"><span class="hs-identifier hs-type">shelley</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463263"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-1292"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463263"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1293"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463265"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1294"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1295"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463266"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1296"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1297"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKey"><span class="hs-identifier hs-type">ErrReadPolicyPublicKey</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span id="readPolicyPublicKey"><span class="annot"><span class="annottext">readPolicyPublicKey :: ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier hs-var hs-var">readPolicyPublicKey</span></a></span></span><span> </span><span id="local-6989586621682463261"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463261"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463260"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463260"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463259"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463233"><span id="local-6989586621682463234"><span id="local-6989586621682463235"><span id="local-6989586621682463236"><span id="local-6989586621682463237"><span id="local-6989586621682463238"><span id="local-6989586621682463239"><span id="local-6989586621682463240"><span id="local-6989586621682463241"><span id="local-6989586621682463242"><span id="local-6989586621682463243"><span id="local-6989586621682463244"><span id="local-6989586621682463245"><span id="local-6989586621682463246"><span id="local-6989586621682463247"><span id="local-6989586621682463248"><span id="local-6989586621682463249"><span id="local-6989586621682463250"><span id="local-6989586621682463251"><span id="local-6989586621682463252"><span id="local-6989586621682463253"><span id="local-6989586621682463254"><span id="local-6989586621682463255"><span id="local-6989586621682463256"><span id="local-6989586621682463257"><span id="local-6989586621682463258"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463233"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1299"></span><span>    </span><span id="local-6989586621682463232"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463232"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrReadPolicyPublicKey)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
-&gt; ExceptT ErrReadPolicyPublicKey IO (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrReadPolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyNoSuchWallet</span></a></span><span>
</span><span id="line-1300"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s)
 -&gt; ExceptT ErrReadPolicyPublicKey IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
-&gt; ExceptT ErrReadPolicyPublicKey IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s))
-&gt; IO (Either ErrNoSuchWallet (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463233"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-1301"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463260"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1302"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463253"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463260"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1303"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeRep s -&gt; TypeRep shelley -&gt; Maybe (s :~: shelley)
forall k (f :: k -&gt; *) (a :: k) (b :: k).
TestEquality f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">testEquality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typeable s =&gt; TypeRep s
forall k (a :: k). Typeable a =&gt; TypeRep a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463265"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typeable shelley =&gt; TypeRep shelley
forall k (a :: k). Typeable a =&gt; TypeRep a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463262"><span class="hs-identifier hs-type">shelley</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1304"></span><span>        </span><span class="annot"><span class="annottext">Maybe (s :~: shelley)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1305"></span><span>            </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyNotAShelleyWallet</span></a></span><span>
</span><span id="line-1306"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">s :~: shelley
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1307"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463229"><span class="annot"><span class="annottext">s :: s
</span><a href="#local-6989586621682463229"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463232"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1308"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey -&gt; Maybe (ShelleyKey 'PolicyK XPub)
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SeqState n k -&gt; Maybe (k 'PolicyK XPub)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#policyXPub"><span class="hs-identifier hs-var hs-var">Seq.policyXPub</span></a></span><span> </span><span class="annot"><span class="annottext">s
SeqState n ShelleyKey
</span><a href="#local-6989586621682463229"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1309"></span><span>                </span><span class="annot"><span class="annottext">Maybe (ShelleyKey 'PolicyK XPub)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1310"></span><span>                    </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyAbsent"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyAbsent</span></a></span><span>
</span><span id="line-1311"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682463226"><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682463226"><span class="hs-identifier hs-var">xpub</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1312"></span><span>                    </span><span class="annot"><span class="annottext">(XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682463226"><span class="hs-identifier hs-var">xpub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#policyDerivationPath"><span class="hs-identifier hs-var">policyDerivationPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1313"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1314"></span><span>    </span><span id="local-6989586621682463259"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463259"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463261"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463265"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463264"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1315"></span><span>
</span><span id="line-1316"></span><span class="hs-comment">-- | Query the node for the reward balance of a given wallet.</span><span>
</span><span id="line-1317"></span><span class="hs-comment">--</span><span>
</span><span id="line-1318"></span><span class="hs-comment">-- Rather than force all callers of 'readWallet' to wait for fetching the</span><span>
</span><span id="line-1319"></span><span class="hs-comment">-- account balance (via the 'NetworkLayer'), we expose this function for it.</span><span>
</span><span id="line-1320"></span><span class="annot"><a href="Cardano.Wallet.html#queryRewardBalance"><span class="hs-identifier hs-type">queryRewardBalance</span></a></span><span>
</span><span id="line-1321"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682464910"><span class="annot"><a href="#local-6989586621682464910"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1322"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464910"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1323"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1324"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464910"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1325"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-1326"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewards"><span class="hs-identifier hs-type">ErrFetchRewards</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-1327"></span><span id="queryRewardBalance"><span class="annot"><span class="annottext">queryRewardBalance :: ctx -&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
</span><a href="Cardano.Wallet.html#queryRewardBalance"><span class="hs-identifier hs-var hs-var">queryRewardBalance</span></a></span></span><span> </span><span id="local-6989586621682463225"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463225"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463224"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682463224"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1328"></span><span>    </span><span class="annot"><span class="annottext">IO Coin -&gt; ExceptT ErrFetchRewards IO Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; ExceptT ErrFetchRewards IO Coin)
-&gt; IO Coin -&gt; ExceptT ErrFetchRewards IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; RewardAccount -&gt; IO Coin
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; RewardAccount -&gt; m Coin
</span><a href="Cardano.Wallet.Network.html#getCachedRewardAccountBalance"><span class="hs-identifier hs-var hs-var">getCachedRewardAccountBalance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682463222"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682463224"><span class="hs-identifier hs-var">acct</span></a></span><span>
</span><span id="line-1329"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1330"></span><span>    </span><span id="local-6989586621682463222"><span class="annot"><span class="annottext">nw :: NetworkLayer IO Block
</span><a href="#local-6989586621682463222"><span class="hs-identifier hs-var hs-var">nw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463225"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-1331"></span><span>
</span><span id="line-1332"></span><span class="annot"><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier hs-type">manageRewardBalance</span></a></span><span>
</span><span id="line-1333"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463221"><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463220"><span class="annot"><a href="#local-6989586621682463220"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463219"><span class="annot"><a href="#local-6989586621682463219"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463218"><span class="annot"><a href="#local-6989586621682463218"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-1334"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1335"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1336"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463220"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463219"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1337"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463220"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1338"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463218"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1339"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463218"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1341"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1342"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1343"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span id="manageRewardBalance"><span class="annot"><span class="annottext">manageRewardBalance :: Proxy n -&gt; ctx -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier hs-var hs-var">manageRewardBalance</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682463217"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463217"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463216"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463216"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463215"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k -&gt; (DBLayer IO s k -&gt; IO ()) -&gt; IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463189"><span id="local-6989586621682463190"><span id="local-6989586621682463191"><span id="local-6989586621682463192"><span id="local-6989586621682463193"><span id="local-6989586621682463194"><span id="local-6989586621682463195"><span id="local-6989586621682463196"><span id="local-6989586621682463197"><span id="local-6989586621682463198"><span id="local-6989586621682463199"><span id="local-6989586621682463200"><span id="local-6989586621682463201"><span id="local-6989586621682463202"><span id="local-6989586621682463203"><span id="local-6989586621682463204"><span id="local-6989586621682463205"><span id="local-6989586621682463206"><span id="local-6989586621682463207"><span id="local-6989586621682463208"><span id="local-6989586621682463209"><span id="local-6989586621682463210"><span id="local-6989586621682463211"><span id="local-6989586621682463212"><span id="local-6989586621682463213"><span id="local-6989586621682463214"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463189"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1345"></span><span>    </span><span class="annot"><span class="annottext">(BlockHeader -&gt; IO ()) -&gt; IO ()
</span><a href="#local-6989586621682463188"><span class="hs-identifier hs-var">watchNodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">((BlockHeader -&gt; IO ()) -&gt; IO ())
-&gt; (BlockHeader -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682463187"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463187"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1346"></span><span>         </span><span class="annot"><span class="annottext">Tracer IO WalletLog -&gt; WalletLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog
</span><a href="#local-6989586621682463186"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; IO ()) -&gt; WalletLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgRewardBalanceQuery"><span class="hs-identifier hs-var">MsgRewardBalanceQuery</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682463187"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1347"></span><span>         </span><span id="local-6989586621682463184"><span class="annot"><span class="annottext">Either ErrFetchRewards Coin
</span><a href="#local-6989586621682463184"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrFetchRewards IO Coin -&gt; IO (Either ErrFetchRewards Coin)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrFetchRewards IO Coin
 -&gt; IO (Either ErrFetchRewards Coin))
-&gt; ExceptT ErrFetchRewards IO Coin
-&gt; IO (Either ErrFetchRewards Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1348"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682463183"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682463183"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrReadRewardAccount -&gt; ErrFetchRewards)
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrFetchRewards IO (RewardAccount, XPub, NonEmpty DerivationIndex)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount -&gt; ErrFetchRewards
</span><a href="Cardano.Wallet.html#ErrFetchRewardsReadRewardAccount"><span class="hs-identifier hs-var">ErrFetchRewardsReadRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; ExceptT
      ErrFetchRewards IO (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrFetchRewards IO (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1349"></span><span>                </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463220"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463219"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463218"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463217"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463216"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1350"></span><span>            </span><span class="annot"><span class="annottext">ctx -&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
forall ctx.
HasNetworkLayer IO ctx =&gt;
ctx -&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
</span><a href="Cardano.Wallet.html#queryRewardBalance"><span class="hs-identifier hs-var">queryRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463221"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463217"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682463183"><span class="hs-identifier hs-var">acct</span></a></span><span>
</span><span id="line-1351"></span><span>         </span><span class="annot"><span class="annottext">Tracer IO WalletLog -&gt; WalletLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog
</span><a href="#local-6989586621682463186"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; IO ()) -&gt; WalletLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrFetchRewards Coin -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgRewardBalanceResult"><span class="hs-identifier hs-var">MsgRewardBalanceResult</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrFetchRewards Coin
</span><a href="#local-6989586621682463184"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-1352"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrFetchRewards Coin
</span><a href="#local-6989586621682463184"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1353"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682463180"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682463180"><span class="hs-identifier hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1354"></span><span>                </span><span id="local-6989586621682463179"><span class="annot"><span class="annottext">Either ErrNoSuchWallet ()
</span><a href="#local-6989586621682463179"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463189"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ()))
-&gt; stm (Either ErrNoSuchWallet ())
-&gt; IO (Either ErrNoSuchWallet ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet stm () -&gt; stm (Either ErrNoSuchWallet ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; stm (Either ErrNoSuchWallet ()))
-&gt; ExceptT ErrNoSuchWallet stm ()
-&gt; stm (Either ErrNoSuchWallet ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1355"></span><span>                    </span><span class="annot"><span class="annottext">WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682463203"><span class="hs-identifier hs-var">putDelegationRewardBalance</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463216"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682463180"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-1356"></span><span>                </span><span class="hs-comment">-- It can happen that the wallet doesn't exist _yet_, whereas we</span><span>
</span><span id="line-1357"></span><span>                </span><span class="hs-comment">-- already have a reward balance. If that's the case, we log and</span><span>
</span><span id="line-1358"></span><span>                </span><span class="hs-comment">-- move on.</span><span>
</span><span id="line-1359"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrNoSuchWallet ()
</span><a href="#local-6989586621682463179"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1360"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682463178"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682463178"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog -&gt; WalletLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog
</span><a href="#local-6989586621682463186"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; IO ()) -&gt; WalletLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgRewardBalanceNoSuchWallet"><span class="hs-identifier hs-var">MsgRewardBalanceNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682463178"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1361"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1362"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682463176"><span class="annot"><span class="annottext">ErrFetchRewards
</span><a href="#local-6989586621682463176"><span class="hs-identifier hs-var">_err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1363"></span><span>                </span><span class="hs-comment">-- Occasionally failing to query is generally not fatal. It will</span><span>
</span><span id="line-1364"></span><span>                </span><span class="hs-comment">-- just update the balance next time the tip changes.</span><span>
</span><span id="line-1365"></span><span>                </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>    </span><span class="annot"><span class="annottext">Tracer IO WalletLog -&gt; WalletLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog
</span><a href="#local-6989586621682463186"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLog
</span><a href="Cardano.Wallet.html#MsgRewardBalanceExited"><span class="hs-identifier hs-var">MsgRewardBalanceExited</span></a></span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1369"></span><span>    </span><span id="local-6989586621682463215"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463215"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463217"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463220"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463219"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1370"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463188"><span class="annot"><span class="annottext">(BlockHeader -&gt; IO ()) -&gt; IO ()
watchNodeTip :: forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; (BlockHeader -&gt; m ()) -&gt; m ()
watchNodeTip :: (BlockHeader -&gt; IO ()) -&gt; IO ()
</span><a href="Cardano.Wallet.Network.html#watchNodeTip"><span class="hs-identifier hs-var hs-var">watchNodeTip</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463217"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-1371"></span><span>    </span><span id="local-6989586621682463186"><span class="annot"><span class="annottext">tr :: Tracer IO WalletLog
</span><a href="#local-6989586621682463186"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; WalletWorkerLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO WalletLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO WalletWorkerLog -&gt; Tracer IO WalletLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463217"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer IO WalletWorkerLog
     -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx)
-&gt; Tracer IO WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasLogger IO WalletWorkerLog ctx =&gt;
Lens' ctx (Tracer IO WalletWorkerLog)
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                    Address
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span class="annot"><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier hs-type">lookupTxIns</span></a></span><span>
</span><span id="line-1378"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463171"><span class="annot"><a href="#local-6989586621682463171"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463170"><span class="annot"><a href="#local-6989586621682463170"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463169"><span class="annot"><a href="#local-6989586621682463169"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-operator">.</span><span>
</span><span id="line-1379"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463170"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463169"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463171"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1380"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463170"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1381"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463171"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1383"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1384"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1385"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTx"><span class="hs-identifier hs-type">ErrDecodeTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1386"></span><span id="lookupTxIns"><span class="annot"><span class="annottext">lookupTxIns :: ctx
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier hs-var hs-var">lookupTxIns</span></a></span></span><span> </span><span id="local-6989586621682463168"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463168"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463167"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463167"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463166"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621682463166"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463165"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463139"><span id="local-6989586621682463140"><span id="local-6989586621682463141"><span id="local-6989586621682463142"><span id="local-6989586621682463143"><span id="local-6989586621682463144"><span id="local-6989586621682463145"><span id="local-6989586621682463146"><span id="local-6989586621682463147"><span id="local-6989586621682463148"><span id="local-6989586621682463149"><span id="local-6989586621682463150"><span id="local-6989586621682463151"><span id="local-6989586621682463152"><span id="local-6989586621682463153"><span id="local-6989586621682463154"><span id="local-6989586621682463155"><span id="local-6989586621682463156"><span id="local-6989586621682463157"><span id="local-6989586621682463158"><span id="local-6989586621682463159"><span id="local-6989586621682463160"><span id="local-6989586621682463161"><span id="local-6989586621682463162"><span id="local-6989586621682463163"><span id="local-6989586621682463164"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463139"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1387"></span><span>    </span><span id="local-6989586621682463138"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463138"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrDecodeTx (Wallet s))
 -&gt; IO (Either ErrDecodeTx (Wallet s)))
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
-&gt; ExceptT ErrDecodeTx IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrDecodeTx (Wallet s))
-&gt; IO (Either ErrDecodeTx (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463139"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-1388"></span><span>          </span><span class="annot"><span class="annottext">(ExceptT ErrDecodeTx stm (Wallet s)
 -&gt; ExceptT ErrDecodeTx IO (Wallet s))
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
-&gt; ExceptT ErrDecodeTx IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrDecodeTx)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrDecodeTx
</span><a href="Cardano.Wallet.html#ErrDecodeTxNoSuchWallet"><span class="hs-identifier hs-var">ErrDecodeTxNoSuchWallet</span></a></span><span>
</span><span id="line-1389"></span><span>          </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrDecodeTx stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463167"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1390"></span><span>          </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463159"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463167"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1391"></span><span>    </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
 -&gt; ExceptT
      ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; (TxIn, Maybe (TxOut, NonEmpty DerivationIndex)))
-&gt; [TxIn] -&gt; [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682463136"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682463136"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682463136"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; TxIn -&gt; Maybe (TxOut, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682463135"><span class="hs-identifier hs-var">lookupTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463138"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682463136"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621682463166"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-1392"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1393"></span><span>    </span><span id="local-6989586621682463165"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463165"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463168"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463170"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463169"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1394"></span><span>    </span><span class="annot"><a href="#local-6989586621682463135"><span class="hs-identifier hs-type">lookupTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463170"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1395"></span><span>    </span><span id="local-6989586621682463135"><span class="annot"><span class="annottext">lookupTxIn :: Wallet s -&gt; TxIn -&gt; Maybe (TxOut, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682463135"><span class="hs-identifier hs-var hs-var">lookupTxIn</span></a></span></span><span> </span><span id="local-6989586621682463134"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463134"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621682463133"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682463133"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1396"></span><span>        </span><span id="local-6989586621682463132"><span class="annot"><span class="annottext">out :: TxOut
</span><a href="#local-6989586621682463132"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682463131"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463131"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; UTxO -&gt; Maybe TxOut
</span><a href="Cardano.Wallet.Primitive.Types.UTxO.html#lookup"><span class="hs-identifier hs-var">UTxO.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682463133"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. IsOurs s Address =&gt; Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#totalUTxO"><span class="hs-identifier hs-var">totalUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463134"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1397"></span><span>        </span><span id="local-6989586621682463129"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682463129"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty DerivationIndex), s)
-&gt; Maybe (NonEmpty DerivationIndex)
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (NonEmpty DerivationIndex), s)
 -&gt; Maybe (NonEmpty DerivationIndex))
-&gt; (Maybe (NonEmpty DerivationIndex), s)
-&gt; Maybe (NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
forall s entity.
IsOurs s entity =&gt;
entity -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOurs"><span class="hs-identifier hs-var">isOurs</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463131"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463134"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>        </span><span class="annot"><span class="annottext">(TxOut, NonEmpty DerivationIndex)
-&gt; Maybe (TxOut, NonEmpty DerivationIndex)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682463132"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682463129"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span class="annot"><a href="Cardano.Wallet.html#lookupTxOuts"><span class="hs-identifier hs-type">lookupTxOuts</span></a></span><span>
</span><span id="line-1401"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463127"><span class="annot"><a href="#local-6989586621682463127"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463126"><span class="annot"><a href="#local-6989586621682463126"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463125"><span class="annot"><a href="#local-6989586621682463125"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-operator">.</span><span>
</span><span id="line-1402"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463126"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463125"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463127"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1403"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463126"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1404"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463127"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1406"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1407"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1408"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTx"><span class="hs-identifier hs-type">ErrDecodeTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1409"></span><span id="lookupTxOuts"><span class="annot"><span class="annottext">lookupTxOuts :: ctx
-&gt; WalletId
-&gt; [TxOut]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxOuts"><span class="hs-identifier hs-var hs-var">lookupTxOuts</span></a></span></span><span> </span><span id="local-6989586621682463124"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463124"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463123"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463123"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463122"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682463122"><span class="hs-identifier hs-var">txouts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463121"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463095"><span id="local-6989586621682463096"><span id="local-6989586621682463097"><span id="local-6989586621682463098"><span id="local-6989586621682463099"><span id="local-6989586621682463100"><span id="local-6989586621682463101"><span id="local-6989586621682463102"><span id="local-6989586621682463103"><span id="local-6989586621682463104"><span id="local-6989586621682463105"><span id="local-6989586621682463106"><span id="local-6989586621682463107"><span id="local-6989586621682463108"><span id="local-6989586621682463109"><span id="local-6989586621682463110"><span id="local-6989586621682463111"><span id="local-6989586621682463112"><span id="local-6989586621682463113"><span id="local-6989586621682463114"><span id="local-6989586621682463115"><span id="local-6989586621682463116"><span id="local-6989586621682463117"><span id="local-6989586621682463118"><span id="local-6989586621682463119"><span id="local-6989586621682463120"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463095"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1410"></span><span>    </span><span id="local-6989586621682463094"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463094"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrDecodeTx (Wallet s))
 -&gt; IO (Either ErrDecodeTx (Wallet s)))
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
-&gt; ExceptT ErrDecodeTx IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrDecodeTx (Wallet s))
-&gt; IO (Either ErrDecodeTx (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463095"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-1411"></span><span>          </span><span class="annot"><span class="annottext">(ExceptT ErrDecodeTx stm (Wallet s)
 -&gt; ExceptT ErrDecodeTx IO (Wallet s))
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
-&gt; ExceptT ErrDecodeTx IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrDecodeTx)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrDecodeTx
</span><a href="Cardano.Wallet.html#ErrDecodeTxNoSuchWallet"><span class="hs-identifier hs-var">ErrDecodeTxNoSuchWallet</span></a></span><span>
</span><span id="line-1412"></span><span>          </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrDecodeTx stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrDecodeTx stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463123"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1413"></span><span>          </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463115"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463123"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1414"></span><span>    </span><span class="hs-comment">-- NOTE: We evolve the state (in practice an address pool) as we loop</span><span>
</span><span id="line-1415"></span><span>    </span><span class="hs-comment">-- through the outputs, but we don't consider pending transactions.</span><span>
</span><span id="line-1416"></span><span>    </span><span class="hs-comment">-- /Theoretically/ the outputs might only be discoverable after discovering</span><span>
</span><span id="line-1417"></span><span>    </span><span class="hs-comment">-- outputs other pending transactions.</span><span>
</span><span id="line-1418"></span><span>    </span><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxOut, Maybe (NonEmpty DerivationIndex))]
 -&gt; ExceptT
      ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
 -&gt; s -&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; s
-&gt; State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; s -&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall s a. State s a -&gt; s -&gt; a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">evalState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463094"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
 -&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
-&gt; (TxOut
    -&gt; StateT s Identity (TxOut, Maybe (NonEmpty DerivationIndex)))
-&gt; State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682463122"><span class="hs-identifier hs-var">txouts</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut
  -&gt; StateT s Identity (TxOut, Maybe (NonEmpty DerivationIndex)))
 -&gt; State s [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; (TxOut
    -&gt; StateT s Identity (TxOut, Maybe (NonEmpty DerivationIndex)))
-&gt; State s [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682463092"><span class="annot"><span class="annottext">out :: TxOut
</span><a href="#local-6989586621682463092"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682463091"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463091"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1419"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682463092"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty DerivationIndex)
 -&gt; (TxOut, Maybe (NonEmpty DerivationIndex)))
-&gt; StateT s Identity (Maybe (NonEmpty DerivationIndex))
-&gt; StateT s Identity (TxOut, Maybe (NonEmpty DerivationIndex))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; (Maybe (NonEmpty DerivationIndex), s))
-&gt; StateT s Identity (Maybe (NonEmpty DerivationIndex))
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; (a, s)) -&gt; StateT s m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
forall s entity.
IsOurs s entity =&gt;
entity -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOurs"><span class="hs-identifier hs-var">isOurs</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463091"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1420"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1421"></span><span>    </span><span id="local-6989586621682463121"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463121"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463124"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463126"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463125"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span class="hs-comment">-- | List all addresses of a wallet with their metadata. Addresses</span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- are ordered from the most-recently-discovered to the oldest known.</span><span>
</span><span id="line-1425"></span><span class="annot"><a href="Cardano.Wallet.html#listAddresses"><span class="hs-identifier hs-type">listAddresses</span></a></span><span>
</span><span id="line-1426"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463090"><span class="annot"><a href="#local-6989586621682463090"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463089"><span class="annot"><a href="#local-6989586621682463089"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463088"><span class="annot"><a href="#local-6989586621682463088"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1427"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463089"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463088"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463090"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1428"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#CompareDiscovery"><span class="hs-identifier hs-type">CompareDiscovery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463089"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1429"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#KnownAddresses"><span class="hs-identifier hs-type">KnownAddresses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463089"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1430"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1431"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463090"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1432"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1433"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682463089"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>        </span><span class="hs-comment">-- ^ A function to normalize address, so that delegated addresses</span><span>
</span><span id="line-1435"></span><span>        </span><span class="hs-comment">-- non-delegation addresses found in the transaction history are</span><span>
</span><span id="line-1436"></span><span>        </span><span class="hs-comment">-- shown with their delegation settings.</span><span>
</span><span id="line-1437"></span><span>        </span><span class="hs-comment">-- Use 'Just' for wallet without delegation settings.</span><span>
</span><span id="line-1438"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#AddressState"><span class="hs-identifier hs-type">AddressState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1439"></span><span id="listAddresses"><span class="annot"><span class="annottext">listAddresses :: ctx
-&gt; WalletId
-&gt; (s -&gt; Address -&gt; Maybe Address)
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
</span><a href="Cardano.Wallet.html#listAddresses"><span class="hs-identifier hs-var hs-var">listAddresses</span></a></span></span><span> </span><span id="local-6989586621682463087"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463087"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463086"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463086"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463085"><span class="annot"><span class="annottext">s -&gt; Address -&gt; Maybe Address
</span><a href="#local-6989586621682463085"><span class="hs-identifier hs-var">normalize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463084"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrNoSuchWallet
         IO
         [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463058"><span id="local-6989586621682463059"><span id="local-6989586621682463060"><span id="local-6989586621682463061"><span id="local-6989586621682463062"><span id="local-6989586621682463063"><span id="local-6989586621682463064"><span id="local-6989586621682463065"><span id="local-6989586621682463066"><span id="local-6989586621682463067"><span id="local-6989586621682463068"><span id="local-6989586621682463069"><span id="local-6989586621682463070"><span id="local-6989586621682463071"><span id="local-6989586621682463072"><span id="local-6989586621682463073"><span id="local-6989586621682463074"><span id="local-6989586621682463075"><span id="local-6989586621682463076"><span id="local-6989586621682463077"><span id="local-6989586621682463078"><span id="local-6989586621682463079"><span id="local-6989586621682463080"><span id="local-6989586621682463081"><span id="local-6989586621682463082"><span id="local-6989586621682463083"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463058"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1440"></span><span>    </span><span id="local-6989586621682463057"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463057"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s))
-&gt; IO (Either ErrNoSuchWallet (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463058"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-1441"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463086"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1442"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682463078"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463086"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1443"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682463056"><span class="annot"><span class="annottext">s :: s
</span><a href="#local-6989586621682463056"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682463057"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span>    </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-1446"></span><span>    </span><span class="hs-comment">-- Stream this instead of returning it as a single block.</span><span>
</span><span id="line-1447"></span><span>    </span><span class="annot"><span class="annottext">[(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-1448"></span><span>        </span><span class="annot"><span class="annottext">([(Address, AddressState, NonEmpty DerivationIndex)]
 -&gt; ExceptT
      ErrNoSuchWallet
      IO
      [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Address, AddressState, NonEmpty DerivationIndex)
 -&gt; (Address, AddressState, NonEmpty DerivationIndex) -&gt; Ordering)
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682463054"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463054"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AddressState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682463053"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463053"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AddressState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">s -&gt; Address -&gt; Address -&gt; Ordering
forall s. CompareDiscovery s =&gt; s -&gt; Address -&gt; Address -&gt; Ordering
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#compareDiscovery"><span class="hs-identifier hs-var">compareDiscovery</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463056"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463054"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463053"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>        </span><span class="annot"><span class="annottext">([(Address, AddressState, NonEmpty DerivationIndex)]
 -&gt; [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Address, AddressState, NonEmpty DerivationIndex)
 -&gt; Maybe (Address, AddressState, NonEmpty DerivationIndex))
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682463051"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463051"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682463050"><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682463050"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682463049"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682463049"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682463050"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682463049"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Address -&gt; (Address, AddressState, NonEmpty DerivationIndex))
-&gt; Maybe Address
-&gt; Maybe (Address, AddressState, NonEmpty DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Address -&gt; Maybe Address
</span><a href="#local-6989586621682463085"><span class="hs-identifier hs-var">normalize</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463056"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682463051"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>        </span><span class="annot"><span class="annottext">([(Address, AddressState, NonEmpty DerivationIndex)]
 -&gt; [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
forall s.
KnownAddresses s =&gt;
s -&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#knownAddresses"><span class="hs-identifier hs-var">knownAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463056"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1451"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1452"></span><span>    </span><span id="local-6989586621682463084"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463084"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463087"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463089"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463088"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span class="annot"><a href="Cardano.Wallet.html#createRandomAddress"><span class="hs-identifier hs-type">createRandomAddress</span></a></span><span>
</span><span id="line-1455"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682463047"><span class="annot"><a href="#local-6989586621682463047"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682463046"><span class="annot"><a href="#local-6989586621682463046"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682463045"><span class="annot"><a href="#local-6989586621682463045"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682463044"><span class="annot"><a href="#local-6989586621682463044"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1456"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463046"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463045"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463047"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1457"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463044"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463045"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1458"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndStateLike"><span class="hs-identifier hs-type">RndStateLike</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463046"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1459"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682463045"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1460"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682463046"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1461"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682463047"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1463"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-1465"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1466"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateRandomAddress"><span class="hs-identifier hs-type">ErrCreateRandomAddress</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1467"></span><span id="createRandomAddress"><span class="annot"><span class="annottext">createRandomAddress :: ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; Maybe (Index 'Hardened 'AddressK)
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#createRandomAddress"><span class="hs-identifier hs-var hs-var">createRandomAddress</span></a></span></span><span> </span><span id="local-6989586621682463043"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463043"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682463042"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463042"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682463041"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463041"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span id="local-6989586621682463040"><span class="annot"><span class="annottext">Maybe (Index 'Hardened 'AddressK)
</span><a href="#local-6989586621682463040"><span class="hs-identifier hs-var">mIx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682463039"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682463013"><span id="local-6989586621682463014"><span id="local-6989586621682463015"><span id="local-6989586621682463016"><span id="local-6989586621682463017"><span id="local-6989586621682463018"><span id="local-6989586621682463019"><span id="local-6989586621682463020"><span id="local-6989586621682463021"><span id="local-6989586621682463022"><span id="local-6989586621682463023"><span id="local-6989586621682463024"><span id="local-6989586621682463025"><span id="local-6989586621682463026"><span id="local-6989586621682463027"><span id="local-6989586621682463028"><span id="local-6989586621682463029"><span id="local-6989586621682463030"><span id="local-6989586621682463031"><span id="local-6989586621682463032"><span id="local-6989586621682463033"><span id="local-6989586621682463034"><span id="local-6989586621682463035"><span id="local-6989586621682463036"><span id="local-6989586621682463037"><span id="local-6989586621682463038"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682463013"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1468"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrCreateRandomAddress)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT
         ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463047"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463046"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463045"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463043"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463042"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463041"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrCreateRandomAddress
</span><a href="Cardano.Wallet.html#ErrCreateAddrWithRootKey"><span class="hs-identifier hs-var">ErrCreateAddrWithRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme
  -&gt; ExceptT
       ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex))
 -&gt; ExceptT
      ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex))
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT
         ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682463011"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682463011"><span class="hs-identifier hs-var">xprv</span></a></span></span><span> </span><span id="local-6989586621682463010"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682463010"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1469"></span><span>        </span><span class="annot"><span class="annottext">IO
  (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
 -&gt; ExceptT
      ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex))
-&gt; IO
     (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm
  (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
-&gt; IO
     (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682463013"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm
   (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
 -&gt; IO
      (Either
         ErrCreateRandomAddress (Address, NonEmpty DerivationIndex)))
-&gt; stm
     (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
-&gt; IO
     (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex)))
-&gt; stm
     (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
forall da (m :: * -&gt; *) a b.
(Delta da, Monad m, a ~ Base da) =&gt;
DBVar m da -&gt; (a -&gt; (Maybe da, b)) -&gt; m b
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">modifyDBMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
</span><a href="#local-6989586621682463035"><span class="hs-identifier hs-var">walletsDB</span></a></span><span> </span><span class="annot"><span class="annottext">((Map WalletId (WalletState s)
  -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
      Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex)))
 -&gt; stm
      (Either
         ErrCreateRandomAddress (Address, NonEmpty DerivationIndex)))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex)))
-&gt; stm
     (Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1470"></span><span>            </span><span class="annot"><span class="annottext">WalletId
-&gt; (ErrNoSuchWallet -&gt; ErrCreateRandomAddress)
-&gt; (WalletState s
    -&gt; Either
         ErrCreateRandomAddress
         (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
-&gt; Map WalletId (WalletState s)
-&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
    Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
forall e w dw b.
WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var">adjustNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682463042"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrCreateRandomAddress
</span><a href="Cardano.Wallet.html#ErrCreateAddrNoSuchWallet"><span class="hs-identifier hs-var">ErrCreateAddrNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">((WalletState s
  -&gt; Either
       ErrCreateRandomAddress
       (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
 -&gt; Map WalletId (WalletState s)
 -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
     Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex)))
-&gt; (WalletState s
    -&gt; Either
         ErrCreateRandomAddress
         (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
-&gt; Map WalletId (WalletState s)
-&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
    Either ErrCreateRandomAddress (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1471"></span><span>                </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
-&gt; PassphraseScheme
-&gt; WalletState s
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682463008"><span class="hs-identifier hs-var">createRandomAddress'</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
ByronKey 'RootK XPrv
</span><a href="#local-6989586621682463011"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682463010"><span class="hs-identifier hs-var">scheme</span></a></span><span>
</span><span id="line-1472"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1473"></span><span>    </span><span id="local-6989586621682463039"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682463039"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682463043"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463046"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463045"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1474"></span><span>
</span><span id="line-1475"></span><span>    </span><span id="local-6989586621682463008"><span class="annot"><span class="annottext">createRandomAddress' :: ByronKey 'RootK XPrv
-&gt; PassphraseScheme
-&gt; WalletState s
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682463008"><span class="hs-identifier hs-var hs-var">createRandomAddress'</span></a></span></span><span> </span><span id="local-6989586621682463007"><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682463007"><span class="hs-identifier hs-var">xprv</span></a></span></span><span> </span><span id="local-6989586621682463006"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682463006"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span id="local-6989586621682463005"><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682463005"><span class="hs-identifier hs-var">wal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Index 'Hardened 'AddressK)
</span><a href="#local-6989586621682463040"><span class="hs-identifier hs-var">mIx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1476"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682463004"><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682463004"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK -&gt; s -&gt; Bool
</span><a href="#local-6989586621682463003"><span class="hs-identifier hs-var">isKnownIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682463004"><span class="hs-identifier hs-var">addrIx</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463002"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1477"></span><span>            </span><span class="annot"><span class="annottext">ErrCreateRandomAddress
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrCreateRandomAddress
 -&gt; Either
      ErrCreateRandomAddress
      (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
-&gt; ErrCreateRandomAddress
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK -&gt; ErrCreateRandomAddress
</span><a href="Cardano.Wallet.html#ErrIndexAlreadyExists"><span class="hs-identifier hs-var">ErrIndexAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682463004"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-1478"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682463000"><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682463000"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1479"></span><span>            </span><span class="annot"><span class="annottext">(DeltaWalletState s, (Address, NonEmpty DerivationIndex))
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">((DeltaWalletState s, (Address, NonEmpty DerivationIndex))
 -&gt; Either
      ErrCreateRandomAddress
      (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
-&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationPath, s)
-&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682462999"><span class="hs-identifier hs-var">addAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK -&gt; Index 'WholeDomain 'AccountK
forall (derivation :: DerivationType) (level :: Depth).
LiftIndex derivation =&gt;
Index derivation level -&gt; Index 'WholeDomain level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682462998"><span class="hs-identifier hs-var">accIx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK -&gt; Index 'WholeDomain 'AddressK
forall (derivation :: DerivationType) (level :: Depth).
LiftIndex derivation =&gt;
Index derivation level -&gt; Index 'WholeDomain level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682463000"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463002"><span class="hs-identifier hs-var">s0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1480"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Index 'Hardened 'AddressK)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1481"></span><span>            </span><span class="annot"><span class="annottext">(DeltaWalletState s, (Address, NonEmpty DerivationIndex))
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">((DeltaWalletState s, (Address, NonEmpty DerivationIndex))
 -&gt; Either
      ErrCreateRandomAddress
      (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
-&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
-&gt; Either
     ErrCreateRandomAddress
     (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationPath, s)
-&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682462999"><span class="hs-identifier hs-var">addAddress</span></a></span><span> </span><span class="annot"><span class="annottext">((DerivationPath, s)
 -&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex)))
-&gt; (DerivationPath, s)
-&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; (StdGen -&gt; (DerivationPath, StdGen)) -&gt; (DerivationPath, s)
forall s a.
RndStateLike s =&gt;
s -&gt; (StdGen -&gt; (a, StdGen)) -&gt; (a, s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#withRNG"><span class="hs-identifier hs-var">Rnd.withRNG</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463002"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="annot"><span class="annottext">((StdGen -&gt; (DerivationPath, StdGen)) -&gt; (DerivationPath, s))
-&gt; (StdGen -&gt; (DerivationPath, StdGen)) -&gt; (DerivationPath, s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682462996"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621682462996"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1482"></span><span>                </span><span class="annot"><span class="annottext">StdGen
-&gt; Index 'Hardened 'AccountK
-&gt; Set DerivationPath
-&gt; (DerivationPath, StdGen)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#findUnusedPath"><span class="hs-identifier hs-var">Rnd.findUnusedPath</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621682462996"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682462998"><span class="hs-identifier hs-var">accIx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s -&gt; Set DerivationPath
forall s. RndStateLike s =&gt; s -&gt; Set DerivationPath
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#unavailablePaths"><span class="hs-identifier hs-var">Rnd.unavailablePaths</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463002"><span class="hs-identifier hs-var">s0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1483"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1484"></span><span>        </span><span id="local-6989586621682463002"><span class="annot"><span class="annottext">s0 :: s
</span><a href="#local-6989586621682463002"><span class="hs-identifier hs-var hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; s) -&gt; Wallet s -&gt; s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s -&gt; Wallet s
forall s. AddressBookIso s =&gt; WalletState s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier hs-var">getLatest</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682463005"><span class="hs-identifier hs-var">wal</span></a></span><span>
</span><span id="line-1485"></span><span>        </span><span id="local-6989586621682462998"><span class="annot"><span class="annottext">accIx :: Index 'Hardened 'AccountK
</span><a href="#local-6989586621682462998"><span class="hs-identifier hs-var hs-var">accIx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s -&gt; Index 'Hardened 'AccountK
forall s. RndStateLike s =&gt; s -&gt; Index 'Hardened 'AccountK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#defaultAccountIndex"><span class="hs-identifier hs-var">Rnd.defaultAccountIndex</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682463002"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-1486"></span><span>        </span><span id="local-6989586621682463003"><span class="annot"><span class="annottext">isKnownIndex :: Index 'Hardened 'AddressK -&gt; s -&gt; Bool
</span><a href="#local-6989586621682463003"><span class="hs-identifier hs-var hs-var">isKnownIndex</span></a></span></span><span> </span><span id="local-6989586621682462992"><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682462992"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span> </span><span id="local-6989586621682462991"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462991"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1487"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK -&gt; Index 'WholeDomain 'AccountK
forall (derivation :: DerivationType) (level :: Depth).
LiftIndex derivation =&gt;
Index derivation level -&gt; Index 'WholeDomain level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682462998"><span class="hs-identifier hs-var">accIx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK -&gt; Index 'WholeDomain 'AddressK
forall (derivation :: DerivationType) (level :: Depth).
LiftIndex derivation =&gt;
Index derivation level -&gt; Index 'WholeDomain level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682462992"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DerivationPath -&gt; Set DerivationPath -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Set DerivationPath
forall s. RndStateLike s =&gt; s -&gt; Set DerivationPath
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#unavailablePaths"><span class="hs-identifier hs-var">Rnd.unavailablePaths</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462991"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span>        </span><span id="local-6989586621682462999"><span class="annot"><span class="annottext">addAddress :: (DerivationPath, s)
-&gt; (DeltaWalletState s, (Address, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682462999"><span class="hs-identifier hs-var hs-var">addAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462990"><span class="annot"><span class="annottext">DerivationPath
</span><a href="#local-6989586621682462990"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462989"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462989"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1490"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Prologue s -&gt; DeltaWalletState1 s
forall s. Prologue s -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(Prologue s -&gt; DeltaWalletState1 s)
-&gt; Prologue s -&gt; DeltaWalletState1 s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Prologue s
forall s. AddressBookIso s =&gt; s -&gt; Prologue s
</span><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier hs-var">getPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; Prologue s) -&gt; s -&gt; Prologue s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; DerivationPath -&gt; s -&gt; s
forall s. RndStateLike s =&gt; Address -&gt; DerivationPath -&gt; s -&gt; s
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#addPendingAddress"><span class="hs-identifier hs-var">Rnd.addPendingAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462987"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPath
</span><a href="#local-6989586621682462990"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462989"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1491"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462987"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationPath -&gt; NonEmpty DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#toDerivationIndexes"><span class="hs-identifier hs-var">Rnd.toDerivationIndexes</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPath
</span><a href="#local-6989586621682462990"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1494"></span><span>            </span><span id="local-6989586621682462985"><span class="annot"><span class="annottext">prepared :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462985"><span class="hs-identifier hs-var hs-var">prepared</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682463006"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682463041"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-1495"></span><span>            </span><span id="local-6989586621682462987"><span class="annot"><span class="annottext">addr :: Address
</span><a href="#local-6989586621682462987"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
-&gt; Passphrase &quot;encryption&quot; -&gt; DerivationPath -&gt; Address
forall (n :: NetworkDiscriminant).
PaymentAddress n ByronKey =&gt;
ByronKey 'RootK XPrv
-&gt; Passphrase &quot;encryption&quot; -&gt; DerivationPath -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#deriveRndStateAddress"><span class="hs-identifier hs-var">Rnd.deriveRndStateAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682463044"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682463007"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462985"><span class="hs-identifier hs-var">prepared</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPath
</span><a href="#local-6989586621682462990"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span class="annot"><a href="Cardano.Wallet.html#importRandomAddresses"><span class="hs-identifier hs-type">importRandomAddresses</span></a></span><span>
</span><span id="line-1498"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462983"><span class="annot"><a href="#local-6989586621682462983"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462982"><span class="annot"><a href="#local-6989586621682462982"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462981"><span class="annot"><a href="#local-6989586621682462981"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1499"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462982"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462981"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462983"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1500"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndStateLike"><span class="hs-identifier hs-type">RndStateLike</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462982"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1501"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462981"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1502"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462982"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1503"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462983"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1505"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1506"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1507"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrImportRandomAddress"><span class="hs-identifier hs-type">ErrImportRandomAddress</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1508"></span><span id="importRandomAddresses"><span class="annot"><span class="annottext">importRandomAddresses :: ctx
-&gt; WalletId -&gt; [Address] -&gt; ExceptT ErrImportRandomAddress IO ()
</span><a href="Cardano.Wallet.html#importRandomAddresses"><span class="hs-identifier hs-var hs-var">importRandomAddresses</span></a></span></span><span> </span><span id="local-6989586621682462980"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462980"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462979"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462979"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462978"><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682462978"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462977"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrImportRandomAddress IO ())
-&gt; ExceptT ErrImportRandomAddress IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462951"><span id="local-6989586621682462952"><span id="local-6989586621682462953"><span id="local-6989586621682462954"><span id="local-6989586621682462955"><span id="local-6989586621682462956"><span id="local-6989586621682462957"><span id="local-6989586621682462958"><span id="local-6989586621682462959"><span id="local-6989586621682462960"><span id="local-6989586621682462961"><span id="local-6989586621682462962"><span id="local-6989586621682462963"><span id="local-6989586621682462964"><span id="local-6989586621682462965"><span id="local-6989586621682462966"><span id="local-6989586621682462967"><span id="local-6989586621682462968"><span id="local-6989586621682462969"><span id="local-6989586621682462970"><span id="local-6989586621682462971"><span id="local-6989586621682462972"><span id="local-6989586621682462973"><span id="local-6989586621682462974"><span id="local-6989586621682462975"><span id="local-6989586621682462976"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462951"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1509"></span><span>    </span><span class="annot"><span class="annottext">IO (Either ErrImportRandomAddress ())
-&gt; ExceptT ErrImportRandomAddress IO ()
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrImportRandomAddress ())
 -&gt; ExceptT ErrImportRandomAddress IO ())
-&gt; IO (Either ErrImportRandomAddress ())
-&gt; ExceptT ErrImportRandomAddress IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrImportRandomAddress ())
-&gt; IO (Either ErrImportRandomAddress ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462951"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrImportRandomAddress ())
 -&gt; IO (Either ErrImportRandomAddress ()))
-&gt; stm (Either ErrImportRandomAddress ())
-&gt; IO (Either ErrImportRandomAddress ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrImportRandomAddress ()))
-&gt; stm (Either ErrImportRandomAddress ())
forall da (m :: * -&gt; *) a b.
(Delta da, Monad m, a ~ Base da) =&gt;
DBVar m da -&gt; (a -&gt; (Maybe da, b)) -&gt; m b
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">modifyDBMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
</span><a href="#local-6989586621682462973"><span class="hs-identifier hs-var">walletsDB</span></a></span><span> </span><span class="annot"><span class="annottext">((Map WalletId (WalletState s)
  -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
      Either ErrImportRandomAddress ()))
 -&gt; stm (Either ErrImportRandomAddress ()))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrImportRandomAddress ()))
-&gt; stm (Either ErrImportRandomAddress ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1510"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; (ErrNoSuchWallet -&gt; ErrImportRandomAddress)
-&gt; (WalletState s
    -&gt; Either ErrImportRandomAddress (DeltaWalletState s, ()))
-&gt; Map WalletId (WalletState s)
-&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
    Either ErrImportRandomAddress ())
forall e w dw b.
WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var">adjustNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462979"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrImportRandomAddress
</span><a href="Cardano.Wallet.html#ErrImportAddrNoSuchWallet"><span class="hs-identifier hs-var">ErrImportAddrNoSuchWallet</span></a></span><span>
</span><span id="line-1511"></span><span>            </span><span class="annot"><span class="annottext">WalletState s
-&gt; Either ErrImportRandomAddress (DeltaWalletState s, ())
</span><a href="#local-6989586621682462949"><span class="hs-identifier hs-var">importRandomAddresses'</span></a></span><span>
</span><span id="line-1512"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1513"></span><span>    </span><span id="local-6989586621682462977"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462977"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462980"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462982"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462981"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1514"></span><span>    </span><span id="local-6989586621682462949"><span class="annot"><span class="annottext">importRandomAddresses' :: WalletState s
-&gt; Either ErrImportRandomAddress (DeltaWalletState s, ())
</span><a href="#local-6989586621682462949"><span class="hs-identifier hs-var hs-var">importRandomAddresses'</span></a></span></span><span> </span><span id="local-6989586621682462948"><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682462948"><span class="hs-identifier hs-var">wal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrImportAddress s
</span><a href="#local-6989586621682462947"><span class="hs-identifier hs-var">es1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1515"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682462946"><span class="annot"><span class="annottext">ErrImportAddress
</span><a href="#local-6989586621682462946"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrImportRandomAddress
-&gt; Either ErrImportRandomAddress (DeltaWalletState s, ())
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrImportRandomAddress
 -&gt; Either ErrImportRandomAddress (DeltaWalletState s, ()))
-&gt; ErrImportRandomAddress
-&gt; Either ErrImportRandomAddress (DeltaWalletState s, ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrImportAddress -&gt; ErrImportRandomAddress
</span><a href="Cardano.Wallet.html#ErrImportAddr"><span class="hs-identifier hs-var">ErrImportAddr</span></a></span><span> </span><span class="annot"><span class="annottext">ErrImportAddress
</span><a href="#local-6989586621682462946"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1516"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682462944"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462944"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DeltaWalletState s, ())
-&gt; Either ErrImportRandomAddress (DeltaWalletState s, ())
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Prologue s -&gt; DeltaWalletState1 s
forall s. Prologue s -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(Prologue s -&gt; DeltaWalletState1 s)
-&gt; Prologue s -&gt; DeltaWalletState1 s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Prologue s
forall s. AddressBookIso s =&gt; s -&gt; Prologue s
</span><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier hs-var">getPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462944"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1517"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1518"></span><span>        </span><span id="local-6989586621682462943"><span class="annot"><span class="annottext">s0 :: s
</span><a href="#local-6989586621682462943"><span class="hs-identifier hs-var hs-var">s0</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; s) -&gt; Wallet s -&gt; s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s -&gt; Wallet s
forall s. AddressBookIso s =&gt; WalletState s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier hs-var">getLatest</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682462948"><span class="hs-identifier hs-var">wal</span></a></span><span>
</span><span id="line-1519"></span><span>        </span><span id="local-6989586621682462947"><span class="annot"><span class="annottext">es1 :: Either ErrImportAddress s
</span><a href="#local-6989586621682462947"><span class="hs-identifier hs-var hs-var">es1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either ErrImportAddress s -&gt; Address -&gt; Either ErrImportAddress s)
-&gt; Either ErrImportAddress s
-&gt; [Address]
-&gt; Either ErrImportAddress s
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682462942"><span class="annot"><span class="annottext">Either ErrImportAddress s
</span><a href="#local-6989586621682462942"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682462941"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462941"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ErrImportAddress s
</span><a href="#local-6989586621682462942"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrImportAddress s
-&gt; (s -&gt; Either ErrImportAddress s) -&gt; Either ErrImportAddress s
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; s -&gt; Either ErrImportAddress s
forall s.
RndStateLike s =&gt;
Address -&gt; s -&gt; Either ErrImportAddress s
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#importAddress"><span class="hs-identifier hs-var">Rnd.importAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462941"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s -&gt; Either ErrImportAddress s
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462943"><span class="hs-identifier hs-var">s0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682462978"><span class="hs-identifier hs-var">addrs</span></a></span><span>
</span><span id="line-1520"></span><span>
</span><span id="line-1521"></span><span class="hs-comment">-- NOTE</span><span>
</span><span id="line-1522"></span><span class="hs-comment">-- Addresses coming from the transaction history might be payment or</span><span>
</span><span id="line-1523"></span><span class="hs-comment">-- delegation addresses. So we normalize them all to be delegation addresses</span><span>
</span><span id="line-1524"></span><span class="hs-comment">-- to make sure that we compare them correctly.</span><span>
</span><span id="line-1525"></span><span class="annot"><a href="Cardano.Wallet.html#normalizeDelegationAddress"><span class="hs-identifier hs-type">normalizeDelegationAddress</span></a></span><span>
</span><span id="line-1526"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462939"><span class="annot"><a href="#local-6989586621682462939"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462938"><span class="annot"><a href="#local-6989586621682462938"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682462937"><span class="annot"><a href="#local-6989586621682462937"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1527"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier hs-type">DelegationAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462937"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462938"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1528"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462939"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462937"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462938"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1529"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1530"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462939"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1531"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1532"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1533"></span><span id="normalizeDelegationAddress"><span class="annot"><span class="annottext">normalizeDelegationAddress :: s -&gt; Address -&gt; Maybe Address
</span><a href="Cardano.Wallet.html#normalizeDelegationAddress"><span class="hs-identifier hs-var hs-var">normalizeDelegationAddress</span></a></span></span><span> </span><span id="local-6989586621682462936"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462936"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682462935"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462935"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1534"></span><span>    </span><span id="local-6989586621682462934"><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k
</span><a href="#local-6989586621682462934"><span class="hs-identifier hs-var">fingerprint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either (ErrMkKeyFingerprint k Address) (KeyFingerprint &quot;payment&quot; k)
-&gt; Maybe (KeyFingerprint &quot;payment&quot; k)
forall a b. Either a b -&gt; Maybe b
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
-&gt; Either
     (ErrMkKeyFingerprint k Address) (KeyFingerprint &quot;payment&quot; k)
forall (key :: Depth -&gt; * -&gt; *) from.
MkKeyFingerprint key from =&gt;
from
-&gt; Either
     (ErrMkKeyFingerprint key from) (KeyFingerprint &quot;payment&quot; key)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentKeyFingerprint"><span class="hs-identifier hs-var">paymentKeyFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462935"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1535"></span><span>    </span><span class="annot"><span class="annottext">Address -&gt; Maybe Address
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Maybe Address) -&gt; Address -&gt; Maybe Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k -&gt; k 'AddressK XPub -&gt; Address
forall (network :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
DelegationAddress network key =&gt;
KeyFingerprint &quot;payment&quot; key -&gt; key 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftDelegationAddress"><span class="hs-identifier hs-var">liftDelegationAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462937"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k
</span><a href="#local-6989586621682462934"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'AddressK XPub -&gt; Address) -&gt; k 'AddressK XPub -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SeqState n k -&gt; k 'AddressK XPub
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SeqState n k -&gt; k 'AddressK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#rewardAccountKey"><span class="hs-identifier hs-var hs-var">Seq.rewardAccountKey</span></a></span><span> </span><span class="annot"><span class="annottext">s
SeqState n k
</span><a href="#local-6989586621682462936"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Transaction
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1540"></span><span>
</span><span id="line-1541"></span><span class="hs-comment">-- | A 'PartialTx' is an an unbalanced 'SealedTx' along with the necessary</span><span>
</span><span id="line-1542"></span><span class="hs-comment">-- information to balance it.</span><span>
</span><span id="line-1543"></span><span class="hs-comment">--</span><span>
</span><span id="line-1544"></span><span class="hs-comment">-- The 'inputs' and 'redeemers' must match the binary transaction contained in</span><span>
</span><span id="line-1545"></span><span class="hs-comment">-- the 'sealedTx'.</span><span>
</span><span id="line-1546"></span><span id="local-6989586621682462930"><span id="local-6989586621682462931"></span></span><span class="hs-keyword">data</span><span> </span><span id="PartialTx"><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-var">PartialTx</span></a></span></span><span> </span><span id="local-6989586621682462929"><span class="annot"><a href="#local-6989586621682462929"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PartialTx"><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-var">PartialTx</span></a></span></span><span>
</span><span id="line-1547"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Atx%3APartialTx"><span class="annot"><span class="annottext">PartialTx era -&gt; Tx era
</span><a href="Cardano.Wallet.html#%24sel%3Atx%3APartialTx"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462929"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1548"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ainputs%3APartialTx"><span class="annot"><span class="annottext">PartialTx era -&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="Cardano.Wallet.html#%24sel%3Ainputs%3APartialTx"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Datum&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1549"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aredeemers%3APartialTx"><span class="annot"><span class="annottext">PartialTx era -&gt; [Redeemer]
</span><a href="Cardano.Wallet.html#%24sel%3Aredeemers%3APartialTx"><span class="hs-identifier hs-var hs-var">redeemers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#Redeemer"><span class="hs-identifier hs-type">Redeemer</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1550"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462919"><span id="local-6989586621682462921"><span id="local-6989586621682462923"><span class="annot"><span class="annottext">Int -&gt; PartialTx era -&gt; ShowS
[PartialTx era] -&gt; ShowS
PartialTx era -&gt; String
(Int -&gt; PartialTx era -&gt; ShowS)
-&gt; (PartialTx era -&gt; String)
-&gt; ([PartialTx era] -&gt; ShowS)
-&gt; Show (PartialTx era)
forall era. Int -&gt; PartialTx era -&gt; ShowS
forall era. [PartialTx era] -&gt; ShowS
forall era. PartialTx era -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PartialTx era] -&gt; ShowS
$cshowList :: forall era. [PartialTx era] -&gt; ShowS
show :: PartialTx era -&gt; String
$cshow :: forall era. PartialTx era -&gt; String
showsPrec :: Int -&gt; PartialTx era -&gt; ShowS
$cshowsPrec :: forall era. Int -&gt; PartialTx era -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. PartialTx era -&gt; Rep (PartialTx era) x)
-&gt; (forall x. Rep (PartialTx era) x -&gt; PartialTx era)
-&gt; Generic (PartialTx era)
forall x. Rep (PartialTx era) x -&gt; PartialTx era
forall x. PartialTx era -&gt; Rep (PartialTx era) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall era x. Rep (PartialTx era) x -&gt; PartialTx era
forall era x. PartialTx era -&gt; Rep (PartialTx era) x
$cto :: forall era x. Rep (PartialTx era) x -&gt; PartialTx era
$cfrom :: forall era x. PartialTx era -&gt; Rep (PartialTx era) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462913"><span id="local-6989586621682462915"><span class="annot"><span class="annottext">PartialTx era -&gt; PartialTx era -&gt; Bool
(PartialTx era -&gt; PartialTx era -&gt; Bool)
-&gt; (PartialTx era -&gt; PartialTx era -&gt; Bool) -&gt; Eq (PartialTx era)
forall era. PartialTx era -&gt; PartialTx era -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PartialTx era -&gt; PartialTx era -&gt; Bool
$c/= :: forall era. PartialTx era -&gt; PartialTx era -&gt; Bool
== :: PartialTx era -&gt; PartialTx era -&gt; Bool
$c== :: forall era. PartialTx era -&gt; PartialTx era -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span id="local-6989586621682462912"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">PartialTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462912"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1553"></span><span>    </span><span id="local-6989586621682462909"><span class="annot"><span class="annottext">build :: PartialTx era -&gt; Builder
</span><a href="#local-6989586621682462909"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">PartialTx</span></a></span><span> </span><span id="local-6989586621682462908"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462908"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621682462907"><span class="annot"><span class="annottext">[(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="#local-6989586621682462907"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span id="local-6989586621682462906"><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621682462906"><span class="hs-identifier hs-var">redeemers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">nameF</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;PartialTx&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Builder) -&gt; Builder -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-1554"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">nameF</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxIn, TxOut, Maybe (Hash &quot;Datum&quot;)) -&gt; Builder)
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))] -&gt; Builder
forall (f :: * -&gt; *) a.
Foldable f =&gt;
(a -&gt; Builder) -&gt; f a -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">listF'</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;)) -&gt; Builder
</span><a href="#local-6989586621682462905"><span class="hs-identifier hs-var">inF</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="#local-6989586621682462907"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1555"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">nameF</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;redeemers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Redeemer] -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621682462906"><span class="hs-identifier hs-var">redeemers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">nameF</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;tx&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; Builder
</span><a href="#local-6989586621682462904"><span class="hs-identifier hs-var">cardanoTxF</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462908"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1558"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1559"></span><span>        </span><span class="annot"><a href="#local-6989586621682462905"><span class="hs-identifier hs-type">inF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Datum&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-1560"></span><span>        </span><span id="local-6989586621682462905"><span class="annot"><span class="annottext">inF :: (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;)) -&gt; Builder
</span><a href="#local-6989586621682462905"><span class="hs-identifier hs-var hs-var">inF</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462903"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462903"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682462902"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462902"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682462901"><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
</span><a href="#local-6989586621682462901"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462903"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">TxIn -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462902"><span class="hs-identifier hs-var">o</span></a></span><span class="annot"><span class="annottext">TxOut -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
</span><a href="#local-6989586621682462901"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;) -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span>        </span><span class="annot"><a href="#local-6989586621682462904"><span class="hs-identifier hs-type">cardanoTxF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462912"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-1563"></span><span>        </span><span id="local-6989586621682462904"><span class="annot"><span class="annottext">cardanoTxF :: Tx era -&gt; Builder
</span><a href="#local-6989586621682462904"><span class="hs-identifier hs-var hs-var">cardanoTxF</span></a></span></span><span> </span><span id="local-6989586621682462900"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462900"><span class="hs-identifier hs-var">tx'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; Text -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="../../../../pretty-simple/html/src"><span class="hs-identifier hs-var">pShow</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462900"><span class="hs-identifier hs-var">tx'</span></a></span></span><span>
</span><span id="line-1564"></span><span>
</span><span id="line-1565"></span><span class="annot"><a href="Cardano.Wallet.html#balanceTransaction"><span class="hs-identifier hs-type">balanceTransaction</span></a></span><span>
</span><span id="line-1566"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462899"><span class="annot"><a href="#local-6989586621682462899"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621682462898"><span class="annot"><a href="#local-6989586621682462898"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682462897"><span class="annot"><a href="#local-6989586621682462897"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462896"><span class="annot"><a href="#local-6989586621682462896"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682462895"><span class="annot"><a href="#local-6989586621682462895"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1567"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462896"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462895"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1568"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462897"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1569"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier hs-type">MonadRandom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462898"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1570"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462898"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462895"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1571"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.IsShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462899"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1572"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462896"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1573"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1574"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462895"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1575"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462897"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1576"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ProtocolParameters"><span class="hs-identifier hs-type">W.ProtocolParameters</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.ProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1577"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#UTxOIndex"><span class="hs-identifier hs-type">UTxOIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-type">WalletUTxO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462897"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1579"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">PartialTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462899"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1580"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462898"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462899"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span id="balanceTransaction"><span class="annot"><span class="annottext">balanceTransaction :: ctx
-&gt; ArgGenChange s
-&gt; (ProtocolParameters, ProtocolParameters)
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; PartialTx era
-&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="Cardano.Wallet.html#balanceTransaction"><span class="hs-identifier hs-var hs-var">balanceTransaction</span></a></span></span><span> </span><span id="local-6989586621682462894"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462894"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462893"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462893"><span class="hs-identifier hs-var">change</span></a></span></span><span> </span><span id="local-6989586621682462892"><span class="annot"><span class="annottext">(ProtocolParameters, ProtocolParameters)
</span><a href="#local-6989586621682462892"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621682462891"><span class="annot"><span class="annottext">TimeInterpreter (Either PastHorizonException)
</span><a href="#local-6989586621682462891"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682462890"><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="#local-6989586621682462890"><span class="hs-identifier hs-var">wallet</span></a></span></span><span> </span><span id="local-6989586621682462889"><span class="annot"><span class="annottext">PartialTx era
</span><a href="#local-6989586621682462889"><span class="hs-identifier hs-var">ptx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1582"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462888"><span class="annot"><span class="annottext">balanceWith :: SelectionStrategy -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462888"><span class="hs-identifier hs-var hs-var">balanceWith</span></a></span></span><span> </span><span id="local-6989586621682462887"><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="#local-6989586621682462887"><span class="hs-identifier hs-var">strategy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1583"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; ArgGenChange s
-&gt; (ProtocolParameters, ProtocolParameters)
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; SelectionStrategy
-&gt; PartialTx era
-&gt; ExceptT ErrBalanceTx m (Tx era)
forall era (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
(HasTransactionLayer k ctx, GenChange s, BoundedAddressLength k,
 MonadRandom m, HasLogger m WalletWorkerLog ctx,
 IsShelleyBasedEra era) =&gt;
ctx
-&gt; ArgGenChange s
-&gt; (ProtocolParameters, ProtocolParameters)
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; SelectionStrategy
-&gt; PartialTx era
-&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="Cardano.Wallet.html#balanceTransactionWithSelectionStrategy"><span class="hs-identifier hs-var">balanceTransactionWithSelectionStrategy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462899"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462898"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462897"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462896"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1584"></span><span>                </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462894"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462893"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters, ProtocolParameters)
</span><a href="#local-6989586621682462892"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (Either PastHorizonException)
</span><a href="#local-6989586621682462891"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="#local-6989586621682462890"><span class="hs-identifier hs-var">wallet</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="#local-6989586621682462887"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="annot"><span class="annottext">PartialTx era
</span><a href="#local-6989586621682462889"><span class="hs-identifier hs-var">ptx</span></a></span><span>
</span><span id="line-1585"></span><span>    </span><span class="annot"><span class="annottext">SelectionStrategy -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462888"><span class="hs-identifier hs-var">balanceWith</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-1586"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrBalanceTx m (Tx era)
-&gt; (ErrBalanceTx -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; ExceptT ErrBalanceTx m (Tx era)
forall (m :: * -&gt; *) e a e'.
Monad m =&gt;
ExceptT e m a -&gt; (e -&gt; ExceptT e' m a) -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-operator hs-var">`catchE`</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1587"></span><span>            </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxMaxSizeLimitExceeded"><span class="hs-identifier hs-var">ErrBalanceTxMaxSizeLimitExceeded</span></a></span><span>
</span><span id="line-1588"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462888"><span class="hs-identifier hs-var">balanceWith</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyMinimal"><span class="hs-identifier hs-var">SelectionStrategyMinimal</span></a></span><span>
</span><span id="line-1589"></span><span>            </span><span id="local-6989586621682462882"><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="#local-6989586621682462882"><span class="hs-identifier hs-var">otherErr</span></a></span></span><span>
</span><span id="line-1590"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m (Tx era)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="#local-6989586621682462882"><span class="hs-identifier hs-var">otherErr</span></a></span><span>
</span><span id="line-1591"></span><span>
</span><span id="line-1592"></span><span class="annot"><a href="Cardano.Wallet.html#balanceTransactionWithSelectionStrategy"><span class="hs-identifier hs-type">balanceTransactionWithSelectionStrategy</span></a></span><span>
</span><span id="line-1593"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682464786"><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621682464788"><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682464791"><span class="annot"><a href="#local-6989586621682464791"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682464793"><span class="annot"><a href="#local-6989586621682464793"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682464792"><span class="annot"><a href="#local-6989586621682464792"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1594"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464793"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464792"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1595"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464791"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1596"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464793"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1597"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier hs-type">MonadRandom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1598"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464792"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1599"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.IsShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1600"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464792"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1602"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464791"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1603"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ProtocolParameters"><span class="hs-identifier hs-type">W.ProtocolParameters</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.ProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1605"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#UTxOIndex"><span class="hs-identifier hs-type">UTxOIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-type">WalletUTxO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464791"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategy"><span class="hs-identifier hs-type">SelectionStrategy</span></a></span><span>
</span><span id="line-1607"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">PartialTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1608"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1609"></span><span id="balanceTransactionWithSelectionStrategy"><span class="annot"><span class="annottext">balanceTransactionWithSelectionStrategy :: ctx
-&gt; ArgGenChange s
-&gt; (ProtocolParameters, ProtocolParameters)
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; SelectionStrategy
-&gt; PartialTx era
-&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="Cardano.Wallet.html#balanceTransactionWithSelectionStrategy"><span class="hs-identifier hs-var hs-var">balanceTransactionWithSelectionStrategy</span></a></span></span><span>
</span><span id="line-1610"></span><span>    </span><span id="local-6989586621682462881"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462881"><span class="hs-identifier hs-var">ctx</span></a></span></span><span>
</span><span id="line-1611"></span><span>    </span><span id="local-6989586621682462880"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462880"><span class="hs-identifier hs-var">generateChange</span></a></span></span><span>
</span><span id="line-1612"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682462879"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462878"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462878"><span class="hs-identifier hs-var">nodePParams</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span>    </span><span id="local-6989586621682462877"><span class="annot"><span class="annottext">TimeInterpreter (Either PastHorizonException)
</span><a href="#local-6989586621682462877"><span class="hs-identifier hs-var">ti</span></a></span></span><span>
</span><span id="line-1614"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682462876"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462876"><span class="hs-identifier hs-var">internalUtxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462875"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462875"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462874"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682462874"><span class="hs-identifier hs-var">_pendingTxs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1615"></span><span>    </span><span id="local-6989586621682462873"><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="#local-6989586621682462873"><span class="hs-identifier hs-var">selectionStrategy</span></a></span></span><span>
</span><span id="line-1616"></span><span>    </span><span id="local-6989586621682462872"><span class="annot"><span class="annottext">ptx :: PartialTx era
</span><a href="#local-6989586621682462872"><span class="hs-identifier hs-var">ptx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">PartialTx</span></a></span><span> </span><span id="local-6989586621682462871"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span></span><span> </span><span id="local-6989586621682462870"><span class="annot"><span class="annottext">[(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="#local-6989586621682462870"><span class="hs-identifier hs-var">externalInputs</span></a></span></span><span> </span><span id="local-6989586621682462869"><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621682462869"><span class="hs-identifier hs-var">redeemers</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1617"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1618"></span><span>    </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) era.
Monad m =&gt;
Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462868"><span class="hs-identifier hs-var">guardExistingCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span>
</span><span id="line-1619"></span><span>    </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) era.
Monad m =&gt;
Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462867"><span class="hs-identifier hs-var">guardExistingTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span>
</span><span id="line-1620"></span><span>    </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) era.
Monad m =&gt;
Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462866"><span class="hs-identifier hs-var">guardExistingReturnCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span>
</span><span id="line-1621"></span><span>    </span><span class="annot"><span class="annottext">[TxOut] -&gt; ExceptT ErrBalanceTx m ()
forall s t s (m :: * -&gt; *).
(HasField &quot;coin&quot; s t Coin Coin, HasField &quot;tokens&quot; s s s t,
 Monad m) =&gt;
[s] -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462865"><span class="hs-identifier hs-var">guardZeroAdaOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SealedTx -&gt; [TxOut]
</span><a href="#local-6989586621682462864"><span class="hs-identifier hs-var">extractOutputsFromTx</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; [TxOut]) -&gt; SealedTx -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; SealedTx
</span><a href="#local-6989586621682462863"><span class="hs-identifier hs-var">toSealed</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>    </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) era.
Monad m =&gt;
Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462862"><span class="hs-identifier hs-var">guardConflictingWithdrawalNetworks</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462861"><span class="annot"><span class="annottext">era :: AnyCardanoEra
</span><a href="#local-6989586621682462861"><span class="hs-identifier hs-var hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; AnyCardanoEra
forall era. CardanoEra era -&gt; AnyCardanoEra
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.anyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoEra era -&gt; AnyCardanoEra)
-&gt; CardanoEra era -&gt; AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IsCardanoEra era =&gt; CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.cardanoEra</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682462858"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462858"><span class="hs-identifier hs-var">balance0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462857"><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462857"><span class="hs-identifier hs-var">minfee0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m (Value, Lovelace)
</span><a href="#local-6989586621682462856"><span class="hs-identifier hs-var">balanceAfterSettingMinFee</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682462855"><span class="annot"><span class="annottext">[(TxIn, TxOut)]
</span><a href="#local-6989586621682462855"><span class="hs-identifier hs-var">extraInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462854"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621682462854"><span class="hs-identifier hs-var">extraCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462853"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462853"><span class="hs-identifier hs-var">extraOutputs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1629"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462852"><span class="annot"><span class="annottext">externalSelectedUtxo :: UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462852"><span class="hs-identifier hs-var hs-var">externalSelectedUtxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(WalletUTxO, TokenBundle)] -&gt; UTxOIndex WalletUTxO
forall (f :: * -&gt; *) u.
(Foldable f, Ord u) =&gt;
f (u, TokenBundle) -&gt; UTxOIndex u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#fromSequence"><span class="hs-identifier hs-var">UTxOIndex.fromSequence</span></a></span><span> </span><span class="annot"><span class="annottext">([(WalletUTxO, TokenBundle)] -&gt; UTxOIndex WalletUTxO)
-&gt; [(WalletUTxO, TokenBundle)] -&gt; UTxOIndex WalletUTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1630"></span><span>                </span><span class="annot"><span class="annottext">((TxIn, TxOut, Maybe (Hash &quot;Datum&quot;)) -&gt; (WalletUTxO, TokenBundle))
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
-&gt; [(WalletUTxO, TokenBundle)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682462850"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462850"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682462849"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462849"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682462848"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462848"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682462847"><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
</span><a href="#local-6989586621682462847"><span class="hs-identifier hs-var">_datumHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; Address -&gt; WalletUTxO
</span><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-var">WalletUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462850"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462849"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462848"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span>                </span><span class="annot"><span class="annottext">[(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="#local-6989586621682462870"><span class="hs-identifier hs-var">externalInputs</span></a></span><span>
</span><span id="line-1632"></span><span>        </span><span class="hs-comment">-- TODO [ADP-1544] 'externalInputs' could conflict with the actual</span><span>
</span><span id="line-1633"></span><span>        </span><span class="hs-comment">-- inputs in 'partialTx'.</span><span>
</span><span id="line-1634"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1635"></span><span>        </span><span class="hs-comment">-- Values could be ommitted, added or conflict with the wallet and</span><span>
</span><span id="line-1636"></span><span>        </span><span class="hs-comment">-- ledger UTxO sets.</span><span>
</span><span id="line-1637"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1638"></span><span>        </span><span class="hs-comment">-- It appears 'prop_balanceTransactionUnresolvedInputs'</span><span>
</span><span id="line-1639"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-comment">-- Ideally this would at-worst result in the resulting tx being rejected</span><span>
</span><span id="line-1641"></span><span>        </span><span class="hs-comment">-- by the node. However, /perhaps/:</span><span>
</span><span id="line-1642"></span><span>        </span><span class="hs-comment">-- 1. Any inconsistent input resolution inside 'balanceTransaction'</span><span>
</span><span id="line-1643"></span><span>        </span><span class="hs-comment">--    could lead to unexpected results like fees being burnt.</span><span>
</span><span id="line-1644"></span><span>        </span><span class="hs-comment">-- 2. Incorrect resolution could could lead to phase 2 validation</span><span>
</span><span id="line-1645"></span><span>        </span><span class="hs-comment">--    failures, if e.g. different coin values lead to a different amount</span><span>
</span><span id="line-1646"></span><span>        </span><span class="hs-comment">--    of execution units.</span><span>
</span><span id="line-1647"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1648"></span><span>        </span><span class="hs-comment">-- 'prop_balanceTransactionUnresolvedInputs' show that</span><span>
</span><span id="line-1649"></span><span>        </span><span class="hs-comment">-- 'balanceTransaction' fails if outputs are omitted because of</span><span>
</span><span id="line-1650"></span><span>        </span><span class="hs-comment">-- 'assignScriptRedeemers'. This should make the problem (1) unlikely,</span><span>
</span><span id="line-1651"></span><span>        </span><span class="hs-comment">-- but not necessarily impossible.</span><span>
</span><span id="line-1652"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1653"></span><span>        </span><span class="hs-comment">-- We should investigate and make sure to handle this better.</span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span>        </span><span class="hs-comment">-- NOTE: It is not possible to know the script execution cost in</span><span>
</span><span id="line-1656"></span><span>        </span><span class="hs-comment">-- advance because it actually depends on the final transaction. Inputs</span><span>
</span><span id="line-1657"></span><span>        </span><span class="hs-comment">-- selected as part of the fee balancing might have an influence on the</span><span>
</span><span id="line-1658"></span><span>        </span><span class="hs-comment">-- execution cost.</span><span>
</span><span id="line-1659"></span><span>        </span><span class="hs-comment">-- However, they are bounded so it is possible to balance the</span><span>
</span><span id="line-1660"></span><span>        </span><span class="hs-comment">-- transaction considering only the maximum cost, and only after, try to</span><span>
</span><span id="line-1661"></span><span>        </span><span class="hs-comment">-- adjust the change and ExUnits of each redeemer to something more</span><span>
</span><span id="line-1662"></span><span>        </span><span class="hs-comment">-- sensible than the max execution cost.</span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span>        </span><span id="local-6989586621682462845"><span class="annot"><span class="annottext">StdGenSeed
</span><a href="#local-6989586621682462845"><span class="hs-identifier hs-var">randomSeed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrBalanceTx m StdGenSeed
forall (m :: * -&gt; *). MonadRandom m =&gt; m StdGenSeed
</span><a href="Control.Monad.Random.Extra.html#stdGenSeed"><span class="hs-identifier hs-var">stdGenSeed</span></a></span><span>
</span><span id="line-1665"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1666"></span><span>            </span><span class="annot"><a href="#local-6989586621682462844"><span class="hs-identifier hs-type">transform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682464791"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1667"></span><span>            </span><span id="local-6989586621682462844"><span class="annot"><span class="annottext">transform :: s -&gt; Selection -&gt; ([(TxIn, TxOut)], [TxIn], [TxOut])
</span><a href="#local-6989586621682462844"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621682462843"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462843"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682462842"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462842"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1668"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462841"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462841"><span class="hs-identifier hs-var">sel'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">assignChangeAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462880"><span class="hs-identifier hs-var">generateChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462842"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462843"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1669"></span><span>                    </span><span id="local-6989586621682462840"><span class="annot"><span class="annottext">inputs :: [(TxIn, TxOut)]
</span><a href="#local-6989586621682462840"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TxIn, TxOut) -&gt; [(TxIn, TxOut)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462841"><span class="hs-identifier hs-var">sel'</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
-&gt; ((NonEmpty (TxIn, TxOut)
     -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
    -&gt; SelectionOf TxOut
    -&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut))
-&gt; NonEmpty (TxIn, TxOut)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; SelectionOf TxOut
   -&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut))
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; SelectionOf TxOut
-&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut)
</span><a href="#local-6989586621682462839"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>                </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut)]
</span><a href="#local-6989586621682462840"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-1671"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; TxIn) -&gt; [(TxIn, TxOut)] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462841"><span class="hs-identifier hs-var">sel'</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
-&gt; (([(TxIn, TxOut)] -&gt; Const [(TxIn, TxOut)] [(TxIn, TxOut)])
    -&gt; SelectionOf TxOut -&gt; Const [(TxIn, TxOut)] (SelectionOf TxOut))
-&gt; [(TxIn, TxOut)]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([(TxIn, TxOut)] -&gt; Const [(TxIn, TxOut)] [(TxIn, TxOut)])
   -&gt; SelectionOf TxOut -&gt; Const [(TxIn, TxOut)] (SelectionOf TxOut))
([(TxIn, TxOut)] -&gt; Const [(TxIn, TxOut)] [(TxIn, TxOut)])
-&gt; SelectionOf TxOut -&gt; Const [(TxIn, TxOut)] (SelectionOf TxOut)
</span><a href="#local-6989586621682462838"><span class="hs-var">#collateral</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1672"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462841"><span class="hs-identifier hs-var">sel'</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut])
    -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut)
</span><a href="#local-6989586621682462837"><span class="hs-var">#change</span></a></span><span>
</span><span id="line-1673"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span>        </span><span class="annot"><span class="annottext">m () -&gt; ExceptT ErrBalanceTx m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT ErrBalanceTx m ())
-&gt; m () -&gt; ExceptT ErrBalanceTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462836"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BuildableInAnyEra PartialTx -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionForBalancingStart"><span class="hs-identifier hs-var">MsgSelectionForBalancingStart</span></a></span><span>
</span><span id="line-1676"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Int
forall u. UTxOIndex u -&gt; Int
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#size"><span class="hs-identifier hs-var">UTxOIndex.size</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462876"><span class="hs-identifier hs-var">internalUtxoAvailable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoEra era -&gt; PartialTx era -&gt; BuildableInAnyEra PartialTx
forall (tx :: * -&gt; *) era.
(Eq (tx era), Show (tx era), Buildable (tx era)) =&gt;
CardanoEra era -&gt; tx era -&gt; BuildableInAnyEra tx
</span><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-var">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.cardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">PartialTx era
</span><a href="#local-6989586621682462872"><span class="hs-identifier hs-var">ptx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462832"><span class="annot"><span class="annottext">mSel :: Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462832"><span class="hs-identifier hs-var hs-var">mSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
-&gt; [TxOut]
-&gt; UTxOSelection WalletUTxO
-&gt; Value
-&gt; Lovelace
-&gt; StdGenSeed
-&gt; Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462831"><span class="hs-identifier hs-var">selectAssets'</span></a></span><span>
</span><span id="line-1680"></span><span>                </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462861"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-1681"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SealedTx -&gt; [TxOut]
</span><a href="#local-6989586621682462864"><span class="hs-identifier hs-var">extractOutputsFromTx</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; [TxOut]) -&gt; SealedTx -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; SealedTx
</span><a href="#local-6989586621682462863"><span class="hs-identifier hs-var">toSealed</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1682"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, UTxOIndex WalletUTxO)
-&gt; UTxOSelection WalletUTxO
forall u. Ord u =&gt; (UTxOIndex u, UTxOIndex u) -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndexPair"><span class="hs-identifier hs-var">UTxOSelection.fromIndexPair</span></a></span><span>
</span><span id="line-1683"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462876"><span class="hs-identifier hs-var">internalUtxoAvailable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462852"><span class="hs-identifier hs-var">externalSelectedUtxo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462858"><span class="hs-identifier hs-var">balance0</span></a></span><span>
</span><span id="line-1685"></span><span>                </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462857"><span class="hs-identifier hs-var">minfee0</span></a></span><span>
</span><span id="line-1686"></span><span>                </span><span class="annot"><span class="annottext">StdGenSeed
</span><a href="#local-6989586621682462845"><span class="hs-identifier hs-var">randomSeed</span></a></span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462832"><span class="hs-identifier hs-var">mSel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1689"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682462829"><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682462829"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ExceptT ErrBalanceTx m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT ErrBalanceTx m ())
-&gt; m () -&gt; ExceptT ErrBalanceTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1690"></span><span>                </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462836"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionError"><span class="hs-identifier hs-var">MsgSelectionError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682462829"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1691"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682462827"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462827"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ExceptT ErrBalanceTx m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT ErrBalanceTx m ())
-&gt; m () -&gt; ExceptT ErrBalanceTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1692"></span><span>                </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462836"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportSummarized -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionReportSummarized"><span class="hs-identifier hs-var">MsgSelectionReportSummarized</span></a></span><span>
</span><span id="line-1693"></span><span>                    </span><span class="annot"><span class="annottext">(SelectionReportSummarized -&gt; WalletLog)
-&gt; SelectionReportSummarized -&gt; WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; SelectionReportSummarized
</span><a href="Cardano.Wallet.CoinSelection.html#makeSelectionReportSummarized"><span class="hs-identifier hs-var">makeSelectionReportSummarized</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462827"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1694"></span><span>                </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462836"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportDetailed -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionReportDetailed"><span class="hs-identifier hs-var">MsgSelectionReportDetailed</span></a></span><span>
</span><span id="line-1695"></span><span>                    </span><span class="annot"><span class="annottext">(SelectionReportDetailed -&gt; WalletLog)
-&gt; SelectionReportDetailed -&gt; WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; SelectionReportDetailed
</span><a href="Cardano.Wallet.CoinSelection.html#makeSelectionReportDetailed"><span class="hs-identifier hs-var">makeSelectionReportDetailed</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462827"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1696"></span><span>
</span><span id="line-1697"></span><span>        </span><span class="annot"><span class="annottext">(SelectionError WalletSelectionContext -&gt; ErrBalanceTx)
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     m
     ([(TxIn, TxOut)], [TxIn], [TxOut])
-&gt; ExceptT ErrBalanceTx m ([(TxIn, TxOut)], [TxIn], [TxOut])
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxSelectAssets"><span class="hs-identifier hs-var">ErrBalanceTxSelectAssets</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrSelectAssets -&gt; ErrBalanceTx)
-&gt; (SelectionError WalletSelectionContext -&gt; ErrSelectAssets)
-&gt; SelectionError WalletSelectionContext
-&gt; ErrBalanceTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext -&gt; ErrSelectAssets
</span><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-var">ErrSelectAssetsSelectionError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   (SelectionError WalletSelectionContext)
   m
   ([(TxIn, TxOut)], [TxIn], [TxOut])
 -&gt; ExceptT ErrBalanceTx m ([(TxIn, TxOut)], [TxIn], [TxOut]))
-&gt; (Either
      (SelectionError WalletSelectionContext)
      ([(TxIn, TxOut)], [TxIn], [TxOut])
    -&gt; ExceptT
         (SelectionError WalletSelectionContext)
         m
         ([(TxIn, TxOut)], [TxIn], [TxOut]))
-&gt; Either
     (SelectionError WalletSelectionContext)
     ([(TxIn, TxOut)], [TxIn], [TxOut])
-&gt; ExceptT ErrBalanceTx m ([(TxIn, TxOut)], [TxIn], [TxOut])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either
     (SelectionError WalletSelectionContext)
     ([(TxIn, TxOut)], [TxIn], [TxOut]))
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     m
     ([(TxIn, TxOut)], [TxIn], [TxOut])
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either
      (SelectionError WalletSelectionContext)
      ([(TxIn, TxOut)], [TxIn], [TxOut]))
 -&gt; ExceptT
      (SelectionError WalletSelectionContext)
      m
      ([(TxIn, TxOut)], [TxIn], [TxOut]))
-&gt; (Either
      (SelectionError WalletSelectionContext)
      ([(TxIn, TxOut)], [TxIn], [TxOut])
    -&gt; m (Either
            (SelectionError WalletSelectionContext)
            ([(TxIn, TxOut)], [TxIn], [TxOut])))
-&gt; Either
     (SelectionError WalletSelectionContext)
     ([(TxIn, TxOut)], [TxIn], [TxOut])
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     m
     ([(TxIn, TxOut)], [TxIn], [TxOut])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  (SelectionError WalletSelectionContext)
  ([(TxIn, TxOut)], [TxIn], [TxOut])
-&gt; m (Either
        (SelectionError WalletSelectionContext)
        ([(TxIn, TxOut)], [TxIn], [TxOut]))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either
   (SelectionError WalletSelectionContext)
   ([(TxIn, TxOut)], [TxIn], [TxOut])
 -&gt; ExceptT ErrBalanceTx m ([(TxIn, TxOut)], [TxIn], [TxOut]))
-&gt; Either
     (SelectionError WalletSelectionContext)
     ([(TxIn, TxOut)], [TxIn], [TxOut])
-&gt; ExceptT ErrBalanceTx m ([(TxIn, TxOut)], [TxIn], [TxOut])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1699"></span><span>                </span><span class="annot"><span class="annottext">s -&gt; Selection -&gt; ([(TxIn, TxOut)], [TxIn], [TxOut])
</span><a href="#local-6989586621682462844"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462875"><span class="hs-identifier hs-var">wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Selection -&gt; ([(TxIn, TxOut)], [TxIn], [TxOut]))
-&gt; Either (SelectionError WalletSelectionContext) Selection
-&gt; Either
     (SelectionError WalletSelectionContext)
     ([(TxIn, TxOut)], [TxIn], [TxOut])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462832"><span class="hs-identifier hs-var">mSel</span></a></span><span>
</span><span id="line-1700"></span><span>
</span><span id="line-1701"></span><span>    </span><span class="hs-comment">-- NOTE:</span><span>
</span><span id="line-1702"></span><span>    </span><span class="hs-comment">-- Once the coin selection is done, we need to</span><span>
</span><span id="line-1703"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1704"></span><span>    </span><span class="hs-comment">-- (a) Add selected inputs, collateral and change outputs to the transaction</span><span>
</span><span id="line-1705"></span><span>    </span><span class="hs-comment">-- (b) Assign correct execution units to every redeemer</span><span>
</span><span id="line-1706"></span><span>    </span><span class="hs-comment">-- (c) Correctly reference redeemed entities with redeemer pointers</span><span>
</span><span id="line-1707"></span><span>    </span><span class="hs-comment">-- (d) Adjust fees and change output(s) to the new fees.</span><span>
</span><span id="line-1708"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1709"></span><span>    </span><span class="hs-comment">-- There's a strong assumption that modifying the fee value AND increasing</span><span>
</span><span id="line-1710"></span><span>    </span><span class="hs-comment">-- the coin values of change outputs does not modify transaction fees; or</span><span>
</span><span id="line-1711"></span><span>    </span><span class="hs-comment">-- more exactly, does not modify the execution units of scripts. This is in</span><span>
</span><span id="line-1712"></span><span>    </span><span class="hs-comment">-- principle a fair assumption because script validators ought to be</span><span>
</span><span id="line-1713"></span><span>    </span><span class="hs-comment">-- unaware of change outputs. If their execution costs increase when change</span><span>
</span><span id="line-1714"></span><span>    </span><span class="hs-comment">-- output values increase, then it becomes impossible to guarantee that fee</span><span>
</span><span id="line-1715"></span><span>    </span><span class="hs-comment">-- balancing will ever converge towards a fixed point. A script validator</span><span>
</span><span id="line-1716"></span><span>    </span><span class="hs-comment">-- doing such a thing is considered bonkers and this is not a behavior we</span><span>
</span><span id="line-1717"></span><span>    </span><span class="hs-comment">-- ought to support.</span><span>
</span><span id="line-1718"></span><span>
</span><span id="line-1719"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462822"><span class="annot"><span class="annottext">unsafeFromLovelace :: Lovelace -&gt; Coin
</span><a href="#local-6989586621682462822"><span class="hs-identifier hs-var hs-var">unsafeFromLovelace</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Lovelace</span></a></span><span> </span><span id="local-6989586621682462820"><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462820"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; Coin
forall i. (HasCallStack, Bits i, Integral i, Show i) =&gt; i -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unsafeFromIntegral"><span class="hs-identifier hs-var">Coin.unsafeFromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462820"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1720"></span><span>    </span><span id="local-6989586621682462818"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462818"><span class="hs-identifier hs-var">candidateTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462817"><span class="hs-identifier hs-var">assembleTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxUpdate :: [(TxIn, TxOut)] -&gt; [TxIn] -&gt; [TxOut] -&gt; TxFeeUpdate -&gt; TxUpdate
</span><a href="Cardano.Wallet.Transaction.html#TxUpdate"><span class="hs-identifier hs-type">TxUpdate</span></a></span><span>
</span><span id="line-1721"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut)]
$sel:extraInputs:TxUpdate :: [(TxIn, TxOut)]
extraInputs :: [(TxIn, TxOut)]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraInputs%3ATxUpdate"><span class="hs-identifier hs-var hs-var">extraInputs</span></a></span><span>
</span><span id="line-1722"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxIn]
$sel:extraCollateral:TxUpdate :: [TxIn]
extraCollateral :: [TxIn]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraCollateral%3ATxUpdate"><span class="hs-identifier hs-var hs-var">extraCollateral</span></a></span><span>
</span><span id="line-1723"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxOut]
$sel:extraOutputs:TxUpdate :: [TxOut]
extraOutputs :: [TxOut]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraOutputs%3ATxUpdate"><span class="hs-identifier hs-var hs-var">extraOutputs</span></a></span><span>
</span><span id="line-1724"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:feeUpdate:TxUpdate :: TxFeeUpdate
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AfeeUpdate%3ATxUpdate"><span class="hs-identifier hs-var">feeUpdate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; TxFeeUpdate
</span><a href="Cardano.Wallet.Transaction.html#UseNewTxFee"><span class="hs-identifier hs-var">UseNewTxFee</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TxFeeUpdate) -&gt; Coin -&gt; TxFeeUpdate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Coin
</span><a href="#local-6989586621682462822"><span class="hs-identifier hs-var">unsafeFromLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462857"><span class="hs-identifier hs-var">minfee0</span></a></span><span>
</span><span id="line-1725"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1726"></span><span>
</span><span id="line-1727"></span><span>
</span><span id="line-1728"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682462810"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462810"><span class="hs-identifier hs-var">balance</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462809"><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462809"><span class="hs-identifier hs-var">candidateMinFee</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m (Value, Lovelace)
</span><a href="#local-6989586621682462856"><span class="hs-identifier hs-var">balanceAfterSettingMinFee</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462818"><span class="hs-identifier hs-var">candidateTx</span></a></span><span>
</span><span id="line-1729"></span><span>    </span><span id="local-6989586621682462808"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462808"><span class="hs-identifier hs-var">surplus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Lovelace
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.selectLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462810"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1730"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Lovelace</span></a></span><span> </span><span id="local-6989586621682462806"><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462806"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1731"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462806"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1732"></span><span>                </span><span class="annot"><span class="annottext">Coin -&gt; ExceptT ErrBalanceTx m Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; ExceptT ErrBalanceTx m Coin)
-&gt; Coin -&gt; ExceptT ErrBalanceTx m Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; Coin
forall i. (HasCallStack, Bits i, Integral i, Show i) =&gt; i -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unsafeFromIntegral"><span class="hs-identifier hs-var">Coin.unsafeFromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462806"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1733"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1734"></span><span>                </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m Coin
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrBalanceTx -&gt; ExceptT ErrBalanceTx m Coin)
-&gt; (ErrBalanceTxInternalError -&gt; ErrBalanceTx)
-&gt; ErrBalanceTxInternalError
-&gt; ExceptT ErrBalanceTx m Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTxInternalError -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-var">ErrBalanceTxInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrBalanceTxInternalError -&gt; ExceptT ErrBalanceTx m Coin)
-&gt; ErrBalanceTxInternalError -&gt; ExceptT ErrBalanceTx m Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1735"></span><span>                </span><span class="annot"><span class="annottext">Coin -&gt; SealedTx -&gt; ErrBalanceTxInternalError
</span><a href="Cardano.Wallet.html#ErrUnderestimatedFee"><span class="hs-identifier hs-var">ErrUnderestimatedFee</span></a></span><span>
</span><span id="line-1736"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeight -&gt; Coin
forall i. (HasCallStack, Bits i, Integral i, Show i) =&gt; i -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unsafeFromIntegral"><span class="hs-identifier hs-var">Coin.unsafeFromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462806"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1737"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; SealedTx
</span><a href="#local-6989586621682462863"><span class="hs-identifier hs-var">toSealed</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462818"><span class="hs-identifier hs-var">candidateTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1738"></span><span>
</span><span id="line-1739"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462803"><span class="annot"><span class="annottext">feeAndChange :: TxFeeAndChange [TxOut]
</span><a href="#local-6989586621682462803"><span class="hs-identifier hs-var hs-var">feeAndChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; [TxOut] -&gt; TxFeeAndChange [TxOut]
forall change. Coin -&gt; change -&gt; TxFeeAndChange change
</span><a href="Cardano.Wallet.Transaction.html#TxFeeAndChange"><span class="hs-identifier hs-var">TxFeeAndChange</span></a></span><span>
</span><span id="line-1740"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lovelace -&gt; Coin
</span><a href="#local-6989586621682462822"><span class="hs-identifier hs-var">unsafeFromLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462809"><span class="hs-identifier hs-var">candidateMinFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1741"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462853"><span class="hs-identifier hs-var">extraOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462802"><span class="annot"><span class="annottext">feePolicy :: FeePolicy
</span><a href="#local-6989586621682462802"><span class="hs-identifier hs-var hs-var">feePolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FeePolicy -&gt; Const FeePolicy FeePolicy)
 -&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters)
-&gt; ProtocolParameters -&gt; FeePolicy
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txParameters&quot;
  ((TxParameters -&gt; Const FeePolicy TxParameters)
   -&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters)
(TxParameters -&gt; Const FeePolicy TxParameters)
-&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters
</span><a href="#local-6989586621682462801"><span class="hs-var">#txParameters</span></a></span><span> </span><span class="annot"><span class="annottext">((TxParameters -&gt; Const FeePolicy TxParameters)
 -&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters)
-&gt; ((FeePolicy -&gt; Const FeePolicy FeePolicy)
    -&gt; TxParameters -&gt; Const FeePolicy TxParameters)
-&gt; (FeePolicy -&gt; Const FeePolicy FeePolicy)
-&gt; ProtocolParameters
-&gt; Const FeePolicy ProtocolParameters
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getFeePolicy&quot;
  ((FeePolicy -&gt; Const FeePolicy FeePolicy)
   -&gt; TxParameters -&gt; Const FeePolicy TxParameters)
(FeePolicy -&gt; Const FeePolicy FeePolicy)
-&gt; TxParameters -&gt; Const FeePolicy TxParameters
</span><a href="#local-6989586621682462800"><span class="hs-var">#getFeePolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1743"></span><span>
</span><span id="line-1744"></span><span>    </span><span class="hs-comment">-- @distributeSurplus@ should never fail becase we have provided enough</span><span>
</span><span id="line-1745"></span><span>    </span><span class="hs-comment">-- padding in @selectAssets'@.</span><span>
</span><span id="line-1746"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TxFeeAndChange"><span class="hs-identifier hs-type">TxFeeAndChange</span></a></span><span> </span><span id="local-6989586621682462799"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462799"><span class="hs-identifier hs-var">updatedFee</span></a></span></span><span> </span><span id="local-6989586621682462798"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462798"><span class="hs-identifier hs-var">updatedChange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrMoreSurplusNeeded -&gt; ErrBalanceTx)
-&gt; ExceptT ErrMoreSurplusNeeded m (TxFeeAndChange [TxOut])
-&gt; ExceptT ErrBalanceTx m (TxFeeAndChange [TxOut])
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span>
</span><span id="line-1747"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMoreSurplusNeeded"><span class="hs-identifier hs-type">ErrMoreSurplusNeeded</span></a></span><span> </span><span id="local-6989586621682462797"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462797"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1748"></span><span>            </span><span class="annot"><span class="annottext">ErrBalanceTxInternalError -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-var">ErrBalanceTxInternalError</span></a></span><span>
</span><span id="line-1749"></span><span>                </span><span class="annot"><span class="annottext">(ErrBalanceTxInternalError -&gt; ErrBalanceTx)
-&gt; ErrBalanceTxInternalError -&gt; ErrBalanceTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; SealedTx -&gt; ErrBalanceTxInternalError
</span><a href="Cardano.Wallet.html#ErrUnderestimatedFee"><span class="hs-identifier hs-var">ErrUnderestimatedFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462797"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; SealedTx
</span><a href="#local-6989586621682462863"><span class="hs-identifier hs-var">toSealed</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462818"><span class="hs-identifier hs-var">candidateTx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1750"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut]))
-&gt; ExceptT ErrMoreSurplusNeeded m (TxFeeAndChange [TxOut])
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut]))
 -&gt; ExceptT ErrMoreSurplusNeeded m (TxFeeAndChange [TxOut]))
-&gt; (Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
    -&gt; m (Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])))
-&gt; Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
-&gt; ExceptT ErrMoreSurplusNeeded m (TxFeeAndChange [TxOut])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
-&gt; m (Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut]))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
 -&gt; ExceptT ErrMoreSurplusNeeded m (TxFeeAndChange [TxOut]))
-&gt; Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
-&gt; ExceptT ErrMoreSurplusNeeded m (TxFeeAndChange [TxOut])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; FeePolicy
-&gt; Coin
-&gt; TxFeeAndChange [TxOut]
-&gt; Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; FeePolicy
-&gt; Coin
-&gt; TxFeeAndChange [TxOut]
-&gt; Either ErrMoreSurplusNeeded (TxFeeAndChange [TxOut])
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AdistributeSurplus%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">distributeSurplus</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">FeePolicy
</span><a href="#local-6989586621682462802"><span class="hs-identifier hs-var">feePolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462808"><span class="hs-identifier hs-var">surplus</span></a></span><span> </span><span class="annot"><span class="annottext">TxFeeAndChange [TxOut]
</span><a href="#local-6989586621682462803"><span class="hs-identifier hs-var">feeAndChange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1751"></span><span>
</span><span id="line-1752"></span><span>    </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462794"><span class="hs-identifier hs-var">guardTxSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; ExceptT ErrBalanceTx m (Tx era)
-&gt; ExceptT ErrBalanceTx m (Tx era)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462792"><span class="hs-identifier hs-var">guardTxBalanced</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; ExceptT ErrBalanceTx m (Tx era)
-&gt; ExceptT ErrBalanceTx m (Tx era)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462817"><span class="hs-identifier hs-var">assembleTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxUpdate :: [(TxIn, TxOut)] -&gt; [TxIn] -&gt; [TxOut] -&gt; TxFeeUpdate -&gt; TxUpdate
</span><a href="Cardano.Wallet.Transaction.html#TxUpdate"><span class="hs-identifier hs-type">TxUpdate</span></a></span><span>
</span><span id="line-1753"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut)]
$sel:extraInputs:TxUpdate :: [(TxIn, TxOut)]
extraInputs :: [(TxIn, TxOut)]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraInputs%3ATxUpdate"><span class="hs-identifier hs-var hs-var">extraInputs</span></a></span><span>
</span><span id="line-1754"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxIn]
$sel:extraCollateral:TxUpdate :: [TxIn]
extraCollateral :: [TxIn]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraCollateral%3ATxUpdate"><span class="hs-identifier hs-var hs-var">extraCollateral</span></a></span><span>
</span><span id="line-1755"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:extraOutputs:TxUpdate :: [TxOut]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraOutputs%3ATxUpdate"><span class="hs-identifier hs-var">extraOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462798"><span class="hs-identifier hs-var">updatedChange</span></a></span><span>
</span><span id="line-1756"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:feeUpdate:TxUpdate :: TxFeeUpdate
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AfeeUpdate%3ATxUpdate"><span class="hs-identifier hs-var">feeUpdate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; TxFeeUpdate
</span><a href="Cardano.Wallet.Transaction.html#UseNewTxFee"><span class="hs-identifier hs-var">UseNewTxFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462799"><span class="hs-identifier hs-var">updatedFee</span></a></span><span>
</span><span id="line-1757"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1758"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1759"></span><span>    </span><span id="local-6989586621682462795"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462881"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464793"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1760"></span><span>    </span><span id="local-6989586621682462836"><span class="annot"><span class="annottext">tr :: Tracer m WalletLog
</span><a href="#local-6989586621682462836"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; WalletWorkerLog)
-&gt; Tracer m WalletWorkerLog -&gt; Tracer m WalletLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer m WalletWorkerLog -&gt; Tracer m WalletLog)
-&gt; Tracer m WalletWorkerLog -&gt; Tracer m WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462881"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer m WalletWorkerLog
     -&gt; Const (Tracer m WalletWorkerLog) (Tracer m WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer m WalletWorkerLog) ctx)
-&gt; Tracer m WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg ctx. HasLogger m msg ctx =&gt; Lens' ctx (Tracer m msg)
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1761"></span><span>
</span><span id="line-1762"></span><span>    </span><span class="annot"><a href="#local-6989586621682462863"><span class="hs-identifier hs-type">toSealed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-1763"></span><span>    </span><span id="local-6989586621682462863"><span class="annot"><span class="annottext">toSealed :: Tx era -&gt; SealedTx
</span><a href="#local-6989586621682462863"><span class="hs-identifier hs-var hs-var">toSealed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx -&gt; SealedTx
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#sealedTxFromCardano"><span class="hs-identifier hs-var">sealedTxFromCardano</span></a></span><span> </span><span class="annot"><span class="annottext">(InAnyCardanoEra Tx -&gt; SealedTx)
-&gt; (Tx era -&gt; InAnyCardanoEra Tx) -&gt; Tx era -&gt; SealedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; Tx era -&gt; InAnyCardanoEra Tx
forall era (thing :: * -&gt; *).
IsCardanoEra era =&gt;
CardanoEra era -&gt; thing era -&gt; InAnyCardanoEra thing
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.InAnyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.cardanoEra</span></a></span><span>
</span><span id="line-1764"></span><span>
</span><span id="line-1765"></span><span>    </span><span class="annot"><a href="#local-6989586621682462794"><span class="hs-identifier hs-type">guardTxSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1766"></span><span>    </span><span id="local-6989586621682462794"><span class="annot"><span class="annottext">guardTxSize :: Tx era -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462794"><span class="hs-identifier hs-var hs-var">guardTxSize</span></a></span></span><span> </span><span id="local-6989586621682462790"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462790"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1767"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462789"><span class="annot"><span class="annottext">size :: TxSize
</span><a href="#local-6989586621682462789"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; ProtocolParameters -&gt; Tx era -&gt; TxSize
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   ProtocolParameters -&gt; Tx era -&gt; TxSize
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AestimateSignedTxSize%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">estimateSignedTxSize</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462878"><span class="hs-identifier hs-var">nodePParams</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462790"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1768"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462787"><span class="annot"><span class="annottext">maxSize :: TxSize
</span><a href="#local-6989586621682462787"><span class="hs-identifier hs-var hs-var">maxSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; TxSize
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxSize"><span class="hs-identifier hs-var">TxSize</span></a></span><span>
</span><span id="line-1769"></span><span>                </span><span class="annot"><span class="annottext">(Natural -&gt; TxSize)
-&gt; (Quantity &quot;byte&quot; Word16 -&gt; Natural)
-&gt; Quantity &quot;byte&quot; Word16
-&gt; TxSize
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Natural
forall a b.
(Integral a, Integral b, IsIntSubType a b ~ 'True) =&gt;
a -&gt; b
</span><a href="../../../../int-cast/html/src"><span class="hs-identifier hs-var">intCast</span></a></span><span>
</span><span id="line-1770"></span><span>                </span><span class="annot"><span class="annottext">(Word16 -&gt; Natural)
-&gt; (Quantity &quot;byte&quot; Word16 -&gt; Word16)
-&gt; Quantity &quot;byte&quot; Word16
-&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;byte&quot; Word16 -&gt; Word16
forall (unit :: Symbol) a. Quantity unit a -&gt; a
</span><a href="Data.Quantity.html#getQuantity"><span class="hs-identifier hs-var hs-var">getQuantity</span></a></span><span>
</span><span id="line-1771"></span><span>                </span><span class="annot"><span class="annottext">(Quantity &quot;byte&quot; Word16 -&gt; TxSize)
-&gt; Quantity &quot;byte&quot; Word16 -&gt; TxSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;byte&quot; Word16
  -&gt; Const (Quantity &quot;byte&quot; Word16) (Quantity &quot;byte&quot; Word16))
 -&gt; ProtocolParameters
 -&gt; Const (Quantity &quot;byte&quot; Word16) ProtocolParameters)
-&gt; ProtocolParameters -&gt; Quantity &quot;byte&quot; Word16
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txParameters&quot;
  ((TxParameters -&gt; Const (Quantity &quot;byte&quot; Word16) TxParameters)
   -&gt; ProtocolParameters
   -&gt; Const (Quantity &quot;byte&quot; Word16) ProtocolParameters)
(TxParameters -&gt; Const (Quantity &quot;byte&quot; Word16) TxParameters)
-&gt; ProtocolParameters
-&gt; Const (Quantity &quot;byte&quot; Word16) ProtocolParameters
</span><a href="#local-6989586621682462784"><span class="hs-var">#txParameters</span></a></span><span> </span><span class="annot"><span class="annottext">((TxParameters -&gt; Const (Quantity &quot;byte&quot; Word16) TxParameters)
 -&gt; ProtocolParameters
 -&gt; Const (Quantity &quot;byte&quot; Word16) ProtocolParameters)
-&gt; ((Quantity &quot;byte&quot; Word16
     -&gt; Const (Quantity &quot;byte&quot; Word16) (Quantity &quot;byte&quot; Word16))
    -&gt; TxParameters -&gt; Const (Quantity &quot;byte&quot; Word16) TxParameters)
-&gt; (Quantity &quot;byte&quot; Word16
    -&gt; Const (Quantity &quot;byte&quot; Word16) (Quantity &quot;byte&quot; Word16))
-&gt; ProtocolParameters
-&gt; Const (Quantity &quot;byte&quot; Word16) ProtocolParameters
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getTxMaxSize&quot;
  ((Quantity &quot;byte&quot; Word16
    -&gt; Const (Quantity &quot;byte&quot; Word16) (Quantity &quot;byte&quot; Word16))
   -&gt; TxParameters -&gt; Const (Quantity &quot;byte&quot; Word16) TxParameters)
(Quantity &quot;byte&quot; Word16
 -&gt; Const (Quantity &quot;byte&quot; Word16) (Quantity &quot;byte&quot; Word16))
-&gt; TxParameters -&gt; Const (Quantity &quot;byte&quot; Word16) TxParameters
</span><a href="#local-6989586621682462783"><span class="hs-var">#getTxMaxSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1772"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSize
</span><a href="#local-6989586621682462789"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">TxSize -&gt; TxSize -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxSize
</span><a href="#local-6989586621682462787"><span class="hs-identifier hs-var">maxSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ())
-&gt; ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1773"></span><span>            </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxMaxSizeLimitExceeded"><span class="hs-identifier hs-var">ErrBalanceTxMaxSizeLimitExceeded</span></a></span><span>
</span><span id="line-1774"></span><span>        </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m (Tx era)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462790"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span>    </span><span class="annot"><a href="#local-6989586621682462792"><span class="hs-identifier hs-type">guardTxBalanced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1777"></span><span>    </span><span id="local-6989586621682462792"><span class="annot"><span class="annottext">guardTxBalanced :: Tx era -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462792"><span class="hs-identifier hs-var hs-var">guardTxBalanced</span></a></span></span><span> </span><span id="local-6989586621682462781"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462781"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1778"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462780"><span class="annot"><span class="annottext">bal :: Value
</span><a href="#local-6989586621682462780"><span class="hs-identifier hs-var hs-var">bal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Value
</span><a href="#local-6989586621682462779"><span class="hs-identifier hs-var">txBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462781"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1779"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462780"><span class="hs-identifier hs-var">bal</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1780"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ExceptT ErrBalanceTx m (Tx era)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462781"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1781"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m (Tx era)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrBalanceTx -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; ErrBalanceTx -&gt; ExceptT ErrBalanceTx m (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTxInternalError -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-var">ErrBalanceTxInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrBalanceTxInternalError -&gt; ErrBalanceTx)
-&gt; ErrBalanceTxInternalError -&gt; ErrBalanceTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ErrBalanceTxInternalError
</span><a href="Cardano.Wallet.html#ErrFailedBalancing"><span class="hs-identifier hs-var">ErrFailedBalancing</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462780"><span class="hs-identifier hs-var">bal</span></a></span><span>
</span><span id="line-1782"></span><span>
</span><span id="line-1783"></span><span>    </span><span class="annot"><a href="#local-6989586621682462779"><span class="hs-identifier hs-type">txBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Value</span></a></span><span>
</span><span id="line-1784"></span><span>    </span><span id="local-6989586621682462779"><span class="annot"><span class="annottext">txBalance :: Tx era -&gt; Value
</span><a href="#local-6989586621682462779"><span class="hs-identifier hs-var hs-var">txBalance</span></a></span></span><span> </span><span id="local-6989586621682462777"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462777"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1785"></span><span>        </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; Tx era
-&gt; ProtocolParameters
-&gt; UTxO
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
-&gt; Value
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   Tx era
   -&gt; ProtocolParameters
   -&gt; UTxO
   -&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
   -&gt; Value
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AevaluateTransactionBalance%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">evaluateTransactionBalance</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462777"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462878"><span class="hs-identifier hs-var">nodePParams</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682462775"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="#local-6989586621682462870"><span class="hs-identifier hs-var">externalInputs</span></a></span><span>
</span><span id="line-1786"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1787"></span><span>        </span><span id="local-6989586621682462775"><span class="annot"><span class="annottext">utxo :: UTxO
</span><a href="#local-6989586621682462775"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map WalletUTxO TokenBundle -&gt; UTxO
</span><a href="Cardano.Wallet.CoinSelection.html#toExternalUTxOMap"><span class="hs-identifier hs-var">CS.toExternalUTxOMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Map WalletUTxO TokenBundle -&gt; UTxO)
-&gt; Map WalletUTxO TokenBundle -&gt; UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462876"><span class="hs-identifier hs-var">internalUtxoAvailable</span></a></span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span>    </span><span class="annot"><a href="#local-6989586621682462856"><span class="hs-identifier hs-type">balanceAfterSettingMinFee</span></a></span><span>
</span><span id="line-1790"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1791"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Lovelace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span>    </span><span id="local-6989586621682462856"><span class="annot"><span class="annottext">balanceAfterSettingMinFee :: Tx era -&gt; ExceptT ErrBalanceTx m (Value, Lovelace)
</span><a href="#local-6989586621682462856"><span class="hs-identifier hs-var hs-var">balanceAfterSettingMinFee</span></a></span></span><span> </span><span id="local-6989586621682462772"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462772"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either ErrBalanceTx (Value, Lovelace))
-&gt; ExceptT ErrBalanceTx m (Value, Lovelace)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either ErrBalanceTx (Value, Lovelace))
 -&gt; ExceptT ErrBalanceTx m (Value, Lovelace))
-&gt; (Either ErrBalanceTx (Value, Lovelace)
    -&gt; m (Either ErrBalanceTx (Value, Lovelace)))
-&gt; Either ErrBalanceTx (Value, Lovelace)
-&gt; ExceptT ErrBalanceTx m (Value, Lovelace)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrBalanceTx (Value, Lovelace)
-&gt; m (Either ErrBalanceTx (Value, Lovelace))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrBalanceTx (Value, Lovelace)
 -&gt; ExceptT ErrBalanceTx m (Value, Lovelace))
-&gt; Either ErrBalanceTx (Value, Lovelace)
-&gt; ExceptT ErrBalanceTx m (Value, Lovelace)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1793"></span><span>        </span><span class="hs-comment">-- NOTE: evaluateMinimumFee relies on correctly estimating the required</span><span>
</span><span id="line-1794"></span><span>        </span><span class="hs-comment">-- number of witnesses.</span><span>
</span><span id="line-1795"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462771"><span class="annot"><span class="annottext">minfee :: Coin
</span><a href="#local-6989586621682462771"><span class="hs-identifier hs-var hs-var">minfee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx -&gt; ProtocolParameters -&gt; Tx era -&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   ProtocolParameters -&gt; Tx era -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AevaluateMinimumFee%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">evaluateMinimumFee</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462878"><span class="hs-identifier hs-var">nodePParams</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462772"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1796"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462769"><span class="annot"><span class="annottext">update :: TxUpdate
</span><a href="#local-6989586621682462769"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut)] -&gt; [TxIn] -&gt; [TxOut] -&gt; TxFeeUpdate -&gt; TxUpdate
</span><a href="Cardano.Wallet.Transaction.html#TxUpdate"><span class="hs-identifier hs-var">TxUpdate</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; TxFeeUpdate
</span><a href="Cardano.Wallet.Transaction.html#UseNewTxFee"><span class="hs-identifier hs-var">UseNewTxFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462771"><span class="hs-identifier hs-var">minfee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1797"></span><span>        </span><span id="local-6989586621682462768"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462768"><span class="hs-identifier hs-var">tx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrUpdateSealedTx -&gt; ErrBalanceTx)
-&gt; Either ErrUpdateSealedTx (Tx era)
-&gt; Either ErrBalanceTx (Tx era)
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrUpdateSealedTx -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxUpdateError"><span class="hs-identifier hs-var">ErrBalanceTxUpdateError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrUpdateSealedTx (Tx era) -&gt; Either ErrBalanceTx (Tx era))
-&gt; Either ErrUpdateSealedTx (Tx era)
-&gt; Either ErrBalanceTx (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; Tx era -&gt; TxUpdate -&gt; Either ErrUpdateSealedTx (Tx era)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   Tx era -&gt; TxUpdate -&gt; Either ErrUpdateSealedTx (Tx era)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AupdateTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">updateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462772"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxUpdate
</span><a href="#local-6989586621682462769"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-1798"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462765"><span class="annot"><span class="annottext">balance :: Value
</span><a href="#local-6989586621682462765"><span class="hs-identifier hs-var hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; Tx era
-&gt; ProtocolParameters
-&gt; UTxO
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
-&gt; Value
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   Tx era
   -&gt; ProtocolParameters
   -&gt; UTxO
   -&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
   -&gt; Value
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AevaluateTransactionBalance%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">evaluateTransactionBalance</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462768"><span class="hs-identifier hs-var">tx'</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462878"><span class="hs-identifier hs-var">nodePParams</span></a></span><span>
</span><span id="line-1799"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map WalletUTxO TokenBundle -&gt; UTxO
</span><a href="Cardano.Wallet.CoinSelection.html#toExternalUTxOMap"><span class="hs-identifier hs-var">CS.toExternalUTxOMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Map WalletUTxO TokenBundle -&gt; UTxO)
-&gt; Map WalletUTxO TokenBundle -&gt; UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462876"><span class="hs-identifier hs-var">internalUtxoAvailable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1800"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
  -&gt; Const
       [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
       [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))])
 -&gt; PartialTx era
 -&gt; Const [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))] (PartialTx era))
-&gt; PartialTx era -&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
    -&gt; Const
         [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
         [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))])
   -&gt; PartialTx era
   -&gt; Const [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))] (PartialTx era))
([(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
 -&gt; Const
      [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
      [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))])
-&gt; PartialTx era
-&gt; Const [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))] (PartialTx era)
</span><a href="#local-6989586621682462764"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">PartialTx era
</span><a href="#local-6989586621682462872"><span class="hs-identifier hs-var">ptx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462763"><span class="annot"><span class="annottext">minfee' :: Lovelace
</span><a href="#local-6989586621682462763"><span class="hs-identifier hs-var hs-var">minfee'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; Lovelace
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.Lovelace</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeight -&gt; Lovelace) -&gt; BlockHeight -&gt; Lovelace
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; BlockHeight
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; BlockHeight) -&gt; Natural -&gt; BlockHeight
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462771"><span class="hs-identifier hs-var">minfee</span></a></span><span>
</span><span id="line-1802"></span><span>        </span><span class="annot"><span class="annottext">(Value, Lovelace) -&gt; Either ErrBalanceTx (Value, Lovelace)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462765"><span class="hs-identifier hs-var">balance</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462763"><span class="hs-identifier hs-var">minfee'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1803"></span><span>
</span><span id="line-1804"></span><span>    </span><span class="annot"><a href="#local-6989586621682462817"><span class="hs-identifier hs-type">assembleTransaction</span></a></span><span>
</span><span id="line-1805"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TxUpdate"><span class="hs-identifier hs-type">TxUpdate</span></a></span><span>
</span><span id="line-1806"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1807"></span><span>    </span><span id="local-6989586621682462817"><span class="annot"><span class="annottext">assembleTransaction :: TxUpdate -&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="#local-6989586621682462817"><span class="hs-identifier hs-var hs-var">assembleTransaction</span></a></span></span><span> </span><span id="local-6989586621682462761"><span class="annot"><span class="annottext">TxUpdate
</span><a href="#local-6989586621682462761"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either ErrBalanceTx (Tx era)) -&gt; ExceptT ErrBalanceTx m (Tx era)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either ErrBalanceTx (Tx era))
 -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; (Either ErrBalanceTx (Tx era)
    -&gt; m (Either ErrBalanceTx (Tx era)))
-&gt; Either ErrBalanceTx (Tx era)
-&gt; ExceptT ErrBalanceTx m (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrBalanceTx (Tx era) -&gt; m (Either ErrBalanceTx (Tx era))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrBalanceTx (Tx era) -&gt; ExceptT ErrBalanceTx m (Tx era))
-&gt; Either ErrBalanceTx (Tx era) -&gt; ExceptT ErrBalanceTx m (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1808"></span><span>        </span><span id="local-6989586621682462760"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462760"><span class="hs-identifier hs-var">tx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrUpdateSealedTx -&gt; ErrBalanceTx)
-&gt; Either ErrUpdateSealedTx (Tx era)
-&gt; Either ErrBalanceTx (Tx era)
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrUpdateSealedTx -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxUpdateError"><span class="hs-identifier hs-var">ErrBalanceTxUpdateError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrUpdateSealedTx (Tx era) -&gt; Either ErrBalanceTx (Tx era))
-&gt; Either ErrUpdateSealedTx (Tx era)
-&gt; Either ErrBalanceTx (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; Tx era -&gt; TxUpdate -&gt; Either ErrUpdateSealedTx (Tx era)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   Tx era -&gt; TxUpdate -&gt; Either ErrUpdateSealedTx (Tx era)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AupdateTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">updateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462871"><span class="hs-identifier hs-var">partialTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxUpdate
</span><a href="#local-6989586621682462761"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-1809"></span><span>        </span><span class="annot"><span class="annottext">(ErrAssignRedeemers -&gt; ErrBalanceTx)
-&gt; Either ErrAssignRedeemers (Tx era)
-&gt; Either ErrBalanceTx (Tx era)
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAssignRedeemers -&gt; ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxAssignRedeemers"><span class="hs-identifier hs-var">ErrBalanceTxAssignRedeemers</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrAssignRedeemers (Tx era)
 -&gt; Either ErrBalanceTx (Tx era))
-&gt; Either ErrAssignRedeemers (Tx era)
-&gt; Either ErrBalanceTx (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; ProtocolParameters
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (TxIn -&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;)))
-&gt; [Redeemer]
-&gt; Tx era
-&gt; Either ErrAssignRedeemers (Tx era)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; forall era.
   IsShelleyBasedEra era =&gt;
   ProtocolParameters
   -&gt; TimeInterpreter (Either PastHorizonException)
   -&gt; (TxIn -&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;)))
   -&gt; [Redeemer]
   -&gt; Tx era
   -&gt; Either ErrAssignRedeemers (Tx era)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AassignScriptRedeemers%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">assignScriptRedeemers</span></a></span><span>
</span><span id="line-1810"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462878"><span class="hs-identifier hs-var">nodePParams</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (Either PastHorizonException)
</span><a href="#local-6989586621682462877"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
</span><a href="#local-6989586621682462757"><span class="hs-identifier hs-var">resolveInput</span></a></span><span> </span><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621682462869"><span class="hs-identifier hs-var">redeemers</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682462760"><span class="hs-identifier hs-var">tx'</span></a></span><span>
</span><span id="line-1811"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1812"></span><span>        </span><span class="annot"><a href="#local-6989586621682462757"><span class="hs-identifier hs-type">resolveInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Datum&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>        </span><span id="local-6989586621682462757"><span class="annot"><span class="annottext">resolveInput :: TxIn -&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
</span><a href="#local-6989586621682462757"><span class="hs-identifier hs-var hs-var">resolveInput</span></a></span></span><span> </span><span id="local-6989586621682462756"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462756"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1814"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682462755"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462755"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682462754"><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
</span><a href="#local-6989586621682462754"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462755"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
</span><a href="#local-6989586621682462754"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1815"></span><span>                </span><span class="annot"><span class="annottext">((TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))
 -&gt; (TxOut, Maybe (Hash &quot;Datum&quot;)))
-&gt; Maybe (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))
-&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut, Maybe (Hash &quot;Datum&quot;)) -&gt; Bool)
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
-&gt; Maybe (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682462752"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462752"><span class="hs-identifier hs-var">i'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TxOut
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxIn -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462752"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
</span><a href="#local-6989586621682462870"><span class="hs-identifier hs-var">externalInputs</span></a></span><span>
</span><span id="line-1816"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
-&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
-&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span>
</span><span id="line-1817"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682462751"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462751"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462751"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash &quot;Datum&quot;)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1818"></span><span>                </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; (TxOut, Maybe (Hash &quot;Datum&quot;)))
-&gt; Maybe (TxIn, TxOut) -&gt; Maybe (TxOut, Maybe (Hash &quot;Datum&quot;))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; Bool) -&gt; [(TxIn, TxOut)] -&gt; Maybe (TxIn, TxOut)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682462750"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462750"><span class="hs-identifier hs-var">i'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TxOut
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxIn -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462750"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxUpdate -&gt; [(TxIn, TxOut)]
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AextraInputs%3ATxUpdate"><span class="hs-identifier hs-var hs-var">extraInputs</span></a></span><span> </span><span class="annot"><span class="annottext">TxUpdate
</span><a href="#local-6989586621682462761"><span class="hs-identifier hs-var">update</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1819"></span><span>
</span><span id="line-1820"></span><span>    </span><span id="local-6989586621682462865"><span class="annot"><span class="annottext">guardZeroAdaOutputs :: [s] -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462865"><span class="hs-identifier hs-var hs-var">guardZeroAdaOutputs</span></a></span></span><span> </span><span id="local-6989586621682462749"><span class="annot"><span class="annottext">[s]
</span><a href="#local-6989586621682462749"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1821"></span><span>        </span><span class="hs-comment">-- We seem to produce imbalanced transactions if zero-ada</span><span>
</span><span id="line-1822"></span><span>        </span><span class="hs-comment">-- outputs are pre-specified. Example from</span><span>
</span><span id="line-1823"></span><span>        </span><span class="hs-comment">-- 'prop_balanceTransactionBalanced':</span><span>
</span><span id="line-1824"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1825"></span><span>        </span><span class="hs-comment">-- balanced tx:</span><span>
</span><span id="line-1826"></span><span>        </span><span class="hs-comment">--  2afeed9b</span><span>
</span><span id="line-1827"></span><span>        </span><span class="hs-comment">--  []</span><span>
</span><span id="line-1828"></span><span>        </span><span class="hs-comment">--  inputs 2nd 01f4b788</span><span>
</span><span id="line-1829"></span><span>        </span><span class="hs-comment">--  outputs address: 82d81858...6f57b300</span><span>
</span><span id="line-1830"></span><span>        </span><span class="hs-comment">--          coin: 0.000000</span><span>
</span><span id="line-1831"></span><span>        </span><span class="hs-comment">--          tokens: []</span><span>
</span><span id="line-1832"></span><span>        </span><span class="hs-comment">--  []</span><span>
</span><span id="line-1833"></span><span>        </span><span class="hs-comment">--  metadata:</span><span>
</span><span id="line-1834"></span><span>        </span><span class="hs-comment">--  scriptValidity: valid</span><span>
</span><span id="line-1835"></span><span>
</span><span id="line-1836"></span><span>        </span><span class="hs-comment">--  Lovelace 1000000 /= Lovelace 0</span><span>
</span><span id="line-1837"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1838"></span><span>        </span><span class="hs-comment">--  This is probably due to selectAssets replacing 0 ada outputs with</span><span>
</span><span id="line-1839"></span><span>        </span><span class="hs-comment">--  minUTxOValue in the selection, which doesn't end up in the CBOR tx.</span><span>
</span><span id="line-1840"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462748"><span class="annot"><span class="annottext">zeroAdaOutputs :: [s]
</span><a href="#local-6989586621682462748"><span class="hs-identifier hs-var hs-var">zeroAdaOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1841"></span><span>                </span><span class="annot"><span class="annottext">(s -&gt; Bool) -&gt; [s] -&gt; [s]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682462747"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462747"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin) -&gt; s -&gt; Const Coin s) -&gt; s -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel &quot;tokens&quot; ((s -&gt; Const Coin t) -&gt; s -&gt; Const Coin s)
(s -&gt; Const Coin t) -&gt; s -&gt; Const Coin s
</span><a href="#local-6989586621682462746"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">((s -&gt; Const Coin t) -&gt; s -&gt; Const Coin s)
-&gt; ((Coin -&gt; Const Coin Coin) -&gt; s -&gt; Const Coin t)
-&gt; (Coin -&gt; Const Coin Coin)
-&gt; s
-&gt; Const Coin s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;coin&quot; ((Coin -&gt; Const Coin Coin) -&gt; s -&gt; Const Coin t)
(Coin -&gt; Const Coin Coin) -&gt; s -&gt; Const Coin t
</span><a href="#local-6989586621682462745"><span class="hs-var">#coin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462747"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[s]
</span><a href="#local-6989586621682462749"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-1842"></span><span>
</span><span id="line-1843"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[s] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[s]
</span><a href="#local-6989586621682462748"><span class="hs-identifier hs-var">zeroAdaOutputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ())
-&gt; ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1844"></span><span>            </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxZeroAdaOutput"><span class="hs-identifier hs-var">ErrBalanceTxZeroAdaOutput</span></a></span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span>    </span><span id="local-6989586621682462864"><span class="annot"><span class="annottext">extractOutputsFromTx :: SealedTx -&gt; [TxOut]
</span><a href="#local-6989586621682462864"><span class="hs-identifier hs-var hs-var">extractOutputsFromTx</span></a></span></span><span> </span><span id="local-6989586621682462742"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462742"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1847"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1848"></span><span>            </span><span id="local-6989586621682462741"><span class="annot"><span class="annottext">era :: AnyCardanoEra
</span><a href="#local-6989586621682462741"><span class="hs-identifier hs-var hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; AnyCardanoEra
forall era. IsCardanoEra era =&gt; CardanoEra era -&gt; AnyCardanoEra
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.AnyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoEra era -&gt; AnyCardanoEra)
-&gt; CardanoEra era -&gt; AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IsCardanoEra era =&gt; CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.cardanoEra</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464786"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1849"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682462738"><span class="annot"><span class="annottext">[TxOut]
$sel:outputs:Tx :: Tx -&gt; [TxOut]
outputs :: [TxOut]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aoutputs%3ATx"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Certificate]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; SealedTx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; tx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AdecodeTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">decodeTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462741"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462742"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1850"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462738"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-1851"></span><span>
</span><span id="line-1852"></span><span>    </span><span id="local-6989586621682462862"><span class="annot"><span class="annottext">guardConflictingWithdrawalNetworks :: Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462862"><span class="hs-identifier hs-var hs-var">guardConflictingWithdrawalNetworks</span></a></span></span><span>
</span><span id="line-1853"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxBody</span></a></span><span> </span><span id="local-6989586621682462733"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462733"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1854"></span><span>        </span><span class="hs-comment">-- Use of withdrawals with different networks breaks balancing.</span><span>
</span><span id="line-1855"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1856"></span><span>        </span><span class="hs-comment">-- For instance the partial tx might contain two withdrawals with the</span><span>
</span><span id="line-1857"></span><span>        </span><span class="hs-comment">-- same key but different networks:</span><span>
</span><span id="line-1858"></span><span>        </span><span class="hs-comment">-- [ (Mainnet, pkh1, coin1)</span><span>
</span><span id="line-1859"></span><span>        </span><span class="hs-comment">-- , (Testnet, pkh1, coin2)</span><span>
</span><span id="line-1860"></span><span>        </span><span class="hs-comment">-- ]</span><span>
</span><span id="line-1861"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1862"></span><span>        </span><span class="hs-comment">-- Even though this is absurd, the node/ledger</span><span>
</span><span id="line-1863"></span><span>        </span><span class="hs-comment">-- @evaluateTransactionBalance@ will count @coin1+coin2@ towards the</span><span>
</span><span id="line-1864"></span><span>        </span><span class="hs-comment">-- total balance. Because the wallet does not consider the network tag,</span><span>
</span><span id="line-1865"></span><span>        </span><span class="hs-comment">-- it will drop one of the two, leading to a discrepancy.</span><span>
</span><span id="line-1866"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462732"><span class="annot"><span class="annottext">networkOfWdrl :: (StakeAddress, b, c) -&gt; Network
</span><a href="#local-6989586621682462732"><span class="hs-identifier hs-var hs-var">networkOfWdrl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.StakeAddress</span></a></span><span> </span><span id="local-6989586621682462730"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621682462730"><span class="hs-identifier hs-var">nw</span></a></span></span><span> </span><span class="annot"><span class="annottext">StakeCredential StandardCrypto
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621682462730"><span class="hs-identifier hs-var">nw</span></a></span><span>
</span><span id="line-1867"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462729"><span class="annot"><span class="annottext">conflictingWdrlNetworks :: Bool
</span><a href="#local-6989586621682462729"><span class="hs-identifier hs-var hs-var">conflictingWdrlNetworks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; TxWithdrawals ViewTx era
forall build era.
TxBodyContent build era -&gt; TxWithdrawals build era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">Cardano.txWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462733"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1868"></span><span>                </span><span class="annot"><span class="annottext">TxWithdrawals ViewTx era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxWithdrawalsNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1869"></span><span>                </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">WithdrawalsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682462725"><span class="annot"><span class="annottext">[(StakeAddress, Lovelace,
  BuildTxWith ViewTx (Witness WitCtxStake era))]
</span><a href="#local-6989586621682462725"><span class="hs-identifier hs-var">wdrls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Network -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span>
</span><span id="line-1870"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Network] -&gt; Set Network
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Network] -&gt; Set Network) -&gt; [Network] -&gt; Set Network
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((StakeAddress, Lovelace,
  BuildTxWith ViewTx (Witness WitCtxStake era))
 -&gt; Network)
-&gt; [(StakeAddress, Lovelace,
     BuildTxWith ViewTx (Witness WitCtxStake era))]
-&gt; [Network]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(StakeAddress, Lovelace,
 BuildTxWith ViewTx (Witness WitCtxStake era))
-&gt; Network
forall b c. (StakeAddress, b, c) -&gt; Network
</span><a href="#local-6989586621682462732"><span class="hs-identifier hs-var">networkOfWdrl</span></a></span><span> </span><span class="annot"><span class="annottext">[(StakeAddress, Lovelace,
  BuildTxWith ViewTx (Witness WitCtxStake era))]
</span><a href="#local-6989586621682462725"><span class="hs-identifier hs-var">wdrls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1871"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682462729"><span class="hs-identifier hs-var">conflictingWdrlNetworks</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ())
-&gt; ExceptT ErrBalanceTx m () -&gt; ExceptT ErrBalanceTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1872"></span><span>            </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxConflictingNetworks"><span class="hs-identifier hs-var">ErrBalanceTxConflictingNetworks</span></a></span><span>
</span><span id="line-1873"></span><span>
</span><span id="line-1874"></span><span>    </span><span id="local-6989586621682462868"><span class="annot"><span class="annottext">guardExistingCollateral :: Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462868"><span class="hs-identifier hs-var hs-var">guardExistingCollateral</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxBody</span></a></span><span> </span><span id="local-6989586621682462722"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462722"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1875"></span><span>        </span><span class="hs-comment">-- Coin selection does not support pre-defining collateral. In Sep 2021</span><span>
</span><span id="line-1876"></span><span>        </span><span class="hs-comment">-- consensus was that we /could/ allow for it with just a day's work or</span><span>
</span><span id="line-1877"></span><span>        </span><span class="hs-comment">-- so, but that the need for it was unclear enough that it was not in</span><span>
</span><span id="line-1878"></span><span>        </span><span class="hs-comment">-- any way a priority.</span><span>
</span><span id="line-1879"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; TxInsCollateral era
forall build era. TxBodyContent build era -&gt; TxInsCollateral era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">Cardano.txInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462722"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1880"></span><span>            </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxInsCollateralNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1881"></span><span>            </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span>            </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1883"></span><span>                </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxExistingCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingCollateral</span></a></span><span>
</span><span id="line-1884"></span><span>
</span><span id="line-1885"></span><span>    </span><span id="local-6989586621682462867"><span class="annot"><span class="annottext">guardExistingTotalCollateral :: Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462867"><span class="hs-identifier hs-var hs-var">guardExistingTotalCollateral</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxBody</span></a></span><span> </span><span id="local-6989586621682462717"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462717"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1886"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; TxTotalCollateral era
forall build era. TxBodyContent build era -&gt; TxTotalCollateral era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">Cardano.txTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462717"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1887"></span><span>            </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxTotalCollateralNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1888"></span><span>            </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxTotalAndReturnCollateralSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1889"></span><span>               </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxExistingTotalCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingTotalCollateral</span></a></span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span>    </span><span id="local-6989586621682462866"><span class="annot"><span class="annottext">guardExistingReturnCollateral :: Tx era -&gt; ExceptT ErrBalanceTx m ()
</span><a href="#local-6989586621682462866"><span class="hs-identifier hs-var hs-var">guardExistingReturnCollateral</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxBody</span></a></span><span> </span><span id="local-6989586621682462712"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462712"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1892"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; TxReturnCollateral CtxTx era
forall build era.
TxBodyContent build era -&gt; TxReturnCollateral CtxTx era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">Cardano.txReturnCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682462712"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1893"></span><span>            </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxReturnCollateralNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span>            </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxReturnCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxTotalAndReturnCollateralSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1895"></span><span>               </span><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ExceptT ErrBalanceTx m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxExistingReturnCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingReturnCollateral</span></a></span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span>    </span><span class="hs-comment">-- | Select assets to cover the specified balance and fee.</span><span>
</span><span id="line-1898"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1899"></span><span>    </span><span class="hs-comment">-- If the transaction contains redeemers, the function will also ensure the</span><span>
</span><span id="line-1900"></span><span>    </span><span class="hs-comment">-- selection covers the fees for the maximum allowed execution units of a</span><span>
</span><span id="line-1901"></span><span>    </span><span class="hs-comment">-- transaction. For this, and other reasons, the selection may include too</span><span>
</span><span id="line-1902"></span><span>    </span><span class="hs-comment">-- much ada.</span><span>
</span><span id="line-1903"></span><span>    </span><span class="annot"><a href="#local-6989586621682462831"><span class="hs-identifier hs-type">selectAssets'</span></a></span><span>
</span><span id="line-1904"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-1905"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1906"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#UTxOSelection"><span class="hs-identifier hs-type">UTxOSelection</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-type">WalletUTxO</span></a></span><span>
</span><span id="line-1907"></span><span>        </span><span class="hs-comment">-- ^ Describes which utxos are pre-selected, and which can be used as</span><span>
</span><span id="line-1908"></span><span>        </span><span class="hs-comment">-- inputs or collateral.</span><span>
</span><span id="line-1909"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Value</span></a></span><span> </span><span class="hs-comment">-- Balance to cover</span><span>
</span><span id="line-1910"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Lovelace</span></a></span><span> </span><span class="hs-comment">-- Current minfee (before selecting assets)</span><span>
</span><span id="line-1911"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Random.Extra.html#StdGenSeed"><span class="hs-identifier hs-type">StdGenSeed</span></a></span><span>
</span><span id="line-1912"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionError"><span class="hs-identifier hs-type">SelectionError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span>
</span><span id="line-1913"></span><span>    </span><span id="local-6989586621682462831"><span class="annot"><span class="annottext">selectAssets' :: AnyCardanoEra
-&gt; [TxOut]
-&gt; UTxOSelection WalletUTxO
-&gt; Value
-&gt; Lovelace
-&gt; StdGenSeed
-&gt; Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462831"><span class="hs-identifier hs-var hs-var">selectAssets'</span></a></span></span><span> </span><span id="local-6989586621682462707"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462707"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682462706"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462706"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span id="local-6989586621682462705"><span class="annot"><span class="annottext">UTxOSelection WalletUTxO
</span><a href="#local-6989586621682462705"><span class="hs-identifier hs-var">utxoSelection</span></a></span></span><span> </span><span id="local-6989586621682462704"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462704"><span class="hs-identifier hs-var">balance</span></a></span></span><span> </span><span id="local-6989586621682462703"><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462703"><span class="hs-identifier hs-var">fee0</span></a></span></span><span> </span><span id="local-6989586621682462702"><span class="annot"><span class="annottext">StdGenSeed
</span><a href="#local-6989586621682462702"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1914"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1915"></span><span>            </span><span id="local-6989586621682462701"><span class="annot"><span class="annottext">txPlutusScriptExecutionCost :: Coin
</span><a href="#local-6989586621682462701"><span class="hs-identifier hs-var hs-var">txPlutusScriptExecutionCost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; ProtocolParameters -&gt; [Redeemer] -&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx -&gt; ProtocolParameters -&gt; [Redeemer] -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AmaxScriptExecutionCost%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">maxScriptExecutionCost</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621682462869"><span class="hs-identifier hs-var">redeemers</span></a></span><span>
</span><span id="line-1916"></span><span>            </span><span id="local-6989586621682462699"><span class="annot"><span class="annottext">colReq :: SelectionCollateralRequirement
</span><a href="#local-6989586621682462699"><span class="hs-identifier hs-var hs-var">colReq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1917"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462701"><span class="hs-identifier hs-var">txPlutusScriptExecutionCost</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1918"></span><span>                    </span><span class="annot"><span class="annottext">SelectionCollateralRequirement
</span><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionCollateralRequired"><span class="hs-identifier hs-var">SelectionCollateralRequired</span></a></span><span>
</span><span id="line-1919"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-1920"></span><span>                    </span><span class="annot"><span class="annottext">SelectionCollateralRequirement
</span><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionCollateralNotRequired"><span class="hs-identifier hs-var">SelectionCollateralNotRequired</span></a></span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682462696"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462696"><span class="hs-identifier hs-var">positiveBundle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462695"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462695"><span class="hs-identifier hs-var">negativeBundle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; (TokenBundle, TokenBundle)
</span><a href="Cardano.Wallet.html#posAndNegFromCardanoValue"><span class="hs-identifier hs-var">posAndNegFromCardanoValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682462704"><span class="hs-identifier hs-var">balance</span></a></span><span>
</span><span id="line-1923"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span id="local-6989586621682462693"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462693"><span class="hs-identifier hs-var">positiveAda</span></a></span></span><span> </span><span id="local-6989586621682462692"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682462692"><span class="hs-identifier hs-var">positiveTokens</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462696"><span class="hs-identifier hs-var">positiveBundle</span></a></span><span>
</span><span id="line-1924"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span id="local-6989586621682462691"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462691"><span class="hs-identifier hs-var">negativeAda</span></a></span></span><span> </span><span id="local-6989586621682462690"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682462690"><span class="hs-identifier hs-var">negativeTokens</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462695"><span class="hs-identifier hs-var">negativeBundle</span></a></span><span>
</span><span id="line-1925"></span><span>
</span><span id="line-1926"></span><span>            </span><span id="local-6989586621682462689"><span class="annot"><span class="annottext">adaInOutputs :: Coin
</span><a href="#local-6989586621682462689"><span class="hs-identifier hs-var hs-var">adaInOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Coin) -&gt; [TxOut] -&gt; Coin
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; (TxOut -&gt; TokenBundle) -&gt; TxOut -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; TxOut -&gt; Const TokenBundle TxOut)
-&gt; TxOut -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; TxOut -&gt; Const TokenBundle TxOut)
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; TxOut -&gt; Const TokenBundle TxOut
</span><a href="#local-6989586621682462686"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462706"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-1927"></span><span>            </span><span id="local-6989586621682462685"><span class="annot"><span class="annottext">tokensInOutputs :: TokenMap
</span><a href="#local-6989586621682462685"><span class="hs-identifier hs-var hs-var">tokensInOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; TokenMap) -&gt; [TxOut] -&gt; TokenMap
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#%24sel%3Atokens%3ATokenBundle"><span class="hs-identifier hs-var hs-var">TokenBundle.tokens</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; TokenMap)
-&gt; (TxOut -&gt; TokenBundle) -&gt; TxOut -&gt; TokenMap
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; TxOut -&gt; Const TokenBundle TxOut)
-&gt; TxOut -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; TxOut -&gt; Const TokenBundle TxOut)
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; TxOut -&gt; Const TokenBundle TxOut
</span><a href="#local-6989586621682462683"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462706"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-1928"></span><span>            </span><span id="local-6989586621682462682"><span class="annot"><span class="annottext">tokensInInputs :: TokenMap
</span><a href="#local-6989586621682462682"><span class="hs-identifier hs-var hs-var">tokensInInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#%24sel%3Atokens%3ATokenBundle"><span class="hs-identifier hs-var hs-var">TokenBundle.tokens</span></a></span><span>
</span><span id="line-1929"></span><span>                </span><span class="annot"><span class="annottext">(TokenBundle -&gt; TokenMap) -&gt; TokenBundle -&gt; TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO -&gt; TokenBundle
forall (s :: * -&gt; *) u. IsUTxOSelection s u =&gt; s u -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#selectedBalance"><span class="hs-identifier hs-var">UTxOSelection.selectedBalance</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO
</span><a href="#local-6989586621682462705"><span class="hs-identifier hs-var">utxoSelection</span></a></span><span>
</span><span id="line-1930"></span><span>            </span><span id="local-6989586621682462680"><span class="annot"><span class="annottext">adaInInputs :: Coin
</span><a href="#local-6989586621682462680"><span class="hs-identifier hs-var hs-var">adaInInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span>
</span><span id="line-1931"></span><span>                </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; TokenBundle -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO -&gt; TokenBundle
forall (s :: * -&gt; *) u. IsUTxOSelection s u =&gt; s u -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#selectedBalance"><span class="hs-identifier hs-var">UTxOSelection.selectedBalance</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO
</span><a href="#local-6989586621682462705"><span class="hs-identifier hs-var">utxoSelection</span></a></span><span>
</span><span id="line-1932"></span><span>
</span><span id="line-1933"></span><span>            </span><span id="local-6989586621682462679"><span class="annot"><span class="annottext">boringFee :: Coin
</span><a href="#local-6989586621682462679"><span class="hs-identifier hs-var hs-var">boringFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1934"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-1935"></span><span>                    </span><span id="local-6989586621682462678"><span class="annot"><span class="annottext">boringSkeleton :: SelectionSkeleton
</span><a href="#local-6989586621682462678"><span class="hs-identifier hs-var hs-var">boringSkeleton</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionSkeleton :: Int -&gt; [TxOut] -&gt; [Set AssetId] -&gt; SelectionSkeleton
</span><a href="Cardano.Wallet.CoinSelection.html#SelectionSkeleton"><span class="hs-identifier hs-type">SelectionSkeleton</span></a></span><span>
</span><span id="line-1936"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:skeletonInputCount:SelectionSkeleton :: Int
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AskeletonInputCount%3ASelectionSkeleton"><span class="hs-identifier hs-var">skeletonInputCount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1937"></span><span>                            </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO -&gt; Int
forall (s :: * -&gt; *) u. IsUTxOSelection s u =&gt; s u -&gt; Int
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#selectedSize"><span class="hs-identifier hs-var">UTxOSelection.selectedSize</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO
</span><a href="#local-6989586621682462705"><span class="hs-identifier hs-var">utxoSelection</span></a></span><span>
</span><span id="line-1938"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:skeletonOutputs:SelectionSkeleton :: [TxOut]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AskeletonOutputs%3ASelectionSkeleton"><span class="hs-identifier hs-var">skeletonOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462706"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-1939"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:skeletonChange:SelectionSkeleton :: [Set AssetId]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AskeletonChange%3ASelectionSkeleton"><span class="hs-identifier hs-var">skeletonChange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1940"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-1941"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AcalcMinimumCost%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">calcMinimumCost</span></a></span><span>
</span><span id="line-1942"></span><span>                        </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span>
</span><span id="line-1943"></span><span>                        </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462707"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-1944"></span><span>                        </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1945"></span><span>                        </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-1946"></span><span>                        </span><span class="annot"><span class="annottext">SelectionSkeleton
</span><a href="#local-6989586621682462678"><span class="hs-identifier hs-var">boringSkeleton</span></a></span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span>            </span><span id="local-6989586621682462672"><span class="annot"><span class="annottext">feePadding :: Coin
</span><a href="#local-6989586621682462672"><span class="hs-identifier hs-var hs-var">feePadding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1949"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#LinearFee"><span class="hs-identifier hs-type">LinearFee</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#LinearFunction"><span class="hs-identifier hs-type">LinearFunction</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:slope:LinearFunction :: forall a. LinearFunction a -&gt; a
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Aslope%3ALinearFunction"><span class="hs-identifier hs-var">slope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682462670"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682462670"><span class="hs-identifier hs-var">perByte</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1950"></span><span>                        </span><span class="annot"><span class="annottext">((FeePolicy -&gt; Const FeePolicy FeePolicy)
 -&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters)
-&gt; ProtocolParameters -&gt; FeePolicy
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txParameters&quot;
  ((TxParameters -&gt; Const FeePolicy TxParameters)
   -&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters)
(TxParameters -&gt; Const FeePolicy TxParameters)
-&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters
</span><a href="#local-6989586621682462669"><span class="hs-var">#txParameters</span></a></span><span> </span><span class="annot"><span class="annottext">((TxParameters -&gt; Const FeePolicy TxParameters)
 -&gt; ProtocolParameters -&gt; Const FeePolicy ProtocolParameters)
-&gt; ((FeePolicy -&gt; Const FeePolicy FeePolicy)
    -&gt; TxParameters -&gt; Const FeePolicy TxParameters)
-&gt; (FeePolicy -&gt; Const FeePolicy FeePolicy)
-&gt; ProtocolParameters
-&gt; Const FeePolicy ProtocolParameters
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getFeePolicy&quot;
  ((FeePolicy -&gt; Const FeePolicy FeePolicy)
   -&gt; TxParameters -&gt; Const FeePolicy TxParameters)
(FeePolicy -&gt; Const FeePolicy FeePolicy)
-&gt; TxParameters -&gt; Const FeePolicy TxParameters
</span><a href="#local-6989586621682462668"><span class="hs-var">#getFeePolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1951"></span><span>                    </span><span id="local-6989586621682462667"><span class="annot"><span class="annottext">scriptIntegrityHashBytes :: Natural
</span><a href="#local-6989586621682462667"><span class="hs-identifier hs-var hs-var">scriptIntegrityHashBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1952"></span><span>
</span><span id="line-1953"></span><span>                    </span><span class="hs-comment">-- Add padding to allow the fee value to increase.</span><span>
</span><span id="line-1954"></span><span>                    </span><span class="hs-comment">-- Out of caution, assume it can increase by the theoretical</span><span>
</span><span id="line-1955"></span><span>                    </span><span class="hs-comment">-- maximum of 8 bytes ('maximumCostOfIncreasingCoin').</span><span>
</span><span id="line-1956"></span><span>                    </span><span class="hs-comment">--</span><span>
</span><span id="line-1957"></span><span>                    </span><span class="hs-comment">-- NOTE: It's not convenient to import the constant at the</span><span>
</span><span id="line-1958"></span><span>                    </span><span class="hs-comment">-- moment because of the package split.</span><span>
</span><span id="line-1959"></span><span>                    </span><span class="hs-comment">--</span><span>
</span><span id="line-1960"></span><span>                    </span><span class="hs-comment">-- Any overestimation will be reduced by 'distributeSurplus'</span><span>
</span><span id="line-1961"></span><span>                    </span><span class="hs-comment">-- in the final stage of 'balanceTransaction'.</span><span>
</span><span id="line-1962"></span><span>                    </span><span id="local-6989586621682462665"><span class="annot"><span class="annottext">extraBytes :: Natural
</span><a href="#local-6989586621682462665"><span class="hs-identifier hs-var hs-var">extraBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">8</span></span><span>
</span><span id="line-1963"></span><span>                </span><span class="hs-keyword">in</span><span>
</span><span id="line-1964"></span><span>                </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Coin) -&gt; Natural -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Natural
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">round</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682462670"><span class="hs-identifier hs-var">perByte</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682462665"><span class="hs-identifier hs-var">extraBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682462667"><span class="hs-identifier hs-var">scriptIntegrityHashBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1965"></span><span>
</span><span id="line-1966"></span><span>            </span><span id="local-6989586621682462663"><span class="annot"><span class="annottext">fromCardanoLovelace :: Lovelace -&gt; Coin
</span><a href="#local-6989586621682462663"><span class="hs-identifier hs-var hs-var">fromCardanoLovelace</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Lovelace</span></a></span><span> </span><span id="local-6989586621682462662"><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462662"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; Coin
forall i. (HasCallStack, Bits i, Integral i, Show i) =&gt; i -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unsafeFromIntegral"><span class="hs-identifier hs-var">Coin.unsafeFromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682462662"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1967"></span><span>
</span><span id="line-1968"></span><span>            </span><span id="local-6989586621682462661"><span class="annot"><span class="annottext">selectionConstraints :: SelectionConstraints
</span><a href="#local-6989586621682462661"><span class="hs-identifier hs-var hs-var">selectionConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionConstraints :: (TokenBundle -&gt; TokenBundleSizeAssessment)
-&gt; Coin
-&gt; (Address -&gt; TokenMap -&gt; Coin)
-&gt; (Address -&gt; TokenBundle -&gt; Bool)
-&gt; (SelectionSkeleton -&gt; Coin)
-&gt; ([TxOut] -&gt; SelectionLimit)
-&gt; Int
-&gt; Natural
-&gt; Address
-&gt; SelectionConstraints
</span><a href="Cardano.Wallet.CoinSelection.html#SelectionConstraints"><span class="hs-identifier hs-type">SelectionConstraints</span></a></span><span>
</span><span id="line-1969"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assessTokenBundleSize:SelectionConstraints :: TokenBundle -&gt; TokenBundleSizeAssessment
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassessTokenBundleSize%3ASelectionConstraints"><span class="hs-identifier hs-var">assessTokenBundleSize</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1970"></span><span>                    </span><span class="annot"><span class="annottext">(((TokenBundle -&gt; TokenBundleSizeAssessment)
  -&gt; Const
       (TokenBundle -&gt; TokenBundleSizeAssessment)
       (TokenBundle -&gt; TokenBundleSizeAssessment))
 -&gt; TokenBundleSizeAssessor
 -&gt; Const
      (TokenBundle -&gt; TokenBundleSizeAssessment) TokenBundleSizeAssessor)
-&gt; TokenBundleSizeAssessor
-&gt; TokenBundle
-&gt; TokenBundleSizeAssessment
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assessTokenBundleSize&quot;
  (((TokenBundle -&gt; TokenBundleSizeAssessment)
    -&gt; Const
         (TokenBundle -&gt; TokenBundleSizeAssessment)
         (TokenBundle -&gt; TokenBundleSizeAssessment))
   -&gt; TokenBundleSizeAssessor
   -&gt; Const
        (TokenBundle -&gt; TokenBundleSizeAssessment) TokenBundleSizeAssessor)
((TokenBundle -&gt; TokenBundleSizeAssessment)
 -&gt; Const
      (TokenBundle -&gt; TokenBundleSizeAssessment)
      (TokenBundle -&gt; TokenBundleSizeAssessment))
-&gt; TokenBundleSizeAssessor
-&gt; Const
     (TokenBundle -&gt; TokenBundleSizeAssessment) TokenBundleSizeAssessor
</span><a href="#local-6989586621682462658"><span class="hs-var">#assessTokenBundleSize</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundleSizeAssessor
 -&gt; TokenBundle -&gt; TokenBundleSizeAssessment)
-&gt; TokenBundleSizeAssessor
-&gt; TokenBundle
-&gt; TokenBundleSizeAssessment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1971"></span><span>                    </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; TokenBundleMaxSize -&gt; TokenBundleSizeAssessor
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; TokenBundleMaxSize -&gt; TokenBundleSizeAssessor
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtokenBundleSizeAssessor%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">tokenBundleSizeAssessor</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundleMaxSize -&gt; TokenBundleSizeAssessor)
-&gt; TokenBundleMaxSize -&gt; TokenBundleSizeAssessor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1972"></span><span>                    </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
-&gt; ((TokenBundleMaxSize
     -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
    -&gt; ProtocolParameters
    -&gt; Const TokenBundleMaxSize ProtocolParameters)
-&gt; TokenBundleMaxSize
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txParameters&quot;
  ((TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
   -&gt; ProtocolParameters
   -&gt; Const TokenBundleMaxSize ProtocolParameters)
(TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
-&gt; ProtocolParameters
-&gt; Const TokenBundleMaxSize ProtocolParameters
</span><a href="#local-6989586621682462656"><span class="hs-var">#txParameters</span></a></span><span> </span><span class="annot"><span class="annottext">((TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
 -&gt; ProtocolParameters
 -&gt; Const TokenBundleMaxSize ProtocolParameters)
-&gt; ((TokenBundleMaxSize
     -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
    -&gt; TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
-&gt; (TokenBundleMaxSize
    -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
-&gt; ProtocolParameters
-&gt; Const TokenBundleMaxSize ProtocolParameters
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getTokenBundleMaxSize&quot;
  ((TokenBundleMaxSize
    -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
   -&gt; TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
(TokenBundleMaxSize -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
-&gt; TxParameters -&gt; Const TokenBundleMaxSize TxParameters
</span><a href="#local-6989586621682462655"><span class="hs-var">#getTokenBundleMaxSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1973"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificateDepositAmount:SelectionConstraints :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcertificateDepositAmount%3ASelectionConstraints"><span class="hs-identifier hs-var">certificateDepositAmount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1974"></span><span>                    </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; ProtocolParameters -&gt; Const Coin ProtocolParameters)
-&gt; ProtocolParameters -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;stakeKeyDeposit&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; ProtocolParameters -&gt; Const Coin ProtocolParameters)
(Coin -&gt; Const Coin Coin)
-&gt; ProtocolParameters -&gt; Const Coin ProtocolParameters
</span><a href="#local-6989586621682462653"><span class="hs-var">#stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1975"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computeMinimumAdaQuantity:SelectionConstraints :: Address -&gt; TokenMap -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcomputeMinimumAdaQuantity%3ASelectionConstraints"><span class="hs-identifier hs-var">computeMinimumAdaQuantity</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1976"></span><span>                    </span><span class="annot"><span class="annottext">(((Address -&gt; TokenMap -&gt; Coin)
  -&gt; Const
       (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
 -&gt; TxConstraints
 -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
-&gt; TxConstraints -&gt; Address -&gt; TokenMap -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputMinimumAdaQuantity&quot;
  (((Address -&gt; TokenMap -&gt; Coin)
    -&gt; Const
         (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
   -&gt; TxConstraints
   -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
((Address -&gt; TokenMap -&gt; Coin)
 -&gt; Const
      (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
-&gt; TxConstraints
-&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints
</span><a href="#local-6989586621682462651"><span class="hs-var">#txOutputMinimumAdaQuantity</span></a></span><span>
</span><span id="line-1977"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462707"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1978"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:isBelowMinimumAdaQuantity:SelectionConstraints :: Address -&gt; TokenBundle -&gt; Bool
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AisBelowMinimumAdaQuantity%3ASelectionConstraints"><span class="hs-identifier hs-var">isBelowMinimumAdaQuantity</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1979"></span><span>                    </span><span class="annot"><span class="annottext">(((Address -&gt; TokenBundle -&gt; Bool)
  -&gt; Const
       (Address -&gt; TokenBundle -&gt; Bool) (Address -&gt; TokenBundle -&gt; Bool))
 -&gt; TxConstraints
 -&gt; Const (Address -&gt; TokenBundle -&gt; Bool) TxConstraints)
-&gt; TxConstraints -&gt; Address -&gt; TokenBundle -&gt; Bool
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputBelowMinimumAdaQuantity&quot;
  (((Address -&gt; TokenBundle -&gt; Bool)
    -&gt; Const
         (Address -&gt; TokenBundle -&gt; Bool) (Address -&gt; TokenBundle -&gt; Bool))
   -&gt; TxConstraints
   -&gt; Const (Address -&gt; TokenBundle -&gt; Bool) TxConstraints)
((Address -&gt; TokenBundle -&gt; Bool)
 -&gt; Const
      (Address -&gt; TokenBundle -&gt; Bool) (Address -&gt; TokenBundle -&gt; Bool))
-&gt; TxConstraints
-&gt; Const (Address -&gt; TokenBundle -&gt; Bool) TxConstraints
</span><a href="#local-6989586621682462649"><span class="hs-var">#txOutputBelowMinimumAdaQuantity</span></a></span><span>
</span><span id="line-1980"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462707"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1981"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computeMinimumCost:SelectionConstraints :: SelectionSkeleton -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcomputeMinimumCost%3ASelectionConstraints"><span class="hs-identifier hs-var">computeMinimumCost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682462647"><span class="annot"><span class="annottext">SelectionSkeleton
</span><a href="#local-6989586621682462647"><span class="hs-identifier hs-var">skeleton</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-1982"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462672"><span class="hs-identifier hs-var">feePadding</span></a></span><span>
</span><span id="line-1983"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Coin
</span><a href="#local-6989586621682462663"><span class="hs-identifier hs-var">fromCardanoLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462703"><span class="hs-identifier hs-var">fee0</span></a></span><span>
</span><span id="line-1984"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AcalcMinimumCost%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">calcMinimumCost</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462795"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462707"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1985"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-1986"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txPlutusScriptExecutionCost:TransactionCtx :: Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxPlutusScriptExecutionCost%3ATransactionCtx"><span class="hs-identifier hs-var">txPlutusScriptExecutionCost</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1987"></span><span>                                </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462701"><span class="hs-identifier hs-var">txPlutusScriptExecutionCost</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1988"></span><span>                        </span><span class="annot"><span class="annottext">SelectionSkeleton
</span><a href="#local-6989586621682462647"><span class="hs-identifier hs-var">skeleton</span></a></span><span>
</span><span id="line-1989"></span><span>                    </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#difference"><span class="hs-operator hs-var">`Coin.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462679"><span class="hs-identifier hs-var">boringFee</span></a></span><span>
</span><span id="line-1990"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computeSelectionLimit:SelectionConstraints :: [TxOut] -&gt; SelectionLimit
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcomputeSelectionLimit%3ASelectionConstraints"><span class="hs-identifier hs-var">computeSelectionLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[TxOut]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SelectionLimit
forall a. SelectionLimitOf a
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span><span>
</span><span id="line-1991"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:maximumCollateralInputCount:SelectionConstraints :: Int
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AmaximumCollateralInputCount%3ASelectionConstraints"><span class="hs-identifier hs-var">maximumCollateralInputCount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1992"></span><span>                    </span><span class="annot"><span class="annottext">(Integral Word16, Integral Int, IsIntSubType Word16 Int ~ 'True) =&gt;
Word16 -&gt; Int
forall a b.
(Integral a, Integral b, IsIntSubType a b ~ 'True) =&gt;
a -&gt; b
</span><a href="../../../../int-cast/html/src"><span class="hs-identifier hs-var">intCast</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; Word16 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Word16 -&gt; Const Word16 Word16)
 -&gt; ProtocolParameters -&gt; Const Word16 ProtocolParameters)
-&gt; ProtocolParameters -&gt; Word16
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;maximumCollateralInputCount&quot;
  ((Word16 -&gt; Const Word16 Word16)
   -&gt; ProtocolParameters -&gt; Const Word16 ProtocolParameters)
(Word16 -&gt; Const Word16 Word16)
-&gt; ProtocolParameters -&gt; Const Word16 ProtocolParameters
</span><a href="#local-6989586621682462642"><span class="hs-var">#maximumCollateralInputCount</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1993"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:minimumCollateralPercentage:SelectionConstraints :: Natural
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AminimumCollateralPercentage%3ASelectionConstraints"><span class="hs-identifier hs-var">minimumCollateralPercentage</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1994"></span><span>                    </span><span class="annot"><span class="annottext">((Natural -&gt; Const Natural Natural)
 -&gt; ProtocolParameters -&gt; Const Natural ProtocolParameters)
-&gt; ProtocolParameters -&gt; Natural
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;minimumCollateralPercentage&quot;
  ((Natural -&gt; Const Natural Natural)
   -&gt; ProtocolParameters -&gt; Const Natural ProtocolParameters)
(Natural -&gt; Const Natural Natural)
-&gt; ProtocolParameters -&gt; Const Natural ProtocolParameters
</span><a href="#local-6989586621682462640"><span class="hs-var">#minimumCollateralPercentage</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462879"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1995"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:maximumLengthChangeAddress:SelectionConstraints :: Address
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AmaximumLengthChangeAddress%3ASelectionConstraints"><span class="hs-identifier hs-var">maximumLengthChangeAddress</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1996"></span><span>                    </span><span class="annot"><span class="annottext">Proxy k -&gt; Address
forall k (key :: k).
BoundedAddressLength key =&gt;
Proxy key -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#maxLengthAddressFor"><span class="hs-identifier hs-var">maxLengthAddressFor</span></a></span><span> </span><span class="annot"><span class="annottext">(Proxy k -&gt; Address) -&gt; Proxy k -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682464793"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1997"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1998"></span><span>
</span><span id="line-1999"></span><span>            </span><span id="local-6989586621682462636"><span class="annot"><span class="annottext">selectionParams :: SelectionParams
</span><a href="#local-6989586621682462636"><span class="hs-identifier hs-var hs-var">selectionParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionParams :: TokenMap
-&gt; TokenMap
-&gt; Coin
-&gt; Coin
-&gt; [TxOut]
-&gt; Coin
-&gt; Natural
-&gt; Natural
-&gt; SelectionCollateralRequirement
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; SelectionStrategy
-&gt; SelectionParams
</span><a href="Cardano.Wallet.CoinSelection.html#SelectionParams"><span class="hs-identifier hs-type">SelectionParams</span></a></span><span>
</span><span id="line-2000"></span><span>                </span><span class="hs-comment">-- The following fields are essensially adjusting the coin</span><span>
</span><span id="line-2001"></span><span>                </span><span class="hs-comment">-- selections notion of balance by @balance0 - sum inputs + sum</span><span>
</span><span id="line-2002"></span><span>                </span><span class="hs-comment">-- outputs + fee0@ where @balance0@ is the balance of the</span><span>
</span><span id="line-2003"></span><span>                </span><span class="hs-comment">-- partial tx.</span><span>
</span><span id="line-2004"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assetsToMint:SelectionParams :: TokenMap
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassetsToMint%3ASelectionParams"><span class="hs-identifier hs-var">assetsToMint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682462692"><span class="hs-identifier hs-var">positiveTokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; TokenMap
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682462685"><span class="hs-identifier hs-var">tokensInOutputs</span></a></span><span>
</span><span id="line-2005"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assetsToBurn:SelectionParams :: TokenMap
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassetsToBurn%3ASelectionParams"><span class="hs-identifier hs-var">assetsToBurn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682462690"><span class="hs-identifier hs-var">negativeTokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; TokenMap
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682462682"><span class="hs-identifier hs-var">tokensInInputs</span></a></span><span>
</span><span id="line-2006"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:extraCoinIn:SelectionParams :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AextraCoinIn%3ASelectionParams"><span class="hs-identifier hs-var">extraCoinIn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2007"></span><span>                    </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462693"><span class="hs-identifier hs-var">positiveAda</span></a></span><span>
</span><span id="line-2008"></span><span>                    </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462689"><span class="hs-identifier hs-var">adaInOutputs</span></a></span><span>
</span><span id="line-2009"></span><span>                    </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Coin
</span><a href="#local-6989586621682462663"><span class="hs-identifier hs-var">fromCardanoLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621682462703"><span class="hs-identifier hs-var">fee0</span></a></span><span>
</span><span id="line-2010"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:extraCoinOut:SelectionParams :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AextraCoinOut%3ASelectionParams"><span class="hs-identifier hs-var">extraCoinOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462691"><span class="hs-identifier hs-var">negativeAda</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462680"><span class="hs-identifier hs-var">adaInInputs</span></a></span><span>
</span><span id="line-2011"></span><span>
</span><span id="line-2012"></span><span>                </span><span class="hs-comment">-- We don't use the following 3 fields because certs and</span><span>
</span><span id="line-2013"></span><span>                </span><span class="hs-comment">-- withdrawals are already included in the balance (passed in</span><span>
</span><span id="line-2014"></span><span>                </span><span class="hs-comment">-- above).</span><span>
</span><span id="line-2015"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:rewardWithdrawal:SelectionParams :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3ArewardWithdrawal%3ASelectionParams"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2016"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificateDepositsReturned:SelectionParams :: Natural
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcertificateDepositsReturned%3ASelectionParams"><span class="hs-identifier hs-var">certificateDepositsReturned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2017"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificateDepositsTaken:SelectionParams :: Natural
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcertificateDepositsTaken%3ASelectionParams"><span class="hs-identifier hs-var">certificateDepositsTaken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span>                </span><span class="hs-comment">-- NOTE: It is important that coin selection has the correct</span><span>
</span><span id="line-2020"></span><span>                </span><span class="hs-comment">-- notion of fees, because it will be used to tell how much</span><span>
</span><span id="line-2021"></span><span>                </span><span class="hs-comment">-- collateral is needed.</span><span>
</span><span id="line-2022"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralRequirement:SelectionParams :: SelectionCollateralRequirement
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcollateralRequirement%3ASelectionParams"><span class="hs-identifier hs-var">collateralRequirement</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionCollateralRequirement
</span><a href="#local-6989586621682462699"><span class="hs-identifier hs-var">colReq</span></a></span><span>
</span><span id="line-2023"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outputsToCover:SelectionParams :: [TxOut]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AoutputsToCover%3ASelectionParams"><span class="hs-identifier hs-var">outputsToCover</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462706"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2024"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectionParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AutxoAvailableForCollateral%3ASelectionParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2025"></span><span>                      </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall (s :: * -&gt; *) u.
(IsUTxOSelection s u, Ord u) =&gt;
s u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#availableMap"><span class="hs-identifier hs-var">UTxOSelection.availableMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO
</span><a href="#local-6989586621682462705"><span class="hs-identifier hs-var">utxoSelection</span></a></span><span>
</span><span id="line-2026"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectionParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AutxoAvailableForInputs%3ASelectionParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO
</span><a href="#local-6989586621682462705"><span class="hs-identifier hs-var">utxoSelection</span></a></span><span>
</span><span id="line-2027"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectionParams :: SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AselectionStrategy%3ASelectionParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="#local-6989586621682462873"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span>
</span><span id="line-2028"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-2029"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-2030"></span><span>                </span><span class="annot"><span class="annottext">(Rand
   StdGen (Either (SelectionError WalletSelectionContext) Selection)
 -&gt; StdGen
 -&gt; Either (SelectionError WalletSelectionContext) Selection)
-&gt; StdGen
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
-&gt; Either (SelectionError WalletSelectionContext) Selection
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Rand
  StdGen (Either (SelectionError WalletSelectionContext) Selection)
-&gt; StdGen
-&gt; Either (SelectionError WalletSelectionContext) Selection
forall g a. Rand g a -&gt; g -&gt; a
</span><a href="../../../../MonadRandom/html/src"><span class="hs-identifier hs-var">evalRand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StdGenSeed -&gt; StdGen
</span><a href="Control.Monad.Random.Extra.html#stdGenFromSeed"><span class="hs-identifier hs-var">stdGenFromSeed</span></a></span><span> </span><span class="annot"><span class="annottext">StdGenSeed
</span><a href="#local-6989586621682462702"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2031"></span><span>                    </span><span class="annot"><span class="annottext">(Rand
   StdGen (Either (SelectionError WalletSelectionContext) Selection)
 -&gt; Either (SelectionError WalletSelectionContext) Selection)
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
-&gt; Either (SelectionError WalletSelectionContext) Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT
  (SelectionError WalletSelectionContext)
  (RandT StdGen Identity)
  Selection
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span>
</span><span id="line-2032"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT
   (SelectionError WalletSelectionContext)
   (RandT StdGen Identity)
   Selection
 -&gt; Rand
      StdGen (Either (SelectionError WalletSelectionContext) Selection))
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     (RandT StdGen Identity)
     Selection
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionConstraints
-&gt; SelectionParams
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     (RandT StdGen Identity)
     Selection
forall (m :: * -&gt; *).
(HasCallStack, MonadRandom m) =&gt;
SelectionConstraints
-&gt; SelectionParams
-&gt; ExceptT (SelectionError WalletSelectionContext) m Selection
</span><a href="Cardano.Wallet.CoinSelection.html#performSelection"><span class="hs-identifier hs-var">performSelection</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionConstraints
</span><a href="#local-6989586621682462661"><span class="hs-identifier hs-var">selectionConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionParams
</span><a href="#local-6989586621682462636"><span class="hs-identifier hs-var">selectionParams</span></a></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span class="hs-comment">-- | Augments the given outputs with new outputs. These new outputs correspond</span><span>
</span><span id="line-2035"></span><span class="hs-comment">-- to change outputs to which new addresses have been assigned. This updates</span><span>
</span><span id="line-2036"></span><span class="hs-comment">-- the wallet state as it needs to keep track of new pending change addresses.</span><span>
</span><span id="line-2037"></span><span class="annot"><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-type">assignChangeAddresses</span></a></span><span>
</span><span id="line-2038"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682464758"><span class="annot"><a href="#local-6989586621682464758"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464758"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2039"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464758"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2040"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span>
</span><span id="line-2041"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464758"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2042"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682464758"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2043"></span><span id="assignChangeAddresses"><span class="annot"><span class="annottext">assignChangeAddresses :: ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var hs-var">assignChangeAddresses</span></a></span></span><span> </span><span id="local-6989586621682462621"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462621"><span class="hs-identifier hs-var">argGenChange</span></a></span></span><span> </span><span id="local-6989586621682462620"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462620"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State s (SelectionOf TxOut) -&gt; s -&gt; (SelectionOf TxOut, s)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runState</span></a></span><span> </span><span class="annot"><span class="annottext">(State s (SelectionOf TxOut) -&gt; s -&gt; (SelectionOf TxOut, s))
-&gt; State s (SelectionOf TxOut) -&gt; s -&gt; (SelectionOf TxOut, s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2044"></span><span>    </span><span id="local-6989586621682462619"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462619"><span class="hs-identifier hs-var">changeOuts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TokenBundle]
-&gt; (TokenBundle -&gt; StateT s Identity TxOut)
-&gt; StateT s Identity [TxOut]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([TokenBundle] -&gt; Const [TokenBundle] [TokenBundle])
 -&gt; Selection -&gt; Const [TokenBundle] Selection)
-&gt; Selection -&gt; [TokenBundle]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([TokenBundle] -&gt; Const [TokenBundle] [TokenBundle])
   -&gt; Selection -&gt; Const [TokenBundle] Selection)
([TokenBundle] -&gt; Const [TokenBundle] [TokenBundle])
-&gt; Selection -&gt; Const [TokenBundle] Selection
</span><a href="#local-6989586621682462618"><span class="hs-var">#change</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462620"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; StateT s Identity TxOut)
 -&gt; StateT s Identity [TxOut])
-&gt; (TokenBundle -&gt; StateT s Identity TxOut)
-&gt; StateT s Identity [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682462617"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462617"><span class="hs-identifier hs-var">bundle</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2045"></span><span>        </span><span id="local-6989586621682462616"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462616"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(s -&gt; (Address, s)) -&gt; StateT s Identity Address
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; (a, s)) -&gt; StateT s m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgGenChange s -&gt; s -&gt; (Address, s)
forall s. GenChange s =&gt; ArgGenChange s -&gt; s -&gt; (Address, s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#genChange"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462621"><span class="hs-identifier hs-var">argGenChange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2046"></span><span>        </span><span class="annot"><span class="annottext">TxOut -&gt; StateT s Identity TxOut
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; StateT s Identity TxOut)
-&gt; TxOut -&gt; StateT s Identity TxOut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462616"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462617"><span class="hs-identifier hs-var">bundle</span></a></span><span>
</span><span id="line-2047"></span><span>    </span><span class="annot"><span class="annottext">SelectionOf TxOut -&gt; State s (SelectionOf TxOut)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionOf TxOut -&gt; State s (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; State s (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462620"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:change:Selection :: [TxOut]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3Achange%3ASelection"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462619"><span class="hs-identifier hs-var">changeOuts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2048"></span><span>
</span><span id="line-2049"></span><span class="annot"><a href="Cardano.Wallet.html#assignChangeAddressesAndUpdateDb"><span class="hs-identifier hs-type">assignChangeAddressesAndUpdateDb</span></a></span><span>
</span><span id="line-2050"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462613"><span class="annot"><a href="#local-6989586621682462613"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462612"><span class="annot"><a href="#local-6989586621682462612"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462611"><span class="annot"><a href="#local-6989586621682462611"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2051"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462612"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2052"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462612"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462611"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462613"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2053"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462612"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2054"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2055"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462613"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2056"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2057"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462612"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2058"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span>
</span><span id="line-2059"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPayment"><span class="hs-identifier hs-type">ErrSignPayment</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2060"></span><span id="assignChangeAddressesAndUpdateDb"><span class="annot"><span class="annottext">assignChangeAddressesAndUpdateDb :: ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesAndUpdateDb"><span class="hs-identifier hs-var hs-var">assignChangeAddressesAndUpdateDb</span></a></span></span><span> </span><span id="local-6989586621682462610"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462610"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462609"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462609"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462608"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462608"><span class="hs-identifier hs-var">generateChange</span></a></span></span><span> </span><span id="local-6989586621682462607"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462607"><span class="hs-identifier hs-var">selection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2061"></span><span>    </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462606"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut))
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462580"><span id="local-6989586621682462581"><span id="local-6989586621682462582"><span id="local-6989586621682462583"><span id="local-6989586621682462584"><span id="local-6989586621682462585"><span id="local-6989586621682462586"><span id="local-6989586621682462587"><span id="local-6989586621682462588"><span id="local-6989586621682462589"><span id="local-6989586621682462590"><span id="local-6989586621682462591"><span id="local-6989586621682462592"><span id="local-6989586621682462593"><span id="local-6989586621682462594"><span id="local-6989586621682462595"><span id="local-6989586621682462596"><span id="local-6989586621682462597"><span id="local-6989586621682462598"><span id="local-6989586621682462599"><span id="local-6989586621682462600"><span id="local-6989586621682462601"><span id="local-6989586621682462602"><span id="local-6989586621682462603"><span id="local-6989586621682462604"><span id="local-6989586621682462605"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462580"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either ErrSignPayment (SelectionOf TxOut))
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrSignPayment (SelectionOf TxOut))
 -&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut))
-&gt; IO (Either ErrSignPayment (SelectionOf TxOut))
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrSignPayment (SelectionOf TxOut))
-&gt; IO (Either ErrSignPayment (SelectionOf TxOut))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462580"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrSignPayment (SelectionOf TxOut))
 -&gt; IO (Either ErrSignPayment (SelectionOf TxOut)))
-&gt; stm (Either ErrSignPayment (SelectionOf TxOut))
-&gt; IO (Either ErrSignPayment (SelectionOf TxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrSignPayment (SelectionOf TxOut)))
-&gt; stm (Either ErrSignPayment (SelectionOf TxOut))
forall da (m :: * -&gt; *) a b.
(Delta da, Monad m, a ~ Base da) =&gt;
DBVar m da -&gt; (a -&gt; (Maybe da, b)) -&gt; m b
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">modifyDBMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
</span><a href="#local-6989586621682462602"><span class="hs-identifier hs-var">walletsDB</span></a></span><span> </span><span class="annot"><span class="annottext">((Map WalletId (WalletState s)
  -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
      Either ErrSignPayment (SelectionOf TxOut)))
 -&gt; stm (Either ErrSignPayment (SelectionOf TxOut)))
-&gt; (Map WalletId (WalletState s)
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrSignPayment (SelectionOf TxOut)))
-&gt; stm (Either ErrSignPayment (SelectionOf TxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2062"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; (ErrNoSuchWallet -&gt; ErrSignPayment)
-&gt; (WalletState s
    -&gt; Either ErrSignPayment (DeltaWalletState s, SelectionOf TxOut))
-&gt; Map WalletId (WalletState s)
-&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
    Either ErrSignPayment (SelectionOf TxOut))
forall e w dw b.
WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var">adjustNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462609"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSignPayment
</span><a href="Cardano.Wallet.html#ErrSignPaymentNoSuchWallet"><span class="hs-identifier hs-var">ErrSignPaymentNoSuchWallet</span></a></span><span>
</span><span id="line-2063"></span><span>            </span><span class="annot"><span class="annottext">WalletState s
-&gt; Either ErrSignPayment (DeltaWalletState s, SelectionOf TxOut)
</span><a href="#local-6989586621682462578"><span class="hs-identifier hs-var">assignChangeAddressesAndUpdateDb'</span></a></span><span>
</span><span id="line-2064"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2065"></span><span>    </span><span id="local-6989586621682462606"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462606"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462610"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462612"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462611"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2066"></span><span>    </span><span id="local-6989586621682462578"><span class="annot"><span class="annottext">assignChangeAddressesAndUpdateDb' :: WalletState s
-&gt; Either ErrSignPayment (DeltaWalletState s, SelectionOf TxOut)
</span><a href="#local-6989586621682462578"><span class="hs-identifier hs-var hs-var">assignChangeAddressesAndUpdateDb'</span></a></span></span><span> </span><span id="local-6989586621682462577"><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682462577"><span class="hs-identifier hs-var">wallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DeltaWalletState s, SelectionOf TxOut)
-&gt; Either ErrSignPayment (DeltaWalletState s, SelectionOf TxOut)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span>
</span><span id="line-2067"></span><span>        </span><span class="hs-comment">-- Newly generated change addresses only change the Prologue</span><span>
</span><span id="line-2068"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Prologue s -&gt; DeltaWalletState1 s
forall s. Prologue s -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(Prologue s -&gt; DeltaWalletState1 s)
-&gt; Prologue s -&gt; DeltaWalletState1 s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Prologue s
forall s. AddressBookIso s =&gt; s -&gt; Prologue s
</span><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier hs-var">getPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462576"><span class="hs-identifier hs-var">stateUpdated</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462575"><span class="hs-identifier hs-var">selectionUpdated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2069"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2070"></span><span>        </span><span id="local-6989586621682462574"><span class="annot"><span class="annottext">s :: s
</span><a href="#local-6989586621682462574"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; s) -&gt; Wallet s -&gt; s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s -&gt; Wallet s
forall s. AddressBookIso s =&gt; WalletState s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier hs-var">getLatest</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682462577"><span class="hs-identifier hs-var">wallet</span></a></span><span>
</span><span id="line-2071"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682462575"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462575"><span class="hs-identifier hs-var">selectionUpdated</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462576"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462576"><span class="hs-identifier hs-var">stateUpdated</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2072"></span><span>            </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">assignChangeAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462608"><span class="hs-identifier hs-var">generateChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462607"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462574"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2073"></span><span>
</span><span id="line-2074"></span><span class="annot"><a href="Cardano.Wallet.html#assignChangeAddressesWithoutDbUpdate"><span class="hs-identifier hs-type">assignChangeAddressesWithoutDbUpdate</span></a></span><span>
</span><span id="line-2075"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462573"><span class="annot"><a href="#local-6989586621682462573"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462572"><span class="annot"><a href="#local-6989586621682462572"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462571"><span class="annot"><a href="#local-6989586621682462571"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2076"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462572"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2077"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462572"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462571"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462573"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2078"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2079"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462573"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2080"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2081"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462572"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2082"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span>
</span><span id="line-2083"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier hs-type">ErrConstructTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2084"></span><span id="assignChangeAddressesWithoutDbUpdate"><span class="annot"><span class="annottext">assignChangeAddressesWithoutDbUpdate :: ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesWithoutDbUpdate"><span class="hs-identifier hs-var hs-var">assignChangeAddressesWithoutDbUpdate</span></a></span></span><span> </span><span id="local-6989586621682462570"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462570"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462569"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462569"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462568"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462568"><span class="hs-identifier hs-var">generateChange</span></a></span></span><span> </span><span id="local-6989586621682462567"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462567"><span class="hs-identifier hs-var">selection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2085"></span><span>    </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462566"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut))
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462540"><span id="local-6989586621682462541"><span id="local-6989586621682462542"><span id="local-6989586621682462543"><span id="local-6989586621682462544"><span id="local-6989586621682462545"><span id="local-6989586621682462546"><span id="local-6989586621682462547"><span id="local-6989586621682462548"><span id="local-6989586621682462549"><span id="local-6989586621682462550"><span id="local-6989586621682462551"><span id="local-6989586621682462552"><span id="local-6989586621682462553"><span id="local-6989586621682462554"><span id="local-6989586621682462555"><span id="local-6989586621682462556"><span id="local-6989586621682462557"><span id="local-6989586621682462558"><span id="local-6989586621682462559"><span id="local-6989586621682462560"><span id="local-6989586621682462561"><span id="local-6989586621682462562"><span id="local-6989586621682462563"><span id="local-6989586621682462564"><span id="local-6989586621682462565"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462540"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrConstructTx (SelectionOf TxOut))
 -&gt; IO (Either ErrConstructTx (SelectionOf TxOut)))
-&gt; ExceptT ErrConstructTx stm (SelectionOf TxOut)
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrConstructTx (SelectionOf TxOut))
-&gt; IO (Either ErrConstructTx (SelectionOf TxOut))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462540"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx stm (SelectionOf TxOut)
 -&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut))
-&gt; ExceptT ErrConstructTx stm (SelectionOf TxOut)
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2086"></span><span>        </span><span id="local-6989586621682462539"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462539"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrConstructTx)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrConstructTx stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxNoSuchWallet"><span class="hs-identifier hs-var">ErrConstructTxNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrConstructTx stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrConstructTx stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2087"></span><span>            </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462569"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682462560"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462569"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2088"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462537"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462537"><span class="hs-identifier hs-var">selectionUpdated</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2089"></span><span>                </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">assignChangeAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682462568"><span class="hs-identifier hs-var">generateChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462567"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462539"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2090"></span><span>        </span><span class="annot"><span class="annottext">SelectionOf TxOut -&gt; ExceptT ErrConstructTx stm (SelectionOf TxOut)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462537"><span class="hs-identifier hs-var">selectionUpdated</span></a></span><span>
</span><span id="line-2091"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2092"></span><span>    </span><span id="local-6989586621682462566"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462566"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462570"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462572"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462571"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2093"></span><span>
</span><span id="line-2094"></span><span class="annot"><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-type">selectionToUnsignedTx</span></a></span><span>
</span><span id="line-2095"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462536"><span class="annot"><a href="#local-6989586621682462536"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462535"><span class="annot"><a href="#local-6989586621682462535"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621682462534"><span class="annot"><a href="#local-6989586621682462534"><span class="hs-identifier hs-type">output</span></a></span></span><span> </span><span id="local-6989586621682462533"><span class="annot"><a href="#local-6989586621682462533"><span class="hs-identifier hs-type">change</span></a></span></span><span> </span><span id="local-6989586621682462532"><span class="annot"><a href="#local-6989586621682462532"><span class="hs-identifier hs-type">withdrawal</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2096"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462536"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2097"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462535"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462534"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2099"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462533"><span class="hs-identifier hs-type">change</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxChange"><span class="hs-identifier hs-type">TxChange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2100"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462532"><span class="hs-identifier hs-type">withdrawal</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2101"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2102"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-2103"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2104"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462536"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2105"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462535"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462534"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462533"><span class="hs-identifier hs-type">change</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462532"><span class="hs-identifier hs-type">withdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2106"></span><span id="selectionToUnsignedTx"><span class="annot"><span class="annottext">selectionToUnsignedTx :: Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var hs-var">selectionToUnsignedTx</span></a></span></span><span> </span><span id="local-6989586621682462531"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682462531"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span> </span><span id="local-6989586621682462530"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462530"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621682462529"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462529"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2107"></span><span>    </span><span class="annot"><span class="annottext">UnsignedTx :: forall input output change withdrawal.
[input]
-&gt; [input]
-&gt; [output]
-&gt; [change]
-&gt; [withdrawal]
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span>
</span><span id="line-2108"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:unsignedInputs:UnsignedTx :: [input]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AunsignedInputs%3AUnsignedTx"><span class="hs-identifier hs-var">unsignedInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2109"></span><span>            </span><span class="annot"><span class="annottext">[(TxIn, TxOut)] -&gt; [input]
</span><a href="#local-6989586621682462526"><span class="hs-identifier hs-var">fullyQualifiedInputs</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut)] -&gt; [input]) -&gt; [(TxIn, TxOut)] -&gt; [input]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (TxIn, TxOut) -&gt; [(TxIn, TxOut)]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (TxIn, TxOut) -&gt; [(TxIn, TxOut)])
-&gt; NonEmpty (TxIn, TxOut) -&gt; [(TxIn, TxOut)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (TxIn, TxOut)
  -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
 -&gt; SelectionOf TxOut
 -&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; NonEmpty (TxIn, TxOut)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; SelectionOf TxOut
   -&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut))
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; SelectionOf TxOut
-&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut)
</span><a href="#local-6989586621682462524"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462530"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2110"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:unsignedOutputs:UnsignedTx :: [output]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AunsignedOutputs%3AUnsignedTx"><span class="hs-identifier hs-var">unsignedOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2111"></span><span>            </span><span class="annot"><span class="annottext">(([output] -&gt; Const [output] [output])
 -&gt; SelectionOf TxOut -&gt; Const [output] (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; [output]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([output] -&gt; Const [output] [output])
   -&gt; SelectionOf TxOut -&gt; Const [output] (SelectionOf TxOut))
([output] -&gt; Const [output] [output])
-&gt; SelectionOf TxOut -&gt; Const [output] (SelectionOf TxOut)
</span><a href="#local-6989586621682462522"><span class="hs-var">#outputs</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462530"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2112"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:unsignedChange:UnsignedTx :: [change]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AunsignedChange%3AUnsignedTx"><span class="hs-identifier hs-var">unsignedChange</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2113"></span><span>            </span><span class="annot"><span class="annottext">[TxOut] -&gt; [change]
</span><a href="#local-6989586621682462520"><span class="hs-identifier hs-var">fullyQualifiedChange</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; [change]) -&gt; [TxOut] -&gt; [change]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxOut] -&gt; Const [TxOut] [TxOut])
 -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; [TxOut]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut)
</span><a href="#local-6989586621682462519"><span class="hs-var">#change</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462530"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2114"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:unsignedCollateral:UnsignedTx :: [input]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AunsignedCollateral%3AUnsignedTx"><span class="hs-identifier hs-var">unsignedCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2115"></span><span>            </span><span class="annot"><span class="annottext">[(TxIn, TxOut)] -&gt; [input]
</span><a href="#local-6989586621682462526"><span class="hs-identifier hs-var">fullyQualifiedInputs</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut)] -&gt; [input]) -&gt; [(TxIn, TxOut)] -&gt; [input]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([(TxIn, TxOut)] -&gt; Const [(TxIn, TxOut)] [(TxIn, TxOut)])
 -&gt; SelectionOf TxOut -&gt; Const [(TxIn, TxOut)] (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; [(TxIn, TxOut)]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([(TxIn, TxOut)] -&gt; Const [(TxIn, TxOut)] [(TxIn, TxOut)])
   -&gt; SelectionOf TxOut -&gt; Const [(TxIn, TxOut)] (SelectionOf TxOut))
([(TxIn, TxOut)] -&gt; Const [(TxIn, TxOut)] [(TxIn, TxOut)])
-&gt; SelectionOf TxOut -&gt; Const [(TxIn, TxOut)] (SelectionOf TxOut)
</span><a href="#local-6989586621682462517"><span class="hs-var">#collateral</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462530"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2116"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:unsignedWithdrawals:UnsignedTx :: [withdrawal]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AunsignedWithdrawals%3AUnsignedTx"><span class="hs-identifier hs-var">unsignedWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2117"></span><span>            </span><span class="annot"><span class="annottext">Withdrawal -&gt; [withdrawal]
</span><a href="#local-6989586621682462515"><span class="hs-identifier hs-var">fullyQualifiedWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682462531"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-2118"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2119"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2120"></span><span>    </span><span class="hs-comment">-- NOTE: External addresses, not known to the wallet, will be filtered out.</span><span>
</span><span id="line-2121"></span><span>    </span><span id="local-6989586621682464598"><span class="annot"><a href="#local-6989586621682462514"><span class="hs-identifier hs-type">qualifyAddresses</span></a></span><span>
</span><span id="line-2122"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464598"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2123"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682464598"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2124"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464598"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-2125"></span><span>    </span><span id="local-6989586621682462514"><span class="annot"><span class="annottext">qualifyAddresses :: (a -&gt; Address) -&gt; [a] -&gt; [(a, NonEmpty DerivationIndex)]
</span><a href="#local-6989586621682462514"><span class="hs-identifier hs-var hs-var">qualifyAddresses</span></a></span></span><span> </span><span id="local-6989586621682462513"><span class="annot"><span class="annottext">a -&gt; Address
</span><a href="#local-6989586621682462513"><span class="hs-identifier hs-var">getAddress</span></a></span></span><span> </span><span id="local-6989586621682462512"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682462512"><span class="hs-identifier hs-var">hasAddresses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2126"></span><span>        </span><span class="annot"><span class="annottext">(a -&gt; Maybe (a, NonEmpty DerivationIndex))
-&gt; [a] -&gt; [(a, NonEmpty DerivationIndex)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe (a, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682462511"><span class="hs-identifier hs-var">withDerivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682462512"><span class="hs-identifier hs-var">hasAddresses</span></a></span><span>
</span><span id="line-2127"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2128"></span><span>        </span><span id="local-6989586621682462511"><span class="annot"><span class="annottext">withDerivationPath :: a -&gt; Maybe (a, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682462511"><span class="hs-identifier hs-var hs-var">withDerivationPath</span></a></span></span><span> </span><span id="local-6989586621682462510"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682462510"><span class="hs-identifier hs-var">hasAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2129"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682462510"><span class="hs-identifier hs-var">hasAddress</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty DerivationIndex -&gt; (a, NonEmpty DerivationIndex))
-&gt; Maybe (NonEmpty DerivationIndex)
-&gt; Maybe (a, NonEmpty DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty DerivationIndex), s)
-&gt; Maybe (NonEmpty DerivationIndex)
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
forall s entity.
IsOurs s entity =&gt;
entity -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOurs"><span class="hs-identifier hs-var">isOurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Address
</span><a href="#local-6989586621682462513"><span class="hs-identifier hs-var">getAddress</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682462510"><span class="hs-identifier hs-var">hasAddress</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462529"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2130"></span><span>
</span><span id="line-2131"></span><span>    </span><span class="annot"><a href="#local-6989586621682462526"><span class="hs-identifier hs-type">fullyQualifiedInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682462535"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2132"></span><span>    </span><span id="local-6989586621682462526"><span class="annot"><span class="annottext">fullyQualifiedInputs :: [(TxIn, TxOut)] -&gt; [input]
</span><a href="#local-6989586621682462526"><span class="hs-identifier hs-var hs-var">fullyQualifiedInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2133"></span><span>        </span><span class="annot"><span class="annottext">(((TxIn, TxOut), NonEmpty DerivationIndex)
 -&gt; (TxIn, TxOut, NonEmpty DerivationIndex))
-&gt; [((TxIn, TxOut), NonEmpty DerivationIndex)]
-&gt; [(TxIn, TxOut, NonEmpty DerivationIndex)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut), NonEmpty DerivationIndex)
-&gt; (TxIn, TxOut, NonEmpty DerivationIndex)
forall a b c. ((a, b), c) -&gt; (a, b, c)
</span><a href="#local-6989586621682462509"><span class="hs-identifier hs-var">mkInput</span></a></span><span> </span><span class="annot"><span class="annottext">([((TxIn, TxOut), NonEmpty DerivationIndex)]
 -&gt; [(TxIn, TxOut, NonEmpty DerivationIndex)])
-&gt; ([(TxIn, TxOut)] -&gt; [((TxIn, TxOut), NonEmpty DerivationIndex)])
-&gt; [(TxIn, TxOut)]
-&gt; [(TxIn, TxOut, NonEmpty DerivationIndex)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; Address)
-&gt; [(TxIn, TxOut)] -&gt; [((TxIn, TxOut), NonEmpty DerivationIndex)]
forall a. (a -&gt; Address) -&gt; [a] -&gt; [(a, NonEmpty DerivationIndex)]
</span><a href="#local-6989586621682462514"><span class="hs-identifier hs-var">qualifyAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; TxOut -&gt; Const Address TxOut)
-&gt; TxOut -&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; TxOut -&gt; Const Address TxOut)
(Address -&gt; Const Address Address) -&gt; TxOut -&gt; Const Address TxOut
</span><a href="#local-6989586621682462508"><span class="hs-var">#address</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Address)
-&gt; ((TxIn, TxOut) -&gt; TxOut) -&gt; (TxIn, TxOut) -&gt; Address
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut) -&gt; TxOut
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2134"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2135"></span><span>        </span><span id="local-6989586621682462509"><span class="annot"><span class="annottext">mkInput :: ((a, b), c) -&gt; (a, b, c)
</span><a href="#local-6989586621682462509"><span class="hs-identifier hs-var hs-var">mkInput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682462507"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682462507"><span class="hs-identifier hs-var">txin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462506"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682462506"><span class="hs-identifier hs-var">txout</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462505"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682462505"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682462507"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682462506"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682462505"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2136"></span><span>
</span><span id="line-2137"></span><span>    </span><span class="annot"><a href="#local-6989586621682462520"><span class="hs-identifier hs-type">fullyQualifiedChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682462533"><span class="hs-identifier hs-type">change</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2138"></span><span>    </span><span id="local-6989586621682462520"><span class="annot"><span class="annottext">fullyQualifiedChange :: [TxOut] -&gt; [change]
</span><a href="#local-6989586621682462520"><span class="hs-identifier hs-var hs-var">fullyQualifiedChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2139"></span><span>        </span><span class="annot"><span class="annottext">((TxOut, NonEmpty DerivationIndex)
 -&gt; TxChange (NonEmpty DerivationIndex))
-&gt; [(TxOut, NonEmpty DerivationIndex)]
-&gt; [TxChange (NonEmpty DerivationIndex)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut, NonEmpty DerivationIndex)
-&gt; TxChange (NonEmpty DerivationIndex)
forall derivationPath.
(TxOut, derivationPath) -&gt; TxChange derivationPath
</span><a href="#local-6989586621682462504"><span class="hs-identifier hs-var">mkChange</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxOut, NonEmpty DerivationIndex)]
 -&gt; [TxChange (NonEmpty DerivationIndex)])
-&gt; ([TxOut] -&gt; [(TxOut, NonEmpty DerivationIndex)])
-&gt; [TxOut]
-&gt; [TxChange (NonEmpty DerivationIndex)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Address)
-&gt; [TxOut] -&gt; [(TxOut, NonEmpty DerivationIndex)]
forall a. (a -&gt; Address) -&gt; [a] -&gt; [(a, NonEmpty DerivationIndex)]
</span><a href="#local-6989586621682462514"><span class="hs-identifier hs-var">qualifyAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; TxOut -&gt; Const Address TxOut)
-&gt; TxOut -&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; TxOut -&gt; Const Address TxOut)
(Address -&gt; Const Address Address) -&gt; TxOut -&gt; Const Address TxOut
</span><a href="#local-6989586621682462503"><span class="hs-var">#address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2140"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2141"></span><span>        </span><span id="local-6989586621682462504"><span class="annot"><span class="annottext">mkChange :: (TxOut, derivationPath) -&gt; TxChange derivationPath
</span><a href="#local-6989586621682462504"><span class="hs-identifier hs-var hs-var">mkChange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682462502"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462502"><span class="hs-identifier hs-var">address</span></a></span></span><span> </span><span id="local-6989586621682462501"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462501"><span class="hs-identifier hs-var">bundle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462500"><span class="annot"><span class="annottext">derivationPath
</span><a href="#local-6989586621682462500"><span class="hs-identifier hs-var">derivationPath</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxChange :: forall derivationPath.
Address
-&gt; Coin -&gt; TokenMap -&gt; derivationPath -&gt; TxChange derivationPath
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxChange"><span class="hs-identifier hs-type">TxChange</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">derivationPath
Address
TokenMap
Coin
$sel:derivationPath:TxChange :: derivationPath
$sel:assets:TxChange :: TokenMap
$sel:amount:TxChange :: Coin
$sel:address:TxChange :: Address
assets :: TokenMap
amount :: Coin
derivationPath :: derivationPath
address :: Address
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AderivationPath%3ATxChange"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2142"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2143"></span><span>            </span><span id="local-6989586621682462498"><span class="annot"><span class="annottext">amount :: Coin
</span><a href="#local-6989586621682462498"><span class="hs-identifier hs-var hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; TokenBundle -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682462492"><span class="hs-var">#coin</span></a></span><span>   </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462501"><span class="hs-identifier hs-var">bundle</span></a></span><span>
</span><span id="line-2144"></span><span>            </span><span id="local-6989586621682462497"><span class="annot"><span class="annottext">assets :: TokenMap
</span><a href="#local-6989586621682462497"><span class="hs-identifier hs-var hs-var">assets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TokenMap -&gt; Const TokenMap TokenMap)
 -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenBundle -&gt; TokenMap
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682462491"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462501"><span class="hs-identifier hs-var">bundle</span></a></span><span>
</span><span id="line-2145"></span><span>
</span><span id="line-2146"></span><span>    </span><span class="annot"><a href="#local-6989586621682462515"><span class="hs-identifier hs-type">fullyQualifiedWithdrawal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682462532"><span class="hs-identifier hs-type">withdrawal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2147"></span><span>    </span><span id="local-6989586621682462515"><span class="annot"><span class="annottext">fullyQualifiedWithdrawal :: Withdrawal -&gt; [withdrawal]
</span><a href="#local-6989586621682462515"><span class="hs-identifier hs-var hs-var">fullyQualifiedWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2148"></span><span>        </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2149"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2150"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-type">WithdrawalSelf</span></a></span><span> </span><span id="local-6989586621682462489"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682462489"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span id="local-6989586621682462488"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682462488"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682462487"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462487"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2151"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682462489"><span class="hs-identifier hs-var">acct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462487"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682462488"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2152"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalExternal"><span class="hs-identifier hs-type">WithdrawalExternal</span></a></span><span> </span><span id="local-6989586621682462485"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682462485"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span id="local-6989586621682462484"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682462484"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682462483"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462483"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2153"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682462485"><span class="hs-identifier hs-var">acct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462483"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682462484"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2154"></span><span>
</span><span id="line-2155"></span><span class="hs-comment">-- | Read a wallet checkpoint and index its UTxO, for 'selectAssets' and</span><span>
</span><span id="line-2156"></span><span class="hs-comment">-- 'selectAssetsNoOutputs'.</span><span>
</span><span id="line-2157"></span><span class="annot"><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-type">readWalletUTxOIndex</span></a></span><span>
</span><span id="line-2158"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462482"><span class="annot"><a href="#local-6989586621682462482"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462481"><span class="annot"><a href="#local-6989586621682462481"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462480"><span class="annot"><a href="#local-6989586621682462480"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462481"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462480"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462482"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2159"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462482"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2160"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2161"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#UTxOIndex"><span class="hs-identifier hs-type">UTxOIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-type">WalletUTxO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462481"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span id="readWalletUTxOIndex"><span class="annot"><span class="annottext">readWalletUTxOIndex :: ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var hs-var">readWalletUTxOIndex</span></a></span></span><span> </span><span id="local-6989586621682462479"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462479"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462478"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462478"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2163"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682462477"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462477"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462476"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682462476"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462482"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462481"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462480"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462479"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462478"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2164"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462475"><span class="annot"><span class="annottext">utxo :: UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462475"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map WalletUTxO TokenBundle -&gt; UTxOIndex WalletUTxO
forall u. Ord u =&gt; Map u TokenBundle -&gt; UTxOIndex u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#fromMap"><span class="hs-identifier hs-var">UTxOIndex.fromMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Map WalletUTxO TokenBundle -&gt; UTxOIndex WalletUTxO)
-&gt; Map WalletUTxO TokenBundle -&gt; UTxOIndex WalletUTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2165"></span><span>            </span><span class="annot"><span class="annottext">UTxO -&gt; Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.CoinSelection.html#toInternalUTxOMap"><span class="hs-identifier hs-var">CS.toInternalUTxOMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO -&gt; Map WalletUTxO TokenBundle)
-&gt; UTxO -&gt; Map WalletUTxO TokenBundle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier hs-var">availableUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462481"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682462476"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462477"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-2166"></span><span>    </span><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682462475"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462477"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682462476"><span class="hs-identifier hs-var">pending</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- | Calculate the minimum coin values required for a bunch of specified</span><span>
</span><span id="line-2169"></span><span class="hs-comment">-- outputs.</span><span>
</span><span id="line-2170"></span><span class="annot"><a href="Cardano.Wallet.html#calcMinimumCoinValues"><span class="hs-identifier hs-type">calcMinimumCoinValues</span></a></span><span>
</span><span id="line-2171"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462472"><span class="annot"><a href="#local-6989586621682462472"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462471"><span class="annot"><a href="#local-6989586621682462471"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682462470"><span class="annot"><a href="#local-6989586621682462470"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2172"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462471"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462472"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2173"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462472"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2174"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462470"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-2175"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2176"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462472"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2177"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2178"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462470"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2179"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682462470"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span id="calcMinimumCoinValues"><span class="annot"><span class="annottext">calcMinimumCoinValues :: ctx -&gt; AnyCardanoEra -&gt; f TxOut -&gt; IO (f Coin)
</span><a href="Cardano.Wallet.html#calcMinimumCoinValues"><span class="hs-identifier hs-var hs-var">calcMinimumCoinValues</span></a></span></span><span> </span><span id="local-6989586621682462469"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462469"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462468"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462468"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682462467"><span class="annot"><span class="annottext">f TxOut
</span><a href="#local-6989586621682462467"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2181"></span><span>    </span><span id="local-6989586621682462466"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462466"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462465"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2182"></span><span>    </span><span class="annot"><span class="annottext">f Coin -&gt; IO (f Coin)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-2183"></span><span>        </span><span class="annot"><span class="annottext">(f Coin -&gt; IO (f Coin)) -&gt; f Coin -&gt; IO (f Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; TokenMap -&gt; Coin) -&gt; (Address, TokenMap) -&gt; Coin
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((Address -&gt; TokenMap -&gt; Coin)
  -&gt; Const
       (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
 -&gt; TxConstraints
 -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
-&gt; TxConstraints -&gt; Address -&gt; TokenMap -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputMinimumAdaQuantity&quot;
  (((Address -&gt; TokenMap -&gt; Coin)
    -&gt; Const
         (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
   -&gt; TxConstraints
   -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
((Address -&gt; TokenMap -&gt; Coin)
 -&gt; Const
      (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
-&gt; TxConstraints
-&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints
</span><a href="#local-6989586621682462464"><span class="hs-var">#txOutputMinimumAdaQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462463"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462468"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462466"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2184"></span><span>        </span><span class="annot"><span class="annottext">((Address, TokenMap) -&gt; Coin)
-&gt; (TxOut -&gt; (Address, TokenMap)) -&gt; TxOut -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682462462"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462462"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; TxOut -&gt; Const Address TxOut)
-&gt; TxOut -&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; TxOut -&gt; Const Address TxOut)
(Address -&gt; Const Address Address) -&gt; TxOut -&gt; Const Address TxOut
</span><a href="#local-6989586621682462461"><span class="hs-var">#address</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462462"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((TokenMap -&gt; Const TokenMap TokenMap)
 -&gt; TxOut -&gt; Const TokenMap TxOut)
-&gt; TxOut -&gt; TokenMap
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenMap TokenBundle)
   -&gt; TxOut -&gt; Const TokenMap TxOut)
(TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TxOut -&gt; Const TokenMap TxOut
</span><a href="#local-6989586621682462460"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenMap TokenBundle)
 -&gt; TxOut -&gt; Const TokenMap TxOut)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TxOut
-&gt; Const TokenMap TxOut
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682462459"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682462462"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Coin) -&gt; f TxOut -&gt; f Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">f TxOut
</span><a href="#local-6989586621682462467"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2185"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2186"></span><span>    </span><span id="local-6989586621682462465"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682462465"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462469"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2187"></span><span>    </span><span id="local-6989586621682462463"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462463"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462469"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462471"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2188"></span><span>
</span><span id="line-2189"></span><span class="hs-comment">-- | Parameters for the 'selectAssets' function.</span><span>
</span><span id="line-2190"></span><span class="hs-comment">--</span><span>
</span><span id="line-2191"></span><span id="local-6989586621682462457"><span id="local-6989586621682462458"></span></span><span class="hs-keyword">data</span><span> </span><span id="SelectAssetsParams"><span class="annot"><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-var">SelectAssetsParams</span></a></span></span><span> </span><span id="local-6989586621682462456"><span class="annot"><a href="#local-6989586621682462456"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462455"><span class="annot"><a href="#local-6989586621682462455"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SelectAssetsParams"><span class="annot"><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-var">SelectAssetsParams</span></a></span></span><span>
</span><span id="line-2192"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aoutputs%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2193"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ApendingTxs%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; Set Tx
</span><a href="Cardano.Wallet.html#%24sel%3ApendingTxs%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span>
</span><span id="line-2194"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">randomSeed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Control.Monad.Random.Extra.html#StdGenSeed"><span class="hs-identifier hs-type">StdGenSeed</span></a></span><span>
</span><span id="line-2195"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxContext%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">txContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2196"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">utxoAvailableForCollateral</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-type">WalletUTxO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span>
</span><span id="line-2197"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">utxoAvailableForInputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#UTxOSelection"><span class="hs-identifier hs-type">UTxOSelection</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletUTxO"><span class="hs-identifier hs-type">WalletUTxO</span></a></span><span>
</span><span id="line-2198"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Awallet%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; Wallet s
</span><a href="Cardano.Wallet.html#%24sel%3Awallet%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">wallet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462456"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2199"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="annot"><span class="annottext">SelectAssetsParams s result -&gt; SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">selectionStrategy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategy"><span class="hs-identifier hs-type">SelectionStrategy</span></a></span><span>
</span><span id="line-2200"></span><span>        </span><span class="hs-comment">-- ^ Specifies which selection strategy to use. See 'SelectionStrategy'.</span><span>
</span><span id="line-2201"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2202"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="annottext">(forall x.
 SelectAssetsParams s result -&gt; Rep (SelectAssetsParams s result) x)
-&gt; (forall x.
    Rep (SelectAssetsParams s result) x -&gt; SelectAssetsParams s result)
-&gt; Generic (SelectAssetsParams s result)
forall x.
Rep (SelectAssetsParams s result) x -&gt; SelectAssetsParams s result
forall x.
SelectAssetsParams s result -&gt; Rep (SelectAssetsParams s result) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall s result x.
Rep (SelectAssetsParams s result) x -&gt; SelectAssetsParams s result
forall s result x.
SelectAssetsParams s result -&gt; Rep (SelectAssetsParams s result) x
$cto :: forall s result x.
Rep (SelectAssetsParams s result) x -&gt; SelectAssetsParams s result
$cfrom :: forall s result x.
SelectAssetsParams s result -&gt; Rep (SelectAssetsParams s result) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span>
</span><span id="line-2203"></span><span>
</span><span id="line-2204"></span><span class="hs-comment">-- | Selects assets from a wallet.</span><span>
</span><span id="line-2205"></span><span class="hs-comment">--</span><span>
</span><span id="line-2206"></span><span class="hs-comment">-- This function has the following responsibilities:</span><span>
</span><span id="line-2207"></span><span class="hs-comment">--</span><span>
</span><span id="line-2208"></span><span class="hs-comment">--  - selecting inputs from the UTxO set to pay for user-specified outputs;</span><span>
</span><span id="line-2209"></span><span class="hs-comment">--  - selecting inputs from the UTxO set to pay for collateral;</span><span>
</span><span id="line-2210"></span><span class="hs-comment">--  - producing change outputs to return excess value to the wallet;</span><span>
</span><span id="line-2211"></span><span class="hs-comment">--  - balancing a selection to pay for the transaction fee.</span><span>
</span><span id="line-2212"></span><span class="hs-comment">--</span><span>
</span><span id="line-2213"></span><span class="hs-comment">-- When selecting inputs to pay for user-specified outputs, inputs are selected</span><span>
</span><span id="line-2214"></span><span class="hs-comment">-- randomly.</span><span>
</span><span id="line-2215"></span><span class="hs-comment">--</span><span>
</span><span id="line-2216"></span><span class="hs-comment">-- By default, the seed used for random selection is derived automatically,</span><span>
</span><span id="line-2217"></span><span class="hs-comment">-- from the given 'MonadRandom' context.</span><span>
</span><span id="line-2218"></span><span class="hs-comment">--</span><span>
</span><span id="line-2219"></span><span class="hs-comment">-- However, if a concrete value is specified for the optional 'randomSeed'</span><span>
</span><span id="line-2220"></span><span class="hs-comment">-- parameter, then that value will be used instead as the seed for random</span><span>
</span><span id="line-2221"></span><span class="hs-comment">-- selection.</span><span>
</span><span id="line-2222"></span><span class="hs-comment">--</span><span>
</span><span id="line-2223"></span><span class="annot"><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-type">selectAssets</span></a></span><span>
</span><span id="line-2224"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462443"><span class="annot"><a href="#local-6989586621682462443"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462442"><span class="annot"><a href="#local-6989586621682462442"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682462441"><span class="annot"><a href="#local-6989586621682462441"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462440"><span class="annot"><a href="#local-6989586621682462440"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682462439"><span class="annot"><a href="#local-6989586621682462439"><span class="hs-identifier hs-type">result</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2225"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462440"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2226"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462440"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462443"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2227"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462442"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462443"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2228"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../MonadRandom/html/src"><span class="hs-identifier hs-type">MonadRandom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462442"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2229"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2230"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462443"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2232"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ProtocolParameters"><span class="hs-identifier hs-type">ProtocolParameters</span></a></span><span>
</span><span id="line-2233"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">SelectAssetsParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462441"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462439"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-2234"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682462441"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462439"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2235"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462442"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462439"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-2236"></span><span id="selectAssets"><span class="annot"><span class="annottext">selectAssets :: ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var hs-var">selectAssets</span></a></span></span><span> </span><span id="local-6989586621682462438"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462438"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462437"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462437"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682462436"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621682462435"><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621682462434"><span class="annot"><span class="annottext">s -&gt; Selection -&gt; result
</span><a href="#local-6989586621682462434"><span class="hs-identifier hs-var">transform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2237"></span><span>    </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets m ()
</span><a href="#local-6989586621682462433"><span class="hs-identifier hs-var">guardPendingWithdrawal</span></a></span><span>
</span><span id="line-2238"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; ExceptT ErrSelectAssets m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT ErrSelectAssets m ())
-&gt; m () -&gt; ExceptT ErrSelectAssets m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462432"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [TxOut] -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionStart"><span class="hs-identifier hs-var">MsgSelectionStart</span></a></span><span>
</span><span id="line-2239"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOSelection WalletUTxO -&gt; Int
forall (s :: * -&gt; *) u. IsUTxOSelection s u =&gt; s u -&gt; Int
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#availableSize"><span class="hs-identifier hs-var">UTxOSelection.availableSize</span></a></span><span>
</span><span id="line-2240"></span><span>            </span><span class="annot"><span class="annottext">(UTxOSelection WalletUTxO -&gt; Int)
-&gt; UTxOSelection WalletUTxO -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((UTxOSelection WalletUTxO
     -&gt; Const (UTxOSelection WalletUTxO) (UTxOSelection WalletUTxO))
    -&gt; SelectAssetsParams s result
    -&gt; Const (UTxOSelection WalletUTxO) (SelectAssetsParams s result))
-&gt; UTxOSelection WalletUTxO
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;utxoAvailableForInputs&quot;
  ((UTxOSelection WalletUTxO
    -&gt; Const (UTxOSelection WalletUTxO) (UTxOSelection WalletUTxO))
   -&gt; SelectAssetsParams s result
   -&gt; Const (UTxOSelection WalletUTxO) (SelectAssetsParams s result))
(UTxOSelection WalletUTxO
 -&gt; Const (UTxOSelection WalletUTxO) (UTxOSelection WalletUTxO))
-&gt; SelectAssetsParams s result
-&gt; Const (UTxOSelection WalletUTxO) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462429"><span class="hs-var">#utxoAvailableForInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2241"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut])
    -&gt; SelectAssetsParams s result
    -&gt; Const [TxOut] (SelectAssetsParams s result))
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; SelectAssetsParams s result
   -&gt; Const [TxOut] (SelectAssetsParams s result))
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; SelectAssetsParams s result
-&gt; Const [TxOut] (SelectAssetsParams s result)
</span><a href="#local-6989586621682462428"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2242"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462427"><span class="annot"><span class="annottext">selectionConstraints :: SelectionConstraints
</span><a href="#local-6989586621682462427"><span class="hs-identifier hs-var hs-var">selectionConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionConstraints :: (TokenBundle -&gt; TokenBundleSizeAssessment)
-&gt; Coin
-&gt; (Address -&gt; TokenMap -&gt; Coin)
-&gt; (Address -&gt; TokenBundle -&gt; Bool)
-&gt; (SelectionSkeleton -&gt; Coin)
-&gt; ([TxOut] -&gt; SelectionLimit)
-&gt; Int
-&gt; Natural
-&gt; Address
-&gt; SelectionConstraints
</span><a href="Cardano.Wallet.CoinSelection.html#SelectionConstraints"><span class="hs-identifier hs-type">SelectionConstraints</span></a></span><span>
</span><span id="line-2243"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assessTokenBundleSize:SelectionConstraints :: TokenBundle -&gt; TokenBundleSizeAssessment
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassessTokenBundleSize%3ASelectionConstraints"><span class="hs-identifier hs-var">assessTokenBundleSize</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2244"></span><span>                </span><span class="annot"><span class="annottext">(((TokenBundle -&gt; TokenBundleSizeAssessment)
  -&gt; Const
       (TokenBundle -&gt; TokenBundleSizeAssessment)
       (TokenBundle -&gt; TokenBundleSizeAssessment))
 -&gt; TokenBundleSizeAssessor
 -&gt; Const
      (TokenBundle -&gt; TokenBundleSizeAssessment) TokenBundleSizeAssessor)
-&gt; TokenBundleSizeAssessor
-&gt; TokenBundle
-&gt; TokenBundleSizeAssessment
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assessTokenBundleSize&quot;
  (((TokenBundle -&gt; TokenBundleSizeAssessment)
    -&gt; Const
         (TokenBundle -&gt; TokenBundleSizeAssessment)
         (TokenBundle -&gt; TokenBundleSizeAssessment))
   -&gt; TokenBundleSizeAssessor
   -&gt; Const
        (TokenBundle -&gt; TokenBundleSizeAssessment) TokenBundleSizeAssessor)
((TokenBundle -&gt; TokenBundleSizeAssessment)
 -&gt; Const
      (TokenBundle -&gt; TokenBundleSizeAssessment)
      (TokenBundle -&gt; TokenBundleSizeAssessment))
-&gt; TokenBundleSizeAssessor
-&gt; Const
     (TokenBundle -&gt; TokenBundleSizeAssessment) TokenBundleSizeAssessor
</span><a href="#local-6989586621682462426"><span class="hs-var">#assessTokenBundleSize</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundleSizeAssessor
 -&gt; TokenBundle -&gt; TokenBundleSizeAssessment)
-&gt; TokenBundleSizeAssessor
-&gt; TokenBundle
-&gt; TokenBundleSizeAssessment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2245"></span><span>                </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; TokenBundleMaxSize -&gt; TokenBundleSizeAssessor
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; TokenBundleMaxSize -&gt; TokenBundleSizeAssessor
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtokenBundleSizeAssessor%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">tokenBundleSizeAssessor</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462425"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundleMaxSize -&gt; TokenBundleSizeAssessor)
-&gt; TokenBundleMaxSize -&gt; TokenBundleSizeAssessor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2246"></span><span>                </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
-&gt; ((TokenBundleMaxSize
     -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
    -&gt; ProtocolParameters
    -&gt; Const TokenBundleMaxSize ProtocolParameters)
-&gt; TokenBundleMaxSize
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txParameters&quot;
  ((TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
   -&gt; ProtocolParameters
   -&gt; Const TokenBundleMaxSize ProtocolParameters)
(TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
-&gt; ProtocolParameters
-&gt; Const TokenBundleMaxSize ProtocolParameters
</span><a href="#local-6989586621682462424"><span class="hs-var">#txParameters</span></a></span><span> </span><span class="annot"><span class="annottext">((TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
 -&gt; ProtocolParameters
 -&gt; Const TokenBundleMaxSize ProtocolParameters)
-&gt; ((TokenBundleMaxSize
     -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
    -&gt; TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
-&gt; (TokenBundleMaxSize
    -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
-&gt; ProtocolParameters
-&gt; Const TokenBundleMaxSize ProtocolParameters
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getTokenBundleMaxSize&quot;
  ((TokenBundleMaxSize
    -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
   -&gt; TxParameters -&gt; Const TokenBundleMaxSize TxParameters)
(TokenBundleMaxSize -&gt; Const TokenBundleMaxSize TokenBundleMaxSize)
-&gt; TxParameters -&gt; Const TokenBundleMaxSize TxParameters
</span><a href="#local-6989586621682462423"><span class="hs-var">#getTokenBundleMaxSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2247"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificateDepositAmount:SelectionConstraints :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcertificateDepositAmount%3ASelectionConstraints"><span class="hs-identifier hs-var">certificateDepositAmount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2248"></span><span>                </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; ProtocolParameters -&gt; Const Coin ProtocolParameters)
-&gt; ProtocolParameters -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;stakeKeyDeposit&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; ProtocolParameters -&gt; Const Coin ProtocolParameters)
(Coin -&gt; Const Coin Coin)
-&gt; ProtocolParameters -&gt; Const Coin ProtocolParameters
</span><a href="#local-6989586621682462422"><span class="hs-var">#stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2249"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computeMinimumAdaQuantity:SelectionConstraints :: Address -&gt; TokenMap -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcomputeMinimumAdaQuantity%3ASelectionConstraints"><span class="hs-identifier hs-var">computeMinimumAdaQuantity</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2250"></span><span>                </span><span class="annot"><span class="annottext">(((Address -&gt; TokenMap -&gt; Coin)
  -&gt; Const
       (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
 -&gt; TxConstraints
 -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
-&gt; TxConstraints -&gt; Address -&gt; TokenMap -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputMinimumAdaQuantity&quot;
  (((Address -&gt; TokenMap -&gt; Coin)
    -&gt; Const
         (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
   -&gt; TxConstraints
   -&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints)
((Address -&gt; TokenMap -&gt; Coin)
 -&gt; Const
      (Address -&gt; TokenMap -&gt; Coin) (Address -&gt; TokenMap -&gt; Coin))
-&gt; TxConstraints
-&gt; Const (Address -&gt; TokenMap -&gt; Coin) TxConstraints
</span><a href="#local-6989586621682462421"><span class="hs-var">#txOutputMinimumAdaQuantity</span></a></span><span>
</span><span id="line-2251"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462425"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462437"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:isBelowMinimumAdaQuantity:SelectionConstraints :: Address -&gt; TokenBundle -&gt; Bool
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AisBelowMinimumAdaQuantity%3ASelectionConstraints"><span class="hs-identifier hs-var">isBelowMinimumAdaQuantity</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2253"></span><span>                </span><span class="annot"><span class="annottext">(((Address -&gt; TokenBundle -&gt; Bool)
  -&gt; Const
       (Address -&gt; TokenBundle -&gt; Bool) (Address -&gt; TokenBundle -&gt; Bool))
 -&gt; TxConstraints
 -&gt; Const (Address -&gt; TokenBundle -&gt; Bool) TxConstraints)
-&gt; TxConstraints -&gt; Address -&gt; TokenBundle -&gt; Bool
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputBelowMinimumAdaQuantity&quot;
  (((Address -&gt; TokenBundle -&gt; Bool)
    -&gt; Const
         (Address -&gt; TokenBundle -&gt; Bool) (Address -&gt; TokenBundle -&gt; Bool))
   -&gt; TxConstraints
   -&gt; Const (Address -&gt; TokenBundle -&gt; Bool) TxConstraints)
((Address -&gt; TokenBundle -&gt; Bool)
 -&gt; Const
      (Address -&gt; TokenBundle -&gt; Bool) (Address -&gt; TokenBundle -&gt; Bool))
-&gt; TxConstraints
-&gt; Const (Address -&gt; TokenBundle -&gt; Bool) TxConstraints
</span><a href="#local-6989586621682462420"><span class="hs-var">#txOutputBelowMinimumAdaQuantity</span></a></span><span>
</span><span id="line-2254"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462425"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462437"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2255"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computeMinimumCost:SelectionConstraints :: SelectionSkeleton -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcomputeMinimumCost%3ASelectionConstraints"><span class="hs-identifier hs-var">computeMinimumCost</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2256"></span><span>                </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionSkeleton
-&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AcalcMinimumCost%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">calcMinimumCost</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462425"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462437"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">(TransactionCtx -&gt; SelectionSkeleton -&gt; Coin)
-&gt; TransactionCtx -&gt; SelectionSkeleton -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((TransactionCtx -&gt; Const TransactionCtx TransactionCtx)
    -&gt; SelectAssetsParams s result
    -&gt; Const TransactionCtx (SelectAssetsParams s result))
-&gt; TransactionCtx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx -&gt; Const TransactionCtx TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const TransactionCtx (SelectAssetsParams s result))
(TransactionCtx -&gt; Const TransactionCtx TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const TransactionCtx (SelectAssetsParams s result)
</span><a href="#local-6989586621682462419"><span class="hs-var">#txContext</span></a></span><span>
</span><span id="line-2257"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computeSelectionLimit:SelectionConstraints :: [TxOut] -&gt; SelectionLimit
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcomputeSelectionLimit%3ASelectionConstraints"><span class="hs-identifier hs-var">computeSelectionLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2258"></span><span>                </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; [TxOut]
-&gt; SelectionLimit
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; [TxOut]
-&gt; SelectionLimit
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AcomputeSelectionLimit%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">Cardano.Wallet.Transaction.computeSelectionLimit</span></a></span><span>
</span><span id="line-2259"></span><span>                    </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462425"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462437"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">(TransactionCtx -&gt; [TxOut] -&gt; SelectionLimit)
-&gt; TransactionCtx -&gt; [TxOut] -&gt; SelectionLimit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((TransactionCtx -&gt; Const TransactionCtx TransactionCtx)
    -&gt; SelectAssetsParams s result
    -&gt; Const TransactionCtx (SelectAssetsParams s result))
-&gt; TransactionCtx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx -&gt; Const TransactionCtx TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const TransactionCtx (SelectAssetsParams s result))
(TransactionCtx -&gt; Const TransactionCtx TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const TransactionCtx (SelectAssetsParams s result)
</span><a href="#local-6989586621682462417"><span class="hs-var">#txContext</span></a></span><span>
</span><span id="line-2260"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:maximumCollateralInputCount:SelectionConstraints :: Int
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AmaximumCollateralInputCount%3ASelectionConstraints"><span class="hs-identifier hs-var">maximumCollateralInputCount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2261"></span><span>                </span><span class="annot"><span class="annottext">(Integral Word16, Integral Int, IsIntSubType Word16 Int ~ 'True) =&gt;
Word16 -&gt; Int
forall a b.
(Integral a, Integral b, IsIntSubType a b ~ 'True) =&gt;
a -&gt; b
</span><a href="../../../../int-cast/html/src"><span class="hs-identifier hs-var">intCast</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; Word16 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Word16 -&gt; Const Word16 Word16)
 -&gt; ProtocolParameters -&gt; Const Word16 ProtocolParameters)
-&gt; ProtocolParameters -&gt; Word16
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;maximumCollateralInputCount&quot;
  ((Word16 -&gt; Const Word16 Word16)
   -&gt; ProtocolParameters -&gt; Const Word16 ProtocolParameters)
(Word16 -&gt; Const Word16 Word16)
-&gt; ProtocolParameters -&gt; Const Word16 ProtocolParameters
</span><a href="#local-6989586621682462416"><span class="hs-var">#maximumCollateralInputCount</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2262"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:minimumCollateralPercentage:SelectionConstraints :: Natural
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AminimumCollateralPercentage%3ASelectionConstraints"><span class="hs-identifier hs-var">minimumCollateralPercentage</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2263"></span><span>                </span><span class="annot"><span class="annottext">((Natural -&gt; Const Natural Natural)
 -&gt; ProtocolParameters -&gt; Const Natural ProtocolParameters)
-&gt; ProtocolParameters -&gt; Natural
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;minimumCollateralPercentage&quot;
  ((Natural -&gt; Const Natural Natural)
   -&gt; ProtocolParameters -&gt; Const Natural ProtocolParameters)
(Natural -&gt; Const Natural Natural)
-&gt; ProtocolParameters -&gt; Const Natural ProtocolParameters
</span><a href="#local-6989586621682462415"><span class="hs-var">#minimumCollateralPercentage</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462436"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2264"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:maximumLengthChangeAddress:SelectionConstraints :: Address
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AmaximumLengthChangeAddress%3ASelectionConstraints"><span class="hs-identifier hs-var">maximumLengthChangeAddress</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2265"></span><span>                </span><span class="annot"><span class="annottext">Proxy k -&gt; Address
forall k (key :: k).
BoundedAddressLength key =&gt;
Proxy key -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#maxLengthAddressFor"><span class="hs-identifier hs-var">maxLengthAddressFor</span></a></span><span> </span><span class="annot"><span class="annottext">(Proxy k -&gt; Address) -&gt; Proxy k -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy k
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462440"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2266"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2267"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462414"><span class="annot"><span class="annottext">selectionParams :: SelectionParams
</span><a href="#local-6989586621682462414"><span class="hs-identifier hs-var hs-var">selectionParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionParams :: TokenMap
-&gt; TokenMap
-&gt; Coin
-&gt; Coin
-&gt; [TxOut]
-&gt; Coin
-&gt; Natural
-&gt; Natural
-&gt; SelectionCollateralRequirement
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; SelectionStrategy
-&gt; SelectionParams
</span><a href="Cardano.Wallet.CoinSelection.html#SelectionParams"><span class="hs-identifier hs-type">SelectionParams</span></a></span><span>
</span><span id="line-2268"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assetsToMint:SelectionParams :: TokenMap
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassetsToMint%3ASelectionParams"><span class="hs-identifier hs-var">assetsToMint</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2269"></span><span>                </span><span class="annot"><span class="annottext">(TokenMap, Map AssetId (Script KeyHash)) -&gt; TokenMap
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenMap, Map AssetId (Script KeyHash)) -&gt; TokenMap)
-&gt; (TokenMap, Map AssetId (Script KeyHash)) -&gt; TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; (((TokenMap, Map AssetId (Script KeyHash))
     -&gt; Const
          (TokenMap, Map AssetId (Script KeyHash))
          (TokenMap, Map AssetId (Script KeyHash)))
    -&gt; SelectAssetsParams s result
    -&gt; Const
         (TokenMap, Map AssetId (Script KeyHash))
         (SelectAssetsParams s result))
-&gt; (TokenMap, Map AssetId (Script KeyHash))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx
    -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const
        (TokenMap, Map AssetId (Script KeyHash))
        (SelectAssetsParams s result))
(TransactionCtx
 -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const
     (TokenMap, Map AssetId (Script KeyHash))
     (SelectAssetsParams s result)
</span><a href="#local-6989586621682462413"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx
  -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const
      (TokenMap, Map AssetId (Script KeyHash))
      (SelectAssetsParams s result))
-&gt; (((TokenMap, Map AssetId (Script KeyHash))
     -&gt; Const
          (TokenMap, Map AssetId (Script KeyHash))
          (TokenMap, Map AssetId (Script KeyHash)))
    -&gt; TransactionCtx
    -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
-&gt; ((TokenMap, Map AssetId (Script KeyHash))
    -&gt; Const
         (TokenMap, Map AssetId (Script KeyHash))
         (TokenMap, Map AssetId (Script KeyHash)))
-&gt; SelectAssetsParams s result
-&gt; Const
     (TokenMap, Map AssetId (Script KeyHash))
     (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txAssetsToMint&quot;
  (((TokenMap, Map AssetId (Script KeyHash))
    -&gt; Const
         (TokenMap, Map AssetId (Script KeyHash))
         (TokenMap, Map AssetId (Script KeyHash)))
   -&gt; TransactionCtx
   -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
((TokenMap, Map AssetId (Script KeyHash))
 -&gt; Const
      (TokenMap, Map AssetId (Script KeyHash))
      (TokenMap, Map AssetId (Script KeyHash)))
-&gt; TransactionCtx
-&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx
</span><a href="#local-6989586621682462412"><span class="hs-var">#txAssetsToMint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assetsToBurn:SelectionParams :: TokenMap
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassetsToBurn%3ASelectionParams"><span class="hs-identifier hs-var">assetsToBurn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2271"></span><span>                </span><span class="annot"><span class="annottext">(TokenMap, Map AssetId (Script KeyHash)) -&gt; TokenMap
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenMap, Map AssetId (Script KeyHash)) -&gt; TokenMap)
-&gt; (TokenMap, Map AssetId (Script KeyHash)) -&gt; TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; (((TokenMap, Map AssetId (Script KeyHash))
     -&gt; Const
          (TokenMap, Map AssetId (Script KeyHash))
          (TokenMap, Map AssetId (Script KeyHash)))
    -&gt; SelectAssetsParams s result
    -&gt; Const
         (TokenMap, Map AssetId (Script KeyHash))
         (SelectAssetsParams s result))
-&gt; (TokenMap, Map AssetId (Script KeyHash))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx
    -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const
        (TokenMap, Map AssetId (Script KeyHash))
        (SelectAssetsParams s result))
(TransactionCtx
 -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const
     (TokenMap, Map AssetId (Script KeyHash))
     (SelectAssetsParams s result)
</span><a href="#local-6989586621682462411"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx
  -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const
      (TokenMap, Map AssetId (Script KeyHash))
      (SelectAssetsParams s result))
-&gt; (((TokenMap, Map AssetId (Script KeyHash))
     -&gt; Const
          (TokenMap, Map AssetId (Script KeyHash))
          (TokenMap, Map AssetId (Script KeyHash)))
    -&gt; TransactionCtx
    -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
-&gt; ((TokenMap, Map AssetId (Script KeyHash))
    -&gt; Const
         (TokenMap, Map AssetId (Script KeyHash))
         (TokenMap, Map AssetId (Script KeyHash)))
-&gt; SelectAssetsParams s result
-&gt; Const
     (TokenMap, Map AssetId (Script KeyHash))
     (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txAssetsToBurn&quot;
  (((TokenMap, Map AssetId (Script KeyHash))
    -&gt; Const
         (TokenMap, Map AssetId (Script KeyHash))
         (TokenMap, Map AssetId (Script KeyHash)))
   -&gt; TransactionCtx
   -&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx)
((TokenMap, Map AssetId (Script KeyHash))
 -&gt; Const
      (TokenMap, Map AssetId (Script KeyHash))
      (TokenMap, Map AssetId (Script KeyHash)))
-&gt; TransactionCtx
-&gt; Const (TokenMap, Map AssetId (Script KeyHash)) TransactionCtx
</span><a href="#local-6989586621682462410"><span class="hs-var">#txAssetsToBurn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2272"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:extraCoinIn:SelectionParams :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AextraCoinIn%3ASelectionParams"><span class="hs-identifier hs-var">extraCoinIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2273"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:extraCoinOut:SelectionParams :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AextraCoinOut%3ASelectionParams"><span class="hs-identifier hs-var">extraCoinOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2274"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outputsToCover:SelectionParams :: [TxOut]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AoutputsToCover%3ASelectionParams"><span class="hs-identifier hs-var">outputsToCover</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut])
    -&gt; SelectAssetsParams s result
    -&gt; Const [TxOut] (SelectAssetsParams s result))
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; SelectAssetsParams s result
   -&gt; Const [TxOut] (SelectAssetsParams s result))
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; SelectAssetsParams s result
-&gt; Const [TxOut] (SelectAssetsParams s result)
</span><a href="#local-6989586621682462409"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-2275"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:rewardWithdrawal:SelectionParams :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3ArewardWithdrawal%3ASelectionParams"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2276"></span><span>                </span><span class="annot"><span class="annottext">Withdrawal -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#withdrawalToCoin"><span class="hs-identifier hs-var">withdrawalToCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Withdrawal -&gt; Coin) -&gt; Withdrawal -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Withdrawal -&gt; Const Withdrawal Withdrawal)
    -&gt; SelectAssetsParams s result
    -&gt; Const Withdrawal (SelectAssetsParams s result))
-&gt; Withdrawal
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx -&gt; Const Withdrawal TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const Withdrawal (SelectAssetsParams s result))
(TransactionCtx -&gt; Const Withdrawal TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const Withdrawal (SelectAssetsParams s result)
</span><a href="#local-6989586621682462408"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx -&gt; Const Withdrawal TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const Withdrawal (SelectAssetsParams s result))
-&gt; ((Withdrawal -&gt; Const Withdrawal Withdrawal)
    -&gt; TransactionCtx -&gt; Const Withdrawal TransactionCtx)
-&gt; (Withdrawal -&gt; Const Withdrawal Withdrawal)
-&gt; SelectAssetsParams s result
-&gt; Const Withdrawal (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txWithdrawal&quot;
  ((Withdrawal -&gt; Const Withdrawal Withdrawal)
   -&gt; TransactionCtx -&gt; Const Withdrawal TransactionCtx)
(Withdrawal -&gt; Const Withdrawal Withdrawal)
-&gt; TransactionCtx -&gt; Const Withdrawal TransactionCtx
</span><a href="#local-6989586621682462407"><span class="hs-var">#txWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2277"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificateDepositsReturned:SelectionParams :: Natural
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcertificateDepositsReturned%3ASelectionParams"><span class="hs-identifier hs-var">certificateDepositsReturned</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2278"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Maybe DelegationAction
     -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
    -&gt; SelectAssetsParams s result
    -&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result))
-&gt; Maybe DelegationAction
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result))
(TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462406"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result))
-&gt; ((Maybe DelegationAction
     -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
    -&gt; TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
-&gt; (Maybe DelegationAction
    -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
-&gt; SelectAssetsParams s result
-&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txDelegationAction&quot;
  ((Maybe DelegationAction
    -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
   -&gt; TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
(Maybe DelegationAction
 -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
-&gt; TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx
</span><a href="#local-6989586621682462405"><span class="hs-var">#txDelegationAction</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2279"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#Quit"><span class="hs-identifier hs-var">Quit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2280"></span><span>                    </span><span class="annot"><span class="annottext">Maybe DelegationAction
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2281"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificateDepositsTaken:SelectionParams :: Natural
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcertificateDepositsTaken%3ASelectionParams"><span class="hs-identifier hs-var">certificateDepositsTaken</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2282"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Maybe DelegationAction
     -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
    -&gt; SelectAssetsParams s result
    -&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result))
-&gt; Maybe DelegationAction
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result))
(TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462403"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result))
-&gt; ((Maybe DelegationAction
     -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
    -&gt; TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
-&gt; (Maybe DelegationAction
    -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
-&gt; SelectAssetsParams s result
-&gt; Const (Maybe DelegationAction) (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txDelegationAction&quot;
  ((Maybe DelegationAction
    -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
   -&gt; TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx)
(Maybe DelegationAction
 -&gt; Const (Maybe DelegationAction) (Maybe DelegationAction))
-&gt; TransactionCtx -&gt; Const (Maybe DelegationAction) TransactionCtx
</span><a href="#local-6989586621682462402"><span class="hs-var">#txDelegationAction</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2283"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#RegisterKeyAndJoin"><span class="hs-identifier hs-type">RegisterKeyAndJoin</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2284"></span><span>                    </span><span class="annot"><span class="annottext">Maybe DelegationAction
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2285"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralRequirement:SelectionParams :: SelectionCollateralRequirement
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AcollateralRequirement%3ASelectionParams"><span class="hs-identifier hs-var">collateralRequirement</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2286"></span><span>                </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((SelectionCollateralRequirement
     -&gt; Const
          SelectionCollateralRequirement SelectionCollateralRequirement)
    -&gt; SelectAssetsParams s result
    -&gt; Const
         SelectionCollateralRequirement (SelectAssetsParams s result))
-&gt; SelectionCollateralRequirement
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx
    -&gt; Const SelectionCollateralRequirement TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const
        SelectionCollateralRequirement (SelectAssetsParams s result))
(TransactionCtx
 -&gt; Const SelectionCollateralRequirement TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const
     SelectionCollateralRequirement (SelectAssetsParams s result)
</span><a href="#local-6989586621682462400"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx
  -&gt; Const SelectionCollateralRequirement TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const
      SelectionCollateralRequirement (SelectAssetsParams s result))
-&gt; ((SelectionCollateralRequirement
     -&gt; Const
          SelectionCollateralRequirement SelectionCollateralRequirement)
    -&gt; TransactionCtx
    -&gt; Const SelectionCollateralRequirement TransactionCtx)
-&gt; (SelectionCollateralRequirement
    -&gt; Const
         SelectionCollateralRequirement SelectionCollateralRequirement)
-&gt; SelectAssetsParams s result
-&gt; Const
     SelectionCollateralRequirement (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txCollateralRequirement&quot;
  ((SelectionCollateralRequirement
    -&gt; Const
         SelectionCollateralRequirement SelectionCollateralRequirement)
   -&gt; TransactionCtx
   -&gt; Const SelectionCollateralRequirement TransactionCtx)
(SelectionCollateralRequirement
 -&gt; Const
      SelectionCollateralRequirement SelectionCollateralRequirement)
-&gt; TransactionCtx
-&gt; Const SelectionCollateralRequirement TransactionCtx
</span><a href="#local-6989586621682462399"><span class="hs-var">#txCollateralRequirement</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2287"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectionParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AutxoAvailableForCollateral%3ASelectionParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2288"></span><span>                </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Map WalletUTxO TokenBundle
     -&gt; Const (Map WalletUTxO TokenBundle) (Map WalletUTxO TokenBundle))
    -&gt; SelectAssetsParams s result
    -&gt; Const
         (Map WalletUTxO TokenBundle) (SelectAssetsParams s result))
-&gt; Map WalletUTxO TokenBundle
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;utxoAvailableForCollateral&quot;
  ((Map WalletUTxO TokenBundle
    -&gt; Const (Map WalletUTxO TokenBundle) (Map WalletUTxO TokenBundle))
   -&gt; SelectAssetsParams s result
   -&gt; Const
        (Map WalletUTxO TokenBundle) (SelectAssetsParams s result))
(Map WalletUTxO TokenBundle
 -&gt; Const (Map WalletUTxO TokenBundle) (Map WalletUTxO TokenBundle))
-&gt; SelectAssetsParams s result
-&gt; Const (Map WalletUTxO TokenBundle) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462398"><span class="hs-var">#utxoAvailableForCollateral</span></a></span><span>
</span><span id="line-2289"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectionParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AutxoAvailableForInputs%3ASelectionParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2290"></span><span>                </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((UTxOSelection WalletUTxO
     -&gt; Const (UTxOSelection WalletUTxO) (UTxOSelection WalletUTxO))
    -&gt; SelectAssetsParams s result
    -&gt; Const (UTxOSelection WalletUTxO) (SelectAssetsParams s result))
-&gt; UTxOSelection WalletUTxO
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;utxoAvailableForInputs&quot;
  ((UTxOSelection WalletUTxO
    -&gt; Const (UTxOSelection WalletUTxO) (UTxOSelection WalletUTxO))
   -&gt; SelectAssetsParams s result
   -&gt; Const (UTxOSelection WalletUTxO) (SelectAssetsParams s result))
(UTxOSelection WalletUTxO
 -&gt; Const (UTxOSelection WalletUTxO) (UTxOSelection WalletUTxO))
-&gt; SelectAssetsParams s result
-&gt; Const (UTxOSelection WalletUTxO) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462397"><span class="hs-var">#utxoAvailableForInputs</span></a></span><span>
</span><span id="line-2291"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectionParams :: SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AselectionStrategy%3ASelectionParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2292"></span><span>                </span><span class="annot"><span class="annottext">((SelectionStrategy -&gt; Const SelectionStrategy SelectionStrategy)
 -&gt; SelectAssetsParams s result
 -&gt; Const SelectionStrategy (SelectAssetsParams s result))
-&gt; SelectAssetsParams s result -&gt; SelectionStrategy
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;selectionStrategy&quot;
  ((SelectionStrategy -&gt; Const SelectionStrategy SelectionStrategy)
   -&gt; SelectAssetsParams s result
   -&gt; Const SelectionStrategy (SelectAssetsParams s result))
(SelectionStrategy -&gt; Const SelectionStrategy SelectionStrategy)
-&gt; SelectAssetsParams s result
-&gt; Const SelectionStrategy (SelectAssetsParams s result)
</span><a href="#local-6989586621682462396"><span class="hs-var">#selectionStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-2293"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2294"></span><span>    </span><span id="local-6989586621682462395"><span class="annot"><span class="annottext">StdGenSeed
</span><a href="#local-6989586621682462395"><span class="hs-identifier hs-var">randomSeed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets m StdGenSeed
-&gt; (StdGenSeed -&gt; ExceptT ErrSelectAssets m StdGenSeed)
-&gt; Maybe StdGenSeed
-&gt; ExceptT ErrSelectAssets m StdGenSeed
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets m StdGenSeed
forall (m :: * -&gt; *). MonadRandom m =&gt; m StdGenSeed
</span><a href="Control.Monad.Random.Extra.html#stdGenSeed"><span class="hs-identifier hs-var">stdGenSeed</span></a></span><span> </span><span class="annot"><span class="annottext">StdGenSeed -&gt; ExceptT ErrSelectAssets m StdGenSeed
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Maybe StdGenSeed
     -&gt; Const (Maybe StdGenSeed) (Maybe StdGenSeed))
    -&gt; SelectAssetsParams s result
    -&gt; Const (Maybe StdGenSeed) (SelectAssetsParams s result))
-&gt; Maybe StdGenSeed
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;randomSeed&quot;
  ((Maybe StdGenSeed -&gt; Const (Maybe StdGenSeed) (Maybe StdGenSeed))
   -&gt; SelectAssetsParams s result
   -&gt; Const (Maybe StdGenSeed) (SelectAssetsParams s result))
(Maybe StdGenSeed -&gt; Const (Maybe StdGenSeed) (Maybe StdGenSeed))
-&gt; SelectAssetsParams s result
-&gt; Const (Maybe StdGenSeed) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462393"><span class="hs-var">#randomSeed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2295"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462392"><span class="annot"><span class="annottext">mSel :: Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462392"><span class="hs-identifier hs-var hs-var">mSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Rand
   StdGen (Either (SelectionError WalletSelectionContext) Selection)
 -&gt; StdGen
 -&gt; Either (SelectionError WalletSelectionContext) Selection)
-&gt; StdGen
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
-&gt; Either (SelectionError WalletSelectionContext) Selection
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Rand
  StdGen (Either (SelectionError WalletSelectionContext) Selection)
-&gt; StdGen
-&gt; Either (SelectionError WalletSelectionContext) Selection
forall g a. Rand g a -&gt; g -&gt; a
</span><a href="../../../../MonadRandom/html/src"><span class="hs-identifier hs-var">evalRand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StdGenSeed -&gt; StdGen
</span><a href="Control.Monad.Random.Extra.html#stdGenFromSeed"><span class="hs-identifier hs-var">stdGenFromSeed</span></a></span><span> </span><span class="annot"><span class="annottext">StdGenSeed
</span><a href="#local-6989586621682462395"><span class="hs-identifier hs-var">randomSeed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2296"></span><span>            </span><span class="annot"><span class="annottext">(Rand
   StdGen (Either (SelectionError WalletSelectionContext) Selection)
 -&gt; Either (SelectionError WalletSelectionContext) Selection)
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
-&gt; Either (SelectionError WalletSelectionContext) Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT
  (SelectionError WalletSelectionContext)
  (RandT StdGen Identity)
  Selection
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span>
</span><span id="line-2297"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   (SelectionError WalletSelectionContext)
   (RandT StdGen Identity)
   Selection
 -&gt; Rand
      StdGen (Either (SelectionError WalletSelectionContext) Selection))
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     (RandT StdGen Identity)
     Selection
-&gt; Rand
     StdGen (Either (SelectionError WalletSelectionContext) Selection)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionConstraints
-&gt; SelectionParams
-&gt; ExceptT
     (SelectionError WalletSelectionContext)
     (RandT StdGen Identity)
     Selection
forall (m :: * -&gt; *).
(HasCallStack, MonadRandom m) =&gt;
SelectionConstraints
-&gt; SelectionParams
-&gt; ExceptT (SelectionError WalletSelectionContext) m Selection
</span><a href="Cardano.Wallet.CoinSelection.html#performSelection"><span class="hs-identifier hs-var">performSelection</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionConstraints
</span><a href="#local-6989586621682462427"><span class="hs-identifier hs-var">selectionConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionParams
</span><a href="#local-6989586621682462414"><span class="hs-identifier hs-var">selectionParams</span></a></span><span>
</span><span id="line-2298"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462392"><span class="hs-identifier hs-var">mSel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2299"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682462391"><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682462391"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ExceptT ErrSelectAssets m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT ErrSelectAssets m ())
-&gt; m () -&gt; ExceptT ErrSelectAssets m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2300"></span><span>            </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462432"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionError"><span class="hs-identifier hs-var">MsgSelectionError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682462391"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2301"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682462390"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462390"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ExceptT ErrSelectAssets m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT ErrSelectAssets m ())
-&gt; m () -&gt; ExceptT ErrSelectAssets m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2302"></span><span>            </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462432"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportSummarized -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionReportSummarized"><span class="hs-identifier hs-var">MsgSelectionReportSummarized</span></a></span><span>
</span><span id="line-2303"></span><span>                </span><span class="annot"><span class="annottext">(SelectionReportSummarized -&gt; WalletLog)
-&gt; SelectionReportSummarized -&gt; WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; SelectionReportSummarized
</span><a href="Cardano.Wallet.CoinSelection.html#makeSelectionReportSummarized"><span class="hs-identifier hs-var">makeSelectionReportSummarized</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462390"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2304"></span><span>            </span><span class="annot"><span class="annottext">Tracer m WalletLog -&gt; WalletLog -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m WalletLog
</span><a href="#local-6989586621682462432"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; m ()) -&gt; WalletLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportDetailed -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgSelectionReportDetailed"><span class="hs-identifier hs-var">MsgSelectionReportDetailed</span></a></span><span>
</span><span id="line-2305"></span><span>                </span><span class="annot"><span class="annottext">(SelectionReportDetailed -&gt; WalletLog)
-&gt; SelectionReportDetailed -&gt; WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; SelectionReportDetailed
</span><a href="Cardano.Wallet.CoinSelection.html#makeSelectionReportDetailed"><span class="hs-identifier hs-var">makeSelectionReportDetailed</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682462390"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2306"></span><span>    </span><span class="annot"><span class="annottext">(SelectionError WalletSelectionContext -&gt; ErrSelectAssets)
-&gt; ExceptT (SelectionError WalletSelectionContext) m result
-&gt; ExceptT ErrSelectAssets m result
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext -&gt; ErrSelectAssets
</span><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-var">ErrSelectAssetsSelectionError</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (SelectionError WalletSelectionContext) m result
 -&gt; ExceptT ErrSelectAssets m result)
-&gt; ExceptT (SelectionError WalletSelectionContext) m result
-&gt; ExceptT ErrSelectAssets m result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either (SelectionError WalletSelectionContext) result
-&gt; ExceptT (SelectionError WalletSelectionContext) m result
forall (m :: * -&gt; *) e a. Monad m =&gt; Either e a -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">except</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (SelectionError WalletSelectionContext) result
 -&gt; ExceptT (SelectionError WalletSelectionContext) m result)
-&gt; Either (SelectionError WalletSelectionContext) result
-&gt; ExceptT (SelectionError WalletSelectionContext) m result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2307"></span><span>        </span><span class="annot"><span class="annottext">s -&gt; Selection -&gt; result
</span><a href="#local-6989586621682462434"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet s -&gt; s) -&gt; Wallet s -&gt; s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Wallet s -&gt; Const (Wallet s) (Wallet s))
    -&gt; SelectAssetsParams s result
    -&gt; Const (Wallet s) (SelectAssetsParams s result))
-&gt; Wallet s
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;wallet&quot;
  ((Wallet s -&gt; Const (Wallet s) (Wallet s))
   -&gt; SelectAssetsParams s result
   -&gt; Const (Wallet s) (SelectAssetsParams s result))
(Wallet s -&gt; Const (Wallet s) (Wallet s))
-&gt; SelectAssetsParams s result
-&gt; Const (Wallet s) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462389"><span class="hs-var">#wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Selection -&gt; result)
-&gt; Either (SelectionError WalletSelectionContext) Selection
-&gt; Either (SelectionError WalletSelectionContext) result
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either (SelectionError WalletSelectionContext) Selection
</span><a href="#local-6989586621682462392"><span class="hs-identifier hs-var">mSel</span></a></span><span>
</span><span id="line-2308"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2309"></span><span>    </span><span id="local-6989586621682462425"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462425"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462438"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462440"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2310"></span><span>    </span><span id="local-6989586621682462432"><span class="annot"><span class="annottext">tr :: Tracer m WalletLog
</span><a href="#local-6989586621682462432"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; WalletWorkerLog)
-&gt; Tracer m WalletWorkerLog -&gt; Tracer m WalletLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer m WalletWorkerLog -&gt; Tracer m WalletLog)
-&gt; Tracer m WalletWorkerLog -&gt; Tracer m WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462438"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer m WalletWorkerLog
     -&gt; Const (Tracer m WalletWorkerLog) (Tracer m WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer m WalletWorkerLog) ctx)
-&gt; Tracer m WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg ctx. HasLogger m msg ctx =&gt; Lens' ctx (Tracer m msg)
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462442"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2311"></span><span>
</span><span id="line-2312"></span><span>    </span><span class="hs-comment">-- Ensure that there's no existing pending withdrawals. Indeed, a withdrawal</span><span>
</span><span id="line-2313"></span><span>    </span><span class="hs-comment">-- is necessarily withdrawing rewards in their totality. So, after a first</span><span>
</span><span id="line-2314"></span><span>    </span><span class="hs-comment">-- withdrawal is executed, the reward pot is empty. So, to prevent two</span><span>
</span><span id="line-2315"></span><span>    </span><span class="hs-comment">-- transactions with withdrawals to go through (which will inevitably cause</span><span>
</span><span id="line-2316"></span><span>    </span><span class="hs-comment">-- one of them to never be inserted), we warn users early on about it.</span><span>
</span><span id="line-2317"></span><span>    </span><span class="annot"><a href="#local-6989586621682462433"><span class="hs-identifier hs-type">guardPendingWithdrawal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462442"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2318"></span><span>    </span><span id="local-6989586621682462433"><span class="annot"><span class="annottext">guardPendingWithdrawal :: ExceptT ErrSelectAssets m ()
</span><a href="#local-6989586621682462433"><span class="hs-identifier hs-var hs-var">guardPendingWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2319"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Maybe Tx
forall a. Set a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.lookupMin</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Tx -&gt; Maybe Tx) -&gt; Set Tx -&gt; Maybe Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx -&gt; Bool) -&gt; Set Tx -&gt; Set Tx
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.filter</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Bool
</span><a href="#local-6989586621682462386"><span class="hs-identifier hs-var">hasWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Tx -&gt; Set Tx) -&gt; Set Tx -&gt; Set Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Set Tx -&gt; Const (Set Tx) (Set Tx))
    -&gt; SelectAssetsParams s result
    -&gt; Const (Set Tx) (SelectAssetsParams s result))
-&gt; Set Tx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;pendingTxs&quot;
  ((Set Tx -&gt; Const (Set Tx) (Set Tx))
   -&gt; SelectAssetsParams s result
   -&gt; Const (Set Tx) (SelectAssetsParams s result))
(Set Tx -&gt; Const (Set Tx) (Set Tx))
-&gt; SelectAssetsParams s result
-&gt; Const (Set Tx) (SelectAssetsParams s result)
</span><a href="#local-6989586621682462385"><span class="hs-var">#pendingTxs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2320"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682462384"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462384"><span class="hs-identifier hs-var">pendingWithdrawal</span></a></span></span><span>
</span><span id="line-2321"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Withdrawal -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#withdrawalToCoin"><span class="hs-identifier hs-var">withdrawalToCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682462383"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2322"></span><span>                    </span><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ExceptT ErrSelectAssets m ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrSelectAssets -&gt; ExceptT ErrSelectAssets m ())
-&gt; ErrSelectAssets -&gt; ExceptT ErrSelectAssets m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; ErrSelectAssets
</span><a href="Cardano.Wallet.html#ErrSelectAssetsAlreadyWithdrawing"><span class="hs-identifier hs-var">ErrSelectAssetsAlreadyWithdrawing</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462384"><span class="hs-identifier hs-var">pendingWithdrawal</span></a></span><span>
</span><span id="line-2323"></span><span>            </span><span id="local-6989586621682462381"><span class="annot"><span class="annottext">Maybe Tx
</span><a href="#local-6989586621682462381"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2324"></span><span>                </span><span class="annot"><span class="annottext">() -&gt; ExceptT ErrSelectAssets m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2325"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2326"></span><span>        </span><span class="annot"><a href="#local-6989586621682462386"><span class="hs-identifier hs-type">hasWithdrawal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-2327"></span><span>        </span><span id="local-6989586621682462386"><span class="annot"><span class="annottext">hasWithdrawal :: Tx -&gt; Bool
</span><a href="#local-6989586621682462386"><span class="hs-identifier hs-var hs-var">hasWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Tx -&gt; Bool) -&gt; Tx -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(Map RewardAccount Coin -&gt; Bool)
-&gt; (Tx -&gt; Map RewardAccount Coin) -&gt; Tx -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Map RewardAccount Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Awithdrawals%3ATx"><span class="hs-identifier hs-var hs-var">withdrawals</span></a></span><span>
</span><span id="line-2328"></span><span>
</span><span id="line-2329"></span><span>        </span><span class="annot"><a href="#local-6989586621682462383"><span class="hs-identifier hs-type">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-2330"></span><span>        </span><span id="local-6989586621682462383"><span class="annot"><span class="annottext">txWithdrawal :: Withdrawal
</span><a href="#local-6989586621682462383"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
</span><a href="#local-6989586621682462435"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s result
-&gt; ((Withdrawal -&gt; Const Withdrawal Withdrawal)
    -&gt; SelectAssetsParams s result
    -&gt; Const Withdrawal (SelectAssetsParams s result))
-&gt; Withdrawal
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txContext&quot;
  ((TransactionCtx -&gt; Const Withdrawal TransactionCtx)
   -&gt; SelectAssetsParams s result
   -&gt; Const Withdrawal (SelectAssetsParams s result))
(TransactionCtx -&gt; Const Withdrawal TransactionCtx)
-&gt; SelectAssetsParams s result
-&gt; Const Withdrawal (SelectAssetsParams s result)
</span><a href="#local-6989586621682462379"><span class="hs-var">#txContext</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionCtx -&gt; Const Withdrawal TransactionCtx)
 -&gt; SelectAssetsParams s result
 -&gt; Const Withdrawal (SelectAssetsParams s result))
-&gt; ((Withdrawal -&gt; Const Withdrawal Withdrawal)
    -&gt; TransactionCtx -&gt; Const Withdrawal TransactionCtx)
-&gt; (Withdrawal -&gt; Const Withdrawal Withdrawal)
-&gt; SelectAssetsParams s result
-&gt; Const Withdrawal (SelectAssetsParams s result)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txWithdrawal&quot;
  ((Withdrawal -&gt; Const Withdrawal Withdrawal)
   -&gt; TransactionCtx -&gt; Const Withdrawal TransactionCtx)
(Withdrawal -&gt; Const Withdrawal Withdrawal)
-&gt; TransactionCtx -&gt; Const Withdrawal TransactionCtx
</span><a href="#local-6989586621682462378"><span class="hs-var">#txWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2331"></span><span>
</span><span id="line-2332"></span><span class="annot"><a href="Cardano.Wallet.html#signTransaction"><span class="hs-identifier hs-type">signTransaction</span></a></span><span>
</span><span id="line-2333"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462377"><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-2334"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2335"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2336"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2337"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-2338"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-2339"></span><span>  </span><span class="hs-comment">-- ^ The way to interact with the wallet backend</span><span>
</span><span id="line-2340"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2341"></span><span>  </span><span class="hs-comment">-- ^ Preferred latest era</span><span>
</span><span id="line-2342"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2343"></span><span>  </span><span class="hs-comment">-- ^ The wallets address-key lookup function</span><span>
</span><span id="line-2344"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2345"></span><span>  </span><span class="hs-comment">-- ^ The root key of the wallet</span><span>
</span><span id="line-2346"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span>
</span><span id="line-2347"></span><span>  </span><span class="hs-comment">-- ^ The total UTxO set of the wallet (i.e. if pending transactions all</span><span>
</span><span id="line-2348"></span><span>  </span><span class="hs-comment">-- applied).</span><span>
</span><span id="line-2349"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-2350"></span><span>  </span><span class="hs-comment">-- ^ The transaction to sign</span><span>
</span><span id="line-2351"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-2352"></span><span>  </span><span class="hs-comment">-- ^ The original transaction, with additional signatures added where</span><span>
</span><span id="line-2353"></span><span>  </span><span class="hs-comment">-- necessary</span><span>
</span><span id="line-2354"></span><span id="signTransaction"><span class="annot"><span class="annottext">signTransaction :: TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; UTxO
-&gt; SealedTx
-&gt; SealedTx
</span><a href="Cardano.Wallet.html#signTransaction"><span class="hs-identifier hs-var hs-var">signTransaction</span></a></span></span><span> </span><span id="local-6989586621682462376"><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462376"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621682462375"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462375"><span class="hs-identifier hs-var">preferredLatestEra</span></a></span></span><span> </span><span id="local-6989586621682462374"><span class="annot"><span class="annottext">Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462374"><span class="hs-identifier hs-var">keyLookup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462373"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682462373"><span class="hs-identifier hs-var">rootKey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462372"><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462372"><span class="hs-identifier hs-var">rootPwd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682462371"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682462371"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2355"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2356"></span><span>        </span><span class="annot"><a href="#local-6989586621682462370"><span class="hs-identifier hs-type">rewardAcnt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2357"></span><span>        </span><span id="local-6989586621682462370"><span class="annot"><span class="annottext">rewardAcnt :: (XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462370"><span class="hs-identifier hs-var hs-var">rewardAcnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2358"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'AddressK XPrv -&gt; XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'AddressK XPrv -&gt; XPrv) -&gt; k 'AddressK XPrv -&gt; XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv -&gt; k 'AddressK XPrv
forall (k :: Depth -&gt; * -&gt; *).
(HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK)) =&gt;
Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv -&gt; k 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveRewardAccount"><span class="hs-identifier hs-var">deriveRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462372"><span class="hs-identifier hs-var">rootPwd</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682462373"><span class="hs-identifier hs-var">rootKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462372"><span class="hs-identifier hs-var">rootPwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2359"></span><span>
</span><span id="line-2360"></span><span>        </span><span class="annot"><a href="#local-6989586621682462369"><span class="hs-identifier hs-type">policyKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2361"></span><span>        </span><span id="local-6989586621682462369"><span class="annot"><span class="annottext">policyKey :: (KeyHash, XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462369"><span class="hs-identifier hs-var hs-var">policyKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2362"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">KeyRole -&gt; k Any XPub -&gt; KeyHash
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
KeyRole -&gt; key depth XPub -&gt; KeyHash
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hashVerificationKey"><span class="hs-identifier hs-var">hashVerificationKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462377"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">KeyRole
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">CA.Policy</span></a></span><span> </span><span class="annot"><span class="annottext">(k Any XPub -&gt; KeyHash) -&gt; k Any XPub -&gt; KeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; k Any XPub
forall (key :: Depth -&gt; * -&gt; *) raw (depth :: Depth).
WalletKey key =&gt;
raw -&gt; key depth raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftRawKey"><span class="hs-identifier hs-var">liftRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; k Any XPub) -&gt; XPub -&gt; k Any XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682462366"><span class="hs-identifier hs-var">xprv</span></a></span><span>
</span><span id="line-2363"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682462366"><span class="hs-identifier hs-var">xprv</span></a></span><span>
</span><span id="line-2364"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462372"><span class="hs-identifier hs-var">rootPwd</span></a></span><span>
</span><span id="line-2365"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-2366"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2367"></span><span>            </span><span id="local-6989586621682462366"><span class="annot"><span class="annottext">xprv :: XPrv
</span><a href="#local-6989586621682462366"><span class="hs-identifier hs-var hs-var">xprv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot; -&gt; XPrv -&gt; Index 'Hardened 'PolicyK -&gt; XPrv
forall (purpose :: Symbol).
Passphrase purpose -&gt; XPrv -&gt; Index 'Hardened 'PolicyK -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#derivePolicyPrivateKey"><span class="hs-identifier hs-var">derivePolicyPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462372"><span class="hs-identifier hs-var">rootPwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv -&gt; XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682462373"><span class="hs-identifier hs-var">rootKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PolicyK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span>
</span><span id="line-2368"></span><span>
</span><span id="line-2369"></span><span>        </span><span class="annot"><a href="#local-6989586621682462364"><span class="hs-identifier hs-type">inputResolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2370"></span><span>        </span><span id="local-6989586621682462364"><span class="annot"><span class="annottext">inputResolver :: TxIn -&gt; Maybe Address
</span><a href="#local-6989586621682462364"><span class="hs-identifier hs-var hs-var">inputResolver</span></a></span></span><span> </span><span id="local-6989586621682462363"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462363"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2371"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682462362"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462362"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; UTxO -&gt; Maybe TxOut
</span><a href="Cardano.Wallet.Primitive.Types.UTxO.html#lookup"><span class="hs-identifier hs-var">UTxO.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682462363"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682462371"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-2372"></span><span>            </span><span class="annot"><span class="annottext">Address -&gt; Maybe Address
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462362"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-2373"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-2374"></span><span>        </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; (XPrv, Passphrase &quot;encryption&quot;)
-&gt; (KeyHash, XPrv, Passphrase &quot;encryption&quot;)
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (TxIn -&gt; Maybe Address)
-&gt; SealedTx
-&gt; SealedTx
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; (XPrv, Passphrase &quot;encryption&quot;)
-&gt; (KeyHash, XPrv, Passphrase &quot;encryption&quot;)
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (TxIn -&gt; Maybe Address)
-&gt; tx
-&gt; tx
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AaddVkWitnesses%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">addVkWitnesses</span></a></span><span>
</span><span id="line-2375"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462376"><span class="hs-identifier hs-var">tl</span></a></span><span>
</span><span id="line-2376"></span><span>            </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462375"><span class="hs-identifier hs-var">preferredLatestEra</span></a></span><span>
</span><span id="line-2377"></span><span>            </span><span class="annot"><span class="annottext">(XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462370"><span class="hs-identifier hs-var">rewardAcnt</span></a></span><span>
</span><span id="line-2378"></span><span>            </span><span class="annot"><span class="annottext">(KeyHash, XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462369"><span class="hs-identifier hs-var">policyKey</span></a></span><span>
</span><span id="line-2379"></span><span>            </span><span class="annot"><span class="annottext">Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462374"><span class="hs-identifier hs-var">keyLookup</span></a></span><span>
</span><span id="line-2380"></span><span>            </span><span class="annot"><span class="annottext">TxIn -&gt; Maybe Address
</span><a href="#local-6989586621682462364"><span class="hs-identifier hs-var">inputResolver</span></a></span><span>
</span><span id="line-2381"></span><span>
</span><span id="line-2382"></span><span class="hs-comment">-- | Produce witnesses and construct a transaction from a given selection.</span><span>
</span><span id="line-2383"></span><span class="hs-comment">--</span><span>
</span><span id="line-2384"></span><span class="hs-comment">-- Requires the encryption passphrase in order to decrypt the root private key.</span><span>
</span><span id="line-2385"></span><span class="hs-comment">-- Note that this doesn't broadcast the transaction to the network. In order to</span><span>
</span><span id="line-2386"></span><span class="hs-comment">-- do so, use 'submitTx'.</span><span>
</span><span id="line-2387"></span><span class="hs-comment">--</span><span>
</span><span id="line-2388"></span><span class="annot"><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier hs-type">buildAndSignTransaction</span></a></span><span>
</span><span id="line-2389"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462360"><span class="annot"><a href="#local-6989586621682462360"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462359"><span class="annot"><a href="#local-6989586621682462359"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462358"><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2390"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462360"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2391"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462359"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462360"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2392"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462360"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2393"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462359"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2394"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2395"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462360"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2396"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2397"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2398"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2399"></span><span>         </span><span class="hs-special">(</span><span>         </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2400"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-2401"></span><span>       </span><span class="hs-comment">-- ^ Reward account derived from the root key (or somewhere else).</span><span>
</span><span id="line-2402"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-2403"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2404"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2405"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPayment"><span class="hs-identifier hs-type">ErrSignPayment</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2406"></span><span id="buildAndSignTransaction"><span class="annot"><span class="annottext">buildAndSignTransaction :: ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; ((k 'RootK XPrv, Passphrase &quot;encryption&quot;)
    -&gt; (XPrv, Passphrase &quot;encryption&quot;))
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
</span><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier hs-var hs-var">buildAndSignTransaction</span></a></span></span><span> </span><span id="local-6989586621682462357"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462357"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462356"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462356"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462355"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462355"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682462354"><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; (XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462354"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span></span><span> </span><span id="local-6989586621682462353"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682462353"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span id="local-6989586621682462352"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462352"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span> </span><span id="local-6989586621682462351"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462351"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462350"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462324"><span id="local-6989586621682462325"><span id="local-6989586621682462326"><span id="local-6989586621682462327"><span id="local-6989586621682462328"><span id="local-6989586621682462329"><span id="local-6989586621682462330"><span id="local-6989586621682462331"><span id="local-6989586621682462332"><span id="local-6989586621682462333"><span id="local-6989586621682462334"><span id="local-6989586621682462335"><span id="local-6989586621682462336"><span id="local-6989586621682462337"><span id="local-6989586621682462338"><span id="local-6989586621682462339"><span id="local-6989586621682462340"><span id="local-6989586621682462341"><span id="local-6989586621682462342"><span id="local-6989586621682462343"><span id="local-6989586621682462344"><span id="local-6989586621682462345"><span id="local-6989586621682462346"><span id="local-6989586621682462347"><span id="local-6989586621682462348"><span id="local-6989586621682462349"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462324"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2407"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrSignPayment)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462359"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462357"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462356"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682462353"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrSignPayment
</span><a href="Cardano.Wallet.html#ErrSignPaymentWithRootKey"><span class="hs-identifier hs-var">ErrSignPaymentWithRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme
  -&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx))
 -&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx))
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682462322"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682462322"><span class="hs-identifier hs-var">xprv</span></a></span></span><span> </span><span id="local-6989586621682462321"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682462321"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2408"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462320"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462320"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682462321"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682462353"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-2409"></span><span>        </span><span class="annot"><span class="annottext">(stm (Either ErrSignPayment (Tx, TxMeta, UTCTime, SealedTx))
 -&gt; IO (Either ErrSignPayment (Tx, TxMeta, UTCTime, SealedTx)))
-&gt; ExceptT ErrSignPayment stm (Tx, TxMeta, UTCTime, SealedTx)
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrSignPayment (Tx, TxMeta, UTCTime, SealedTx))
-&gt; IO (Either ErrSignPayment (Tx, TxMeta, UTCTime, SealedTx))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462324"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment stm (Tx, TxMeta, UTCTime, SealedTx)
 -&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment stm (Tx, TxMeta, UTCTime, SealedTx)
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2410"></span><span>            </span><span id="local-6989586621682462319"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462319"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrSignPayment)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrSignPayment stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSignPayment
</span><a href="Cardano.Wallet.html#ErrSignPaymentNoSuchWallet"><span class="hs-identifier hs-var">ErrSignPaymentNoSuchWallet</span></a></span><span>
</span><span id="line-2411"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrSignPayment stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrSignPayment stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462356"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2412"></span><span>                </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682462344"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462356"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2413"></span><span>            </span><span id="local-6989586621682462318"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462318"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters
-&gt; ExceptT ErrSignPayment stm ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters
 -&gt; ExceptT ErrSignPayment stm ProtocolParameters)
-&gt; IO ProtocolParameters
-&gt; ExceptT ErrSignPayment stm ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462317"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2414"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462316"><span class="annot"><span class="annottext">keyFrom :: Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462316"><span class="hs-identifier hs-var hs-var">keyFrom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Address
-&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
forall s (key :: Depth -&gt; * -&gt; *).
IsOwned s key =&gt;
s
-&gt; (key 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Address
-&gt; Maybe (key 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOwned"><span class="hs-identifier hs-var">isOwned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462319"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682462322"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462320"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2415"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462314"><span class="annot"><span class="annottext">rewardAcnt :: (XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462314"><span class="hs-identifier hs-var hs-var">rewardAcnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; (XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462354"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682462322"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682462320"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2416"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682462313"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462313"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462312"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462312"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrMkTransaction -&gt; ErrSignPayment)
-&gt; ExceptT ErrMkTransaction stm (Tx, SealedTx)
-&gt; ExceptT ErrSignPayment stm (Tx, SealedTx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction -&gt; ErrSignPayment
</span><a href="Cardano.Wallet.html#ErrSignPaymentMkTx"><span class="hs-identifier hs-var">ErrSignPaymentMkTx</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrMkTransaction stm (Tx, SealedTx)
 -&gt; ExceptT ErrSignPayment stm (Tx, SealedTx))
-&gt; ExceptT ErrMkTransaction stm (Tx, SealedTx)
-&gt; ExceptT ErrSignPayment stm (Tx, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrMkTransaction (Tx, SealedTx))
-&gt; ExceptT ErrMkTransaction stm (Tx, SealedTx)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrMkTransaction (Tx, SealedTx))
 -&gt; ExceptT ErrMkTransaction stm (Tx, SealedTx))
-&gt; stm (Either ErrMkTransaction (Tx, SealedTx))
-&gt; ExceptT ErrMkTransaction stm (Tx, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrMkTransaction (Tx, SealedTx)
-&gt; stm (Either ErrMkTransaction (Tx, SealedTx))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrMkTransaction (Tx, SealedTx)
 -&gt; stm (Either ErrMkTransaction (Tx, SealedTx)))
-&gt; Either ErrMkTransaction (Tx, SealedTx)
-&gt; stm (Either ErrMkTransaction (Tx, SealedTx))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2417"></span><span>                </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; (XPrv, Passphrase &quot;encryption&quot;)
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; Either ErrMkTransaction (Tx, SealedTx)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; (XPrv, Passphrase &quot;encryption&quot;)
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; Either ErrMkTransaction (Tx, tx)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AmkTransaction%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">mkTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462309"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462355"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462314"><span class="hs-identifier hs-var">rewardAcnt</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682462316"><span class="hs-identifier hs-var">keyFrom</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462318"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462352"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462351"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2418"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682462308"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682462308"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462307"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682462307"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (UTCTime, TxMeta)
-&gt; ExceptT ErrSignPayment stm (UTCTime, TxMeta)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (UTCTime, TxMeta)
 -&gt; ExceptT ErrSignPayment stm (UTCTime, TxMeta))
-&gt; IO (UTCTime, TxMeta)
-&gt; ExceptT ErrSignPayment stm (UTCTime, TxMeta)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2419"></span><span>                </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; BlockHeader
-&gt; s
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; IO (UTCTime, TxMeta)
forall s.
IsOurs s Address =&gt;
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; BlockHeader
-&gt; s
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; IO (UTCTime, TxMeta)
</span><a href="Cardano.Wallet.html#mkTxMeta"><span class="hs-identifier hs-var">mkTxMeta</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462305"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462319"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462319"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462352"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462351"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2420"></span><span>            </span><span class="annot"><span class="annottext">(Tx, TxMeta, UTCTime, SealedTx)
-&gt; ExceptT ErrSignPayment stm (Tx, TxMeta, UTCTime, SealedTx)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462313"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682462307"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682462308"><span class="hs-identifier hs-var">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462312"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2421"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2422"></span><span>    </span><span id="local-6989586621682462350"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462350"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462357"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462359"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2423"></span><span>    </span><span id="local-6989586621682462309"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462309"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462357"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462358"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2424"></span><span>    </span><span id="local-6989586621682462317"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682462317"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462357"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2425"></span><span>    </span><span id="local-6989586621682462305"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462305"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462317"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2426"></span><span>
</span><span id="line-2427"></span><span>
</span><span id="line-2428"></span><span class="hs-comment">-- | Construct an unsigned transaction from a given selection.</span><span>
</span><span id="line-2429"></span><span class="annot"><a href="Cardano.Wallet.html#constructTransaction"><span class="hs-identifier hs-type">constructTransaction</span></a></span><span>
</span><span id="line-2430"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462303"><span class="annot"><a href="#local-6989586621682462303"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462302"><span class="annot"><a href="#local-6989586621682462302"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462301"><span class="annot"><a href="#local-6989586621682462301"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462300"><span class="annot"><a href="#local-6989586621682462300"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-2431"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462301"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462303"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2432"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462302"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462301"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462303"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2433"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462303"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2434"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462302"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2435"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462300"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2436"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2437"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462303"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2438"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2439"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2440"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2441"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2442"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier hs-type">ErrConstructTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-2443"></span><span id="constructTransaction"><span class="annot"><span class="annottext">constructTransaction :: ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrConstructTx IO SealedTx
</span><a href="Cardano.Wallet.html#constructTransaction"><span class="hs-identifier hs-var hs-var">constructTransaction</span></a></span></span><span> </span><span id="local-6989586621682462299"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462299"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462298"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462298"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462297"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462297"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682462296"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462296"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span> </span><span id="local-6989586621682462295"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462295"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462294"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrConstructTx IO SealedTx)
-&gt; ExceptT ErrConstructTx IO SealedTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462268"><span id="local-6989586621682462269"><span id="local-6989586621682462270"><span id="local-6989586621682462271"><span id="local-6989586621682462272"><span id="local-6989586621682462273"><span id="local-6989586621682462274"><span id="local-6989586621682462275"><span id="local-6989586621682462276"><span id="local-6989586621682462277"><span id="local-6989586621682462278"><span id="local-6989586621682462279"><span id="local-6989586621682462280"><span id="local-6989586621682462281"><span id="local-6989586621682462282"><span id="local-6989586621682462283"><span id="local-6989586621682462284"><span id="local-6989586621682462285"><span id="local-6989586621682462286"><span id="local-6989586621682462287"><span id="local-6989586621682462288"><span id="local-6989586621682462289"><span id="local-6989586621682462290"><span id="local-6989586621682462291"><span id="local-6989586621682462292"><span id="local-6989586621682462293"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462268"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2444"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462267"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682462267"><span class="hs-identifier hs-var">xpub</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrReadRewardAccount -&gt; ErrConstructTx)
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrConstructTx IO (RewardAccount, XPub, NonEmpty DerivationIndex)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxReadRewardAccount"><span class="hs-identifier hs-var">ErrConstructTxReadRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; ExceptT
      ErrConstructTx IO (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrConstructTx IO (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2445"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462303"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462302"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462301"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462300"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462299"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462298"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2446"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrConstructTx SealedTx)
 -&gt; IO (Either ErrConstructTx SealedTx))
-&gt; ExceptT ErrConstructTx stm SealedTx
-&gt; ExceptT ErrConstructTx IO SealedTx
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrConstructTx SealedTx)
-&gt; IO (Either ErrConstructTx SealedTx)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462268"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx stm SealedTx
 -&gt; ExceptT ErrConstructTx IO SealedTx)
-&gt; ExceptT ErrConstructTx stm SealedTx
-&gt; ExceptT ErrConstructTx IO SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2447"></span><span>        </span><span id="local-6989586621682462265"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462265"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters
-&gt; ExceptT ErrConstructTx stm ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters
 -&gt; ExceptT ErrConstructTx stm ProtocolParameters)
-&gt; IO ProtocolParameters
-&gt; ExceptT ErrConstructTx stm ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462264"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2448"></span><span>        </span><span class="annot"><span class="annottext">(ErrMkTransaction -&gt; ErrConstructTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
-&gt; ExceptT ErrConstructTx stm SealedTx
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxBody"><span class="hs-identifier hs-var">ErrConstructTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrMkTransaction stm SealedTx
 -&gt; ExceptT ErrConstructTx stm SealedTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
-&gt; ExceptT ErrConstructTx stm SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrMkTransaction SealedTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrMkTransaction SealedTx)
 -&gt; ExceptT ErrMkTransaction stm SealedTx)
-&gt; stm (Either ErrMkTransaction SealedTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrMkTransaction SealedTx
-&gt; stm (Either ErrMkTransaction SealedTx)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrMkTransaction SealedTx
 -&gt; stm (Either ErrMkTransaction SealedTx))
-&gt; Either ErrMkTransaction SealedTx
-&gt; stm (Either ErrMkTransaction SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2449"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; XPub
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; Either ErrMkTransaction SealedTx
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; XPub
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; Either ErrMkTransaction tx
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AmkUnsignedTransaction%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">mkUnsignedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462261"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462297"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682462267"><span class="hs-identifier hs-var">xpub</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462265"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462296"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462295"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2450"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2451"></span><span>    </span><span id="local-6989586621682462294"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462294"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462299"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462302"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462301"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2452"></span><span>    </span><span id="local-6989586621682462261"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462261"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462299"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462301"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2453"></span><span>    </span><span id="local-6989586621682462264"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682462264"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462299"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2454"></span><span>
</span><span id="line-2455"></span><span class="hs-comment">-- | Construct an unsigned transaction from a given selection</span><span>
</span><span id="line-2456"></span><span class="hs-comment">-- for a shared wallet.</span><span>
</span><span id="line-2457"></span><span class="annot"><a href="Cardano.Wallet.html#constructSharedTransaction"><span class="hs-identifier hs-type">constructSharedTransaction</span></a></span><span>
</span><span id="line-2458"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462260"><span class="annot"><a href="#local-6989586621682462260"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462259"><span class="annot"><a href="#local-6989586621682462259"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462258"><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462257"><span class="annot"><a href="#local-6989586621682462257"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-2459"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462260"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2460"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462260"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2461"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462260"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2462"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-2463"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682462259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462257"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2464"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462260"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2466"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2467"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2468"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2469"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2470"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier hs-type">ErrConstructTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-2471"></span><span id="constructSharedTransaction"><span class="annot"><span class="annottext">constructSharedTransaction :: ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrConstructTx IO SealedTx
</span><a href="Cardano.Wallet.html#constructSharedTransaction"><span class="hs-identifier hs-var hs-var">constructSharedTransaction</span></a></span></span><span> </span><span id="local-6989586621682462256"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462256"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462255"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462255"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462254"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462254"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682462253"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462253"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span> </span><span id="local-6989586621682462252"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462252"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462251"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrConstructTx IO SealedTx)
-&gt; ExceptT ErrConstructTx IO SealedTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462225"><span id="local-6989586621682462226"><span id="local-6989586621682462227"><span id="local-6989586621682462228"><span id="local-6989586621682462229"><span id="local-6989586621682462230"><span id="local-6989586621682462231"><span id="local-6989586621682462232"><span id="local-6989586621682462233"><span id="local-6989586621682462234"><span id="local-6989586621682462235"><span id="local-6989586621682462236"><span id="local-6989586621682462237"><span id="local-6989586621682462238"><span id="local-6989586621682462239"><span id="local-6989586621682462240"><span id="local-6989586621682462241"><span id="local-6989586621682462242"><span id="local-6989586621682462243"><span id="local-6989586621682462244"><span id="local-6989586621682462245"><span id="local-6989586621682462246"><span id="local-6989586621682462247"><span id="local-6989586621682462248"><span id="local-6989586621682462249"><span id="local-6989586621682462250"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462225"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2472"></span><span>    </span><span id="local-6989586621682462224"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462224"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrConstructTx)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
-&gt; ExceptT ErrConstructTx IO (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxNoSuchWallet"><span class="hs-identifier hs-var">ErrConstructTxNoSuchWallet</span></a></span><span>
</span><span id="line-2473"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s)
 -&gt; ExceptT ErrConstructTx IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
-&gt; ExceptT ErrConstructTx IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s))
-&gt; IO (Either ErrNoSuchWallet (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462225"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-2474"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462255"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2475"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682462245"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462255"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2476"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462223"><span class="annot"><span class="annottext">s :: s
</span><a href="#local-6989586621682462223"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462224"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-2477"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462222"><span class="annot"><span class="annottext">accXPub :: XPub
</span><a href="#local-6989586621682462222"><span class="hs-identifier hs-var hs-var">accXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedKey 'AccountK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(SharedKey 'AccountK XPub -&gt; XPub)
-&gt; SharedKey 'AccountK XPub -&gt; XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n SharedKey -&gt; SharedKey 'AccountK XPub
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; k 'AccountK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#accountXPub"><span class="hs-identifier hs-var hs-var">Shared.accountXPub</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n SharedKey
</span><a href="#local-6989586621682462223"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2478"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462220"><span class="annot"><span class="annottext">xpub :: XPub
</span><a href="#local-6989586621682462220"><span class="hs-identifier hs-var hs-var">xpub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shared 'ScriptK XPub -&gt; XPub
forall (depth :: Depth) key. Shared depth key -&gt; key
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var hs-var">CA.getKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Shared 'ScriptK XPub -&gt; XPub) -&gt; Shared 'ScriptK XPub -&gt; XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2479"></span><span>            </span><span class="annot"><span class="annottext">Shared 'AccountK XPub
-&gt; Index 'Soft 'PaymentK -&gt; Shared 'ScriptK XPub
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">deriveDelegationPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; Shared 'AccountK XPub
forall (depth :: Depth). XPub -&gt; Shared depth XPub
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">CA.liftXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682462222"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'PaymentK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span>
</span><span id="line-2480"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrConstructTx SealedTx)
 -&gt; IO (Either ErrConstructTx SealedTx))
-&gt; ExceptT ErrConstructTx stm SealedTx
-&gt; ExceptT ErrConstructTx IO SealedTx
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrConstructTx SealedTx)
-&gt; IO (Either ErrConstructTx SealedTx)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462225"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx stm SealedTx
 -&gt; ExceptT ErrConstructTx IO SealedTx)
-&gt; ExceptT ErrConstructTx stm SealedTx
-&gt; ExceptT ErrConstructTx IO SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2481"></span><span>        </span><span id="local-6989586621682462217"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462217"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters
-&gt; ExceptT ErrConstructTx stm ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters
 -&gt; ExceptT ErrConstructTx stm ProtocolParameters)
-&gt; IO ProtocolParameters
-&gt; ExceptT ErrConstructTx stm ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462216"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2482"></span><span>        </span><span class="annot"><span class="annottext">(ErrMkTransaction -&gt; ErrConstructTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
-&gt; ExceptT ErrConstructTx stm SealedTx
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxBody"><span class="hs-identifier hs-var">ErrConstructTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrMkTransaction stm SealedTx
 -&gt; ExceptT ErrConstructTx stm SealedTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
-&gt; ExceptT ErrConstructTx stm SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrMkTransaction SealedTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrMkTransaction SealedTx)
 -&gt; ExceptT ErrMkTransaction stm SealedTx)
-&gt; stm (Either ErrMkTransaction SealedTx)
-&gt; ExceptT ErrMkTransaction stm SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrMkTransaction SealedTx
-&gt; stm (Either ErrMkTransaction SealedTx)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrMkTransaction SealedTx
 -&gt; stm (Either ErrMkTransaction SealedTx))
-&gt; Either ErrMkTransaction SealedTx
-&gt; stm (Either ErrMkTransaction SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2483"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; XPub
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; Either ErrMkTransaction SealedTx
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; XPub
-&gt; ProtocolParameters
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; Either ErrMkTransaction tx
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AmkUnsignedTransaction%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">mkUnsignedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462215"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462254"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682462220"><span class="hs-identifier hs-var">xpub</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682462217"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462253"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462252"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2484"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2485"></span><span>    </span><span id="local-6989586621682462251"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462251"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462256"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2486"></span><span>    </span><span id="local-6989586621682462215"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462215"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462256"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462258"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2487"></span><span>    </span><span id="local-6989586621682462216"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682462216"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462256"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2488"></span><span>
</span><span id="line-2489"></span><span class="hs-comment">-- | Calculate the transaction expiry slot, given a 'TimeInterpreter', and an</span><span>
</span><span id="line-2490"></span><span class="hs-comment">-- optional TTL in seconds.</span><span>
</span><span id="line-2491"></span><span class="hs-comment">--</span><span>
</span><span id="line-2492"></span><span class="hs-comment">-- If no TTL is provided, a default of 2 hours is used (note: there is no</span><span>
</span><span id="line-2493"></span><span class="hs-comment">-- particular reason why we chose that duration).</span><span>
</span><span id="line-2494"></span><span class="annot"><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-type">getTxExpiry</span></a></span><span>
</span><span id="line-2495"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2496"></span><span>    </span><span class="hs-comment">-- ^ Context for time to slot calculation.</span><span>
</span><span id="line-2497"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span>
</span><span id="line-2498"></span><span>    </span><span class="hs-comment">-- ^ Time to live (TTL) in seconds from now.</span><span>
</span><span id="line-2499"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-2500"></span><span id="getTxExpiry"><span class="annot"><span class="annottext">getTxExpiry :: TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var hs-var">getTxExpiry</span></a></span></span><span> </span><span id="local-6989586621682462214"><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462214"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682462213"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621682462213"><span class="hs-identifier hs-var">maybeTTL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2501"></span><span>    </span><span id="local-6989586621682462212"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682462212"><span class="hs-identifier hs-var">expTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; RelativeTime -&gt; RelativeTime
</span><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-var">addRelTime</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682462211"><span class="hs-identifier hs-var">ttl</span></a></span><span> </span><span class="annot"><span class="annottext">(RelativeTime -&gt; RelativeTime)
-&gt; IO RelativeTime -&gt; IO RelativeTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; IO RelativeTime
forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
TimeInterpreter n -&gt; m RelativeTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#currentRelativeTime"><span class="hs-identifier hs-var">currentRelativeTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var">unsafeExtendSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462214"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2502"></span><span>    </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Qry SlotNo -&gt; IO SlotNo
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var">unsafeExtendSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462214"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Qry SlotNo -&gt; IO SlotNo) -&gt; Qry SlotNo -&gt; IO SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; Qry SlotNo
</span><a href="Cardano.Wallet.Primitive.Slotting.html#ceilingSlotAt"><span class="hs-identifier hs-var">ceilingSlotAt</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682462212"><span class="hs-identifier hs-var">expTime</span></a></span><span>
</span><span id="line-2503"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2504"></span><span>    </span><span id="local-6989586621682462211"><span class="annot"><span class="annottext">ttl :: NominalDiffTime
</span><a href="#local-6989586621682462211"><span class="hs-identifier hs-var hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Maybe NominalDiffTime -&gt; NominalDiffTime
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682462210"><span class="hs-identifier hs-var">defaultTTL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621682462213"><span class="hs-identifier hs-var">maybeTTL</span></a></span><span>
</span><span id="line-2505"></span><span>
</span><span id="line-2506"></span><span>    </span><span class="annot"><a href="#local-6989586621682462210"><span class="hs-identifier hs-type">defaultTTL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span>
</span><span id="line-2507"></span><span>    </span><span id="local-6989586621682462210"><span class="annot"><span class="annottext">defaultTTL :: NominalDiffTime
</span><a href="#local-6989586621682462210"><span class="hs-identifier hs-var hs-var">defaultTTL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">7200</span></span><span>  </span><span class="hs-comment">-- that's 2 hours</span><span>
</span><span id="line-2508"></span><span>
</span><span id="line-2509"></span><span class="annot"><a href="Cardano.Wallet.html#constructTxMeta"><span class="hs-identifier hs-type">constructTxMeta</span></a></span><span>
</span><span id="line-2510"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462209"><span class="annot"><a href="#local-6989586621682462209"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462208"><span class="annot"><a href="#local-6989586621682462208"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462207"><span class="annot"><a href="#local-6989586621682462207"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2511"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462208"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462207"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462209"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2512"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2513"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462209"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2514"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2515"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2516"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2517"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2518"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransaction"><span class="hs-identifier hs-type">ErrSubmitTransaction</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span>
</span><span id="line-2519"></span><span id="constructTxMeta"><span class="annot"><span class="annottext">constructTxMeta :: ctx
-&gt; WalletId
-&gt; TransactionCtx
-&gt; [(TxIn, Coin)]
-&gt; [TxOut]
-&gt; ExceptT ErrSubmitTransaction IO TxMeta
</span><a href="Cardano.Wallet.html#constructTxMeta"><span class="hs-identifier hs-var hs-var">constructTxMeta</span></a></span></span><span> </span><span id="local-6989586621682462206"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462206"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462205"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462205"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462204"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462204"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span> </span><span id="local-6989586621682462203"><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682462203"><span class="hs-identifier hs-var">inps</span></a></span></span><span> </span><span id="local-6989586621682462202"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462202"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462201"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrSubmitTransaction IO TxMeta)
-&gt; ExceptT ErrSubmitTransaction IO TxMeta
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462175"><span id="local-6989586621682462176"><span id="local-6989586621682462177"><span id="local-6989586621682462178"><span id="local-6989586621682462179"><span id="local-6989586621682462180"><span id="local-6989586621682462181"><span id="local-6989586621682462182"><span id="local-6989586621682462183"><span id="local-6989586621682462184"><span id="local-6989586621682462185"><span id="local-6989586621682462186"><span id="local-6989586621682462187"><span id="local-6989586621682462188"><span id="local-6989586621682462189"><span id="local-6989586621682462190"><span id="local-6989586621682462191"><span id="local-6989586621682462192"><span id="local-6989586621682462193"><span id="local-6989586621682462194"><span id="local-6989586621682462195"><span id="local-6989586621682462196"><span id="local-6989586621682462197"><span id="local-6989586621682462198"><span id="local-6989586621682462199"><span id="local-6989586621682462200"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462175"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2520"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrSubmitTransaction TxMeta)
 -&gt; IO (Either ErrSubmitTransaction TxMeta))
-&gt; ExceptT ErrSubmitTransaction stm TxMeta
-&gt; ExceptT ErrSubmitTransaction IO TxMeta
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrSubmitTransaction TxMeta)
-&gt; IO (Either ErrSubmitTransaction TxMeta)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462175"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTransaction stm TxMeta
 -&gt; ExceptT ErrSubmitTransaction IO TxMeta)
-&gt; ExceptT ErrSubmitTransaction stm TxMeta
-&gt; ExceptT ErrSubmitTransaction IO TxMeta
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2521"></span><span>        </span><span id="local-6989586621682462174"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462174"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrSubmitTransaction)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrSubmitTransaction stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSubmitTransaction
</span><a href="Cardano.Wallet.html#ErrSubmitTransactionNoSuchWallet"><span class="hs-identifier hs-var">ErrSubmitTransactionNoSuchWallet</span></a></span><span>
</span><span id="line-2522"></span><span>              </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrSubmitTransaction stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrSubmitTransaction stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462205"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2523"></span><span>              </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682462195"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462205"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2524"></span><span>        </span><span class="annot"><span class="annottext">IO TxMeta -&gt; ExceptT ErrSubmitTransaction stm TxMeta
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO TxMeta -&gt; ExceptT ErrSubmitTransaction stm TxMeta)
-&gt; IO TxMeta -&gt; ExceptT ErrSubmitTransaction stm TxMeta
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2525"></span><span>            </span><span class="annot"><span class="annottext">BlockHeader
-&gt; TransactionCtx -&gt; [(TxIn, Coin)] -&gt; [TxOut] -&gt; IO TxMeta
</span><a href="Cardano.Wallet.html#mkTxMetaWithoutSel"><span class="hs-identifier hs-var">mkTxMetaWithoutSel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682462174"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462204"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682462203"><span class="hs-identifier hs-var">inps</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462202"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2526"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2527"></span><span>    </span><span id="local-6989586621682462201"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462201"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462206"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462208"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462207"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2528"></span><span>
</span><span id="line-2529"></span><span class="annot"><a href="Cardano.Wallet.html#mkTxMetaWithoutSel"><span class="hs-identifier hs-type">mkTxMetaWithoutSel</span></a></span><span>
</span><span id="line-2530"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-2531"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2532"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2533"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2534"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span>
</span><span id="line-2535"></span><span id="mkTxMetaWithoutSel"><span class="annot"><span class="annottext">mkTxMetaWithoutSel :: BlockHeader
-&gt; TransactionCtx -&gt; [(TxIn, Coin)] -&gt; [TxOut] -&gt; IO TxMeta
</span><a href="Cardano.Wallet.html#mkTxMetaWithoutSel"><span class="hs-identifier hs-var hs-var">mkTxMetaWithoutSel</span></a></span></span><span> </span><span id="local-6989586621682462171"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462171"><span class="hs-identifier hs-var">blockHeader</span></a></span></span><span> </span><span id="local-6989586621682462170"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462170"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span> </span><span id="local-6989586621682462169"><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682462169"><span class="hs-identifier hs-var">inps</span></a></span></span><span> </span><span id="local-6989586621682462168"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462168"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2536"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2537"></span><span>        </span><span id="local-6989586621682462167"><span class="annot"><span class="annottext">amtOuts :: Coin
</span><a href="#local-6989586621682462167"><span class="hs-identifier hs-var hs-var">amtOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.fold</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; Coin) -&gt; [Coin] -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Coin) -&gt; [TxOut] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier hs-var">txOutCoin</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682462168"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2538"></span><span>
</span><span id="line-2539"></span><span>        </span><span id="local-6989586621682462166"><span class="annot"><span class="annottext">amtInps :: Coin
</span><a href="#local-6989586621682462166"><span class="hs-identifier hs-var hs-var">amtInps</span></a></span></span><span>
</span><span id="line-2540"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxIn, Coin) -&gt; Coin) -&gt; [(TxIn, Coin)] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Coin) -&gt; Coin
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682462169"><span class="hs-identifier hs-var">inps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2541"></span><span>            </span><span class="annot"><span class="annottext">Coin -&gt; (Coin -&gt; Coin) -&gt; Coin
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462170"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2542"></span><span>                </span><span id="local-6989586621682462165"><span class="annot"><span class="annottext">w :: Withdrawal
</span><a href="#local-6989586621682462165"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-type">WithdrawalSelf</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#add"><span class="hs-identifier hs-var">Coin.add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#withdrawalToCoin"><span class="hs-identifier hs-var">withdrawalToCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682462165"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2543"></span><span>                </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalExternal"><span class="hs-identifier hs-type">WithdrawalExternal</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-2544"></span><span>                </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-2545"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TxMeta -&gt; IO TxMeta
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TxMeta :: TxStatus
-&gt; Direction
-&gt; SlotNo
-&gt; Quantity &quot;block&quot; Word32
-&gt; Coin
-&gt; Maybe SlotNo
-&gt; TxMeta
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span>
</span><span id="line-2546"></span><span>       </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:status:TxMeta :: TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Astatus%3ATxMeta"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span>
</span><span id="line-2547"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:direction:TxMeta :: Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Adirection%3ATxMeta"><span class="hs-identifier hs-var">direction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462166"><span class="hs-identifier hs-var">amtInps</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462167"><span class="hs-identifier hs-var">amtOuts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Outgoing"><span class="hs-identifier hs-var">Outgoing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Incoming"><span class="hs-identifier hs-var">Incoming</span></a></span><span>
</span><span id="line-2548"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slotNo:TxMeta :: SlotNo
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AslotNo%3ATxMeta"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462171"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682462157"><span class="hs-var">#slotNo</span></a></span><span>
</span><span id="line-2549"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockHeight:TxMeta :: Quantity &quot;block&quot; Word32
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AblockHeight%3ATxMeta"><span class="hs-identifier hs-var">blockHeight</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462171"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
-&gt; Quantity &quot;block&quot; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
   -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
(Quantity &quot;block&quot; Word32
 -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader
</span><a href="#local-6989586621682462155"><span class="hs-var">#blockHeight</span></a></span><span>
</span><span id="line-2550"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:TxMeta :: Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aamount%3ATxMeta"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#distance"><span class="hs-identifier hs-var">Coin.distance</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462166"><span class="hs-identifier hs-var">amtInps</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462167"><span class="hs-identifier hs-var">amtOuts</span></a></span><span>
</span><span id="line-2551"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:expiry:TxMeta :: Maybe SlotNo
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aexpiry%3ATxMeta"><span class="hs-identifier hs-var">expiry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Maybe SlotNo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe SlotNo, SlotNo) -&gt; SlotNo
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe SlotNo, SlotNo) -&gt; SlotNo)
-&gt; (Maybe SlotNo, SlotNo) -&gt; SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx -&gt; (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txValidityInterval</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462170"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2552"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2553"></span><span>
</span><span id="line-2554"></span><span id="local-6989586621682464493"><span class="annot"><a href="Cardano.Wallet.html#ourCoin"><span class="hs-identifier hs-type">ourCoin</span></a></span><span>
</span><span id="line-2555"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2556"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2557"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464493"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2558"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-2559"></span><span id="ourCoin"><span class="annot"><span class="annottext">ourCoin :: TxOut -&gt; s -&gt; Maybe Coin
</span><a href="Cardano.Wallet.html#ourCoin"><span class="hs-identifier hs-var hs-var">ourCoin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682462149"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462149"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682462148"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462148"><span class="hs-identifier hs-var">tokens</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682462147"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462147"><span class="hs-identifier hs-var">wState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2560"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty DerivationIndex), s)
-&gt; Maybe (NonEmpty DerivationIndex)
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
forall s entity.
IsOurs s entity =&gt;
entity -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOurs"><span class="hs-identifier hs-var">isOurs</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682462149"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462147"><span class="hs-identifier hs-var">wState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2561"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682462148"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2562"></span><span>        </span><span class="annot"><span class="annottext">Maybe (NonEmpty DerivationIndex)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2563"></span><span>
</span><span id="line-2564"></span><span class="hs-comment">-- | Construct transaction metadata for a pending transaction from the block</span><span>
</span><span id="line-2565"></span><span class="hs-comment">-- header of the current tip and a list of input and output.</span><span>
</span><span id="line-2566"></span><span class="hs-comment">--</span><span>
</span><span id="line-2567"></span><span class="hs-comment">-- FIXME: There's a logic duplication regarding the calculation of the transaction</span><span>
</span><span id="line-2568"></span><span class="hs-comment">-- amount between right here, and the Primitive.Model (see prefilterBlocks).</span><span>
</span><span id="line-2569"></span><span id="local-6989586621682464532"><span class="annot"><a href="Cardano.Wallet.html#mkTxMeta"><span class="hs-identifier hs-type">mkTxMeta</span></a></span><span>
</span><span id="line-2570"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464532"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2571"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2572"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-2573"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464532"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2574"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-2575"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-2576"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2577"></span><span id="mkTxMeta"><span class="annot"><span class="annottext">mkTxMeta :: TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; BlockHeader
-&gt; s
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; IO (UTCTime, TxMeta)
</span><a href="Cardano.Wallet.html#mkTxMeta"><span class="hs-identifier hs-var hs-var">mkTxMeta</span></a></span></span><span> </span><span id="local-6989586621682462146"><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462146"><span class="hs-identifier hs-var">ti'</span></a></span></span><span> </span><span id="local-6989586621682462145"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462145"><span class="hs-identifier hs-var">blockHeader</span></a></span></span><span> </span><span id="local-6989586621682462144"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462144"><span class="hs-identifier hs-var">wState</span></a></span></span><span> </span><span id="local-6989586621682462143"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462143"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span> </span><span id="local-6989586621682462142"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462142"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2578"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2579"></span><span>        </span><span id="local-6989586621682462141"><span class="annot"><span class="annottext">amtOuts :: Coin
</span><a href="#local-6989586621682462141"><span class="hs-identifier hs-var hs-var">amtOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.fold</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; Coin) -&gt; [Coin] -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2580"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier hs-var">txOutCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Coin) -&gt; [TxOut] -&gt; [Coin]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxOut] -&gt; Const [TxOut] [TxOut])
 -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; [TxOut]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut)
</span><a href="#local-6989586621682462140"><span class="hs-var">#change</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462142"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2581"></span><span>            </span><span class="annot"><span class="annottext">[Coin] -&gt; [Coin] -&gt; [Coin]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2582"></span><span>            </span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe Coin) -&gt; [TxOut] -&gt; [Coin]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; s -&gt; Maybe Coin
forall s. IsOurs s Address =&gt; TxOut -&gt; s -&gt; Maybe Coin
</span><a href="Cardano.Wallet.html#ourCoin"><span class="hs-operator hs-var">`ourCoin`</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682462144"><span class="hs-identifier hs-var">wState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([TxOut] -&gt; Const [TxOut] [TxOut])
 -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; [TxOut]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut))
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; SelectionOf TxOut -&gt; Const [TxOut] (SelectionOf TxOut)
</span><a href="#local-6989586621682462139"><span class="hs-var">#outputs</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462142"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2583"></span><span>
</span><span id="line-2584"></span><span>        </span><span id="local-6989586621682462138"><span class="annot"><span class="annottext">amtInps :: Coin
</span><a href="#local-6989586621682462138"><span class="hs-identifier hs-var hs-var">amtInps</span></a></span></span><span>
</span><span id="line-2585"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Coin -&gt; Coin
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier hs-var">txOutCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Coin)
-&gt; ((TxIn, TxOut) -&gt; TxOut) -&gt; (TxIn, TxOut) -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut) -&gt; TxOut
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; Coin) -&gt; NonEmpty (TxIn, TxOut) -&gt; NonEmpty Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (TxIn, TxOut)
  -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
 -&gt; SelectionOf TxOut
 -&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut))
-&gt; SelectionOf TxOut -&gt; NonEmpty (TxIn, TxOut)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; SelectionOf TxOut
   -&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut))
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; SelectionOf TxOut
-&gt; Const (NonEmpty (TxIn, TxOut)) (SelectionOf TxOut)
</span><a href="#local-6989586621682462137"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682462142"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2586"></span><span>            </span><span class="hs-comment">-- NOTE: In case where rewards were pulled from an external</span><span>
</span><span id="line-2587"></span><span>            </span><span class="hs-comment">-- source, they aren't added to the calculation because the</span><span>
</span><span id="line-2588"></span><span>            </span><span class="hs-comment">-- money is considered to come from outside of the wallet; which</span><span>
</span><span id="line-2589"></span><span>            </span><span class="hs-comment">-- changes the way we look at transactions (in such case, a</span><span>
</span><span id="line-2590"></span><span>            </span><span class="hs-comment">-- transaction is considered 'Incoming' since it brings extra money</span><span>
</span><span id="line-2591"></span><span>            </span><span class="hs-comment">-- to the wallet from elsewhere).</span><span>
</span><span id="line-2592"></span><span>            </span><span class="annot"><span class="annottext">Coin -&gt; (Coin -&gt; Coin) -&gt; Coin
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462143"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2593"></span><span>                </span><span id="local-6989586621682462136"><span class="annot"><span class="annottext">w :: Withdrawal
</span><a href="#local-6989586621682462136"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-type">WithdrawalSelf</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#add"><span class="hs-identifier hs-var">Coin.add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#withdrawalToCoin"><span class="hs-identifier hs-var">withdrawalToCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682462136"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2594"></span><span>                </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalExternal"><span class="hs-identifier hs-type">WithdrawalExternal</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-2595"></span><span>                </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-2596"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2597"></span><span>        </span><span id="local-6989586621682462135"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682462135"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; IO UTCTime
</span><a href="#local-6989586621682462134"><span class="hs-identifier hs-var">slotStartTime'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462145"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682462133"><span class="hs-var">#slotNo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2598"></span><span>        </span><span class="annot"><span class="annottext">(UTCTime, TxMeta) -&gt; IO (UTCTime, TxMeta)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-2599"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682462135"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2600"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta :: TxStatus
-&gt; Direction
-&gt; SlotNo
-&gt; Quantity &quot;block&quot; Word32
-&gt; Coin
-&gt; Maybe SlotNo
-&gt; TxMeta
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span>
</span><span id="line-2601"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:status:TxMeta :: TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Astatus%3ATxMeta"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span>
</span><span id="line-2602"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:direction:TxMeta :: Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Adirection%3ATxMeta"><span class="hs-identifier hs-var">direction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462138"><span class="hs-identifier hs-var">amtInps</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462141"><span class="hs-identifier hs-var">amtOuts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Outgoing"><span class="hs-identifier hs-var">Outgoing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Incoming"><span class="hs-identifier hs-var">Incoming</span></a></span><span>
</span><span id="line-2603"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slotNo:TxMeta :: SlotNo
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AslotNo%3ATxMeta"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462145"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682462132"><span class="hs-var">#slotNo</span></a></span><span>
</span><span id="line-2604"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockHeight:TxMeta :: Quantity &quot;block&quot; Word32
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AblockHeight%3ATxMeta"><span class="hs-identifier hs-var">blockHeight</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682462145"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
-&gt; Quantity &quot;block&quot; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
   -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
(Quantity &quot;block&quot; Word32
 -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader
</span><a href="#local-6989586621682462131"><span class="hs-var">#blockHeight</span></a></span><span>
</span><span id="line-2605"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:TxMeta :: Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aamount%3ATxMeta"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#distance"><span class="hs-identifier hs-var">Coin.distance</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462138"><span class="hs-identifier hs-var">amtInps</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682462141"><span class="hs-identifier hs-var">amtOuts</span></a></span><span>
</span><span id="line-2606"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:expiry:TxMeta :: Maybe SlotNo
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aexpiry%3ATxMeta"><span class="hs-identifier hs-var">expiry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Maybe SlotNo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe SlotNo, SlotNo) -&gt; SlotNo
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe SlotNo, SlotNo) -&gt; SlotNo)
-&gt; (Maybe SlotNo, SlotNo) -&gt; SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx -&gt; (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txValidityInterval</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682462143"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2607"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-2608"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-2609"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2610"></span><span>    </span><span id="local-6989586621682462134"><span class="annot"><span class="annottext">slotStartTime' :: SlotNo -&gt; IO UTCTime
</span><a href="#local-6989586621682462134"><span class="hs-identifier hs-var hs-var">slotStartTime'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Qry UTCTime -&gt; IO UTCTime
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO
</span><a href="#local-6989586621682462130"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry UTCTime -&gt; IO UTCTime)
-&gt; (SlotNo -&gt; Qry UTCTime) -&gt; SlotNo -&gt; IO UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Qry UTCTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier hs-var">slotToUTCTime</span></a></span><span>
</span><span id="line-2611"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2612"></span><span>        </span><span id="local-6989586621682462130"><span class="annot"><span class="annottext">ti :: TimeInterpreter IO
</span><a href="#local-6989586621682462130"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier hs-var">neverFails</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkTxMeta slots should never be ahead of the node tip&quot;</span></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682462146"><span class="hs-identifier hs-var">ti'</span></a></span><span>
</span><span id="line-2613"></span><span>
</span><span id="line-2614"></span><span class="hs-comment">-- | Broadcast a (signed) transaction to the network.</span><span>
</span><span id="line-2615"></span><span class="annot"><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-type">submitTx</span></a></span><span>
</span><span id="line-2616"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462129"><span class="annot"><a href="#local-6989586621682462129"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462128"><span class="annot"><a href="#local-6989586621682462128"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462127"><span class="annot"><a href="#local-6989586621682462127"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2617"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462129"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2618"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462128"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462127"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462129"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2619"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462129"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2620"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2621"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462129"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2622"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2623"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2624"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTx"><span class="hs-identifier hs-type">ErrSubmitTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2625"></span><span id="submitTx"><span class="annot"><span class="annottext">submitTx :: ctx
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
</span><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-var hs-var">submitTx</span></a></span></span><span> </span><span id="local-6989586621682462126"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462126"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462125"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462125"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462124"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462124"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462123"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682462123"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462122"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462122"><span class="hs-identifier hs-var">binary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (BracketLog' (Either ErrSubmitTx ()))
-&gt; ExceptT ErrSubmitTx IO () -&gt; ExceptT ErrSubmitTx IO ()
forall (m :: * -&gt; *) e r.
MonadUnliftIO m =&gt;
Tracer m (BracketLog' (Either e r))
-&gt; ExceptT e m r -&gt; ExceptT e m r
</span><a href="Cardano.Wallet.Logging.html#traceResult"><span class="hs-identifier hs-var">traceResult</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (BracketLog' (Either ErrSubmitTx ()))
</span><a href="#local-6989586621682462121"><span class="hs-identifier hs-var">tr'</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx IO () -&gt; ExceptT ErrSubmitTx IO ())
-&gt; ExceptT ErrSubmitTx IO () -&gt; ExceptT ErrSubmitTx IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462120"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrSubmitTx IO ())
-&gt; ExceptT ErrSubmitTx IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462094"><span id="local-6989586621682462095"><span id="local-6989586621682462096"><span id="local-6989586621682462097"><span id="local-6989586621682462098"><span id="local-6989586621682462099"><span id="local-6989586621682462100"><span id="local-6989586621682462101"><span id="local-6989586621682462102"><span id="local-6989586621682462103"><span id="local-6989586621682462104"><span id="local-6989586621682462105"><span id="local-6989586621682462106"><span id="local-6989586621682462107"><span id="local-6989586621682462108"><span id="local-6989586621682462109"><span id="local-6989586621682462110"><span id="local-6989586621682462111"><span id="local-6989586621682462112"><span id="local-6989586621682462113"><span id="local-6989586621682462114"><span id="local-6989586621682462115"><span id="local-6989586621682462116"><span id="local-6989586621682462117"><span id="local-6989586621682462118"><span id="local-6989586621682462119"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462094"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2626"></span><span>    </span><span class="annot"><span class="annottext">(ErrPostTx -&gt; ErrSubmitTx)
-&gt; ExceptT ErrPostTx IO () -&gt; ExceptT ErrSubmitTx IO ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrPostTx -&gt; ErrSubmitTx
</span><a href="Cardano.Wallet.html#ErrSubmitTxNetwork"><span class="hs-identifier hs-var">ErrSubmitTxNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPostTx IO () -&gt; ExceptT ErrSubmitTx IO ())
-&gt; ExceptT ErrPostTx IO () -&gt; ExceptT ErrSubmitTx IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2627"></span><span>        </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; SealedTx -&gt; ExceptT ErrPostTx IO ()
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; SealedTx -&gt; ExceptT ErrPostTx m ()
</span><a href="Cardano.Wallet.Network.html#postTx"><span class="hs-identifier hs-var hs-var">postTx</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462091"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462122"><span class="hs-identifier hs-var">binary</span></a></span><span>
</span><span id="line-2628"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrSubmitTx ()) -&gt; IO (Either ErrSubmitTx ()))
-&gt; ExceptT ErrSubmitTx stm () -&gt; ExceptT ErrSubmitTx IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrSubmitTx ()) -&gt; IO (Either ErrSubmitTx ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462094"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx stm () -&gt; ExceptT ErrSubmitTx IO ())
-&gt; ExceptT ErrSubmitTx stm () -&gt; ExceptT ErrSubmitTx IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2629"></span><span>        </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrSubmitTx)
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrSubmitTx stm ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSubmitTx
</span><a href="Cardano.Wallet.html#ErrSubmitTxNoSuchWallet"><span class="hs-identifier hs-var">ErrSubmitTxNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrSubmitTx stm ())
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrSubmitTx stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2630"></span><span>            </span><span class="annot"><span class="annottext">WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682462106"><span class="hs-identifier hs-var">putTxHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462125"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462124"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682462123"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2631"></span><span>        </span><span class="annot"><span class="annottext">(ErrPutLocalTxSubmission -&gt; ErrSubmitTx)
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
-&gt; ExceptT ErrSubmitTx stm ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrPutLocalTxSubmission -&gt; ErrSubmitTx
</span><a href="#local-6989586621682462089"><span class="hs-identifier hs-var">handleLocalTxSubmissionErr</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPutLocalTxSubmission stm ()
 -&gt; ExceptT ErrSubmitTx stm ())
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
-&gt; ExceptT ErrSubmitTx stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2632"></span><span>            </span><span class="annot"><span class="annottext">WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
</span><a href="#local-6989586621682462103"><span class="hs-identifier hs-var">putLocalTxSubmission</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462125"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462124"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682462088"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462122"><span class="hs-identifier hs-var">binary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682462123"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">TxMeta
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; TxMeta -&gt; Const SlotNo TxMeta)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo) -&gt; TxMeta -&gt; Const SlotNo TxMeta)
(SlotNo -&gt; Const SlotNo SlotNo) -&gt; TxMeta -&gt; Const SlotNo TxMeta
</span><a href="#local-6989586621682462087"><span class="hs-var">#slotNo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2633"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2634"></span><span>    </span><span id="local-6989586621682462120"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462120"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462126"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462128"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462127"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2635"></span><span>    </span><span id="local-6989586621682462091"><span class="annot"><span class="annottext">nw :: NetworkLayer IO Block
</span><a href="#local-6989586621682462091"><span class="hs-identifier hs-var hs-var">nw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462126"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2636"></span><span>
</span><span id="line-2637"></span><span>    </span><span id="local-6989586621682462086"><span class="annot"><span class="annottext">tr :: Tracer IO WalletWorkerLog
</span><a href="#local-6989586621682462086"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462126"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer IO WalletWorkerLog
     -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx)
-&gt; Tracer IO WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO WalletWorkerLog
 -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
-&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-2638"></span><span>    </span><span id="local-6989586621682462121"><span class="annot"><span class="annottext">tr' :: Tracer IO (BracketLog' (Either ErrSubmitTx ()))
</span><a href="#local-6989586621682462121"><span class="hs-identifier hs-var hs-var">tr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BracketLog' (Either ErrSubmitTx ()) -&gt; WalletWorkerLog)
-&gt; Tracer IO WalletWorkerLog
-&gt; Tracer IO (BracketLog' (Either ErrSubmitTx ()))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; WalletWorkerLog)
-&gt; (BracketLog' (Either ErrSubmitTx ()) -&gt; WalletLog)
-&gt; BracketLog' (Either ErrSubmitTx ())
-&gt; WalletWorkerLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgTxSubmit"><span class="hs-identifier hs-var">MsgTxSubmit</span></a></span><span> </span><span class="annot"><span class="annottext">(TxSubmitLog -&gt; WalletLog)
-&gt; (BracketLog' (Either ErrSubmitTx ()) -&gt; TxSubmitLog)
-&gt; BracketLog' (Either ErrSubmitTx ())
-&gt; WalletLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; TxMeta
-&gt; SealedTx
-&gt; BracketLog' (Either ErrSubmitTx ())
-&gt; TxSubmitLog
</span><a href="Cardano.Wallet.html#MsgSubmitTx"><span class="hs-identifier hs-var">MsgSubmitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462124"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682462123"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462122"><span class="hs-identifier hs-var">binary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletWorkerLog
</span><a href="#local-6989586621682462086"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-2639"></span><span>
</span><span id="line-2640"></span><span>    </span><span id="local-6989586621682462089"><span class="annot"><span class="annottext">handleLocalTxSubmissionErr :: ErrPutLocalTxSubmission -&gt; ErrSubmitTx
</span><a href="#local-6989586621682462089"><span class="hs-identifier hs-var hs-var">handleLocalTxSubmissionErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2641"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmissionNoSuchWallet"><span class="hs-identifier hs-type">ErrPutLocalTxSubmissionNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682462082"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682462082"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSubmitTx
</span><a href="Cardano.Wallet.html#ErrSubmitTxNoSuchWallet"><span class="hs-identifier hs-var">ErrSubmitTxNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682462082"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2642"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmissionNoSuchTransaction"><span class="hs-identifier hs-type">ErrPutLocalTxSubmissionNoSuchTransaction</span></a></span><span> </span><span id="local-6989586621682462080"><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682462080"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction -&gt; ErrSubmitTx
</span><a href="Cardano.Wallet.html#ErrSubmitTxImpossible"><span class="hs-identifier hs-var">ErrSubmitTxImpossible</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682462080"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2643"></span><span>
</span><span id="line-2644"></span><span class="hs-comment">-- | Broadcast an externally-signed transaction to the network.</span><span>
</span><span id="line-2645"></span><span class="hs-comment">--</span><span>
</span><span id="line-2646"></span><span class="hs-comment">-- NOTE: external transactions will not be added to the LocalTxSubmission pool,</span><span>
</span><span id="line-2647"></span><span class="hs-comment">-- so the user must retry submission themselves.</span><span>
</span><span id="line-2648"></span><span class="annot"><a href="Cardano.Wallet.html#submitExternalTx"><span class="hs-identifier hs-type">submitExternalTx</span></a></span><span>
</span><span id="line-2649"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462078"><span class="annot"><a href="#local-6989586621682462078"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462077"><span class="annot"><a href="#local-6989586621682462077"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2650"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462078"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2651"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462077"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462078"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2652"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462078"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2653"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2654"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462078"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2655"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-2656"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier hs-type">ErrPostTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span>
</span><span id="line-2657"></span><span id="submitExternalTx"><span class="annot"><span class="annottext">submitExternalTx :: ctx -&gt; SealedTx -&gt; ExceptT ErrPostTx IO Tx
</span><a href="Cardano.Wallet.html#submitExternalTx"><span class="hs-identifier hs-var hs-var">submitExternalTx</span></a></span></span><span> </span><span id="local-6989586621682462076"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462076"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462075"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462075"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2658"></span><span>    </span><span class="hs-comment">-- FIXME: We read the current era to constrain the @sealedTx@ **twice**:</span><span>
</span><span id="line-2659"></span><span>    </span><span class="hs-comment">-- once here for decodeTx, and once in postTx before submitting.</span><span>
</span><span id="line-2660"></span><span>    </span><span id="local-6989586621682462074"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462074"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; ExceptT ErrPostTx IO AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; ExceptT ErrPostTx IO AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; ExceptT ErrPostTx IO AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462073"><span class="hs-identifier hs-var">nw</span></a></span><span>
</span><span id="line-2661"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682462072"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462072"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Certificate]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; SealedTx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; tx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AdecodeTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">decodeTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682462071"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682462074"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462075"><span class="hs-identifier hs-var">sealedTx</span></a></span><span>
</span><span id="line-2662"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682462070"><span class="annot"><span class="annottext">trPost :: Tracer IO (BracketLog' (Either ErrPostTx Tx))
</span><a href="#local-6989586621682462070"><span class="hs-identifier hs-var hs-var">trPost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BracketLog' (Either ErrPostTx Tx) -&gt; TxSubmitLog)
-&gt; Tracer IO TxSubmitLog
-&gt; Tracer IO (BracketLog' (Either ErrPostTx Tx))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; BracketLog' (Either ErrPostTx Tx) -&gt; TxSubmitLog
</span><a href="Cardano.Wallet.html#MsgSubmitExternalTx"><span class="hs-identifier hs-var">MsgSubmitExternalTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462072"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682462068"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462076"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer IO TxSubmitLog
     -&gt; Const (Tracer IO TxSubmitLog) (Tracer IO TxSubmitLog))
    -&gt; ctx -&gt; Const (Tracer IO TxSubmitLog) ctx)
-&gt; Tracer IO TxSubmitLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO TxSubmitLog
 -&gt; Const (Tracer IO TxSubmitLog) (Tracer IO TxSubmitLog))
-&gt; ctx -&gt; Const (Tracer IO TxSubmitLog) ctx
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2663"></span><span>    </span><span class="annot"><span class="annottext">Tracer IO (BracketLog' (Either ErrPostTx Tx))
-&gt; ExceptT ErrPostTx IO Tx -&gt; ExceptT ErrPostTx IO Tx
forall (m :: * -&gt; *) e r.
MonadUnliftIO m =&gt;
Tracer m (BracketLog' (Either e r))
-&gt; ExceptT e m r -&gt; ExceptT e m r
</span><a href="Cardano.Wallet.Logging.html#traceResult"><span class="hs-identifier hs-var">traceResult</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (BracketLog' (Either ErrPostTx Tx))
</span><a href="#local-6989586621682462070"><span class="hs-identifier hs-var">trPost</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPostTx IO Tx -&gt; ExceptT ErrPostTx IO Tx)
-&gt; ExceptT ErrPostTx IO Tx -&gt; ExceptT ErrPostTx IO Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2664"></span><span>        </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; SealedTx -&gt; ExceptT ErrPostTx IO ()
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; SealedTx -&gt; ExceptT ErrPostTx m ()
</span><a href="Cardano.Wallet.Network.html#postTx"><span class="hs-identifier hs-var hs-var">postTx</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682462073"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682462075"><span class="hs-identifier hs-var">sealedTx</span></a></span><span>
</span><span id="line-2665"></span><span>        </span><span class="annot"><span class="annottext">Tx -&gt; ExceptT ErrPostTx IO Tx
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682462072"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2666"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2667"></span><span>    </span><span id="local-6989586621682462071"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682462071"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462076"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462077"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2668"></span><span>    </span><span id="local-6989586621682462073"><span class="annot"><span class="annottext">nw :: NetworkLayer IO Block
</span><a href="#local-6989586621682462073"><span class="hs-identifier hs-var hs-var">nw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462076"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2669"></span><span>
</span><span id="line-2670"></span><span class="hs-comment">-- | Remove a pending or expired transaction from the transaction history. This</span><span>
</span><span id="line-2671"></span><span class="hs-comment">-- happens at the request of the user. If the transaction is already on chain,</span><span>
</span><span id="line-2672"></span><span class="hs-comment">-- or is missing from the transaction history, an error will be returned.</span><span>
</span><span id="line-2673"></span><span class="hs-comment">--</span><span>
</span><span id="line-2674"></span><span class="hs-comment">-- If a 'Pending' transaction is removed, but later appears in a block, it will</span><span>
</span><span id="line-2675"></span><span class="hs-comment">-- be added back to the transaction history.</span><span>
</span><span id="line-2676"></span><span class="annot"><a href="Cardano.Wallet.html#forgetTx"><span class="hs-identifier hs-type">forgetTx</span></a></span><span>
</span><span id="line-2677"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462067"><span class="annot"><a href="#local-6989586621682462067"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462066"><span class="annot"><a href="#local-6989586621682462066"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462065"><span class="annot"><a href="#local-6989586621682462065"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2678"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462066"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462065"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462067"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2679"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2680"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462067"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2681"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2682"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span>
</span><span id="line-2683"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier hs-type">ErrRemoveTx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2684"></span><span id="forgetTx"><span class="annot"><span class="annottext">forgetTx :: ctx -&gt; WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx IO ()
</span><a href="Cardano.Wallet.html#forgetTx"><span class="hs-identifier hs-var hs-var">forgetTx</span></a></span></span><span> </span><span id="local-6989586621682462064"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462064"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682462063"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462063"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682462062"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682462062"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682462061"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrRemoveTx IO ())
-&gt; ExceptT ErrRemoveTx IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682462035"><span id="local-6989586621682462036"><span id="local-6989586621682462037"><span id="local-6989586621682462038"><span id="local-6989586621682462039"><span id="local-6989586621682462040"><span id="local-6989586621682462041"><span id="local-6989586621682462042"><span id="local-6989586621682462043"><span id="local-6989586621682462044"><span id="local-6989586621682462045"><span id="local-6989586621682462046"><span id="local-6989586621682462047"><span id="local-6989586621682462048"><span id="local-6989586621682462049"><span id="local-6989586621682462050"><span id="local-6989586621682462051"><span id="local-6989586621682462052"><span id="local-6989586621682462053"><span id="local-6989586621682462054"><span id="local-6989586621682462055"><span id="local-6989586621682462056"><span id="local-6989586621682462057"><span id="local-6989586621682462058"><span id="local-6989586621682462059"><span id="local-6989586621682462060"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682462035"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2685"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrRemoveTx ()) -&gt; IO (Either ErrRemoveTx ()))
-&gt; ExceptT ErrRemoveTx stm () -&gt; ExceptT ErrRemoveTx IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrRemoveTx ()) -&gt; IO (Either ErrRemoveTx ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682462035"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrRemoveTx stm () -&gt; ExceptT ErrRemoveTx IO ())
-&gt; ExceptT ErrRemoveTx stm () -&gt; ExceptT ErrRemoveTx IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
</span><a href="#local-6989586621682462041"><span class="hs-identifier hs-var">removePendingOrExpiredTx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682462063"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682462062"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-2686"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2687"></span><span>    </span><span id="local-6989586621682462061"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682462061"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462064"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462066"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462065"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2688"></span><span>
</span><span id="line-2689"></span><span class="hs-comment">-- | Given a LocalTxSubmission record, calculate the slot when it should be</span><span>
</span><span id="line-2690"></span><span class="hs-comment">-- retried next.</span><span>
</span><span id="line-2691"></span><span class="hs-comment">--</span><span>
</span><span id="line-2692"></span><span class="hs-comment">-- The current implementation is really basic. Retry about once _n_ blocks.</span><span>
</span><span id="line-2693"></span><span id="local-6989586621682464459"><span class="annot"><a href="Cardano.Wallet.html#scheduleLocalTxSubmission"><span class="hs-identifier hs-type">scheduleLocalTxSubmission</span></a></span><span>
</span><span id="line-2694"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>  </span><span class="hs-comment">-- ^ Resubmission interval in terms of expected blocks.</span><span>
</span><span id="line-2695"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SlottingParameters"><span class="hs-identifier hs-type">SlottingParameters</span></a></span><span>
</span><span id="line-2696"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#LocalTxSubmissionStatus"><span class="hs-identifier hs-type">LocalTxSubmissionStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464459"><span class="hs-identifier hs-type">tx</span></a></span><span>
</span><span id="line-2697"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span></span><span>
</span><span id="line-2698"></span><span id="scheduleLocalTxSubmission"><span class="annot"><span class="annottext">scheduleLocalTxSubmission :: Word64
-&gt; SlottingParameters -&gt; LocalTxSubmissionStatus tx -&gt; SlotNo
</span><a href="Cardano.Wallet.html#scheduleLocalTxSubmission"><span class="hs-identifier hs-var hs-var">scheduleLocalTxSubmission</span></a></span></span><span> </span><span id="local-6989586621682462033"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682462033"><span class="hs-identifier hs-var">numBlocks</span></a></span></span><span> </span><span id="local-6989586621682462032"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682462032"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621682462031"><span class="annot"><span class="annottext">LocalTxSubmissionStatus tx
</span><a href="#local-6989586621682462031"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionStatus tx
</span><a href="#local-6989586621682462031"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionStatus tx
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; LocalTxSubmissionStatus tx
    -&gt; Const SlotNo (LocalTxSubmissionStatus tx))
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestSubmission&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; LocalTxSubmissionStatus tx
   -&gt; Const SlotNo (LocalTxSubmissionStatus tx))
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; LocalTxSubmissionStatus tx
-&gt; Const SlotNo (LocalTxSubmissionStatus tx)
</span><a href="#local-6989586621682462030"><span class="hs-var">#latestSubmission</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; SlotNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682462029"><span class="hs-identifier hs-var">numSlots</span></a></span><span>
</span><span id="line-2699"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2700"></span><span>    </span><span id="local-6989586621682462029"><span class="annot"><span class="annottext">numSlots :: SlotNo
</span><a href="#local-6989586621682462029"><span class="hs-identifier hs-var hs-var">numSlots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Word64
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ceiling</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682462033"><span class="hs-identifier hs-var">numBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682462025"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2701"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ActiveSlotCoefficient"><span class="hs-identifier hs-type">ActiveSlotCoefficient</span></a></span><span> </span><span id="local-6989586621682462025"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682462025"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlottingParameters -&gt; ActiveSlotCoefficient
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AgetActiveSlotCoefficient%3ASlottingParameters"><span class="hs-identifier hs-var hs-var">getActiveSlotCoefficient</span></a></span><span> </span><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682462032"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-2702"></span><span>
</span><span id="line-2703"></span><span class="hs-comment">-- | Parameters for 'runLocalTxSubmissionPool'</span><span>
</span><span id="line-2704"></span><span id="local-6989586621682462021"><span id="local-6989586621682462022"></span></span><span class="hs-keyword">data</span><span> </span><span id="LocalTxSubmissionConfig"><span class="annot"><a href="Cardano.Wallet.html#LocalTxSubmissionConfig"><span class="hs-identifier hs-var">LocalTxSubmissionConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LocalTxSubmissionConfig"><span class="annot"><a href="Cardano.Wallet.html#LocalTxSubmissionConfig"><span class="hs-identifier hs-var">LocalTxSubmissionConfig</span></a></span></span><span>
</span><span id="line-2705"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3ArateLimit%3ALocalTxSubmissionConfig"><span class="annot"><span class="annottext">LocalTxSubmissionConfig -&gt; DiffTime
</span><a href="Cardano.Wallet.html#%24sel%3ArateLimit%3ALocalTxSubmissionConfig"><span class="hs-identifier hs-var hs-var">rateLimit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-2706"></span><span>        </span><span class="hs-comment">-- ^ Minimum time between checks of pending transactions</span><span>
</span><span id="line-2707"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AblockInterval%3ALocalTxSubmissionConfig"><span class="annot"><span class="annottext">LocalTxSubmissionConfig -&gt; Word64
</span><a href="Cardano.Wallet.html#%24sel%3AblockInterval%3ALocalTxSubmissionConfig"><span class="hs-identifier hs-var hs-var">blockInterval</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-2708"></span><span>        </span><span class="hs-comment">-- ^ Resubmission interval, in terms of expected blocks.</span><span>
</span><span id="line-2709"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 LocalTxSubmissionConfig -&gt; Rep LocalTxSubmissionConfig x)
-&gt; (forall x.
    Rep LocalTxSubmissionConfig x -&gt; LocalTxSubmissionConfig)
-&gt; Generic LocalTxSubmissionConfig
forall x. Rep LocalTxSubmissionConfig x -&gt; LocalTxSubmissionConfig
forall x. LocalTxSubmissionConfig -&gt; Rep LocalTxSubmissionConfig x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep LocalTxSubmissionConfig x -&gt; LocalTxSubmissionConfig
$cfrom :: forall x. LocalTxSubmissionConfig -&gt; Rep LocalTxSubmissionConfig x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462010"><span id="local-6989586621682462012"><span id="local-6989586621682462014"><span class="annot"><span class="annottext">Int -&gt; LocalTxSubmissionConfig -&gt; ShowS
[LocalTxSubmissionConfig] -&gt; ShowS
LocalTxSubmissionConfig -&gt; String
(Int -&gt; LocalTxSubmissionConfig -&gt; ShowS)
-&gt; (LocalTxSubmissionConfig -&gt; String)
-&gt; ([LocalTxSubmissionConfig] -&gt; ShowS)
-&gt; Show LocalTxSubmissionConfig
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [LocalTxSubmissionConfig] -&gt; ShowS
$cshowList :: [LocalTxSubmissionConfig] -&gt; ShowS
show :: LocalTxSubmissionConfig -&gt; String
$cshow :: LocalTxSubmissionConfig -&gt; String
showsPrec :: Int -&gt; LocalTxSubmissionConfig -&gt; ShowS
$cshowsPrec :: Int -&gt; LocalTxSubmissionConfig -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682462006"><span id="local-6989586621682462008"><span class="annot"><span class="annottext">LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool
(LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool)
-&gt; (LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool)
-&gt; Eq LocalTxSubmissionConfig
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool
$c/= :: LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool
== :: LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool
$c== :: LocalTxSubmissionConfig -&gt; LocalTxSubmissionConfig -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-2710"></span><span>
</span><span id="line-2711"></span><span class="hs-comment">-- | The current default is to resubmit any pending transaction about once every</span><span>
</span><span id="line-2712"></span><span class="hs-comment">-- 10 blocks.</span><span>
</span><span id="line-2713"></span><span class="hs-comment">--</span><span>
</span><span id="line-2714"></span><span class="hs-comment">-- The default rate limit for checking the pending list is 1000ms.</span><span>
</span><span id="line-2715"></span><span class="annot"><a href="Cardano.Wallet.html#defaultLocalTxSubmissionConfig"><span class="hs-identifier hs-type">defaultLocalTxSubmissionConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#LocalTxSubmissionConfig"><span class="hs-identifier hs-type">LocalTxSubmissionConfig</span></a></span><span>
</span><span id="line-2716"></span><span id="defaultLocalTxSubmissionConfig"><span class="annot"><span class="annottext">defaultLocalTxSubmissionConfig :: LocalTxSubmissionConfig
</span><a href="Cardano.Wallet.html#defaultLocalTxSubmissionConfig"><span class="hs-identifier hs-var hs-var">defaultLocalTxSubmissionConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Word64 -&gt; LocalTxSubmissionConfig
</span><a href="Cardano.Wallet.html#LocalTxSubmissionConfig"><span class="hs-identifier hs-var">LocalTxSubmissionConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">10</span></span><span>
</span><span id="line-2717"></span><span>
</span><span id="line-2718"></span><span class="hs-comment">-- | Continuous process which monitors the chain tip and retries submission of</span><span>
</span><span id="line-2719"></span><span class="hs-comment">-- pending transactions as the chain lengthens.</span><span>
</span><span id="line-2720"></span><span class="hs-comment">--</span><span>
</span><span id="line-2721"></span><span class="hs-comment">-- Regardless of the frequency of chain updates, this function won't re-query</span><span>
</span><span id="line-2722"></span><span class="hs-comment">-- the database faster than the configured 'rateLimit'.</span><span>
</span><span id="line-2723"></span><span class="hs-comment">--</span><span>
</span><span id="line-2724"></span><span class="hs-comment">-- This only exits if the network layer 'watchNodeTip' function exits.</span><span>
</span><span id="line-2725"></span><span class="annot"><a href="Cardano.Wallet.html#runLocalTxSubmissionPool"><span class="hs-identifier hs-type">runLocalTxSubmissionPool</span></a></span><span>
</span><span id="line-2726"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682462005"><span class="annot"><a href="#local-6989586621682462005"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682462004"><span class="annot"><a href="#local-6989586621682462004"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682462003"><span class="annot"><a href="#local-6989586621682462003"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682462002"><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2727"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2728"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadMonotonicTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2729"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462005"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2730"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462005"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2731"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462004"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462003"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682462005"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2732"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2733"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#LocalTxSubmissionConfig"><span class="hs-identifier hs-type">LocalTxSubmissionConfig</span></a></span><span>
</span><span id="line-2734"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462005"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2735"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2736"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2737"></span><span id="runLocalTxSubmissionPool"><span class="annot"><span class="annottext">runLocalTxSubmissionPool :: LocalTxSubmissionConfig -&gt; ctx -&gt; WalletId -&gt; m ()
</span><a href="Cardano.Wallet.html#runLocalTxSubmissionPool"><span class="hs-identifier hs-var hs-var">runLocalTxSubmissionPool</span></a></span></span><span> </span><span id="local-6989586621682462001"><span class="annot"><span class="annottext">LocalTxSubmissionConfig
</span><a href="#local-6989586621682462001"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682462000"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462000"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461999"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461999"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer m s k
</span><a href="#local-6989586621682461998"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer m s k -&gt; (DBLayer m s k -&gt; m ()) -&gt; m ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461972"><span id="local-6989586621682461973"><span id="local-6989586621682461974"><span id="local-6989586621682461975"><span id="local-6989586621682461976"><span id="local-6989586621682461977"><span id="local-6989586621682461978"><span id="local-6989586621682461979"><span id="local-6989586621682461980"><span id="local-6989586621682461981"><span id="local-6989586621682461982"><span id="local-6989586621682461983"><span id="local-6989586621682461984"><span id="local-6989586621682461985"><span id="local-6989586621682461986"><span id="local-6989586621682461987"><span id="local-6989586621682461988"><span id="local-6989586621682461989"><span id="local-6989586621682461990"><span id="local-6989586621682461991"><span id="local-6989586621682461992"><span id="local-6989586621682461993"><span id="local-6989586621682461994"><span id="local-6989586621682461995"><span id="local-6989586621682461996"><span id="local-6989586621682461997"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; m a
atomically :: forall a. stm a -&gt; m a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461972"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2738"></span><span>    </span><span id="local-6989586621682461971"><span class="annot"><span class="annottext">BlockHeader -&gt; m ()
</span><a href="#local-6989586621682461971"><span class="hs-identifier hs-var">submitPending</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; m ()) -&gt; m (BlockHeader -&gt; m ())
</span><a href="#local-6989586621682461970"><span class="hs-identifier hs-var">rateLimited</span></a></span><span> </span><span class="annot"><span class="annottext">((BlockHeader -&gt; m ()) -&gt; m (BlockHeader -&gt; m ()))
-&gt; (BlockHeader -&gt; m ()) -&gt; m (BlockHeader -&gt; m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682461969"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682461969"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tracer m BracketLog -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Tracer m BracketLog -&gt; m a -&gt; m a
</span><a href="Cardano.Wallet.Logging.html#bracketTracer"><span class="hs-identifier hs-var">bracketTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m BracketLog
</span><a href="#local-6989586621682461968"><span class="hs-identifier hs-var">trBracket</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2739"></span><span>        </span><span id="local-6989586621682461967"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682461967"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NetworkLayer m Block -&gt; m SlottingParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m SlottingParameters
</span><a href="Cardano.Wallet.Network.html#currentSlottingParameters"><span class="hs-identifier hs-var hs-var">currentSlottingParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer m Block
</span><a href="#local-6989586621682461966"><span class="hs-identifier hs-var">nw</span></a></span><span>
</span><span id="line-2740"></span><span>        </span><span id="local-6989586621682461965"><span class="annot"><span class="annottext">[LocalTxSubmissionStatus SealedTx]
</span><a href="#local-6989586621682461965"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">stm [LocalTxSubmissionStatus SealedTx]
-&gt; m [LocalTxSubmissionStatus SealedTx]
forall a. stm a -&gt; m a
</span><a href="#local-6989586621682461972"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm [LocalTxSubmissionStatus SealedTx]
 -&gt; m [LocalTxSubmissionStatus SealedTx])
-&gt; stm [LocalTxSubmissionStatus SealedTx]
-&gt; m [LocalTxSubmissionStatus SealedTx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
</span><a href="#local-6989586621682461980"><span class="hs-identifier hs-var">readLocalTxSubmissionPending</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461999"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2741"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461964"><span class="annot"><span class="annottext">sl :: SlotNo
</span><a href="#local-6989586621682461964"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682461969"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682461963"><span class="hs-var">#slotNo</span></a></span><span>
</span><span id="line-2742"></span><span>        </span><span class="hs-comment">-- Re-submit transactions due, ignore errors</span><span>
</span><span id="line-2743"></span><span>        </span><span class="annot"><span class="annottext">[LocalTxSubmissionStatus SealedTx]
-&gt; (LocalTxSubmissionStatus SealedTx
    -&gt; m (Either ErrPutLocalTxSubmission ()))
-&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocalTxSubmissionStatus SealedTx -&gt; Bool)
-&gt; [LocalTxSubmissionStatus SealedTx]
-&gt; [LocalTxSubmissionStatus SealedTx]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlottingParameters
-&gt; SlotNo -&gt; LocalTxSubmissionStatus SealedTx -&gt; Bool
</span><a href="#local-6989586621682461962"><span class="hs-identifier hs-var">isScheduled</span></a></span><span> </span><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682461967"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682461964"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocalTxSubmissionStatus SealedTx]
</span><a href="#local-6989586621682461965"><span class="hs-identifier hs-var">pending</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LocalTxSubmissionStatus SealedTx
  -&gt; m (Either ErrPutLocalTxSubmission ()))
 -&gt; m ())
-&gt; (LocalTxSubmissionStatus SealedTx
    -&gt; m (Either ErrPutLocalTxSubmission ()))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682461961"><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
</span><a href="#local-6989586621682461961"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2744"></span><span>            </span><span class="annot"><span class="annottext">Either ErrPostTx ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrPostTx m () -&gt; m (Either ErrPostTx ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPostTx m () -&gt; m (Either ErrPostTx ()))
-&gt; ExceptT ErrPostTx m () -&gt; m (Either ErrPostTx ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m (BracketLog' (Either ErrPostTx ()))
-&gt; ExceptT ErrPostTx m () -&gt; ExceptT ErrPostTx m ()
forall (m :: * -&gt; *) e r.
MonadUnliftIO m =&gt;
Tracer m (BracketLog' (Either e r))
-&gt; ExceptT e m r -&gt; ExceptT e m r
</span><a href="Cardano.Wallet.Logging.html#traceResult"><span class="hs-identifier hs-var">traceResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Tracer m (BracketLog' (Either ErrPostTx ()))
</span><a href="#local-6989586621682461960"><span class="hs-identifier hs-var">trRetry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
</span><a href="#local-6989586621682461961"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; LocalTxSubmissionStatus SealedTx
    -&gt; Const (Hash &quot;Tx&quot;) (LocalTxSubmissionStatus SealedTx))
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; LocalTxSubmissionStatus SealedTx
   -&gt; Const (Hash &quot;Tx&quot;) (LocalTxSubmissionStatus SealedTx))
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; LocalTxSubmissionStatus SealedTx
-&gt; Const (Hash &quot;Tx&quot;) (LocalTxSubmissionStatus SealedTx)
</span><a href="#local-6989586621682461959"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPostTx m () -&gt; ExceptT ErrPostTx m ())
-&gt; ExceptT ErrPostTx m () -&gt; ExceptT ErrPostTx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2745"></span><span>                </span><span class="annot"><span class="annottext">NetworkLayer m Block -&gt; SealedTx -&gt; ExceptT ErrPostTx m ()
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; SealedTx -&gt; ExceptT ErrPostTx m ()
</span><a href="Cardano.Wallet.Network.html#postTx"><span class="hs-identifier hs-var hs-var">postTx</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer m Block
</span><a href="#local-6989586621682461966"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
</span><a href="#local-6989586621682461961"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
-&gt; ((SealedTx -&gt; Const SealedTx SealedTx)
    -&gt; LocalTxSubmissionStatus SealedTx
    -&gt; Const SealedTx (LocalTxSubmissionStatus SealedTx))
-&gt; SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;submittedTx&quot;
  ((SealedTx -&gt; Const SealedTx SealedTx)
   -&gt; LocalTxSubmissionStatus SealedTx
   -&gt; Const SealedTx (LocalTxSubmissionStatus SealedTx))
(SealedTx -&gt; Const SealedTx SealedTx)
-&gt; LocalTxSubmissionStatus SealedTx
-&gt; Const SealedTx (LocalTxSubmissionStatus SealedTx)
</span><a href="#local-6989586621682461958"><span class="hs-var">#submittedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2746"></span><span>            </span><span class="annot"><span class="annottext">stm (Either ErrPutLocalTxSubmission ())
-&gt; m (Either ErrPutLocalTxSubmission ())
forall a. stm a -&gt; m a
</span><a href="#local-6989586621682461972"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrPutLocalTxSubmission ())
 -&gt; m (Either ErrPutLocalTxSubmission ()))
-&gt; stm (Either ErrPutLocalTxSubmission ())
-&gt; m (Either ErrPutLocalTxSubmission ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrPutLocalTxSubmission stm ()
-&gt; stm (Either ErrPutLocalTxSubmission ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPutLocalTxSubmission stm ()
 -&gt; stm (Either ErrPutLocalTxSubmission ()))
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
-&gt; stm (Either ErrPutLocalTxSubmission ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
</span><a href="#local-6989586621682461981"><span class="hs-identifier hs-var">putLocalTxSubmission</span></a></span><span>
</span><span id="line-2747"></span><span>                </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461999"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2748"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
</span><a href="#local-6989586621682461961"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; LocalTxSubmissionStatus SealedTx
    -&gt; Const (Hash &quot;Tx&quot;) (LocalTxSubmissionStatus SealedTx))
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; LocalTxSubmissionStatus SealedTx
   -&gt; Const (Hash &quot;Tx&quot;) (LocalTxSubmissionStatus SealedTx))
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; LocalTxSubmissionStatus SealedTx
-&gt; Const (Hash &quot;Tx&quot;) (LocalTxSubmissionStatus SealedTx)
</span><a href="#local-6989586621682461957"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2749"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
</span><a href="#local-6989586621682461961"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionStatus SealedTx
-&gt; ((SealedTx -&gt; Const SealedTx SealedTx)
    -&gt; LocalTxSubmissionStatus SealedTx
    -&gt; Const SealedTx (LocalTxSubmissionStatus SealedTx))
-&gt; SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;submittedTx&quot;
  ((SealedTx -&gt; Const SealedTx SealedTx)
   -&gt; LocalTxSubmissionStatus SealedTx
   -&gt; Const SealedTx (LocalTxSubmissionStatus SealedTx))
(SealedTx -&gt; Const SealedTx SealedTx)
-&gt; LocalTxSubmissionStatus SealedTx
-&gt; Const SealedTx (LocalTxSubmissionStatus SealedTx)
</span><a href="#local-6989586621682461956"><span class="hs-var">#submittedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2750"></span><span>                </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682461964"><span class="hs-identifier hs-var">sl</span></a></span><span>
</span><span id="line-2751"></span><span>    </span><span class="annot"><span class="annottext">NetworkLayer m Block -&gt; (BlockHeader -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; (BlockHeader -&gt; m ()) -&gt; m ()
</span><a href="Cardano.Wallet.Network.html#watchNodeTip"><span class="hs-identifier hs-var hs-var">watchNodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer m Block
</span><a href="#local-6989586621682461966"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; m ()
</span><a href="#local-6989586621682461971"><span class="hs-identifier hs-var">submitPending</span></a></span><span>
</span><span id="line-2752"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2753"></span><span>    </span><span id="local-6989586621682461966"><span class="annot"><span class="annottext">nw :: NetworkLayer m Block
</span><a href="#local-6989586621682461966"><span class="hs-identifier hs-var hs-var">nw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462000"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer m Block
     -&gt; Const (NetworkLayer m Block) (NetworkLayer m Block))
    -&gt; ctx -&gt; Const (NetworkLayer m Block) ctx)
-&gt; NetworkLayer m Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2754"></span><span>    </span><span id="local-6989586621682461998"><span class="annot"><span class="annottext">db :: DBLayer m s k
</span><a href="#local-6989586621682461998"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462000"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer m s k -&gt; Const (DBLayer m s k) (DBLayer m s k))
    -&gt; ctx -&gt; Const (DBLayer m s k) ctx)
-&gt; DBLayer m s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer m s k ctx =&gt; Lens' ctx (DBLayer m s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462002"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462004"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682462003"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2755"></span><span>
</span><span id="line-2756"></span><span>    </span><span id="local-6989586621682461962"><span class="annot"><span class="annottext">isScheduled :: SlottingParameters
-&gt; SlotNo -&gt; LocalTxSubmissionStatus SealedTx -&gt; Bool
</span><a href="#local-6989586621682461962"><span class="hs-identifier hs-var hs-var">isScheduled</span></a></span></span><span> </span><span id="local-6989586621682461955"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682461955"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621682461954"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682461954"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2757"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682461954"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; Bool)
-&gt; (LocalTxSubmissionStatus SealedTx -&gt; SlotNo)
-&gt; LocalTxSubmissionStatus SealedTx
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
-&gt; SlottingParameters -&gt; LocalTxSubmissionStatus SealedTx -&gt; SlotNo
forall tx.
Word64
-&gt; SlottingParameters -&gt; LocalTxSubmissionStatus tx -&gt; SlotNo
</span><a href="Cardano.Wallet.html#scheduleLocalTxSubmission"><span class="hs-identifier hs-var">scheduleLocalTxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionConfig -&gt; Word64
</span><a href="Cardano.Wallet.html#%24sel%3AblockInterval%3ALocalTxSubmissionConfig"><span class="hs-identifier hs-var hs-var">blockInterval</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionConfig
</span><a href="#local-6989586621682462001"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682461955"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-2758"></span><span>
</span><span id="line-2759"></span><span>    </span><span id="local-6989586621682461970"><span class="annot"><span class="annottext">rateLimited :: (BlockHeader -&gt; m ()) -&gt; m (BlockHeader -&gt; m ())
</span><a href="#local-6989586621682461970"><span class="hs-identifier hs-var hs-var">rateLimited</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime
-&gt; (Time -&gt; BlockHeader -&gt; m ()) -&gt; m (BlockHeader -&gt; m ())
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadMonotonicTime m) =&gt;
DiffTime -&gt; (Time -&gt; a -&gt; m ()) -&gt; m (a -&gt; m ())
</span><a href="Cardano.Wallet.html#throttle"><span class="hs-identifier hs-var">throttle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalTxSubmissionConfig -&gt; DiffTime
</span><a href="Cardano.Wallet.html#%24sel%3ArateLimit%3ALocalTxSubmissionConfig"><span class="hs-identifier hs-var hs-var">rateLimit</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionConfig
</span><a href="#local-6989586621682462001"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Time -&gt; BlockHeader -&gt; m ()) -&gt; m (BlockHeader -&gt; m ()))
-&gt; ((BlockHeader -&gt; m ()) -&gt; Time -&gt; BlockHeader -&gt; m ())
-&gt; (BlockHeader -&gt; m ())
-&gt; m (BlockHeader -&gt; m ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; m ()) -&gt; Time -&gt; BlockHeader -&gt; m ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span>
</span><span id="line-2760"></span><span>
</span><span id="line-2761"></span><span>    </span><span id="local-6989586621682461951"><span class="annot"><span class="annottext">tr :: Tracer m TxSubmitLog
</span><a href="#local-6989586621682461951"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO TxSubmitLog -&gt; Tracer m TxSubmitLog
forall (m :: * -&gt; *) a. MonadIO m =&gt; Tracer IO a -&gt; Tracer m a
</span><a href="Cardano.Wallet.Logging.html#unliftIOTracer"><span class="hs-identifier hs-var">unliftIOTracer</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO TxSubmitLog -&gt; Tracer m TxSubmitLog)
-&gt; Tracer IO TxSubmitLog -&gt; Tracer m TxSubmitLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxSubmitLog -&gt; WalletWorkerLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO TxSubmitLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; WalletWorkerLog)
-&gt; (TxSubmitLog -&gt; WalletLog) -&gt; TxSubmitLog -&gt; WalletWorkerLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgTxSubmit"><span class="hs-identifier hs-var">MsgTxSubmit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tracer IO WalletWorkerLog -&gt; Tracer IO TxSubmitLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO TxSubmitLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2762"></span><span>        </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682462000"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer IO WalletWorkerLog
     -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx)
-&gt; Tracer IO WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasLogger IO WalletWorkerLog ctx =&gt;
Lens' ctx (Tracer IO WalletWorkerLog)
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span>
</span><span id="line-2763"></span><span>    </span><span id="local-6989586621682461968"><span class="annot"><span class="annottext">trBracket :: Tracer m BracketLog
</span><a href="#local-6989586621682461968"><span class="hs-identifier hs-var hs-var">trBracket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BracketLog -&gt; TxSubmitLog)
-&gt; Tracer m TxSubmitLog -&gt; Tracer m BracketLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">BracketLog -&gt; TxSubmitLog
</span><a href="Cardano.Wallet.html#MsgProcessPendingPool"><span class="hs-identifier hs-var">MsgProcessPendingPool</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m TxSubmitLog
</span><a href="#local-6989586621682461951"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-2764"></span><span>    </span><span id="local-6989586621682461960"><span class="annot"><span class="annottext">trRetry :: Hash &quot;Tx&quot; -&gt; Tracer m (BracketLog' (Either ErrPostTx ()))
</span><a href="#local-6989586621682461960"><span class="hs-identifier hs-var hs-var">trRetry</span></a></span></span><span> </span><span id="local-6989586621682461949"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682461949"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BracketLog' (Either ErrPostTx ()) -&gt; TxSubmitLog)
-&gt; Tracer m TxSubmitLog
-&gt; Tracer m (BracketLog' (Either ErrPostTx ()))
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; BracketLog' (Either ErrPostTx ()) -&gt; TxSubmitLog
</span><a href="Cardano.Wallet.html#MsgRetryPostTx"><span class="hs-identifier hs-var">MsgRetryPostTx</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682461949"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer m TxSubmitLog
</span><a href="#local-6989586621682461951"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-2765"></span><span>
</span><span id="line-2766"></span><span class="hs-comment">-- | Return a function to run an action at most once every _interval_.</span><span>
</span><span id="line-2767"></span><span id="local-6989586621682464455"><span id="local-6989586621682464457"><span class="annot"><a href="Cardano.Wallet.html#throttle"><span class="hs-identifier hs-type">throttle</span></a></span><span>
</span><span id="line-2768"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464457"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadMonotonicTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464457"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2769"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-2770"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2771"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682464457"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-2772"></span><span id="throttle"><span class="annot"><span class="annottext">throttle :: DiffTime -&gt; (Time -&gt; a -&gt; m ()) -&gt; m (a -&gt; m ())
</span><a href="Cardano.Wallet.html#throttle"><span class="hs-identifier hs-var hs-var">throttle</span></a></span></span><span> </span><span id="local-6989586621682461947"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621682461947"><span class="hs-identifier hs-var">interval</span></a></span></span><span> </span><span id="local-6989586621682461946"><span class="annot"><span class="annottext">Time -&gt; a -&gt; m ()
</span><a href="#local-6989586621682461946"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2773"></span><span>    </span><span id="local-6989586621682461945"><span class="annot"><span class="annottext">MVar (Maybe Time)
</span><a href="#local-6989586621682461945"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Time -&gt; m (MVar (Maybe Time))
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (MVar a)
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">newMVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Time
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2774"></span><span>    </span><span class="annot"><span class="annottext">(a -&gt; m ()) -&gt; m (a -&gt; m ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">((a -&gt; m ()) -&gt; m (a -&gt; m ())) -&gt; (a -&gt; m ()) -&gt; m (a -&gt; m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682461944"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682461944"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe Time) -&gt; (Maybe Time -&gt; m (Maybe Time)) -&gt; m ()
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
MVar a -&gt; (a -&gt; m a) -&gt; m ()
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">modifyMVar_</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe Time)
</span><a href="#local-6989586621682461945"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Time -&gt; m (Maybe Time)) -&gt; m ())
-&gt; (Maybe Time -&gt; m (Maybe Time)) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682461943"><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621682461943"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2775"></span><span>        </span><span id="local-6989586621682461942"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621682461942"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Time
forall (m :: * -&gt; *). MonadMonotonicTime m =&gt; m Time
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">getMonotonicTime</span></a></span><span>
</span><span id="line-2776"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; (Time -&gt; DiffTime) -&gt; Maybe Time -&gt; DiffTime
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621682461947"><span class="hs-identifier hs-var">interval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; DiffTime
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">diffTime</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621682461942"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621682461943"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621682461947"><span class="hs-identifier hs-var">interval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2777"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Time -&gt; a -&gt; m ()
</span><a href="#local-6989586621682461946"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621682461942"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682461944"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; Maybe Time -&gt; m (Maybe Time)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Maybe Time
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621682461942"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-2778"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Time -&gt; m (Maybe Time)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621682461943"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-2779"></span><span>
</span><span id="line-2780"></span><span class="hs-comment">-- | List all transactions and metadata from history for a given wallet.</span><span>
</span><span id="line-2781"></span><span class="annot"><a href="Cardano.Wallet.html#listTransactions"><span class="hs-identifier hs-type">listTransactions</span></a></span><span>
</span><span id="line-2782"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461940"><span class="annot"><a href="#local-6989586621682461940"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461939"><span class="annot"><a href="#local-6989586621682461939"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461938"><span class="annot"><a href="#local-6989586621682461938"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2783"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461939"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461938"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461940"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2784"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461940"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2785"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2786"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461940"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2787"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2788"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-2789"></span><span>        </span><span class="hs-comment">-- Inclusive minimum value of at least one withdrawal in each transaction</span><span>
</span><span id="line-2790"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-2791"></span><span>        </span><span class="hs-comment">-- Inclusive minimum time bound.</span><span>
</span><span id="line-2792"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-2793"></span><span>        </span><span class="hs-comment">-- Inclusive maximum time bound.</span><span>
</span><span id="line-2794"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier hs-type">SortOrder</span></a></span><span>
</span><span id="line-2795"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactions"><span class="hs-identifier hs-type">ErrListTransactions</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">TransactionInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2796"></span><span id="listTransactions"><span class="annot"><span class="annottext">listTransactions :: ctx
-&gt; WalletId
-&gt; Maybe Coin
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; SortOrder
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
</span><a href="Cardano.Wallet.html#listTransactions"><span class="hs-identifier hs-var hs-var">listTransactions</span></a></span></span><span> </span><span id="local-6989586621682461937"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461937"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461936"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461936"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461935"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682461935"><span class="hs-identifier hs-var">mMinWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682461934"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682461934"><span class="hs-identifier hs-var">mStart</span></a></span></span><span> </span><span id="local-6989586621682461933"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682461933"><span class="hs-identifier hs-var">mEnd</span></a></span></span><span> </span><span id="local-6989586621682461932"><span class="annot"><span class="annottext">SortOrder
</span><a href="#local-6989586621682461932"><span class="hs-identifier hs-var">order</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461931"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrListTransactions IO [TransactionInfo])
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461905"><span id="local-6989586621682461906"><span id="local-6989586621682461907"><span id="local-6989586621682461908"><span id="local-6989586621682461909"><span id="local-6989586621682461910"><span id="local-6989586621682461911"><span id="local-6989586621682461912"><span id="local-6989586621682461913"><span id="local-6989586621682461914"><span id="local-6989586621682461915"><span id="local-6989586621682461916"><span id="local-6989586621682461917"><span id="local-6989586621682461918"><span id="local-6989586621682461919"><span id="local-6989586621682461920"><span id="local-6989586621682461921"><span id="local-6989586621682461922"><span id="local-6989586621682461923"><span id="local-6989586621682461924"><span id="local-6989586621682461925"><span id="local-6989586621682461926"><span id="local-6989586621682461927"><span id="local-6989586621682461928"><span id="local-6989586621682461929"><span id="local-6989586621682461930"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461905"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2797"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT ErrListTransactions IO ()
-&gt; ExceptT ErrListTransactions IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Bool) -&gt; Maybe Coin -&gt; Maybe Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682461935"><span class="hs-identifier hs-var">mMinWithdrawal</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrListTransactions IO ()
 -&gt; ExceptT ErrListTransactions IO ())
-&gt; ExceptT ErrListTransactions IO ()
-&gt; ExceptT ErrListTransactions IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2798"></span><span>        </span><span class="annot"><span class="annottext">ErrListTransactions -&gt; ExceptT ErrListTransactions IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrListTransactions
</span><a href="Cardano.Wallet.html#ErrListTransactionsMinWithdrawalWrong"><span class="hs-identifier hs-var">ErrListTransactionsMinWithdrawalWrong</span></a></span><span>
</span><span id="line-2799"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrListTransactions [TransactionInfo])
 -&gt; IO (Either ErrListTransactions [TransactionInfo]))
-&gt; ExceptT ErrListTransactions stm [TransactionInfo]
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrListTransactions [TransactionInfo])
-&gt; IO (Either ErrListTransactions [TransactionInfo])
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461905"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrListTransactions stm [TransactionInfo]
 -&gt; ExceptT ErrListTransactions IO [TransactionInfo])
-&gt; ExceptT ErrListTransactions stm [TransactionInfo]
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2800"></span><span>        </span><span class="annot"><span class="annottext">(IO (Either ErrListTransactions (Maybe (Range SlotNo)))
 -&gt; stm (Either ErrListTransactions (Maybe (Range SlotNo))))
-&gt; ExceptT ErrListTransactions IO (Maybe (Range SlotNo))
-&gt; ExceptT ErrListTransactions stm (Maybe (Range SlotNo))
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either ErrListTransactions (Maybe (Range SlotNo)))
-&gt; stm (Either ErrListTransactions (Maybe (Range SlotNo)))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrListTransactions IO (Maybe (Range SlotNo))
</span><a href="#local-6989586621682461903"><span class="hs-identifier hs-var">getSlotRange</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrListTransactions stm (Maybe (Range SlotNo))
-&gt; (Maybe (Range SlotNo)
    -&gt; ExceptT ErrListTransactions stm [TransactionInfo])
-&gt; ExceptT ErrListTransactions stm [TransactionInfo]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrListTransactions stm [TransactionInfo]
-&gt; (Range SlotNo
    -&gt; ExceptT ErrListTransactions stm [TransactionInfo])
-&gt; Maybe (Range SlotNo)
-&gt; ExceptT ErrListTransactions stm [TransactionInfo]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span>
</span><span id="line-2801"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TransactionInfo]
-&gt; ExceptT ErrListTransactions stm [TransactionInfo]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2802"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682461902"><span class="annot"><span class="annottext">Range SlotNo
</span><a href="#local-6989586621682461902"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">stm [TransactionInfo]
-&gt; ExceptT ErrListTransactions stm [TransactionInfo]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
</span><a href="#local-6989586621682461916"><span class="hs-identifier hs-var">readTxHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461936"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682461935"><span class="hs-identifier hs-var">mMinWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">SortOrder
</span><a href="#local-6989586621682461932"><span class="hs-identifier hs-var">order</span></a></span><span> </span><span class="annot"><span class="annottext">Range SlotNo
</span><a href="#local-6989586621682461902"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxStatus
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2803"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2804"></span><span>    </span><span class="annot"><a href="#local-6989586621682461901"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2805"></span><span>    </span><span id="local-6989586621682461901"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682461901"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461937"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2806"></span><span>
</span><span id="line-2807"></span><span>    </span><span id="local-6989586621682461931"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461931"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461937"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461939"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461938"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2808"></span><span>
</span><span id="line-2809"></span><span>    </span><span class="hs-comment">-- Transforms the user-specified time range into a slot range. If the</span><span>
</span><span id="line-2810"></span><span>    </span><span class="hs-comment">-- user-specified range terminates before the start of the blockchain,</span><span>
</span><span id="line-2811"></span><span>    </span><span class="hs-comment">-- returns 'Nothing'.</span><span>
</span><span id="line-2812"></span><span>    </span><span class="annot"><a href="#local-6989586621682461903"><span class="hs-identifier hs-type">getSlotRange</span></a></span><span>
</span><span id="line-2813"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactions"><span class="hs-identifier hs-type">ErrListTransactions</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2814"></span><span>    </span><span id="local-6989586621682461903"><span class="annot"><span class="annottext">getSlotRange :: ExceptT ErrListTransactions IO (Maybe (Range SlotNo))
</span><a href="#local-6989586621682461903"><span class="hs-identifier hs-var hs-var">getSlotRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682461934"><span class="hs-identifier hs-var">mStart</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682461933"><span class="hs-identifier hs-var">mEnd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2815"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682461900"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461900"><span class="hs-identifier hs-var">start</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682461899"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461899"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461900"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461899"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2816"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461898"><span class="annot"><span class="annottext">err :: ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682461898"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; ErrStartTimeLaterThanEndTime
</span><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var">ErrStartTimeLaterThanEndTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461900"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461899"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-2817"></span><span>            </span><span class="annot"><span class="annottext">ErrListTransactions
-&gt; ExceptT ErrListTransactions IO (Maybe (Range SlotNo))
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime -&gt; ErrListTransactions
</span><a href="Cardano.Wallet.html#ErrListTransactionsStartTimeLaterThanEndTime"><span class="hs-identifier hs-var">ErrListTransactionsStartTimeLaterThanEndTime</span></a></span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682461898"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2818"></span><span>        </span><span class="annot"><span class="annottext">(Maybe UTCTime, Maybe UTCTime)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2819"></span><span>            </span><span class="annot"><span class="annottext">(PastHorizonException -&gt; ErrListTransactions)
-&gt; ExceptT PastHorizonException IO (Maybe (Range SlotNo))
-&gt; ExceptT ErrListTransactions IO (Maybe (Range SlotNo))
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ErrListTransactions
</span><a href="Cardano.Wallet.html#ErrListTransactionsPastHorizonException"><span class="hs-identifier hs-var">ErrListTransactionsPastHorizonException</span></a></span><span>
</span><span id="line-2820"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT PastHorizonException IO (Maybe (Range SlotNo))
 -&gt; ExceptT ErrListTransactions IO (Maybe (Range SlotNo)))
-&gt; ExceptT PastHorizonException IO (Maybe (Range SlotNo))
-&gt; ExceptT ErrListTransactions IO (Maybe (Range SlotNo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Qry (Maybe (Range SlotNo))
-&gt; ExceptT PastHorizonException IO (Maybe (Range SlotNo))
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682461901"><span class="hs-identifier hs-var">ti</span></a></span><span>
</span><span id="line-2821"></span><span>                </span><span class="annot"><span class="annottext">(Qry (Maybe (Range SlotNo))
 -&gt; ExceptT PastHorizonException IO (Maybe (Range SlotNo)))
-&gt; Qry (Maybe (Range SlotNo))
-&gt; ExceptT PastHorizonException IO (Maybe (Range SlotNo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Range UTCTime -&gt; Qry (Maybe (Range SlotNo))
</span><a href="Cardano.Wallet.Primitive.Slotting.html#slotRangeFromTimeRange"><span class="hs-identifier hs-var">slotRangeFromTimeRange</span></a></span><span>
</span><span id="line-2822"></span><span>                </span><span class="annot"><span class="annottext">(Range UTCTime -&gt; Qry (Maybe (Range SlotNo)))
-&gt; Range UTCTime -&gt; Qry (Maybe (Range SlotNo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; Maybe UTCTime -&gt; Range UTCTime
forall a. Maybe a -&gt; Maybe a -&gt; Range a
</span><a href="Cardano.Wallet.Primitive.Types.html#Range"><span class="hs-identifier hs-var">Range</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682461934"><span class="hs-identifier hs-var">mStart</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682461933"><span class="hs-identifier hs-var">mEnd</span></a></span><span>
</span><span id="line-2823"></span><span>
</span><span id="line-2824"></span><span class="hs-comment">-- | Extract assets associated with a given wallet from its transaction history.</span><span>
</span><span id="line-2825"></span><span class="annot"><a href="Cardano.Wallet.html#listAssets"><span class="hs-identifier hs-type">listAssets</span></a></span><span>
</span><span id="line-2826"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461893"><span class="annot"><a href="#local-6989586621682461893"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461892"><span class="annot"><a href="#local-6989586621682461892"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682461891"><span class="annot"><a href="#local-6989586621682461891"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461893"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461892"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461891"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461893"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2827"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461891"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2828"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2829"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">TokenMap.AssetId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2830"></span><span id="listAssets"><span class="annot"><span class="annottext">listAssets :: ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
</span><a href="Cardano.Wallet.html#listAssets"><span class="hs-identifier hs-var hs-var">listAssets</span></a></span></span><span> </span><span id="local-6989586621682461890"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461890"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461889"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461889"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461888"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId))
-&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461862"><span id="local-6989586621682461863"><span id="local-6989586621682461864"><span id="local-6989586621682461865"><span id="local-6989586621682461866"><span id="local-6989586621682461867"><span id="local-6989586621682461868"><span id="local-6989586621682461869"><span id="local-6989586621682461870"><span id="local-6989586621682461871"><span id="local-6989586621682461872"><span id="local-6989586621682461873"><span id="local-6989586621682461874"><span id="local-6989586621682461875"><span id="local-6989586621682461876"><span id="local-6989586621682461877"><span id="local-6989586621682461878"><span id="local-6989586621682461879"><span id="local-6989586621682461880"><span id="local-6989586621682461881"><span id="local-6989586621682461882"><span id="local-6989586621682461883"><span id="local-6989586621682461884"><span id="local-6989586621682461885"><span id="local-6989586621682461886"><span id="local-6989586621682461887"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461862"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2831"></span><span>    </span><span id="local-6989586621682461861"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461861"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Wallet s))
 -&gt; IO (Either ErrNoSuchWallet (Wallet s)))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Wallet s))
-&gt; IO (Either ErrNoSuchWallet (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461862"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrNoSuchWallet IO (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461889"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682461882"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461889"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2832"></span><span>    </span><span id="local-6989586621682461860"><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682461860"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [TransactionInfo]
-&gt; ExceptT ErrNoSuchWallet IO [TransactionInfo]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [TransactionInfo]
 -&gt; ExceptT ErrNoSuchWallet IO [TransactionInfo])
-&gt; (stm [TransactionInfo] -&gt; IO [TransactionInfo])
-&gt; stm [TransactionInfo]
-&gt; ExceptT ErrNoSuchWallet IO [TransactionInfo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">stm [TransactionInfo] -&gt; IO [TransactionInfo]
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461862"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm [TransactionInfo]
 -&gt; ExceptT ErrNoSuchWallet IO [TransactionInfo])
-&gt; stm [TransactionInfo]
-&gt; ExceptT ErrNoSuchWallet IO [TransactionInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2833"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461859"><span class="annot"><span class="annottext">noMinWithdrawal :: Maybe a
</span><a href="#local-6989586621682461859"><span class="hs-identifier hs-var hs-var">noMinWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2834"></span><span>            </span><span id="local-6989586621682461858"><span class="annot"><span class="annottext">allTxStatuses :: Maybe a
</span><a href="#local-6989586621682461858"><span class="hs-identifier hs-var hs-var">allTxStatuses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2835"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
</span><a href="#local-6989586621682461873"><span class="hs-identifier hs-var">readTxHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461889"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="#local-6989586621682461859"><span class="hs-identifier hs-var">noMinWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">SortOrder
</span><a href="Cardano.Wallet.Primitive.Types.html#Ascending"><span class="hs-identifier hs-var">Ascending</span></a></span><span> </span><span class="annot"><span class="annottext">Range SlotNo
forall a. Range a
</span><a href="Cardano.Wallet.Primitive.Types.html#wholeRange"><span class="hs-identifier hs-var">wholeRange</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxStatus
forall a. Maybe a
</span><a href="#local-6989586621682461858"><span class="hs-identifier hs-var">allTxStatuses</span></a></span><span>
</span><span id="line-2836"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682461856"><span class="hs-identifier hs-type">txAssets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">TransactionInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">TokenMap.AssetId</span></a></span><span>
</span><span id="line-2837"></span><span>        </span><span id="local-6989586621682461856"><span class="annot"><span class="annottext">txAssets :: TransactionInfo -&gt; Set AssetId
</span><a href="#local-6989586621682461856"><span class="hs-identifier hs-var hs-var">txAssets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set AssetId] -&gt; Set AssetId
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.unions</span></a></span><span>
</span><span id="line-2838"></span><span>            </span><span class="annot"><span class="annottext">([Set AssetId] -&gt; Set AssetId)
-&gt; (TransactionInfo -&gt; [Set AssetId])
-&gt; TransactionInfo
-&gt; Set AssetId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Set AssetId) -&gt; [TxOut] -&gt; [Set AssetId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; Set AssetId
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getAssets"><span class="hs-identifier hs-var">TokenBundle.getAssets</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Set AssetId)
-&gt; (TxOut -&gt; TokenBundle) -&gt; TxOut -&gt; Set AssetId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; TxOut -&gt; Const TokenBundle TxOut)
-&gt; TxOut -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; TxOut -&gt; Const TokenBundle TxOut)
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; TxOut -&gt; Const TokenBundle TxOut
</span><a href="#local-6989586621682461853"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2839"></span><span>            </span><span class="annot"><span class="annottext">([TxOut] -&gt; [Set AssetId])
-&gt; (TransactionInfo -&gt; [TxOut]) -&gt; TransactionInfo -&gt; [Set AssetId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Bool) -&gt; [TxOut] -&gt; [TxOut]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Bool
</span><a href="#local-6989586621682461852"><span class="hs-identifier hs-var">ourOut</span></a></span><span>
</span><span id="line-2840"></span><span>            </span><span class="annot"><span class="annottext">([TxOut] -&gt; [TxOut])
-&gt; (TransactionInfo -&gt; [TxOut]) -&gt; TransactionInfo -&gt; [TxOut]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo -&gt; [TxOut]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoOutputs%3ATransactionInfo"><span class="hs-identifier hs-var hs-var">txInfoOutputs</span></a></span><span>
</span><span id="line-2841"></span><span>        </span><span id="local-6989586621682461852"><span class="annot"><span class="annottext">ourOut :: TxOut -&gt; Bool
</span><a href="#local-6989586621682461852"><span class="hs-identifier hs-var hs-var">ourOut</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461850"><span class="annot"><span class="annottext">Address
$sel:address:TxOut :: TxOut -&gt; Address
address :: Address
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aaddress%3ATxOut"><span class="hs-identifier hs-var hs-var">address</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; Bool
</span><a href="#local-6989586621682461848"><span class="hs-identifier hs-var">ourAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682461850"><span class="hs-identifier hs-var">address</span></a></span><span>
</span><span id="line-2842"></span><span>        </span><span id="local-6989586621682461848"><span class="annot"><span class="annottext">ourAddress :: Address -&gt; Bool
</span><a href="#local-6989586621682461848"><span class="hs-identifier hs-var hs-var">ourAddress</span></a></span></span><span> </span><span id="local-6989586621682461847"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682461847"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty DerivationIndex) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty DerivationIndex) -&gt; Bool)
-&gt; (s -&gt; Maybe (NonEmpty DerivationIndex)) -&gt; s -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty DerivationIndex), s)
-&gt; Maybe (NonEmpty DerivationIndex)
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (NonEmpty DerivationIndex), s)
 -&gt; Maybe (NonEmpty DerivationIndex))
-&gt; (s -&gt; (Maybe (NonEmpty DerivationIndex), s))
-&gt; s
-&gt; Maybe (NonEmpty DerivationIndex)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
forall s entity.
IsOurs s entity =&gt;
entity -&gt; s -&gt; (Maybe (NonEmpty DerivationIndex), s)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOurs"><span class="hs-identifier hs-var">isOurs</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682461847"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; Bool) -&gt; s -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461861"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-2843"></span><span>    </span><span class="annot"><span class="annottext">Set AssetId -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Set AssetId -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId))
-&gt; Set AssetId -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Set AssetId] -&gt; Set AssetId
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.unions</span></a></span><span> </span><span class="annot"><span class="annottext">([Set AssetId] -&gt; Set AssetId) -&gt; [Set AssetId] -&gt; Set AssetId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TransactionInfo -&gt; Set AssetId)
-&gt; [TransactionInfo] -&gt; [Set AssetId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo -&gt; Set AssetId
</span><a href="#local-6989586621682461856"><span class="hs-identifier hs-var">txAssets</span></a></span><span> </span><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682461860"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-2844"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2845"></span><span>    </span><span id="local-6989586621682461888"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461888"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461890"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461893"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461892"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2846"></span><span>
</span><span id="line-2847"></span><span class="hs-comment">-- | Get transaction and metadata from history for a given wallet.</span><span>
</span><span id="line-2848"></span><span class="annot"><a href="Cardano.Wallet.html#getTransaction"><span class="hs-identifier hs-type">getTransaction</span></a></span><span>
</span><span id="line-2849"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461846"><span class="annot"><a href="#local-6989586621682461846"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461845"><span class="annot"><a href="#local-6989586621682461845"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461844"><span class="annot"><a href="#local-6989586621682461844"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461845"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461844"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461846"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2850"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461846"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2851"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2852"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span>
</span><span id="line-2853"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransaction"><span class="hs-identifier hs-type">ErrGetTransaction</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">TransactionInfo</span></a></span><span>
</span><span id="line-2854"></span><span id="getTransaction"><span class="annot"><span class="annottext">getTransaction :: ctx
-&gt; WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; ExceptT ErrGetTransaction IO TransactionInfo
</span><a href="Cardano.Wallet.html#getTransaction"><span class="hs-identifier hs-var hs-var">getTransaction</span></a></span></span><span> </span><span id="local-6989586621682461843"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461843"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461842"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461842"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461841"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682461841"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461840"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrGetTransaction IO TransactionInfo)
-&gt; ExceptT ErrGetTransaction IO TransactionInfo
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461814"><span id="local-6989586621682461815"><span id="local-6989586621682461816"><span id="local-6989586621682461817"><span id="local-6989586621682461818"><span id="local-6989586621682461819"><span id="local-6989586621682461820"><span id="local-6989586621682461821"><span id="local-6989586621682461822"><span id="local-6989586621682461823"><span id="local-6989586621682461824"><span id="local-6989586621682461825"><span id="local-6989586621682461826"><span id="local-6989586621682461827"><span id="local-6989586621682461828"><span id="local-6989586621682461829"><span id="local-6989586621682461830"><span id="local-6989586621682461831"><span id="local-6989586621682461832"><span id="local-6989586621682461833"><span id="local-6989586621682461834"><span id="local-6989586621682461835"><span id="local-6989586621682461836"><span id="local-6989586621682461837"><span id="local-6989586621682461838"><span id="local-6989586621682461839"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461814"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2855"></span><span>    </span><span id="local-6989586621682461813"><span class="annot"><span class="annottext">Either ErrNoSuchWallet (Maybe TransactionInfo)
</span><a href="#local-6989586621682461813"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either ErrNoSuchWallet (Maybe TransactionInfo))
-&gt; ExceptT
     ErrGetTransaction
     IO
     (Either ErrNoSuchWallet (Maybe TransactionInfo))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrNoSuchWallet (Maybe TransactionInfo))
 -&gt; ExceptT
      ErrGetTransaction
      IO
      (Either ErrNoSuchWallet (Maybe TransactionInfo)))
-&gt; IO (Either ErrNoSuchWallet (Maybe TransactionInfo))
-&gt; ExceptT
     ErrGetTransaction
     IO
     (Either ErrNoSuchWallet (Maybe TransactionInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet (Maybe TransactionInfo))
-&gt; IO (Either ErrNoSuchWallet (Maybe TransactionInfo))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461814"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet (Maybe TransactionInfo))
 -&gt; IO (Either ErrNoSuchWallet (Maybe TransactionInfo)))
-&gt; stm (Either ErrNoSuchWallet (Maybe TransactionInfo))
-&gt; IO (Either ErrNoSuchWallet (Maybe TransactionInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
-&gt; stm (Either ErrNoSuchWallet (Maybe TransactionInfo))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
 -&gt; stm (Either ErrNoSuchWallet (Maybe TransactionInfo)))
-&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
-&gt; stm (Either ErrNoSuchWallet (Maybe TransactionInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
</span><a href="#local-6989586621682461824"><span class="hs-identifier hs-var">getTx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461842"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682461841"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-2856"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrNoSuchWallet (Maybe TransactionInfo)
</span><a href="#local-6989586621682461813"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2857"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682461812"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682461812"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2858"></span><span>            </span><span class="annot"><span class="annottext">ErrGetTransaction -&gt; ExceptT ErrGetTransaction IO TransactionInfo
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrGetTransaction
</span><a href="Cardano.Wallet.html#ErrGetTransactionNoSuchWallet"><span class="hs-identifier hs-var">ErrGetTransactionNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682461812"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2859"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TransactionInfo
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2860"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461810"><span class="annot"><span class="annottext">err' :: ErrNoSuchTransaction
</span><a href="#local-6989586621682461810"><span class="hs-identifier hs-var hs-var">err'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Hash &quot;Tx&quot; -&gt; ErrNoSuchTransaction
</span><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-var">ErrNoSuchTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461842"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682461841"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-2861"></span><span>            </span><span class="annot"><span class="annottext">ErrGetTransaction -&gt; ExceptT ErrGetTransaction IO TransactionInfo
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchTransaction -&gt; ErrGetTransaction
</span><a href="Cardano.Wallet.html#ErrGetTransactionNoSuchTransaction"><span class="hs-identifier hs-var">ErrGetTransactionNoSuchTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682461810"><span class="hs-identifier hs-var">err'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2862"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682461807"><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682461807"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2863"></span><span>            </span><span class="annot"><span class="annottext">TransactionInfo -&gt; ExceptT ErrGetTransaction IO TransactionInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682461807"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2864"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2865"></span><span>    </span><span id="local-6989586621682461840"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461840"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461843"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461845"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461844"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2866"></span><span>
</span><span id="line-2867"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Migration
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-2870"></span><span>
</span><span id="line-2871"></span><span class="annot"><a href="Cardano.Wallet.html#createMigrationPlan"><span class="hs-identifier hs-type">createMigrationPlan</span></a></span><span>
</span><span id="line-2872"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461806"><span class="annot"><a href="#local-6989586621682461806"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461805"><span class="annot"><a href="#local-6989586621682461805"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682461804"><span class="annot"><a href="#local-6989586621682461804"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2873"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461804"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461805"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461806"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2874"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461806"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2875"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasTransactionLayer"><span class="hs-identifier hs-type">HasTransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461805"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461806"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2876"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2877"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461806"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2878"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AnyCardanoEra</span></a></span><span>
</span><span id="line-2879"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2880"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-2881"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlan"><span class="hs-identifier hs-type">ErrCreateMigrationPlan</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html#MigrationPlan"><span class="hs-identifier hs-type">MigrationPlan</span></a></span><span>
</span><span id="line-2882"></span><span id="createMigrationPlan"><span class="annot"><span class="annottext">createMigrationPlan :: ctx
-&gt; AnyCardanoEra
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
</span><a href="Cardano.Wallet.html#createMigrationPlan"><span class="hs-identifier hs-var hs-var">createMigrationPlan</span></a></span></span><span> </span><span id="local-6989586621682461803"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461803"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461802"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682461802"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682461801"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461801"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461800"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461800"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2883"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682461799"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461799"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461798"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682461798"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrCreateMigrationPlan)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT
     ErrCreateMigrationPlan IO (Wallet s, WalletMetadata, Set Tx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrCreateMigrationPlan
</span><a href="Cardano.Wallet.html#ErrCreateMigrationPlanNoSuchWallet"><span class="hs-identifier hs-var">ErrCreateMigrationPlanNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
 -&gt; ExceptT
      ErrCreateMigrationPlan IO (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT
     ErrCreateMigrationPlan IO (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2884"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461806"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461804"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461805"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461803"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461801"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2885"></span><span>    </span><span id="local-6989586621682461796"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682461796"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters
-&gt; ExceptT ErrCreateMigrationPlan IO ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters
 -&gt; ExceptT ErrCreateMigrationPlan IO ProtocolParameters)
-&gt; IO ProtocolParameters
-&gt; ExceptT ErrCreateMigrationPlan IO ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682461795"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2886"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461794"><span class="annot"><span class="annottext">txConstraints :: TxConstraints
</span><a href="#local-6989586621682461794"><span class="hs-identifier hs-var hs-var">txConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682461793"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682461802"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682461796"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2887"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461792"><span class="annot"><span class="annottext">utxo :: UTxO
</span><a href="#local-6989586621682461792"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier hs-var">availableUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461804"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682461798"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461799"><span class="hs-identifier hs-var">wallet</span></a></span><span>
</span><span id="line-2888"></span><span>    </span><span class="annot"><span class="annottext">MigrationPlan -&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-2889"></span><span>        </span><span class="annot"><span class="annottext">(MigrationPlan -&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan)
-&gt; MigrationPlan -&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints -&gt; UTxO -&gt; RewardWithdrawal -&gt; MigrationPlan
</span><a href="Cardano.Wallet.Primitive.Migration.html#createPlan"><span class="hs-identifier hs-var">Migration.createPlan</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints
</span><a href="#local-6989586621682461794"><span class="hs-identifier hs-var">txConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682461792"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-2890"></span><span>        </span><span class="annot"><span class="annottext">(RewardWithdrawal -&gt; MigrationPlan)
-&gt; RewardWithdrawal -&gt; MigrationPlan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; RewardWithdrawal
</span><a href="Cardano.Wallet.Primitive.Migration.Selection.html#RewardWithdrawal"><span class="hs-identifier hs-var">Migration.RewardWithdrawal</span></a></span><span>
</span><span id="line-2891"></span><span>        </span><span class="annot"><span class="annottext">(Coin -&gt; RewardWithdrawal) -&gt; Coin -&gt; RewardWithdrawal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal -&gt; Coin
</span><a href="Cardano.Wallet.Transaction.html#withdrawalToCoin"><span class="hs-identifier hs-var">withdrawalToCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461800"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span>
</span><span id="line-2892"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2893"></span><span>    </span><span id="local-6989586621682461795"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682461795"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461803"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2894"></span><span>    </span><span id="local-6989586621682461793"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682461793"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461803"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461805"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2895"></span><span>
</span><span id="line-2896"></span><span class="hs-keyword">type</span><span> </span><span id="SelectionWithoutChange"><span class="annot"><a href="Cardano.Wallet.html#SelectionWithoutChange"><span class="hs-identifier hs-var">SelectionWithoutChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier hs-type">SelectionOf</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span>
</span><span id="line-2897"></span><span>
</span><span id="line-2898"></span><span class="annot"><a href="Cardano.Wallet.html#migrationPlanToSelectionWithdrawals"><span class="hs-identifier hs-type">migrationPlanToSelectionWithdrawals</span></a></span><span>
</span><span id="line-2899"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html#MigrationPlan"><span class="hs-identifier hs-type">MigrationPlan</span></a></span><span>
</span><span id="line-2900"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-2901"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2902"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#SelectionWithoutChange"><span class="hs-identifier hs-type">SelectionWithoutChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2903"></span><span id="migrationPlanToSelectionWithdrawals"><span class="annot"><span class="annottext">migrationPlanToSelectionWithdrawals :: MigrationPlan
-&gt; Withdrawal
-&gt; NonEmpty Address
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
</span><a href="Cardano.Wallet.html#migrationPlanToSelectionWithdrawals"><span class="hs-identifier hs-var hs-var">migrationPlanToSelectionWithdrawals</span></a></span></span><span> </span><span id="local-6989586621682461789"><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682461789"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span id="local-6989586621682461788"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461788"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682461787"><span class="annot"><span class="annottext">NonEmpty Address
</span><a href="#local-6989586621682461787"><span class="hs-identifier hs-var">outputAddressesToCycle</span></a></span></span><span>
</span><span id="line-2904"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SelectionWithoutChange, Withdrawal)]
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.nonEmpty</span></a></span><span>
</span><span id="line-2905"></span><span>    </span><span class="annot"><span class="annottext">([(SelectionWithoutChange, Withdrawal)]
 -&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal)))
-&gt; [(SelectionWithoutChange, Withdrawal)]
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(SelectionWithoutChange, Withdrawal)]
-&gt; [(SelectionWithoutChange, Withdrawal)]
forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.reverse</span></a></span><span>
</span><span id="line-2906"></span><span>    </span><span class="annot"><span class="annottext">([(SelectionWithoutChange, Withdrawal)]
 -&gt; [(SelectionWithoutChange, Withdrawal)])
-&gt; [(SelectionWithoutChange, Withdrawal)]
-&gt; [(SelectionWithoutChange, Withdrawal)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([(SelectionWithoutChange, Withdrawal)], [Address])
-&gt; [(SelectionWithoutChange, Withdrawal)]
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span>
</span><span id="line-2907"></span><span>    </span><span class="annot"><span class="annottext">(([(SelectionWithoutChange, Withdrawal)], [Address])
 -&gt; [(SelectionWithoutChange, Withdrawal)])
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
-&gt; [(SelectionWithoutChange, Withdrawal)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([(SelectionWithoutChange, Withdrawal)], [Address])
 -&gt; Selection (TxIn, TxOut)
 -&gt; ([(SelectionWithoutChange, Withdrawal)], [Address]))
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
-&gt; [Selection (TxIn, TxOut)]
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.foldl'</span></a></span><span>
</span><span id="line-2908"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Selection (TxIn, TxOut)
 -&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
 -&gt; ([(SelectionWithoutChange, Withdrawal)], [Address]))
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
-&gt; Selection (TxIn, TxOut)
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Selection (TxIn, TxOut)
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
</span><a href="#local-6989586621682461785"><span class="hs-identifier hs-var">accumulate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2909"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty Address -&gt; [Address]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Address -&gt; [Address]) -&gt; NonEmpty Address -&gt; [Address]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Address -&gt; NonEmpty Address
forall a. NonEmpty a -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.cycle</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Address
</span><a href="#local-6989586621682461787"><span class="hs-identifier hs-var">outputAddressesToCycle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2910"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([Selection (TxIn, TxOut)]
  -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
 -&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan)
-&gt; MigrationPlan -&gt; [Selection (TxIn, TxOut)]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;selections&quot;
  (([Selection (TxIn, TxOut)]
    -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
   -&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan)
([Selection (TxIn, TxOut)]
 -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
-&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan
</span><a href="#local-6989586621682461783"><span class="hs-var">#selections</span></a></span><span> </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682461789"><span class="hs-identifier hs-var">plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2911"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2912"></span><span>    </span><span class="annot"><a href="#local-6989586621682461785"><span class="hs-identifier hs-type">accumulate</span></a></span><span>
</span><span id="line-2913"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.Selection.html#Selection"><span class="hs-identifier hs-type">Migration.Selection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2914"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#SelectionWithoutChange"><span class="hs-identifier hs-type">SelectionWithoutChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2915"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#SelectionWithoutChange"><span class="hs-identifier hs-type">SelectionWithoutChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2916"></span><span>    </span><span id="local-6989586621682461785"><span class="annot"><span class="annottext">accumulate :: Selection (TxIn, TxOut)
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
-&gt; ([(SelectionWithoutChange, Withdrawal)], [Address])
</span><a href="#local-6989586621682461785"><span class="hs-identifier hs-var hs-var">accumulate</span></a></span></span><span> </span><span id="local-6989586621682461782"><span class="annot"><span class="annottext">Selection (TxIn, TxOut)
</span><a href="#local-6989586621682461782"><span class="hs-identifier hs-var">migrationSelection</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461781"><span class="annot"><span class="annottext">[(SelectionWithoutChange, Withdrawal)]
</span><a href="#local-6989586621682461781"><span class="hs-identifier hs-var">selectionWithdrawals</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461780"><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682461780"><span class="hs-identifier hs-var">outputAddresses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2917"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionWithoutChange
</span><a href="#local-6989586621682461779"><span class="hs-identifier hs-var">selection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461778"><span class="hs-identifier hs-var">withdrawal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SelectionWithoutChange, Withdrawal)
-&gt; [(SelectionWithoutChange, Withdrawal)]
-&gt; [(SelectionWithoutChange, Withdrawal)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(SelectionWithoutChange, Withdrawal)]
</span><a href="#local-6989586621682461781"><span class="hs-identifier hs-var">selectionWithdrawals</span></a></span><span>
</span><span id="line-2918"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682461777"><span class="hs-identifier hs-var">outputAddressesRemaining</span></a></span><span>
</span><span id="line-2919"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2920"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2921"></span><span>        </span><span id="local-6989586621682461779"><span class="annot"><span class="annottext">selection :: SelectionWithoutChange
</span><a href="#local-6989586621682461779"><span class="hs-identifier hs-var hs-var">selection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Selection :: forall change.
NonEmpty (TxIn, TxOut)
-&gt; [(TxIn, TxOut)]
-&gt; [TxOut]
-&gt; [change]
-&gt; TokenMap
-&gt; TokenMap
-&gt; Coin
-&gt; Coin
-&gt; SelectionOf change
</span><a href="Cardano.Wallet.CoinSelection.html#Selection"><span class="hs-identifier hs-type">Selection</span></a></span><span>
</span><span id="line-2922"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:inputs:Selection :: NonEmpty (TxIn, TxOut)
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3Ainputs%3ASelection"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((NonEmpty (TxIn, TxOut)
  -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
 -&gt; Selection (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (Selection (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut) -&gt; NonEmpty (TxIn, TxOut)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputIds&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; Selection (TxIn, TxOut)
   -&gt; Const (NonEmpty (TxIn, TxOut)) (Selection (TxIn, TxOut)))
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut)
-&gt; Const (NonEmpty (TxIn, TxOut)) (Selection (TxIn, TxOut))
</span><a href="#local-6989586621682461774"><span class="hs-var">#inputIds</span></a></span><span> </span><span class="annot"><span class="annottext">Selection (TxIn, TxOut)
</span><a href="#local-6989586621682461782"><span class="hs-identifier hs-var">migrationSelection</span></a></span><span>
</span><span id="line-2923"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateral:Selection :: [(TxIn, TxOut)]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3Acollateral%3ASelection"><span class="hs-identifier hs-var">collateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2924"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxOut]
$sel:outputs:Selection :: [TxOut]
outputs :: [TxOut]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3Aoutputs%3ASelection"><span class="hs-identifier hs-var hs-var">outputs</span></a></span><span>
</span><span id="line-2925"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
$sel:extraCoinSource:Selection :: Coin
extraCoinSource :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AextraCoinSource%3ASelection"><span class="hs-identifier hs-var hs-var">extraCoinSource</span></a></span><span>
</span><span id="line-2926"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:extraCoinSink:Selection :: Coin
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AextraCoinSink%3ASelection"><span class="hs-identifier hs-var">extraCoinSink</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2927"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:change:Selection :: [Void]
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3Achange%3ASelection"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2928"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assetsToMint:Selection :: TokenMap
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassetsToMint%3ASelection"><span class="hs-identifier hs-var">assetsToMint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#empty"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-2929"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assetsToBurn:Selection :: TokenMap
</span><a href="Cardano.Wallet.CoinSelection.html#%24sel%3AassetsToBurn%3ASelection"><span class="hs-identifier hs-var">assetsToBurn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#empty"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-2930"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2931"></span><span>
</span><span id="line-2932"></span><span>        </span><span class="hs-comment">-- NOTE:</span><span>
</span><span id="line-2933"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2934"></span><span>        </span><span class="hs-comment">-- Due to a quirk of history, we need to populate the 'extraCoinSource'</span><span>
</span><span id="line-2935"></span><span>        </span><span class="hs-comment">-- field with the reward withdrawal amount, since the transaction layer</span><span>
</span><span id="line-2936"></span><span>        </span><span class="hs-comment">-- uses the 'selectionDelta' function to calculate the final fee, and</span><span>
</span><span id="line-2937"></span><span>        </span><span class="hs-comment">-- that particular function doesn't know about reward withdrawals.</span><span>
</span><span id="line-2938"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2939"></span><span>        </span><span class="hs-comment">-- This is non-ideal, because we're returning the reward withdrawal</span><span>
</span><span id="line-2940"></span><span>        </span><span class="hs-comment">-- amount in two places in the output of this function.</span><span>
</span><span id="line-2941"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2942"></span><span>        </span><span class="hs-comment">-- In future, it would be better to return a single record whose fields</span><span>
</span><span id="line-2943"></span><span>        </span><span class="hs-comment">-- more closely resemble exactly what is needed to build a transaction,</span><span>
</span><span id="line-2944"></span><span>        </span><span class="hs-comment">-- and have the transaction layer calculate the actual fee based only</span><span>
</span><span id="line-2945"></span><span>        </span><span class="hs-comment">-- on the contents of that record.</span><span>
</span><span id="line-2946"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2947"></span><span>        </span><span id="local-6989586621682461770"><span class="annot"><span class="annottext">extraCoinSource :: Coin
</span><a href="#local-6989586621682461770"><span class="hs-identifier hs-var hs-var">extraCoinSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut) -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;rewardWithdrawal&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut)))
(Coin -&gt; Const Coin Coin)
-&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut))
</span><a href="#local-6989586621682461764"><span class="hs-var">#rewardWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">Selection (TxIn, TxOut)
</span><a href="#local-6989586621682461782"><span class="hs-identifier hs-var">migrationSelection</span></a></span><span>
</span><span id="line-2948"></span><span>
</span><span id="line-2949"></span><span>        </span><span id="local-6989586621682461778"><span class="annot"><span class="annottext">withdrawal :: Withdrawal
</span><a href="#local-6989586621682461778"><span class="hs-identifier hs-var hs-var">withdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2950"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut) -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;rewardWithdrawal&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut)))
(Coin -&gt; Const Coin Coin)
-&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut))
</span><a href="#local-6989586621682461763"><span class="hs-var">#rewardWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">Selection (TxIn, TxOut)
</span><a href="#local-6989586621682461782"><span class="hs-identifier hs-var">migrationSelection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2951"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461788"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span>
</span><span id="line-2952"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span>
</span><span id="line-2953"></span><span>
</span><span id="line-2954"></span><span>        </span><span class="annot"><a href="#local-6989586621682461772"><span class="hs-identifier hs-type">outputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2955"></span><span>        </span><span id="local-6989586621682461772"><span class="annot"><span class="annottext">outputs :: [TxOut]
</span><a href="#local-6989586621682461772"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Address -&gt; TokenBundle -&gt; TxOut)
-&gt; [Address] -&gt; [TokenBundle] -&gt; [TxOut]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span>
</span><span id="line-2956"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682461780"><span class="hs-identifier hs-var">outputAddresses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2957"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty TokenBundle -&gt; [TokenBundle]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty TokenBundle -&gt; [TokenBundle])
-&gt; NonEmpty TokenBundle -&gt; [TokenBundle]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty TokenBundle
  -&gt; Const (NonEmpty TokenBundle) (NonEmpty TokenBundle))
 -&gt; Selection (TxIn, TxOut)
 -&gt; Const (NonEmpty TokenBundle) (Selection (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut) -&gt; NonEmpty TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  ((NonEmpty TokenBundle
    -&gt; Const (NonEmpty TokenBundle) (NonEmpty TokenBundle))
   -&gt; Selection (TxIn, TxOut)
   -&gt; Const (NonEmpty TokenBundle) (Selection (TxIn, TxOut)))
(NonEmpty TokenBundle
 -&gt; Const (NonEmpty TokenBundle) (NonEmpty TokenBundle))
-&gt; Selection (TxIn, TxOut)
-&gt; Const (NonEmpty TokenBundle) (Selection (TxIn, TxOut))
</span><a href="#local-6989586621682461761"><span class="hs-var">#outputs</span></a></span><span> </span><span class="annot"><span class="annottext">Selection (TxIn, TxOut)
</span><a href="#local-6989586621682461782"><span class="hs-identifier hs-var">migrationSelection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2958"></span><span>
</span><span id="line-2959"></span><span>        </span><span class="annot"><a href="#local-6989586621682461777"><span class="hs-identifier hs-type">outputAddressesRemaining</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2960"></span><span>        </span><span id="local-6989586621682461777"><span class="annot"><span class="annottext">outputAddressesRemaining :: [Address]
</span><a href="#local-6989586621682461777"><span class="hs-identifier hs-var hs-var">outputAddressesRemaining</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2961"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; [Address] -&gt; [Address]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxOut] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682461772"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682461780"><span class="hs-identifier hs-var">outputAddresses</span></a></span><span>
</span><span id="line-2962"></span><span>
</span><span id="line-2963"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Delegation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-2966"></span><span>
</span><span id="line-2967"></span><span class="annot"><a href="Cardano.Wallet.html#joinStakePool"><span class="hs-identifier hs-type">joinStakePool</span></a></span><span>
</span><span id="line-2968"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461758"><span class="annot"><a href="#local-6989586621682461758"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461757"><span class="annot"><a href="#local-6989586621682461757"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461756"><span class="annot"><a href="#local-6989586621682461756"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2969"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461757"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461756"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461758"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2970"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461758"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2971"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasLogger"><span class="hs-identifier hs-type">HasLogger</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461758"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2972"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2973"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461758"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2974"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#EpochNo"><span class="hs-identifier hs-type">W.EpochNo</span></a></span><span>
</span><span id="line-2975"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-2976"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-2977"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier hs-type">PoolLifeCycleStatus</span></a></span><span>
</span><span id="line-2978"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2979"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegation"><span class="hs-identifier hs-type">ErrStakePoolDelegation</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#DelegationAction"><span class="hs-identifier hs-type">DelegationAction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2980"></span><span>    </span><span class="hs-comment">-- ^ snd is the deposit</span><span>
</span><span id="line-2981"></span><span id="joinStakePool"><span class="annot"><span class="annottext">joinStakePool :: ctx
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
</span><a href="Cardano.Wallet.html#joinStakePool"><span class="hs-identifier hs-var hs-var">joinStakePool</span></a></span></span><span> </span><span id="local-6989586621682461755"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461755"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461754"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682461754"><span class="hs-identifier hs-var">currentEpoch</span></a></span></span><span> </span><span id="local-6989586621682461753"><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682461753"><span class="hs-identifier hs-var">knownPools</span></a></span></span><span> </span><span id="local-6989586621682461752"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682461752"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621682461751"><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682461751"><span class="hs-identifier hs-var">poolStatus</span></a></span></span><span> </span><span id="local-6989586621682461750"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461750"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2982"></span><span>    </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461749"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT
         ErrStakePoolDelegation IO (DelegationAction, Maybe Coin))
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461723"><span id="local-6989586621682461724"><span id="local-6989586621682461725"><span id="local-6989586621682461726"><span id="local-6989586621682461727"><span id="local-6989586621682461728"><span id="local-6989586621682461729"><span id="local-6989586621682461730"><span id="local-6989586621682461731"><span id="local-6989586621682461732"><span id="local-6989586621682461733"><span id="local-6989586621682461734"><span id="local-6989586621682461735"><span id="local-6989586621682461736"><span id="local-6989586621682461737"><span id="local-6989586621682461738"><span id="local-6989586621682461739"><span id="local-6989586621682461740"><span id="local-6989586621682461741"><span id="local-6989586621682461742"><span id="local-6989586621682461743"><span id="local-6989586621682461744"><span id="local-6989586621682461745"><span id="local-6989586621682461746"><span id="local-6989586621682461747"><span id="local-6989586621682461748"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461723"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2983"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682461722"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461722"><span class="hs-identifier hs-var">walMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461721"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682461721"><span class="hs-identifier hs-var">isKeyReg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrStakePoolDelegation (WalletMetadata, Bool))
 -&gt; IO (Either ErrStakePoolDelegation (WalletMetadata, Bool)))
-&gt; ExceptT ErrStakePoolDelegation stm (WalletMetadata, Bool)
-&gt; ExceptT ErrStakePoolDelegation IO (WalletMetadata, Bool)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrStakePoolDelegation (WalletMetadata, Bool))
-&gt; IO (Either ErrStakePoolDelegation (WalletMetadata, Bool))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461723"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation stm (WalletMetadata, Bool)
 -&gt; ExceptT ErrStakePoolDelegation IO (WalletMetadata, Bool))
-&gt; ExceptT ErrStakePoolDelegation stm (WalletMetadata, Bool)
-&gt; ExceptT ErrStakePoolDelegation IO (WalletMetadata, Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2984"></span><span>            </span><span id="local-6989586621682461720"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461720"><span class="hs-identifier hs-var">walMeta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrStakePoolDelegation)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
-&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrStakePoolDelegation
</span><a href="Cardano.Wallet.html#ErrStakePoolDelegationNoSuchWallet"><span class="hs-identifier hs-var">ErrStakePoolDelegationNoSuchWallet</span></a></span><span>
</span><span id="line-2985"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm WalletMetadata
 -&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
-&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461750"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2986"></span><span>                </span><span class="annot"><span class="annottext">(stm (Maybe WalletMetadata)
 -&gt; ExceptT ErrNoSuchWallet stm WalletMetadata)
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe WalletMetadata)
</span><a href="#local-6989586621682461740"><span class="hs-identifier hs-var">readWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461750"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2987"></span><span>            </span><span id="local-6989586621682461718"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682461718"><span class="hs-identifier hs-var">isKeyReg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrStakePoolDelegation)
-&gt; ExceptT ErrNoSuchWallet stm Bool
-&gt; ExceptT ErrStakePoolDelegation stm Bool
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrStakePoolDelegation
</span><a href="Cardano.Wallet.html#ErrStakePoolDelegationNoSuchWallet"><span class="hs-identifier hs-var">ErrStakePoolDelegationNoSuchWallet</span></a></span><span>
</span><span id="line-2988"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm Bool
 -&gt; ExceptT ErrStakePoolDelegation stm Bool)
-&gt; ExceptT ErrNoSuchWallet stm Bool
-&gt; ExceptT ErrStakePoolDelegation stm Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
</span><a href="#local-6989586621682461739"><span class="hs-identifier hs-var">isStakeKeyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461750"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2989"></span><span>            </span><span class="annot"><span class="annottext">(WalletMetadata, Bool)
-&gt; ExceptT ErrStakePoolDelegation stm (WalletMetadata, Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461720"><span class="hs-identifier hs-var">walMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682461718"><span class="hs-identifier hs-var">isKeyReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2990"></span><span>
</span><span id="line-2991"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461717"><span class="annot"><span class="annottext">mRetirementEpoch :: Maybe EpochNo
</span><a href="#local-6989586621682461717"><span class="hs-identifier hs-var hs-var">mRetirementEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EpochNo -&gt; Const EpochNo EpochNo)
 -&gt; PoolRetirementCertificate
 -&gt; Const EpochNo PoolRetirementCertificate)
-&gt; PoolRetirementCertificate -&gt; EpochNo
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;retirementEpoch&quot;
  ((EpochNo -&gt; Const EpochNo EpochNo)
   -&gt; PoolRetirementCertificate
   -&gt; Const EpochNo PoolRetirementCertificate)
(EpochNo -&gt; Const EpochNo EpochNo)
-&gt; PoolRetirementCertificate
-&gt; Const EpochNo PoolRetirementCertificate
</span><a href="#local-6989586621682461716"><span class="hs-var">#retirementEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">(PoolRetirementCertificate -&gt; EpochNo)
-&gt; Maybe PoolRetirementCertificate -&gt; Maybe EpochNo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2992"></span><span>                </span><span class="annot"><span class="annottext">PoolLifeCycleStatus -&gt; Maybe PoolRetirementCertificate
</span><a href="Cardano.Wallet.Primitive.Types.html#getPoolRetirementCertificate"><span class="hs-identifier hs-var">W.getPoolRetirementCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682461751"><span class="hs-identifier hs-var">poolStatus</span></a></span><span>
</span><span id="line-2993"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461714"><span class="annot"><span class="annottext">retirementInfo :: Maybe PoolRetirementEpochInfo
</span><a href="#local-6989586621682461714"><span class="hs-identifier hs-var hs-var">retirementInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2994"></span><span>                </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; PoolRetirementEpochInfo
</span><a href="Cardano.Wallet.html#PoolRetirementEpochInfo"><span class="hs-identifier hs-var">PoolRetirementEpochInfo</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682461754"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; PoolRetirementEpochInfo)
-&gt; Maybe EpochNo -&gt; Maybe PoolRetirementEpochInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EpochNo
</span><a href="#local-6989586621682461717"><span class="hs-identifier hs-var">mRetirementEpoch</span></a></span><span>
</span><span id="line-2995"></span><span>
</span><span id="line-2996"></span><span>        </span><span class="annot"><span class="annottext">(ErrCannotJoin -&gt; ErrStakePoolDelegation)
-&gt; ExceptT ErrCannotJoin IO ()
-&gt; ExceptT ErrStakePoolDelegation IO ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; ErrStakePoolDelegation
</span><a href="Cardano.Wallet.html#ErrStakePoolJoin"><span class="hs-identifier hs-var">ErrStakePoolJoin</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCannotJoin IO ()
 -&gt; ExceptT ErrStakePoolDelegation IO ())
-&gt; ExceptT ErrCannotJoin IO ()
-&gt; ExceptT ErrStakePoolDelegation IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrCannotJoin () -&gt; ExceptT ErrCannotJoin IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; Either e a -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">except</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotJoin () -&gt; ExceptT ErrCannotJoin IO ())
-&gt; Either ErrCannotJoin () -&gt; ExceptT ErrCannotJoin IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2997"></span><span>            </span><span class="annot"><span class="annottext">Set PoolId
-&gt; WalletDelegation
-&gt; PoolId
-&gt; Maybe PoolRetirementEpochInfo
-&gt; Either ErrCannotJoin ()
</span><a href="Cardano.Wallet.html#guardJoin"><span class="hs-identifier hs-var">guardJoin</span></a></span><span> </span><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682461753"><span class="hs-identifier hs-var">knownPools</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461722"><span class="hs-identifier hs-var">walMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
    -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
-&gt; WalletDelegation
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
   -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
(WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
-&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata
</span><a href="#local-6989586621682461711"><span class="hs-var">#delegation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682461752"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PoolRetirementEpochInfo
</span><a href="#local-6989586621682461714"><span class="hs-identifier hs-var">retirementInfo</span></a></span><span>
</span><span id="line-2998"></span><span>
</span><span id="line-2999"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ExceptT ErrStakePoolDelegation IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ExceptT ErrStakePoolDelegation IO ())
-&gt; IO () -&gt; ExceptT ErrStakePoolDelegation IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog -&gt; WalletLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletLog
</span><a href="#local-6989586621682461710"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; IO ()) -&gt; WalletLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WalletLog
</span><a href="Cardano.Wallet.html#MsgIsStakeKeyRegistered"><span class="hs-identifier hs-var">MsgIsStakeKeyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682461721"><span class="hs-identifier hs-var">isKeyReg</span></a></span><span>
</span><span id="line-3000"></span><span>
</span><span id="line-3001"></span><span>        </span><span id="local-6989586621682461708"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682461708"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Coin -&gt; ExceptT ErrStakePoolDelegation IO Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; ExceptT ErrStakePoolDelegation IO Coin)
-&gt; IO Coin -&gt; ExceptT ErrStakePoolDelegation IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Coin) -&gt; IO ProtocolParameters -&gt; IO Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682461706"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3002"></span><span>
</span><span id="line-3003"></span><span>        </span><span class="annot"><span class="annottext">(DelegationAction, Maybe Coin)
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">((DelegationAction, Maybe Coin)
 -&gt; ExceptT
      ErrStakePoolDelegation IO (DelegationAction, Maybe Coin))
-&gt; (DelegationAction, Maybe Coin)
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682461721"><span class="hs-identifier hs-var">isKeyReg</span></a></span><span>
</span><span id="line-3004"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#Join"><span class="hs-identifier hs-var">Join</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682461752"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3005"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#RegisterKeyAndJoin"><span class="hs-identifier hs-var">RegisterKeyAndJoin</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682461752"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682461708"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3006"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3007"></span><span>    </span><span id="local-6989586621682461749"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461749"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461755"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461757"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461756"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3008"></span><span>    </span><span id="local-6989586621682461710"><span class="annot"><span class="annottext">tr :: Tracer IO WalletLog
</span><a href="#local-6989586621682461710"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WalletLog -&gt; WalletWorkerLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO WalletLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLog -&gt; WalletWorkerLog
</span><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO WalletWorkerLog -&gt; Tracer IO WalletLog)
-&gt; Tracer IO WalletWorkerLog -&gt; Tracer IO WalletLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461755"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Tracer IO WalletWorkerLog
     -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
    -&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx)
-&gt; Tracer IO WalletWorkerLog
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO WalletWorkerLog
 -&gt; Const (Tracer IO WalletWorkerLog) (Tracer IO WalletWorkerLog))
-&gt; ctx -&gt; Const (Tracer IO WalletWorkerLog) ctx
forall (m :: * -&gt; *) msg ctx.
HasLogger m msg ctx =&gt;
Lens' ctx (Tracer m msg)
</span><a href="Cardano.Wallet.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-3009"></span><span>    </span><span id="local-6989586621682461706"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682461706"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461755"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-3010"></span><span>
</span><span id="line-3011"></span><span class="hs-comment">-- | Helper function to factor necessary logic for quitting a stake pool.</span><span>
</span><span id="line-3012"></span><span class="annot"><a href="Cardano.Wallet.html#quitStakePool"><span class="hs-identifier hs-type">quitStakePool</span></a></span><span>
</span><span id="line-3013"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461704"><span class="annot"><a href="#local-6989586621682461704"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461703"><span class="annot"><a href="#local-6989586621682461703"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461702"><span class="annot"><a href="#local-6989586621682461702"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3014"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461703"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461702"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461704"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3015"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3016"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461704"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3017"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3018"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-3019"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegation"><span class="hs-identifier hs-type">ErrStakePoolDelegation</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#DelegationAction"><span class="hs-identifier hs-type">DelegationAction</span></a></span><span>
</span><span id="line-3020"></span><span id="quitStakePool"><span class="annot"><span class="annottext">quitStakePool :: ctx
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
</span><a href="Cardano.Wallet.html#quitStakePool"><span class="hs-identifier hs-var hs-var">quitStakePool</span></a></span></span><span> </span><span id="local-6989586621682461701"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461701"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461700"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461700"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461699"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461699"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461698"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrStakePoolDelegation IO DelegationAction)
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461672"><span id="local-6989586621682461673"><span id="local-6989586621682461674"><span id="local-6989586621682461675"><span id="local-6989586621682461676"><span id="local-6989586621682461677"><span id="local-6989586621682461678"><span id="local-6989586621682461679"><span id="local-6989586621682461680"><span id="local-6989586621682461681"><span id="local-6989586621682461682"><span id="local-6989586621682461683"><span id="local-6989586621682461684"><span id="local-6989586621682461685"><span id="local-6989586621682461686"><span id="local-6989586621682461687"><span id="local-6989586621682461688"><span id="local-6989586621682461689"><span id="local-6989586621682461690"><span id="local-6989586621682461691"><span id="local-6989586621682461692"><span id="local-6989586621682461693"><span id="local-6989586621682461694"><span id="local-6989586621682461695"><span id="local-6989586621682461696"><span id="local-6989586621682461697"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461672"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3021"></span><span>    </span><span id="local-6989586621682461671"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461671"><span class="hs-identifier hs-var">walMeta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrStakePoolDelegation WalletMetadata)
 -&gt; IO (Either ErrStakePoolDelegation WalletMetadata))
-&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata
-&gt; ExceptT ErrStakePoolDelegation IO WalletMetadata
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrStakePoolDelegation WalletMetadata)
-&gt; IO (Either ErrStakePoolDelegation WalletMetadata)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461672"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-3022"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation stm WalletMetadata
 -&gt; ExceptT ErrStakePoolDelegation IO WalletMetadata)
-&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata
-&gt; ExceptT ErrStakePoolDelegation IO WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrStakePoolDelegation)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
-&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrStakePoolDelegation
</span><a href="Cardano.Wallet.html#ErrStakePoolDelegationNoSuchWallet"><span class="hs-identifier hs-var">ErrStakePoolDelegationNoSuchWallet</span></a></span><span>
</span><span id="line-3023"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm WalletMetadata
 -&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
-&gt; ExceptT ErrStakePoolDelegation stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461700"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3024"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe WalletMetadata)
 -&gt; ExceptT ErrNoSuchWallet stm WalletMetadata)
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe WalletMetadata)
</span><a href="#local-6989586621682461689"><span class="hs-identifier hs-var">readWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461700"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3025"></span><span>
</span><span id="line-3026"></span><span>    </span><span id="local-6989586621682461670"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682461670"><span class="hs-identifier hs-var">rewards</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Coin -&gt; ExceptT ErrStakePoolDelegation IO Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span>
</span><span id="line-3027"></span><span>        </span><span class="annot"><span class="annottext">(IO Coin -&gt; ExceptT ErrStakePoolDelegation IO Coin)
-&gt; IO Coin -&gt; ExceptT ErrStakePoolDelegation IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx -&gt; WalletId -&gt; IO Coin
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx -&gt; WalletId -&gt; IO Coin
</span><a href="Cardano.Wallet.html#fetchRewardBalance"><span class="hs-identifier hs-var">fetchRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461704"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461703"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461702"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461701"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461700"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3028"></span><span>
</span><span id="line-3029"></span><span>    </span><span class="annot"><span class="annottext">(ErrCannotQuit -&gt; ErrStakePoolDelegation)
-&gt; ExceptT ErrCannotQuit IO ()
-&gt; ExceptT ErrStakePoolDelegation IO ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit -&gt; ErrStakePoolDelegation
</span><a href="Cardano.Wallet.html#ErrStakePoolQuit"><span class="hs-identifier hs-var">ErrStakePoolQuit</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCannotQuit IO ()
 -&gt; ExceptT ErrStakePoolDelegation IO ())
-&gt; ExceptT ErrCannotQuit IO ()
-&gt; ExceptT ErrStakePoolDelegation IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrCannotQuit () -&gt; ExceptT ErrCannotQuit IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; Either e a -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">except</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotQuit () -&gt; ExceptT ErrCannotQuit IO ())
-&gt; Either ErrCannotQuit () -&gt; ExceptT ErrCannotQuit IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3030"></span><span>        </span><span class="annot"><span class="annottext">WalletDelegation -&gt; Withdrawal -&gt; Coin -&gt; Either ErrCannotQuit ()
</span><a href="Cardano.Wallet.html#guardQuit"><span class="hs-identifier hs-var">guardQuit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461671"><span class="hs-identifier hs-var">walMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
    -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
-&gt; WalletDelegation
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
   -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
(WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
-&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata
</span><a href="#local-6989586621682461668"><span class="hs-var">#delegation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682461699"><span class="hs-identifier hs-var">wdrl</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682461670"><span class="hs-identifier hs-var">rewards</span></a></span><span>
</span><span id="line-3031"></span><span>
</span><span id="line-3032"></span><span>    </span><span class="annot"><span class="annottext">DelegationAction
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#Quit"><span class="hs-identifier hs-var">Quit</span></a></span><span>
</span><span id="line-3033"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3034"></span><span>    </span><span id="local-6989586621682461698"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461698"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461701"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461703"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461702"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3035"></span><span>
</span><span id="line-3036"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                 Fee Estimation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3039"></span><span>
</span><span id="line-3040"></span><span class="hs-comment">-- | Result of a fee estimation process given a wallet and payment order.</span><span>
</span><span id="line-3041"></span><span id="local-6989586621682461666"><span id="local-6989586621682461667"></span></span><span class="hs-keyword">data</span><span> </span><span id="FeeEstimation"><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-var">FeeEstimation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FeeEstimation"><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-var">FeeEstimation</span></a></span></span><span>
</span><span id="line-3042"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AestMinFee%3AFeeEstimation"><span class="annot"><span class="annottext">FeeEstimation -&gt; Word64
</span><a href="Cardano.Wallet.html#%24sel%3AestMinFee%3AFeeEstimation"><span class="hs-identifier hs-var hs-var">estMinFee</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-3043"></span><span>    </span><span class="hs-comment">-- ^ Most coin selections will result in a fee higher than this.</span><span>
</span><span id="line-3044"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AestMaxFee%3AFeeEstimation"><span class="annot"><span class="annottext">FeeEstimation -&gt; Word64
</span><a href="Cardano.Wallet.html#%24sel%3AestMaxFee%3AFeeEstimation"><span class="hs-identifier hs-var hs-var">estMaxFee</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-3045"></span><span>    </span><span class="hs-comment">-- ^ Most coin selections will result in a fee lower than this.</span><span>
</span><span id="line-3046"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461657"><span id="local-6989586621682461659"><span id="local-6989586621682461661"><span class="annot"><span class="annottext">Int -&gt; FeeEstimation -&gt; ShowS
[FeeEstimation] -&gt; ShowS
FeeEstimation -&gt; String
(Int -&gt; FeeEstimation -&gt; ShowS)
-&gt; (FeeEstimation -&gt; String)
-&gt; ([FeeEstimation] -&gt; ShowS)
-&gt; Show FeeEstimation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FeeEstimation] -&gt; ShowS
$cshowList :: [FeeEstimation] -&gt; ShowS
show :: FeeEstimation -&gt; String
$cshow :: FeeEstimation -&gt; String
showsPrec :: Int -&gt; FeeEstimation -&gt; ShowS
$cshowsPrec :: Int -&gt; FeeEstimation -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461653"><span id="local-6989586621682461655"><span class="annot"><span class="annottext">FeeEstimation -&gt; FeeEstimation -&gt; Bool
(FeeEstimation -&gt; FeeEstimation -&gt; Bool)
-&gt; (FeeEstimation -&gt; FeeEstimation -&gt; Bool) -&gt; Eq FeeEstimation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: FeeEstimation -&gt; FeeEstimation -&gt; Bool
$c/= :: FeeEstimation -&gt; FeeEstimation -&gt; Bool
== :: FeeEstimation -&gt; FeeEstimation -&gt; Bool
$c== :: FeeEstimation -&gt; FeeEstimation -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. FeeEstimation -&gt; Rep FeeEstimation x)
-&gt; (forall x. Rep FeeEstimation x -&gt; FeeEstimation)
-&gt; Generic FeeEstimation
forall x. Rep FeeEstimation x -&gt; FeeEstimation
forall x. FeeEstimation -&gt; Rep FeeEstimation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep FeeEstimation x -&gt; FeeEstimation
$cfrom :: forall x. FeeEstimation -&gt; Rep FeeEstimation x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3047"></span><span>
</span><span id="line-3048"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682461649"><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-type">FeeEstimation</span></a></span></span><span>
</span><span id="line-3049"></span><span>
</span><span id="line-3050"></span><span class="hs-comment">-- | Calculate the minimum deposit necessary if a given wallet wanted to</span><span>
</span><span id="line-3051"></span><span class="hs-comment">-- delegate to a pool. Said differently, this return either 0, or the value of</span><span>
</span><span id="line-3052"></span><span class="hs-comment">-- the key deposit protocol parameters if the wallet has no registered stake</span><span>
</span><span id="line-3053"></span><span class="hs-comment">-- key.</span><span>
</span><span id="line-3054"></span><span class="annot"><a href="Cardano.Wallet.html#calcMinimumDeposit"><span class="hs-identifier hs-type">calcMinimumDeposit</span></a></span><span>
</span><span id="line-3055"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461647"><span class="annot"><a href="#local-6989586621682461647"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461646"><span class="annot"><a href="#local-6989586621682461646"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461645"><span class="annot"><a href="#local-6989586621682461645"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3056"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461646"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461645"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461647"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3057"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461647"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3058"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3059"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461647"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3060"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3061"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-3062"></span><span id="calcMinimumDeposit"><span class="annot"><span class="annottext">calcMinimumDeposit :: ctx -&gt; WalletId -&gt; ExceptT ErrSelectAssets IO Coin
</span><a href="Cardano.Wallet.html#calcMinimumDeposit"><span class="hs-identifier hs-var hs-var">calcMinimumDeposit</span></a></span></span><span> </span><span id="local-6989586621682461644"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461644"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461643"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461643"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461642"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrSelectAssets IO Coin)
-&gt; ExceptT ErrSelectAssets IO Coin
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461616"><span id="local-6989586621682461617"><span id="local-6989586621682461618"><span id="local-6989586621682461619"><span id="local-6989586621682461620"><span id="local-6989586621682461621"><span id="local-6989586621682461622"><span id="local-6989586621682461623"><span id="local-6989586621682461624"><span id="local-6989586621682461625"><span id="local-6989586621682461626"><span id="local-6989586621682461627"><span id="local-6989586621682461628"><span id="local-6989586621682461629"><span id="local-6989586621682461630"><span id="local-6989586621682461631"><span id="local-6989586621682461632"><span id="local-6989586621682461633"><span id="local-6989586621682461634"><span id="local-6989586621682461635"><span id="local-6989586621682461636"><span id="local-6989586621682461637"><span id="local-6989586621682461638"><span id="local-6989586621682461639"><span id="local-6989586621682461640"><span id="local-6989586621682461641"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461616"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3063"></span><span>    </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrSelectAssets)
-&gt; ExceptT ErrNoSuchWallet IO Coin
-&gt; ExceptT ErrSelectAssets IO Coin
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSelectAssets
</span><a href="Cardano.Wallet.html#ErrSelectAssetsNoSuchWallet"><span class="hs-identifier hs-var">ErrSelectAssetsNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO Coin
 -&gt; ExceptT ErrSelectAssets IO Coin)
-&gt; ExceptT ErrNoSuchWallet IO Coin
-&gt; ExceptT ErrSelectAssets IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3064"></span><span>        </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet Bool)
 -&gt; IO (Either ErrNoSuchWallet Bool))
-&gt; ExceptT ErrNoSuchWallet stm Bool
-&gt; ExceptT ErrNoSuchWallet IO Bool
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet Bool)
-&gt; IO (Either ErrNoSuchWallet Bool)
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461616"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
</span><a href="#local-6989586621682461632"><span class="hs-identifier hs-var">isStakeKeyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461643"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO Bool
-&gt; (Bool -&gt; ExceptT ErrNoSuchWallet IO Coin)
-&gt; ExceptT ErrNoSuchWallet IO Coin
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3065"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3066"></span><span>                </span><span class="annot"><span class="annottext">Coin -&gt; ExceptT ErrNoSuchWallet IO Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; ExceptT ErrNoSuchWallet IO Coin)
-&gt; Coin -&gt; ExceptT ErrNoSuchWallet IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-3067"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3068"></span><span>                </span><span class="annot"><span class="annottext">IO Coin -&gt; ExceptT ErrNoSuchWallet IO Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; ExceptT ErrNoSuchWallet IO Coin)
-&gt; IO Coin -&gt; ExceptT ErrNoSuchWallet IO Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Coin) -&gt; IO ProtocolParameters -&gt; IO Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682461614"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3069"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3070"></span><span>    </span><span id="local-6989586621682461642"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461642"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461644"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461646"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461645"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3071"></span><span>    </span><span id="local-6989586621682461614"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682461614"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461644"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-3072"></span><span>
</span><span id="line-3073"></span><span class="hs-comment">-- | Estimate the transaction fee for a given coin selection algorithm by</span><span>
</span><span id="line-3074"></span><span class="hs-comment">-- repeatedly running it (100 times) and collecting the results. In the returned</span><span>
</span><span id="line-3075"></span><span class="hs-comment">-- 'FeeEstimation', the minimum fee is that which 90% of the sampled fees are</span><span>
</span><span id="line-3076"></span><span class="hs-comment">-- greater than. The maximum fee is the highest fee observed in the samples.</span><span>
</span><span id="line-3077"></span><span class="annot"><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier hs-type">estimateFee</span></a></span><span>
</span><span id="line-3078"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461613"><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3079"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-3080"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-type">FeeEstimation</span></a></span><span>
</span><span id="line-3081"></span><span id="estimateFee"><span class="annot"><span class="annottext">estimateFee :: ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m FeeEstimation
</span><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier hs-var hs-var">estimateFee</span></a></span></span><span>
</span><span id="line-3082"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Natural] -&gt; FeeEstimation)
-&gt; ExceptT ErrSelectAssets m [Natural]
-&gt; ExceptT ErrSelectAssets m FeeEstimation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural] -&gt; FeeEstimation
</span><a href="#local-6989586621682461612"><span class="hs-identifier hs-var">deciles</span></a></span><span>
</span><span id="line-3083"></span><span>    </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets m [Natural]
 -&gt; ExceptT ErrSelectAssets m FeeEstimation)
-&gt; (ExceptT ErrSelectAssets m Coin
    -&gt; ExceptT ErrSelectAssets m [Natural])
-&gt; ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m FeeEstimation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m [Either ErrSelectAssets Natural]
-&gt; ExceptT ErrSelectAssets m [Natural]
forall err a. m [Either err a] -&gt; ExceptT err m [a]
</span><a href="#local-6989586621682461611"><span class="hs-identifier hs-var">handleErrors</span></a></span><span>
</span><span id="line-3084"></span><span>    </span><span class="annot"><span class="annottext">(m [Either ErrSelectAssets Natural]
 -&gt; ExceptT ErrSelectAssets m [Natural])
-&gt; (ExceptT ErrSelectAssets m Coin
    -&gt; m [Either ErrSelectAssets Natural])
-&gt; ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m [Natural]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; m (Either ErrSelectAssets Natural)
-&gt; m [Either ErrSelectAssets Natural]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682461610"><span class="hs-identifier hs-var">repeats</span></a></span><span>
</span><span id="line-3085"></span><span>    </span><span class="annot"><span class="annottext">(m (Either ErrSelectAssets Natural)
 -&gt; m [Either ErrSelectAssets Natural])
-&gt; (ExceptT ErrSelectAssets m Coin
    -&gt; m (Either ErrSelectAssets Natural))
-&gt; ExceptT ErrSelectAssets m Coin
-&gt; m [Either ErrSelectAssets Natural]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets m Natural
-&gt; m (Either ErrSelectAssets Natural)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span>
</span><span id="line-3086"></span><span>    </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets m Natural
 -&gt; m (Either ErrSelectAssets Natural))
-&gt; (ExceptT ErrSelectAssets m Coin
    -&gt; ExceptT ErrSelectAssets m Natural)
-&gt; ExceptT ErrSelectAssets m Coin
-&gt; m (Either ErrSelectAssets Natural)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Natural)
-&gt; ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span>
</span><span id="line-3087"></span><span>    </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets m Coin
 -&gt; ExceptT ErrSelectAssets m Natural)
-&gt; (ExceptT ErrSelectAssets m Coin
    -&gt; ExceptT ErrSelectAssets m Coin)
-&gt; ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets m Coin
-&gt; (ErrSelectAssets -&gt; ExceptT ErrSelectAssets m Coin)
-&gt; ExceptT ErrSelectAssets m Coin
forall (m :: * -&gt; *) e a e'.
Monad m =&gt;
ExceptT e m a -&gt; (e -&gt; ExceptT e' m a) -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-operator hs-var">`catchE`</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ExceptT ErrSelectAssets m Coin
</span><a href="#local-6989586621682461609"><span class="hs-identifier hs-var">handleCannotCover</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3088"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3089"></span><span>    </span><span class="hs-comment">-- Use method R-8 from to get top 90%.</span><span>
</span><span id="line-3090"></span><span>    </span><span class="hs-comment">-- https://en.wikipedia.org/wiki/Quantile#Estimating_quantiles_from_a_sample</span><span>
</span><span id="line-3091"></span><span>    </span><span id="local-6989586621682461612"><span class="annot"><span class="annottext">deciles :: [Natural] -&gt; FeeEstimation
</span><a href="#local-6989586621682461612"><span class="hs-identifier hs-var hs-var">deciles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word64] -&gt; FeeEstimation
</span><a href="#local-6989586621682461608"><span class="hs-identifier hs-var">mkFeeEstimation</span></a></span><span>
</span><span id="line-3092"></span><span>        </span><span class="annot"><span class="annottext">([Word64] -&gt; FeeEstimation)
-&gt; ([Natural] -&gt; [Word64]) -&gt; [Natural] -&gt; FeeEstimation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Word64) -&gt; [Double] -&gt; [Word64]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Word64
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">round</span></a></span><span>
</span><span id="line-3093"></span><span>        </span><span class="annot"><span class="annottext">([Double] -&gt; [Word64])
-&gt; ([Natural] -&gt; [Double]) -&gt; [Natural] -&gt; [Word64]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; [Double]
forall a. Vector a -&gt; [a]
</span><a href="../../../../vector/html/src"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-3094"></span><span>        </span><span class="annot"><span class="annottext">(Vector Double -&gt; [Double])
-&gt; ([Natural] -&gt; Vector Double) -&gt; [Natural] -&gt; [Double]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContParam -&gt; Vector Int -&gt; Int -&gt; Vector Double -&gt; Vector Double
forall (v :: * -&gt; *) (f :: * -&gt; *).
(Vector v Double, Foldable f, Functor f) =&gt;
ContParam -&gt; f Int -&gt; Int -&gt; v Double -&gt; f Double
</span><a href="../../../../statistics/html/src"><span class="hs-identifier hs-var">quantiles</span></a></span><span> </span><span class="annot"><span class="annottext">ContParam
</span><a href="../../../../statistics/html/src"><span class="hs-identifier hs-var">medianUnbiased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Vector Int
forall a. [a] -&gt; Vector a
</span><a href="../../../../vector/html/src"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-3095"></span><span>        </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; ([Natural] -&gt; Vector Double) -&gt; [Natural] -&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Vector Double
forall a. [a] -&gt; Vector a
</span><a href="../../../../vector/html/src"><span class="hs-identifier hs-var">V.fromList</span></a></span><span>
</span><span id="line-3096"></span><span>        </span><span class="annot"><span class="annottext">([Double] -&gt; Vector Double)
-&gt; ([Natural] -&gt; [Double]) -&gt; [Natural] -&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Double) -&gt; [Natural] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span>
</span><span id="line-3097"></span><span>    </span><span id="local-6989586621682461608"><span class="annot"><span class="annottext">mkFeeEstimation :: [Word64] -&gt; FeeEstimation
</span><a href="#local-6989586621682461608"><span class="hs-identifier hs-var hs-var">mkFeeEstimation</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682461605"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682461605"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682461604"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682461604"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; FeeEstimation
</span><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-var">FeeEstimation</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682461605"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682461604"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-3098"></span><span>    </span><span class="annot"><a href="#local-6989586621682461608"><span class="hs-identifier hs-var">mkFeeEstimation</span></a></span><span> </span><span class="annot"><span class="annottext">[Word64]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FeeEstimation
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;estimateFee: impossible&quot;</span></span><span>
</span><span id="line-3099"></span><span>
</span><span id="line-3100"></span><span>    </span><span class="hs-comment">-- Remove failed coin selections from samples. Unless they all failed, in</span><span>
</span><span id="line-3101"></span><span>    </span><span class="hs-comment">-- which case pass on the error.</span><span>
</span><span id="line-3102"></span><span>    </span><span id="local-6989586621682464375"><span id="local-6989586621682464376"><span class="annot"><a href="#local-6989586621682461611"><span class="hs-identifier hs-type">handleErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464376"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464375"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464376"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682464375"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-3103"></span><span>    </span><span id="local-6989586621682461611"><span class="annot"><span class="annottext">handleErrors :: m [Either err a] -&gt; ExceptT err m [a]
</span><a href="#local-6989586621682461611"><span class="hs-identifier hs-var hs-var">handleErrors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either err [a]) -&gt; ExceptT err m [a]
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either err [a]) -&gt; ExceptT err m [a])
-&gt; (m [Either err a] -&gt; m (Either err [a]))
-&gt; m [Either err a]
-&gt; ExceptT err m [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([Either err a] -&gt; Either err [a])
-&gt; m [Either err a] -&gt; m (Either err [a])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[Either err a] -&gt; Either err [a]
forall a b. [Either a b] -&gt; Either a [b]
</span><a href="#local-6989586621682461602"><span class="hs-identifier hs-var">skipFailed</span></a></span><span>
</span><span id="line-3104"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3105"></span><span>        </span><span id="local-6989586621682461602"><span class="annot"><span class="annottext">skipFailed :: [Either a b] -&gt; Either a [b]
</span><a href="#local-6989586621682461602"><span class="hs-identifier hs-var hs-var">skipFailed</span></a></span></span><span> </span><span id="local-6989586621682461601"><span class="annot"><span class="annottext">[Either a b]
</span><a href="#local-6989586621682461601"><span class="hs-identifier hs-var">samples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either a b] -&gt; ([a], [b])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either a b]
</span><a href="#local-6989586621682461601"><span class="hs-identifier hs-var">samples</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3106"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3107"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Either a [b]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;estimateFee: impossible empty list&quot;</span></span><span>
</span><span id="line-3108"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682461600"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682461600"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3109"></span><span>                </span><span class="annot"><span class="annottext">a -&gt; Either a [b]
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682461600"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-3110"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461599"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682461599"><span class="hs-identifier hs-var">samples'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3111"></span><span>                </span><span class="annot"><span class="annottext">[b] -&gt; Either a [b]
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682461599"><span class="hs-identifier hs-var">samples'</span></a></span><span>
</span><span id="line-3112"></span><span>
</span><span id="line-3113"></span><span>    </span><span id="local-6989586621682461610"><span class="annot"><span class="annottext">repeats :: Int
</span><a href="#local-6989586621682461610"><span class="hs-identifier hs-var hs-var">repeats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="hs-comment">-- TODO: modify repeats based on data</span><span>
</span><span id="line-3114"></span><span>
</span><span id="line-3115"></span><span>    </span><span class="hs-comment">-- | When estimating fee, it is rather cumbersome to return &quot;cannot cover fee&quot;</span><span>
</span><span id="line-3116"></span><span>    </span><span class="hs-comment">-- if clients are just asking for an estimation. Therefore, we convert</span><span>
</span><span id="line-3117"></span><span>    </span><span class="hs-comment">-- &quot;cannot cover&quot; errors into the necessary fee amount, even though there isn't</span><span>
</span><span id="line-3118"></span><span>    </span><span class="hs-comment">-- enough in the wallet to cover for these fees.</span><span>
</span><span id="line-3119"></span><span>    </span><span class="annot"><a href="#local-6989586621682461609"><span class="hs-identifier hs-type">handleCannotCover</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461613"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-3120"></span><span>    </span><span id="local-6989586621682461609"><span class="annot"><span class="annottext">handleCannotCover :: ErrSelectAssets -&gt; ExceptT ErrSelectAssets m Coin
</span><a href="#local-6989586621682461609"><span class="hs-identifier hs-var hs-var">handleCannotCover</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3121"></span><span>        </span><span id="local-6989586621682461598"><span class="annot"><span class="annottext">e :: ErrSelectAssets
</span><a href="#local-6989586621682461598"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-type">ErrSelectAssetsSelectionError</span></a></span><span> </span><span id="local-6989586621682461597"><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682461597"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682461597"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3122"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionBalanceErrorOf"><span class="hs-identifier hs-type">SelectionBalanceErrorOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#UnableToConstructChange"><span class="hs-identifier hs-type">UnableToConstructChange</span></a></span><span> </span><span id="local-6989586621682461594"><span class="annot"><span class="annottext">UnableToConstructChangeError
</span><a href="#local-6989586621682461594"><span class="hs-identifier hs-var">ce</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3123"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnableToConstructChangeError
</span><a href="#local-6989586621682461594"><span class="hs-identifier hs-var">ce</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3124"></span><span>                    </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#UnableToConstructChangeError"><span class="hs-identifier hs-type">UnableToConstructChangeError</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682461592"><span class="annot"><span class="annottext">Coin
$sel:requiredCost:UnableToConstructChangeError :: UnableToConstructChangeError -&gt; Coin
requiredCost :: Coin
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#%24sel%3ArequiredCost%3AUnableToConstructChangeError"><span class="hs-identifier hs-var hs-var">requiredCost</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3125"></span><span>                        </span><span class="annot"><span class="annottext">Coin -&gt; ExceptT ErrSelectAssets m Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682461592"><span class="hs-identifier hs-var">requiredCost</span></a></span><span>
</span><span id="line-3126"></span><span>            </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3127"></span><span>                </span><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ExceptT ErrSelectAssets m Coin
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span>  </span><span class="annot"><span class="annottext">ErrSelectAssets
</span><a href="#local-6989586621682461598"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-3128"></span><span>        </span><span id="local-6989586621682461590"><span class="annot"><span class="annottext">ErrSelectAssets
</span><a href="#local-6989586621682461590"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3129"></span><span>            </span><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ExceptT ErrSelectAssets m Coin
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSelectAssets
</span><a href="#local-6989586621682461590"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-3130"></span><span>
</span><span id="line-3131"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Key Store
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3134"></span><span class="hs-comment">-- | The password here undergoes PBKDF2 encryption using HMAC</span><span>
</span><span id="line-3135"></span><span class="hs-comment">-- with the hash algorithm SHA512 which is realized in encryptPassphrase</span><span>
</span><span id="line-3136"></span><span class="annot"><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdScheme"><span class="hs-identifier hs-type">attachPrivateKeyFromPwdScheme</span></a></span><span>
</span><span id="line-3137"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465182"><span class="annot"><a href="#local-6989586621682465182"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682465184"><span class="annot"><a href="#local-6989586621682465184"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682465183"><span class="annot"><a href="#local-6989586621682465183"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3138"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465184"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465183"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465182"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3139"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3140"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465182"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3141"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3142"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682465183"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier hs-type">PassphraseScheme</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3143"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3144"></span><span id="attachPrivateKeyFromPwdScheme"><span class="annot"><span class="annottext">attachPrivateKeyFromPwdScheme :: ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdScheme"><span class="hs-identifier hs-var hs-var">attachPrivateKeyFromPwdScheme</span></a></span></span><span> </span><span id="local-6989586621682461589"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461589"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461588"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461588"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461587"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461587"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461586"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461586"><span class="hs-identifier hs-var">scheme</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461585"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461585"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461584"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">DBLayer IO s k
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3145"></span><span>    </span><span id="local-6989586621682461583"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461583"><span class="hs-identifier hs-var">hpwd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO PassphraseHash -&gt; ExceptT ErrNoSuchWallet IO PassphraseHash
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO PassphraseHash -&gt; ExceptT ErrNoSuchWallet IO PassphraseHash)
-&gt; IO PassphraseHash -&gt; ExceptT ErrNoSuchWallet IO PassphraseHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; IO PassphraseHash
forall (m :: * -&gt; *).
MonadRandom m =&gt;
PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; m PassphraseHash
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#encryptPassphrase%27"><span class="hs-identifier hs-var">encryptPassphrase'</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461586"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461585"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-3146"></span><span>    </span><span class="hs-comment">-- NOTE Only new wallets are constructed through this function, so the</span><span>
</span><span id="line-3147"></span><span>    </span><span class="hs-comment">-- passphrase is encrypted with the new scheme (i.e. PBKDF2)</span><span>
</span><span id="line-3148"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-3149"></span><span>    </span><span class="hs-comment">-- We do an extra sanity check after having encrypted the passphrase: we</span><span>
</span><span id="line-3150"></span><span>    </span><span class="hs-comment">-- tried to avoid some programmer mistakes with the phantom types on</span><span>
</span><span id="line-3151"></span><span>    </span><span class="hs-comment">-- Passphrase, but it's still possible that someone would inadvertently call</span><span>
</span><span id="line-3152"></span><span>    </span><span class="hs-comment">-- this function with a 'Passphrase' that wasn't prepared for</span><span>
</span><span id="line-3153"></span><span>    </span><span class="hs-comment">-- 'EncryptWithPBKDF2', if this happens, this is a programmer error and we</span><span>
</span><span id="line-3154"></span><span>    </span><span class="hs-comment">-- must fail hard for this would have dramatic effects later on.</span><span>
</span><span id="line-3155"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
-&gt; Passphrase &quot;user&quot;
-&gt; PassphraseHash
-&gt; Either ErrWrongPassphrase ()
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#checkPassphrase"><span class="hs-identifier hs-var">checkPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461586"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461585"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461583"><span class="hs-identifier hs-var">hpwd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3156"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; PassphraseScheme
-&gt; ExceptT ErrNoSuchWallet IO ()
forall s (k :: Depth -&gt; * -&gt; *).
DBLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; PassphraseScheme
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKey"><span class="hs-identifier hs-var">attachPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461584"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461588"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461587"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461583"><span class="hs-identifier hs-var">hpwd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461586"><span class="hs-identifier hs-var">scheme</span></a></span><span>
</span><span id="line-3157"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ExceptT ErrNoSuchWallet IO ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-3158"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Awe crap! The passphrase given to 'attachPrivateKeyFromPwd' wasn't \
            \rightfully constructed. This is a programmer error. Look for calls \
            \to this function and make sure that the given Passphrase wasn't not \
            \prepared using 'EncryptWithScrypt'!&quot;</span></span><span>
</span><span id="line-3162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3163"></span><span>    </span><span id="local-6989586621682461584"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461584"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461589"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465184"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465183"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3164"></span><span>
</span><span id="line-3165"></span><span class="annot"><a href="Cardano.Wallet.html#attachPrivateKeyFromPwd"><span class="hs-identifier hs-type">attachPrivateKeyFromPwd</span></a></span><span>
</span><span id="line-3166"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461581"><span class="annot"><a href="#local-6989586621682461581"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461580"><span class="annot"><a href="#local-6989586621682461580"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461579"><span class="annot"><a href="#local-6989586621682461579"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3167"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461580"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461579"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461581"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3168"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3169"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461581"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3170"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3171"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682461579"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3172"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3173"></span><span id="attachPrivateKeyFromPwd"><span class="annot"><span class="annottext">attachPrivateKeyFromPwd :: ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwd"><span class="hs-identifier hs-var hs-var">attachPrivateKeyFromPwd</span></a></span></span><span> </span><span id="local-6989586621682461578"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461578"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461577"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461577"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461576"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461576"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461575"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461575"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3174"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, (PassphraseScheme, Passphrase &quot;user&quot;))
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdScheme"><span class="hs-identifier hs-var">attachPrivateKeyFromPwdScheme</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461581"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461580"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461579"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461578"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461577"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3175"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461576"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461575"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3176"></span><span>
</span><span id="line-3177"></span><span class="hs-comment">-- | The hash here is the output of Scrypt function with the following parameters:</span><span>
</span><span id="line-3178"></span><span class="hs-comment">-- - logN = 14</span><span>
</span><span id="line-3179"></span><span class="hs-comment">-- - r = 8</span><span>
</span><span id="line-3180"></span><span class="hs-comment">-- - p = 1</span><span>
</span><span id="line-3181"></span><span class="hs-comment">-- - bytesNumber = 64</span><span>
</span><span id="line-3182"></span><span class="annot"><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdHash"><span class="hs-identifier hs-type">attachPrivateKeyFromPwdHash</span></a></span><span>
</span><span id="line-3183"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461574"><span class="annot"><a href="#local-6989586621682461574"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461573"><span class="annot"><a href="#local-6989586621682461573"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461572"><span class="annot"><a href="#local-6989586621682461572"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3184"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461573"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461572"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461574"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3185"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3186"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461574"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3188"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682461572"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-type">PassphraseHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3190"></span><span id="attachPrivateKeyFromPwdHash"><span class="annot"><span class="annottext">attachPrivateKeyFromPwdHash :: ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdHash"><span class="hs-identifier hs-var hs-var">attachPrivateKeyFromPwdHash</span></a></span></span><span> </span><span id="local-6989586621682461571"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461571"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461570"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461570"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461569"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461569"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461568"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461568"><span class="hs-identifier hs-var">hpwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461567"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">DBLayer IO s k
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3191"></span><span>    </span><span class="hs-comment">-- NOTE Only legacy wallets are imported through this function, passphrase</span><span>
</span><span id="line-3192"></span><span>    </span><span class="hs-comment">-- were encrypted with the legacy scheme (Scrypt).</span><span>
</span><span id="line-3193"></span><span>    </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; PassphraseScheme
-&gt; ExceptT ErrNoSuchWallet IO ()
forall s (k :: Depth -&gt; * -&gt; *).
DBLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; PassphraseScheme
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKey"><span class="hs-identifier hs-var">attachPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461567"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461570"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461569"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461568"><span class="hs-identifier hs-var">hpwd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#EncryptWithScrypt"><span class="hs-identifier hs-var">EncryptWithScrypt</span></a></span><span>
</span><span id="line-3194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3195"></span><span>    </span><span id="local-6989586621682461567"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461567"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461571"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461573"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461572"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3196"></span><span>
</span><span id="line-3197"></span><span id="local-6989586621682464348"><span id="local-6989586621682464349"><span class="annot"><a href="Cardano.Wallet.html#attachPrivateKey"><span class="hs-identifier hs-type">attachPrivateKey</span></a></span><span>
</span><span id="line-3198"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464349"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464348"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3199"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3200"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464348"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-type">PassphraseHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3201"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier hs-type">PassphraseScheme</span></a></span><span>
</span><span id="line-3202"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3203"></span><span id="attachPrivateKey"><span class="annot"><span class="annottext">attachPrivateKey :: DBLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; PassphraseScheme
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKey"><span class="hs-identifier hs-var hs-var">attachPrivateKey</span></a></span></span><span> </span><span id="local-6989586621682461565"><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461565"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621682461564"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461564"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461563"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461563"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461562"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461562"><span class="hs-identifier hs-var">hpwd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682461561"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461561"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461565"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461535"><span id="local-6989586621682461536"><span id="local-6989586621682461537"><span id="local-6989586621682461538"><span id="local-6989586621682461539"><span id="local-6989586621682461540"><span id="local-6989586621682461541"><span id="local-6989586621682461542"><span id="local-6989586621682461543"><span id="local-6989586621682461544"><span id="local-6989586621682461545"><span id="local-6989586621682461546"><span id="local-6989586621682461547"><span id="local-6989586621682461548"><span id="local-6989586621682461549"><span id="local-6989586621682461550"><span id="local-6989586621682461551"><span id="local-6989586621682461552"><span id="local-6989586621682461553"><span id="local-6989586621682461554"><span id="local-6989586621682461555"><span id="local-6989586621682461556"><span id="local-6989586621682461557"><span id="local-6989586621682461558"><span id="local-6989586621682461559"><span id="local-6989586621682461560"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461535"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3204"></span><span>    </span><span id="local-6989586621682461534"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461534"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; ExceptT ErrNoSuchWallet IO UTCTime
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
forall (m :: * -&gt; *). MonadTime m =&gt; m UTCTime
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-3205"></span><span>    </span><span class="annot"><span class="annottext">(stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ()))
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrNoSuchWallet ()) -&gt; IO (Either ErrNoSuchWallet ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461535"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ())
-&gt; ExceptT ErrNoSuchWallet stm () -&gt; ExceptT ErrNoSuchWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3206"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682461540"><span class="hs-identifier hs-var">putPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461564"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461563"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461562"><span class="hs-identifier hs-var">hpwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3207"></span><span>        </span><span id="local-6989586621682461533"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461533"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461564"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe WalletMetadata)
 -&gt; ExceptT ErrNoSuchWallet stm WalletMetadata)
-&gt; stm (Maybe WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet stm WalletMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe WalletMetadata)
</span><a href="#local-6989586621682461552"><span class="hs-identifier hs-var">readWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461564"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3208"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461532"><span class="annot"><span class="annottext">modify :: WalletMetadata -&gt; WalletMetadata
</span><a href="#local-6989586621682461532"><span class="hs-identifier hs-var hs-var">modify</span></a></span></span><span> </span><span id="local-6989586621682461531"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461531"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461531"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3209"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:passphraseInfo:WalletMetadata :: Maybe WalletPassphraseInfo
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3ApassphraseInfo%3AWalletMetadata"><span class="hs-identifier hs-var">passphraseInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletPassphraseInfo -&gt; Maybe WalletPassphraseInfo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletPassphraseInfo -&gt; Maybe WalletPassphraseInfo)
-&gt; WalletPassphraseInfo -&gt; Maybe WalletPassphraseInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPassphraseInfo :: UTCTime -&gt; PassphraseScheme -&gt; WalletPassphraseInfo
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#WalletPassphraseInfo"><span class="hs-identifier hs-type">WalletPassphraseInfo</span></a></span><span>
</span><span id="line-3210"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lastUpdatedAt :: UTCTime
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#lastUpdatedAt"><span class="hs-identifier hs-var">lastUpdatedAt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682461534"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-3211"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">passphraseScheme :: PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#passphraseScheme"><span class="hs-identifier hs-var">passphraseScheme</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461561"><span class="hs-identifier hs-var">scheme</span></a></span><span>
</span><span id="line-3212"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-3213"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3214"></span><span>        </span><span class="annot"><span class="annottext">WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682461553"><span class="hs-identifier hs-var">putWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461564"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata -&gt; WalletMetadata
</span><a href="#local-6989586621682461532"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682461533"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3215"></span><span>
</span><span id="line-3216"></span><span class="hs-comment">-- | Execute an action which requires holding a root XPrv.</span><span>
</span><span id="line-3217"></span><span class="hs-comment">--</span><span>
</span><span id="line-3218"></span><span class="hs-comment">-- 'withRootKey' takes a callback function with two arguments:</span><span>
</span><span id="line-3219"></span><span class="hs-comment">--</span><span>
</span><span id="line-3220"></span><span class="hs-comment">--  - The encrypted root private key itself</span><span>
</span><span id="line-3221"></span><span class="hs-comment">--  - The underlying passphrase scheme (legacy or new)</span><span>
</span><span id="line-3222"></span><span class="hs-comment">--</span><span>
</span><span id="line-3223"></span><span class="hs-comment">-- Caller are then expected to use 'preparePassphrase' with the given scheme in</span><span>
</span><span id="line-3224"></span><span class="hs-comment">-- order to &quot;prepare&quot; the passphrase to be used by other function. This does</span><span>
</span><span id="line-3225"></span><span class="hs-comment">-- nothing for the new encryption, but for the legacy encryption with Scrypt,</span><span>
</span><span id="line-3226"></span><span class="hs-comment">-- passphrases needed to first be CBOR serialized and blake2b_256 hashed.</span><span>
</span><span id="line-3227"></span><span class="hs-comment">--</span><span>
</span><span id="line-3228"></span><span class="hs-comment">-- @@@</span><span>
</span><span id="line-3229"></span><span class="hs-comment">--     withRootKey @ctx @s @k ctx wid pwd OnError $ \xprv scheme -&gt;</span><span>
</span><span id="line-3230"></span><span class="hs-comment">--         changePassphrase (preparePassphrase scheme pwd) newPwd xprv</span><span>
</span><span id="line-3231"></span><span class="hs-comment">-- @@@</span><span>
</span><span id="line-3232"></span><span class="annot"><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-type">withRootKey</span></a></span><span>
</span><span id="line-3233"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682465189"><span class="annot"><a href="#local-6989586621682465189"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682465191"><span class="annot"><a href="#local-6989586621682465191"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682465190"><span class="annot"><a href="#local-6989586621682465190"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682465188"><span class="annot"><a href="#local-6989586621682465188"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621682465187"><span class="annot"><a href="#local-6989586621682465187"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465191"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465190"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465189"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3234"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465189"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3235"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3236"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-3237"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465188"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3238"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682465190"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier hs-type">PassphraseScheme</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465188"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465187"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3239"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465188"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465187"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3240"></span><span id="withRootKey"><span class="annot"><span class="annottext">withRootKey :: ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var hs-var">withRootKey</span></a></span></span><span> </span><span id="local-6989586621682461527"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461527"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461526"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461526"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461525"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461525"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span id="local-6989586621682461524"><span class="annot"><span class="annottext">ErrWithRootKey -&gt; e
</span><a href="#local-6989586621682461524"><span class="hs-identifier hs-var">embed</span></a></span></span><span> </span><span id="local-6989586621682461523"><span class="annot"><span class="annottext">k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a
</span><a href="#local-6989586621682461523"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461522"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT e IO a) -&gt; ExceptT e IO a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461496"><span id="local-6989586621682461497"><span id="local-6989586621682461498"><span id="local-6989586621682461499"><span id="local-6989586621682461500"><span id="local-6989586621682461501"><span id="local-6989586621682461502"><span id="local-6989586621682461503"><span id="local-6989586621682461504"><span id="local-6989586621682461505"><span id="local-6989586621682461506"><span id="local-6989586621682461507"><span id="local-6989586621682461508"><span id="local-6989586621682461509"><span id="local-6989586621682461510"><span id="local-6989586621682461511"><span id="local-6989586621682461512"><span id="local-6989586621682461513"><span id="local-6989586621682461514"><span id="local-6989586621682461515"><span id="local-6989586621682461516"><span id="local-6989586621682461517"><span id="local-6989586621682461518"><span id="local-6989586621682461519"><span id="local-6989586621682461520"><span id="local-6989586621682461521"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461496"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3241"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682461495"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461495"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461494"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461494"><span class="hs-identifier hs-var">scheme</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrWithRootKey -&gt; e)
-&gt; ExceptT ErrWithRootKey IO (k 'RootK XPrv, PassphraseScheme)
-&gt; ExceptT e IO (k 'RootK XPrv, PassphraseScheme)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; e
</span><a href="#local-6989586621682461524"><span class="hs-identifier hs-var">embed</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWithRootKey IO (k 'RootK XPrv, PassphraseScheme)
 -&gt; ExceptT e IO (k 'RootK XPrv, PassphraseScheme))
-&gt; ExceptT ErrWithRootKey IO (k 'RootK XPrv, PassphraseScheme)
-&gt; ExceptT e IO (k 'RootK XPrv, PassphraseScheme)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrWithRootKey (k 'RootK XPrv, PassphraseScheme))
 -&gt; IO (Either ErrWithRootKey (k 'RootK XPrv, PassphraseScheme)))
-&gt; ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme)
-&gt; ExceptT ErrWithRootKey IO (k 'RootK XPrv, PassphraseScheme)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWithRootKey (k 'RootK XPrv, PassphraseScheme))
-&gt; IO (Either ErrWithRootKey (k 'RootK XPrv, PassphraseScheme))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461496"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme)
 -&gt; ExceptT ErrWithRootKey IO (k 'RootK XPrv, PassphraseScheme))
-&gt; ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme)
-&gt; ExceptT ErrWithRootKey IO (k 'RootK XPrv, PassphraseScheme)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3242"></span><span>        </span><span id="local-6989586621682461493"><span class="annot"><span class="annottext">Maybe PassphraseScheme
</span><a href="#local-6989586621682461493"><span class="hs-identifier hs-var">mScheme</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe WalletMetadata
-&gt; (WalletMetadata -&gt; Maybe PassphraseScheme)
-&gt; Maybe PassphraseScheme
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WalletPassphraseInfo -&gt; PassphraseScheme)
-&gt; Maybe WalletPassphraseInfo -&gt; Maybe PassphraseScheme
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPassphraseInfo -&gt; PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#passphraseScheme"><span class="hs-identifier hs-var hs-var">passphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe WalletPassphraseInfo -&gt; Maybe PassphraseScheme)
-&gt; (WalletMetadata -&gt; Maybe WalletPassphraseInfo)
-&gt; WalletMetadata
-&gt; Maybe PassphraseScheme
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata -&gt; Maybe WalletPassphraseInfo
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3ApassphraseInfo%3AWalletMetadata"><span class="hs-identifier hs-var hs-var">passphraseInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe WalletMetadata -&gt; Maybe PassphraseScheme)
-&gt; ExceptT ErrWithRootKey stm (Maybe WalletMetadata)
-&gt; ExceptT ErrWithRootKey stm (Maybe PassphraseScheme)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-3243"></span><span>            </span><span class="annot"><span class="annottext">stm (Maybe WalletMetadata)
-&gt; ExceptT ErrWithRootKey stm (Maybe WalletMetadata)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe WalletMetadata)
</span><a href="#local-6989586621682461513"><span class="hs-identifier hs-var">readWalletMeta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461526"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3244"></span><span>        </span><span id="local-6989586621682461492"><span class="annot"><span class="annottext">Maybe (k 'RootK XPrv, PassphraseHash)
</span><a href="#local-6989586621682461492"><span class="hs-identifier hs-var">mXPrv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">stm (Maybe (k 'RootK XPrv, PassphraseHash))
-&gt; ExceptT
     ErrWithRootKey stm (Maybe (k 'RootK XPrv, PassphraseHash))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Maybe (k 'RootK XPrv, PassphraseHash))
 -&gt; ExceptT
      ErrWithRootKey stm (Maybe (k 'RootK XPrv, PassphraseHash)))
-&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
-&gt; ExceptT
     ErrWithRootKey stm (Maybe (k 'RootK XPrv, PassphraseHash))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
</span><a href="#local-6989586621682461500"><span class="hs-identifier hs-var">readPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461526"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3245"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (k 'RootK XPrv, PassphraseHash)
</span><a href="#local-6989586621682461492"><span class="hs-identifier hs-var">mXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe PassphraseScheme
</span><a href="#local-6989586621682461493"><span class="hs-identifier hs-var">mScheme</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3246"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461491"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461491"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461490"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461490"><span class="hs-identifier hs-var">hpwd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682461489"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461489"><span class="hs-identifier hs-var">scheme</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3247"></span><span>                </span><span class="annot"><span class="annottext">(ErrWrongPassphrase -&gt; ErrWithRootKey)
-&gt; ExceptT ErrWrongPassphrase stm ()
-&gt; ExceptT ErrWithRootKey stm ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ErrWrongPassphrase -&gt; ErrWithRootKey
</span><a href="Cardano.Wallet.html#ErrWithRootKeyWrongPassphrase"><span class="hs-identifier hs-var">ErrWithRootKeyWrongPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461526"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWrongPassphrase stm ()
 -&gt; ExceptT ErrWithRootKey stm ())
-&gt; ExceptT ErrWrongPassphrase stm ()
-&gt; ExceptT ErrWithRootKey stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWrongPassphrase ())
-&gt; ExceptT ErrWrongPassphrase stm ()
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrWrongPassphrase ())
 -&gt; ExceptT ErrWrongPassphrase stm ())
-&gt; stm (Either ErrWrongPassphrase ())
-&gt; ExceptT ErrWrongPassphrase stm ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3248"></span><span>                    </span><span class="annot"><span class="annottext">Either ErrWrongPassphrase () -&gt; stm (Either ErrWrongPassphrase ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrWrongPassphrase ()
 -&gt; stm (Either ErrWrongPassphrase ()))
-&gt; Either ErrWrongPassphrase ()
-&gt; stm (Either ErrWrongPassphrase ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
-&gt; Passphrase &quot;user&quot;
-&gt; PassphraseHash
-&gt; Either ErrWrongPassphrase ()
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#checkPassphrase"><span class="hs-identifier hs-var">checkPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461489"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461525"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682461490"><span class="hs-identifier hs-var">hpwd</span></a></span><span>
</span><span id="line-3249"></span><span>                </span><span class="annot"><span class="annottext">(k 'RootK XPrv, PassphraseScheme)
-&gt; ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461491"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461489"><span class="hs-identifier hs-var">scheme</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3250"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (k 'RootK XPrv, PassphraseHash), Maybe PassphraseScheme)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3251"></span><span>                </span><span class="annot"><span class="annottext">ErrWithRootKey
-&gt; ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrWithRootKey
 -&gt; ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme))
-&gt; ErrWithRootKey
-&gt; ExceptT ErrWithRootKey stm (k 'RootK XPrv, PassphraseScheme)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ErrWithRootKey
</span><a href="Cardano.Wallet.html#ErrWithRootKeyNoRootKey"><span class="hs-identifier hs-var">ErrWithRootKeyNoRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461526"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3252"></span><span>    </span><span class="annot"><span class="annottext">k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a
</span><a href="#local-6989586621682461523"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461495"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461494"><span class="hs-identifier hs-var">scheme</span></a></span><span>
</span><span id="line-3253"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3254"></span><span>    </span><span id="local-6989586621682461522"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461522"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461527"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465191"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682465190"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3255"></span><span>
</span><span id="line-3256"></span><span class="hs-comment">-- | Sign an arbitrary transaction metadata object with a private key belonging</span><span>
</span><span id="line-3257"></span><span class="hs-comment">-- to the wallet's account.</span><span>
</span><span id="line-3258"></span><span class="hs-comment">--</span><span>
</span><span id="line-3259"></span><span class="hs-comment">-- This is experimental, and will likely be replaced by a more robust to</span><span>
</span><span id="line-3260"></span><span class="hs-comment">-- arbitrary message signing using COSE, or a subset of it.</span><span>
</span><span id="line-3261"></span><span class="annot"><a href="Cardano.Wallet.html#signMetadataWith"><span class="hs-identifier hs-type">signMetadataWith</span></a></span><span>
</span><span id="line-3262"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461486"><span class="annot"><a href="#local-6989586621682461486"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461485"><span class="annot"><a href="#local-6989586621682461485"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461484"><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682461483"><span class="annot"><a href="#local-6989586621682461483"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3263"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461485"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461486"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3264"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3265"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span>
</span><span id="line-3266"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3267"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682461485"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461483"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3268"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3269"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461486"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3270"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3271"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-3272"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3273"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">TxMetadata</span></a></span><span>
</span><span id="line-3274"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWith"><span class="hs-identifier hs-type">ErrSignMetadataWith</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">TxMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3275"></span><span id="signMetadataWith"><span class="annot"><span class="annottext">signMetadataWith :: ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (Role, DerivationIndex)
-&gt; TxMetadata
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
</span><a href="Cardano.Wallet.html#signMetadataWith"><span class="hs-identifier hs-var hs-var">signMetadataWith</span></a></span></span><span> </span><span id="local-6989586621682461482"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461482"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461481"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461481"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461480"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461480"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461479"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682461479"><span class="hs-identifier hs-var">role_</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461478"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461478"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682461477"><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621682461477"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461476"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata))
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461450"><span id="local-6989586621682461451"><span id="local-6989586621682461452"><span id="local-6989586621682461453"><span id="local-6989586621682461454"><span id="local-6989586621682461455"><span id="local-6989586621682461456"><span id="local-6989586621682461457"><span id="local-6989586621682461458"><span id="local-6989586621682461459"><span id="local-6989586621682461460"><span id="local-6989586621682461461"><span id="local-6989586621682461462"><span id="local-6989586621682461463"><span id="local-6989586621682461464"><span id="local-6989586621682461465"><span id="local-6989586621682461466"><span id="local-6989586621682461467"><span id="local-6989586621682461468"><span id="local-6989586621682461469"><span id="local-6989586621682461470"><span id="local-6989586621682461471"><span id="local-6989586621682461472"><span id="local-6989586621682461473"><span id="local-6989586621682461474"><span id="local-6989586621682461475"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461450"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3276"></span><span>    </span><span id="local-6989586621682461449"><span class="annot"><span class="annottext">Index 'Soft 'AddressK
</span><a href="#local-6989586621682461449"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Soft 'AddressK -&gt; ErrSignMetadataWith)
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     IO
     (Index 'Soft 'AddressK)
-&gt; ExceptT ErrSignMetadataWith IO (Index 'Soft 'AddressK)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK -&gt; ErrSignMetadataWith
</span><a href="Cardano.Wallet.html#ErrSignMetadataWithInvalidIndex"><span class="hs-identifier hs-var">ErrSignMetadataWithInvalidIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ErrInvalidDerivationIndex 'Soft 'AddressK)
   IO
   (Index 'Soft 'AddressK)
 -&gt; ExceptT ErrSignMetadataWith IO (Index 'Soft 'AddressK))
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     IO
     (Index 'Soft 'AddressK)
-&gt; ExceptT ErrSignMetadataWith IO (Index 'Soft 'AddressK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     IO
     (Index 'Soft 'AddressK)
forall (m :: * -&gt; *) (whatever :: Depth).
Monad m =&gt;
DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     m
     (Index 'Soft whatever)
</span><a href="Cardano.Wallet.html#guardSoftIndex"><span class="hs-identifier hs-var">guardSoftIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461478"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3277"></span><span>
</span><span id="line-3278"></span><span>    </span><span id="local-6989586621682461446"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461446"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrSignMetadataWith (Wallet s))
 -&gt; IO (Either ErrSignMetadataWith (Wallet s)))
-&gt; ExceptT ErrSignMetadataWith stm (Wallet s)
-&gt; ExceptT ErrSignMetadataWith IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrSignMetadataWith (Wallet s))
-&gt; IO (Either ErrSignMetadataWith (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461450"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-3279"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrSignMetadataWith stm (Wallet s)
 -&gt; ExceptT ErrSignMetadataWith IO (Wallet s))
-&gt; ExceptT ErrSignMetadataWith stm (Wallet s)
-&gt; ExceptT ErrSignMetadataWith IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrSignMetadataWith)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrSignMetadataWith stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSignMetadataWith
</span><a href="Cardano.Wallet.html#ErrSignMetadataWithNoSuchWallet"><span class="hs-identifier hs-var">ErrSignMetadataWithNoSuchWallet</span></a></span><span>
</span><span id="line-3280"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrSignMetadataWith stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrSignMetadataWith stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461481"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3281"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682461470"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461481"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3282"></span><span>
</span><span id="line-3283"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrSignMetadataWith)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata))
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461486"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461485"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461482"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461481"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461480"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrSignMetadataWith
</span><a href="Cardano.Wallet.html#ErrSignMetadataWithRootKey"><span class="hs-identifier hs-var">ErrSignMetadataWithRootKey</span></a></span><span>
</span><span id="line-3284"></span><span>        </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme
  -&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata))
 -&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata))
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata))
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682461443"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461443"><span class="hs-identifier hs-var">rootK</span></a></span></span><span> </span><span id="local-6989586621682461442"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461442"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3285"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461441"><span class="annot"><span class="annottext">encPwd :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461441"><span class="hs-identifier hs-var hs-var">encPwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461442"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461480"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-3286"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationPrefix"><span class="hs-identifier hs-type">DerivationPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'CoinTypeK
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461439"><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682461439"><span class="hs-identifier hs-var">acctIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SeqState n k -&gt; DerivationPrefix
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SeqState n k -&gt; DerivationPrefix
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#derivationPrefix"><span class="hs-identifier hs-var hs-var">Seq.derivationPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461446"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3287"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461438"><span class="annot"><span class="annottext">acctK :: k 'AccountK XPrv
</span><a href="#local-6989586621682461438"><span class="hs-identifier hs-var hs-var">acctK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; k 'RootK XPrv -&gt; Index 'Hardened 'AccountK -&gt; k 'AccountK XPrv
forall (key :: Depth -&gt; * -&gt; *).
HardDerivation key =&gt;
Passphrase &quot;encryption&quot;
-&gt; key 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; key 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var">deriveAccountPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461441"><span class="hs-identifier hs-var">encPwd</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461443"><span class="hs-identifier hs-var">rootK</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682461439"><span class="hs-identifier hs-var">acctIx</span></a></span><span>
</span><span id="line-3288"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461436"><span class="annot"><span class="annottext">addrK :: k 'AddressK XPrv
</span><a href="#local-6989586621682461436"><span class="hs-identifier hs-var hs-var">addrK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; k 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType k) 'AddressK
-&gt; k 'AddressK XPrv
forall (key :: Depth -&gt; * -&gt; *).
HardDerivation key =&gt;
Passphrase &quot;encryption&quot;
-&gt; key 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType key) 'AddressK
-&gt; key 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPrivateKey"><span class="hs-identifier hs-var">deriveAddressPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461441"><span class="hs-identifier hs-var">encPwd</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPrv
</span><a href="#local-6989586621682461438"><span class="hs-identifier hs-var">acctK</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682461479"><span class="hs-identifier hs-var">role_</span></a></span><span> </span><span class="annot"><span class="annottext">Index (AddressIndexDerivationType k) 'AddressK
Index 'Soft 'AddressK
</span><a href="#local-6989586621682461449"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-3289"></span><span>            </span><span class="annot"><span class="annottext">Signature TxMetadata
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Signature TxMetadata
 -&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata))
-&gt; Signature TxMetadata
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3290"></span><span>                </span><span class="annot"><span class="annottext">ByteString -&gt; Signature TxMetadata
forall what. ByteString -&gt; Signature what
</span><a href="Cardano.Wallet.Primitive.Types.html#Signature"><span class="hs-identifier hs-var">Signature</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Signature TxMetadata)
-&gt; ByteString -&gt; Signature TxMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XSignature -&gt; ByteString
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(XSignature -&gt; ByteString) -&gt; XSignature -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3291"></span><span>                </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot; -&gt; XPrv -&gt; Digest Blake2b_256 -&gt; XSignature
forall passPhrase msg.
(ByteArrayAccess passPhrase, ByteArrayAccess msg) =&gt;
passPhrase -&gt; XPrv -&gt; msg -&gt; XSignature
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">CC.sign</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461441"><span class="hs-identifier hs-var">encPwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'AddressK XPrv -&gt; XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AddressK XPrv
</span><a href="#local-6989586621682461436"><span class="hs-identifier hs-var">addrK</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_256 -&gt; XSignature)
-&gt; Digest Blake2b_256 -&gt; XSignature
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3292"></span><span>                </span><span class="annot"><span class="annottext">(ByteArrayAccess ByteString, HashAlgorithm Blake2b_256) =&gt;
ByteString -&gt; Digest Blake2b_256
forall ba a.
(ByteArrayAccess ba, HashAlgorithm a) =&gt;
ba -&gt; Digest a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-type">Blake2b_256</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Digest Blake2b_256)
-&gt; ByteString -&gt; Digest Blake2b_256
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3293"></span><span>                </span><span class="annot"><span class="annottext">TxMetadata -&gt; ByteString
forall a. SerialiseAsCBOR a =&gt; a -&gt; ByteString
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">serialiseToCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621682461477"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-3294"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3295"></span><span>    </span><span id="local-6989586621682461476"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461476"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461482"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461485"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461484"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3296"></span><span>
</span><span id="line-3297"></span><span class="annot"><a href="Cardano.Wallet.html#derivePublicKey"><span class="hs-identifier hs-type">derivePublicKey</span></a></span><span>
</span><span id="line-3298"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461431"><span class="annot"><a href="#local-6989586621682461431"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461430"><span class="annot"><a href="#local-6989586621682461430"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461429"><span class="annot"><a href="#local-6989586621682461429"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3299"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461430"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461429"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461431"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3300"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461429"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3301"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier hs-type">GetAccount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461430"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461429"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3302"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3303"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461431"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3304"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3305"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-3306"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKey"><span class="hs-identifier hs-type">ErrDerivePublicKey</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682461429"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3308"></span><span id="derivePublicKey"><span class="annot"><span class="annottext">derivePublicKey :: ctx
-&gt; WalletId
-&gt; Role
-&gt; DerivationIndex
-&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
</span><a href="Cardano.Wallet.html#derivePublicKey"><span class="hs-identifier hs-var hs-var">derivePublicKey</span></a></span></span><span> </span><span id="local-6989586621682461428"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461428"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461427"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461427"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461426"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682461426"><span class="hs-identifier hs-var">role_</span></a></span></span><span> </span><span id="local-6989586621682461425"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461425"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461424"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub))
-&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461398"><span id="local-6989586621682461399"><span id="local-6989586621682461400"><span id="local-6989586621682461401"><span id="local-6989586621682461402"><span id="local-6989586621682461403"><span id="local-6989586621682461404"><span id="local-6989586621682461405"><span id="local-6989586621682461406"><span id="local-6989586621682461407"><span id="local-6989586621682461408"><span id="local-6989586621682461409"><span id="local-6989586621682461410"><span id="local-6989586621682461411"><span id="local-6989586621682461412"><span id="local-6989586621682461413"><span id="local-6989586621682461414"><span id="local-6989586621682461415"><span id="local-6989586621682461416"><span id="local-6989586621682461417"><span id="local-6989586621682461418"><span id="local-6989586621682461419"><span id="local-6989586621682461420"><span id="local-6989586621682461421"><span id="local-6989586621682461422"><span id="local-6989586621682461423"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461398"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3309"></span><span>    </span><span id="local-6989586621682461397"><span class="annot"><span class="annottext">Index 'Soft 'AddressK
</span><a href="#local-6989586621682461397"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Soft 'AddressK -&gt; ErrDerivePublicKey)
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     IO
     (Index 'Soft 'AddressK)
-&gt; ExceptT ErrDerivePublicKey IO (Index 'Soft 'AddressK)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK -&gt; ErrDerivePublicKey
</span><a href="Cardano.Wallet.html#ErrDerivePublicKeyInvalidIndex"><span class="hs-identifier hs-var">ErrDerivePublicKeyInvalidIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ErrInvalidDerivationIndex 'Soft 'AddressK)
   IO
   (Index 'Soft 'AddressK)
 -&gt; ExceptT ErrDerivePublicKey IO (Index 'Soft 'AddressK))
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     IO
     (Index 'Soft 'AddressK)
-&gt; ExceptT ErrDerivePublicKey IO (Index 'Soft 'AddressK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     IO
     (Index 'Soft 'AddressK)
forall (m :: * -&gt; *) (whatever :: Depth).
Monad m =&gt;
DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     m
     (Index 'Soft whatever)
</span><a href="Cardano.Wallet.html#guardSoftIndex"><span class="hs-identifier hs-var">guardSoftIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461425"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3310"></span><span>
</span><span id="line-3311"></span><span>    </span><span id="local-6989586621682461395"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461395"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrDerivePublicKey (Wallet s))
 -&gt; IO (Either ErrDerivePublicKey (Wallet s)))
-&gt; ExceptT ErrDerivePublicKey stm (Wallet s)
-&gt; ExceptT ErrDerivePublicKey IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrDerivePublicKey (Wallet s))
-&gt; IO (Either ErrDerivePublicKey (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461398"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-3312"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrDerivePublicKey stm (Wallet s)
 -&gt; ExceptT ErrDerivePublicKey IO (Wallet s))
-&gt; ExceptT ErrDerivePublicKey stm (Wallet s)
-&gt; ExceptT ErrDerivePublicKey IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrDerivePublicKey)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrDerivePublicKey stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrDerivePublicKey
</span><a href="Cardano.Wallet.html#ErrDerivePublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrDerivePublicKeyNoSuchWallet</span></a></span><span>
</span><span id="line-3313"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrDerivePublicKey stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrDerivePublicKey stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461427"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3314"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682461418"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461427"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3315"></span><span>
</span><span id="line-3316"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461393"><span class="annot"><span class="annottext">acctK :: k 'AccountK XPub
</span><a href="#local-6989586621682461393"><span class="hs-identifier hs-var hs-var">acctK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s -&gt; k 'AccountK XPub
forall s (key :: Depth -&gt; * -&gt; *).
GetAccount s key =&gt;
s -&gt; key 'AccountK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getAccount"><span class="hs-identifier hs-var">getAccount</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; k 'AccountK XPub) -&gt; s -&gt; k 'AccountK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461395"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-3317"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461391"><span class="annot"><span class="annottext">addrK :: k 'AddressK XPub
</span><a href="#local-6989586621682461391"><span class="hs-identifier hs-var hs-var">addrK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; Role -&gt; Index 'Soft 'AddressK -&gt; k 'AddressK XPub
forall (key :: Depth -&gt; * -&gt; *).
SoftDerivation key =&gt;
key 'AccountK XPub
-&gt; Role -&gt; Index 'Soft 'AddressK -&gt; key 'AddressK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPublicKey"><span class="hs-identifier hs-var">deriveAddressPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682461393"><span class="hs-identifier hs-var">acctK</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682461426"><span class="hs-identifier hs-var">role_</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'AddressK
</span><a href="#local-6989586621682461397"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-3318"></span><span>
</span><span id="line-3319"></span><span>    </span><span class="annot"><span class="annottext">k 'AddressK XPub
-&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AddressK XPub
</span><a href="#local-6989586621682461391"><span class="hs-identifier hs-var">addrK</span></a></span><span>
</span><span id="line-3320"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3321"></span><span>    </span><span id="local-6989586621682461424"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461424"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461428"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461430"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461429"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3322"></span><span>
</span><span id="line-3323"></span><span class="hs-comment">-- | Retrieve current public account key of a wallet.</span><span>
</span><span id="line-3324"></span><span class="annot"><a href="Cardano.Wallet.html#readAccountPublicKey"><span class="hs-identifier hs-type">readAccountPublicKey</span></a></span><span>
</span><span id="line-3325"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461389"><span class="annot"><a href="#local-6989586621682461389"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461388"><span class="annot"><a href="#local-6989586621682461388"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461387"><span class="annot"><a href="#local-6989586621682461387"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3326"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461388"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461387"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461389"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3327"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier hs-type">GetAccount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461388"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461387"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3328"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3329"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461389"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3330"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3331"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKey"><span class="hs-identifier hs-type">ErrReadAccountPublicKey</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682461387"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3332"></span><span id="readAccountPublicKey"><span class="annot"><span class="annottext">readAccountPublicKey :: ctx
-&gt; WalletId
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
</span><a href="Cardano.Wallet.html#readAccountPublicKey"><span class="hs-identifier hs-var hs-var">readAccountPublicKey</span></a></span></span><span> </span><span id="local-6989586621682461386"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461386"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461385"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461385"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461384"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461358"><span id="local-6989586621682461359"><span id="local-6989586621682461360"><span id="local-6989586621682461361"><span id="local-6989586621682461362"><span id="local-6989586621682461363"><span id="local-6989586621682461364"><span id="local-6989586621682461365"><span id="local-6989586621682461366"><span id="local-6989586621682461367"><span id="local-6989586621682461368"><span id="local-6989586621682461369"><span id="local-6989586621682461370"><span id="local-6989586621682461371"><span id="local-6989586621682461372"><span id="local-6989586621682461373"><span id="local-6989586621682461374"><span id="local-6989586621682461375"><span id="local-6989586621682461376"><span id="local-6989586621682461377"><span id="local-6989586621682461378"><span id="local-6989586621682461379"><span id="local-6989586621682461380"><span id="local-6989586621682461381"><span id="local-6989586621682461382"><span id="local-6989586621682461383"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461358"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3333"></span><span>    </span><span id="local-6989586621682461357"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461357"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrReadAccountPublicKey (Wallet s))
 -&gt; IO (Either ErrReadAccountPublicKey (Wallet s)))
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrReadAccountPublicKey (Wallet s))
-&gt; IO (Either ErrReadAccountPublicKey (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461358"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-3334"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrReadAccountPublicKey stm (Wallet s)
 -&gt; ExceptT ErrReadAccountPublicKey IO (Wallet s))
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrReadAccountPublicKey)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrReadAccountPublicKey
</span><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyNoSuchWallet</span></a></span><span>
</span><span id="line-3335"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461385"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3336"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682461378"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461385"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3337"></span><span>    </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'AccountK XPub
 -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; k 'AccountK XPub
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; k 'AccountK XPub
forall s (key :: Depth -&gt; * -&gt; *).
GetAccount s key =&gt;
s -&gt; key 'AccountK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getAccount"><span class="hs-identifier hs-var">getAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461357"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3338"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3339"></span><span>    </span><span id="local-6989586621682461384"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461384"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461386"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461388"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461387"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3340"></span><span>
</span><span id="line-3341"></span><span class="annot"><a href="Cardano.Wallet.html#writePolicyPublicKey"><span class="hs-identifier hs-type">writePolicyPublicKey</span></a></span><span>
</span><span id="line-3342"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461355"><span class="annot"><a href="#local-6989586621682461355"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461354"><span class="annot"><a href="#local-6989586621682461354"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461353"><span class="annot"><a href="#local-6989586621682461353"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-3343"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461354"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461355"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3344"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682461354"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461353"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-3345"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3346"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461355"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3347"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3348"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-3349"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKey"><span class="hs-identifier hs-type">ErrWritePolicyPublicKey</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PolicyK"><span class="hs-identifier hs-type">PolicyK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3350"></span><span id="writePolicyPublicKey"><span class="annot"><span class="annottext">writePolicyPublicKey :: ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
</span><a href="Cardano.Wallet.html#writePolicyPublicKey"><span class="hs-identifier hs-var hs-var">writePolicyPublicKey</span></a></span></span><span> </span><span id="local-6989586621682461352"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461352"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461351"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461351"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461350"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461350"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s ShelleyKey
</span><a href="#local-6989586621682461349"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s ShelleyKey
-&gt; (DBLayer IO s ShelleyKey
    -&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub))
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461323"><span id="local-6989586621682461324"><span id="local-6989586621682461325"><span id="local-6989586621682461326"><span id="local-6989586621682461327"><span id="local-6989586621682461328"><span id="local-6989586621682461329"><span id="local-6989586621682461330"><span id="local-6989586621682461331"><span id="local-6989586621682461332"><span id="local-6989586621682461333"><span id="local-6989586621682461334"><span id="local-6989586621682461335"><span id="local-6989586621682461336"><span id="local-6989586621682461337"><span id="local-6989586621682461338"><span id="local-6989586621682461339"><span id="local-6989586621682461340"><span id="local-6989586621682461341"><span id="local-6989586621682461342"><span id="local-6989586621682461343"><span id="local-6989586621682461344"><span id="local-6989586621682461345"><span id="local-6989586621682461346"><span id="local-6989586621682461347"><span id="local-6989586621682461348"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (ShelleyKey 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (ShelleyKey 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (ShelleyKey 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (ShelleyKey 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461323"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3351"></span><span>    </span><span id="local-6989586621682461322"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461322"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrWritePolicyPublicKey (Wallet s))
 -&gt; IO (Either ErrWritePolicyPublicKey (Wallet s)))
-&gt; ExceptT ErrWritePolicyPublicKey stm (Wallet s)
-&gt; ExceptT ErrWritePolicyPublicKey IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWritePolicyPublicKey (Wallet s))
-&gt; IO (Either ErrWritePolicyPublicKey (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461323"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-3352"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrWritePolicyPublicKey stm (Wallet s)
 -&gt; ExceptT ErrWritePolicyPublicKey IO (Wallet s))
-&gt; ExceptT ErrWritePolicyPublicKey stm (Wallet s)
-&gt; ExceptT ErrWritePolicyPublicKey IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrWritePolicyPublicKey)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrWritePolicyPublicKey stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrWritePolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrWritePolicyPublicKeyNoSuchWallet</span></a></span><span>
</span><span id="line-3353"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrWritePolicyPublicKey stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrWritePolicyPublicKey stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461351"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3354"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682461343"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461351"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3355"></span><span>
</span><span id="line-3356"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#SeqPrologue"><span class="hs-identifier hs-type">SeqPrologue</span></a></span><span> </span><span id="local-6989586621682461319"><span class="annot"><a href="#local-6989586621682461319"><span class="hs-identifier hs-var">seqState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s -&gt; Prologue s
forall s. AddressBookIso s =&gt; s -&gt; Prologue s
</span><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier hs-var">getPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; Prologue s) -&gt; s -&gt; Prologue s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461322"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-3357"></span><span>
</span><span id="line-3358"></span><span>    </span><span id="local-6989586621682461318"><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682461318"><span class="hs-identifier hs-var">policyXPub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrWritePolicyPublicKey)
-&gt; (ShelleyKey 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub))
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">withRootKey</span></a></span><span>
</span><span id="line-3359"></span><span>        </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461355"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461354"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461352"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461351"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461350"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrWritePolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyWithRootKey"><span class="hs-identifier hs-var">ErrWritePolicyPublicKeyWithRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyKey 'RootK XPrv
  -&gt; PassphraseScheme
  -&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub))
 -&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub))
-&gt; (ShelleyKey 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub))
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3360"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682461316"><span class="annot"><span class="annottext">ShelleyKey 'RootK XPrv
</span><a href="#local-6989586621682461316"><span class="hs-identifier hs-var">rootK</span></a></span></span><span> </span><span id="local-6989586621682461315"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461315"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3361"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461314"><span class="annot"><span class="annottext">encPwd :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461314"><span class="hs-identifier hs-var hs-var">encPwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461315"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461350"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-3362"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461313"><span class="annot"><span class="annottext">xprv :: XPrv
</span><a href="#local-6989586621682461313"><span class="hs-identifier hs-var hs-var">xprv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot; -&gt; XPrv -&gt; Index 'Hardened 'PolicyK -&gt; XPrv
forall (purpose :: Symbol).
Passphrase purpose -&gt; XPrv -&gt; Index 'Hardened 'PolicyK -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#derivePolicyPrivateKey"><span class="hs-identifier hs-var">derivePolicyPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461314"><span class="hs-identifier hs-var">encPwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyKey 'RootK XPrv -&gt; XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'RootK XPrv
</span><a href="#local-6989586621682461316"><span class="hs-identifier hs-var">rootK</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PolicyK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span>
</span><span id="line-3363"></span><span>            </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyKey 'PolicyK XPub
 -&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub))
-&gt; ShelleyKey 'PolicyK XPub
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ShelleyKey 'PolicyK XPub
forall (key :: Depth -&gt; * -&gt; *) raw (depth :: Depth).
WalletKey key =&gt;
raw -&gt; key depth raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftRawKey"><span class="hs-identifier hs-var">liftRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ShelleyKey 'PolicyK XPub)
-&gt; XPub -&gt; ShelleyKey 'PolicyK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682461313"><span class="hs-identifier hs-var">xprv</span></a></span><span>
</span><span id="line-3364"></span><span>
</span><span id="line-3365"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461312"><span class="annot"><span class="annottext">seqState' :: SeqState n ShelleyKey
</span><a href="#local-6989586621682461312"><span class="hs-identifier hs-var hs-var">seqState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey
</span><a href="#local-6989586621682461319"><span class="hs-identifier hs-var">seqState</span></a></span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey
-&gt; (SeqState n ShelleyKey -&gt; SeqState n ShelleyKey)
-&gt; SeqState n ShelleyKey
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;policyXPub&quot;
  ((Maybe (ShelleyKey 'PolicyK XPub)
    -&gt; Identity (Maybe (ShelleyKey 'PolicyK XPub)))
   -&gt; SeqState n ShelleyKey -&gt; Identity (SeqState n ShelleyKey))
(Maybe (ShelleyKey 'PolicyK XPub)
 -&gt; Identity (Maybe (ShelleyKey 'PolicyK XPub)))
-&gt; SeqState n ShelleyKey -&gt; Identity (SeqState n ShelleyKey)
</span><a href="#local-6989586621682461311"><span class="hs-var">#policyXPub</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (ShelleyKey 'PolicyK XPub)
  -&gt; Identity (Maybe (ShelleyKey 'PolicyK XPub)))
 -&gt; SeqState n ShelleyKey -&gt; Identity (SeqState n ShelleyKey))
-&gt; Maybe (ShelleyKey 'PolicyK XPub)
-&gt; SeqState n ShelleyKey
-&gt; SeqState n ShelleyKey
forall a b s t.
((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; b -&gt; s -&gt; t
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub -&gt; Maybe (ShelleyKey 'PolicyK XPub)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682461318"><span class="hs-identifier hs-var">policyXPub</span></a></span><span>
</span><span id="line-3366"></span><span>    </span><span class="annot"><span class="annottext">IO (Either ErrWritePolicyPublicKey ())
-&gt; ExceptT ErrWritePolicyPublicKey IO ()
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrWritePolicyPublicKey ())
 -&gt; ExceptT ErrWritePolicyPublicKey IO ())
-&gt; IO (Either ErrWritePolicyPublicKey ())
-&gt; ExceptT ErrWritePolicyPublicKey IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWritePolicyPublicKey ())
-&gt; IO (Either ErrWritePolicyPublicKey ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461323"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrWritePolicyPublicKey ())
 -&gt; IO (Either ErrWritePolicyPublicKey ()))
-&gt; stm (Either ErrWritePolicyPublicKey ())
-&gt; IO (Either ErrWritePolicyPublicKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
-&gt; (Map WalletId (WalletState (SeqState n ShelleyKey))
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrWritePolicyPublicKey ()))
-&gt; stm (Either ErrWritePolicyPublicKey ())
forall da (m :: * -&gt; *) a b.
(Delta da, Monad m, a ~ Base da) =&gt;
DBVar m da -&gt; (a -&gt; (Maybe da, b)) -&gt; m b
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">modifyDBMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
</span><a href="#local-6989586621682461345"><span class="hs-identifier hs-var">walletsDB</span></a></span><span> </span><span class="annot"><span class="annottext">((Map WalletId (WalletState (SeqState n ShelleyKey))
  -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
      Either ErrWritePolicyPublicKey ()))
 -&gt; stm (Either ErrWritePolicyPublicKey ()))
-&gt; (Map WalletId (WalletState (SeqState n ShelleyKey))
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrWritePolicyPublicKey ()))
-&gt; stm (Either ErrWritePolicyPublicKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3367"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; (ErrNoSuchWallet -&gt; ErrWritePolicyPublicKey)
-&gt; (WalletState (SeqState n ShelleyKey)
    -&gt; Either
         ErrWritePolicyPublicKey
         ([DeltaWalletState1 (SeqState n ShelleyKey)], ()))
-&gt; Map WalletId (WalletState (SeqState n ShelleyKey))
-&gt; (Maybe
      (DeltaMap WalletId [DeltaWalletState1 (SeqState n ShelleyKey)]),
    Either ErrWritePolicyPublicKey ())
forall e w dw b.
WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var">adjustNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461351"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrWritePolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrWritePolicyPublicKeyNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">((WalletState (SeqState n ShelleyKey)
  -&gt; Either
       ErrWritePolicyPublicKey
       ([DeltaWalletState1 (SeqState n ShelleyKey)], ()))
 -&gt; Map WalletId (WalletState (SeqState n ShelleyKey))
 -&gt; (Maybe
       (DeltaMap WalletId [DeltaWalletState1 (SeqState n ShelleyKey)]),
     Either ErrWritePolicyPublicKey ()))
-&gt; (WalletState (SeqState n ShelleyKey)
    -&gt; Either
         ErrWritePolicyPublicKey
         ([DeltaWalletState1 (SeqState n ShelleyKey)], ()))
-&gt; Map WalletId (WalletState (SeqState n ShelleyKey))
-&gt; (Maybe
      (DeltaMap WalletId [DeltaWalletState1 (SeqState n ShelleyKey)]),
    Either ErrWritePolicyPublicKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3368"></span><span>        </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">WalletState (SeqState n ShelleyKey)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([DeltaWalletState1 (SeqState n ShelleyKey)], ())
-&gt; Either
     ErrWritePolicyPublicKey
     ([DeltaWalletState1 (SeqState n ShelleyKey)], ())
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Prologue (SeqState n ShelleyKey)
-&gt; DeltaWalletState1 (SeqState n ShelleyKey)
forall s. Prologue s -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(Prologue (SeqState n ShelleyKey)
 -&gt; DeltaWalletState1 (SeqState n ShelleyKey))
-&gt; Prologue (SeqState n ShelleyKey)
-&gt; DeltaWalletState1 (SeqState n ShelleyKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey -&gt; Prologue (SeqState n ShelleyKey)
forall (n :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
SeqState n key -&gt; Prologue (SeqState n key)
</span><a href="Cardano.Wallet.Address.Book.html#SeqPrologue"><span class="hs-identifier hs-var">SeqPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">SeqState n ShelleyKey
</span><a href="#local-6989586621682461312"><span class="hs-identifier hs-var">seqState'</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3369"></span><span>
</span><span id="line-3370"></span><span>    </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682461318"><span class="hs-identifier hs-var">policyXPub</span></a></span><span>
</span><span id="line-3371"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3372"></span><span>    </span><span id="local-6989586621682461349"><span class="annot"><span class="annottext">db :: DBLayer IO s ShelleyKey
</span><a href="#local-6989586621682461349"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461352"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s ShelleyKey
     -&gt; Const (DBLayer IO s ShelleyKey) (DBLayer IO s ShelleyKey))
    -&gt; ctx -&gt; Const (DBLayer IO s ShelleyKey) ctx)
-&gt; DBLayer IO s ShelleyKey
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasDBLayer IO s ShelleyKey ctx =&gt;
Lens' ctx (DBLayer IO s ShelleyKey)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461354"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-3373"></span><span>
</span><span id="line-3374"></span><span class="hs-comment">-- | Retrieve any public account key of a wallet.</span><span>
</span><span id="line-3375"></span><span class="annot"><a href="Cardano.Wallet.html#getAccountPublicKeyAtIndex"><span class="hs-identifier hs-type">getAccountPublicKeyAtIndex</span></a></span><span>
</span><span id="line-3376"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461310"><span class="annot"><a href="#local-6989586621682461310"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461309"><span class="annot"><a href="#local-6989586621682461309"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461308"><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3377"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461310"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3378"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3379"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier hs-type">GetPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3380"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3381"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461310"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3382"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3383"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-3384"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3385"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3386"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKey"><span class="hs-identifier hs-type">ErrReadAccountPublicKey</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3387"></span><span id="getAccountPublicKeyAtIndex"><span class="annot"><span class="annottext">getAccountPublicKeyAtIndex :: ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; DerivationIndex
-&gt; Maybe DerivationIndex
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
</span><a href="Cardano.Wallet.html#getAccountPublicKeyAtIndex"><span class="hs-identifier hs-var hs-var">getAccountPublicKeyAtIndex</span></a></span></span><span> </span><span id="local-6989586621682461307"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461307"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461306"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461306"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461305"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461305"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span id="local-6989586621682461304"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461304"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621682461303"><span class="annot"><span class="annottext">Maybe DerivationIndex
</span><a href="#local-6989586621682461303"><span class="hs-identifier hs-var">purposeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461302"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k
    -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461276"><span id="local-6989586621682461277"><span id="local-6989586621682461278"><span id="local-6989586621682461279"><span id="local-6989586621682461280"><span id="local-6989586621682461281"><span id="local-6989586621682461282"><span id="local-6989586621682461283"><span id="local-6989586621682461284"><span id="local-6989586621682461285"><span id="local-6989586621682461286"><span id="local-6989586621682461287"><span id="local-6989586621682461288"><span id="local-6989586621682461289"><span id="local-6989586621682461290"><span id="local-6989586621682461291"><span id="local-6989586621682461292"><span id="local-6989586621682461293"><span id="local-6989586621682461294"><span id="local-6989586621682461295"><span id="local-6989586621682461296"><span id="local-6989586621682461297"><span id="local-6989586621682461298"><span id="local-6989586621682461299"><span id="local-6989586621682461300"><span id="local-6989586621682461301"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461276"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3388"></span><span>    </span><span id="local-6989586621682461275"><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682461275"><span class="hs-identifier hs-var">acctIx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Hardened 'AccountK
 -&gt; ErrReadAccountPublicKey)
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
-&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'AccountK)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
-&gt; ErrReadAccountPublicKey
</span><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyInvalidAccountIndex"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyInvalidAccountIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ErrInvalidDerivationIndex 'Hardened 'AccountK)
   IO
   (Index 'Hardened 'AccountK)
 -&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'AccountK))
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
-&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'AccountK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
forall (m :: * -&gt; *) (level :: Depth) (whatever :: Depth).
Monad m =&gt;
DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
</span><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier hs-var">guardHardIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461304"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3389"></span><span>
</span><span id="line-3390"></span><span>    </span><span id="local-6989586621682461273"><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="#local-6989586621682461273"><span class="hs-identifier hs-var">purpose</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK)
-&gt; (DerivationIndex
    -&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK))
-&gt; Maybe DerivationIndex
-&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetPurpose k =&gt; Index 'Hardened 'PurposeK
forall (key :: Depth -&gt; * -&gt; *).
GetPurpose key =&gt;
Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getPurpose"><span class="hs-identifier hs-var">getPurpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3391"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Hardened 'PurposeK
 -&gt; ErrReadAccountPublicKey)
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'PurposeK)
     IO
     (Index 'Hardened 'PurposeK)
-&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'PurposeK
-&gt; ErrReadAccountPublicKey
</span><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyInvalidPurposeIndex"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyInvalidPurposeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ErrInvalidDerivationIndex 'Hardened 'PurposeK)
   IO
   (Index 'Hardened 'PurposeK)
 -&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK))
-&gt; (DerivationIndex
    -&gt; ExceptT
         (ErrInvalidDerivationIndex 'Hardened 'PurposeK)
         IO
         (Index 'Hardened 'PurposeK))
-&gt; DerivationIndex
-&gt; ExceptT ErrReadAccountPublicKey IO (Index 'Hardened 'PurposeK)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'PurposeK)
     IO
     (Index 'Hardened 'PurposeK)
forall (m :: * -&gt; *) (level :: Depth) (whatever :: Depth).
Monad m =&gt;
DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
</span><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier hs-var">guardHardIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3392"></span><span>        </span><span class="annot"><span class="annottext">Maybe DerivationIndex
</span><a href="#local-6989586621682461303"><span class="hs-identifier hs-var">purposeM</span></a></span><span>
</span><span id="line-3393"></span><span>
</span><span id="line-3394"></span><span>    </span><span id="local-6989586621682461270"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682461270"><span class="hs-identifier hs-var">_cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrReadAccountPublicKey (Wallet s))
 -&gt; IO (Either ErrReadAccountPublicKey (Wallet s)))
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrReadAccountPublicKey (Wallet s))
-&gt; IO (Either ErrReadAccountPublicKey (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461276"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-3395"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrReadAccountPublicKey stm (Wallet s)
 -&gt; ExceptT ErrReadAccountPublicKey IO (Wallet s))
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrReadAccountPublicKey)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrReadAccountPublicKey
</span><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyNoSuchWallet</span></a></span><span>
</span><span id="line-3396"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrReadAccountPublicKey stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461306"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3397"></span><span>        </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682461296"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461306"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3398"></span><span>
</span><span id="line-3399"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrReadAccountPublicKey)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461310"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461307"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461306"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461305"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrReadAccountPublicKey
</span><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyRootKey"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyRootKey</span></a></span><span>
</span><span id="line-3400"></span><span>        </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme
  -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
 -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682461268"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461268"><span class="hs-identifier hs-var">rootK</span></a></span></span><span> </span><span id="local-6989586621682461267"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461267"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3401"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461266"><span class="annot"><span class="annottext">encPwd :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461266"><span class="hs-identifier hs-var hs-var">encPwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682461267"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682461305"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-3402"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461265"><span class="annot"><span class="annottext">xprv :: XPrv
</span><a href="#local-6989586621682461265"><span class="hs-identifier hs-var hs-var">xprv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; Passphrase &quot;encryption&quot;
-&gt; XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAccountPrivateKeyShelley"><span class="hs-identifier hs-var">deriveAccountPrivateKeyShelley</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="#local-6989586621682461273"><span class="hs-identifier hs-var">purpose</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682461266"><span class="hs-identifier hs-var">encPwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv -&gt; XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682461268"><span class="hs-identifier hs-var">rootK</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682461275"><span class="hs-identifier hs-var">acctIx</span></a></span><span>
</span><span id="line-3403"></span><span>            </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'AccountK XPub
 -&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub))
-&gt; k 'AccountK XPub
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
forall (key :: Depth -&gt; * -&gt; *) raw (depth :: Depth).
WalletKey key =&gt;
raw -&gt; key depth raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftRawKey"><span class="hs-identifier hs-var">liftRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; k 'AccountK XPub) -&gt; XPub -&gt; k 'AccountK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682461265"><span class="hs-identifier hs-var">xprv</span></a></span><span>
</span><span id="line-3404"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3405"></span><span>    </span><span id="local-6989586621682461302"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461302"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461307"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461308"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3406"></span><span>
</span><span id="line-3407"></span><span id="local-6989586621682464322"><span id="local-6989586621682464323"><span class="annot"><a href="Cardano.Wallet.html#guardSoftIndex"><span class="hs-identifier hs-type">guardSoftIndex</span></a></span><span>
</span><span id="line-3408"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464323"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3409"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3410"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682464323"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464322"><span class="hs-identifier hs-type">whatever</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3411"></span><span id="guardSoftIndex"><span class="annot"><span class="annottext">guardSoftIndex :: DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     m
     (Index 'Soft whatever)
</span><a href="Cardano.Wallet.html#guardSoftIndex"><span class="hs-identifier hs-var hs-var">guardSoftIndex</span></a></span></span><span> </span><span id="local-6989586621682461264"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461264"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3412"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461264"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; DerivationIndex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Soft Any -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft Any
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461264"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; DerivationIndex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Soft Any -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft Any
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3413"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     m
     (Index 'Soft whatever)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Soft 'AddressK
 -&gt; ExceptT
      (ErrInvalidDerivationIndex 'Soft 'AddressK)
      m
      (Index 'Soft whatever))
-&gt; ErrInvalidDerivationIndex 'Soft 'AddressK
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     m
     (Index 'Soft whatever)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'AddressK
-&gt; Index 'Soft 'AddressK
-&gt; DerivationIndex
-&gt; ErrInvalidDerivationIndex 'Soft 'AddressK
forall (derivation :: DerivationType) (level :: Depth).
Index derivation level
-&gt; Index derivation level
-&gt; DerivationIndex
-&gt; ErrInvalidDerivationIndex derivation level
</span><a href="Cardano.Wallet.html#ErrIndexOutOfBound"><span class="hs-identifier hs-var">ErrIndexOutOfBound</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'AddressK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'AddressK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461264"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3414"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Index 'Soft whatever
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Soft 'AddressK)
     m
     (Index 'Soft whatever)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Index 'Soft whatever
forall (derivationType :: DerivationType) (level :: Depth).
Word32 -&gt; Index derivationType level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Index 'Soft whatever) -&gt; Word32 -&gt; Index 'Soft whatever
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getDerivationIndex"><span class="hs-identifier hs-var hs-var">getDerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461264"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3415"></span><span>
</span><span id="line-3416"></span><span id="local-6989586621682464271"><span id="local-6989586621682464272"><span id="local-6989586621682464273"><span class="annot"><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier hs-type">guardHardIndex</span></a></span><span>
</span><span id="line-3417"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464273"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3418"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3419"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464272"><span class="hs-identifier hs-type">level</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682464273"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464271"><span class="hs-identifier hs-type">whatever</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-3420"></span><span id="guardHardIndex"><span class="annot"><span class="annottext">guardHardIndex :: DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
</span><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier hs-var hs-var">guardHardIndex</span></a></span></span><span> </span><span id="local-6989586621682461258"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461258"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3421"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461258"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; DerivationIndex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened Any -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened Any
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461258"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; DerivationIndex -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened Any -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened Any
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3422"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened level
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Hardened level
 -&gt; ExceptT
      (ErrInvalidDerivationIndex 'Hardened level)
      m
      (Index 'Hardened whatever))
-&gt; ErrInvalidDerivationIndex 'Hardened level
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened level
-&gt; Index 'Hardened level
-&gt; DerivationIndex
-&gt; ErrInvalidDerivationIndex 'Hardened level
forall (derivation :: DerivationType) (level :: Depth).
Index derivation level
-&gt; Index derivation level
-&gt; DerivationIndex
-&gt; ErrInvalidDerivationIndex derivation level
</span><a href="Cardano.Wallet.html#ErrIndexOutOfBound"><span class="hs-identifier hs-var">ErrIndexOutOfBound</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened level
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened level
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461258"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3423"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened whatever
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Index 'Hardened whatever
forall (derivationType :: DerivationType) (level :: Depth).
Word32 -&gt; Index derivationType level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Index 'Hardened whatever)
-&gt; Word32 -&gt; Index 'Hardened whatever
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getDerivationIndex"><span class="hs-identifier hs-var hs-var">getDerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682461258"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3424"></span><span>
</span><span id="line-3425"></span><span class="annot"><a href="Cardano.Wallet.html#updateCosigner"><span class="hs-identifier hs-type">updateCosigner</span></a></span><span>
</span><span id="line-3426"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461257"><span class="annot"><a href="#local-6989586621682461257"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682461256"><span class="annot"><a href="#local-6989586621682461256"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682461255"><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682461254"><span class="annot"><a href="#local-6989586621682461254"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3427"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682461256"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461254"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3428"></span><span class="hs-comment">--        , MkKeyFingerprint k (Proxy n, k 'AddressK CC.XPub)</span><span>
</span><span id="line-3429"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-3430"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3431"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461254"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3432"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3433"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasDBLayer"><span class="hs-identifier hs-type">HasDBLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461256"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461257"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3434"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-3435"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3436"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461257"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3437"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3438"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span>
</span><span id="line-3439"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">Cosigner</span></a></span><span>
</span><span id="line-3440"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#CredentialType"><span class="hs-identifier hs-type">CredentialType</span></a></span><span>
</span><span id="line-3441"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3442"></span><span id="updateCosigner"><span class="annot"><span class="annottext">updateCosigner :: ctx
-&gt; WalletId
-&gt; k 'AccountK XPub
-&gt; Cosigner
-&gt; CredentialType
-&gt; ExceptT ErrAddCosignerKey IO ()
</span><a href="Cardano.Wallet.html#updateCosigner"><span class="hs-identifier hs-var hs-var">updateCosigner</span></a></span></span><span> </span><span id="local-6989586621682461253"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461253"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682461252"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461252"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682461251"><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682461251"><span class="hs-identifier hs-var">cosignerXPub</span></a></span></span><span> </span><span id="local-6989586621682461250"><span class="annot"><span class="annottext">Cosigner
</span><a href="#local-6989586621682461250"><span class="hs-identifier hs-var">cosigner</span></a></span></span><span> </span><span id="local-6989586621682461249"><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682461249"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682461248"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrAddCosignerKey IO ())
-&gt; ExceptT ErrAddCosignerKey IO ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682461222"><span id="local-6989586621682461223"><span id="local-6989586621682461224"><span id="local-6989586621682461225"><span id="local-6989586621682461226"><span id="local-6989586621682461227"><span id="local-6989586621682461228"><span id="local-6989586621682461229"><span id="local-6989586621682461230"><span id="local-6989586621682461231"><span id="local-6989586621682461232"><span id="local-6989586621682461233"><span id="local-6989586621682461234"><span id="local-6989586621682461235"><span id="local-6989586621682461236"><span id="local-6989586621682461237"><span id="local-6989586621682461238"><span id="local-6989586621682461239"><span id="local-6989586621682461240"><span id="local-6989586621682461241"><span id="local-6989586621682461242"><span id="local-6989586621682461243"><span id="local-6989586621682461244"><span id="local-6989586621682461245"><span id="local-6989586621682461246"><span id="local-6989586621682461247"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; IO a
atomically :: forall a. stm a -&gt; IO a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682461222"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3443"></span><span>    </span><span class="annot"><span class="annottext">IO (Either ErrAddCosignerKey ()) -&gt; ExceptT ErrAddCosignerKey IO ()
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrAddCosignerKey ())
 -&gt; ExceptT ErrAddCosignerKey IO ())
-&gt; IO (Either ErrAddCosignerKey ())
-&gt; ExceptT ErrAddCosignerKey IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrAddCosignerKey ())
-&gt; IO (Either ErrAddCosignerKey ())
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682461222"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrAddCosignerKey ())
 -&gt; IO (Either ErrAddCosignerKey ()))
-&gt; stm (Either ErrAddCosignerKey ())
-&gt; IO (Either ErrAddCosignerKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
-&gt; (Map WalletId (WalletState (SharedState n k))
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrAddCosignerKey ()))
-&gt; stm (Either ErrAddCosignerKey ())
forall da (m :: * -&gt; *) a b.
(Delta da, Monad m, a ~ Base da) =&gt;
DBVar m da -&gt; (a -&gt; (Maybe da, b)) -&gt; m b
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">modifyDBMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar stm (DeltaMap WalletId (DeltaWalletState s))
</span><a href="#local-6989586621682461244"><span class="hs-identifier hs-var">walletsDB</span></a></span><span> </span><span class="annot"><span class="annottext">((Map WalletId (WalletState (SharedState n k))
  -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
      Either ErrAddCosignerKey ()))
 -&gt; stm (Either ErrAddCosignerKey ()))
-&gt; (Map WalletId (WalletState (SharedState n k))
    -&gt; (Maybe (DeltaMap WalletId (DeltaWalletState s)),
        Either ErrAddCosignerKey ()))
-&gt; stm (Either ErrAddCosignerKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3444"></span><span>        </span><span class="annot"><span class="annottext">WalletId
-&gt; (ErrNoSuchWallet -&gt; ErrAddCosignerKey)
-&gt; (WalletState (SharedState n k)
    -&gt; Either
         ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ()))
-&gt; Map WalletId (WalletState (SharedState n k))
-&gt; (Maybe
      (DeltaMap WalletId [DeltaWalletState1 (SharedState n k)]),
    Either ErrAddCosignerKey ())
forall e w dw b.
WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var">adjustNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682461252"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrAddCosignerKey
</span><a href="Cardano.Wallet.html#ErrAddCosignerKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrAddCosignerKeyNoSuchWallet</span></a></span><span>
</span><span id="line-3445"></span><span>            </span><span class="annot"><span class="annottext">WalletState (SharedState n k)
-&gt; Either
     ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ())
</span><a href="#local-6989586621682461220"><span class="hs-identifier hs-var">updateCosigner'</span></a></span><span>
</span><span id="line-3446"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3447"></span><span>    </span><span id="local-6989586621682461248"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682461248"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682461253"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; ctx -&gt; Const (DBLayer IO s k) ctx)
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461256"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461255"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3448"></span><span>    </span><span id="local-6989586621682461220"><span class="annot"><span class="annottext">updateCosigner' :: WalletState (SharedState n k)
-&gt; Either
     ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ())
</span><a href="#local-6989586621682461220"><span class="hs-identifier hs-var hs-var">updateCosigner'</span></a></span></span><span> </span><span id="local-6989586621682461219"><span class="annot"><span class="annottext">WalletState (SharedState n k)
</span><a href="#local-6989586621682461219"><span class="hs-identifier hs-var">wallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3449"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Cosigner, k 'AccountK XPub)
-&gt; CredentialType
-&gt; SharedState n k
-&gt; Either ErrAddCosigner (SharedState n k)
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
(SupportsDiscovery n k, WalletKey k, k ~ SharedKey) =&gt;
(Cosigner, k 'AccountK XPub)
-&gt; CredentialType
-&gt; SharedState n k
-&gt; Either ErrAddCosigner (SharedState n k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#addCosignerAccXPub"><span class="hs-identifier hs-var">addCosignerAccXPub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner
</span><a href="#local-6989586621682461250"><span class="hs-identifier hs-var">cosigner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682461251"><span class="hs-identifier hs-var">cosignerXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682461249"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461218"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3450"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682461217"><span class="annot"><span class="annottext">ErrAddCosigner
</span><a href="#local-6989586621682461217"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrAddCosignerKey
-&gt; Either
     ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ())
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrAddCosignerKey
 -&gt; Either
      ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ()))
-&gt; ErrAddCosignerKey
-&gt; Either
     ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAddCosigner -&gt; ErrAddCosignerKey
</span><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-var">ErrAddCosignerKey</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAddCosigner
</span><a href="#local-6989586621682461217"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-3451"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682461215"><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461215"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([DeltaWalletState1 (SharedState n k)], ())
-&gt; Either
     ErrAddCosignerKey ([DeltaWalletState1 (SharedState n k)], ())
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Prologue (SharedState n k) -&gt; DeltaWalletState1 (SharedState n k)
forall s. Prologue s -&gt; DeltaWalletState1 s
</span><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">(Prologue (SharedState n k) -&gt; DeltaWalletState1 (SharedState n k))
-&gt; Prologue (SharedState n k)
-&gt; DeltaWalletState1 (SharedState n k)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; Prologue (SharedState n k)
forall s. AddressBookIso s =&gt; s -&gt; Prologue s
</span><a href="Cardano.Wallet.Address.Book.html#getPrologue"><span class="hs-identifier hs-var">getPrologue</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461215"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3452"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3453"></span><span>        </span><span id="local-6989586621682461218"><span class="annot"><span class="annottext">s0 :: SharedState n k
</span><a href="#local-6989586621682461218"><span class="hs-identifier hs-var hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet (SharedState n k) -&gt; SharedState n k
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">(Wallet (SharedState n k) -&gt; SharedState n k)
-&gt; Wallet (SharedState n k) -&gt; SharedState n k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState (SharedState n k) -&gt; Wallet (SharedState n k)
forall s. AddressBookIso s =&gt; WalletState s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier hs-var">getLatest</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState (SharedState n k)
</span><a href="#local-6989586621682461219"><span class="hs-identifier hs-var">wallet</span></a></span><span>
</span><span id="line-3454"></span><span>
</span><span id="line-3455"></span><span class="hs-comment">-- NOTE</span><span>
</span><span id="line-3456"></span><span class="hs-comment">-- Addresses coming from the transaction history might be base (having payment credential) or</span><span>
</span><span id="line-3457"></span><span class="hs-comment">-- base addresses (containing both payment and delegation credentials).</span><span>
</span><span id="line-3458"></span><span class="hs-comment">-- So we normalize them all to be base addresses to make sure that we compare them correctly.</span><span>
</span><span id="line-3459"></span><span class="annot"><a href="Cardano.Wallet.html#normalizeSharedAddress"><span class="hs-identifier hs-type">normalizeSharedAddress</span></a></span><span>
</span><span id="line-3460"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682461214"><span class="annot"><a href="#local-6989586621682461214"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682461213"><span class="annot"><a href="#local-6989586621682461213"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SupportsDiscovery"><span class="hs-identifier hs-type">Shared.SupportsDiscovery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461214"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461213"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682461213"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3461"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461214"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682461213"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3462"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-3463"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-3464"></span><span id="normalizeSharedAddress"><span class="annot"><span class="annottext">normalizeSharedAddress :: SharedState n k -&gt; Address -&gt; Maybe Address
</span><a href="Cardano.Wallet.html#normalizeSharedAddress"><span class="hs-identifier hs-var hs-var">normalizeSharedAddress</span></a></span></span><span> </span><span id="local-6989586621682461212"><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461212"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621682461211"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682461211"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; Readiness (SharedAddressPools k)
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; Readiness (SharedAddressPools k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ready"><span class="hs-identifier hs-var hs-var">Shared.ready</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461212"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3465"></span><span>    </span><span class="annot"><span class="annottext">Readiness (SharedAddressPools k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#Pending"><span class="hs-identifier hs-var">Shared.Pending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Address
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3466"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#Active"><span class="hs-identifier hs-type">Shared.Active</span></a></span><span> </span><span class="annot"><span class="annottext">SharedAddressPools k
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3467"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682461207"><span class="annot"><span class="annottext">dTM :: Maybe ScriptTemplate
</span><a href="#local-6989586621682461207"><span class="hs-identifier hs-var hs-var">dTM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; Maybe ScriptTemplate
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; Maybe ScriptTemplate
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#delegationTemplate"><span class="hs-identifier hs-var hs-var">Shared.delegationTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461212"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-3468"></span><span>        </span><span id="local-6989586621682461205"><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k
</span><a href="#local-6989586621682461205"><span class="hs-identifier hs-var">fingerprint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either (ErrMkKeyFingerprint k Address) (KeyFingerprint &quot;payment&quot; k)
-&gt; Maybe (KeyFingerprint &quot;payment&quot; k)
forall a b. Either a b -&gt; Maybe b
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
-&gt; Either
     (ErrMkKeyFingerprint k Address) (KeyFingerprint &quot;payment&quot; k)
forall (key :: Depth -&gt; * -&gt; *) from.
MkKeyFingerprint key from =&gt;
from
-&gt; Either
     (ErrMkKeyFingerprint key from) (KeyFingerprint &quot;payment&quot; key)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentKeyFingerprint"><span class="hs-identifier hs-var">paymentKeyFingerprint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461213"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682461211"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3469"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461204"><span class="annot"><span class="annottext">Maybe (Index 'Soft 'ScriptK)
</span><a href="#local-6989586621682461204"><span class="hs-identifier hs-var">ixM</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SharedState n k
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
-&gt; SharedState n k
-&gt; (Maybe (Index 'Soft 'ScriptK), SharedState n k)
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SupportsDiscovery n k =&gt;
Address
-&gt; SharedState n k
-&gt; (Maybe (Index 'Soft 'ScriptK), SharedState n k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#isShared"><span class="hs-identifier hs-var">Shared.isShared</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682461211"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k
</span><a href="#local-6989586621682461212"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-3470"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682461207"><span class="hs-identifier hs-var">dTM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Index 'Soft 'ScriptK)
</span><a href="#local-6989586621682461204"><span class="hs-identifier hs-var">ixM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3471"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682461202"><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682461202"><span class="hs-identifier hs-var">dT</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682461201"><span class="annot"><span class="annottext">Index 'Soft 'ScriptK
</span><a href="#local-6989586621682461201"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3472"></span><span>                </span><span class="annot"><span class="annottext">Address -&gt; Maybe Address
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Maybe Address) -&gt; Address -&gt; Maybe Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'ScriptK
-&gt; ScriptTemplate -&gt; KeyFingerprint &quot;payment&quot; k -&gt; Address
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
Typeable n =&gt;
Index 'Soft 'ScriptK
-&gt; ScriptTemplate -&gt; KeyFingerprint &quot;payment&quot; k -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#liftDelegationAddress"><span class="hs-identifier hs-var">Shared.liftDelegationAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461214"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'ScriptK
</span><a href="#local-6989586621682461201"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682461202"><span class="hs-identifier hs-var">dT</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k
</span><a href="#local-6989586621682461205"><span class="hs-identifier hs-var">fingerprint</span></a></span><span>
</span><span id="line-3473"></span><span>            </span><span class="annot"><span class="annottext">(Maybe ScriptTemplate, Maybe (Index 'Soft 'ScriptK))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3474"></span><span>                </span><span class="annot"><span class="annottext">Address -&gt; Maybe Address
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Maybe Address) -&gt; Address -&gt; Maybe Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k -&gt; Address
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
Typeable n =&gt;
KeyFingerprint &quot;payment&quot; k -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#liftPaymentAddress"><span class="hs-identifier hs-var">Shared.liftPaymentAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682461214"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; k
</span><a href="#local-6989586621682461205"><span class="hs-identifier hs-var">fingerprint</span></a></span><span>
</span><span id="line-3475"></span><span>
</span><span id="line-3476"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                   Errors
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3479"></span><span>
</span><span id="line-3480"></span><span class="hs-keyword">data</span><span> </span><span id="ErrSignMetadataWith"><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWith"><span class="hs-identifier hs-var">ErrSignMetadataWith</span></a></span></span><span>
</span><span id="line-3481"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrSignMetadataWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWithRootKey"><span class="hs-identifier hs-var">ErrSignMetadataWithRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3482"></span><span>        </span><span class="hs-comment">-- ^ The wallet exists, but there's no root key attached to it</span><span>
</span><span id="line-3483"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSignMetadataWithNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWithNoSuchWallet"><span class="hs-identifier hs-var">ErrSignMetadataWithNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3484"></span><span>        </span><span class="hs-comment">-- ^ The wallet doesn't exist?</span><span>
</span><span id="line-3485"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSignMetadataWithInvalidIndex"><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWithInvalidIndex"><span class="hs-identifier hs-var">ErrSignMetadataWithInvalidIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3486"></span><span>        </span><span class="hs-comment">-- ^ User provided a derivation index outside of the 'Soft' domain</span><span>
</span><span id="line-3487"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461195"><span id="local-6989586621682461197"><span class="annot"><span class="annottext">ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool
(ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool)
-&gt; (ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool)
-&gt; Eq ErrSignMetadataWith
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool
$c/= :: ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool
== :: ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool
$c== :: ErrSignMetadataWith -&gt; ErrSignMetadataWith -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461189"><span id="local-6989586621682461191"><span id="local-6989586621682461193"><span class="annot"><span class="annottext">Int -&gt; ErrSignMetadataWith -&gt; ShowS
[ErrSignMetadataWith] -&gt; ShowS
ErrSignMetadataWith -&gt; String
(Int -&gt; ErrSignMetadataWith -&gt; ShowS)
-&gt; (ErrSignMetadataWith -&gt; String)
-&gt; ([ErrSignMetadataWith] -&gt; ShowS)
-&gt; Show ErrSignMetadataWith
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrSignMetadataWith] -&gt; ShowS
$cshowList :: [ErrSignMetadataWith] -&gt; ShowS
show :: ErrSignMetadataWith -&gt; String
$cshow :: ErrSignMetadataWith -&gt; String
showsPrec :: Int -&gt; ErrSignMetadataWith -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrSignMetadataWith -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3488"></span><span>
</span><span id="line-3489"></span><span class="hs-keyword">data</span><span> </span><span id="ErrDerivePublicKey"><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKey"><span class="hs-identifier hs-var">ErrDerivePublicKey</span></a></span></span><span>
</span><span id="line-3490"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrDerivePublicKeyNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrDerivePublicKeyNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3491"></span><span>        </span><span class="hs-comment">-- ^ The wallet doesn't exist?</span><span>
</span><span id="line-3492"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrDerivePublicKeyInvalidIndex"><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKeyInvalidIndex"><span class="hs-identifier hs-var">ErrDerivePublicKeyInvalidIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3493"></span><span>        </span><span class="hs-comment">-- ^ User provided a derivation index outside of the 'Soft' domain</span><span>
</span><span id="line-3494"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461185"><span id="local-6989586621682461187"><span class="annot"><span class="annottext">ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool
(ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool)
-&gt; (ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool)
-&gt; Eq ErrDerivePublicKey
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool
$c/= :: ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool
== :: ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool
$c== :: ErrDerivePublicKey -&gt; ErrDerivePublicKey -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461179"><span id="local-6989586621682461181"><span id="local-6989586621682461183"><span class="annot"><span class="annottext">Int -&gt; ErrDerivePublicKey -&gt; ShowS
[ErrDerivePublicKey] -&gt; ShowS
ErrDerivePublicKey -&gt; String
(Int -&gt; ErrDerivePublicKey -&gt; ShowS)
-&gt; (ErrDerivePublicKey -&gt; String)
-&gt; ([ErrDerivePublicKey] -&gt; ShowS)
-&gt; Show ErrDerivePublicKey
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrDerivePublicKey] -&gt; ShowS
$cshowList :: [ErrDerivePublicKey] -&gt; ShowS
show :: ErrDerivePublicKey -&gt; String
$cshow :: ErrDerivePublicKey -&gt; String
showsPrec :: Int -&gt; ErrDerivePublicKey -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrDerivePublicKey -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3495"></span><span>
</span><span id="line-3496"></span><span class="hs-keyword">data</span><span> </span><span id="ErrAddCosignerKey"><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-var">ErrAddCosignerKey</span></a></span></span><span>
</span><span id="line-3497"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrAddCosignerKeyNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrAddCosignerKeyNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3498"></span><span>        </span><span class="hs-comment">-- ^ The shared wallet doesn't exist?</span><span>
</span><span id="line-3499"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrAddCosignerKey"><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-var">ErrAddCosignerKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrAddCosigner"><span class="hs-identifier hs-type">ErrAddCosigner</span></a></span><span>
</span><span id="line-3500"></span><span>        </span><span class="hs-comment">-- ^ Error adding this co-signer to the shared wallet.</span><span>
</span><span id="line-3501"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461175"><span id="local-6989586621682461177"><span class="annot"><span class="annottext">ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool
(ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool)
-&gt; (ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool)
-&gt; Eq ErrAddCosignerKey
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool
$c/= :: ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool
== :: ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool
$c== :: ErrAddCosignerKey -&gt; ErrAddCosignerKey -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461169"><span id="local-6989586621682461171"><span id="local-6989586621682461173"><span class="annot"><span class="annottext">Int -&gt; ErrAddCosignerKey -&gt; ShowS
[ErrAddCosignerKey] -&gt; ShowS
ErrAddCosignerKey -&gt; String
(Int -&gt; ErrAddCosignerKey -&gt; ShowS)
-&gt; (ErrAddCosignerKey -&gt; String)
-&gt; ([ErrAddCosignerKey] -&gt; ShowS)
-&gt; Show ErrAddCosignerKey
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrAddCosignerKey] -&gt; ShowS
$cshowList :: [ErrAddCosignerKey] -&gt; ShowS
show :: ErrAddCosignerKey -&gt; String
$cshow :: ErrAddCosignerKey -&gt; String
showsPrec :: Int -&gt; ErrAddCosignerKey -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrAddCosignerKey -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3502"></span><span>
</span><span id="line-3503"></span><span class="hs-keyword">data</span><span> </span><span id="ErrConstructSharedWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWallet"><span class="hs-identifier hs-var">ErrConstructSharedWallet</span></a></span></span><span>
</span><span id="line-3504"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrConstructSharedWalletWrongScriptTemplate"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWalletWrongScriptTemplate"><span class="hs-identifier hs-var">ErrConstructSharedWalletWrongScriptTemplate</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrScriptTemplate"><span class="hs-identifier hs-type">ErrScriptTemplate</span></a></span><span>
</span><span id="line-3505"></span><span>        </span><span class="hs-comment">-- ^ The shared wallet' script template doesn't pass validation</span><span>
</span><span id="line-3506"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructSharedWalletInvalidIndex"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWalletInvalidIndex"><span class="hs-identifier hs-var">ErrConstructSharedWalletInvalidIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3507"></span><span>        </span><span class="hs-comment">-- ^ User provided a derivation index outside of the 'Hard' domain</span><span>
</span><span id="line-3508"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461163"><span id="local-6989586621682461165"><span class="annot"><span class="annottext">ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool
(ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool)
-&gt; (ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool)
-&gt; Eq ErrConstructSharedWallet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool
$c/= :: ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool
== :: ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool
$c== :: ErrConstructSharedWallet -&gt; ErrConstructSharedWallet -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461157"><span id="local-6989586621682461159"><span id="local-6989586621682461161"><span class="annot"><span class="annottext">Int -&gt; ErrConstructSharedWallet -&gt; ShowS
[ErrConstructSharedWallet] -&gt; ShowS
ErrConstructSharedWallet -&gt; String
(Int -&gt; ErrConstructSharedWallet -&gt; ShowS)
-&gt; (ErrConstructSharedWallet -&gt; String)
-&gt; ([ErrConstructSharedWallet] -&gt; ShowS)
-&gt; Show ErrConstructSharedWallet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrConstructSharedWallet] -&gt; ShowS
$cshowList :: [ErrConstructSharedWallet] -&gt; ShowS
show :: ErrConstructSharedWallet -&gt; String
$cshow :: ErrConstructSharedWallet -&gt; String
showsPrec :: Int -&gt; ErrConstructSharedWallet -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrConstructSharedWallet -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3509"></span><span>
</span><span id="line-3510"></span><span class="hs-keyword">data</span><span> </span><span id="ErrReadAccountPublicKey"><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKey"><span class="hs-identifier hs-var">ErrReadAccountPublicKey</span></a></span></span><span>
</span><span id="line-3511"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrReadAccountPublicKeyNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3512"></span><span>        </span><span class="hs-comment">-- ^ The wallet doesn't exist?</span><span>
</span><span id="line-3513"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrReadAccountPublicKeyInvalidAccountIndex"><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyInvalidAccountIndex"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyInvalidAccountIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3514"></span><span>        </span><span class="hs-comment">-- ^ User provided a derivation index for account outside of the 'Hard' domain</span><span>
</span><span id="line-3515"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrReadAccountPublicKeyInvalidPurposeIndex"><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyInvalidPurposeIndex"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyInvalidPurposeIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PurposeK"><span class="hs-identifier hs-type">PurposeK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3516"></span><span>        </span><span class="hs-comment">-- ^ User provided a derivation index for purpose outside of the 'Hard' domain</span><span>
</span><span id="line-3517"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrReadAccountPublicKeyRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyRootKey"><span class="hs-identifier hs-var">ErrReadAccountPublicKeyRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3518"></span><span>        </span><span class="hs-comment">-- ^ The wallet exists, but there's no root key attached to it</span><span>
</span><span id="line-3519"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461153"><span id="local-6989586621682461155"><span class="annot"><span class="annottext">ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool
(ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool)
-&gt; (ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool)
-&gt; Eq ErrReadAccountPublicKey
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool
$c/= :: ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool
== :: ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool
$c== :: ErrReadAccountPublicKey -&gt; ErrReadAccountPublicKey -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461147"><span id="local-6989586621682461149"><span id="local-6989586621682461151"><span class="annot"><span class="annottext">Int -&gt; ErrReadAccountPublicKey -&gt; ShowS
[ErrReadAccountPublicKey] -&gt; ShowS
ErrReadAccountPublicKey -&gt; String
(Int -&gt; ErrReadAccountPublicKey -&gt; ShowS)
-&gt; (ErrReadAccountPublicKey -&gt; String)
-&gt; ([ErrReadAccountPublicKey] -&gt; ShowS)
-&gt; Show ErrReadAccountPublicKey
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrReadAccountPublicKey] -&gt; ShowS
$cshowList :: [ErrReadAccountPublicKey] -&gt; ShowS
show :: ErrReadAccountPublicKey -&gt; String
$cshow :: ErrReadAccountPublicKey -&gt; String
showsPrec :: Int -&gt; ErrReadAccountPublicKey -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrReadAccountPublicKey -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3520"></span><span>
</span><span id="line-3521"></span><span class="hs-keyword">data</span><span> </span><span id="ErrInvalidDerivationIndex"><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-var">ErrInvalidDerivationIndex</span></a></span></span><span> </span><span id="local-6989586621682464264"><span class="annot"><a href="#local-6989586621682464264"><span class="hs-identifier hs-type">derivation</span></a></span></span><span> </span><span id="local-6989586621682464263"><span class="annot"><a href="#local-6989586621682464263"><span class="hs-identifier hs-type">level</span></a></span></span><span>
</span><span id="line-3522"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrIndexOutOfBound"><span class="annot"><a href="Cardano.Wallet.html#ErrIndexOutOfBound"><span class="hs-identifier hs-var">ErrIndexOutOfBound</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464264"><span class="hs-identifier hs-type">derivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464263"><span class="hs-identifier hs-type">level</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464264"><span class="hs-identifier hs-type">derivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464263"><span class="hs-identifier hs-type">level</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3523"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461143"><span id="local-6989586621682461145"><span class="annot"><span class="annottext">ErrInvalidDerivationIndex derivation level
-&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool
(ErrInvalidDerivationIndex derivation level
 -&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool)
-&gt; (ErrInvalidDerivationIndex derivation level
    -&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool)
-&gt; Eq (ErrInvalidDerivationIndex derivation level)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall (derivation :: DerivationType) (level :: Depth).
ErrInvalidDerivationIndex derivation level
-&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool
/= :: ErrInvalidDerivationIndex derivation level
-&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool
$c/= :: forall (derivation :: DerivationType) (level :: Depth).
ErrInvalidDerivationIndex derivation level
-&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool
== :: ErrInvalidDerivationIndex derivation level
-&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool
$c== :: forall (derivation :: DerivationType) (level :: Depth).
ErrInvalidDerivationIndex derivation level
-&gt; ErrInvalidDerivationIndex derivation level -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461137"><span id="local-6989586621682461139"><span id="local-6989586621682461141"><span class="annot"><span class="annottext">Int -&gt; ErrInvalidDerivationIndex derivation level -&gt; ShowS
[ErrInvalidDerivationIndex derivation level] -&gt; ShowS
ErrInvalidDerivationIndex derivation level -&gt; String
(Int -&gt; ErrInvalidDerivationIndex derivation level -&gt; ShowS)
-&gt; (ErrInvalidDerivationIndex derivation level -&gt; String)
-&gt; ([ErrInvalidDerivationIndex derivation level] -&gt; ShowS)
-&gt; Show (ErrInvalidDerivationIndex derivation level)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (derivation :: DerivationType) (level :: Depth).
Int -&gt; ErrInvalidDerivationIndex derivation level -&gt; ShowS
forall (derivation :: DerivationType) (level :: Depth).
[ErrInvalidDerivationIndex derivation level] -&gt; ShowS
forall (derivation :: DerivationType) (level :: Depth).
ErrInvalidDerivationIndex derivation level -&gt; String
showList :: [ErrInvalidDerivationIndex derivation level] -&gt; ShowS
$cshowList :: forall (derivation :: DerivationType) (level :: Depth).
[ErrInvalidDerivationIndex derivation level] -&gt; ShowS
show :: ErrInvalidDerivationIndex derivation level -&gt; String
$cshow :: forall (derivation :: DerivationType) (level :: Depth).
ErrInvalidDerivationIndex derivation level -&gt; String
showsPrec :: Int -&gt; ErrInvalidDerivationIndex derivation level -&gt; ShowS
$cshowsPrec :: forall (derivation :: DerivationType) (level :: Depth).
Int -&gt; ErrInvalidDerivationIndex derivation level -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3524"></span><span>
</span><span id="line-3525"></span><span class="hs-comment">-- | Errors that can occur when listing UTxO statistics.</span><span>
</span><span id="line-3526"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrListUTxOStatistics"><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatistics"><span class="hs-identifier hs-var">ErrListUTxOStatistics</span></a></span></span><span>
</span><span id="line-3527"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrListUTxOStatisticsNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatisticsNoSuchWallet"><span class="hs-identifier hs-var">ErrListUTxOStatisticsNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3528"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461131"><span id="local-6989586621682461133"><span id="local-6989586621682461135"><span class="annot"><span class="annottext">Int -&gt; ErrListUTxOStatistics -&gt; ShowS
[ErrListUTxOStatistics] -&gt; ShowS
ErrListUTxOStatistics -&gt; String
(Int -&gt; ErrListUTxOStatistics -&gt; ShowS)
-&gt; (ErrListUTxOStatistics -&gt; String)
-&gt; ([ErrListUTxOStatistics] -&gt; ShowS)
-&gt; Show ErrListUTxOStatistics
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrListUTxOStatistics] -&gt; ShowS
$cshowList :: [ErrListUTxOStatistics] -&gt; ShowS
show :: ErrListUTxOStatistics -&gt; String
$cshow :: ErrListUTxOStatistics -&gt; String
showsPrec :: Int -&gt; ErrListUTxOStatistics -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrListUTxOStatistics -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461127"><span id="local-6989586621682461129"><span class="annot"><span class="annottext">ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool
(ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool)
-&gt; (ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool)
-&gt; Eq ErrListUTxOStatistics
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool
$c/= :: ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool
== :: ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool
$c== :: ErrListUTxOStatistics -&gt; ErrListUTxOStatistics -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3529"></span><span>
</span><span id="line-3530"></span><span class="hs-comment">-- | Errors that can occur when signing a transaction.</span><span>
</span><span id="line-3531"></span><span class="hs-keyword">data</span><span> </span><span id="ErrSignPayment"><span class="annot"><a href="Cardano.Wallet.html#ErrSignPayment"><span class="hs-identifier hs-var">ErrSignPayment</span></a></span></span><span>
</span><span id="line-3532"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrSignPaymentMkTx"><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentMkTx"><span class="hs-identifier hs-var">ErrSignPaymentMkTx</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransaction"><span class="hs-identifier hs-type">ErrMkTransaction</span></a></span><span>
</span><span id="line-3533"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSignPaymentNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentNoSuchWallet"><span class="hs-identifier hs-var">ErrSignPaymentNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3534"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSignPaymentWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentWithRootKey"><span class="hs-identifier hs-var">ErrSignPaymentWithRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3535"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSignPaymentIncorrectTTL"><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentIncorrectTTL"><span class="hs-identifier hs-var">ErrSignPaymentIncorrectTTL</span></a></span></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span>
</span><span id="line-3536"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461120"><span id="local-6989586621682461122"><span id="local-6989586621682461124"><span class="annot"><span class="annottext">Int -&gt; ErrSignPayment -&gt; ShowS
[ErrSignPayment] -&gt; ShowS
ErrSignPayment -&gt; String
(Int -&gt; ErrSignPayment -&gt; ShowS)
-&gt; (ErrSignPayment -&gt; String)
-&gt; ([ErrSignPayment] -&gt; ShowS)
-&gt; Show ErrSignPayment
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrSignPayment] -&gt; ShowS
$cshowList :: [ErrSignPayment] -&gt; ShowS
show :: ErrSignPayment -&gt; String
$cshow :: ErrSignPayment -&gt; String
showsPrec :: Int -&gt; ErrSignPayment -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrSignPayment -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461116"><span id="local-6989586621682461118"><span class="annot"><span class="annottext">ErrSignPayment -&gt; ErrSignPayment -&gt; Bool
(ErrSignPayment -&gt; ErrSignPayment -&gt; Bool)
-&gt; (ErrSignPayment -&gt; ErrSignPayment -&gt; Bool) -&gt; Eq ErrSignPayment
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrSignPayment -&gt; ErrSignPayment -&gt; Bool
$c/= :: ErrSignPayment -&gt; ErrSignPayment -&gt; Bool
== :: ErrSignPayment -&gt; ErrSignPayment -&gt; Bool
$c== :: ErrSignPayment -&gt; ErrSignPayment -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3537"></span><span>
</span><span id="line-3538"></span><span class="hs-comment">-- | Errors that can occur when balancing transaction.</span><span>
</span><span id="line-3539"></span><span class="hs-keyword">data</span><span> </span><span id="ErrBalanceTx"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-var">ErrBalanceTx</span></a></span></span><span>
</span><span id="line-3540"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrBalanceTxUpdateError"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxUpdateError"><span class="hs-identifier hs-var">ErrBalanceTxUpdateError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrUpdateSealedTx"><span class="hs-identifier hs-type">ErrUpdateSealedTx</span></a></span><span>
</span><span id="line-3541"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxSelectAssets"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxSelectAssets"><span class="hs-identifier hs-var">ErrBalanceTxSelectAssets</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span>
</span><span id="line-3542"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxMaxSizeLimitExceeded"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxMaxSizeLimitExceeded"><span class="hs-identifier hs-var">ErrBalanceTxMaxSizeLimitExceeded</span></a></span></span><span>
</span><span id="line-3543"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxExistingCollateral"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxExistingCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingCollateral</span></a></span></span><span>
</span><span id="line-3544"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxExistingTotalCollateral"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxExistingTotalCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingTotalCollateral</span></a></span></span><span>
</span><span id="line-3545"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxExistingReturnCollateral"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxExistingReturnCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingReturnCollateral</span></a></span></span><span>
</span><span id="line-3546"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxConflictingNetworks"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxConflictingNetworks"><span class="hs-identifier hs-var">ErrBalanceTxConflictingNetworks</span></a></span></span><span>
</span><span id="line-3547"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxAssignRedeemers"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxAssignRedeemers"><span class="hs-identifier hs-var">ErrBalanceTxAssignRedeemers</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemers"><span class="hs-identifier hs-type">ErrAssignRedeemers</span></a></span><span>
</span><span id="line-3548"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxInternalError"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-var">ErrBalanceTxInternalError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-type">ErrBalanceTxInternalError</span></a></span><span>
</span><span id="line-3549"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBalanceTxZeroAdaOutput"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxZeroAdaOutput"><span class="hs-identifier hs-var">ErrBalanceTxZeroAdaOutput</span></a></span></span><span>
</span><span id="line-3550"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrByronTxNotSupported"><span class="annot"><a href="Cardano.Wallet.html#ErrByronTxNotSupported"><span class="hs-identifier hs-var">ErrByronTxNotSupported</span></a></span></span><span>
</span><span id="line-3551"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461109"><span id="local-6989586621682461111"><span id="local-6989586621682461113"><span class="annot"><span class="annottext">Int -&gt; ErrBalanceTx -&gt; ShowS
[ErrBalanceTx] -&gt; ShowS
ErrBalanceTx -&gt; String
(Int -&gt; ErrBalanceTx -&gt; ShowS)
-&gt; (ErrBalanceTx -&gt; String)
-&gt; ([ErrBalanceTx] -&gt; ShowS)
-&gt; Show ErrBalanceTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrBalanceTx] -&gt; ShowS
$cshowList :: [ErrBalanceTx] -&gt; ShowS
show :: ErrBalanceTx -&gt; String
$cshow :: ErrBalanceTx -&gt; String
showsPrec :: Int -&gt; ErrBalanceTx -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrBalanceTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461105"><span id="local-6989586621682461107"><span class="annot"><span class="annottext">ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool
(ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool)
-&gt; (ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool) -&gt; Eq ErrBalanceTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool
$c/= :: ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool
== :: ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool
$c== :: ErrBalanceTx -&gt; ErrBalanceTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3552"></span><span>
</span><span id="line-3553"></span><span class="hs-keyword">data</span><span> </span><span id="ErrBalanceTxInternalError"><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-var">ErrBalanceTxInternalError</span></a></span></span><span>
</span><span id="line-3554"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrUnderestimatedFee"><span class="annot"><a href="Cardano.Wallet.html#ErrUnderestimatedFee"><span class="hs-identifier hs-var">ErrUnderestimatedFee</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-3555"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrFailedBalancing"><span class="annot"><a href="Cardano.Wallet.html#ErrFailedBalancing"><span class="hs-identifier hs-var">ErrFailedBalancing</span></a></span></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Value</span></a></span><span>
</span><span id="line-3556"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461099"><span id="local-6989586621682461101"><span id="local-6989586621682461103"><span class="annot"><span class="annottext">Int -&gt; ErrBalanceTxInternalError -&gt; ShowS
[ErrBalanceTxInternalError] -&gt; ShowS
ErrBalanceTxInternalError -&gt; String
(Int -&gt; ErrBalanceTxInternalError -&gt; ShowS)
-&gt; (ErrBalanceTxInternalError -&gt; String)
-&gt; ([ErrBalanceTxInternalError] -&gt; ShowS)
-&gt; Show ErrBalanceTxInternalError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrBalanceTxInternalError] -&gt; ShowS
$cshowList :: [ErrBalanceTxInternalError] -&gt; ShowS
show :: ErrBalanceTxInternalError -&gt; String
$cshow :: ErrBalanceTxInternalError -&gt; String
showsPrec :: Int -&gt; ErrBalanceTxInternalError -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrBalanceTxInternalError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461095"><span id="local-6989586621682461097"><span class="annot"><span class="annottext">ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool
(ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool)
-&gt; (ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool)
-&gt; Eq ErrBalanceTxInternalError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool
$c/= :: ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool
== :: ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool
$c== :: ErrBalanceTxInternalError -&gt; ErrBalanceTxInternalError -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3557"></span><span>
</span><span id="line-3558"></span><span class="hs-comment">-- | Errors that can occur when submitting a transaction.</span><span>
</span><span id="line-3559"></span><span class="hs-keyword">data</span><span> </span><span id="ErrSubmitTransaction"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransaction"><span class="hs-identifier hs-var">ErrSubmitTransaction</span></a></span></span><span>
</span><span id="line-3560"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrSubmitTransactionNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransactionNoSuchWallet"><span class="hs-identifier hs-var">ErrSubmitTransactionNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3561"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSubmitTransactionForeignWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransactionForeignWallet"><span class="hs-identifier hs-var">ErrSubmitTransactionForeignWallet</span></a></span></span><span>
</span><span id="line-3562"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSubmitTransactionPartiallySignedOrNoSignedTx"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransactionPartiallySignedOrNoSignedTx"><span class="hs-identifier hs-var">ErrSubmitTransactionPartiallySignedOrNoSignedTx</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-3563"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSubmitTransactionMultidelegationNotSupported"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransactionMultidelegationNotSupported"><span class="hs-identifier hs-var">ErrSubmitTransactionMultidelegationNotSupported</span></a></span></span><span>
</span><span id="line-3564"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461086"><span id="local-6989586621682461088"><span id="local-6989586621682461090"><span class="annot"><span class="annottext">Int -&gt; ErrSubmitTransaction -&gt; ShowS
[ErrSubmitTransaction] -&gt; ShowS
ErrSubmitTransaction -&gt; String
(Int -&gt; ErrSubmitTransaction -&gt; ShowS)
-&gt; (ErrSubmitTransaction -&gt; String)
-&gt; ([ErrSubmitTransaction] -&gt; ShowS)
-&gt; Show ErrSubmitTransaction
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrSubmitTransaction] -&gt; ShowS
$cshowList :: [ErrSubmitTransaction] -&gt; ShowS
show :: ErrSubmitTransaction -&gt; String
$cshow :: ErrSubmitTransaction -&gt; String
showsPrec :: Int -&gt; ErrSubmitTransaction -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrSubmitTransaction -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461082"><span id="local-6989586621682461084"><span class="annot"><span class="annottext">ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool
(ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool)
-&gt; (ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool)
-&gt; Eq ErrSubmitTransaction
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool
$c/= :: ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool
== :: ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool
$c== :: ErrSubmitTransaction -&gt; ErrSubmitTransaction -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3565"></span><span>
</span><span id="line-3566"></span><span class="hs-comment">-- | Errors that can occur when constructing an unsigned transaction.</span><span>
</span><span id="line-3567"></span><span class="hs-keyword">data</span><span> </span><span id="ErrConstructTx"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier hs-var">ErrConstructTx</span></a></span></span><span>
</span><span id="line-3568"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrConstructTxWrongPayload"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxWrongPayload"><span class="hs-identifier hs-var">ErrConstructTxWrongPayload</span></a></span></span><span>
</span><span id="line-3569"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxBody"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxBody"><span class="hs-identifier hs-var">ErrConstructTxBody</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransaction"><span class="hs-identifier hs-type">ErrMkTransaction</span></a></span><span>
</span><span id="line-3570"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxNoSuchWallet"><span class="hs-identifier hs-var">ErrConstructTxNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3571"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxReadRewardAccount"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxReadRewardAccount"><span class="hs-identifier hs-var">ErrConstructTxReadRewardAccount</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier hs-type">ErrReadRewardAccount</span></a></span><span>
</span><span id="line-3572"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxIncorrectTTL"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxIncorrectTTL"><span class="hs-identifier hs-var">ErrConstructTxIncorrectTTL</span></a></span></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span>
</span><span id="line-3573"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxMultidelegationNotSupported"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxMultidelegationNotSupported"><span class="hs-identifier hs-var">ErrConstructTxMultidelegationNotSupported</span></a></span></span><span>
</span><span id="line-3574"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxMultiaccountNotSupported"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxMultiaccountNotSupported"><span class="hs-identifier hs-var">ErrConstructTxMultiaccountNotSupported</span></a></span></span><span>
</span><span id="line-3575"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxWrongMintingBurningTemplate"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxWrongMintingBurningTemplate"><span class="hs-identifier hs-var">ErrConstructTxWrongMintingBurningTemplate</span></a></span></span><span>
</span><span id="line-3576"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxAssetNameTooLong"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxAssetNameTooLong"><span class="hs-identifier hs-var">ErrConstructTxAssetNameTooLong</span></a></span></span><span>
</span><span id="line-3577"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxMintOrBurnAssetQuantityOutOfBounds"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxMintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier hs-var">ErrConstructTxMintOrBurnAssetQuantityOutOfBounds</span></a></span></span><span>
</span><span id="line-3578"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxWrongValidityBounds"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxWrongValidityBounds"><span class="hs-identifier hs-var">ErrConstructTxWrongValidityBounds</span></a></span></span><span>
</span><span id="line-3579"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxValidityIntervalNotWithinScriptTimelock"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxValidityIntervalNotWithinScriptTimelock"><span class="hs-identifier hs-var">ErrConstructTxValidityIntervalNotWithinScriptTimelock</span></a></span></span><span>
</span><span id="line-3580"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxSharedWalletPending"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxSharedWalletPending"><span class="hs-identifier hs-var">ErrConstructTxSharedWalletPending</span></a></span></span><span>
</span><span id="line-3581"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrConstructTxNotImplemented"><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxNotImplemented"><span class="hs-identifier hs-var">ErrConstructTxNotImplemented</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-3582"></span><span>    </span><span class="hs-comment">-- ^ Temporary error constructor.</span><span>
</span><span id="line-3583"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461065"><span id="local-6989586621682461067"><span id="local-6989586621682461069"><span class="annot"><span class="annottext">Int -&gt; ErrConstructTx -&gt; ShowS
[ErrConstructTx] -&gt; ShowS
ErrConstructTx -&gt; String
(Int -&gt; ErrConstructTx -&gt; ShowS)
-&gt; (ErrConstructTx -&gt; String)
-&gt; ([ErrConstructTx] -&gt; ShowS)
-&gt; Show ErrConstructTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrConstructTx] -&gt; ShowS
$cshowList :: [ErrConstructTx] -&gt; ShowS
show :: ErrConstructTx -&gt; String
$cshow :: ErrConstructTx -&gt; String
showsPrec :: Int -&gt; ErrConstructTx -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrConstructTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461061"><span id="local-6989586621682461063"><span class="annot"><span class="annottext">ErrConstructTx -&gt; ErrConstructTx -&gt; Bool
(ErrConstructTx -&gt; ErrConstructTx -&gt; Bool)
-&gt; (ErrConstructTx -&gt; ErrConstructTx -&gt; Bool) -&gt; Eq ErrConstructTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrConstructTx -&gt; ErrConstructTx -&gt; Bool
$c/= :: ErrConstructTx -&gt; ErrConstructTx -&gt; Bool
== :: ErrConstructTx -&gt; ErrConstructTx -&gt; Bool
$c== :: ErrConstructTx -&gt; ErrConstructTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3584"></span><span>
</span><span id="line-3585"></span><span class="hs-comment">-- | Errors that can occur when getting policy id.</span><span>
</span><span id="line-3586"></span><span class="hs-keyword">data</span><span> </span><span id="ErrGetPolicyId"><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyId"><span class="hs-identifier hs-var">ErrGetPolicyId</span></a></span></span><span>
</span><span id="line-3587"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrGetPolicyIdReadPolicyPubliKey"><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyIdReadPolicyPubliKey"><span class="hs-identifier hs-var">ErrGetPolicyIdReadPolicyPubliKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKey"><span class="hs-identifier hs-type">ErrReadPolicyPublicKey</span></a></span><span>
</span><span id="line-3588"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrGetPolicyIdWrongMintingBurningTemplate"><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyIdWrongMintingBurningTemplate"><span class="hs-identifier hs-var">ErrGetPolicyIdWrongMintingBurningTemplate</span></a></span></span><span>
</span><span id="line-3589"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461053"><span id="local-6989586621682461055"><span id="local-6989586621682461057"><span class="annot"><span class="annottext">Int -&gt; ErrGetPolicyId -&gt; ShowS
[ErrGetPolicyId] -&gt; ShowS
ErrGetPolicyId -&gt; String
(Int -&gt; ErrGetPolicyId -&gt; ShowS)
-&gt; (ErrGetPolicyId -&gt; String)
-&gt; ([ErrGetPolicyId] -&gt; ShowS)
-&gt; Show ErrGetPolicyId
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrGetPolicyId] -&gt; ShowS
$cshowList :: [ErrGetPolicyId] -&gt; ShowS
show :: ErrGetPolicyId -&gt; String
$cshow :: ErrGetPolicyId -&gt; String
showsPrec :: Int -&gt; ErrGetPolicyId -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrGetPolicyId -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461049"><span id="local-6989586621682461051"><span class="annot"><span class="annottext">ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool
(ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool)
-&gt; (ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool) -&gt; Eq ErrGetPolicyId
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool
$c/= :: ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool
== :: ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool
$c== :: ErrGetPolicyId -&gt; ErrGetPolicyId -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3590"></span><span>
</span><span id="line-3591"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrMintBurnAssets"><span class="annot"><a href="Cardano.Wallet.html#ErrMintBurnAssets"><span class="hs-identifier hs-var">ErrMintBurnAssets</span></a></span></span><span>
</span><span id="line-3592"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrMintBurnNotImplemented"><span class="annot"><a href="Cardano.Wallet.html#ErrMintBurnNotImplemented"><span class="hs-identifier hs-var">ErrMintBurnNotImplemented</span></a></span></span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">T.Text</span></a></span><span>
</span><span id="line-3593"></span><span>      </span><span class="hs-comment">-- ^ Temporary error constructor.</span><span>
</span><span id="line-3594"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461042"><span id="local-6989586621682461044"><span id="local-6989586621682461046"><span class="annot"><span class="annottext">Int -&gt; ErrMintBurnAssets -&gt; ShowS
[ErrMintBurnAssets] -&gt; ShowS
ErrMintBurnAssets -&gt; String
(Int -&gt; ErrMintBurnAssets -&gt; ShowS)
-&gt; (ErrMintBurnAssets -&gt; String)
-&gt; ([ErrMintBurnAssets] -&gt; ShowS)
-&gt; Show ErrMintBurnAssets
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrMintBurnAssets] -&gt; ShowS
$cshowList :: [ErrMintBurnAssets] -&gt; ShowS
show :: ErrMintBurnAssets -&gt; String
$cshow :: ErrMintBurnAssets -&gt; String
showsPrec :: Int -&gt; ErrMintBurnAssets -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrMintBurnAssets -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461038"><span id="local-6989586621682461040"><span class="annot"><span class="annottext">ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool
(ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool)
-&gt; (ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool)
-&gt; Eq ErrMintBurnAssets
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool
$c/= :: ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool
== :: ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool
$c== :: ErrMintBurnAssets -&gt; ErrMintBurnAssets -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3595"></span><span>
</span><span id="line-3596"></span><span class="hs-comment">-- | Errors that can occur when signing a transaction.</span><span>
</span><span id="line-3597"></span><span class="hs-keyword">data</span><span> </span><span id="ErrWitnessTx"><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTx"><span class="hs-identifier hs-var">ErrWitnessTx</span></a></span></span><span>
</span><span id="line-3598"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrWitnessTxSignTx"><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxSignTx"><span class="hs-identifier hs-var">ErrWitnessTxSignTx</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrSignTx"><span class="hs-identifier hs-type">ErrSignTx</span></a></span><span>
</span><span id="line-3599"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrWitnessTxNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxNoSuchWallet"><span class="hs-identifier hs-var">ErrWitnessTxNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3600"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrWitnessTxWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxWithRootKey"><span class="hs-identifier hs-var">ErrWitnessTxWithRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3601"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrWitnessTxIncorrectTTL"><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxIncorrectTTL"><span class="hs-identifier hs-var">ErrWitnessTxIncorrectTTL</span></a></span></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span>
</span><span id="line-3602"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461028"><span id="local-6989586621682461030"><span id="local-6989586621682461032"><span class="annot"><span class="annottext">Int -&gt; ErrWitnessTx -&gt; ShowS
[ErrWitnessTx] -&gt; ShowS
ErrWitnessTx -&gt; String
(Int -&gt; ErrWitnessTx -&gt; ShowS)
-&gt; (ErrWitnessTx -&gt; String)
-&gt; ([ErrWitnessTx] -&gt; ShowS)
-&gt; Show ErrWitnessTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrWitnessTx] -&gt; ShowS
$cshowList :: [ErrWitnessTx] -&gt; ShowS
show :: ErrWitnessTx -&gt; String
$cshow :: ErrWitnessTx -&gt; String
showsPrec :: Int -&gt; ErrWitnessTx -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrWitnessTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461024"><span id="local-6989586621682461026"><span class="annot"><span class="annottext">ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool
(ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool)
-&gt; (ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool) -&gt; Eq ErrWitnessTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool
$c/= :: ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool
== :: ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool
$c== :: ErrWitnessTx -&gt; ErrWitnessTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3603"></span><span>
</span><span id="line-3604"></span><span class="hs-comment">-- | Errors that can occur when decoding a transaction.</span><span>
</span><span id="line-3605"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrDecodeTx"><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTx"><span class="hs-identifier hs-var">ErrDecodeTx</span></a></span></span><span>
</span><span id="line-3606"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrDecodeTxNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTxNoSuchWallet"><span class="hs-identifier hs-var">ErrDecodeTxNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3607"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461018"><span id="local-6989586621682461020"><span id="local-6989586621682461022"><span class="annot"><span class="annottext">Int -&gt; ErrDecodeTx -&gt; ShowS
[ErrDecodeTx] -&gt; ShowS
ErrDecodeTx -&gt; String
(Int -&gt; ErrDecodeTx -&gt; ShowS)
-&gt; (ErrDecodeTx -&gt; String)
-&gt; ([ErrDecodeTx] -&gt; ShowS)
-&gt; Show ErrDecodeTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrDecodeTx] -&gt; ShowS
$cshowList :: [ErrDecodeTx] -&gt; ShowS
show :: ErrDecodeTx -&gt; String
$cshow :: ErrDecodeTx -&gt; String
showsPrec :: Int -&gt; ErrDecodeTx -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrDecodeTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461014"><span id="local-6989586621682461016"><span class="annot"><span class="annottext">ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool
(ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool)
-&gt; (ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool) -&gt; Eq ErrDecodeTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool
$c/= :: ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool
== :: ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool
$c== :: ErrDecodeTx -&gt; ErrDecodeTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3608"></span><span>
</span><span id="line-3609"></span><span class="hs-comment">-- | Errors that can occur when submitting a signed transaction to the network.</span><span>
</span><span id="line-3610"></span><span class="hs-keyword">data</span><span> </span><span id="ErrSubmitTx"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTx"><span class="hs-identifier hs-var">ErrSubmitTx</span></a></span></span><span>
</span><span id="line-3611"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrSubmitTxNetwork"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTxNetwork"><span class="hs-identifier hs-var">ErrSubmitTxNetwork</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier hs-type">ErrPostTx</span></a></span><span>
</span><span id="line-3612"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSubmitTxNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTxNoSuchWallet"><span class="hs-identifier hs-var">ErrSubmitTxNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3613"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSubmitTxImpossible"><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTxImpossible"><span class="hs-identifier hs-var">ErrSubmitTxImpossible</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span>
</span><span id="line-3614"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682461008"><span id="local-6989586621682461010"><span id="local-6989586621682461012"><span class="annot"><span class="annottext">Int -&gt; ErrSubmitTx -&gt; ShowS
[ErrSubmitTx] -&gt; ShowS
ErrSubmitTx -&gt; String
(Int -&gt; ErrSubmitTx -&gt; ShowS)
-&gt; (ErrSubmitTx -&gt; String)
-&gt; ([ErrSubmitTx] -&gt; ShowS)
-&gt; Show ErrSubmitTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrSubmitTx] -&gt; ShowS
$cshowList :: [ErrSubmitTx] -&gt; ShowS
show :: ErrSubmitTx -&gt; String
$cshow :: ErrSubmitTx -&gt; String
showsPrec :: Int -&gt; ErrSubmitTx -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrSubmitTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682461004"><span id="local-6989586621682461006"><span class="annot"><span class="annottext">ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool
(ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool)
-&gt; (ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool) -&gt; Eq ErrSubmitTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool
$c/= :: ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool
== :: ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool
$c== :: ErrSubmitTx -&gt; ErrSubmitTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3615"></span><span>
</span><span id="line-3616"></span><span class="hs-comment">-- | Errors that can occur when trying to change a wallet's passphrase.</span><span>
</span><span id="line-3617"></span><span class="hs-keyword">data</span><span> </span><span id="ErrUpdatePassphrase"><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphrase"><span class="hs-identifier hs-var">ErrUpdatePassphrase</span></a></span></span><span>
</span><span id="line-3618"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrUpdatePassphraseNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphraseNoSuchWallet"><span class="hs-identifier hs-var">ErrUpdatePassphraseNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3619"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrUpdatePassphraseWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphraseWithRootKey"><span class="hs-identifier hs-var">ErrUpdatePassphraseWithRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3620"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460998"><span id="local-6989586621682461000"><span id="local-6989586621682461002"><span class="annot"><span class="annottext">Int -&gt; ErrUpdatePassphrase -&gt; ShowS
[ErrUpdatePassphrase] -&gt; ShowS
ErrUpdatePassphrase -&gt; String
(Int -&gt; ErrUpdatePassphrase -&gt; ShowS)
-&gt; (ErrUpdatePassphrase -&gt; String)
-&gt; ([ErrUpdatePassphrase] -&gt; ShowS)
-&gt; Show ErrUpdatePassphrase
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrUpdatePassphrase] -&gt; ShowS
$cshowList :: [ErrUpdatePassphrase] -&gt; ShowS
show :: ErrUpdatePassphrase -&gt; String
$cshow :: ErrUpdatePassphrase -&gt; String
showsPrec :: Int -&gt; ErrUpdatePassphrase -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrUpdatePassphrase -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460994"><span id="local-6989586621682460996"><span class="annot"><span class="annottext">ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool
(ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool)
-&gt; (ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool)
-&gt; Eq ErrUpdatePassphrase
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool
$c/= :: ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool
== :: ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool
$c== :: ErrUpdatePassphrase -&gt; ErrUpdatePassphrase -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3621"></span><span>
</span><span id="line-3622"></span><span class="hs-comment">-- | Errors that can occur when trying to perform an operation on a wallet that</span><span>
</span><span id="line-3623"></span><span class="hs-comment">-- requires a private key, but where none is attached to the wallet.</span><span>
</span><span id="line-3624"></span><span class="hs-keyword">data</span><span> </span><span id="ErrWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-var">ErrWithRootKey</span></a></span></span><span>
</span><span id="line-3625"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrWithRootKeyNoRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyNoRootKey"><span class="hs-identifier hs-var">ErrWithRootKeyNoRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3626"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrWithRootKeyWrongPassphrase"><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongPassphrase"><span class="hs-identifier hs-var">ErrWithRootKeyWrongPassphrase</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#ErrWrongPassphrase"><span class="hs-identifier hs-type">ErrWrongPassphrase</span></a></span><span>
</span><span id="line-3627"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrWithRootKeyWrongMnemonic"><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongMnemonic"><span class="hs-identifier hs-var">ErrWithRootKeyWrongMnemonic</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3628"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460987"><span id="local-6989586621682460989"><span id="local-6989586621682460991"><span class="annot"><span class="annottext">Int -&gt; ErrWithRootKey -&gt; ShowS
[ErrWithRootKey] -&gt; ShowS
ErrWithRootKey -&gt; String
(Int -&gt; ErrWithRootKey -&gt; ShowS)
-&gt; (ErrWithRootKey -&gt; String)
-&gt; ([ErrWithRootKey] -&gt; ShowS)
-&gt; Show ErrWithRootKey
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrWithRootKey] -&gt; ShowS
$cshowList :: [ErrWithRootKey] -&gt; ShowS
show :: ErrWithRootKey -&gt; String
$cshow :: ErrWithRootKey -&gt; String
showsPrec :: Int -&gt; ErrWithRootKey -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrWithRootKey -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460983"><span id="local-6989586621682460985"><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool
(ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool)
-&gt; (ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool) -&gt; Eq ErrWithRootKey
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool
$c/= :: ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool
== :: ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool
$c== :: ErrWithRootKey -&gt; ErrWithRootKey -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3629"></span><span>
</span><span id="line-3630"></span><span class="hs-comment">-- | Errors that can occur when trying to list transactions.</span><span>
</span><span id="line-3631"></span><span class="hs-keyword">data</span><span> </span><span id="ErrListTransactions"><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactions"><span class="hs-identifier hs-var">ErrListTransactions</span></a></span></span><span>
</span><span id="line-3632"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrListTransactionsNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsNoSuchWallet"><span class="hs-identifier hs-var">ErrListTransactionsNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3633"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrListTransactionsStartTimeLaterThanEndTime"><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsStartTimeLaterThanEndTime"><span class="hs-identifier hs-var">ErrListTransactionsStartTimeLaterThanEndTime</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-type">ErrStartTimeLaterThanEndTime</span></a></span><span>
</span><span id="line-3634"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrListTransactionsMinWithdrawalWrong"><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsMinWithdrawalWrong"><span class="hs-identifier hs-var">ErrListTransactionsMinWithdrawalWrong</span></a></span></span><span>
</span><span id="line-3635"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrListTransactionsPastHorizonException"><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsPastHorizonException"><span class="hs-identifier hs-var">ErrListTransactionsPastHorizonException</span></a></span></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span>
</span><span id="line-3636"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460976"><span id="local-6989586621682460978"><span id="local-6989586621682460980"><span class="annot"><span class="annottext">Int -&gt; ErrListTransactions -&gt; ShowS
[ErrListTransactions] -&gt; ShowS
ErrListTransactions -&gt; String
(Int -&gt; ErrListTransactions -&gt; ShowS)
-&gt; (ErrListTransactions -&gt; String)
-&gt; ([ErrListTransactions] -&gt; ShowS)
-&gt; Show ErrListTransactions
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrListTransactions] -&gt; ShowS
$cshowList :: [ErrListTransactions] -&gt; ShowS
show :: ErrListTransactions -&gt; String
$cshow :: ErrListTransactions -&gt; String
showsPrec :: Int -&gt; ErrListTransactions -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrListTransactions -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3637"></span><span>
</span><span id="line-3638"></span><span class="hs-comment">-- | Errors that can occur when trying to get transaction.</span><span>
</span><span id="line-3639"></span><span class="hs-keyword">data</span><span> </span><span id="ErrGetTransaction"><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransaction"><span class="hs-identifier hs-var">ErrGetTransaction</span></a></span></span><span>
</span><span id="line-3640"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrGetTransactionNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransactionNoSuchWallet"><span class="hs-identifier hs-var">ErrGetTransactionNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3641"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrGetTransactionNoSuchTransaction"><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransactionNoSuchTransaction"><span class="hs-identifier hs-var">ErrGetTransactionNoSuchTransaction</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span>
</span><span id="line-3642"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460970"><span id="local-6989586621682460972"><span id="local-6989586621682460974"><span class="annot"><span class="annottext">Int -&gt; ErrGetTransaction -&gt; ShowS
[ErrGetTransaction] -&gt; ShowS
ErrGetTransaction -&gt; String
(Int -&gt; ErrGetTransaction -&gt; ShowS)
-&gt; (ErrGetTransaction -&gt; String)
-&gt; ([ErrGetTransaction] -&gt; ShowS)
-&gt; Show ErrGetTransaction
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrGetTransaction] -&gt; ShowS
$cshowList :: [ErrGetTransaction] -&gt; ShowS
show :: ErrGetTransaction -&gt; String
$cshow :: ErrGetTransaction -&gt; String
showsPrec :: Int -&gt; ErrGetTransaction -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrGetTransaction -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460966"><span id="local-6989586621682460968"><span class="annot"><span class="annottext">ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool
(ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool)
-&gt; (ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool)
-&gt; Eq ErrGetTransaction
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool
$c/= :: ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool
== :: ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool
$c== :: ErrGetTransaction -&gt; ErrGetTransaction -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3643"></span><span>
</span><span id="line-3644"></span><span class="hs-comment">-- | Indicates that the specified start time is later than the specified end</span><span>
</span><span id="line-3645"></span><span class="hs-comment">-- time.</span><span>
</span><span id="line-3646"></span><span class="hs-keyword">data</span><span> </span><span id="ErrStartTimeLaterThanEndTime"><span class="annot"><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var">ErrStartTimeLaterThanEndTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ErrStartTimeLaterThanEndTime"><span class="annot"><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var">ErrStartTimeLaterThanEndTime</span></a></span></span><span>
</span><span id="line-3647"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AerrStartTime%3AErrStartTimeLaterThanEndTime"><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime -&gt; UTCTime
</span><a href="Cardano.Wallet.html#%24sel%3AerrStartTime%3AErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var hs-var">errStartTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-3648"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AerrEndTime%3AErrStartTimeLaterThanEndTime"><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime -&gt; UTCTime
</span><a href="Cardano.Wallet.html#%24sel%3AerrEndTime%3AErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var hs-var">errEndTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-3649"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460958"><span id="local-6989586621682460960"><span id="local-6989586621682460962"><span class="annot"><span class="annottext">Int -&gt; ErrStartTimeLaterThanEndTime -&gt; ShowS
[ErrStartTimeLaterThanEndTime] -&gt; ShowS
ErrStartTimeLaterThanEndTime -&gt; String
(Int -&gt; ErrStartTimeLaterThanEndTime -&gt; ShowS)
-&gt; (ErrStartTimeLaterThanEndTime -&gt; String)
-&gt; ([ErrStartTimeLaterThanEndTime] -&gt; ShowS)
-&gt; Show ErrStartTimeLaterThanEndTime
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrStartTimeLaterThanEndTime] -&gt; ShowS
$cshowList :: [ErrStartTimeLaterThanEndTime] -&gt; ShowS
show :: ErrStartTimeLaterThanEndTime -&gt; String
$cshow :: ErrStartTimeLaterThanEndTime -&gt; String
showsPrec :: Int -&gt; ErrStartTimeLaterThanEndTime -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrStartTimeLaterThanEndTime -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460954"><span id="local-6989586621682460956"><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
-&gt; ErrStartTimeLaterThanEndTime -&gt; Bool
(ErrStartTimeLaterThanEndTime
 -&gt; ErrStartTimeLaterThanEndTime -&gt; Bool)
-&gt; (ErrStartTimeLaterThanEndTime
    -&gt; ErrStartTimeLaterThanEndTime -&gt; Bool)
-&gt; Eq ErrStartTimeLaterThanEndTime
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrStartTimeLaterThanEndTime
-&gt; ErrStartTimeLaterThanEndTime -&gt; Bool
$c/= :: ErrStartTimeLaterThanEndTime
-&gt; ErrStartTimeLaterThanEndTime -&gt; Bool
== :: ErrStartTimeLaterThanEndTime
-&gt; ErrStartTimeLaterThanEndTime -&gt; Bool
$c== :: ErrStartTimeLaterThanEndTime
-&gt; ErrStartTimeLaterThanEndTime -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3650"></span><span>
</span><span id="line-3651"></span><span id="local-6989586621682460952"><span id="local-6989586621682460953"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrCreateMigrationPlan"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlan"><span class="hs-identifier hs-var">ErrCreateMigrationPlan</span></a></span></span><span>
</span><span id="line-3652"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrCreateMigrationPlanEmpty"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlanEmpty"><span class="hs-identifier hs-var">ErrCreateMigrationPlanEmpty</span></a></span></span><span>
</span><span id="line-3653"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCreateMigrationPlanNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlanNoSuchWallet"><span class="hs-identifier hs-var">ErrCreateMigrationPlanNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3654"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrCreateMigrationPlan -&gt; Rep ErrCreateMigrationPlan x)
-&gt; (forall x.
    Rep ErrCreateMigrationPlan x -&gt; ErrCreateMigrationPlan)
-&gt; Generic ErrCreateMigrationPlan
forall x. Rep ErrCreateMigrationPlan x -&gt; ErrCreateMigrationPlan
forall x. ErrCreateMigrationPlan -&gt; Rep ErrCreateMigrationPlan x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrCreateMigrationPlan x -&gt; ErrCreateMigrationPlan
$cfrom :: forall x. ErrCreateMigrationPlan -&gt; Rep ErrCreateMigrationPlan x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460945"><span id="local-6989586621682460947"><span class="annot"><span class="annottext">ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool
(ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool)
-&gt; (ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool)
-&gt; Eq ErrCreateMigrationPlan
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool
$c/= :: ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool
== :: ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool
$c== :: ErrCreateMigrationPlan -&gt; ErrCreateMigrationPlan -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460939"><span id="local-6989586621682460941"><span id="local-6989586621682460943"><span class="annot"><span class="annottext">Int -&gt; ErrCreateMigrationPlan -&gt; ShowS
[ErrCreateMigrationPlan] -&gt; ShowS
ErrCreateMigrationPlan -&gt; String
(Int -&gt; ErrCreateMigrationPlan -&gt; ShowS)
-&gt; (ErrCreateMigrationPlan -&gt; String)
-&gt; ([ErrCreateMigrationPlan] -&gt; ShowS)
-&gt; Show ErrCreateMigrationPlan
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrCreateMigrationPlan] -&gt; ShowS
$cshowList :: [ErrCreateMigrationPlan] -&gt; ShowS
show :: ErrCreateMigrationPlan -&gt; String
$cshow :: ErrCreateMigrationPlan -&gt; String
showsPrec :: Int -&gt; ErrCreateMigrationPlan -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrCreateMigrationPlan -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3655"></span><span>
</span><span id="line-3656"></span><span id="local-6989586621682460937"><span id="local-6989586621682460938"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrSelectAssets"><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-var">ErrSelectAssets</span></a></span></span><span>
</span><span id="line-3657"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrSelectAssetsPrepareOutputsError"><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsPrepareOutputsError"><span class="hs-identifier hs-var">ErrSelectAssetsPrepareOutputsError</span></a></span></span><span>
</span><span id="line-3658"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputError"><span class="hs-identifier hs-type">SelectionOutputError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3659"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSelectAssetsNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsNoSuchWallet"><span class="hs-identifier hs-var">ErrSelectAssetsNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3660"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSelectAssetsAlreadyWithdrawing"><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsAlreadyWithdrawing"><span class="hs-identifier hs-var">ErrSelectAssetsAlreadyWithdrawing</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span>
</span><span id="line-3661"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrSelectAssetsSelectionError"><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-var">ErrSelectAssetsSelectionError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionError"><span class="hs-identifier hs-type">SelectionError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3662"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrSelectAssets -&gt; Rep ErrSelectAssets x)
-&gt; (forall x. Rep ErrSelectAssets x -&gt; ErrSelectAssets)
-&gt; Generic ErrSelectAssets
forall x. Rep ErrSelectAssets x -&gt; ErrSelectAssets
forall x. ErrSelectAssets -&gt; Rep ErrSelectAssets x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrSelectAssets x -&gt; ErrSelectAssets
$cfrom :: forall x. ErrSelectAssets -&gt; Rep ErrSelectAssets x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460930"><span id="local-6989586621682460932"><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool
(ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool)
-&gt; (ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool)
-&gt; Eq ErrSelectAssets
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool
$c/= :: ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool
== :: ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool
$c== :: ErrSelectAssets -&gt; ErrSelectAssets -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460924"><span id="local-6989586621682460926"><span id="local-6989586621682460928"><span class="annot"><span class="annottext">Int -&gt; ErrSelectAssets -&gt; ShowS
[ErrSelectAssets] -&gt; ShowS
ErrSelectAssets -&gt; String
(Int -&gt; ErrSelectAssets -&gt; ShowS)
-&gt; (ErrSelectAssets -&gt; String)
-&gt; ([ErrSelectAssets] -&gt; ShowS)
-&gt; Show ErrSelectAssets
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrSelectAssets] -&gt; ShowS
$cshowList :: [ErrSelectAssets] -&gt; ShowS
show :: ErrSelectAssets -&gt; String
$cshow :: ErrSelectAssets -&gt; String
showsPrec :: Int -&gt; ErrSelectAssets -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrSelectAssets -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3663"></span><span>
</span><span id="line-3664"></span><span class="hs-keyword">data</span><span> </span><span id="ErrStakePoolDelegation"><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegation"><span class="hs-identifier hs-var">ErrStakePoolDelegation</span></a></span></span><span>
</span><span id="line-3665"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrStakePoolDelegationNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegationNoSuchWallet"><span class="hs-identifier hs-var">ErrStakePoolDelegationNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3666"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrStakePoolJoin"><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolJoin"><span class="hs-identifier hs-var">ErrStakePoolJoin</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotJoin"><span class="hs-identifier hs-type">ErrCannotJoin</span></a></span><span>
</span><span id="line-3667"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrStakePoolQuit"><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolQuit"><span class="hs-identifier hs-var">ErrStakePoolQuit</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotQuit"><span class="hs-identifier hs-type">ErrCannotQuit</span></a></span><span>
</span><span id="line-3668"></span><span>
</span><span id="line-3669"></span><span class="hs-comment">-- | Errors that can occur when fetching the reward balance of a wallet</span><span>
</span><span id="line-3670"></span><span id="local-6989586621682460922"><span id="local-6989586621682460923"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrFetchRewards"><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewards"><span class="hs-identifier hs-var">ErrFetchRewards</span></a></span></span><span>
</span><span id="line-3671"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrFetchRewardsReadRewardAccount"><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewardsReadRewardAccount"><span class="hs-identifier hs-var">ErrFetchRewardsReadRewardAccount</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier hs-type">ErrReadRewardAccount</span></a></span><span>
</span><span id="line-3672"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrFetchRewards -&gt; Rep ErrFetchRewards x)
-&gt; (forall x. Rep ErrFetchRewards x -&gt; ErrFetchRewards)
-&gt; Generic ErrFetchRewards
forall x. Rep ErrFetchRewards x -&gt; ErrFetchRewards
forall x. ErrFetchRewards -&gt; Rep ErrFetchRewards x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrFetchRewards x -&gt; ErrFetchRewards
$cfrom :: forall x. ErrFetchRewards -&gt; Rep ErrFetchRewards x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460916"><span id="local-6989586621682460918"><span class="annot"><span class="annottext">ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool
(ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool)
-&gt; (ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool)
-&gt; Eq ErrFetchRewards
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool
$c/= :: ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool
== :: ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool
$c== :: ErrFetchRewards -&gt; ErrFetchRewards -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460910"><span id="local-6989586621682460912"><span id="local-6989586621682460914"><span class="annot"><span class="annottext">Int -&gt; ErrFetchRewards -&gt; ShowS
[ErrFetchRewards] -&gt; ShowS
ErrFetchRewards -&gt; String
(Int -&gt; ErrFetchRewards -&gt; ShowS)
-&gt; (ErrFetchRewards -&gt; String)
-&gt; ([ErrFetchRewards] -&gt; ShowS)
-&gt; Show ErrFetchRewards
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrFetchRewards] -&gt; ShowS
$cshowList :: [ErrFetchRewards] -&gt; ShowS
show :: ErrFetchRewards -&gt; String
$cshow :: ErrFetchRewards -&gt; String
showsPrec :: Int -&gt; ErrFetchRewards -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrFetchRewards -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3673"></span><span>
</span><span id="line-3674"></span><span class="hs-keyword">data</span><span> </span><span id="ErrCheckWalletIntegrity"><span class="annot"><a href="Cardano.Wallet.html#ErrCheckWalletIntegrity"><span class="hs-identifier hs-var">ErrCheckWalletIntegrity</span></a></span></span><span>
</span><span id="line-3675"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrCheckWalletIntegrityNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrCheckWalletIntegrityNoSuchWallet"><span class="hs-identifier hs-var">ErrCheckWalletIntegrityNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3676"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCheckIntegrityDifferentGenesis"><span class="annot"><a href="Cardano.Wallet.html#ErrCheckIntegrityDifferentGenesis"><span class="hs-identifier hs-var">ErrCheckIntegrityDifferentGenesis</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Genesis&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Genesis&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3677"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460906"><span id="local-6989586621682460908"><span class="annot"><span class="annottext">ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool
(ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool)
-&gt; (ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool)
-&gt; Eq ErrCheckWalletIntegrity
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool
$c/= :: ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool
== :: ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool
$c== :: ErrCheckWalletIntegrity -&gt; ErrCheckWalletIntegrity -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460900"><span id="local-6989586621682460902"><span id="local-6989586621682460904"><span class="annot"><span class="annottext">Int -&gt; ErrCheckWalletIntegrity -&gt; ShowS
[ErrCheckWalletIntegrity] -&gt; ShowS
ErrCheckWalletIntegrity -&gt; String
(Int -&gt; ErrCheckWalletIntegrity -&gt; ShowS)
-&gt; (ErrCheckWalletIntegrity -&gt; String)
-&gt; ([ErrCheckWalletIntegrity] -&gt; ShowS)
-&gt; Show ErrCheckWalletIntegrity
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrCheckWalletIntegrity] -&gt; ShowS
$cshowList :: [ErrCheckWalletIntegrity] -&gt; ShowS
show :: ErrCheckWalletIntegrity -&gt; String
$cshow :: ErrCheckWalletIntegrity -&gt; String
showsPrec :: Int -&gt; ErrCheckWalletIntegrity -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrCheckWalletIntegrity -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3678"></span><span>
</span><span id="line-3679"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460892"><span id="local-6989586621682460894"><span id="local-6989586621682460896"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCheckWalletIntegrity"><span class="hs-identifier hs-type">ErrCheckWalletIntegrity</span></a></span></span></span></span><span>
</span><span id="line-3680"></span><span>
</span><span id="line-3681"></span><span class="hs-comment">-- | Can't perform given operation because the wallet died.</span><span>
</span><span id="line-3682"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrWalletNotResponding"><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-var">ErrWalletNotResponding</span></a></span></span><span>
</span><span id="line-3683"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrWalletNotResponding"><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-var">ErrWalletNotResponding</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3684"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460887"><span id="local-6989586621682460889"><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool
(ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool)
-&gt; (ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool)
-&gt; Eq ErrWalletNotResponding
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool
$c/= :: ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool
== :: ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool
$c== :: ErrWalletNotResponding -&gt; ErrWalletNotResponding -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460881"><span id="local-6989586621682460883"><span id="local-6989586621682460885"><span class="annot"><span class="annottext">Int -&gt; ErrWalletNotResponding -&gt; ShowS
[ErrWalletNotResponding] -&gt; ShowS
ErrWalletNotResponding -&gt; String
(Int -&gt; ErrWalletNotResponding -&gt; ShowS)
-&gt; (ErrWalletNotResponding -&gt; String)
-&gt; ([ErrWalletNotResponding] -&gt; ShowS)
-&gt; Show ErrWalletNotResponding
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrWalletNotResponding] -&gt; ShowS
$cshowList :: [ErrWalletNotResponding] -&gt; ShowS
show :: ErrWalletNotResponding -&gt; String
$cshow :: ErrWalletNotResponding -&gt; String
showsPrec :: Int -&gt; ErrWalletNotResponding -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrWalletNotResponding -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3685"></span><span>
</span><span id="line-3686"></span><span id="local-6989586621682460879"><span id="local-6989586621682460880"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrCreateRandomAddress"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateRandomAddress"><span class="hs-identifier hs-var">ErrCreateRandomAddress</span></a></span></span><span>
</span><span id="line-3687"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrIndexAlreadyExists"><span class="annot"><a href="Cardano.Wallet.html#ErrIndexAlreadyExists"><span class="hs-identifier hs-var">ErrIndexAlreadyExists</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3688"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCreateAddrNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateAddrNoSuchWallet"><span class="hs-identifier hs-var">ErrCreateAddrNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3689"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCreateAddrWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateAddrWithRootKey"><span class="hs-identifier hs-var">ErrCreateAddrWithRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3690"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCreateAddressNotAByronWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrCreateAddressNotAByronWallet"><span class="hs-identifier hs-var">ErrCreateAddressNotAByronWallet</span></a></span></span><span>
</span><span id="line-3691"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrCreateRandomAddress -&gt; Rep ErrCreateRandomAddress x)
-&gt; (forall x.
    Rep ErrCreateRandomAddress x -&gt; ErrCreateRandomAddress)
-&gt; Generic ErrCreateRandomAddress
forall x. Rep ErrCreateRandomAddress x -&gt; ErrCreateRandomAddress
forall x. ErrCreateRandomAddress -&gt; Rep ErrCreateRandomAddress x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrCreateRandomAddress x -&gt; ErrCreateRandomAddress
$cfrom :: forall x. ErrCreateRandomAddress -&gt; Rep ErrCreateRandomAddress x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460872"><span id="local-6989586621682460874"><span class="annot"><span class="annottext">ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool
(ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool)
-&gt; (ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool)
-&gt; Eq ErrCreateRandomAddress
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool
$c/= :: ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool
== :: ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool
$c== :: ErrCreateRandomAddress -&gt; ErrCreateRandomAddress -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460866"><span id="local-6989586621682460868"><span id="local-6989586621682460870"><span class="annot"><span class="annottext">Int -&gt; ErrCreateRandomAddress -&gt; ShowS
[ErrCreateRandomAddress] -&gt; ShowS
ErrCreateRandomAddress -&gt; String
(Int -&gt; ErrCreateRandomAddress -&gt; ShowS)
-&gt; (ErrCreateRandomAddress -&gt; String)
-&gt; ([ErrCreateRandomAddress] -&gt; ShowS)
-&gt; Show ErrCreateRandomAddress
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrCreateRandomAddress] -&gt; ShowS
$cshowList :: [ErrCreateRandomAddress] -&gt; ShowS
show :: ErrCreateRandomAddress -&gt; String
$cshow :: ErrCreateRandomAddress -&gt; String
showsPrec :: Int -&gt; ErrCreateRandomAddress -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrCreateRandomAddress -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3692"></span><span>
</span><span id="line-3693"></span><span id="local-6989586621682460864"><span id="local-6989586621682460865"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrImportRandomAddress"><span class="annot"><a href="Cardano.Wallet.html#ErrImportRandomAddress"><span class="hs-identifier hs-var">ErrImportRandomAddress</span></a></span></span><span>
</span><span id="line-3694"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrImportAddrNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrImportAddrNoSuchWallet"><span class="hs-identifier hs-var">ErrImportAddrNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3695"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrImportAddr"><span class="annot"><a href="Cardano.Wallet.html#ErrImportAddr"><span class="hs-identifier hs-var">ErrImportAddr</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#ErrImportAddress"><span class="hs-identifier hs-type">ErrImportAddress</span></a></span><span>
</span><span id="line-3696"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrImportAddressNotAByronWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrImportAddressNotAByronWallet"><span class="hs-identifier hs-var">ErrImportAddressNotAByronWallet</span></a></span></span><span>
</span><span id="line-3697"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrImportRandomAddress -&gt; Rep ErrImportRandomAddress x)
-&gt; (forall x.
    Rep ErrImportRandomAddress x -&gt; ErrImportRandomAddress)
-&gt; Generic ErrImportRandomAddress
forall x. Rep ErrImportRandomAddress x -&gt; ErrImportRandomAddress
forall x. ErrImportRandomAddress -&gt; Rep ErrImportRandomAddress x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrImportRandomAddress x -&gt; ErrImportRandomAddress
$cfrom :: forall x. ErrImportRandomAddress -&gt; Rep ErrImportRandomAddress x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460857"><span id="local-6989586621682460859"><span class="annot"><span class="annottext">ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool
(ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool)
-&gt; (ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool)
-&gt; Eq ErrImportRandomAddress
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool
$c/= :: ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool
== :: ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool
$c== :: ErrImportRandomAddress -&gt; ErrImportRandomAddress -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460851"><span id="local-6989586621682460853"><span id="local-6989586621682460855"><span class="annot"><span class="annottext">Int -&gt; ErrImportRandomAddress -&gt; ShowS
[ErrImportRandomAddress] -&gt; ShowS
ErrImportRandomAddress -&gt; String
(Int -&gt; ErrImportRandomAddress -&gt; ShowS)
-&gt; (ErrImportRandomAddress -&gt; String)
-&gt; ([ErrImportRandomAddress] -&gt; ShowS)
-&gt; Show ErrImportRandomAddress
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrImportRandomAddress] -&gt; ShowS
$cshowList :: [ErrImportRandomAddress] -&gt; ShowS
show :: ErrImportRandomAddress -&gt; String
$cshow :: ErrImportRandomAddress -&gt; String
showsPrec :: Int -&gt; ErrImportRandomAddress -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrImportRandomAddress -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3698"></span><span>
</span><span id="line-3699"></span><span id="local-6989586621682460849"><span id="local-6989586621682460850"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrNotASequentialWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrNotASequentialWallet"><span class="hs-identifier hs-var">ErrNotASequentialWallet</span></a></span></span><span>
</span><span id="line-3700"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrNotASequentialWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrNotASequentialWallet"><span class="hs-identifier hs-var">ErrNotASequentialWallet</span></a></span></span><span>
</span><span id="line-3701"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 ErrNotASequentialWallet -&gt; Rep ErrNotASequentialWallet x)
-&gt; (forall x.
    Rep ErrNotASequentialWallet x -&gt; ErrNotASequentialWallet)
-&gt; Generic ErrNotASequentialWallet
forall x. Rep ErrNotASequentialWallet x -&gt; ErrNotASequentialWallet
forall x. ErrNotASequentialWallet -&gt; Rep ErrNotASequentialWallet x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrNotASequentialWallet x -&gt; ErrNotASequentialWallet
$cfrom :: forall x. ErrNotASequentialWallet -&gt; Rep ErrNotASequentialWallet x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460842"><span id="local-6989586621682460844"><span class="annot"><span class="annottext">ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool
(ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool)
-&gt; (ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool)
-&gt; Eq ErrNotASequentialWallet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool
$c/= :: ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool
== :: ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool
$c== :: ErrNotASequentialWallet -&gt; ErrNotASequentialWallet -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460836"><span id="local-6989586621682460838"><span id="local-6989586621682460840"><span class="annot"><span class="annottext">Int -&gt; ErrNotASequentialWallet -&gt; ShowS
[ErrNotASequentialWallet] -&gt; ShowS
ErrNotASequentialWallet -&gt; String
(Int -&gt; ErrNotASequentialWallet -&gt; ShowS)
-&gt; (ErrNotASequentialWallet -&gt; String)
-&gt; ([ErrNotASequentialWallet] -&gt; ShowS)
-&gt; Show ErrNotASequentialWallet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrNotASequentialWallet] -&gt; ShowS
$cshowList :: [ErrNotASequentialWallet] -&gt; ShowS
show :: ErrNotASequentialWallet -&gt; String
$cshow :: ErrNotASequentialWallet -&gt; String
showsPrec :: Int -&gt; ErrNotASequentialWallet -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrNotASequentialWallet -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3702"></span><span>
</span><span id="line-3703"></span><span id="local-6989586621682460834"><span id="local-6989586621682460835"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrReadRewardAccount"><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier hs-var">ErrReadRewardAccount</span></a></span></span><span>
</span><span id="line-3704"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrReadRewardAccountNotAShelleyWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccountNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadRewardAccountNotAShelleyWallet</span></a></span></span><span>
</span><span id="line-3705"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrReadRewardAccountNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccountNoSuchWallet"><span class="hs-identifier hs-var">ErrReadRewardAccountNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3706"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrReadRewardAccount -&gt; Rep ErrReadRewardAccount x)
-&gt; (forall x. Rep ErrReadRewardAccount x -&gt; ErrReadRewardAccount)
-&gt; Generic ErrReadRewardAccount
forall x. Rep ErrReadRewardAccount x -&gt; ErrReadRewardAccount
forall x. ErrReadRewardAccount -&gt; Rep ErrReadRewardAccount x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrReadRewardAccount x -&gt; ErrReadRewardAccount
$cfrom :: forall x. ErrReadRewardAccount -&gt; Rep ErrReadRewardAccount x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460828"><span id="local-6989586621682460830"><span class="annot"><span class="annottext">ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool
(ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool)
-&gt; (ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool)
-&gt; Eq ErrReadRewardAccount
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool
$c/= :: ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool
== :: ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool
$c== :: ErrReadRewardAccount -&gt; ErrReadRewardAccount -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460822"><span id="local-6989586621682460824"><span id="local-6989586621682460826"><span class="annot"><span class="annottext">Int -&gt; ErrReadRewardAccount -&gt; ShowS
[ErrReadRewardAccount] -&gt; ShowS
ErrReadRewardAccount -&gt; String
(Int -&gt; ErrReadRewardAccount -&gt; ShowS)
-&gt; (ErrReadRewardAccount -&gt; String)
-&gt; ([ErrReadRewardAccount] -&gt; ShowS)
-&gt; Show ErrReadRewardAccount
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrReadRewardAccount] -&gt; ShowS
$cshowList :: [ErrReadRewardAccount] -&gt; ShowS
show :: ErrReadRewardAccount -&gt; String
$cshow :: ErrReadRewardAccount -&gt; String
showsPrec :: Int -&gt; ErrReadRewardAccount -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrReadRewardAccount -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3707"></span><span>
</span><span id="line-3708"></span><span id="local-6989586621682460820"><span id="local-6989586621682460821"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrWithdrawalNotWorth"><span class="annot"><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier hs-var">ErrWithdrawalNotWorth</span></a></span></span><span>
</span><span id="line-3709"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrWithdrawalNotWorth"><span class="annot"><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier hs-var">ErrWithdrawalNotWorth</span></a></span></span><span>
</span><span id="line-3710"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrWithdrawalNotWorth -&gt; Rep ErrWithdrawalNotWorth x)
-&gt; (forall x. Rep ErrWithdrawalNotWorth x -&gt; ErrWithdrawalNotWorth)
-&gt; Generic ErrWithdrawalNotWorth
forall x. Rep ErrWithdrawalNotWorth x -&gt; ErrWithdrawalNotWorth
forall x. ErrWithdrawalNotWorth -&gt; Rep ErrWithdrawalNotWorth x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrWithdrawalNotWorth x -&gt; ErrWithdrawalNotWorth
$cfrom :: forall x. ErrWithdrawalNotWorth -&gt; Rep ErrWithdrawalNotWorth x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460813"><span id="local-6989586621682460815"><span class="annot"><span class="annottext">ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool
(ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool)
-&gt; (ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool)
-&gt; Eq ErrWithdrawalNotWorth
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool
$c/= :: ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool
== :: ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool
$c== :: ErrWithdrawalNotWorth -&gt; ErrWithdrawalNotWorth -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460807"><span id="local-6989586621682460809"><span id="local-6989586621682460811"><span class="annot"><span class="annottext">Int -&gt; ErrWithdrawalNotWorth -&gt; ShowS
[ErrWithdrawalNotWorth] -&gt; ShowS
ErrWithdrawalNotWorth -&gt; String
(Int -&gt; ErrWithdrawalNotWorth -&gt; ShowS)
-&gt; (ErrWithdrawalNotWorth -&gt; String)
-&gt; ([ErrWithdrawalNotWorth] -&gt; ShowS)
-&gt; Show ErrWithdrawalNotWorth
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrWithdrawalNotWorth] -&gt; ShowS
$cshowList :: [ErrWithdrawalNotWorth] -&gt; ShowS
show :: ErrWithdrawalNotWorth -&gt; String
$cshow :: ErrWithdrawalNotWorth -&gt; String
showsPrec :: Int -&gt; ErrWithdrawalNotWorth -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrWithdrawalNotWorth -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3711"></span><span>
</span><span id="line-3712"></span><span id="local-6989586621682460805"><span id="local-6989586621682460806"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrReadPolicyPublicKey"><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKey"><span class="hs-identifier hs-var">ErrReadPolicyPublicKey</span></a></span></span><span>
</span><span id="line-3713"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrReadPolicyPublicKeyNotAShelleyWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyNotAShelleyWallet</span></a></span></span><span>
</span><span id="line-3714"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrReadPolicyPublicKeyNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3715"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrReadPolicyPublicKeyAbsent"><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyAbsent"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyAbsent</span></a></span></span><span>
</span><span id="line-3716"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ErrReadPolicyPublicKey -&gt; Rep ErrReadPolicyPublicKey x)
-&gt; (forall x.
    Rep ErrReadPolicyPublicKey x -&gt; ErrReadPolicyPublicKey)
-&gt; Generic ErrReadPolicyPublicKey
forall x. Rep ErrReadPolicyPublicKey x -&gt; ErrReadPolicyPublicKey
forall x. ErrReadPolicyPublicKey -&gt; Rep ErrReadPolicyPublicKey x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrReadPolicyPublicKey x -&gt; ErrReadPolicyPublicKey
$cfrom :: forall x. ErrReadPolicyPublicKey -&gt; Rep ErrReadPolicyPublicKey x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460799"><span id="local-6989586621682460801"><span class="annot"><span class="annottext">ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool
(ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool)
-&gt; (ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool)
-&gt; Eq ErrReadPolicyPublicKey
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool
$c/= :: ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool
== :: ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool
$c== :: ErrReadPolicyPublicKey -&gt; ErrReadPolicyPublicKey -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460793"><span id="local-6989586621682460795"><span id="local-6989586621682460797"><span class="annot"><span class="annottext">Int -&gt; ErrReadPolicyPublicKey -&gt; ShowS
[ErrReadPolicyPublicKey] -&gt; ShowS
ErrReadPolicyPublicKey -&gt; String
(Int -&gt; ErrReadPolicyPublicKey -&gt; ShowS)
-&gt; (ErrReadPolicyPublicKey -&gt; String)
-&gt; ([ErrReadPolicyPublicKey] -&gt; ShowS)
-&gt; Show ErrReadPolicyPublicKey
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrReadPolicyPublicKey] -&gt; ShowS
$cshowList :: [ErrReadPolicyPublicKey] -&gt; ShowS
show :: ErrReadPolicyPublicKey -&gt; String
$cshow :: ErrReadPolicyPublicKey -&gt; String
showsPrec :: Int -&gt; ErrReadPolicyPublicKey -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrReadPolicyPublicKey -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3717"></span><span>
</span><span id="line-3718"></span><span id="local-6989586621682460791"><span id="local-6989586621682460792"></span></span><span class="hs-keyword">data</span><span> </span><span id="ErrWritePolicyPublicKey"><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKey"><span class="hs-identifier hs-var">ErrWritePolicyPublicKey</span></a></span></span><span>
</span><span id="line-3719"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrWritePolicyPublicKeyNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-var">ErrWritePolicyPublicKeyNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3720"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrWritePolicyPublicKeyWithRootKey"><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyWithRootKey"><span class="hs-identifier hs-var">ErrWritePolicyPublicKeyWithRootKey</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span>
</span><span id="line-3721"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 ErrWritePolicyPublicKey -&gt; Rep ErrWritePolicyPublicKey x)
-&gt; (forall x.
    Rep ErrWritePolicyPublicKey x -&gt; ErrWritePolicyPublicKey)
-&gt; Generic ErrWritePolicyPublicKey
forall x. Rep ErrWritePolicyPublicKey x -&gt; ErrWritePolicyPublicKey
forall x. ErrWritePolicyPublicKey -&gt; Rep ErrWritePolicyPublicKey x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ErrWritePolicyPublicKey x -&gt; ErrWritePolicyPublicKey
$cfrom :: forall x. ErrWritePolicyPublicKey -&gt; Rep ErrWritePolicyPublicKey x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460785"><span id="local-6989586621682460787"><span class="annot"><span class="annottext">ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool
(ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool)
-&gt; (ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool)
-&gt; Eq ErrWritePolicyPublicKey
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool
$c/= :: ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool
== :: ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool
$c== :: ErrWritePolicyPublicKey -&gt; ErrWritePolicyPublicKey -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460779"><span id="local-6989586621682460781"><span id="local-6989586621682460783"><span class="annot"><span class="annottext">Int -&gt; ErrWritePolicyPublicKey -&gt; ShowS
[ErrWritePolicyPublicKey] -&gt; ShowS
ErrWritePolicyPublicKey -&gt; String
(Int -&gt; ErrWritePolicyPublicKey -&gt; ShowS)
-&gt; (ErrWritePolicyPublicKey -&gt; String)
-&gt; ([ErrWritePolicyPublicKey] -&gt; ShowS)
-&gt; Show ErrWritePolicyPublicKey
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrWritePolicyPublicKey] -&gt; ShowS
$cshowList :: [ErrWritePolicyPublicKey] -&gt; ShowS
show :: ErrWritePolicyPublicKey -&gt; String
$cshow :: ErrWritePolicyPublicKey -&gt; String
showsPrec :: Int -&gt; ErrWritePolicyPublicKey -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrWritePolicyPublicKey -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3722"></span><span>
</span><span id="line-3723"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                   Utils
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3726"></span><span>
</span><span id="line-3727"></span><span id="local-6989586621682465236"><span id="local-6989586621682465237"><span class="annot"><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-type">withNoSuchWallet</span></a></span><span>
</span><span id="line-3728"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465237"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3729"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3730"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682465237"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465236"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3731"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465237"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682465236"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-3732"></span><span id="withNoSuchWallet"><span class="annot"><span class="annottext">withNoSuchWallet :: WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var hs-var">withNoSuchWallet</span></a></span></span><span> </span><span id="local-6989586621682460778"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682460778"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3733"></span><span>    </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; MaybeT m a -&gt; ExceptT ErrNoSuchWallet m a
forall (m :: * -&gt; *) e a.
Functor m =&gt;
e -&gt; MaybeT m a -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">maybeToExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ErrNoSuchWallet
</span><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-var">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682460778"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT m a -&gt; ExceptT ErrNoSuchWallet m a)
-&gt; (m (Maybe a) -&gt; MaybeT m a)
-&gt; m (Maybe a)
-&gt; ExceptT ErrNoSuchWallet m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe a) -&gt; MaybeT m a
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">MaybeT</span></a></span><span>
</span><span id="line-3734"></span><span>
</span><span id="line-3735"></span><span id="local-6989586621682460774"><span id="local-6989586621682460775"></span></span><span class="hs-keyword">data</span><span> </span><span id="PoolRetirementEpochInfo"><span class="annot"><a href="Cardano.Wallet.html#PoolRetirementEpochInfo"><span class="hs-identifier hs-var">PoolRetirementEpochInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PoolRetirementEpochInfo"><span class="annot"><a href="Cardano.Wallet.html#PoolRetirementEpochInfo"><span class="hs-identifier hs-var">PoolRetirementEpochInfo</span></a></span></span><span>
</span><span id="line-3736"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcurrentEpoch%3APoolRetirementEpochInfo"><span class="annot"><span class="annottext">PoolRetirementEpochInfo -&gt; EpochNo
</span><a href="Cardano.Wallet.html#%24sel%3AcurrentEpoch%3APoolRetirementEpochInfo"><span class="hs-identifier hs-var hs-var">currentEpoch</span></a></span></span><span>
</span><span id="line-3737"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#EpochNo"><span class="hs-identifier hs-type">W.EpochNo</span></a></span><span>
</span><span id="line-3738"></span><span>        </span><span class="hs-comment">-- ^ The current epoch.</span><span>
</span><span id="line-3739"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AretirementEpoch%3APoolRetirementEpochInfo"><span class="annot"><span class="annottext">PoolRetirementEpochInfo -&gt; EpochNo
</span><a href="Cardano.Wallet.html#%24sel%3AretirementEpoch%3APoolRetirementEpochInfo"><span class="hs-identifier hs-var hs-var">retirementEpoch</span></a></span></span><span>
</span><span id="line-3740"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#EpochNo"><span class="hs-identifier hs-type">W.EpochNo</span></a></span><span>
</span><span id="line-3741"></span><span>        </span><span class="hs-comment">-- ^ The retirement epoch of a pool.</span><span>
</span><span id="line-3742"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-3743"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460768"><span id="local-6989586621682460770"><span class="annot"><span class="annottext">PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool
(PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool)
-&gt; (PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool)
-&gt; Eq PoolRetirementEpochInfo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool
$c/= :: PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool
== :: PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool
$c== :: PoolRetirementEpochInfo -&gt; PoolRetirementEpochInfo -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x.
 PoolRetirementEpochInfo -&gt; Rep PoolRetirementEpochInfo x)
-&gt; (forall x.
    Rep PoolRetirementEpochInfo x -&gt; PoolRetirementEpochInfo)
-&gt; Generic PoolRetirementEpochInfo
forall x. Rep PoolRetirementEpochInfo x -&gt; PoolRetirementEpochInfo
forall x. PoolRetirementEpochInfo -&gt; Rep PoolRetirementEpochInfo x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep PoolRetirementEpochInfo x -&gt; PoolRetirementEpochInfo
$cfrom :: forall x. PoolRetirementEpochInfo -&gt; Rep PoolRetirementEpochInfo x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460760"><span id="local-6989586621682460762"><span id="local-6989586621682460764"><span class="annot"><span class="annottext">Int -&gt; PoolRetirementEpochInfo -&gt; ShowS
[PoolRetirementEpochInfo] -&gt; ShowS
PoolRetirementEpochInfo -&gt; String
(Int -&gt; PoolRetirementEpochInfo -&gt; ShowS)
-&gt; (PoolRetirementEpochInfo -&gt; String)
-&gt; ([PoolRetirementEpochInfo] -&gt; ShowS)
-&gt; Show PoolRetirementEpochInfo
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PoolRetirementEpochInfo] -&gt; ShowS
$cshowList :: [PoolRetirementEpochInfo] -&gt; ShowS
show :: PoolRetirementEpochInfo -&gt; String
$cshow :: PoolRetirementEpochInfo -&gt; String
showsPrec :: Int -&gt; PoolRetirementEpochInfo -&gt; ShowS
$cshowsPrec :: Int -&gt; PoolRetirementEpochInfo -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3744"></span><span>
</span><span id="line-3745"></span><span class="annot"><a href="Cardano.Wallet.html#guardJoin"><span class="hs-identifier hs-type">guardJoin</span></a></span><span>
</span><span id="line-3746"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-3747"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-type">WalletDelegation</span></a></span><span>
</span><span id="line-3748"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-3749"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PoolRetirementEpochInfo"><span class="hs-identifier hs-type">PoolRetirementEpochInfo</span></a></span><span>
</span><span id="line-3750"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotJoin"><span class="hs-identifier hs-type">ErrCannotJoin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3751"></span><span id="guardJoin"><span class="annot"><span class="annottext">guardJoin :: Set PoolId
-&gt; WalletDelegation
-&gt; PoolId
-&gt; Maybe PoolRetirementEpochInfo
-&gt; Either ErrCannotJoin ()
</span><a href="Cardano.Wallet.html#guardJoin"><span class="hs-identifier hs-var hs-var">guardJoin</span></a></span></span><span> </span><span id="local-6989586621682460759"><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682460759"><span class="hs-identifier hs-var">knownPools</span></a></span></span><span> </span><span id="local-6989586621682460758"><span class="annot"><span class="annottext">WalletDelegation
</span><a href="#local-6989586621682460758"><span class="hs-identifier hs-var">delegation</span></a></span></span><span> </span><span id="local-6989586621682460757"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621682460756"><span class="annot"><span class="annottext">Maybe PoolRetirementEpochInfo
</span><a href="#local-6989586621682460756"><span class="hs-identifier hs-var">mRetirementEpochInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3752"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; Set PoolId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.notMember`</span></a></span><span> </span><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682460759"><span class="hs-identifier hs-var">knownPools</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotJoin () -&gt; Either ErrCannotJoin ())
-&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3753"></span><span>        </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; Either ErrCannotJoin ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ErrCannotJoin
</span><a href="Cardano.Wallet.Transaction.html#ErrNoSuchPool"><span class="hs-identifier hs-var">ErrNoSuchPool</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3754"></span><span>
</span><span id="line-3755"></span><span>    </span><span class="annot"><span class="annottext">Maybe PoolRetirementEpochInfo
-&gt; (PoolRetirementEpochInfo -&gt; Either ErrCannotJoin ())
-&gt; Either ErrCannotJoin ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PoolRetirementEpochInfo
</span><a href="#local-6989586621682460756"><span class="hs-identifier hs-var">mRetirementEpochInfo</span></a></span><span> </span><span class="annot"><span class="annottext">((PoolRetirementEpochInfo -&gt; Either ErrCannotJoin ())
 -&gt; Either ErrCannotJoin ())
-&gt; (PoolRetirementEpochInfo -&gt; Either ErrCannotJoin ())
-&gt; Either ErrCannotJoin ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682460753"><span class="annot"><span class="annottext">PoolRetirementEpochInfo
</span><a href="#local-6989586621682460753"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3756"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolRetirementEpochInfo -&gt; EpochNo
</span><a href="Cardano.Wallet.html#%24sel%3AcurrentEpoch%3APoolRetirementEpochInfo"><span class="hs-identifier hs-var hs-var">currentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">PoolRetirementEpochInfo
</span><a href="#local-6989586621682460753"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">PoolRetirementEpochInfo -&gt; EpochNo
</span><a href="Cardano.Wallet.html#%24sel%3AretirementEpoch%3APoolRetirementEpochInfo"><span class="hs-identifier hs-var hs-var">retirementEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">PoolRetirementEpochInfo
</span><a href="#local-6989586621682460753"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotJoin () -&gt; Either ErrCannotJoin ())
-&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3757"></span><span>            </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; Either ErrCannotJoin ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ErrCannotJoin
</span><a href="Cardano.Wallet.Transaction.html#ErrNoSuchPool"><span class="hs-identifier hs-var">ErrNoSuchPool</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3758"></span><span>
</span><span id="line-3759"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[WalletDelegationNext] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext]
</span><a href="#local-6989586621682460752"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(PoolId -&gt; Bool) -&gt; WalletDelegationStatus -&gt; Bool
forall a. IsDelegatingTo a =&gt; (PoolId -&gt; Bool) -&gt; a -&gt; Bool
</span><a href="Cardano.Wallet.Primitive.Types.html#isDelegatingTo"><span class="hs-identifier hs-var">isDelegatingTo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; PoolId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="#local-6989586621682460749"><span class="hs-identifier hs-var">active</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotJoin () -&gt; Either ErrCannotJoin ())
-&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3760"></span><span>        </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; Either ErrCannotJoin ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ErrCannotJoin
</span><a href="Cardano.Wallet.Transaction.html#ErrAlreadyDelegating"><span class="hs-identifier hs-var">ErrAlreadyDelegating</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3761"></span><span>
</span><span id="line-3762"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[WalletDelegationNext] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext]
</span><a href="#local-6989586621682460752"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(PoolId -&gt; Bool) -&gt; WalletDelegationNext -&gt; Bool
forall a. IsDelegatingTo a =&gt; (PoolId -&gt; Bool) -&gt; a -&gt; Bool
</span><a href="Cardano.Wallet.Primitive.Types.html#isDelegatingTo"><span class="hs-identifier hs-var">isDelegatingTo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; PoolId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[WalletDelegationNext] -&gt; WalletDelegationNext
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext]
</span><a href="#local-6989586621682460752"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotJoin () -&gt; Either ErrCannotJoin ())
-&gt; Either ErrCannotJoin () -&gt; Either ErrCannotJoin ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3763"></span><span>        </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; Either ErrCannotJoin ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ErrCannotJoin
</span><a href="Cardano.Wallet.Transaction.html#ErrAlreadyDelegating"><span class="hs-identifier hs-var">ErrAlreadyDelegating</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682460757"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3764"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3765"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-type">WalletDelegation</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682460749"><span class="annot"><span class="annottext">WalletDelegationStatus
$sel:active:WalletDelegation :: WalletDelegation -&gt; WalletDelegationStatus
active :: WalletDelegationStatus
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Aactive%3AWalletDelegation"><span class="hs-identifier hs-var hs-var">active</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460752"><span class="annot"><span class="annottext">[WalletDelegationNext]
$sel:next:WalletDelegation :: WalletDelegation -&gt; [WalletDelegationNext]
next :: [WalletDelegationNext]
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Anext%3AWalletDelegation"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletDelegation
</span><a href="#local-6989586621682460758"><span class="hs-identifier hs-var">delegation</span></a></span><span>
</span><span id="line-3766"></span><span>
</span><span id="line-3767"></span><span class="annot"><a href="Cardano.Wallet.html#guardQuit"><span class="hs-identifier hs-type">guardQuit</span></a></span><span>
</span><span id="line-3768"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-type">WalletDelegation</span></a></span><span>
</span><span id="line-3769"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-3770"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-3771"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotQuit"><span class="hs-identifier hs-type">ErrCannotQuit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3772"></span><span id="guardQuit"><span class="annot"><span class="annottext">guardQuit :: WalletDelegation -&gt; Withdrawal -&gt; Coin -&gt; Either ErrCannotQuit ()
</span><a href="Cardano.Wallet.html#guardQuit"><span class="hs-identifier hs-var hs-var">guardQuit</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-type">WalletDelegation</span></a></span><span class="hs-special">{</span><span id="local-6989586621682460744"><span class="annot"><span class="annottext">WalletDelegationStatus
active :: WalletDelegationStatus
$sel:active:WalletDelegation :: WalletDelegation -&gt; WalletDelegationStatus
</span><a href="#local-6989586621682460744"><span class="hs-identifier hs-var hs-var">active</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682460743"><span class="annot"><span class="annottext">[WalletDelegationNext]
next :: [WalletDelegationNext]
$sel:next:WalletDelegation :: WalletDelegation -&gt; [WalletDelegationNext]
</span><a href="#local-6989586621682460743"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621682460742"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682460742"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span> </span><span id="local-6989586621682460741"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682460741"><span class="hs-identifier hs-var">rewards</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3773"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682460740"><span class="annot"><span class="annottext">last_ :: WalletDelegationStatus
</span><a href="#local-6989586621682460740"><span class="hs-identifier hs-var hs-var">last_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
-&gt; (WalletDelegationNext -&gt; WalletDelegationStatus)
-&gt; Maybe WalletDelegationNext
-&gt; WalletDelegationStatus
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="#local-6989586621682460744"><span class="hs-identifier hs-var">active</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((WalletDelegationStatus
  -&gt; Const WalletDelegationStatus WalletDelegationStatus)
 -&gt; WalletDelegationNext
 -&gt; Const WalletDelegationStatus WalletDelegationNext)
-&gt; WalletDelegationNext -&gt; WalletDelegationStatus
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((WalletDelegationStatus
    -&gt; Const WalletDelegationStatus WalletDelegationStatus)
   -&gt; WalletDelegationNext
   -&gt; Const WalletDelegationStatus WalletDelegationNext)
(WalletDelegationStatus
 -&gt; Const WalletDelegationStatus WalletDelegationStatus)
-&gt; WalletDelegationNext
-&gt; Const WalletDelegationStatus WalletDelegationNext
</span><a href="#local-6989586621682460739"><span class="hs-var">#status</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe WalletDelegationNext -&gt; WalletDelegationStatus)
-&gt; Maybe WalletDelegationNext -&gt; WalletDelegationStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext] -&gt; Maybe WalletDelegationNext
forall a. [a] -&gt; Maybe a
</span><a href="../../../../safe/html/src"><span class="hs-identifier hs-var">lastMay</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext]
</span><a href="#local-6989586621682460743"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-3774"></span><span>
</span><span id="line-3775"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Either ErrCannotQuit () -&gt; Either ErrCannotQuit ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PoolId -&gt; Bool) -&gt; WalletDelegationStatus -&gt; Bool
forall a. IsDelegatingTo a =&gt; (PoolId -&gt; Bool) -&gt; a -&gt; Bool
</span><a href="Cardano.Wallet.Primitive.Types.html#isDelegatingTo"><span class="hs-identifier hs-var">isDelegatingTo</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; Bool
forall b. b -&gt; Bool
</span><a href="#local-6989586621682460738"><span class="hs-identifier hs-var">anyone</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="#local-6989586621682460740"><span class="hs-identifier hs-var">last_</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ErrCannotQuit () -&gt; Either ErrCannotQuit ())
-&gt; Either ErrCannotQuit () -&gt; Either ErrCannotQuit ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3776"></span><span>        </span><span class="annot"><span class="annottext">ErrCannotQuit -&gt; Either ErrCannotQuit ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit
</span><a href="Cardano.Wallet.Transaction.html#ErrNotDelegatingOrAboutTo"><span class="hs-identifier hs-var">ErrNotDelegatingOrAboutTo</span></a></span><span>
</span><span id="line-3777"></span><span>
</span><span id="line-3778"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682460742"><span class="hs-identifier hs-var">wdrl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3779"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-type">WithdrawalSelf</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either ErrCannotQuit ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3780"></span><span>        </span><span class="annot"><span class="annottext">Withdrawal
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-3781"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682460741"><span class="hs-identifier hs-var">rewards</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either ErrCannotQuit ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3782"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit -&gt; Either ErrCannotQuit ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrCannotQuit -&gt; Either ErrCannotQuit ())
-&gt; ErrCannotQuit -&gt; Either ErrCannotQuit ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; ErrCannotQuit
</span><a href="Cardano.Wallet.Transaction.html#ErrNonNullRewards"><span class="hs-identifier hs-var">ErrNonNullRewards</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682460741"><span class="hs-identifier hs-var">rewards</span></a></span><span>
</span><span id="line-3783"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3784"></span><span>    </span><span id="local-6989586621682460738"><span class="annot"><span class="annottext">anyone :: b -&gt; Bool
</span><a href="#local-6989586621682460738"><span class="hs-identifier hs-var hs-var">anyone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; b -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-3785"></span><span>
</span><span id="line-3786"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                    Logging
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3789"></span><span>
</span><span id="line-3790"></span><span class="hs-comment">-- | Log messages for actions running within a wallet worker context.</span><span>
</span><span id="line-3791"></span><span class="hs-keyword">data</span><span> </span><span id="WalletWorkerLog"><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-var">WalletWorkerLog</span></a></span></span><span>
</span><span id="line-3792"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="MsgWallet"><span class="annot"><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-var">MsgWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a></span><span>
</span><span id="line-3793"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgWalletFollow"><span class="annot"><a href="Cardano.Wallet.html#MsgWalletFollow"><span class="hs-identifier hs-var">MsgWalletFollow</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier hs-type">WalletFollowLog</span></a></span><span>
</span><span id="line-3794"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgChainFollow"><span class="annot"><a href="Cardano.Wallet.html#MsgChainFollow"><span class="hs-identifier hs-var">MsgChainFollow</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ChainFollowLog"><span class="hs-identifier hs-type">ChainFollowLog</span></a></span><span>
</span><span id="line-3795"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460730"><span id="local-6989586621682460732"><span id="local-6989586621682460734"><span class="annot"><span class="annottext">Int -&gt; WalletWorkerLog -&gt; ShowS
[WalletWorkerLog] -&gt; ShowS
WalletWorkerLog -&gt; String
(Int -&gt; WalletWorkerLog -&gt; ShowS)
-&gt; (WalletWorkerLog -&gt; String)
-&gt; ([WalletWorkerLog] -&gt; ShowS)
-&gt; Show WalletWorkerLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WalletWorkerLog] -&gt; ShowS
$cshowList :: [WalletWorkerLog] -&gt; ShowS
show :: WalletWorkerLog -&gt; String
$cshow :: WalletWorkerLog -&gt; String
showsPrec :: Int -&gt; WalletWorkerLog -&gt; ShowS
$cshowsPrec :: Int -&gt; WalletWorkerLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460726"><span id="local-6989586621682460728"><span class="annot"><span class="annottext">WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool
(WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool)
-&gt; (WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool)
-&gt; Eq WalletWorkerLog
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool
$c/= :: WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool
== :: WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool
$c== :: WalletWorkerLog -&gt; WalletWorkerLog -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3796"></span><span>
</span><span id="line-3797"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3798"></span><span>    </span><span id="local-6989586621682460723"><span class="annot"><span class="annottext">toText :: WalletWorkerLog -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3799"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-type">MsgWallet</span></a></span><span> </span><span id="local-6989586621682460721"><span class="annot"><span class="annottext">WalletLog
</span><a href="#local-6989586621682460721"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WalletLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLog
</span><a href="#local-6989586621682460721"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3800"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgWalletFollow"><span class="hs-identifier hs-type">MsgWalletFollow</span></a></span><span> </span><span id="local-6989586621682460720"><span class="annot"><span class="annottext">WalletFollowLog
</span><a href="#local-6989586621682460720"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WalletFollowLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletFollowLog
</span><a href="#local-6989586621682460720"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3801"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgChainFollow"><span class="hs-identifier hs-type">MsgChainFollow</span></a></span><span> </span><span id="local-6989586621682460719"><span class="annot"><span class="annottext">ChainFollowLog
</span><a href="#local-6989586621682460719"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainFollowLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">ChainFollowLog
</span><a href="#local-6989586621682460719"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3802"></span><span>
</span><span id="line-3803"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460717"><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span></span><span>
</span><span id="line-3804"></span><span>
</span><span id="line-3805"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">WalletWorkerLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3806"></span><span>    </span><span id="local-6989586621682460713"><span class="annot"><span class="annottext">getSeverityAnnotation :: WalletWorkerLog -&gt; Severity
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3807"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgWallet"><span class="hs-identifier hs-type">MsgWallet</span></a></span><span> </span><span id="local-6989586621682460711"><span class="annot"><span class="annottext">WalletLog
</span><a href="#local-6989586621682460711"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WalletLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">WalletLog
</span><a href="#local-6989586621682460711"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3808"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgWalletFollow"><span class="hs-identifier hs-type">MsgWalletFollow</span></a></span><span> </span><span id="local-6989586621682460710"><span class="annot"><span class="annottext">WalletFollowLog
</span><a href="#local-6989586621682460710"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WalletFollowLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">WalletFollowLog
</span><a href="#local-6989586621682460710"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3809"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgChainFollow"><span class="hs-identifier hs-type">MsgChainFollow</span></a></span><span> </span><span id="local-6989586621682460709"><span class="annot"><span class="annottext">ChainFollowLog
</span><a href="#local-6989586621682460709"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainFollowLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">ChainFollowLog
</span><a href="#local-6989586621682460709"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3810"></span><span>
</span><span id="line-3811"></span><span class="hs-comment">-- | Log messages arising from the restore and follow process.</span><span>
</span><span id="line-3812"></span><span class="hs-keyword">data</span><span> </span><span id="WalletFollowLog"><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier hs-var">WalletFollowLog</span></a></span></span><span>
</span><span id="line-3813"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="MsgDiscoveredDelegationCert"><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredDelegationCert"><span class="hs-identifier hs-var">MsgDiscoveredDelegationCert</span></a></span></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#DelegationCertificate"><span class="hs-identifier hs-type">DelegationCertificate</span></a></span><span>
</span><span id="line-3814"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgCheckpoint"><span class="annot"><a href="Cardano.Wallet.html#MsgCheckpoint"><span class="hs-identifier hs-var">MsgCheckpoint</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-3815"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgDiscoveredTxs"><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxs"><span class="hs-identifier hs-var">MsgDiscoveredTxs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3816"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgDiscoveredTxsContent"><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxsContent"><span class="hs-identifier hs-var">MsgDiscoveredTxsContent</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3817"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460703"><span id="local-6989586621682460705"><span id="local-6989586621682460707"><span class="annot"><span class="annottext">Int -&gt; WalletFollowLog -&gt; ShowS
[WalletFollowLog] -&gt; ShowS
WalletFollowLog -&gt; String
(Int -&gt; WalletFollowLog -&gt; ShowS)
-&gt; (WalletFollowLog -&gt; String)
-&gt; ([WalletFollowLog] -&gt; ShowS)
-&gt; Show WalletFollowLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WalletFollowLog] -&gt; ShowS
$cshowList :: [WalletFollowLog] -&gt; ShowS
show :: WalletFollowLog -&gt; String
$cshow :: WalletFollowLog -&gt; String
showsPrec :: Int -&gt; WalletFollowLog -&gt; ShowS
$cshowsPrec :: Int -&gt; WalletFollowLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460699"><span id="local-6989586621682460701"><span class="annot"><span class="annottext">WalletFollowLog -&gt; WalletFollowLog -&gt; Bool
(WalletFollowLog -&gt; WalletFollowLog -&gt; Bool)
-&gt; (WalletFollowLog -&gt; WalletFollowLog -&gt; Bool)
-&gt; Eq WalletFollowLog
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: WalletFollowLog -&gt; WalletFollowLog -&gt; Bool
$c/= :: WalletFollowLog -&gt; WalletFollowLog -&gt; Bool
== :: WalletFollowLog -&gt; WalletFollowLog -&gt; Bool
$c== :: WalletFollowLog -&gt; WalletFollowLog -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3818"></span><span>
</span><span id="line-3819"></span><span class="hs-comment">-- | Helper wrapper type for the sake of logging.</span><span>
</span><span id="line-3820"></span><span class="hs-keyword">data</span><span> </span><span id="BuildableInAnyEra"><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-var">BuildableInAnyEra</span></a></span></span><span> </span><span id="local-6989586621682464755"><span class="annot"><a href="#local-6989586621682464755"><span class="hs-identifier hs-type">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682464754"><span class="annot"><a href="#local-6989586621682464754"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3821"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464755"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464754"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3822"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464755"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464754"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3823"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464755"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464754"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3824"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="BuildableInAnyEra"><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-var">BuildableInAnyEra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.CardanoEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464754"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682464755"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682464754"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3825"></span><span>
</span><span id="line-3826"></span><span id="local-6989586621682460698"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460693"><span id="local-6989586621682460696"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460698"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3827"></span><span>    </span><span id="local-6989586621682460692"><span class="annot"><span class="annottext">show :: BuildableInAnyEra a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682460690"><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460690"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460690"><span class="hs-identifier hs-var">a</span></a></span></span><span>
</span><span id="line-3828"></span><span>
</span><span id="line-3829"></span><span id="local-6989586621682460689"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460686"><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460689"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3830"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span id="local-6989586621682460685"><span class="annot"><span class="annottext">CardanoEra era
</span><a href="#local-6989586621682460685"><span class="hs-identifier hs-var">era1</span></a></span></span><span> </span><span id="local-6989586621682460684"><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460684"><span class="hs-identifier hs-var">thing1</span></a></span></span><span> </span><span id="local-6989586621682460683"><span class="annot"><span class="annottext">== :: BuildableInAnyEra a -&gt; BuildableInAnyEra a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span id="local-6989586621682460682"><span class="annot"><span class="annottext">CardanoEra era
</span><a href="#local-6989586621682460682"><span class="hs-identifier hs-var">era2</span></a></span></span><span> </span><span id="local-6989586621682460681"><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460681"><span class="hs-identifier hs-var">thing2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3831"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; CardanoEra era -&gt; Maybe (era :~: era)
forall k (f :: k -&gt; *) (a :: k) (b :: k).
TestEquality f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">testEquality</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><a href="#local-6989586621682460685"><span class="hs-identifier hs-var">era1</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><a href="#local-6989586621682460682"><span class="hs-identifier hs-var">era2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3832"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">era :~: era
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460684"><span class="hs-identifier hs-var">thing1</span></a></span><span> </span><span class="annot"><span class="annottext">a era -&gt; a era -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a era
a era
</span><a href="#local-6989586621682460681"><span class="hs-identifier hs-var">thing2</span></a></span><span>
</span><span id="line-3833"></span><span>            </span><span class="annot"><span class="annottext">Maybe (era :~: era)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span></span><span>
</span><span id="line-3834"></span><span>
</span><span id="line-3835"></span><span id="local-6989586621682460680"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460680"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3836"></span><span>    </span><span id="local-6989586621682460678"><span class="annot"><span class="annottext">build :: BuildableInAnyEra a -&gt; Builder
</span><a href="#local-6989586621682460678"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682460677"><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460677"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a era -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">a era
</span><a href="#local-6989586621682460677"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-3837"></span><span>
</span><span id="line-3838"></span><span class="hs-comment">-- | Log messages from API server actions running in a wallet worker context.</span><span>
</span><span id="line-3839"></span><span class="hs-keyword">data</span><span> </span><span id="WalletLog"><span class="annot"><a href="Cardano.Wallet.html#WalletLog"><span class="hs-identifier hs-var">WalletLog</span></a></span></span><span>
</span><span id="line-3840"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="MsgSelectionStart"><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionStart"><span class="hs-identifier hs-var">MsgSelectionStart</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3841"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgSelectionForBalancingStart"><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionForBalancingStart"><span class="hs-identifier hs-var">MsgSelectionForBalancingStart</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#BuildableInAnyEra"><span class="hs-identifier hs-type">BuildableInAnyEra</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">PartialTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3842"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgSelectionError"><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionError"><span class="hs-identifier hs-var">MsgSelectionError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionError"><span class="hs-identifier hs-type">SelectionError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3843"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgSelectionReportSummarized"><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionReportSummarized"><span class="hs-identifier hs-var">MsgSelectionReportSummarized</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionReportSummarized"><span class="hs-identifier hs-type">SelectionReportSummarized</span></a></span><span>
</span><span id="line-3844"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgSelectionReportDetailed"><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionReportDetailed"><span class="hs-identifier hs-var">MsgSelectionReportDetailed</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionReportDetailed"><span class="hs-identifier hs-type">SelectionReportDetailed</span></a></span><span>
</span><span id="line-3845"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgMigrationUTxOBefore"><span class="annot"><a href="Cardano.Wallet.html#MsgMigrationUTxOBefore"><span class="hs-identifier hs-var">MsgMigrationUTxOBefore</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxOStatistics"><span class="hs-identifier hs-type">UTxOStatistics</span></a></span><span>
</span><span id="line-3846"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgMigrationUTxOAfter"><span class="annot"><a href="Cardano.Wallet.html#MsgMigrationUTxOAfter"><span class="hs-identifier hs-var">MsgMigrationUTxOAfter</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxOStatistics"><span class="hs-identifier hs-type">UTxOStatistics</span></a></span><span>
</span><span id="line-3847"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgRewardBalanceQuery"><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceQuery"><span class="hs-identifier hs-var">MsgRewardBalanceQuery</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-3848"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgRewardBalanceResult"><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceResult"><span class="hs-identifier hs-var">MsgRewardBalanceResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewards"><span class="hs-identifier hs-type">ErrFetchRewards</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3849"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgRewardBalanceNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceNoSuchWallet"><span class="hs-identifier hs-var">MsgRewardBalanceNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-3850"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgRewardBalanceExited"><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceExited"><span class="hs-identifier hs-var">MsgRewardBalanceExited</span></a></span></span><span>
</span><span id="line-3851"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgTxSubmit"><span class="annot"><a href="Cardano.Wallet.html#MsgTxSubmit"><span class="hs-identifier hs-var">MsgTxSubmit</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span><span>
</span><span id="line-3852"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgIsStakeKeyRegistered"><span class="annot"><a href="Cardano.Wallet.html#MsgIsStakeKeyRegistered"><span class="hs-identifier hs-var">MsgIsStakeKeyRegistered</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-3853"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460669"><span id="local-6989586621682460671"><span id="local-6989586621682460673"><span class="annot"><span class="annottext">Int -&gt; WalletLog -&gt; ShowS
[WalletLog] -&gt; ShowS
WalletLog -&gt; String
(Int -&gt; WalletLog -&gt; ShowS)
-&gt; (WalletLog -&gt; String)
-&gt; ([WalletLog] -&gt; ShowS)
-&gt; Show WalletLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WalletLog] -&gt; ShowS
$cshowList :: [WalletLog] -&gt; ShowS
show :: WalletLog -&gt; String
$cshow :: WalletLog -&gt; String
showsPrec :: Int -&gt; WalletLog -&gt; ShowS
$cshowsPrec :: Int -&gt; WalletLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460665"><span id="local-6989586621682460667"><span class="annot"><span class="annottext">WalletLog -&gt; WalletLog -&gt; Bool
(WalletLog -&gt; WalletLog -&gt; Bool)
-&gt; (WalletLog -&gt; WalletLog -&gt; Bool) -&gt; Eq WalletLog
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: WalletLog -&gt; WalletLog -&gt; Bool
$c/= :: WalletLog -&gt; WalletLog -&gt; Bool
== :: WalletLog -&gt; WalletLog -&gt; Bool
$c== :: WalletLog -&gt; WalletLog -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3854"></span><span>
</span><span id="line-3855"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier hs-type">WalletFollowLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3856"></span><span>    </span><span id="local-6989586621682460663"><span class="annot"><span class="annottext">toText :: WalletFollowLog -&gt; Text
</span><a href="#local-6989586621682460663"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3857"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredDelegationCert"><span class="hs-identifier hs-type">MsgDiscoveredDelegationCert</span></a></span><span> </span><span id="local-6989586621682460662"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682460662"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span id="local-6989586621682460661"><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682460661"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682460661"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3858"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertDelegateNone"><span class="hs-identifier hs-type">CertDelegateNone</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-3859"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Discovered end of delegation within slot &quot;</span></span><span>
</span><span id="line-3860"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682460662"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-3861"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3862"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertDelegateFull"><span class="hs-identifier hs-type">CertDelegateFull</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-3863"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Discovered delegation to pool &quot;</span></span><span>
</span><span id="line-3864"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe PoolId -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DelegationCertificate -&gt; Maybe PoolId
</span><a href="Cardano.Wallet.Primitive.Types.html#dlgCertPoolId"><span class="hs-identifier hs-var">dlgCertPoolId</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682460661"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3865"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; within slot &quot;</span></span><span>
</span><span id="line-3866"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682460662"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-3867"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3868"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertRegisterKey"><span class="hs-identifier hs-type">CertRegisterKey</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-3869"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Discovered stake key registration &quot;</span></span><span>
</span><span id="line-3870"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; within slot &quot;</span></span><span>
</span><span id="line-3871"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682460662"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-3872"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3873"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgCheckpoint"><span class="hs-identifier hs-type">MsgCheckpoint</span></a></span><span> </span><span id="local-6989586621682460657"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682460657"><span class="hs-identifier hs-var">checkpointTip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3874"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Creating checkpoint at &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682460657"><span class="hs-identifier hs-var">checkpointTip</span></a></span><span>
</span><span id="line-3875"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxs"><span class="hs-identifier hs-type">MsgDiscoveredTxs</span></a></span><span> </span><span id="local-6989586621682460656"><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682460656"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3876"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;discovered &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Tx, TxMeta)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682460656"><span class="hs-identifier hs-var">txs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; new transaction(s)&quot;</span></span><span>
</span><span id="line-3877"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxsContent"><span class="hs-identifier hs-type">MsgDiscoveredTxsContent</span></a></span><span> </span><span id="local-6989586621682460655"><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682460655"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3878"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transactions: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxMeta] -&gt; Builder
forall (f :: * -&gt; *) a. (Foldable f, Buildable a) =&gt; f a -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">blockListF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tx, TxMeta) -&gt; TxMeta
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Tx, TxMeta) -&gt; TxMeta) -&gt; [(Tx, TxMeta)] -&gt; [TxMeta]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682460655"><span class="hs-identifier hs-var">txs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3879"></span><span>
</span><span id="line-3880"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3881"></span><span>    </span><span id="local-6989586621682460653"><span class="annot"><span class="annottext">toText :: WalletLog -&gt; Text
</span><a href="#local-6989586621682460653"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3882"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionStart"><span class="hs-identifier hs-type">MsgSelectionStart</span></a></span><span> </span><span id="local-6989586621682460652"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682460652"><span class="hs-identifier hs-var">utxoSize</span></a></span></span><span> </span><span id="local-6989586621682460651"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682460651"><span class="hs-identifier hs-var">recipients</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3883"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Starting coin selection &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3884"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;|utxo| = &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Text
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682460652"><span class="hs-identifier hs-var">utxoSize</span></a></span><span class="annot"><span class="annottext">Int -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3885"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;#recipients = &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">[TxOut] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682460651"><span class="hs-identifier hs-var">recipients</span></a></span><span class="annot"><span class="annottext">Int -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3886"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionForBalancingStart"><span class="hs-identifier hs-type">MsgSelectionForBalancingStart</span></a></span><span> </span><span id="local-6989586621682460650"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682460650"><span class="hs-identifier hs-var">utxoSize</span></a></span></span><span> </span><span id="local-6989586621682460649"><span class="annot"><span class="annottext">BuildableInAnyEra PartialTx
</span><a href="#local-6989586621682460649"><span class="hs-identifier hs-var">partialTx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3887"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Starting coin selection for balancing &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3888"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;|utxo| = &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Text
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682460650"><span class="hs-identifier hs-var">utxoSize</span></a></span><span class="annot"><span class="annottext">Int -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3889"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;partialTx = &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">BuildableInAnyEra PartialTx
</span><a href="#local-6989586621682460649"><span class="hs-identifier hs-var">partialTx</span></a></span><span class="annot"><span class="annottext">BuildableInAnyEra PartialTx -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3890"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionError"><span class="hs-identifier hs-type">MsgSelectionError</span></a></span><span> </span><span id="local-6989586621682460648"><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682460648"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3891"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Failed to select assets:\n&quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Text
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+||</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext
</span><a href="#local-6989586621682460648"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionError WalletSelectionContext -&gt; Builder -&gt; Builder
forall a b. (Show a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">||+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3892"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionReportSummarized"><span class="hs-identifier hs-type">MsgSelectionReportSummarized</span></a></span><span> </span><span id="local-6989586621682460647"><span class="annot"><span class="annottext">SelectionReportSummarized
</span><a href="#local-6989586621682460647"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3893"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Selection report (summarized):\n&quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Text
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportSummarized
</span><a href="#local-6989586621682460647"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportSummarized -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3894"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionReportDetailed"><span class="hs-identifier hs-type">MsgSelectionReportDetailed</span></a></span><span> </span><span id="local-6989586621682460646"><span class="annot"><span class="annottext">SelectionReportDetailed
</span><a href="#local-6989586621682460646"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3895"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Selection report (detailed):\n&quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Text
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportDetailed
</span><a href="#local-6989586621682460646"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionReportDetailed -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3896"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgMigrationUTxOBefore"><span class="hs-identifier hs-type">MsgMigrationUTxOBefore</span></a></span><span> </span><span id="local-6989586621682460645"><span class="annot"><span class="annottext">UTxOStatistics
</span><a href="#local-6989586621682460645"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3897"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;About to migrate the following distribution: \n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics
</span><a href="#local-6989586621682460645"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-3898"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgMigrationUTxOAfter"><span class="hs-identifier hs-type">MsgMigrationUTxOAfter</span></a></span><span> </span><span id="local-6989586621682460644"><span class="annot"><span class="annottext">UTxOStatistics
</span><a href="#local-6989586621682460644"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3899"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Expected distribution after complete migration: \n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics
</span><a href="#local-6989586621682460644"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-3900"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceQuery"><span class="hs-identifier hs-type">MsgRewardBalanceQuery</span></a></span><span> </span><span id="local-6989586621682460643"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682460643"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3901"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Updating the reward balance for block &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682460643"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-3902"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceResult"><span class="hs-identifier hs-type">MsgRewardBalanceResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682460642"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682460642"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3903"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The reward balance is &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682460642"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-3904"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceNoSuchWallet"><span class="hs-identifier hs-type">MsgRewardBalanceNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682460641"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682460641"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3905"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Trying to store a balance for a wallet that doesn't exist (yet?): &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3906"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682460641"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3907"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceResult"><span class="hs-identifier hs-type">MsgRewardBalanceResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682460639"><span class="annot"><span class="annottext">ErrFetchRewards
</span><a href="#local-6989586621682460639"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3908"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Problem fetching reward balance. Will try again on next chain update. &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3909"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrFetchRewards -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ErrFetchRewards
</span><a href="#local-6989586621682460639"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3910"></span><span>        </span><span class="annot"><span class="annottext">WalletLog
</span><a href="Cardano.Wallet.html#MsgRewardBalanceExited"><span class="hs-identifier hs-var">MsgRewardBalanceExited</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3911"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Reward balance worker has exited.&quot;</span></span><span>
</span><span id="line-3912"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgTxSubmit"><span class="hs-identifier hs-type">MsgTxSubmit</span></a></span><span> </span><span id="local-6989586621682460638"><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682460638"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3913"></span><span>            </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682460638"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3914"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgIsStakeKeyRegistered"><span class="hs-identifier hs-type">MsgIsStakeKeyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3915"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Wallet stake key is registered. Will not register it again.&quot;</span></span><span>
</span><span id="line-3916"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgIsStakeKeyRegistered"><span class="hs-identifier hs-type">MsgIsStakeKeyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3917"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Wallet stake key is not registered. Will register...&quot;</span></span><span>
</span><span id="line-3918"></span><span>
</span><span id="line-3919"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460636"><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier hs-type">WalletFollowLog</span></a></span></span><span>
</span><span id="line-3920"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletFollowLog"><span class="hs-identifier hs-type">WalletFollowLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3921"></span><span>    </span><span id="local-6989586621682460634"><span class="annot"><span class="annottext">getSeverityAnnotation :: WalletFollowLog -&gt; Severity
</span><a href="#local-6989586621682460634"><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3922"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredDelegationCert"><span class="hs-identifier hs-type">MsgDiscoveredDelegationCert</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DelegationCertificate
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-3923"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgCheckpoint"><span class="hs-identifier hs-type">MsgCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3924"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxs"><span class="hs-identifier hs-type">MsgDiscoveredTxs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3925"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxs"><span class="hs-identifier hs-type">MsgDiscoveredTxs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-3926"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgDiscoveredTxsContent"><span class="hs-identifier hs-type">MsgDiscoveredTxsContent</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3927"></span><span>
</span><span id="line-3928"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460630"><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a></span></span><span>
</span><span id="line-3929"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3930"></span><span>    </span><span id="local-6989586621682460628"><span class="annot"><span class="annottext">getSeverityAnnotation :: WalletLog -&gt; Severity
</span><a href="#local-6989586621682460628"><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3931"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionStart"><span class="hs-identifier hs-type">MsgSelectionStart</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3932"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionForBalancingStart"><span class="hs-identifier hs-type">MsgSelectionForBalancingStart</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3933"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionError"><span class="hs-identifier hs-type">MsgSelectionError</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3934"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionReportSummarized"><span class="hs-identifier hs-type">MsgSelectionReportSummarized</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-3935"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSelectionReportDetailed"><span class="hs-identifier hs-type">MsgSelectionReportDetailed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3936"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgMigrationUTxOBefore"><span class="hs-identifier hs-type">MsgMigrationUTxOBefore</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-3937"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgMigrationUTxOAfter"><span class="hs-identifier hs-type">MsgMigrationUTxOAfter</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-3938"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceQuery"><span class="hs-identifier hs-type">MsgRewardBalanceQuery</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3939"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceResult"><span class="hs-identifier hs-type">MsgRewardBalanceResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-3940"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceResult"><span class="hs-identifier hs-type">MsgRewardBalanceResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrFetchRewards
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Notice</span></span><span>
</span><span id="line-3941"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRewardBalanceNoSuchWallet"><span class="hs-identifier hs-type">MsgRewardBalanceNoSuchWallet</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span>
</span><span id="line-3942"></span><span>        </span><span class="annot"><span class="annottext">WalletLog
</span><a href="Cardano.Wallet.html#MsgRewardBalanceExited"><span class="hs-identifier hs-var">MsgRewardBalanceExited</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Notice</span></span><span>
</span><span id="line-3943"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgTxSubmit"><span class="hs-identifier hs-type">MsgTxSubmit</span></a></span><span> </span><span id="local-6989586621682460625"><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682460625"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682460625"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3944"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgIsStakeKeyRegistered"><span class="hs-identifier hs-type">MsgIsStakeKeyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-3945"></span><span>
</span><span id="line-3946"></span><span class="hs-keyword">data</span><span> </span><span id="TxSubmitLog"><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-var">TxSubmitLog</span></a></span></span><span>
</span><span id="line-3947"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="MsgSubmitTx"><span class="annot"><a href="Cardano.Wallet.html#MsgSubmitTx"><span class="hs-identifier hs-var">MsgSubmitTx</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketLog%27"><span class="hs-identifier hs-type">BracketLog'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTx"><span class="hs-identifier hs-type">ErrSubmitTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3948"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgSubmitExternalTx"><span class="annot"><a href="Cardano.Wallet.html#MsgSubmitExternalTx"><span class="hs-identifier hs-var">MsgSubmitExternalTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketLog%27"><span class="hs-identifier hs-type">BracketLog'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier hs-type">ErrPostTx</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3949"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgRetryPostTx"><span class="annot"><a href="Cardano.Wallet.html#MsgRetryPostTx"><span class="hs-identifier hs-var">MsgRetryPostTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketLog%27"><span class="hs-identifier hs-type">BracketLog'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier hs-type">ErrPostTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3950"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgProcessPendingPool"><span class="annot"><a href="Cardano.Wallet.html#MsgProcessPendingPool"><span class="hs-identifier hs-var">MsgProcessPendingPool</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketLog"><span class="hs-identifier hs-type">BracketLog</span></a></span><span>
</span><span id="line-3951"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460619"><span id="local-6989586621682460621"><span id="local-6989586621682460623"><span class="annot"><span class="annottext">Int -&gt; TxSubmitLog -&gt; ShowS
[TxSubmitLog] -&gt; ShowS
TxSubmitLog -&gt; String
(Int -&gt; TxSubmitLog -&gt; ShowS)
-&gt; (TxSubmitLog -&gt; String)
-&gt; ([TxSubmitLog] -&gt; ShowS)
-&gt; Show TxSubmitLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TxSubmitLog] -&gt; ShowS
$cshowList :: [TxSubmitLog] -&gt; ShowS
show :: TxSubmitLog -&gt; String
$cshow :: TxSubmitLog -&gt; String
showsPrec :: Int -&gt; TxSubmitLog -&gt; ShowS
$cshowsPrec :: Int -&gt; TxSubmitLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460615"><span id="local-6989586621682460617"><span class="annot"><span class="annottext">TxSubmitLog -&gt; TxSubmitLog -&gt; Bool
(TxSubmitLog -&gt; TxSubmitLog -&gt; Bool)
-&gt; (TxSubmitLog -&gt; TxSubmitLog -&gt; Bool) -&gt; Eq TxSubmitLog
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TxSubmitLog -&gt; TxSubmitLog -&gt; Bool
$c/= :: TxSubmitLog -&gt; TxSubmitLog -&gt; Bool
== :: TxSubmitLog -&gt; TxSubmitLog -&gt; Bool
$c== :: TxSubmitLog -&gt; TxSubmitLog -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3952"></span><span>
</span><span id="line-3953"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460613"><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span></span><span>
</span><span id="line-3954"></span><span>
</span><span id="line-3955"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3956"></span><span>    </span><span id="local-6989586621682460611"><span class="annot"><span class="annottext">build :: TxSubmitLog -&gt; Builder
</span><a href="#local-6989586621682460611"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3957"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSubmitTx"><span class="hs-identifier hs-type">MsgSubmitTx</span></a></span><span> </span><span id="local-6989586621682460610"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460610"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621682460609"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682460609"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621682460608"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682460608"><span class="hs-identifier hs-var">sealed</span></a></span></span><span> </span><span id="local-6989586621682460607"><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><a href="#local-6989586621682460607"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><a href="#local-6989586621682460607"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3958"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><a href="Cardano.Wallet.Logging.html#BracketStart"><span class="hs-identifier hs-var">BracketStart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall (f :: * -&gt; *) a. (Foldable f, Buildable a) =&gt; f a -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">unlinesF</span></a></span><span>
</span><span id="line-3959"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Submitting transaction &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460610"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682460605"><span class="hs-var">#txId</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; to local node&quot;</span></span><span>
</span><span id="line-3960"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Text, Builder)] -&gt; Builder
forall t k v.
(IsList t, Item t ~ (k, v), Buildable k, Buildable v) =&gt;
t -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">blockMapF</span></a></span><span>
</span><span id="line-3961"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Tx&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460610"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3962"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SealedTx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682460608"><span class="hs-identifier hs-var">sealed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3963"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TxMeta&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682460609"><span class="hs-identifier hs-var">meta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3964"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3965"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketFinish"><span class="hs-identifier hs-type">BracketFinish</span></a></span><span> </span><span id="local-6989586621682460603"><span class="annot"><span class="annottext">Either ErrSubmitTx ()
</span><a href="#local-6989586621682460603"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3966"></span><span>                </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Transaction &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460610"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682460602"><span class="hs-var">#txId</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrSubmitTx ()
</span><a href="#local-6989586621682460603"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3967"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;accepted by local node&quot;</span></span><span>
</span><span id="line-3968"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682460601"><span class="annot"><span class="annottext">ErrSubmitTx
</span><a href="#local-6989586621682460601"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;failed: &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+||</span></a></span><span class="annot"><span class="annottext">ErrSubmitTx
</span><a href="#local-6989586621682460601"><span class="hs-identifier hs-var">err</span></a></span><span class="annot"><span class="annottext">ErrSubmitTx -&gt; Builder -&gt; Builder
forall a b. (Show a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">||+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3969"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; [(Text, Hash &quot;Tx&quot;)]
-&gt; BracketLog' (Either ErrSubmitTx ())
-&gt; Builder
forall e t v r.
(Show e, IsList t, Item t ~ (Text, v), Buildable v, Buildable r) =&gt;
Text -&gt; t -&gt; BracketLog' (Either e r) -&gt; Builder
</span><a href="Cardano.Wallet.Logging.html#formatResultMsg"><span class="hs-identifier hs-var">formatResultMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;submitTx&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;txid&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460610"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682460600"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><a href="#local-6989586621682460607"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3970"></span><span>
</span><span id="line-3971"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSubmitExternalTx"><span class="hs-identifier hs-type">MsgSubmitExternalTx</span></a></span><span> </span><span id="local-6989586621682460599"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460599"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621682460598"><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><a href="#local-6989586621682460598"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><a href="#local-6989586621682460598"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3972"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><a href="Cardano.Wallet.Logging.html#BracketStart"><span class="hs-identifier hs-var">BracketStart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Submitting external transaction &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460599"><span class="hs-identifier hs-var">txid</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span>
</span><span id="line-3973"></span><span>                </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; to local node...&quot;</span></span><span>
</span><span id="line-3974"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketFinish"><span class="hs-identifier hs-type">BracketFinish</span></a></span><span> </span><span id="local-6989586621682460597"><span class="annot"><span class="annottext">Either ErrPostTx Tx
</span><a href="#local-6989586621682460597"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3975"></span><span>                </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Transaction &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460599"><span class="hs-identifier hs-var">txid</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrPostTx Tx
</span><a href="#local-6989586621682460597"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3976"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682460596"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460596"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall (f :: * -&gt; *) a. (Foldable f, Buildable a) =&gt; f a -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">unlinesF</span></a></span><span>
</span><span id="line-3977"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;accepted by local node&quot;</span></span><span>
</span><span id="line-3978"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">nameF</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;tx&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682460596"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3979"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-3980"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682460595"><span class="annot"><span class="annottext">ErrPostTx
</span><a href="#local-6989586621682460595"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;failed: &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">ErrPostTx -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">ErrPostTx
</span><a href="#local-6989586621682460595"><span class="hs-identifier hs-var">err</span></a></span><span class="annot"><span class="annottext">Text -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3981"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; [(Text, Hash &quot;Tx&quot;)]
-&gt; BracketLog' (Either ErrPostTx Tx)
-&gt; Builder
forall e t v r.
(Show e, IsList t, Item t ~ (Text, v), Buildable v, Buildable r) =&gt;
Text -&gt; t -&gt; BracketLog' (Either e r) -&gt; Builder
</span><a href="Cardano.Wallet.Logging.html#formatResultMsg"><span class="hs-identifier hs-var">formatResultMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;submitExternalTx&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;txid&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460599"><span class="hs-identifier hs-var">txid</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><a href="#local-6989586621682460598"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3982"></span><span>
</span><span id="line-3983"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRetryPostTx"><span class="hs-identifier hs-type">MsgRetryPostTx</span></a></span><span> </span><span id="local-6989586621682460594"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460594"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621682460593"><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><a href="#local-6989586621682460593"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><a href="#local-6989586621682460593"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3984"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><a href="Cardano.Wallet.Logging.html#BracketStart"><span class="hs-identifier hs-var">BracketStart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Retrying submission of transaction &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460594"><span class="hs-identifier hs-var">txid</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span>
</span><span id="line-3985"></span><span>                </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; to local node...&quot;</span></span><span>
</span><span id="line-3986"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketFinish"><span class="hs-identifier hs-type">BracketFinish</span></a></span><span> </span><span id="local-6989586621682460592"><span class="annot"><span class="annottext">Either ErrPostTx ()
</span><a href="#local-6989586621682460592"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3987"></span><span>                </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Transaction &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460594"><span class="hs-identifier hs-var">txid</span></a></span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; resubmitted to local node and &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3988"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ErrPostTx ()
</span><a href="#local-6989586621682460592"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3989"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;accepted again&quot;</span></span><span>
</span><span id="line-3990"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrPostTx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;not accepted (this is expected)&quot;</span></span><span>
</span><span id="line-3991"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; [(Text, Hash &quot;Tx&quot;)]
-&gt; BracketLog' (Either ErrPostTx ())
-&gt; Builder
forall e t v r.
(Show e, IsList t, Item t ~ (Text, v), Buildable v, Buildable r) =&gt;
Text -&gt; t -&gt; BracketLog' (Either e r) -&gt; Builder
</span><a href="Cardano.Wallet.Logging.html#formatResultMsg"><span class="hs-identifier hs-var">formatResultMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;runLocalTxSubmissionPool(postTx)&quot;</span></span><span>
</span><span id="line-3992"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;txid&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682460594"><span class="hs-identifier hs-var">txid</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><a href="#local-6989586621682460593"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-3993"></span><span>
</span><span id="line-3994"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgProcessPendingPool"><span class="hs-identifier hs-type">MsgProcessPendingPool</span></a></span><span> </span><span id="local-6989586621682460591"><span class="annot"><span class="annottext">BracketLog
</span><a href="#local-6989586621682460591"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3995"></span><span>            </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;Processing the pending local tx submission pool: &quot;</span></span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall b. FromBuilder b =&gt; Builder -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">+|</span></a></span><span class="annot"><span class="annottext">BracketLog
</span><a href="#local-6989586621682460591"><span class="hs-identifier hs-var">msg</span></a></span><span class="annot"><span class="annottext">BracketLog -&gt; Builder -&gt; Builder
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; Builder -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-operator hs-var">|+</span></a></span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3996"></span><span>
</span><span id="line-3997"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460589"><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span></span><span>
</span><span id="line-3998"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3999"></span><span>    </span><span id="local-6989586621682460587"><span class="annot"><span class="annottext">getSeverityAnnotation :: TxSubmitLog -&gt; Severity
</span><a href="#local-6989586621682460587"><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4000"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSubmitTx"><span class="hs-identifier hs-type">MsgSubmitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682460586"><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><a href="#local-6989586621682460586"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity -&gt; BracketLog' (Either ErrSubmitTx ()) -&gt; Severity
forall e r. Severity -&gt; BracketLog' (Either e r) -&gt; Severity
</span><a href="Cardano.Wallet.Logging.html#resultSeverity"><span class="hs-identifier hs-var">resultSeverity</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrSubmitTx ())
</span><a href="#local-6989586621682460586"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-4001"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgSubmitExternalTx"><span class="hs-identifier hs-type">MsgSubmitExternalTx</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682460585"><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><a href="#local-6989586621682460585"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity -&gt; BracketLog' (Either ErrPostTx Tx) -&gt; Severity
forall e r. Severity -&gt; BracketLog' (Either e r) -&gt; Severity
</span><a href="Cardano.Wallet.Logging.html#resultSeverity"><span class="hs-identifier hs-var">resultSeverity</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx Tx)
</span><a href="#local-6989586621682460585"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-4002"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgRetryPostTx"><span class="hs-identifier hs-type">MsgRetryPostTx</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682460584"><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><a href="#local-6989586621682460584"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><a href="#local-6989586621682460584"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4003"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketFinish"><span class="hs-identifier hs-type">BracketFinish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-4004"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Logging.html#BracketException"><span class="hs-identifier hs-type">BracketException</span></a></span><span> </span><span class="annot"><span class="annottext">LoggedException SomeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-4005"></span><span>            </span><span class="annot"><span class="annottext">BracketLog' (Either ErrPostTx ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-4006"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#MsgProcessPendingPool"><span class="hs-identifier hs-type">MsgProcessPendingPool</span></a></span><span> </span><span id="local-6989586621682460581"><span class="annot"><span class="annottext">BracketLog
</span><a href="#local-6989586621682460581"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BracketLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">BracketLog
</span><a href="#local-6989586621682460581"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-4007"></span><span>
</span><span id="line-4008"></span><span class="hs-comment">-- | Convert a 'Cardano.Value' into a positive and negative component. Useful</span><span>
</span><span id="line-4009"></span><span class="hs-comment">-- to convert the potentially negative balance of a partial tx into</span><span>
</span><span id="line-4010"></span><span class="hs-comment">-- TokenBundles.</span><span>
</span><span id="line-4011"></span><span class="annot"><a href="Cardano.Wallet.html#posAndNegFromCardanoValue"><span class="hs-identifier hs-type">posAndNegFromCardanoValue</span></a></span><span>
</span><span id="line-4012"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Value</span></a></span><span>
</span><span id="line-4013"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4014"></span><span id="posAndNegFromCardanoValue"><span class="annot"><span class="annottext">posAndNegFromCardanoValue :: Value -&gt; (TokenBundle, TokenBundle)
</span><a href="Cardano.Wallet.html#posAndNegFromCardanoValue"><span class="hs-identifier hs-var hs-var">posAndNegFromCardanoValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AssetId, Quantity) -&gt; (TokenBundle, TokenBundle))
-&gt; [(AssetId, Quantity)] -&gt; (TokenBundle, TokenBundle)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetId, Quantity) -&gt; (TokenBundle, TokenBundle)
</span><a href="#local-6989586621682460580"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, Quantity)] -&gt; (TokenBundle, TokenBundle))
-&gt; (Value -&gt; [(AssetId, Quantity)])
-&gt; Value
-&gt; (TokenBundle, TokenBundle)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.valueToList</span></a></span><span>
</span><span id="line-4015"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4016"></span><span>    </span><span class="annot"><a href="#local-6989586621682460580"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AssetId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Quantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4017"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4018"></span><span>    </span><span id="local-6989586621682460580"><span class="annot"><span class="annottext">go :: (AssetId, Quantity) -&gt; (TokenBundle, TokenBundle)
</span><a href="#local-6989586621682460580"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.AdaAssetId</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460577"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682460577"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; (Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle)
</span><a href="#local-6989586621682460576"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682460577"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle))
-&gt; (Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4019"></span><span>        </span><span class="annot"><span class="annottext">Coin -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#fromCoin"><span class="hs-identifier hs-var">TokenBundle.fromCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TokenBundle)
-&gt; (Natural -&gt; Coin) -&gt; Natural -&gt; TokenBundle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#fromNatural"><span class="hs-identifier hs-var">Coin.fromNatural</span></a></span><span>
</span><span id="line-4020"></span><span>    </span><span class="annot"><a href="#local-6989586621682460580"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.AssetId</span></a></span><span> </span><span id="local-6989586621682460572"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621682460572"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span id="local-6989586621682460571"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621682460571"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460570"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682460570"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; (Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle)
</span><a href="#local-6989586621682460576"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682460570"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle))
-&gt; (Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682460569"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682460569"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4021"></span><span>        </span><span class="annot"><span class="annottext">Coin -&gt; [(AssetId, TokenQuantity)] -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#fromFlatList"><span class="hs-identifier hs-var">TokenBundle.fromFlatList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-4022"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-var">TokenBundle.AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; TokenPolicyId
</span><a href="#local-6989586621682460566"><span class="hs-identifier hs-var">mkPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621682460572"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName -&gt; TokenName
</span><a href="#local-6989586621682460565"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621682460571"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4023"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; TokenQuantity
</span><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier hs-var">TokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682460569"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-4024"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-4025"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4026"></span><span>
</span><span id="line-4027"></span><span>    </span><span class="hs-comment">-- | Convert a 'Cardano.Quantity' to a 'TokenBundle' using the supplied</span><span>
</span><span id="line-4028"></span><span>    </span><span class="hs-comment">-- function. The result is stored in 'fst' for positive quantities, and</span><span>
</span><span id="line-4029"></span><span>    </span><span class="hs-comment">-- 'snd' for negative quantities.</span><span>
</span><span id="line-4030"></span><span>    </span><span class="annot"><a href="#local-6989586621682460576"><span class="hs-identifier hs-type">partition</span></a></span><span>
</span><span id="line-4031"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Quantity</span></a></span><span>
</span><span id="line-4032"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4033"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4034"></span><span>    </span><span id="local-6989586621682460576"><span class="annot"><span class="annottext">partition :: Quantity -&gt; (Natural -&gt; TokenBundle) -&gt; (TokenBundle, TokenBundle)
</span><a href="#local-6989586621682460576"><span class="hs-identifier hs-var hs-var">partition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Quantity</span></a></span><span> </span><span id="local-6989586621682460563"><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682460563"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682460562"><span class="annot"><span class="annottext">Natural -&gt; TokenBundle
</span><a href="#local-6989586621682460562"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-4035"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682460561"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682460561"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; Maybe Natural
</span><a href="#local-6989586621682460560"><span class="hs-identifier hs-var">maybeIntegerToNatural</span></a></span><span>      </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682460563"><span class="hs-identifier hs-var">i</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; TokenBundle
</span><a href="#local-6989586621682460562"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682460561"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenBundle
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4036"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682460559"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682460559"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BlockHeight -&gt; Maybe Natural
</span><a href="#local-6989586621682460560"><span class="hs-identifier hs-var">maybeIntegerToNatural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeight -&gt; BlockHeight
forall a. Num a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">abs</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeight
</span><a href="#local-6989586621682460563"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; TokenBundle
</span><a href="#local-6989586621682460562"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682460559"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4037"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenBundle
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4038"></span><span>
</span><span id="line-4039"></span><span>    </span><span id="local-6989586621682460560"><span class="annot"><span class="annottext">maybeIntegerToNatural :: BlockHeight -&gt; Maybe Natural
</span><a href="#local-6989586621682460560"><span class="hs-identifier hs-var hs-var">maybeIntegerToNatural</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integral BlockHeight, Integral Natural, Bits BlockHeight,
 Bits Natural) =&gt;
BlockHeight -&gt; Maybe Natural
forall a b.
(Integral a, Integral b, Bits a, Bits b) =&gt;
a -&gt; Maybe b
</span><a href="../../../../int-cast/html/src"><span class="hs-identifier hs-var">intCastMaybe</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4040"></span><span>
</span><span id="line-4041"></span><span>    </span><span id="local-6989586621682460566"><span class="annot"><span class="annottext">mkPolicyId :: PolicyId -&gt; TokenPolicyId
</span><a href="#local-6989586621682460566"><span class="hs-identifier hs-var hs-var">mkPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#UnsafeTokenPolicyId"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; (PolicyId -&gt; Hash &quot;TokenPolicy&quot;) -&gt; PolicyId -&gt; TokenPolicyId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). ByteString -&gt; Hash tag
</span><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Hash &quot;TokenPolicy&quot;)
-&gt; (PolicyId -&gt; ByteString) -&gt; PolicyId -&gt; Hash &quot;TokenPolicy&quot;
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.serialiseToRawBytes</span></a></span><span>
</span><span id="line-4042"></span><span>    </span><span id="local-6989586621682460565"><span class="annot"><span class="annottext">mkTokenName :: AssetName -&gt; TokenName
</span><a href="#local-6989586621682460565"><span class="hs-identifier hs-var hs-var">mkTokenName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TokenName
</span><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#UnsafeTokenName"><span class="hs-identifier hs-var">UnsafeTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; TokenName)
-&gt; (AssetName -&gt; ByteString) -&gt; AssetName -&gt; TokenName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.serialiseToRawBytes</span></a></span><span>
</span><span id="line-4043"></span></pre></body></html>