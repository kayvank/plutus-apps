<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">{- |
 Copyright: &#169; 2018-2022 IOHK
 License: Apache-2.0

Pure model for the transactions ('Tx') and metadata about them ('TxMeta')
in a collection of wallets.

-}</span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.DB.Store.Wallets.Model</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier">DeltaTxWalletsHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#TxWalletsHistory"><span class="hs-identifier">TxWalletsHistory</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#walletsLinkedTransactions"><span class="hs-identifier">walletsLinkedTransactions</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#mkTransactionInfo"><span class="hs-identifier">mkTransactionInfo</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html"><span class="hs-identifier">Cardano.Wallet.DB.Sqlite.Schema</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateral"><span class="hs-identifier">TxCollateral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOut"><span class="hs-identifier">TxCollateralOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxCollateralOutToken"><span class="hs-identifier">TxCollateralOutToken</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxIn"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMeta"><span class="hs-identifier">TxMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOut"><span class="hs-identifier">TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxOutToken"><span class="hs-identifier">TxOutToken</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxWithdrawal"><span class="hs-identifier">TxWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html"><span class="hs-identifier">Cardano.Wallet.DB.Sqlite.Types</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#getTxId"><span class="hs-identifier">getTxId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Meta.Model</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#DeltaTxMetaHistory"><span class="hs-identifier">DeltaTxMetaHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#ManipulateTxMetaHistory"><span class="hs-identifier">ManipulateTxMetaHistory</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier">TxMetaHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#mkTxMetaHistory"><span class="hs-identifier">mkTxMetaHistory</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Transactions.Model</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Decoration"><span class="hs-identifier">Decoration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier">With</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier">TxHistory</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier">TxHistory</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier">TxHistoryF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier">TxRelationF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier">WithTxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier">mkTxHistory</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Slotting</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier">TimeInterpreter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier">interpretQuery</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier">slotToUTCTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier">AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier">AssetId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier">TxMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier">TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.Delta</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Delta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.DeltaMap</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">DeltaMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Adjust</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Insert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">toList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;&amp;&gt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Quantity.html"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">Buildable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">build</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html"><span class="hs-identifier">Cardano.Wallet.DB.Sqlite.Schema</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DB</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Meta.Model</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TxMetaStore</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html"><span class="hs-identifier">Cardano.Wallet.DB.Store.Transactions.Model</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TxStore</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WC</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenBundle</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WT</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Verbs to change transactions store and wallet-indexed meta stores.</span><span>
</span><span id="line-90"></span><span class="hs-keyword">data</span><span> </span><span id="DeltaTxWalletsHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier hs-var">DeltaTxWalletsHistory</span></a></span></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ExpandTxWalletsHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#ExpandTxWalletsHistory"><span class="hs-identifier hs-var">ExpandTxWalletsHistory</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">WT.Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">WT.TxMeta</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- ^ Add transactions and meta for a wallet.</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ChangeTxMetaWalletsHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#ChangeTxMetaWalletsHistory"><span class="hs-identifier hs-var">ChangeTxMetaWalletsHistory</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#ManipulateTxMetaHistory"><span class="hs-identifier hs-type">ManipulateTxMetaHistory</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-comment">-- ^ Change metas for a wallet.</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="GarbageCollectTxWalletsHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#GarbageCollectTxWalletsHistory"><span class="hs-identifier hs-var">GarbageCollectTxWalletsHistory</span></a></span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-comment">-- ^ Delete all transactions that have no metas.</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RemoveWallet"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#RemoveWallet"><span class="hs-identifier hs-var">RemoveWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- ^ Remove all metas of a wallet.</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621682458037"><span id="local-6989586621682458039"><span id="local-6989586621682458041"><span class="annot"><span class="annottext">Int -&gt; DeltaTxWalletsHistory -&gt; ShowS
[DeltaTxWalletsHistory] -&gt; ShowS
DeltaTxWalletsHistory -&gt; String
(Int -&gt; DeltaTxWalletsHistory -&gt; ShowS)
-&gt; (DeltaTxWalletsHistory -&gt; String)
-&gt; ([DeltaTxWalletsHistory] -&gt; ShowS)
-&gt; Show DeltaTxWalletsHistory
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DeltaTxWalletsHistory] -&gt; ShowS
$cshowList :: [DeltaTxWalletsHistory] -&gt; ShowS
show :: DeltaTxWalletsHistory -&gt; String
$cshow :: DeltaTxWalletsHistory -&gt; String
showsPrec :: Int -&gt; DeltaTxWalletsHistory -&gt; ShowS
$cshowsPrec :: Int -&gt; DeltaTxWalletsHistory -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682458032"><span id="local-6989586621682458034"><span class="annot"><span class="annottext">DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool
(DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool)
-&gt; (DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool)
-&gt; Eq DeltaTxWalletsHistory
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool
$c/= :: DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool
== :: DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool
$c== :: DeltaTxWalletsHistory -&gt; DeltaTxWalletsHistory -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier hs-type">DeltaTxWalletsHistory</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621682458028"><span class="annot"><span class="annottext">build :: DeltaTxWalletsHistory -&gt; Builder
</span><a href="#local-6989586621682458028"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Builder)
-&gt; (DeltaTxWalletsHistory -&gt; String)
-&gt; DeltaTxWalletsHistory
-&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaTxWalletsHistory -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Transactions history is a shared transactions store together with</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- a set of meta-transactions stores indexed by wallet.</span><span>
</span><span id="line-106"></span><span class="hs-keyword">type</span><span> </span><span id="TxWalletsHistory"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#TxWalletsHistory"><span class="hs-identifier hs-var">TxWalletsHistory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistory"><span class="hs-identifier hs-type">TxHistory</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier hs-type">DeltaTxWalletsHistory</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#DeltaTxWalletsHistory"><span class="hs-identifier hs-type">DeltaTxWalletsHistory</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#TxWalletsHistory"><span class="hs-identifier hs-type">TxWalletsHistory</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621682458023"><span class="annot"><span class="annottext">apply :: DeltaTxWalletsHistory
-&gt; Base DeltaTxWalletsHistory -&gt; Base DeltaTxWalletsHistory
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">apply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#ExpandTxWalletsHistory"><span class="hs-identifier hs-type">ExpandTxWalletsHistory</span></a></span><span> </span><span id="local-6989586621682458021"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458021"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682458020"><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458020"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682458019"><span class="annot"><a href="#local-6989586621682458019"><span class="hs-identifier hs-var">txh</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682458018"><span class="annot"><a href="#local-6989586621682458018"><span class="hs-identifier hs-var">mtxmh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">DeltaTxHistory -&gt; Base DeltaTxHistory -&gt; Base DeltaTxHistory
forall delta. Delta delta =&gt; delta -&gt; Base delta -&gt; Base delta
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxHistory -&gt; DeltaTxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#Append"><span class="hs-identifier hs-var">TxStore.Append</span></a></span><span> </span><span class="annot"><span class="annottext">(TxHistory -&gt; DeltaTxHistory) -&gt; TxHistory -&gt; DeltaTxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Tx] -&gt; TxHistory
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#mkTxHistory"><span class="hs-identifier hs-var">mkTxHistory</span></a></span><span> </span><span class="annot"><span class="annottext">([Tx] -&gt; TxHistory) -&gt; [Tx] -&gt; TxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx, TxMeta) -&gt; Tx
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Tx, TxMeta) -&gt; Tx) -&gt; [(Tx, TxMeta)] -&gt; [Tx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458020"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Base DeltaTxHistory
TxHistory
</span><a href="#local-6989586621682458019"><span class="hs-identifier hs-var">txh</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458018"><span class="hs-identifier hs-var">mtxmh</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
-&gt; (Map WalletId TxMetaHistory -&gt; Map WalletId TxMetaHistory)
-&gt; Map WalletId TxMetaHistory
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Map WalletId TxMetaHistory -&gt; Maybe TxMetaHistory
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458021"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458018"><span class="hs-identifier hs-var">mtxmh</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>              </span><span class="annot"><span class="annottext">Maybe TxMetaHistory
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Delta (DeltaMap WalletId DeltaTxMetaHistory) =&gt;
DeltaMap WalletId DeltaTxMetaHistory
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
forall delta. Delta delta =&gt; delta -&gt; Base delta -&gt; Base delta
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">DeltaMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#DeltaTxMetaHistory"><span class="hs-identifier hs-type">DeltaTxMetaHistory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                  </span><span class="annot"><span class="annottext">(DeltaMap WalletId DeltaTxMetaHistory
 -&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
 -&gt; Base (DeltaMap WalletId DeltaTxMetaHistory))
-&gt; DeltaMap WalletId DeltaTxMetaHistory
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; Base DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; Base da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Insert</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458021"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-115"></span><span>                  </span><span class="annot"><span class="annottext">(Base DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; [(Tx, TxMeta)] -&gt; TxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#mkTxMetaHistory"><span class="hs-identifier hs-var">mkTxMetaHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458021"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458020"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-116"></span><span>              </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetaHistory
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Delta (DeltaMap WalletId DeltaTxMetaHistory) =&gt;
DeltaMap WalletId DeltaTxMetaHistory
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
forall delta. Delta delta =&gt; delta -&gt; Base delta -&gt; Base delta
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">DeltaMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#DeltaTxMetaHistory"><span class="hs-identifier hs-type">DeltaTxMetaHistory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>                  </span><span class="annot"><span class="annottext">(DeltaMap WalletId DeltaTxMetaHistory
 -&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
 -&gt; Base (DeltaMap WalletId DeltaTxMetaHistory))
-&gt; DeltaMap WalletId DeltaTxMetaHistory
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Adjust</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458021"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-118"></span><span>                  </span><span class="annot"><span class="annottext">(DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetaHistory -&gt; DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#Expand"><span class="hs-identifier hs-var">TxMetaStore.Expand</span></a></span><span>
</span><span id="line-119"></span><span>                  </span><span class="annot"><span class="annottext">(TxMetaHistory -&gt; DeltaTxMetaHistory)
-&gt; TxMetaHistory -&gt; DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; [(Tx, TxMeta)] -&gt; TxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#mkTxMetaHistory"><span class="hs-identifier hs-var">mkTxMetaHistory</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458021"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tx, TxMeta)]
</span><a href="#local-6989586621682458020"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#ChangeTxMetaWalletsHistory"><span class="hs-identifier hs-type">ChangeTxMetaWalletsHistory</span></a></span><span> </span><span id="local-6989586621682458013"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458013"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682458012"><span class="annot"><span class="annottext">ManipulateTxMetaHistory
</span><a href="#local-6989586621682458012"><span class="hs-identifier hs-var">change</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682458011"><span class="annot"><a href="#local-6989586621682458011"><span class="hs-identifier hs-var">txh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682458010"><span class="annot"><a href="#local-6989586621682458010"><span class="hs-identifier hs-var">mtxmh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxHistory
</span><a href="#local-6989586621682458011"><span class="hs-identifier hs-var">txh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory -&gt; Map WalletId TxMetaHistory
forall k. Map k TxMetaHistory -&gt; Map k TxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#garbageCollectEmptyWallets"><span class="hs-identifier hs-var">garbageCollectEmptyWallets</span></a></span><span>
</span><span id="line-122"></span><span>            </span><span class="annot"><span class="annottext">(Map WalletId TxMetaHistory -&gt; Map WalletId TxMetaHistory)
-&gt; Map WalletId TxMetaHistory -&gt; Map WalletId TxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458010"><span class="hs-identifier hs-var">mtxmh</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
-&gt; (Map WalletId TxMetaHistory -&gt; Map WalletId TxMetaHistory)
-&gt; Map WalletId TxMetaHistory
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaMap WalletId DeltaTxMetaHistory
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
-&gt; Base (DeltaMap WalletId DeltaTxMetaHistory)
forall delta. Delta delta =&gt; delta -&gt; Base delta -&gt; Base delta
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall key da. key -&gt; da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Adjust</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458013"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory)
-&gt; DeltaTxMetaHistory -&gt; DeltaMap WalletId DeltaTxMetaHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ManipulateTxMetaHistory -&gt; DeltaTxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#Manipulate"><span class="hs-identifier hs-var">Manipulate</span></a></span><span> </span><span class="annot"><span class="annottext">ManipulateTxMetaHistory
</span><a href="#local-6989586621682458012"><span class="hs-identifier hs-var">change</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">DeltaTxWalletsHistory
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#GarbageCollectTxWalletsHistory"><span class="hs-identifier hs-var">GarbageCollectTxWalletsHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682458006"><span class="annot"><a href="#local-6989586621682458006"><span class="hs-identifier hs-var">txh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682458005"><span class="annot"><a href="#local-6989586621682458005"><span class="hs-identifier hs-var">mtxmh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId (TxRelationF 'Without) -&gt; TxHistory)
-&gt; Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
-&gt; Set TxId -&gt; Map TxId (TxRelationF 'Without)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.restrictKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682458006"><span class="hs-identifier hs-var">txh</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TxId -&gt; Map TxId (TxRelationF 'Without))
-&gt; Set TxId -&gt; Map TxId (TxRelationF 'Without)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory -&gt; Set TxId
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#walletsLinkedTransactions"><span class="hs-identifier hs-var">walletsLinkedTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458005"><span class="hs-identifier hs-var">mtxmh</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458005"><span class="hs-identifier hs-var">mtxmh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#RemoveWallet"><span class="hs-identifier hs-type">RemoveWallet</span></a></span><span> </span><span id="local-6989586621682458003"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458003"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-type">TxHistoryF</span></a></span><span> </span><span id="local-6989586621682458002"><span class="annot"><a href="#local-6989586621682458002"><span class="hs-identifier hs-var">txh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682458001"><span class="annot"><a href="#local-6989586621682458001"><span class="hs-identifier hs-var">mtxmh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without) -&gt; TxHistory
forall (f :: Decoration). Map TxId (TxRelationF f) -&gt; TxHistoryF f
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxHistoryF"><span class="hs-identifier hs-var">TxHistoryF</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId (TxRelationF 'Without)
</span><a href="#local-6989586621682458002"><span class="hs-identifier hs-var">txh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; Map WalletId TxMetaHistory -&gt; Map WalletId TxMetaHistory
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.delete</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682458003"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId TxMetaHistory
</span><a href="#local-6989586621682458001"><span class="hs-identifier hs-var">mtxmh</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- necessary because database will not distinuish between</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- a missing wallet in the map</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- and a wallet that has no meta-transactions</span><span>
</span><span id="line-132"></span><span id="local-6989586621682458143"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#garbageCollectEmptyWallets"><span class="hs-identifier hs-type">garbageCollectEmptyWallets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682458143"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682458143"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span></span><span>
</span><span id="line-133"></span><span id="garbageCollectEmptyWallets"><span class="annot"><span class="annottext">garbageCollectEmptyWallets :: Map k TxMetaHistory -&gt; Map k TxMetaHistory
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#garbageCollectEmptyWallets"><span class="hs-identifier hs-var hs-var">garbageCollectEmptyWallets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxMetaHistory -&gt; Bool)
-&gt; Map k TxMetaHistory -&gt; Map k TxMetaHistory
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (TxMetaHistory -&gt; Bool) -&gt; TxMetaHistory -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId TxMeta -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId TxMeta -&gt; Bool)
-&gt; (TxMetaHistory -&gt; Map TxId TxMeta) -&gt; TxMetaHistory -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetaHistory -&gt; Map TxId TxMeta
</span><a href="Cardano.Wallet.DB.Store.Meta.Model.html#relations"><span class="hs-identifier hs-var hs-var">relations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#linkedTransactions"><span class="hs-identifier hs-type">linkedTransactions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-136"></span><span id="linkedTransactions"><span class="annot"><span class="annottext">linkedTransactions :: TxMetaHistory -&gt; Set TxId
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#linkedTransactions"><span class="hs-identifier hs-var hs-var">linkedTransactions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span><span> </span><span id="local-6989586621682457993"><span class="annot"><span class="annottext">Map TxId TxMeta
</span><a href="#local-6989586621682457993"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxId TxMeta -&gt; Set TxId
forall k a. Map k a -&gt; Set k
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId TxMeta
</span><a href="#local-6989586621682457993"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#walletsLinkedTransactions"><span class="hs-identifier hs-type">walletsLinkedTransactions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">W.WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Meta.Model.html#TxMetaHistory"><span class="hs-identifier hs-type">TxMetaHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Types.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-139"></span><span id="walletsLinkedTransactions"><span class="annot"><span class="annottext">walletsLinkedTransactions :: Map WalletId TxMetaHistory -&gt; Set TxId
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#walletsLinkedTransactions"><span class="hs-identifier hs-var hs-var">walletsLinkedTransactions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set TxId] -&gt; Set TxId
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.unions</span></a></span><span> </span><span class="annot"><span class="annottext">([Set TxId] -&gt; Set TxId)
-&gt; (Map WalletId TxMetaHistory -&gt; [Set TxId])
-&gt; Map WalletId TxMetaHistory
-&gt; Set TxId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId (Set TxId) -&gt; [Set TxId]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map WalletId (Set TxId) -&gt; [Set TxId])
-&gt; (Map WalletId TxMetaHistory -&gt; Map WalletId (Set TxId))
-&gt; Map WalletId TxMetaHistory
-&gt; [Set TxId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>  </span><span class="annot"><span class="annottext">(TxMetaHistory -&gt; Set TxId)
-&gt; Map WalletId TxMetaHistory -&gt; Map WalletId (Set TxId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetaHistory -&gt; Set TxId
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#linkedTransactions"><span class="hs-identifier hs-var">linkedTransactions</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Compute a high level view of a transaction known as 'TransactionInfo'</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- from a 'TxMeta' and a 'TxRelationF'.</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- Assumes that these data refer to the same 'TxId', does /not/ check this.</span><span>
</span><span id="line-144"></span><span id="local-6989586621682457990"><span class="annot"><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#mkTransactionInfo"><span class="hs-identifier hs-type">mkTransactionInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457990"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682457990"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">W.BlockHeader</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#With"><span class="hs-identifier hs-type">With</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMeta"><span class="hs-identifier hs-type">DB.TxMeta</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682457990"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">WT.TransactionInfo</span></a></span></span><span>
</span><span id="line-150"></span><span id="mkTransactionInfo"><span class="annot"><span class="annottext">mkTransactionInfo :: TimeInterpreter m
-&gt; BlockHeader -&gt; TxRelationF 'With -&gt; TxMeta -&gt; m TransactionInfo
</span><a href="Cardano.Wallet.DB.Store.Wallets.Model.html#mkTransactionInfo"><span class="hs-identifier hs-var hs-var">mkTransactionInfo</span></a></span></span><span> </span><span id="local-6989586621682457989"><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682457989"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682457988"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682457988"><span class="hs-identifier hs-var">tip</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#TxRelationF"><span class="hs-identifier hs-type">TxRelationF</span></a></span><span class="hs-special">{</span><span id="local-6989586621682457982"><span id="local-6989586621682457983"><span id="local-6989586621682457984"><span id="local-6989586621682457985"><span id="local-6989586621682457986"><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
[TxWithdrawal]
[DecorateWithTxOut 'With TxCollateral]
[DecorateWithTxOut 'With TxIn]
Maybe (TxCollateralOut, [TxCollateralOutToken])
$sel:withdrawals:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [TxWithdrawal]
$sel:collateralOuts:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; Maybe (TxCollateralOut, [TxCollateralOutToken])
$sel:outs:TxRelationF :: forall (f :: Decoration). TxRelationF f -&gt; [(TxOut, [TxOutToken])]
$sel:collateralIns:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxCollateral]
$sel:ins:TxRelationF :: forall (f :: Decoration).
TxRelationF f -&gt; [DecorateWithTxOut f TxIn]
withdrawals :: [TxWithdrawal]
collateralOuts :: Maybe (TxCollateralOut, [TxCollateralOutToken])
outs :: [(TxOut, [TxOutToken])]
collateralIns :: [DecorateWithTxOut 'With TxCollateral]
ins :: [DecorateWithTxOut 'With TxIn]
</span><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#%24sel%3Awithdrawals%3ATxRelationF"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.Sqlite.Schema.html#TxMeta"><span class="hs-identifier hs-type">DB.TxMeta</span></a></span><span class="hs-special">{</span><span id="local-6989586621682457965"><span id="local-6989586621682457966"><span id="local-6989586621682457967"><span id="local-6989586621682457968"><span id="local-6989586621682457969"><span id="local-6989586621682457970"><span id="local-6989586621682457971"><span id="local-6989586621682457972"><span id="local-6989586621682457973"><span id="local-6989586621682457974"><span id="local-6989586621682457975"><span class="annot"><span class="annottext">Maybe Bool
Maybe Word64
Maybe TxMetadata
Maybe SlotNo
Word32
SlotNo
Coin
Direction
TxStatus
WalletId
TxId
txMetaScriptValidity :: TxMeta -&gt; Maybe Bool
txMetaFee :: TxMeta -&gt; Maybe Word64
txMetaSlotExpires :: TxMeta -&gt; Maybe SlotNo
txMetadata :: TxMeta -&gt; Maybe TxMetadata
txMetaAmount :: TxMeta -&gt; Coin
txMetaBlockHeight :: TxMeta -&gt; Word32
txMetaSlot :: TxMeta -&gt; SlotNo
txMetaDirection :: TxMeta -&gt; Direction
txMetaStatus :: TxMeta -&gt; TxStatus
txMetaWalletId :: TxMeta -&gt; WalletId
txMetaTxId :: TxMeta -&gt; TxId
txMetaScriptValidity :: Maybe Bool
txMetaFee :: Maybe Word64
txMetaSlotExpires :: Maybe SlotNo
txMetadata :: Maybe TxMetadata
txMetaAmount :: Coin
txMetaBlockHeight :: Word32
txMetaSlot :: SlotNo
txMetaDirection :: Direction
txMetaStatus :: TxStatus
txMetaWalletId :: WalletId
txMetaTxId :: TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txMetaScriptValidity"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621682457953"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682457953"><span class="hs-identifier hs-var">txTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; Qry UTCTime -&gt; m UTCTime
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682457989"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry UTCTime -&gt; m UTCTime)
-&gt; (SlotNo -&gt; Qry UTCTime) -&gt; SlotNo -&gt; m UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Qry UTCTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier hs-var">slotToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; m UTCTime) -&gt; SlotNo -&gt; m UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682457971"><span class="hs-identifier hs-var">txMetaSlot</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">TransactionInfo -&gt; m TransactionInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="annottext">(TransactionInfo -&gt; m TransactionInfo)
-&gt; TransactionInfo -&gt; m TransactionInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo :: Hash &quot;Tx&quot;
-&gt; Maybe Coin
-&gt; [(TxIn, Coin, Maybe TxOut)]
-&gt; [(TxIn, Coin, Maybe TxOut)]
-&gt; [TxOut]
-&gt; Maybe TxOut
-&gt; Map RewardAccount Coin
-&gt; TxMeta
-&gt; Quantity &quot;block&quot; Natural
-&gt; UTCTime
-&gt; Maybe TxMetadata
-&gt; Maybe TxScriptValidity
-&gt; TransactionInfo
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">WT.TransactionInfo</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoId:TransactionInfo :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoId%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#getTxId"><span class="hs-identifier hs-var hs-var">getTxId</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621682457975"><span class="hs-identifier hs-var">txMetaTxId</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoFee:TransactionInfo :: Maybe Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoFee%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">WC.Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Coin) -&gt; (Word64 -&gt; Natural) -&gt; Word64 -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Coin) -&gt; Maybe Word64 -&gt; Maybe Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Word64
</span><a href="#local-6989586621682457966"><span class="hs-identifier hs-var">txMetaFee</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoInputs:TransactionInfo :: [(TxIn, Coin, Maybe TxOut)]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoInputs%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WithTxOut TxIn -&gt; (TxIn, Coin, Maybe TxOut)
</span><a href="#local-6989586621682457947"><span class="hs-identifier hs-var">mkTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">(WithTxOut TxIn -&gt; (TxIn, Coin, Maybe TxOut))
-&gt; [WithTxOut TxIn] -&gt; [(TxIn, Coin, Maybe TxOut)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[DecorateWithTxOut 'With TxIn]
[WithTxOut TxIn]
</span><a href="#local-6989586621682457986"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoCollateralInputs:TransactionInfo :: [(TxIn, Coin, Maybe TxOut)]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoCollateralInputs%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoCollateralInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WithTxOut TxCollateral -&gt; (TxIn, Coin, Maybe TxOut)
</span><a href="#local-6989586621682457945"><span class="hs-identifier hs-var">mkTxCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">(WithTxOut TxCollateral -&gt; (TxIn, Coin, Maybe TxOut))
-&gt; [WithTxOut TxCollateral] -&gt; [(TxIn, Coin, Maybe TxOut)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[DecorateWithTxOut 'With TxCollateral]
[WithTxOut TxCollateral]
</span><a href="#local-6989586621682457985"><span class="hs-identifier hs-var">collateralIns</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoOutputs:TransactionInfo :: [TxOut]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoOutputs%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOut, [TxOutToken]) -&gt; TxOut
</span><a href="#local-6989586621682457943"><span class="hs-identifier hs-var">mkTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut, [TxOutToken]) -&gt; TxOut)
-&gt; [(TxOut, [TxOutToken])] -&gt; [TxOut]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxOut, [TxOutToken])]
</span><a href="#local-6989586621682457984"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoCollateralOutput:TransactionInfo :: Maybe TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoCollateralOutput%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoCollateralOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxCollateralOut, [TxCollateralOutToken]) -&gt; TxOut
</span><a href="#local-6989586621682457941"><span class="hs-identifier hs-var">mkTxCollateralOut</span></a></span><span> </span><span class="annot"><span class="annottext">((TxCollateralOut, [TxCollateralOutToken]) -&gt; TxOut)
-&gt; Maybe (TxCollateralOut, [TxCollateralOutToken]) -&gt; Maybe TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TxCollateralOut, [TxCollateralOutToken])
</span><a href="#local-6989586621682457983"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoWithdrawals:TransactionInfo :: Map RewardAccount Coin
</span><a href="#local-6989586621682457940"><span class="hs-identifier hs-var">WT.txInfoWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(RewardAccount, Coin)] -&gt; Map RewardAccount Coin
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(RewardAccount, Coin)] -&gt; Map RewardAccount Coin)
-&gt; [(RewardAccount, Coin)] -&gt; Map RewardAccount Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxWithdrawal -&gt; (RewardAccount, Coin))
-&gt; [TxWithdrawal] -&gt; [(RewardAccount, Coin)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawal -&gt; (RewardAccount, Coin)
</span><a href="#local-6989586621682457938"><span class="hs-identifier hs-var">mkTxWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">[TxWithdrawal]
</span><a href="#local-6989586621682457982"><span class="hs-identifier hs-var">withdrawals</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoMeta:TransactionInfo :: TxMeta
</span><a href="#local-6989586621682457937"><span class="hs-identifier hs-var">WT.txInfoMeta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMeta :: TxStatus
-&gt; Direction
-&gt; SlotNo
-&gt; Quantity &quot;block&quot; Word32
-&gt; Coin
-&gt; Maybe SlotNo
-&gt; TxMeta
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">WT.TxMeta</span></a></span><span>
</span><span id="line-162"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:status:TxMeta :: TxStatus
</span><a href="#local-6989586621682457935"><span class="hs-identifier hs-var">WT.status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="#local-6989586621682457973"><span class="hs-identifier hs-var">txMetaStatus</span></a></span><span>
</span><span id="line-163"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:direction:TxMeta :: Direction
</span><a href="#local-6989586621682457934"><span class="hs-identifier hs-var">WT.direction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621682457972"><span class="hs-identifier hs-var">txMetaDirection</span></a></span><span>
</span><span id="line-164"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slotNo:TxMeta :: SlotNo
</span><a href="#local-6989586621682457933"><span class="hs-identifier hs-var">WT.slotNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682457971"><span class="hs-identifier hs-var">txMetaSlot</span></a></span><span>
</span><span id="line-165"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockHeight:TxMeta :: Quantity &quot;block&quot; Word32
</span><a href="#local-6989586621682457932"><span class="hs-identifier hs-var">WT.blockHeight</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Quantity &quot;block&quot; Word32
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457970"><span class="hs-identifier hs-var">txMetaBlockHeight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:TxMeta :: Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aamount%3ATxMeta"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682457969"><span class="hs-identifier hs-var">txMetaAmount</span></a></span><span>
</span><span id="line-167"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:expiry:TxMeta :: Maybe SlotNo
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aexpiry%3ATxMeta"><span class="hs-identifier hs-var">WT.expiry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621682457967"><span class="hs-identifier hs-var">txMetaSlotExpires</span></a></span><span>
</span><span id="line-168"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoMetadata:TransactionInfo :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoMetadata%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682457968"><span class="hs-identifier hs-var">txMetadata</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoDepth:TransactionInfo :: Quantity &quot;block&quot; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoDepth%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoDepth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;block&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span>
</span><span id="line-171"></span><span>              </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;block&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;block&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span>
</span><span id="line-172"></span><span>              </span><span class="annot"><span class="annottext">(Word32 -&gt; Natural) -&gt; Word32 -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457926"><span class="hs-identifier hs-var">tipH</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457970"><span class="hs-identifier hs-var">txMetaBlockHeight</span></a></span><span>
</span><span id="line-173"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457926"><span class="hs-identifier hs-var">tipH</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682457970"><span class="hs-identifier hs-var">txMetaBlockHeight</span></a></span><span>
</span><span id="line-174"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoTime:TransactionInfo :: UTCTime
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoTime%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682457953"><span class="hs-identifier hs-var">txTime</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInfoScriptValidity:TransactionInfo :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxInfoScriptValidity%3ATransactionInfo"><span class="hs-identifier hs-var">WT.txInfoScriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682457965"><span class="hs-identifier hs-var">txMetaScriptValidity</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; (Bool -&gt; TxScriptValidity) -&gt; Maybe TxScriptValidity
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-177"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxScriptInvalid"><span class="hs-identifier hs-var">WT.TxScriptInvalid</span></a></span><span>
</span><span id="line-178"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxScriptValid"><span class="hs-identifier hs-var">WT.TxScriptValid</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621682457926"><span class="annot"><span class="annottext">tipH :: Word32
</span><a href="#local-6989586621682457926"><span class="hs-identifier hs-var hs-var">tipH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Word32 -&gt; Word32
forall (unit :: Symbol) a. Quantity unit a -&gt; a
</span><a href="Data.Quantity.html#getQuantity"><span class="hs-identifier hs-var hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity &quot;block&quot; Word32 -&gt; Word32)
-&gt; Quantity &quot;block&quot; Word32 -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682457988"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
-&gt; Quantity &quot;block&quot; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
   -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
(Quantity &quot;block&quot; Word32
 -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader
</span><a href="#local-6989586621682457919"><span class="hs-var">#blockHeight</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621682457947"><span class="annot"><span class="annottext">mkTxIn :: WithTxOut TxIn -&gt; (TxIn, Coin, Maybe TxOut)
</span><a href="#local-6989586621682457947"><span class="hs-identifier hs-var hs-var">mkTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-type">WithTxOut</span></a></span><span> </span><span id="local-6989586621682457917"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457917"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621682457916"><span class="annot"><span class="annottext">Maybe (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457916"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn :: Hash &quot;Tx&quot; -&gt; Word32 -&gt; TxIn
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">WT.TxIn</span></a></span><span>
</span><span id="line-184"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:inputId:TxIn :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputId%3ATxIn"><span class="hs-identifier hs-var">WT.inputId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#getTxId"><span class="hs-identifier hs-var hs-var">getTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceTxId"><span class="hs-identifier hs-var hs-var">txInputSourceTxId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457917"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:inputIx:TxIn :: Word32
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputIx%3ATxIn"><span class="hs-identifier hs-var">WT.inputIx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceIndex"><span class="hs-identifier hs-var hs-var">txInputSourceIndex</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457917"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txInputSourceAmount"><span class="hs-identifier hs-var hs-var">txInputSourceAmount</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682457917"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxOut, [TxOutToken]) -&gt; TxOut
</span><a href="#local-6989586621682457943"><span class="hs-identifier hs-var">mkTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut, [TxOutToken]) -&gt; TxOut)
-&gt; Maybe (TxOut, [TxOutToken]) -&gt; Maybe TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457916"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621682457945"><span class="annot"><span class="annottext">mkTxCollateral :: WithTxOut TxCollateral -&gt; (TxIn, Coin, Maybe TxOut)
</span><a href="#local-6989586621682457945"><span class="hs-identifier hs-var hs-var">mkTxCollateral</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.Store.Transactions.Model.html#WithTxOut"><span class="hs-identifier hs-type">WithTxOut</span></a></span><span> </span><span id="local-6989586621682457909"><span class="annot"><span class="annottext">TxCollateral
</span><a href="#local-6989586621682457909"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621682457908"><span class="annot"><span class="annottext">Maybe (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457908"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn :: Hash &quot;Tx&quot; -&gt; Word32 -&gt; TxIn
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">WT.TxIn</span></a></span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:inputId:TxIn :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputId%3ATxIn"><span class="hs-identifier hs-var">WT.inputId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.DB.Sqlite.Types.html#getTxId"><span class="hs-identifier hs-var hs-var">getTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateral -&gt; TxId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceTxId"><span class="hs-identifier hs-var hs-var">txCollateralSourceTxId</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateral
</span><a href="#local-6989586621682457909"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:inputIx:TxIn :: Word32
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AinputIx%3ATxIn"><span class="hs-identifier hs-var">WT.inputIx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCollateral -&gt; Word32
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceIndex"><span class="hs-identifier hs-var hs-var">txCollateralSourceIndex</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateral
</span><a href="#local-6989586621682457909"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxCollateral -&gt; Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralSourceAmount"><span class="hs-identifier hs-var hs-var">txCollateralSourceAmount</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateral
</span><a href="#local-6989586621682457909"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxOut, [TxOutToken]) -&gt; TxOut
</span><a href="#local-6989586621682457943"><span class="hs-identifier hs-var">mkTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut, [TxOutToken]) -&gt; TxOut)
-&gt; Maybe (TxOut, [TxOutToken]) -&gt; Maybe TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut, [TxOutToken])
</span><a href="#local-6989586621682457908"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621682457943"><span class="annot"><span class="annottext">mkTxOut :: (TxOut, [TxOutToken]) -&gt; TxOut
</span><a href="#local-6989586621682457943"><span class="hs-identifier hs-var hs-var">mkTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457904"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457904"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457903"><span class="annot"><span class="annottext">[TxOutToken]
</span><a href="#local-6989586621682457903"><span class="hs-identifier hs-var">tokens</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">TxOut :: Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">WT.TxOut</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:TxOut :: Address
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aaddress%3ATxOut"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Address
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputAddress"><span class="hs-identifier hs-var hs-var">txOutputAddress</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457904"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:TxOut :: TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Atokens%3ATxOut"><span class="hs-identifier hs-var">WT.tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; [(AssetId, TokenQuantity)] -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#fromFlatList"><span class="hs-identifier hs-var">TokenBundle.fromFlatList</span></a></span><span>
</span><span id="line-200"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutputAmount"><span class="hs-identifier hs-var hs-var">txOutputAmount</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682457904"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutToken -&gt; (AssetId, TokenQuantity)
</span><a href="#local-6989586621682457896"><span class="hs-identifier hs-var">mkTxOutToken</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutToken -&gt; (AssetId, TokenQuantity))
-&gt; [TxOutToken] -&gt; [(AssetId, TokenQuantity)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOutToken]
</span><a href="#local-6989586621682457903"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621682457896"><span class="annot"><span class="annottext">mkTxOutToken :: TxOutToken -&gt; (AssetId, TokenQuantity)
</span><a href="#local-6989586621682457896"><span class="hs-identifier hs-var hs-var">mkTxOutToken</span></a></span></span><span> </span><span id="local-6989586621682457895"><span class="annot"><span class="annottext">TxOutToken
</span><a href="#local-6989586621682457895"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-var">AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutToken -&gt; TokenPolicyId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenPolicyId"><span class="hs-identifier hs-var hs-var">txOutTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutToken
</span><a href="#local-6989586621682457895"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutToken -&gt; TokenName
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenName"><span class="hs-identifier hs-var hs-var">txOutTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutToken
</span><a href="#local-6989586621682457895"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOutToken -&gt; TokenQuantity
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txOutTokenQuantity"><span class="hs-identifier hs-var hs-var">txOutTokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutToken
</span><a href="#local-6989586621682457895"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621682457941"><span class="annot"><span class="annottext">mkTxCollateralOut :: (TxCollateralOut, [TxCollateralOutToken]) -&gt; TxOut
</span><a href="#local-6989586621682457941"><span class="hs-identifier hs-var hs-var">mkTxCollateralOut</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682457891"><span class="annot"><span class="annottext">TxCollateralOut
</span><a href="#local-6989586621682457891"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682457890"><span class="annot"><span class="annottext">[TxCollateralOutToken]
</span><a href="#local-6989586621682457890"><span class="hs-identifier hs-var">tokens</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">TxOut :: Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">WT.TxOut</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:TxOut :: Address
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aaddress%3ATxOut"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCollateralOut -&gt; Address
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutAddress"><span class="hs-identifier hs-var hs-var">txCollateralOutAddress</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOut
</span><a href="#local-6989586621682457891"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:TxOut :: TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Atokens%3ATxOut"><span class="hs-identifier hs-var">WT.tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; [(AssetId, TokenQuantity)] -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#fromFlatList"><span class="hs-identifier hs-var">TokenBundle.fromFlatList</span></a></span><span>
</span><span id="line-210"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateralOut -&gt; Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutAmount"><span class="hs-identifier hs-var hs-var">txCollateralOutAmount</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOut
</span><a href="#local-6989586621682457891"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; (AssetId, TokenQuantity)
</span><a href="#local-6989586621682457887"><span class="hs-identifier hs-var">mkTxCollateralOutToken</span></a></span><span> </span><span class="annot"><span class="annottext">(TxCollateralOutToken -&gt; (AssetId, TokenQuantity))
-&gt; [TxCollateralOutToken] -&gt; [(AssetId, TokenQuantity)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxCollateralOutToken]
</span><a href="#local-6989586621682457890"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621682457887"><span class="annot"><span class="annottext">mkTxCollateralOutToken :: TxCollateralOutToken -&gt; (AssetId, TokenQuantity)
</span><a href="#local-6989586621682457887"><span class="hs-identifier hs-var hs-var">mkTxCollateralOutToken</span></a></span></span><span> </span><span id="local-6989586621682457886"><span class="annot"><span class="annottext">TxCollateralOutToken
</span><a href="#local-6989586621682457886"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-var">AssetId</span></a></span><span>
</span><span id="line-215"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; TokenPolicyId
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenPolicyId"><span class="hs-identifier hs-var hs-var">txCollateralOutTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken
</span><a href="#local-6989586621682457886"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; TokenName
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenName"><span class="hs-identifier hs-var hs-var">txCollateralOutTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken
</span><a href="#local-6989586621682457886"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken -&gt; TokenQuantity
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txCollateralOutTokenQuantity"><span class="hs-identifier hs-var hs-var">txCollateralOutTokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TxCollateralOutToken
</span><a href="#local-6989586621682457886"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621682457938"><span class="annot"><span class="annottext">mkTxWithdrawal :: TxWithdrawal -&gt; (RewardAccount, Coin)
</span><a href="#local-6989586621682457938"><span class="hs-identifier hs-var hs-var">mkTxWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682457882"><span class="annot"><span class="annottext">TxWithdrawal
</span><a href="#local-6989586621682457882"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxWithdrawal -&gt; RewardAccount
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txWithdrawalAccount"><span class="hs-identifier hs-var hs-var">txWithdrawalAccount</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawal
</span><a href="#local-6989586621682457882"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxWithdrawal -&gt; Coin
</span><a href="Cardano.Wallet.DB.Sqlite.Schema.html#txWithdrawalAmount"><span class="hs-identifier hs-var hs-var">txWithdrawalAmount</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawal
</span><a href="#local-6989586621682457882"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span></pre></body></html>