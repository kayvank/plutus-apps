<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Copyright: &#169; 2018-2020 IOHK</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Database / Persistence layer for the wallet backend. This is where we define</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- the interface allowing us to store and fetch various data on our wallets.</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.DB</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Interface</span></span><span>
</span><span id="line-15"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier">DBLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBFactory"><span class="hs-identifier">DBFactory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#cleanDB"><span class="hs-identifier">cleanDB</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Errors</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrBadFormat"><span class="hs-identifier">ErrBadFormat</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier">ErrWalletAlreadyExists</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier">ErrNoSuchTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier">ErrRemoveTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmission"><span class="hs-identifier">ErrPutLocalTxSubmission</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Derivation</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">XPrv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html"><span class="hs-identifier">Cardano.Wallet.DB.WalletState</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">DeltaMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState"><span class="hs-identifier">DeltaWalletState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier">Depth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Model</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier">Wallet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier">PassphraseHash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ChainPoint"><span class="hs-identifier">ChainPoint</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#DelegationCertificate"><span class="hs-identifier">DelegationCertificate</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#GenesisParameters"><span class="hs-identifier">GenesisParameters</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Range"><span class="hs-identifier">Range</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier">Slot</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier">SortOrder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier">WalletId</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier">WalletMetadata</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Hash</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier">Hash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#LocalTxSubmissionStatus"><span class="hs-identifier">LocalTxSubmissionStatus</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier">SealedTx</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier">TransactionInfo</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier">Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier">TxMeta</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxStatus"><span class="hs-identifier">TxStatus</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Except</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">ExceptT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">runExceptT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.DBVar</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">DBVar</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Quantity.html"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word32</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Exception</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">-- | Instantiate database layers at will</span><span>
</span><span id="line-76"></span><span class="hs-keyword">data</span><span> </span><span id="DBFactory"><span class="annot"><a href="Cardano.Wallet.DB.html#DBFactory"><span class="hs-identifier hs-var">DBFactory</span></a></span></span><span> </span><span id="local-6989586621682460086"><span class="annot"><a href="#local-6989586621682460086"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682460085"><span class="annot"><a href="#local-6989586621682460085"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682460084"><span class="annot"><a href="#local-6989586621682460084"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DBFactory"><span class="annot"><a href="Cardano.Wallet.DB.html#DBFactory"><span class="hs-identifier hs-var">DBFactory</span></a></span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="withDatabase"><span class="annot"><span class="annottext">DBFactory m s k
-&gt; forall a. WalletId -&gt; (DBLayer m s k -&gt; IO a) -&gt; IO a
</span><a href="Cardano.Wallet.DB.html#withDatabase"><span class="hs-identifier hs-var hs-var">withDatabase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682460156"><span class="annot"><a href="#local-6989586621682460156"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460085"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460084"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460156"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460156"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-comment">-- ^ Creates a new or use an existing database, maintaining an open</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-comment">-- connection so long as necessary</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="removeDatabase"><span class="annot"><span class="annottext">DBFactory m s k -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.DB.html#removeDatabase"><span class="hs-identifier hs-var hs-var">removeDatabase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>        </span><span class="hs-comment">-- ^ Erase any trace of the database</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="listDatabases"><span class="annot"><span class="annottext">DBFactory m s k -&gt; IO [WalletId]
</span><a href="Cardano.Wallet.DB.html#listDatabases"><span class="hs-identifier hs-var hs-var">listDatabases</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-comment">-- ^ List existing wallet database found on disk.</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | A Database interface for storing various things in a DB. In practice,</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- we'll need some extra constraints on the wallet state that allows us to</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- serialize and unserialize it (e.g. @forall s. (Serialize s) =&gt; ...@)</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- NOTE:</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- We can't use record accessors on the DBLayer as it carries an existential</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- within its constructor. We are forced to pattern-match on the `DBLayer`</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- record type in order to be able to use its methods in any context. With</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- NamedFieldPuns, or RecordWildCards, this can be quite easy:</span><span>
</span><span id="line-98"></span><span class="hs-comment">--</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- myFunction DBLayer{..} = do</span><span>
</span><span id="line-101"></span><span class="hs-comment">--     ...</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- myOtherFunction DBLayer{atomically,initializeWallet} = do</span><span>
</span><span id="line-104"></span><span class="hs-comment">--     ...</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-106"></span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- Alternatively, in some other context where the database may not be a function</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- argument but come from a different source, it is possible to simply rely on</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- 'Data.Function.(&amp;)' to easily pattern match on it:</span><span>
</span><span id="line-110"></span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- myFunction arg0 arg1 = db &amp; \DBLayer{..} -&gt; do</span><span>
</span><span id="line-113"></span><span class="hs-comment">--     ...</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-115"></span><span class="hs-comment">--     db = ...</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Note that it isn't possible to simply use a @where@ clause or a @let@ binding</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- here as the semantic for those are slightly different: we really need a</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- pattern match here!</span><span>
</span><span id="line-121"></span><span class="hs-keyword">data</span><span> </span><span id="DBLayer"><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-var">DBLayer</span></a></span></span><span> </span><span id="local-6989586621682460079"><span class="annot"><a href="#local-6989586621682460079"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682460078"><span class="annot"><a href="#local-6989586621682460078"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682460077"><span class="annot"><a href="#local-6989586621682460077"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682460076"><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="DBLayer"><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-var">DBLayer</span></a></span></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="initializeWallet"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#initializeWallet"><span class="hs-identifier hs-var hs-var">initializeWallet</span></a></span></span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460078"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#GenesisParameters"><span class="hs-identifier hs-type">GenesisParameters</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-comment">-- ^ Initialize a database entry for a given wallet. 'putCheckpoint',</span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-comment">-- 'putWalletMeta', 'putTxHistory' or 'putProtocolParameters' will</span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-comment">-- actually all fail if they are called _first_ on a wallet.</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="removeWallet"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#removeWallet"><span class="hs-identifier hs-var hs-var">removeWallet</span></a></span></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-comment">-- ^ Remove a given wallet and all its associated data (checkpoints,</span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-comment">-- metadata, tx history ...)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="listWallets"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#listWallets"><span class="hs-identifier hs-var hs-var">listWallets</span></a></span></span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-comment">-- ^ Get the list of all known wallets in the DB, possibly empty.</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="walletsDB"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#walletsDB"><span class="hs-identifier hs-var hs-var">walletsDB</span></a></span></span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">DBVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">DeltaMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState"><span class="hs-identifier hs-type">DeltaWalletState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460078"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-comment">-- ^ 'DBVar' containing the 'WalletState' of each wallet in the database.</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-comment">-- Currently contains all 'Checkpoints' of the 'UTxO' and the</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-comment">-- 'Discoveries', as well as the 'Prologue' of the address discovery state.</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-comment">-- Intended to replace 'putCheckpoint' and 'readCheckpoint' in the short-term,</span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-comment">-- and all other functions in the long-term.</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putCheckpoint"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putCheckpoint"><span class="hs-identifier hs-var hs-var">putCheckpoint</span></a></span></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460078"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-comment">-- ^ Replace the current checkpoint for a given wallet. We do not handle</span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-comment">-- rollbacks yet, and therefore only stores the latest available</span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-comment">-- checkpoint.</span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-comment">-- If the wallet doesn't exist, this operation returns an error.</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readCheckpoint"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readCheckpoint"><span class="hs-identifier hs-var hs-var">readCheckpoint</span></a></span></span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460078"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-comment">-- ^ Fetch the most recent checkpoint of a given wallet.</span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span>        </span><span class="hs-comment">-- Return 'Nothing' if there's no such wallet.</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="listCheckpoints"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#listCheckpoints"><span class="hs-identifier hs-var hs-var">listCheckpoints</span></a></span></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ChainPoint"><span class="hs-identifier hs-type">ChainPoint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-comment">-- ^ List all known checkpoint tips, ordered by slot ids from the oldest</span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-comment">-- to the newest.</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putWalletMeta"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putWalletMeta"><span class="hs-identifier hs-var hs-var">putWalletMeta</span></a></span></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-comment">-- ^ Replace an existing wallet metadata with the given one.</span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-comment">-- If the wallet doesn't exist, this operation returns an error</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readWalletMeta"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readWalletMeta"><span class="hs-identifier hs-var hs-var">readWalletMeta</span></a></span></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-comment">-- ^ Fetch a wallet metadata, if they exist.</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-comment">-- Return 'Nothing' if there's no such wallet.</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="isStakeKeyRegistered"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#isStakeKeyRegistered"><span class="hs-identifier hs-var hs-var">isStakeKeyRegistered</span></a></span></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putDelegationCertificate"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putDelegationCertificate"><span class="hs-identifier hs-var hs-var">putDelegationCertificate</span></a></span></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#DelegationCertificate"><span class="hs-identifier hs-type">DelegationCertificate</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-comment">-- ^ Binds a stake pool id to a wallet. This will have an influence on</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-comment">-- the wallet metadata: the last known certificate will indicate to</span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-comment">-- which pool a wallet is currently delegating.</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-comment">-- This is done separately from 'putWalletMeta' because certificate</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-comment">-- declarations are:</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-comment">-- 1. Stored on-chain.</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-comment">-- 2. Affected by rollbacks (or said differently, tied to a 'SlotNo').</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putDelegationRewardBalance"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putDelegationRewardBalance"><span class="hs-identifier hs-var hs-var">putDelegationRewardBalance</span></a></span></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-comment">-- ^ Store the latest known reward account balance.</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-comment">-- This is separate from checkpoints because the data corresponds to the</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-comment">-- node tip.</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-comment">-- This is separate from putWalletMeta because it's not meta data</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readDelegationRewardBalance"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readDelegationRewardBalance"><span class="hs-identifier hs-var hs-var">readDelegationRewardBalance</span></a></span></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-comment">-- ^ Get the reward account balance.</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-comment">-- Returns zero if the wallet isn't found or if wallet hasn't delegated</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- stake.</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putTxHistory"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putTxHistory"><span class="hs-identifier hs-var hs-var">putTxHistory</span></a></span></span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">TxMeta</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-comment">-- ^ Augments the transaction history for a known wallet.</span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-comment">-- If an entry for a particular transaction already exists it is not</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-comment">-- altered nor merged (just ignored).</span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span>        </span><span class="hs-comment">-- If the wallet doesn't exist, this operation returns an error.</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readTxHistory"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readTxHistory"><span class="hs-identifier hs-var hs-var">readTxHistory</span></a></span></span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier hs-type">SortOrder</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxStatus"><span class="hs-identifier hs-type">TxStatus</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">TransactionInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-comment">-- ^ Fetch the current transaction history of a known wallet, ordered by</span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-comment">-- descending slot number.</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-comment">-- Returns an empty list if the wallet isn't found.</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="getTx"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#getTx"><span class="hs-identifier hs-var hs-var">getTx</span></a></span></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">TransactionInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-comment">-- ^ Fetch the latest transaction by id, returns Nothing when the</span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-comment">-- transaction isn't found.</span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-comment">-- If the wallet doesn't exist, this operation returns an error.</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putLocalTxSubmission"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putLocalTxSubmission"><span class="hs-identifier hs-var hs-var">putLocalTxSubmission</span></a></span></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmission"><span class="hs-identifier hs-type">ErrPutLocalTxSubmission</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-comment">-- ^ Add or update a transaction in the local submission pool with the</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-comment">-- most recent submission slot.</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readLocalTxSubmissionPending"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readLocalTxSubmissionPending"><span class="hs-identifier hs-var hs-var">readLocalTxSubmissionPending</span></a></span></span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#LocalTxSubmissionStatus"><span class="hs-identifier hs-type">LocalTxSubmissionStatus</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">SealedTx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-comment">-- ^ List all transactions from the local submission pool which are</span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-comment">-- still pending as of the latest checkpoint of the given wallet. The</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-comment">-- slot numbers for first submission and most recent submission are</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-comment">-- included.</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="updatePendingTxForExpiry"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#updatePendingTxForExpiry"><span class="hs-identifier hs-var hs-var">updatePendingTxForExpiry</span></a></span></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-comment">-- ^ Removes any expired transactions from the pending set and marks</span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-comment">-- their status as expired.</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="removePendingOrExpiredTx"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#removePendingOrExpiredTx"><span class="hs-identifier hs-var hs-var">removePendingOrExpiredTx</span></a></span></span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier hs-type">ErrRemoveTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-comment">-- ^ Manually remove a pending transaction.</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putPrivateKey"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#putPrivateKey"><span class="hs-identifier hs-var hs-var">putPrivateKey</span></a></span></span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682460077"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-type">PassphraseHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-comment">-- ^ Store or replace a private key for a given wallet. Note that wallet</span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-comment">-- _could_ be stored and manipulated without any private key associated</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-comment">-- to it. A private key is only seldomly required for very specific</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-comment">-- operations (like transaction signing).</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readPrivateKey"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readPrivateKey"><span class="hs-identifier hs-var hs-var">readPrivateKey</span></a></span></span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682460077"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-type">PassphraseHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-comment">-- ^ Read a previously stored private key and its associated passphrase</span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-comment">-- hash.</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="readGenesisParameters"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#readGenesisParameters"><span class="hs-identifier hs-var hs-var">readGenesisParameters</span></a></span></span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#GenesisParameters"><span class="hs-identifier hs-type">GenesisParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-comment">-- ^ Read the *Byron* genesis parameters.</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rollbackTo"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#rollbackTo"><span class="hs-identifier hs-var hs-var">rollbackTo</span></a></span></span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#ChainPoint"><span class="hs-identifier hs-type">ChainPoint</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span class="hs-comment">-- ^ Drops all checkpoints and transaction data which</span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-comment">-- have appeared after the given 'ChainPoint'.</span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-comment">-- Returns the actual 'ChainPoint' to which the database has rolled back.</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-comment">-- Its slot is guaranteed to be earlier than (or identical to) the given</span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-comment">-- point of rollback but can't be guaranteed to be exactly the same</span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-comment">-- because the database may only keep sparse checkpoints.</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="prune"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#prune"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;block&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-comment">-- ^ Prune database entities and remove entities that can be discarded.</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-comment">-- The second argument represents the stability window, or said</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-comment">-- length of the deepest rollback.</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="atomically"><span class="annot"><span class="annottext">()
</span><a href="Cardano.Wallet.DB.html#atomically"><span class="hs-identifier hs-var hs-var">atomically</span></a></span></span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682460107"><span class="annot"><a href="#local-6989586621682460107"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621682460076"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460107"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682460079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682460107"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- ^ Execute operations of the database in isolation and atomically.</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | Can't read the database file because it's in a bad format</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- (corrupted, too old, &#8230;)</span><span>
</span><span id="line-337"></span><span class="hs-keyword">data</span><span> </span><span id="ErrBadFormat"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrBadFormat"><span class="hs-identifier hs-var">ErrBadFormat</span></a></span></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrBadFormatAddressPrologue"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrBadFormatAddressPrologue"><span class="hs-identifier hs-var">ErrBadFormatAddressPrologue</span></a></span></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrBadFormatCheckpoints"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrBadFormatCheckpoints"><span class="hs-identifier hs-var">ErrBadFormatCheckpoints</span></a></span></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460043"><span id="local-6989586621682460045"><span class="annot"><span class="annottext">ErrBadFormat -&gt; ErrBadFormat -&gt; Bool
(ErrBadFormat -&gt; ErrBadFormat -&gt; Bool)
-&gt; (ErrBadFormat -&gt; ErrBadFormat -&gt; Bool) -&gt; Eq ErrBadFormat
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrBadFormat -&gt; ErrBadFormat -&gt; Bool
$c/= :: ErrBadFormat -&gt; ErrBadFormat -&gt; Bool
== :: ErrBadFormat -&gt; ErrBadFormat -&gt; Bool
$c== :: ErrBadFormat -&gt; ErrBadFormat -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span id="local-6989586621682460036"><span id="local-6989586621682460038"><span id="local-6989586621682460040"><span class="annot"><span class="annottext">Int -&gt; ErrBadFormat -&gt; ShowS
[ErrBadFormat] -&gt; ShowS
ErrBadFormat -&gt; String
(Int -&gt; ErrBadFormat -&gt; ShowS)
-&gt; (ErrBadFormat -&gt; String)
-&gt; ([ErrBadFormat] -&gt; ShowS)
-&gt; Show ErrBadFormat
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrBadFormat] -&gt; ShowS
$cshowList :: [ErrBadFormat] -&gt; ShowS
show :: ErrBadFormat -&gt; String
$cshow :: ErrBadFormat -&gt; String
showsPrec :: Int -&gt; ErrBadFormat -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrBadFormat -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682460027"><span id="local-6989586621682460029"><span id="local-6989586621682460031"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrBadFormat"><span class="hs-identifier hs-type">ErrBadFormat</span></a></span></span></span></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | Can't add a transaction to the local tx submission pool.</span><span>
</span><span id="line-345"></span><span class="hs-keyword">data</span><span> </span><span id="ErrPutLocalTxSubmission"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmission"><span class="hs-identifier hs-var">ErrPutLocalTxSubmission</span></a></span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrPutLocalTxSubmissionNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmissionNoSuchWallet"><span class="hs-identifier hs-var">ErrPutLocalTxSubmissionNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrPutLocalTxSubmissionNoSuchTransaction"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrPutLocalTxSubmissionNoSuchTransaction"><span class="hs-identifier hs-var">ErrPutLocalTxSubmissionNoSuchTransaction</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460020"><span id="local-6989586621682460022"><span class="annot"><span class="annottext">ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool
(ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool)
-&gt; (ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool)
-&gt; Eq ErrPutLocalTxSubmission
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool
$c/= :: ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool
== :: ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool
$c== :: ErrPutLocalTxSubmission -&gt; ErrPutLocalTxSubmission -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460014"><span id="local-6989586621682460016"><span id="local-6989586621682460018"><span class="annot"><span class="annottext">Int -&gt; ErrPutLocalTxSubmission -&gt; ShowS
[ErrPutLocalTxSubmission] -&gt; ShowS
ErrPutLocalTxSubmission -&gt; String
(Int -&gt; ErrPutLocalTxSubmission -&gt; ShowS)
-&gt; (ErrPutLocalTxSubmission -&gt; String)
-&gt; ([ErrPutLocalTxSubmission] -&gt; ShowS)
-&gt; Show ErrPutLocalTxSubmission
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrPutLocalTxSubmission] -&gt; ShowS
$cshowList :: [ErrPutLocalTxSubmission] -&gt; ShowS
show :: ErrPutLocalTxSubmission -&gt; String
$cshow :: ErrPutLocalTxSubmission -&gt; String
showsPrec :: Int -&gt; ErrPutLocalTxSubmission -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrPutLocalTxSubmission -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- | Can't remove pending or expired transaction.</span><span>
</span><span id="line-351"></span><span class="hs-keyword">data</span><span> </span><span id="ErrRemoveTx"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier hs-var">ErrRemoveTx</span></a></span></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrRemoveTxNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTxNoSuchWallet"><span class="hs-identifier hs-var">ErrRemoveTxNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrRemoveTxNoSuchTransaction"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTxNoSuchTransaction"><span class="hs-identifier hs-var">ErrRemoveTxNoSuchTransaction</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrRemoveTxAlreadyInLedger"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTxAlreadyInLedger"><span class="hs-identifier hs-var">ErrRemoveTxAlreadyInLedger</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682460007"><span id="local-6989586621682460009"><span class="annot"><span class="annottext">ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool
(ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool)
-&gt; (ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool) -&gt; Eq ErrRemoveTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool
$c/= :: ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool
== :: ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool
$c== :: ErrRemoveTx -&gt; ErrRemoveTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682460001"><span id="local-6989586621682460003"><span id="local-6989586621682460005"><span class="annot"><span class="annottext">Int -&gt; ErrRemoveTx -&gt; ShowS
[ErrRemoveTx] -&gt; ShowS
ErrRemoveTx -&gt; String
(Int -&gt; ErrRemoveTx -&gt; ShowS)
-&gt; (ErrRemoveTx -&gt; String)
-&gt; ([ErrRemoveTx] -&gt; ShowS)
-&gt; Show ErrRemoveTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrRemoveTx] -&gt; ShowS
$cshowList :: [ErrRemoveTx] -&gt; ShowS
show :: ErrRemoveTx -&gt; String
$cshow :: ErrRemoveTx -&gt; String
showsPrec :: Int -&gt; ErrRemoveTx -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrRemoveTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | Indicates that the specified transaction hash is not found in the</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- transaction history of the given wallet.</span><span>
</span><span id="line-359"></span><span class="hs-keyword">data</span><span> </span><span id="ErrNoSuchTransaction"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-var">ErrNoSuchTransaction</span></a></span></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrNoSuchTransaction"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-var">ErrNoSuchTransaction</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682459996"><span id="local-6989586621682459998"><span class="annot"><span class="annottext">ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool
(ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool)
-&gt; (ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool)
-&gt; Eq ErrNoSuchTransaction
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool
$c/= :: ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool
== :: ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool
$c== :: ErrNoSuchTransaction -&gt; ErrNoSuchTransaction -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682459990"><span id="local-6989586621682459992"><span id="local-6989586621682459994"><span class="annot"><span class="annottext">Int -&gt; ErrNoSuchTransaction -&gt; ShowS
[ErrNoSuchTransaction] -&gt; ShowS
ErrNoSuchTransaction -&gt; String
(Int -&gt; ErrNoSuchTransaction -&gt; ShowS)
-&gt; (ErrNoSuchTransaction -&gt; String)
-&gt; ([ErrNoSuchTransaction] -&gt; ShowS)
-&gt; Show ErrNoSuchTransaction
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrNoSuchTransaction] -&gt; ShowS
$cshowList :: [ErrNoSuchTransaction] -&gt; ShowS
show :: ErrNoSuchTransaction -&gt; String
$cshow :: ErrNoSuchTransaction -&gt; String
showsPrec :: Int -&gt; ErrNoSuchTransaction -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrNoSuchTransaction -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-comment">-- | Forbidden operation was executed on an already existing wallet</span><span>
</span><span id="line-364"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrWalletAlreadyExists"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-var">ErrWalletAlreadyExists</span></a></span></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrWalletAlreadyExists"><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-var">ErrWalletAlreadyExists</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-comment">-- Wallet already exists in db</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682459985"><span id="local-6989586621682459987"><span class="annot"><span class="annottext">ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool
(ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool)
-&gt; (ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool)
-&gt; Eq ErrWalletAlreadyExists
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool
$c/= :: ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool
== :: ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool
$c== :: ErrWalletAlreadyExists -&gt; ErrWalletAlreadyExists -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682459979"><span id="local-6989586621682459981"><span id="local-6989586621682459983"><span class="annot"><span class="annottext">Int -&gt; ErrWalletAlreadyExists -&gt; ShowS
[ErrWalletAlreadyExists] -&gt; ShowS
ErrWalletAlreadyExists -&gt; String
(Int -&gt; ErrWalletAlreadyExists -&gt; ShowS)
-&gt; (ErrWalletAlreadyExists -&gt; String)
-&gt; ([ErrWalletAlreadyExists] -&gt; ShowS)
-&gt; Show ErrWalletAlreadyExists
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrWalletAlreadyExists] -&gt; ShowS
$cshowList :: [ErrWalletAlreadyExists] -&gt; ShowS
show :: ErrWalletAlreadyExists -&gt; String
$cshow :: ErrWalletAlreadyExists -&gt; String
showsPrec :: Int -&gt; ErrWalletAlreadyExists -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrWalletAlreadyExists -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="hs-comment">-- | Clean a database by removing all wallets.</span><span>
</span><span id="line-369"></span><span id="local-6989586621682459976"><span id="local-6989586621682459977"><span id="local-6989586621682459978"><span class="annot"><a href="Cardano.Wallet.DB.html#cleanDB"><span class="hs-identifier hs-type">cleanDB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459978"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459977"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459976"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682459978"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-370"></span><span id="cleanDB"><span class="annot"><span class="annottext">cleanDB :: DBLayer m s k -&gt; m ()
</span><a href="Cardano.Wallet.DB.html#cleanDB"><span class="hs-identifier hs-var hs-var">cleanDB</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682459950"><span id="local-6989586621682459951"><span id="local-6989586621682459952"><span id="local-6989586621682459953"><span id="local-6989586621682459954"><span id="local-6989586621682459955"><span id="local-6989586621682459956"><span id="local-6989586621682459957"><span id="local-6989586621682459958"><span id="local-6989586621682459959"><span id="local-6989586621682459960"><span id="local-6989586621682459961"><span id="local-6989586621682459962"><span id="local-6989586621682459963"><span id="local-6989586621682459964"><span id="local-6989586621682459965"><span id="local-6989586621682459966"><span id="local-6989586621682459967"><span id="local-6989586621682459968"><span id="local-6989586621682459969"><span id="local-6989586621682459970"><span id="local-6989586621682459971"><span id="local-6989586621682459972"><span id="local-6989586621682459973"><span id="local-6989586621682459974"><span id="local-6989586621682459975"><span class="annot"><span class="annottext">stm [WalletId]
DBVar stm (DeltaMap WalletId (DeltaWalletState s))
WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
WalletId -&gt; stm [ChainPoint]
WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
WalletId -&gt; stm (Maybe GenesisParameters)
WalletId -&gt; stm (Maybe WalletMetadata)
WalletId -&gt; stm (Maybe (Wallet s))
WalletId -&gt; stm Coin
WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
forall a. stm a -&gt; m a
atomically :: forall a. stm a -&gt; m a
prune :: WalletId
-&gt; Quantity &quot;block&quot; Word32 -&gt; ExceptT ErrNoSuchWallet stm ()
rollbackTo :: WalletId -&gt; Slot -&gt; ExceptT ErrNoSuchWallet stm ChainPoint
readGenesisParameters :: WalletId -&gt; stm (Maybe GenesisParameters)
readPrivateKey :: WalletId -&gt; stm (Maybe (k 'RootK XPrv, PassphraseHash))
putPrivateKey :: WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet stm ()
removePendingOrExpiredTx :: WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx stm ()
updatePendingTxForExpiry :: WalletId -&gt; SlotNo -&gt; ExceptT ErrNoSuchWallet stm ()
readLocalTxSubmissionPending :: WalletId -&gt; stm [LocalTxSubmissionStatus SealedTx]
putLocalTxSubmission :: WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; SealedTx
-&gt; SlotNo
-&gt; ExceptT ErrPutLocalTxSubmission stm ()
getTx :: WalletId
-&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrNoSuchWallet stm (Maybe TransactionInfo)
readTxHistory :: WalletId
-&gt; Maybe Coin
-&gt; SortOrder
-&gt; Range SlotNo
-&gt; Maybe TxStatus
-&gt; stm [TransactionInfo]
putTxHistory :: WalletId -&gt; [(Tx, TxMeta)] -&gt; ExceptT ErrNoSuchWallet stm ()
readDelegationRewardBalance :: WalletId -&gt; stm Coin
putDelegationRewardBalance :: WalletId -&gt; Coin -&gt; ExceptT ErrNoSuchWallet stm ()
putDelegationCertificate :: WalletId
-&gt; DelegationCertificate
-&gt; SlotNo
-&gt; ExceptT ErrNoSuchWallet stm ()
isStakeKeyRegistered :: WalletId -&gt; ExceptT ErrNoSuchWallet stm Bool
readWalletMeta :: WalletId -&gt; stm (Maybe WalletMetadata)
putWalletMeta :: WalletId -&gt; WalletMetadata -&gt; ExceptT ErrNoSuchWallet stm ()
listCheckpoints :: WalletId -&gt; stm [ChainPoint]
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
putCheckpoint :: WalletId -&gt; Wallet s -&gt; ExceptT ErrNoSuchWallet stm ()
walletsDB :: DBVar stm (DeltaMap WalletId (DeltaWalletState s))
listWallets :: stm [WalletId]
removeWallet :: WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
initializeWallet :: WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; [(Tx, TxMeta)]
-&gt; GenesisParameters
-&gt; ExceptT ErrWalletAlreadyExists stm ()
atomically :: ()
prune :: ()
rollbackTo :: ()
readGenesisParameters :: ()
readPrivateKey :: ()
putPrivateKey :: ()
removePendingOrExpiredTx :: ()
updatePendingTxForExpiry :: ()
readLocalTxSubmissionPending :: ()
putLocalTxSubmission :: ()
getTx :: ()
readTxHistory :: ()
putTxHistory :: ()
readDelegationRewardBalance :: ()
putDelegationRewardBalance :: ()
putDelegationCertificate :: ()
isStakeKeyRegistered :: ()
readWalletMeta :: ()
putWalletMeta :: ()
listCheckpoints :: ()
readCheckpoint :: ()
putCheckpoint :: ()
walletsDB :: ()
listWallets :: ()
removeWallet :: ()
initializeWallet :: ()
</span><a href="#local-6989586621682459950"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">stm () -&gt; m ()
forall a. stm a -&gt; m a
</span><a href="#local-6989586621682459950"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(stm () -&gt; m ()) -&gt; stm () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="annottext">stm [WalletId]
</span><a href="#local-6989586621682459973"><span class="hs-identifier hs-var">listWallets</span></a></span><span> </span><span class="annot"><span class="annottext">stm [WalletId] -&gt; ([WalletId] -&gt; stm ()) -&gt; stm ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletId -&gt; stm (Either ErrNoSuchWallet ()))
-&gt; [WalletId] -&gt; stm ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet stm () -&gt; stm (Either ErrNoSuchWallet ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm () -&gt; stm (Either ErrNoSuchWallet ()))
-&gt; (WalletId -&gt; ExceptT ErrNoSuchWallet stm ())
-&gt; WalletId
-&gt; stm (Either ErrNoSuchWallet ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ExceptT ErrNoSuchWallet stm ()
</span><a href="#local-6989586621682459974"><span class="hs-identifier hs-var">removeWallet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span></pre></body></html>