<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RoleAnnotations #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Copyright: &#169; 2018-2020 IOHK</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- Implementation of address derivation for the random scheme, as</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- implemented by the legacy Cardano wallets.</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- For full documentation of the key derivation schemes,</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- see the &quot;Cardano.Crypto.Wallet&quot; module, and the implementation in</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- &lt;https://github.com/input-output-hk/cardano-crypto/blob/4590efa638397e952a51a8994b5543e4ea3c1ecd/cbits/encrypted_sign.c cardano-crypto&gt;.</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Byron</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-30"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier">ByronKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier">DerivationPathFrom</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Generation</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#generateKeyFromSeed"><span class="hs-identifier">generateKeyFromSeed</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#minSeedLengthBytes"><span class="hs-identifier">minSeedLengthBytes</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeMkByronKeyFromMasterKey"><span class="hs-identifier">unsafeMkByronKeyFromMasterKey</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mkByronKeyFromMasterKey"><span class="hs-identifier">mkByronKeyFromMasterKey</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Derivation</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#deriveAccountPrivateKey"><span class="hs-identifier">deriveAccountPrivateKey</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#deriveAddressPrivateKey"><span class="hs-identifier">deriveAddressPrivateKey</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">DerivationScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">DerivationScheme1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">XPrv</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">XPub</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">deriveXPrv</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">generate</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">toXPub</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">unXPrv</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">unXPub</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">xprv</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">SomeMnemonic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">entropyToBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">mnemonicToEntropy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier">BoundedAddressLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier">Depth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationType"><span class="hs-identifier">DerivationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#ErrMkKeyFingerprint"><span class="hs-identifier">ErrMkKeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier">KeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier">MkKeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier">NetworkDiscriminant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPrivateKey"><span class="hs-identifier">PersistPrivateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier">WalletKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier">fromHex</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier">hex</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier">Passphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier">PassphraseHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier">PassphraseScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#changePassphraseXPrv"><span class="hs-identifier">changePassphraseXPrv</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Address</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.ProtocolMagic</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#ProtocolMagic"><span class="hs-identifier">ProtocolMagic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#testnetMagic"><span class="hs-identifier">testnetMagic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Util.html"><span class="hs-identifier">Cardano.Wallet.Util</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Util.html#invariant"><span class="hs-identifier">invariant</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">NFData</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">hash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash.Algorithms</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">SHA512</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.Hash.Utils.html"><span class="hs-identifier">Crypto.Hash.Utils</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Crypto.Hash.Utils.html#blake2b256"><span class="hs-identifier">blake2b256</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier">Data.ByteArray</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier">ScrubbedBytes</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Kind</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">Type</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.TypeLits</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">KnownNat</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Byron.Codec.Cbor.html"><span class="hs-identifier">Cardano.Byron.Codec.Cbor</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">Codec.CBOR.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">Codec.CBOR.Write</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.KDF.PBKDF2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PBKDF2</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier">Data.ByteArray</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                   Key Types
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | Material for deriving HD random scheme keys, which can be used for making</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- addresses.</span><span>
</span><span id="line-125"></span><span id="local-6989586621682437720"><span id="local-6989586621682437721"></span></span><span class="hs-keyword">data</span><span> </span><span id="ByronKey"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-var">ByronKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682437840"><span class="annot"><a href="#local-6989586621682437840"><span class="hs-identifier hs-type">depth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier hs-type">Depth</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682437839"><span class="annot"><a href="#local-6989586621682437839"><span class="hs-identifier hs-type">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ByronKey"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-var">ByronKey</span></a></span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="getKey"><span class="annot"><span class="annottext">ByronKey depth key -&gt; key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682437839"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">-- ^ The raw private or public key.</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="derivationPath"><span class="annot"><span class="annottext">ByronKey depth key -&gt; DerivationPathFrom depth
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-type">DerivationPathFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437840"><span class="hs-identifier hs-type">depth</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">-- ^ The address derivation indices for the level of this key.</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="payloadPassphrase"><span class="annot"><span class="annottext">ByronKey depth key -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var hs-var">payloadPassphrase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addr-derivation-payload&quot;</span></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-comment">-- ^ Used for encryption of payload containing address derivation path.</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ByronKey depth key -&gt; Rep (ByronKey depth key) x)
-&gt; (forall x. Rep (ByronKey depth key) x -&gt; ByronKey depth key)
-&gt; Generic (ByronKey depth key)
forall x. Rep (ByronKey depth key) x -&gt; ByronKey depth key
forall x. ByronKey depth key -&gt; Rep (ByronKey depth key) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (depth :: Depth) key x.
Rep (ByronKey depth key) x -&gt; ByronKey depth key
forall (depth :: Depth) key x.
ByronKey depth key -&gt; Rep (ByronKey depth key) x
$cto :: forall (depth :: Depth) key x.
Rep (ByronKey depth key) x -&gt; ByronKey depth key
$cfrom :: forall (depth :: Depth) key x.
ByronKey depth key -&gt; Rep (ByronKey depth key) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="local-6989586621682437711"><span id="local-6989586621682437712"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682437709"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437712"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-type">DerivationPathFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437711"><span class="hs-identifier hs-type">depth</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437711"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437712"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-135"></span><span id="local-6989586621682437700"><span id="local-6989586621682437702"><span id="local-6989586621682437704"><span id="local-6989586621682437706"><span id="local-6989586621682437707"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437707"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-type">DerivationPathFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437706"><span class="hs-identifier hs-type">depth</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437706"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437707"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-136"></span><span id="local-6989586621682437693"><span id="local-6989586621682437695"><span id="local-6989586621682437697"><span id="local-6989586621682437698"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437698"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-type">DerivationPathFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437697"><span class="hs-identifier hs-type">depth</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437697"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437698"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | The hierarchical derivation indices for a given level/depth.</span><span>
</span><span id="line-139"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="DerivationPathFrom"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-var">DerivationPathFrom</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682437691"><span class="annot"><a href="#local-6989586621682437691"><span class="hs-identifier hs-type">depth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier hs-type">Depth</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- The root key is generated from the seed.</span><span>
</span><span id="line-141"></span><span>    </span><span id="DerivationPathFrom"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-var">DerivationPathFrom</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- The account key is generated from the root key and account index.</span><span>
</span><span id="line-144"></span><span>    </span><span id="DerivationPathFrom"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-var">DerivationPathFrom</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WholeDomain"><span class="hs-identifier hs-type">WholeDomain</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">-- The address key is generated from the account key and address index.</span><span>
</span><span id="line-147"></span><span>    </span><span id="DerivationPathFrom"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-var">DerivationPathFrom</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WholeDomain"><span class="hs-identifier hs-type">WholeDomain</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WholeDomain"><span class="hs-identifier hs-type">WholeDomain</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621682437683"><span class="annot"><span class="annottext">changePassphrase :: (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; ByronKey depth XPrv
-&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#changePassphrase"><span class="hs-identifier hs-var hs-var hs-var hs-var">changePassphrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; ByronKey depth XPrv
-&gt; ByronKey depth XPrv
forall (depth :: Depth).
(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; ByronKey depth XPrv
-&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#changePassphraseRnd"><span class="hs-identifier hs-var">changePassphraseRnd</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- Extract the public key part of a private key.</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621682437680"><span class="annot"><span class="annottext">publicKey :: ByronKey depth XPrv -&gt; ByronKey depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; XPub) -&gt; ByronKey depth XPrv -&gt; ByronKey depth XPub
forall key key' (depth :: Depth).
(key -&gt; key') -&gt; ByronKey depth key -&gt; ByronKey depth key'
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mapKey"><span class="hs-identifier hs-var">mapKey</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- Hash a public key to some other representation.</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621682437677"><span class="annot"><span class="annottext">digest :: ByronKey depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var hs-var hs-var hs-var">digest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Digest a
forall ba a.
(ByteArrayAccess ba, HashAlgorithm a) =&gt;
ba -&gt; Digest a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Digest a)
-&gt; (ByronKey depth XPub -&gt; ByteString)
-&gt; ByronKey depth XPub
-&gt; Digest a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ByteString)
-&gt; (ByronKey depth XPub -&gt; XPub)
-&gt; ByronKey depth XPub
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey depth XPub -&gt; XPub
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621682437674"><span class="annot"><span class="annottext">getRawKey :: ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">getRawKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey depth raw -&gt; raw
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621682437672"><span class="annot"><span class="annottext">liftRawKey :: raw -&gt; ByronKey depth raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftRawKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftRawKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; raw -&gt; ByronKey depth raw
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not supported&quot;</span></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621682437669"><span class="annot"><span class="annottext">keyTypeDescriptor :: Proxy ByronKey -&gt; String
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#keyTypeDescriptor"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyTypeDescriptor</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy ByronKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnd&quot;</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span id="local-6989586621682437667"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">KnownNat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437667"><span class="hs-identifier hs-type">pm</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Testnet"><span class="hs-identifier hs-type">Testnet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437667"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621682437662"><span class="annot"><span class="annottext">paymentAddress :: ByronKey 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentAddress"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentAddress</span></a></span></span><span> </span><span id="local-6989586621682437660"><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437660"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; [Encoding] -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeAddress"><span class="hs-identifier hs-var">CBOR.encodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub -&gt; XPub
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437660"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
-&gt; Index 'WholeDomain 'AccountK
-&gt; Index 'WholeDomain 'AddressK
-&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeDerivationPathAttr"><span class="hs-identifier hs-var">CBOR.encodeDerivationPathAttr</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437655"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AccountK
</span><a href="#local-6989586621682437654"><span class="hs-identifier hs-var">acctIx</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AddressK
</span><a href="#local-6989586621682437653"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolMagic -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeProtocolMagicAttr"><span class="hs-identifier hs-var">CBOR.encodeProtocolMagicAttr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownNat pm =&gt; ProtocolMagic
forall (pm :: Nat). KnownNat pm =&gt; ProtocolMagic
</span><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#testnetMagic"><span class="hs-identifier hs-var">testnetMagic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682437667"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682437654"><span class="annot"><span class="annottext">Index 'WholeDomain 'AccountK
</span><a href="#local-6989586621682437654"><span class="hs-identifier hs-var">acctIx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682437653"><span class="annot"><span class="annottext">Index 'WholeDomain 'AddressK
</span><a href="#local-6989586621682437653"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub -&gt; DerivationPathFrom 'AddressK
forall (depth :: Depth) key.
ByronKey depth key -&gt; DerivationPathFrom depth
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437660"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621682437655"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437655"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (depth :: Depth) key.
ByronKey depth key -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var hs-var">payloadPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437660"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621682437651"><span class="annot"><span class="annottext">liftPaymentAddress :: KeyFingerprint &quot;payment&quot; ByronKey -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftPaymentAddress"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftPaymentAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-type">KeyFingerprint</span></a></span><span> </span><span id="local-6989586621682437648"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437648"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437648"><span class="hs-identifier hs-var">bytes</span></a></span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Mainnet"><span class="hs-identifier hs-type">Mainnet</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621682437644"><span class="annot"><span class="annottext">paymentAddress :: ByronKey 'AddressK XPub -&gt; Address
</span><a href="#local-6989586621682437644"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentAddress</span></a></span></span><span> </span><span id="local-6989586621682437643"><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437643"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; [Encoding] -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeAddress"><span class="hs-identifier hs-var">CBOR.encodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub -&gt; XPub
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437643"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
-&gt; Index 'WholeDomain 'AccountK
-&gt; Index 'WholeDomain 'AddressK
-&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeDerivationPathAttr"><span class="hs-identifier hs-var">CBOR.encodeDerivationPathAttr</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437642"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AccountK
</span><a href="#local-6989586621682437641"><span class="hs-identifier hs-var">acctIx</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AddressK
</span><a href="#local-6989586621682437640"><span class="hs-identifier hs-var">addrIx</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682437641"><span class="annot"><span class="annottext">Index 'WholeDomain 'AccountK
</span><a href="#local-6989586621682437641"><span class="hs-identifier hs-var">acctIx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682437640"><span class="annot"><span class="annottext">Index 'WholeDomain 'AddressK
</span><a href="#local-6989586621682437640"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub -&gt; DerivationPathFrom 'AddressK
forall (depth :: Depth) key.
ByronKey depth key -&gt; DerivationPathFrom depth
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437643"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span id="local-6989586621682437642"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437642"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (depth :: Depth) key.
ByronKey depth key -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var hs-var">payloadPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AddressK XPub
</span><a href="#local-6989586621682437643"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621682437639"><span class="annot"><span class="annottext">liftPaymentAddress :: KeyFingerprint &quot;payment&quot; ByronKey -&gt; Address
</span><a href="#local-6989586621682437639"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftPaymentAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-type">KeyFingerprint</span></a></span><span> </span><span id="local-6989586621682437638"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437638"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437638"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621682437634"><span class="annot"><span class="annottext">paymentKeyFingerprint :: Address
-&gt; Either
     (ErrMkKeyFingerprint ByronKey Address)
     (KeyFingerprint &quot;payment&quot; ByronKey)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentKeyFingerprint"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentKeyFingerprint</span></a></span></span><span> </span><span id="local-6989586621682437632"><span class="annot"><span class="annottext">addr :: Address
</span><a href="#local-6989586621682437632"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span id="local-6989586621682437631"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437631"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a. (forall s. Decoder s a) -&gt; ByteString -&gt; Maybe a
</span><a href="Cardano.Byron.Codec.Cbor.html#deserialiseCbor"><span class="hs-identifier hs-var">CBOR.deserialiseCbor</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s ByteString
</span><a href="Cardano.Byron.Codec.Cbor.html#decodeAddressPayload"><span class="hs-identifier hs-var">CBOR.decodeAddressPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437631"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; ByronKey
-&gt; Either
     (ErrMkKeyFingerprint ByronKey Address)
     (KeyFingerprint &quot;payment&quot; ByronKey)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyFingerprint &quot;payment&quot; ByronKey
 -&gt; Either
      (ErrMkKeyFingerprint ByronKey Address)
      (KeyFingerprint &quot;payment&quot; ByronKey))
-&gt; KeyFingerprint &quot;payment&quot; ByronKey
-&gt; Either
     (ErrMkKeyFingerprint ByronKey Address)
     (KeyFingerprint &quot;payment&quot; ByronKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; KeyFingerprint &quot;payment&quot; ByronKey
forall k (s :: Symbol) (key :: k).
ByteString -&gt; KeyFingerprint s key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-var">KeyFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437631"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-188"></span><span>            </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrMkKeyFingerprint ByronKey Address
-&gt; Either
     (ErrMkKeyFingerprint ByronKey Address)
     (KeyFingerprint &quot;payment&quot; ByronKey)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMkKeyFingerprint ByronKey Address
 -&gt; Either
      (ErrMkKeyFingerprint ByronKey Address)
      (KeyFingerprint &quot;payment&quot; ByronKey))
-&gt; ErrMkKeyFingerprint ByronKey Address
-&gt; Either
     (ErrMkKeyFingerprint ByronKey Address)
     (KeyFingerprint &quot;payment&quot; ByronKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Proxy ByronKey -&gt; ErrMkKeyFingerprint ByronKey Address
forall k (key :: k) from.
from -&gt; Proxy key -&gt; ErrMkKeyFingerprint key from
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#ErrInvalidAddress"><span class="hs-identifier hs-var">ErrInvalidAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682437632"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ByronKey
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">-- Matching 'paymentAddress' above.</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621682437624"><span class="annot"><span class="annottext">maxLengthAddressFor :: Proxy ByronKey -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#maxLengthAddressFor"><span class="hs-identifier hs-var hs-var hs-var hs-var">maxLengthAddressFor</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy ByronKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; [Encoding] -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeAddress"><span class="hs-identifier hs-var">CBOR.encodeAddress</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682437622"><span class="hs-identifier hs-var">xpub</span></a></span><span>
</span><span id="line-195"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
-&gt; Index 'WholeDomain 'AccountK
-&gt; Index 'WholeDomain 'AddressK
-&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeDerivationPathAttr"><span class="hs-identifier hs-var">CBOR.encodeDerivationPathAttr</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437621"><span class="hs-identifier hs-var">passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AccountK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AddressK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span>
</span><span id="line-196"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolMagic -&gt; Encoding
</span><a href="Cardano.Byron.Codec.Cbor.html#encodeProtocolMagicAttr"><span class="hs-identifier hs-var">CBOR.encodeProtocolMagicAttr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; ProtocolMagic
</span><a href="Cardano.Wallet.Primitive.Types.ProtocolMagic.html#ProtocolMagic"><span class="hs-identifier hs-var">ProtocolMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-comment">-- Must apparently always be 32 bytes:</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><a href="#local-6989586621682437621"><span class="hs-identifier hs-type">passphrase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addr-derivation-payload&quot;</span></span><span>
</span><span id="line-201"></span><span>        </span><span id="local-6989586621682437621"><span class="annot"><span class="annottext">passphrase :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437621"><span class="hs-identifier hs-var hs-var">passphrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (purpose :: Symbol). ScrubbedBytes -&gt; Passphrase purpose
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-var">Passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;)
-&gt; ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ScrubbedBytes) -&gt; ByteString -&gt; ScrubbedBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8 -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><a href="#local-6989586621682437622"><span class="hs-identifier hs-type">xpub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">CC.XPub</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span id="local-6989586621682437622"><span class="annot"><span class="annottext">xpub :: XPub
</span><a href="#local-6989586621682437622"><span class="hs-identifier hs-var hs-var">xpub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">CC.toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; XPub) -&gt; XPrv -&gt; XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; XPrv
forall passPhrase seed.
(ByteArrayAccess passPhrase, ByteArrayAccess seed) =&gt;
seed -&gt; passPhrase -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">CC.generate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word8 -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437615"><span class="hs-identifier hs-var">xprvPass</span></a></span><span>
</span><span id="line-205"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>            </span><span id="local-6989586621682437615"><span class="annot"><span class="annottext">xprvPass :: ByteString
</span><a href="#local-6989586621682437615"><span class="hs-identifier hs-var hs-var">xprvPass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                 Key generation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | The amount of entropy carried by a BIP-39 12-word mnemonic is 16 bytes.</span><span>
</span><span id="line-213"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#minSeedLengthBytes"><span class="hs-identifier hs-type">minSeedLengthBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-214"></span><span id="minSeedLengthBytes"><span class="annot"><span class="annottext">minSeedLengthBytes :: Int
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#minSeedLengthBytes"><span class="hs-identifier hs-var hs-var">minSeedLengthBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | Generate a root key from a corresponding seed.</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- The seed should be at least 16 bytes.</span><span>
</span><span id="line-218"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#generateKeyFromSeed"><span class="hs-identifier hs-type">generateKeyFromSeed</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-222"></span><span id="generateKeyFromSeed"><span class="annot"><span class="annottext">generateKeyFromSeed :: SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; ByronKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#generateKeyFromSeed"><span class="hs-identifier hs-var hs-var">generateKeyFromSeed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationPathFrom 'RootK
-&gt; SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; ByronKey 'RootK XPrv
forall (depth :: Depth).
DerivationPathFrom depth
-&gt; SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-var">unsafeGenerateKeyFromSeed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- | Generate a new key from seed. Note that the @depth@ is left open so that</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- the caller gets to decide what type of key this is. This is mostly for</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- testing, in practice, seeds are used to represent root keys, and one should</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- use 'generateKeyFromSeed'.</span><span>
</span><span id="line-228"></span><span id="local-6989586621682437807"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-type">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-type">DerivationPathFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437807"><span class="hs-identifier hs-type">depth</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437807"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span></span><span>
</span><span id="line-233"></span><span id="unsafeGenerateKeyFromSeed"><span class="annot"><span class="annottext">unsafeGenerateKeyFromSeed :: DerivationPathFrom depth
-&gt; SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-var hs-var">unsafeGenerateKeyFromSeed</span></a></span></span><span> </span><span id="local-6989586621682437614"><span class="annot"><span class="annottext">DerivationPathFrom depth
</span><a href="#local-6989586621682437614"><span class="hs-identifier hs-var">derivationPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span> </span><span id="local-6989586621682437612"><span class="annot"><span class="annottext">Mnemonic mw
</span><a href="#local-6989586621682437612"><span class="hs-identifier hs-var">mw</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682437611"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437611"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey :: forall (depth :: Depth) key.
key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getKey :: XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437610"><span class="hs-identifier hs-var">masterKey</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationPathFrom depth
derivationPath :: DerivationPathFrom depth
derivationPath :: DerivationPathFrom depth
</span><a href="#local-6989586621682437614"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">payloadPassphrase :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var">payloadPassphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hdPassphrase"><span class="hs-identifier hs-var">hdPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437610"><span class="hs-identifier hs-var">masterKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621682437610"><span class="annot"><span class="annottext">masterKey :: XPrv
</span><a href="#local-6989586621682437610"><span class="hs-identifier hs-var hs-var">masterKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ScrubbedBytes -&gt; XPrv
forall passPhrase seed.
(ByteArrayAccess passPhrase, ByteArrayAccess seed) =&gt;
seed -&gt; passPhrase -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">generate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ScrubbedBytes
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hashSeed"><span class="hs-identifier hs-var">hashSeed</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437607"><span class="hs-identifier hs-var">seed'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437611"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621682437606"><span class="annot"><span class="annottext">seed :: ScrubbedBytes
</span><a href="#local-6989586621682437606"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Entropy (EntropySize mw) -&gt; ScrubbedBytes
forall (n :: Nat). Entropy n -&gt; ScrubbedBytes
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">entropyToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Entropy (EntropySize mw) -&gt; ScrubbedBytes)
-&gt; Entropy (EntropySize mw) -&gt; ScrubbedBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic mw -&gt; Entropy (EntropySize mw)
forall (mw :: Nat). Mnemonic mw -&gt; Entropy (EntropySize mw)
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var hs-var">mnemonicToEntropy</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic mw
</span><a href="#local-6989586621682437612"><span class="hs-identifier hs-var">mw</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621682437607"><span class="annot"><span class="annottext">seed' :: ScrubbedBytes
</span><a href="#local-6989586621682437607"><span class="hs-identifier hs-var hs-var">seed'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ScrubbedBytes -&gt; (ScrubbedBytes -&gt; Bool) -&gt; ScrubbedBytes
forall a. HasCallStack =&gt; String -&gt; a -&gt; (a -&gt; Bool) -&gt; a
</span><a href="Cardano.Wallet.Util.html#invariant"><span class="hs-identifier hs-var">invariant</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;seed length : &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Int
forall ba. ByteArrayAccess ba =&gt; ba -&gt; Int
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.length</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437606"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in (Passphrase \&quot;seed\&quot;) is not valid&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437606"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682437603"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437603"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Int
forall ba. ByteArrayAccess ba =&gt; ba -&gt; Int
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.length</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437603"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#minSeedLengthBytes"><span class="hs-identifier hs-var">minSeedLengthBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Int
forall ba. ByteArrayAccess ba =&gt; ba -&gt; Int
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.length</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437603"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Hash the seed entropy (generated from mnemonic) used to initiate a HD</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- wallet. This increases the key length to 34 bytes, selectKey is greater than the</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- minimum for 'generate' (32 bytes).</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- Note that our current implementation deviates from BIP-39 because we use a</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- hash function (Blake2b) rather than key stretching with PBKDF2.</span><span>
</span><span id="line-253"></span><span class="hs-comment">--</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- There are two methods of hashing the seed entropy, for different use cases.</span><span>
</span><span id="line-255"></span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- 1. Normal random derivation wallet seeds. The seed entropy is hashed using</span><span>
</span><span id="line-257"></span><span class="hs-comment">--    Blake2b_256, inside a double CBOR serialization sandwich.</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- 2. Seeds for redeeming paper wallets. The seed entropy is hashed using</span><span>
</span><span id="line-260"></span><span class="hs-comment">--    Blake2b_256, without any serialization.</span><span>
</span><span id="line-261"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hashSeed"><span class="hs-identifier hs-type">hashSeed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier hs-type">ScrubbedBytes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier hs-type">ScrubbedBytes</span></a></span><span>
</span><span id="line-262"></span><span id="hashSeed"><span class="annot"><span class="annottext">hashSeed :: ScrubbedBytes -&gt; ScrubbedBytes
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hashSeed"><span class="hs-identifier hs-var hs-var">hashSeed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ScrubbedBytes)
-&gt; (ScrubbedBytes -&gt; ByteString) -&gt; ScrubbedBytes -&gt; ScrubbedBytes
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621682437600"><span class="hs-identifier hs-var">cbor</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ScrubbedBytes -&gt; ByteString) -&gt; ScrubbedBytes -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall a. ByteArrayAccess a =&gt; a -&gt; ByteString
</span><a href="Crypto.Hash.Utils.html#blake2b256"><span class="hs-identifier hs-var">blake2b256</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ScrubbedBytes -&gt; ByteString) -&gt; ScrubbedBytes -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621682437600"><span class="hs-identifier hs-var">cbor</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ScrubbedBytes -&gt; ByteString) -&gt; ScrubbedBytes -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ByteString
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621682437600"><span class="annot"><span class="annottext">cbor :: ByteString -&gt; ByteString
</span><a href="#local-6989586621682437600"><span class="hs-identifier hs-var hs-var">cbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.toStrictByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString)
-&gt; (ByteString -&gt; Encoding) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Encoding
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">CBOR.encodeBytes</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | Derive a symmetric key for encrypting and authenticating the address</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- derivation path. PBKDF2 encryption using HMAC with the hash algorithm SHA512</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- is employed.</span><span>
</span><span id="line-269"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hdPassphrase"><span class="hs-identifier hs-type">hdPassphrase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addr-derivation-payload&quot;</span></span><span>
</span><span id="line-270"></span><span id="hdPassphrase"><span class="annot"><span class="annottext">hdPassphrase :: XPub -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hdPassphrase"><span class="hs-identifier hs-var hs-var">hdPassphrase</span></a></span></span><span> </span><span id="local-6989586621682437598"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682437598"><span class="hs-identifier hs-var">masterKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (purpose :: Symbol). ScrubbedBytes -&gt; Passphrase purpose
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-var">Passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;)
-&gt; ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="annottext">PRF ByteString
-&gt; Parameters -&gt; ByteString -&gt; ByteString -&gt; ScrubbedBytes
forall password salt ba.
(ByteArrayAccess password, ByteArrayAccess salt, ByteArray ba) =&gt;
PRF password -&gt; Parameters -&gt; password -&gt; salt -&gt; ba
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">PBKDF2.generate</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SHA512 -&gt; PRF ByteString
forall a password.
(HashAlgorithm a, ByteArrayAccess password) =&gt;
a -&gt; PRF password
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">PBKDF2.prfHMAC</span></a></span><span> </span><span class="annot"><span class="annottext">SHA512
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">SHA512</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Parameters
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">PBKDF2.Parameters</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682437598"><span class="hs-identifier hs-var">masterKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;address-hashing&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mkByronKeyFromMasterKey"><span class="hs-identifier hs-type">mkByronKeyFromMasterKey</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-280"></span><span id="mkByronKeyFromMasterKey"><span class="annot"><span class="annottext">mkByronKeyFromMasterKey :: XPrv -&gt; ByronKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mkByronKeyFromMasterKey"><span class="hs-identifier hs-var hs-var">mkByronKeyFromMasterKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationPathFrom 'RootK -&gt; XPrv -&gt; ByronKey 'RootK XPrv
forall (depth :: Depth).
DerivationPathFrom depth -&gt; XPrv -&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeMkByronKeyFromMasterKey"><span class="hs-identifier hs-var">unsafeMkByronKeyFromMasterKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span id="local-6989586621682437786"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeMkByronKeyFromMasterKey"><span class="hs-identifier hs-type">unsafeMkByronKeyFromMasterKey</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#DerivationPathFrom"><span class="hs-identifier hs-type">DerivationPathFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437786"><span class="hs-identifier hs-type">depth</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437786"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span></span><span>
</span><span id="line-286"></span><span id="unsafeMkByronKeyFromMasterKey"><span class="annot"><span class="annottext">unsafeMkByronKeyFromMasterKey :: DerivationPathFrom depth -&gt; XPrv -&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#unsafeMkByronKeyFromMasterKey"><span class="hs-identifier hs-var hs-var">unsafeMkByronKeyFromMasterKey</span></a></span></span><span> </span><span id="local-6989586621682437593"><span class="annot"><span class="annottext">DerivationPathFrom depth
</span><a href="#local-6989586621682437593"><span class="hs-identifier hs-var">derivationPath</span></a></span></span><span> </span><span id="local-6989586621682437592"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437592"><span class="hs-identifier hs-var">masterKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey :: forall (depth :: Depth) key.
key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getKey :: XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437592"><span class="hs-identifier hs-var">masterKey</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationPathFrom depth
derivationPath :: DerivationPathFrom depth
derivationPath :: DerivationPathFrom depth
</span><a href="#local-6989586621682437593"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">payloadPassphrase :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var">payloadPassphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hdPassphrase"><span class="hs-identifier hs-var">hdPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437592"><span class="hs-identifier hs-var">masterKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                   Passphrase
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | Re-encrypt the private key using a different passphrase, and regenerate</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- the payload passphrase.</span><span>
</span><span id="line-298"></span><span class="hs-comment">--</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- **Important**:</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- This function doesn't check that the old passphrase is correct! Caller is</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- expected to have already checked that. Using an incorrect passphrase here</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- will lead to very bad thing.</span><span>
</span><span id="line-303"></span><span id="local-6989586621682437591"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#changePassphraseRnd"><span class="hs-identifier hs-type">changePassphraseRnd</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier hs-type">PassphraseScheme</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier hs-type">PassphraseScheme</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437591"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437591"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span></span><span>
</span><span id="line-308"></span><span id="changePassphraseRnd"><span class="annot"><span class="annottext">changePassphraseRnd :: (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; ByronKey depth XPrv
-&gt; ByronKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#changePassphraseRnd"><span class="hs-identifier hs-var hs-var">changePassphraseRnd</span></a></span></span><span> </span><span id="local-6989586621682437590"><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682437590"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621682437589"><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682437589"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621682437588"><span class="annot"><span class="annottext">ByronKey depth XPrv
</span><a href="#local-6989586621682437588"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey :: forall (depth :: Depth) key.
key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getKey :: XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437587"><span class="hs-identifier hs-var">masterKey</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">derivationPath :: DerivationPathFrom depth
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey depth XPrv -&gt; DerivationPathFrom depth
forall (depth :: Depth) key.
ByronKey depth key -&gt; DerivationPathFrom depth
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey depth XPrv
</span><a href="#local-6989586621682437588"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">payloadPassphrase :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var">payloadPassphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#hdPassphrase"><span class="hs-identifier hs-var">hdPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437587"><span class="hs-identifier hs-var">masterKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621682437587"><span class="annot"><span class="annottext">masterKey :: XPrv
</span><a href="#local-6989586621682437587"><span class="hs-identifier hs-var hs-var">masterKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;) -&gt; XPrv -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#changePassphraseXPrv"><span class="hs-identifier hs-var">changePassphraseXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682437590"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682437589"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey depth XPrv -&gt; XPrv
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey depth XPrv
</span><a href="#local-6989586621682437588"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                 HD derivation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- This instance is unsound. It only exists because we need to derive the</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- reward account in the wallet engine when making transaction (in case there</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- are any withdrawals).</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- With 'ByronKey', withdrawals will always be `0`, and the result of this</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- function shouldn't be evaluated (relying on laziness here). If they do, then</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- we're doing something wrong.</span><span>
</span><span id="line-328"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">W.HardDerivation</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="AddressIndexDerivationType"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-var">AddressIndexDerivationType</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WholeDomain"><span class="hs-identifier hs-type">WholeDomain</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>    </span><span id="local-6989586621682437583"><span class="annot"><span class="annottext">deriveAccountPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; ByronKey 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; ByronKey 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAccountPrivateKey</span></a></span></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByronKey 'AccountK XPrv
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsound evaluation of 'deriveAccountPrivateKey' in the context of Byron key&quot;</span></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621682437581"><span class="annot"><span class="annottext">deriveAddressPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; ByronKey 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType ByronKey) 'AddressK
-&gt; ByronKey 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPrivateKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAddressPrivateKey</span></a></span></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Index (AddressIndexDerivationType ByronKey) 'AddressK
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByronKey 'AddressK XPrv
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span>
</span><span id="line-335"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsound evaluation of 'deriveAddressPrivateKey' in the context of Byron key&quot;</span></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-comment">-- | Derives account private key from the given root private key, using</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- derivation scheme 1.</span><span>
</span><span id="line-339"></span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- NOTE: The caller is expected to provide the corresponding passphrase (and to</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- have checked that the passphrase is valid). Providing a wrong passphrase will</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- not make the function fail but will instead, yield an incorrect new key that</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- doesn't belong to the wallet.</span><span>
</span><span id="line-344"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#deriveAccountPrivateKey"><span class="hs-identifier hs-type">deriveAccountPrivateKey</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WholeDomain"><span class="hs-identifier hs-type">WholeDomain</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-349"></span><span id="deriveAccountPrivateKey"><span class="annot"><span class="annottext">deriveAccountPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; ByronKey 'RootK XPrv
-&gt; Index 'WholeDomain 'AccountK
-&gt; ByronKey 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var hs-var">deriveAccountPrivateKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682437579"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437579"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682437578"><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682437578"><span class="hs-identifier hs-var">masterKey</span></a></span></span><span> </span><span id="local-6989586621682437577"><span class="annot"><span class="annottext">idx :: Index 'WholeDomain 'AccountK
</span><a href="#local-6989586621682437577"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682437575"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682437575"><span class="hs-identifier hs-var">accIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey :: forall (depth :: Depth) key.
key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getKey :: XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme1</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437579"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv -&gt; XPrv
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682437578"><span class="hs-identifier hs-var">masterKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682437575"><span class="hs-identifier hs-var">accIx</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">derivationPath :: DerivationPathFrom 'AccountK
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AccountK
DerivationPathFrom 'AccountK
</span><a href="#local-6989586621682437577"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">payloadPassphrase :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var">payloadPassphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (depth :: Depth) key.
ByronKey depth key -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var hs-var">payloadPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682437578"><span class="hs-identifier hs-var">masterKey</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-comment">-- | Derives address private key from the given account private key, using</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- derivation scheme 1.</span><span>
</span><span id="line-357"></span><span class="hs-comment">--</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- NOTE: The caller is expected to provide the corresponding passphrase (and to</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- have checked that the passphrase is valid). Providing a wrong passphrase will</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- not make the function fail but will instead, yield an incorrect new key that</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- doesn't belong to the wallet.</span><span>
</span><span id="line-362"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#deriveAddressPrivateKey"><span class="hs-identifier hs-type">deriveAddressPrivateKey</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WholeDomain"><span class="hs-identifier hs-type">WholeDomain</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-367"></span><span id="deriveAddressPrivateKey"><span class="annot"><span class="annottext">deriveAddressPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; ByronKey 'AccountK XPrv
-&gt; Index 'WholeDomain 'AddressK
-&gt; ByronKey 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#deriveAddressPrivateKey"><span class="hs-identifier hs-var hs-var">deriveAddressPrivateKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682437574"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437574"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682437573"><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv
</span><a href="#local-6989586621682437573"><span class="hs-identifier hs-var">accountKey</span></a></span></span><span> </span><span id="local-6989586621682437572"><span class="annot"><span class="annottext">idx :: Index 'WholeDomain 'AddressK
</span><a href="#local-6989586621682437572"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682437571"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682437571"><span class="hs-identifier hs-var">addrIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey :: forall (depth :: Depth) key.
key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getKey :: XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationScheme -&gt; ScrubbedBytes -&gt; XPrv -&gt; Word32 -&gt; XPrv
forall passPhrase.
ByteArrayAccess passPhrase =&gt;
DerivationScheme -&gt; passPhrase -&gt; XPrv -&gt; Word32 -&gt; XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">deriveXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationScheme
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">DerivationScheme1</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437574"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv -&gt; XPrv
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv
</span><a href="#local-6989586621682437573"><span class="hs-identifier hs-var">accountKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682437571"><span class="hs-identifier hs-var">addrIx</span></a></span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">derivationPath :: DerivationPathFrom 'AddressK
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv -&gt; DerivationPathFrom 'AccountK
forall (depth :: Depth) key.
ByronKey depth key -&gt; DerivationPathFrom depth
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#derivationPath"><span class="hs-identifier hs-var hs-var">derivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv
</span><a href="#local-6989586621682437573"><span class="hs-identifier hs-var">accountKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index 'WholeDomain 'AddressK
</span><a href="#local-6989586621682437572"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">payloadPassphrase :: Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var">payloadPassphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (depth :: Depth) key.
ByronKey depth key -&gt; Passphrase &quot;addr-derivation-payload&quot;
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#payloadPassphrase"><span class="hs-identifier hs-var hs-var">payloadPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'AccountK XPrv
</span><a href="#local-6989586621682437573"><span class="hs-identifier hs-var">accountKey</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                          Storing and retrieving keys
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPrivateKey"><span class="hs-identifier hs-type">PersistPrivateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621682437567"><span class="annot"><span class="annottext">serializeXPrv :: (ByronKey 'RootK XPrv, PassphraseHash) -&gt; (ByteString, ByteString)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#serializeXPrv"><span class="hs-identifier hs-var hs-var hs-var hs-var">serializeXPrv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span id="local-6989586621682437565"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437565"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">DerivationPathFrom 'RootK
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span id="local-6989586621682437564"><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437564"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682437563"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682437563"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall a. ByteArrayAccess a =&gt; a -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPrv -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437565"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ByteString
forall a. ByteArrayAccess a =&gt; a -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes
</span><a href="#local-6989586621682437564"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ByteString
forall a. ByteArrayAccess a =&gt; a -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; ByteString)
-&gt; (PassphraseHash -&gt; ScrubbedBytes)
-&gt; PassphraseHash
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash -&gt; ScrubbedBytes
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#getPassphraseHash"><span class="hs-identifier hs-var hs-var">getPassphraseHash</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseHash -&gt; ByteString) -&gt; PassphraseHash -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682437563"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621682437561"><span class="annot"><span class="annottext">unsafeDeserializeXPrv :: (ByteString, ByteString) -&gt; (ByronKey 'RootK XPrv, PassphraseHash)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#unsafeDeserializeXPrv"><span class="hs-identifier hs-var hs-var hs-var hs-var">unsafeDeserializeXPrv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682437559"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437559"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682437558"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437558"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; (ByronKey 'RootK XPrv, PassphraseHash))
-&gt; ((ByronKey 'RootK XPrv, PassphraseHash)
    -&gt; (ByronKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (ByronKey 'RootK XPrv, PassphraseHash)
-&gt; (ByronKey 'RootK XPrv, PassphraseHash)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; (ByronKey 'RootK XPrv, PassphraseHash)
forall p a. p -&gt; a
</span><a href="#local-6989586621682437556"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(ByronKey 'RootK XPrv, PassphraseHash)
-&gt; (ByronKey 'RootK XPrv, PassphraseHash)
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String (ByronKey 'RootK XPrv, PassphraseHash)
 -&gt; (ByronKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (ByronKey 'RootK XPrv, PassphraseHash)
-&gt; (ByronKey 'RootK XPrv, PassphraseHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><span class="annottext">(ByronKey 'RootK XPrv
 -&gt; PassphraseHash -&gt; (ByronKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (ByronKey 'RootK XPrv)
-&gt; Either
     String (PassphraseHash -&gt; (ByronKey 'RootK XPrv, PassphraseHash))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((XPrv, Passphrase &quot;addr-derivation-payload&quot;)
 -&gt; ByronKey 'RootK XPrv)
-&gt; Either String (XPrv, Passphrase &quot;addr-derivation-payload&quot;)
-&gt; Either String (ByronKey 'RootK XPrv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv, Passphrase &quot;addr-derivation-payload&quot;)
-&gt; ByronKey 'RootK XPrv
forall (depth :: Depth) key.
(DerivationPathFrom depth ~ ()) =&gt;
(key, Passphrase &quot;addr-derivation-payload&quot;) -&gt; ByronKey depth key
</span><a href="#local-6989586621682437553"><span class="hs-identifier hs-var">mkKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
-&gt; Either String (XPrv, Passphrase &quot;addr-derivation-payload&quot;)
</span><a href="#local-6989586621682437552"><span class="hs-identifier hs-var">deserializeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437559"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>        </span><span class="annot"><span class="annottext">Either
  String (PassphraseHash -&gt; (ByronKey 'RootK XPrv, PassphraseHash))
-&gt; Either String PassphraseHash
-&gt; Either String (ByronKey 'RootK XPrv, PassphraseHash)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; PassphraseHash)
-&gt; Either String ScrubbedBytes -&gt; Either String PassphraseHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; PassphraseHash
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-var">PassphraseHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either String ScrubbedBytes
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437558"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>        </span><span id="local-6989586621682437556"><span class="annot"><span class="annottext">err :: p -&gt; a
</span><a href="#local-6989586621682437556"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeDeserializeXPrv: unable to deserialize ByronKey&quot;</span></span><span>
</span><span id="line-388"></span><span>        </span><span id="local-6989586621682437553"><span class="annot"><span class="annottext">mkKey :: (key, Passphrase &quot;addr-derivation-payload&quot;) -&gt; ByronKey depth key
</span><a href="#local-6989586621682437553"><span class="hs-identifier hs-var hs-var">mkKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682437550"><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621682437550"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682437549"><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437549"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
forall (depth :: Depth) key.
key
-&gt; DerivationPathFrom depth
-&gt; Passphrase &quot;addr-derivation-payload&quot;
-&gt; ByronKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-var">ByronKey</span></a></span><span> </span><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621682437550"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;addr-derivation-payload&quot;
</span><a href="#local-6989586621682437549"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="annot"><a href="#local-6989586621682437552"><span class="hs-identifier hs-type">deserializeKey</span></a></span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-392"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-393"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addr-derivation-payload&quot;</span></span><span>
</span><span id="line-394"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>        </span><span id="local-6989586621682437552"><span class="annot"><span class="annottext">deserializeKey :: ByteString
-&gt; Either String (XPrv, Passphrase &quot;addr-derivation-payload&quot;)
</span><a href="#local-6989586621682437552"><span class="hs-identifier hs-var hs-var">deserializeKey</span></a></span></span><span> </span><span id="local-6989586621682437548"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437548"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String ByteString)
-&gt; [ByteString] -&gt; [Either String ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray ByteString =&gt; ByteString -&gt; Either String ByteString
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; ByteString -&gt; [ByteString]
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">B8.split</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437548"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682437546"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437546"><span class="hs-identifier hs-var">rawK</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682437545"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437545"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPrv
forall bin. ByteArrayAccess bin =&gt; bin -&gt; Either String XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437546"><span class="hs-identifier hs-var">rawK</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682437544"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437544"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(XPrv, Passphrase &quot;addr-derivation-payload&quot;)
-&gt; Either String (XPrv, Passphrase &quot;addr-derivation-payload&quot;)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682437544"><span class="hs-identifier hs-var">k'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Passphrase &quot;addr-derivation-payload&quot;
forall (purpose :: Symbol). ScrubbedBytes -&gt; Passphrase purpose
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-var">Passphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682437545"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682437543"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682437543"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Either String (XPrv, Passphrase &quot;addr-derivation-payload&quot;)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682437543"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-400"></span><span>            </span><span class="annot"><span class="annottext">[Either String ByteString]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>                </span><span class="annot"><span class="annottext">String
-&gt; Either String (XPrv, Passphrase &quot;addr-derivation-payload&quot;)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Key input must be two hex strings separated by :&quot;</span></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                     Utils
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-comment">-- | Transform the wrapped key.</span><span>
</span><span id="line-408"></span><span id="local-6989586621682437876"><span id="local-6989586621682437877"><span id="local-6989586621682437878"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mapKey"><span class="hs-identifier hs-type">mapKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682437878"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682437877"><span class="hs-identifier hs-type">key'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437876"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437878"><span class="hs-identifier hs-type">key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437876"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682437877"><span class="hs-identifier hs-type">key'</span></a></span></span></span></span><span>
</span><span id="line-409"></span><span id="mapKey"><span class="annot"><span class="annottext">mapKey :: (key -&gt; key') -&gt; ByronKey depth key -&gt; ByronKey depth key'
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mapKey"><span class="hs-identifier hs-var hs-var">mapKey</span></a></span></span><span> </span><span id="local-6989586621682437542"><span class="annot"><span class="annottext">key -&gt; key'
</span><a href="#local-6989586621682437542"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682437541"><span class="annot"><span class="annottext">ByronKey depth key
</span><a href="#local-6989586621682437541"><span class="hs-identifier hs-var">rnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronKey depth key
</span><a href="#local-6989586621682437541"><span class="hs-identifier hs-var">rnd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getKey :: key'
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">key -&gt; key'
</span><a href="#local-6989586621682437542"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey depth key -&gt; key
forall (depth :: Depth) raw. ByronKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey depth key
</span><a href="#local-6989586621682437541"><span class="hs-identifier hs-var">rnd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-410"></span></pre></body></html>