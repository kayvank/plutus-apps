<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- Copyright: &#169; 2018-2020 IOHK</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- API handlers and server using the underlying wallet layer to provide</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- endpoints reachable through HTTP.</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.Api.Server</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Server Configuration</span></span><span>
</span><span id="line-29"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#Listen"><span class="hs-identifier">Listen</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenError"><span class="hs-identifier">ListenError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">HostPreference</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.Tls.html#TlsConfiguration"><span class="hs-identifier">TlsConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Server Setup</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#start"><span class="hs-identifier">start</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">serve</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withListeningSocket"><span class="hs-identifier">withListeningSocket</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- * ApiLayer</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#newApiLayer"><span class="hs-identifier">newApiLayer</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Handlers</span></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#delegationFee"><span class="hs-identifier">delegationFee</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#deleteTransaction"><span class="hs-identifier">deleteTransaction</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#deleteWallet"><span class="hs-identifier">deleteWallet</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#derivePublicKey"><span class="hs-identifier">derivePublicKey</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getNetworkClock"><span class="hs-identifier">getNetworkClock</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getNetworkInformation"><span class="hs-identifier">getNetworkInformation</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getNetworkParameters"><span class="hs-identifier">getNetworkParameters</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getUTxOsStatistics"><span class="hs-identifier">getUTxOsStatistics</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getWalletUtxoSnapshot"><span class="hs-identifier">getWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier">getWallet</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#joinStakePool"><span class="hs-identifier">joinStakePool</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listAssets"><span class="hs-identifier">listAssets</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getAsset"><span class="hs-identifier">getAsset</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getAssetDefault"><span class="hs-identifier">getAssetDefault</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listAddresses"><span class="hs-identifier">listAddresses</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listTransactions"><span class="hs-identifier">listTransactions</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getTransaction"><span class="hs-identifier">getTransaction</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#constructTransaction"><span class="hs-identifier">constructTransaction</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listWallets"><span class="hs-identifier">listWallets</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listStakeKeys"><span class="hs-identifier">listStakeKeys</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#createMigrationPlan"><span class="hs-identifier">createMigrationPlan</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#migrateWallet"><span class="hs-identifier">migrateWallet</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postExternalTransaction"><span class="hs-identifier">postExternalTransaction</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postIcarusWallet"><span class="hs-identifier">postIcarusWallet</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postLedgerWallet"><span class="hs-identifier">postLedgerWallet</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postRandomAddress"><span class="hs-identifier">postRandomAddress</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postRandomWallet"><span class="hs-identifier">postRandomWallet</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postRandomWalletFromXPrv"><span class="hs-identifier">postRandomWalletFromXPrv</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#signTransaction"><span class="hs-identifier">signTransaction</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postTransactionOld"><span class="hs-identifier">postTransactionOld</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postTransactionFeeOld"><span class="hs-identifier">postTransactionFeeOld</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postTrezorWallet"><span class="hs-identifier">postTrezorWallet</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postWallet"><span class="hs-identifier">postWallet</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postShelleyWallet"><span class="hs-identifier">postShelleyWallet</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postAccountWallet"><span class="hs-identifier">postAccountWallet</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putByronWalletPassphrase"><span class="hs-identifier">putByronWalletPassphrase</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putRandomAddress"><span class="hs-identifier">putRandomAddress</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putRandomAddresses"><span class="hs-identifier">putRandomAddresses</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putWallet"><span class="hs-identifier">putWallet</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putWalletPassphrase"><span class="hs-identifier">putWalletPassphrase</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#quitStakePool"><span class="hs-identifier">quitStakePool</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#selectCoins"><span class="hs-identifier">selectCoins</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#selectCoinsForJoin"><span class="hs-identifier">selectCoinsForJoin</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#selectCoinsForQuit"><span class="hs-identifier">selectCoinsForQuit</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#signMetadata"><span class="hs-identifier">signMetadata</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postAccountPublicKey"><span class="hs-identifier">postAccountPublicKey</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getAccountPublicKey"><span class="hs-identifier">getAccountPublicKey</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postSharedWallet"><span class="hs-identifier">postSharedWallet</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#patchSharedWallet"><span class="hs-identifier">patchSharedWallet</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkSharedWallet"><span class="hs-identifier">mkSharedWallet</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#balanceTransaction"><span class="hs-identifier">balanceTransaction</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#decodeTransaction"><span class="hs-identifier">decodeTransaction</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#submitTransaction"><span class="hs-identifier">submitTransaction</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getPolicyKey"><span class="hs-identifier">getPolicyKey</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postPolicyKey"><span class="hs-identifier">postPolicyKey</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postPolicyId"><span class="hs-identifier">postPolicyId</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#constructSharedTransaction"><span class="hs-identifier">constructSharedTransaction</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#decodeSharedTransaction"><span class="hs-identifier">decodeSharedTransaction</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Server error responses</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier">IsServerError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier">liftHandler</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier">apiError</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internals</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkShelleyWallet"><span class="hs-identifier">mkShelleyWallet</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkLegacyWallet"><span class="hs-identifier">mkLegacyWallet</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer"><span class="hs-identifier">withLegacyLayer</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer%27"><span class="hs-identifier">withLegacyLayer'</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#rndStateChange"><span class="hs-identifier">rndStateChange</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier">withWorkerCtx</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getCurrentEpoch"><span class="hs-identifier">getCurrentEpoch</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Workers</span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier">manageRewardBalance</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier">idleWorker</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Logging</span></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#WalletEngineLog"><span class="hs-identifier">WalletEngineLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Derivation</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">XPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">xpubPublicKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">xpubToBytes</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Script</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cosigner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">ScriptTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">ValidationLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">foldScript</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">validateScriptOfTemplate</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">NetworkId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">SerialiseAsCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">toNetworkMagic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ouroboros-network/html/src"><span class="hs-identifier">unNetworkMagic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Api.Extra.html"><span class="hs-identifier">Cardano.Api.Extra</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Api.Extra.html#asAnyShelleyBasedEra"><span class="hs-identifier">asAnyShelleyBasedEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Extra.html#inAnyCardanoEra"><span class="hs-identifier">inAnyCardanoEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Extra.html#withShelleyBasedTx"><span class="hs-identifier">withShelleyBasedTx</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Tracing</span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">HasPrivacyAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HasSeverityAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxInfo</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier">TranslationError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier">TimeTranslationPastHorizon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier">TranslationLogicMissingInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">SomeMnemonic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.html"><span class="hs-identifier">Cardano.Wallet</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier">ErrAddCosignerKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier">ErrBalanceTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier">ErrBalanceTxInternalError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotJoin"><span class="hs-identifier">ErrCannotJoin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotQuit"><span class="hs-identifier">ErrCannotQuit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWallet"><span class="hs-identifier">ErrConstructSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier">ErrConstructTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlan"><span class="hs-identifier">ErrCreateMigrationPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateRandomAddress"><span class="hs-identifier">ErrCreateRandomAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTx"><span class="hs-identifier">ErrDecodeTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKey"><span class="hs-identifier">ErrDerivePublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewards"><span class="hs-identifier">ErrFetchRewards</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyId"><span class="hs-identifier">ErrGetPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransaction"><span class="hs-identifier">ErrGetTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#ErrImportAddress"><span class="hs-identifier">ErrImportAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrImportRandomAddress"><span class="hs-identifier">ErrImportRandomAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactions"><span class="hs-identifier">ErrListTransactions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatistics"><span class="hs-identifier">ErrListUTxOStatistics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransaction"><span class="hs-identifier">ErrMkTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier">ErrNoSuchTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrNotASequentialWallet"><span class="hs-identifier">ErrNotASequentialWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier">ErrPostTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKey"><span class="hs-identifier">ErrReadAccountPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKey"><span class="hs-identifier">ErrReadPolicyPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier">ErrReadRewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier">ErrRemoveTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier">ErrSelectAssets</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWith"><span class="hs-identifier">ErrSignMetadataWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPayment"><span class="hs-identifier">ErrSignPayment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegation"><span class="hs-identifier">ErrStakePoolDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier">ErrStartTimeLaterThanEndTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransaction"><span class="hs-identifier">ErrSubmitTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTx"><span class="hs-identifier">ErrSubmitTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphrase"><span class="hs-identifier">ErrUpdatePassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrUpdateSealedTx"><span class="hs-identifier">ErrUpdateSealedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier">ErrWalletAlreadyExists</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier">ErrWalletNotResponding</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier">ErrWithRootKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier">ErrWithdrawalNotWorth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTx"><span class="hs-identifier">ErrWitnessTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKey"><span class="hs-identifier">ErrWritePolicyPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#ErrWrongPassphrase"><span class="hs-identifier">ErrWrongPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier">FeeEstimation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier">HasNetworkLayer</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier">TxSubmitLog</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier">genesisData</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier">manageRewardBalance</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier">networkLayer</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html"><span class="hs-identifier">Cardano.Wallet.Address.Book</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier">AddressBookIso</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html"><span class="hs-identifier">Cardano.Wallet.Api</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier">ApiLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier">HasDBFactory</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasTokenMetadataClient"><span class="hs-identifier">HasTokenMetadataClient</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier">HasWorkerRegistry</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#WalletLock"><span class="hs-identifier">WalletLock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#dbFactory"><span class="hs-identifier">dbFactory</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#tokenMetadataClient"><span class="hs-identifier">tokenMetadataClient</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#walletLocks"><span class="hs-identifier">walletLocks</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#workerRegistry"><span class="hs-identifier">workerRegistry</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.Tls.html"><span class="hs-identifier">Cardano.Wallet.Api.Server.Tls</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.Tls.html#TlsConfiguration"><span class="hs-identifier">TlsConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.Tls.html#requireClientAuth"><span class="hs-identifier">requireClientAuth</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html"><span class="hs-identifier">Cardano.Wallet.Api.Types</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AccountPostData"><span class="hs-identifier">AccountPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AddressAmount"><span class="hs-identifier">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AddressAmountNoAssets"><span class="hs-identifier">AddressAmountNoAssets</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAccountPublicKey"><span class="hs-identifier">ApiAccountPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiActiveSharedWallet"><span class="hs-identifier">ApiActiveSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAddress"><span class="hs-identifier">ApiAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAnyCertificate"><span class="hs-identifier">ApiAnyCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAsArray"><span class="hs-identifier">ApiAsArray</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAsset"><span class="hs-identifier">ApiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAssetMintBurn"><span class="hs-identifier">ApiAssetMintBurn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBalanceTransactionPostData"><span class="hs-identifier">ApiBalanceTransactionPostData</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockInfo"><span class="hs-identifier">ApiBlockInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier">ApiBlockReference</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBurnData"><span class="hs-identifier">ApiBurnData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier">ApiByronWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWalletBalance"><span class="hs-identifier">ApiByronWalletBalance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBytesT"><span class="hs-identifier">ApiBytesT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCertificate"><span class="hs-identifier">ApiCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier">ApiCoinSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionChange"><span class="hs-identifier">ApiCoinSelectionChange</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionCollateral"><span class="hs-identifier">ApiCoinSelectionCollateral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionOutput"><span class="hs-identifier">ApiCoinSelectionOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionWithdrawal"><span class="hs-identifier">ApiCoinSelectionWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransaction"><span class="hs-identifier">ApiConstructTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransactionData"><span class="hs-identifier">ApiConstructTransactionData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiDecodedTransaction"><span class="hs-identifier">ApiDecodedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiDeregisterPool"><span class="hs-identifier">ApiDeregisterPool</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiEpochInfo"><span class="hs-identifier">ApiEpochInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiEpochInfo"><span class="hs-identifier">ApiEpochInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiErrorCode"><span class="hs-identifier">ApiErrorCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiExternalCertificate"><span class="hs-identifier">ApiExternalCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiExternalInput"><span class="hs-identifier">ApiExternalInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiFee"><span class="hs-identifier">ApiFee</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiForeignStakeKey"><span class="hs-identifier">ApiForeignStakeKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier">ApiMintBurnData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnOperation"><span class="hs-identifier">ApiMintBurnOperation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintData"><span class="hs-identifier">ApiMintData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMnemonicT"><span class="hs-identifier">ApiMnemonicT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMultiDelegationAction"><span class="hs-identifier">ApiMultiDelegationAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNetworkClock"><span class="hs-identifier">ApiNetworkClock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNetworkInformation"><span class="hs-identifier">ApiNetworkInformation</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNetworkParameters"><span class="hs-identifier">ApiNetworkParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNullStakeKey"><span class="hs-identifier">ApiNullStakeKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiOurStakeKey"><span class="hs-identifier">ApiOurStakeKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPaymentDestination"><span class="hs-identifier">ApiPaymentDestination</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPendingSharedWallet"><span class="hs-identifier">ApiPendingSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPolicyId"><span class="hs-identifier">ApiPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPolicyKey"><span class="hs-identifier">ApiPolicyKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPoolId"><span class="hs-identifier">ApiPoolId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostAccountKeyDataWithPurpose"><span class="hs-identifier">ApiPostAccountKeyDataWithPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostPolicyIdData"><span class="hs-identifier">ApiPostPolicyIdData</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostPolicyKeyData"><span class="hs-identifier">ApiPostPolicyKeyData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostRandomAddressData"><span class="hs-identifier">ApiPostRandomAddressData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPutAddressesData"><span class="hs-identifier">ApiPutAddressesData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiRedeemer"><span class="hs-identifier">ApiRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiRegisterPool"><span class="hs-identifier">ApiRegisterPool</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiScriptTemplateEntry"><span class="hs-identifier">ApiScriptTemplateEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSelectCoinsPayments"><span class="hs-identifier">ApiSelectCoinsPayments</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier">ApiSerialisedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier">ApiSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPatchData"><span class="hs-identifier">ApiSharedWalletPatchData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostData"><span class="hs-identifier">ApiSharedWalletPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostDataFromAccountPubX"><span class="hs-identifier">ApiSharedWalletPostDataFromAccountPubX</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostDataFromMnemonics"><span class="hs-identifier">ApiSharedWalletPostDataFromMnemonics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSignTransactionPostData"><span class="hs-identifier">ApiSignTransactionPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSlotId"><span class="hs-identifier">ApiSlotId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSlotReference"><span class="hs-identifier">ApiSlotReference</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiStakeKeyIndex"><span class="hs-identifier">ApiStakeKeyIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiStakeKeys"><span class="hs-identifier">ApiStakeKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTokenAmountFingerprint"><span class="hs-identifier">ApiTokenAmountFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTokens"><span class="hs-identifier">ApiTokens</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier">ApiTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxCollateral"><span class="hs-identifier">ApiTxCollateral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier">ApiTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxInput"><span class="hs-identifier">ApiTxInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxInputGeneral"><span class="hs-identifier">ApiTxInputGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxMetadata"><span class="hs-identifier">ApiTxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxOutputGeneral"><span class="hs-identifier">ApiTxOutputGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiUtxoStatistics"><span class="hs-identifier">ApiUtxoStatistics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityBound"><span class="hs-identifier">ApiValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityInterval"><span class="hs-identifier">ApiValidityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWallet"><span class="hs-identifier">ApiWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletAssetsBalance"><span class="hs-identifier">ApiWalletAssetsBalance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletBalance"><span class="hs-identifier">ApiWalletBalance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegation"><span class="hs-identifier">ApiWalletDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegationNext"><span class="hs-identifier">ApiWalletDelegationNext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegationStatus"><span class="hs-identifier">ApiWalletDelegationStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier">ApiWalletInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationBalance"><span class="hs-identifier">ApiWalletMigrationBalance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlan"><span class="hs-identifier">ApiWalletMigrationPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlanPostData"><span class="hs-identifier">ApiWalletMigrationPlanPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPostData"><span class="hs-identifier">ApiWalletMigrationPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMode"><span class="hs-identifier">ApiWalletMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletOutput"><span class="hs-identifier">ApiWalletOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphrase"><span class="hs-identifier">ApiWalletPassphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphraseInfo"><span class="hs-identifier">ApiWalletPassphraseInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletSignData"><span class="hs-identifier">ApiWalletSignData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshot"><span class="hs-identifier">ApiWalletUtxoSnapshot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshotEntry"><span class="hs-identifier">ApiWalletUtxoSnapshotEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawal"><span class="hs-identifier">ApiWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalGeneral"><span class="hs-identifier">ApiWithdrawalGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalPostData"><span class="hs-identifier">ApiWithdrawalPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletFromXPrvPostData"><span class="hs-identifier">ByronWalletFromXPrvPostData</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPostData"><span class="hs-identifier">ByronWalletPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPutPassphraseData"><span class="hs-identifier">ByronWalletPutPassphraseData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Iso8601Time"><span class="hs-identifier">Iso8601Time</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KeyFormat"><span class="hs-identifier">KeyFormat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KnownDiscovery"><span class="hs-identifier">KnownDiscovery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#MinWithdrawal"><span class="hs-identifier">MinWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#PostTransactionFeeOldData"><span class="hs-identifier">PostTransactionFeeOldData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#PostTransactionOldData"><span class="hs-identifier">PostTransactionOldData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ResourceContext"><span class="hs-identifier">ResourceContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#VerificationKeyHashing"><span class="hs-identifier">VerificationKeyHashing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletOrAccountPostData"><span class="hs-identifier">WalletOrAccountPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPostData"><span class="hs-identifier">WalletPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutData"><span class="hs-identifier">WalletPutData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutPassphraseData"><span class="hs-identifier">WalletPutPassphraseData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#XPubOrSelf"><span class="hs-identifier">XPubOrSelf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#coinFromQuantity"><span class="hs-identifier">coinFromQuantity</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier">coinToQuantity</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiMnemonicT%3AApiMnemonicT"><span class="hs-identifier">getApiMnemonicT</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#toApiAsset"><span class="hs-identifier">toApiAsset</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#toApiEpochInfo"><span class="hs-identifier">toApiEpochInfo</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#toApiEra"><span class="hs-identifier">toApiEra</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#toApiNetworkParameters"><span class="hs-identifier">toApiNetworkParameters</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#toApiUtxoStatistics"><span class="hs-identifier">toApiUtxoStatistics</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html"><span class="hs-identifier">Cardano.Wallet.Api.Types.SchemaMetadata</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataSchema"><span class="hs-identifier">TxMetadataSchema</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataWithSchema"><span class="hs-identifier">TxMetadataWithSchema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataWithSchema"><span class="hs-identifier">TxMetadataWithSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html"><span class="hs-identifier">Cardano.Wallet.CoinSelection</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionBalanceError"><span class="hs-identifier">SelectionBalanceError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionCollateralError"><span class="hs-identifier">SelectionCollateralError</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionError"><span class="hs-identifier">SelectionError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#SelectionOf"><span class="hs-identifier">SelectionOf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputCoinInsufficientError"><span class="hs-identifier">SelectionOutputCoinInsufficientError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputError"><span class="hs-identifier">SelectionOutputError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputSizeExceedsLimitError"><span class="hs-identifier">SelectionOutputSizeExceedsLimitError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputTokenQuantityExceedsLimitError"><span class="hs-identifier">SelectionOutputTokenQuantityExceedsLimitError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategy"><span class="hs-identifier">SelectionStrategy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier">WalletSelectionContext</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#balanceMissing"><span class="hs-identifier">balanceMissing</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#selectionDelta"><span class="hs-identifier">selectionDelta</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#%24sel%3Ashortfall%3AUnableToConstructChangeError"><span class="hs-identifier">shortfall</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Compat.html"><span class="hs-identifier">Cardano.Wallet.Compat</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator">(^?)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html"><span class="hs-identifier">Cardano.Wallet.DB</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBFactory"><span class="hs-identifier">DBFactory</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html"><span class="hs-identifier">Cardano.Wallet.Network</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier">NetworkLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#fetchRewardAccountBalances"><span class="hs-identifier">fetchRewardAccountBalances</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier">timeInterpreter</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier">BoundedAddressLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier">DelegationAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier">Depth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationType"><span class="hs-identifier">DerivationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier">HardDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier">MkKeyFingerprint</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier">NetworkDiscriminant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier">RewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier">Role</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier">SoftDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier">WalletKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveRewardAccount"><span class="hs-identifier">deriveRewardAccount</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier">digest</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier">publicKey</span></a></span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Byron</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier">ByronKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mkByronKeyFromMasterKey"><span class="hs-identifier">mkByronKeyFromMasterKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Icarus</span></a></span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier">IcarusKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.MintBurn</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#scriptSlotIntervals"><span class="hs-identifier">scriptSlotIntervals</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#toTokenMapAndScript"><span class="hs-identifier">toTokenMapAndScript</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#toTokenPolicyId"><span class="hs-identifier">toTokenPolicyId</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#withinSlotInterval"><span class="hs-identifier">withinSlotInterval</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.SharedKey</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier">SharedKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Shelley</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier">ShelleyKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#CompareDiscovery"><span class="hs-identifier">CompareDiscovery</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier">GenChange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier">ArgGenChange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier">GetAccount</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier">GetPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier">IsOurs</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier">IsOwned</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#KnownAddresses"><span class="hs-identifier">KnownAddresses</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier">MaybeLight</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOwned"><span class="hs-identifier">isOwned</span></a></span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Random</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier">RndState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#mkRndState"><span class="hs-identifier">mkRndState</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Sequential</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationPrefix"><span class="hs-identifier">DerivationPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier">SeqState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier">defaultAddressPoolGap</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#getGap"><span class="hs-identifier">getGap</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#mkSeqStateFromAccountXPub"><span class="hs-identifier">mkSeqStateFromAccountXPub</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#mkSeqStateFromRootXPrv"><span class="hs-identifier">mkSeqStateFromRootXPrv</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeCIP1852"><span class="hs-identifier">purposeCIP1852</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Shared</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#CredentialType"><span class="hs-identifier">CredentialType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrAddCosigner"><span class="hs-identifier">ErrAddCosigner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrScriptTemplate"><span class="hs-identifier">ErrScriptTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier">SharedState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#mkSharedStateFromAccountXPub"><span class="hs-identifier">mkSharedStateFromAccountXPub</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#mkSharedStateFromRootXPrv"><span class="hs-identifier">mkSharedStateFromRootXPrv</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#toSharedWalletId"><span class="hs-identifier">toSharedWalletId</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#validateScriptTemplates"><span class="hs-identifier">validateScriptTemplates</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Delegation.UTxO.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Delegation.UTxO</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Delegation.UTxO.html#stakeKeyCoinDistr"><span class="hs-identifier">stakeKeyCoinDistr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Migration</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html#MigrationPlan"><span class="hs-identifier">MigrationPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Model</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier">Wallet</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#availableBalance"><span class="hs-identifier">availableBalance</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier">availableUTxO</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier">currentTip</span></a></span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier">getState</span></a></span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#totalBalance"><span class="hs-identifier">totalBalance</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#totalUTxO"><span class="hs-identifier">totalUTxO</span></a></span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier">Passphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseScheme"><span class="hs-identifier">PassphraseScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#WalletPassphraseInfo"><span class="hs-identifier">WalletPassphraseInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier">currentPassphraseScheme</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier">preparePassphrase</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Slotting</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier">PastHorizonException</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">RelativeTime</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier">TimeInterpreter</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#currentEpoch"><span class="hs-identifier">currentEpoch</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#currentRelativeTime"><span class="hs-identifier">currentRelativeTime</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#expectAndThrowFailures"><span class="hs-identifier">expectAndThrowFailures</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#hoistTimeInterpreter"><span class="hs-identifier">hoistTimeInterpreter</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier">interpretQuery</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier">neverFails</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#ongoingSlotAt"><span class="hs-identifier">ongoingSlotAt</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier">slotToUTCTime</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#snapshot"><span class="hs-identifier">snapshot</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#timeOfEpoch"><span class="hs-identifier">timeOfEpoch</span></a></span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#toSlotId"><span class="hs-identifier">toSlotId</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier">unsafeExtendSafeZone</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html"><span class="hs-identifier">Cardano.Wallet.Primitive.SyncProgress</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier">SyncProgress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier">Block</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier">BlockHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier">NetworkParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier">PoolId</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier">PoolLifeCycleStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Signature"><span class="hs-identifier">Signature</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SlotId"><span class="hs-identifier">SlotId</span></a></span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier">SortOrder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier">WalletId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier">WalletMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Address</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#AddressState"><span class="hs-identifier">AddressState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Hash</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier">Hash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Redeemer.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Redeemer</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#Redeemer"><span class="hs-identifier">Redeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#Flat"><span class="hs-identifier">Flat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier">TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier">AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#fromFlatList"><span class="hs-identifier">fromFlatList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#toNestedList"><span class="hs-identifier">toNestedList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenPolicy</span></a></span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenName"><span class="hs-identifier">TokenName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier">TokenPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#mkTokenFingerprint"><span class="hs-identifier">mkTokenFingerprint</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#nullTokenName"><span class="hs-identifier">nullTokenName</span></a></span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#tokenNameMaxLength"><span class="hs-identifier">tokenNameMaxLength</span></a></span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenQuantity</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#TokenQuantity"><span class="hs-identifier">TokenQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier">TransactionInfo</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier">Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxChange"><span class="hs-identifier">TxChange</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier">TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxStatus"><span class="hs-identifier">TxStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#UnsignedTx"><span class="hs-identifier">UnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#cardanoTxIdeallyNoLaterThan"><span class="hs-identifier">cardanoTxIdeallyNoLaterThan</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#getSealedTxWitnesses"><span class="hs-identifier">getSealedTxWitnesses</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#txMintBurnMaxTokenQuantity"><span class="hs-identifier">txMintBurnMaxTokenQuantity</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier">txOutCoin</span></a></span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html"><span class="hs-identifier">Cardano.Wallet.Registry</span></a></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html#HasWorkerCtx"><span class="hs-identifier">HasWorkerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html#MkWorker"><span class="hs-identifier">MkWorker</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerLog"><span class="hs-identifier">WorkerLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html#defaultWorkerAfter"><span class="hs-identifier">defaultWorkerAfter</span></a></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html#workerResource"><span class="hs-identifier">workerResource</span></a></span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.TokenMetadata.html"><span class="hs-identifier">Cardano.Wallet.TokenMetadata</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.TokenMetadata.html#TokenMetadataClient"><span class="hs-identifier">TokenMetadataClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.TokenMetadata.html#fillMetadata"><span class="hs-identifier">fillMetadata</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html"><span class="hs-identifier">Cardano.Wallet.Transaction</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#DelegationAction"><span class="hs-identifier">DelegationAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemers"><span class="hs-identifier">ErrAssignRedeemers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrSignTx"><span class="hs-identifier">ErrSignTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TokenMapWithScripts"><span class="hs-identifier">TokenMapWithScripts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier">TransactionCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier">TransactionLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier">Withdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier">defaultTransactionCtx</span></a></span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Unsafe.html"><span class="hs-identifier">Cardano.Wallet.Unsafe</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Unsafe.html#unsafeRunExceptT"><span class="hs-identifier">unsafeRunExceptT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Util.html"><span class="hs-identifier">Cardano.Wallet.Util</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Util.html#invariant"><span class="hs-identifier">invariant</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Arrow</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">second</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;&amp;&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">NFData</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../errors/html/src"><span class="hs-identifier">Control.Error.Util</span></a></span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../errors/html/src"><span class="hs-identifier">failWith</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forever</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">join</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">when</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&gt;=&gt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Except</span></a></span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">mapExceptT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">runExceptT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">throwE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">withExceptT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">MaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">exceptToMaybeT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">Control.Tracer</span></a></span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">Tracer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">contramap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.Hash.Utils.html"><span class="hs-identifier">Crypto.Hash.Utils</span></a></span><span>
</span><span id="line-555"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Crypto.Hash.Utils.html#blake2b224"><span class="hs-identifier">blake2b224</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-operator">(.=)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Coerce</span></a></span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">coerce</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Either</span></a></span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isLeft</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">Data.Either.Extra</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">eitherToMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor</span></a></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;&amp;&gt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor.Identity</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Identity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL.Lens</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Lens'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(.~)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Labels</span></a></span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isInfixOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isPrefixOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isSubsequenceOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">sortOn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(\\)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">catMaybes</span></a></span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromJust</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromMaybe</span></a></span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isJust</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isNothing</span></a></span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">maybeToList</span></a></span><span>
</span><span id="line-590"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-592"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Quantity.html"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">Data.Streaming.Network</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">HostPreference</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">bindPortTCP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">bindRandomPortTCP</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">Data.Text.Class</span></a></span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">FromText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">ToText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">Data.Time</span></a></span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">UTCTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Type.Equality</span></a></span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(:~:)</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(==)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">testEquality</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word32</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">listF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">pretty</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Stack</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">HasCallStack</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../http-media/html/src"><span class="hs-identifier">Network.HTTP.Media.RenderHeader</span></a></span><span>
</span><span id="line-616"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../http-media/html/src"><span class="hs-identifier">renderHeader</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">Network.HTTP.Types.Header</span></a></span><span>
</span><span id="line-618"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">hContentType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Ntp.html"><span class="hs-identifier">Network.Ntp</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ntp-client/html/src"><span class="hs-identifier">NtpClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Ntp.html#getNtpStatus"><span class="hs-identifier">getNtpStatus</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">Network.Socket</span></a></span><span>
</span><span id="line-622"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">Socket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">close</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Network.Wai</span></a></span><span>
</span><span id="line-624"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">pathInfo</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier">Network.Wai.Handler.Warp</span></a></span><span>
</span><span id="line-626"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier">Port</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html"><span class="hs-identifier">Network.Wai.Middleware.Logging</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier">ApiLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#newApiLoggerSettings"><span class="hs-identifier">newApiLoggerSettings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#obfuscateKeys"><span class="hs-identifier">obfuscateKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#withApiLogger"><span class="hs-identifier">withApiLogger</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.ServerError.html"><span class="hs-identifier">Network.Wai.Middleware.ServerError</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.ServerError.html#handleRawError"><span class="hs-identifier">handleRawError</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Numeric.Natural</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Natural</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Servant</span></a></span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Application</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier">JSON</span></a></span><span>
</span><span id="line-636"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier">NoContent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier">contentType</span></a></span><span>
</span><span id="line-638"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err400</span></a></span><span>
</span><span id="line-639"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err403</span></a></span><span>
</span><span id="line-640"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err404</span></a></span><span>
</span><span id="line-641"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err409</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err500</span></a></span><span>
</span><span id="line-643"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err501</span></a></span><span>
</span><span id="line-644"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">err503</span></a></span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">serve</span></a></span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Servant.Server</span></a></span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">ServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">runHandler</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">System.IO.Error</span></a></span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">ioeGetErrorType</span></a></span><span>
</span><span id="line-651"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isAlreadyInUseError</span></a></span><span>
</span><span id="line-652"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isDoesNotExistError</span></a></span><span>
</span><span id="line-653"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isPermissionError</span></a></span><span>
</span><span id="line-654"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isUserError</span></a></span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../random/html/src"><span class="hs-identifier">System.Random</span></a></span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../random/html/src"><span class="hs-identifier">getStdRandom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../random/html/src"><span class="hs-identifier">random</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Type.Reflection</span></a></span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">typeRep</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Async</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">race_</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Concurrent</span></a></span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">threadDelay</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">IOException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">bracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">tryAnyDeep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">tryJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-668"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.html"><span class="hs-identifier">Cardano.Wallet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-669"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html"><span class="hs-identifier">Cardano.Wallet.Api.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-670"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html"><span class="hs-identifier">Cardano.Wallet.DB</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-671"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html"><span class="hs-identifier">Cardano.Wallet.Network</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NW</span></span><span>
</span><span id="line-672"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Byron</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Byron</span></span><span>
</span><span id="line-673"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Icarus</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Icarus</span></span><span>
</span><span id="line-674"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Shared</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shared</span></span><span>
</span><span id="line-675"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-676"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Coin</span></span><span>
</span><span id="line-677"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenBundle</span></span><span>
</span><span id="line-678"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenMap</span></span><span>
</span><span id="line-679"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-680"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxO</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-681"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxOIndex</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxOIndex</span></span><span>
</span><span id="line-682"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxOSelection</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxOSelection</span></span><span>
</span><span id="line-683"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html"><span class="hs-identifier">Cardano.Wallet.Registry</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Registry</span></span><span>
</span><span id="line-684"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Control.Concurrent.Concierge.html"><span class="hs-identifier">Control.Concurrent.Concierge</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Concierge</span></span><span>
</span><span id="line-685"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-686"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-687"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-688"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-689"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-690"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-691"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-692"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-693"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-694"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-695"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier">Network.Wai.Handler.Warp</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Warp</span></span><span>
</span><span id="line-696"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../warp-tls/html/src"><span class="hs-identifier">Network.Wai.Handler.WarpTLS</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Warp</span></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-comment">-- | How the server should listen for incoming requests.</span><span>
</span><span id="line-699"></span><span class="hs-keyword">data</span><span> </span><span id="Listen"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#Listen"><span class="hs-identifier hs-var">Listen</span></a></span></span><span>
</span><span id="line-700"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ListenOnPort"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenOnPort"><span class="hs-identifier hs-var">ListenOnPort</span></a></span></span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Port</span></a></span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-comment">-- ^ Listen on given TCP port</span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ListenOnRandomPort"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenOnRandomPort"><span class="hs-identifier hs-var">ListenOnRandomPort</span></a></span></span><span>
</span><span id="line-703"></span><span>      </span><span class="hs-comment">-- ^ Listen on an unused TCP port, selected at random</span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682482681"><span id="local-6989586621682482683"><span id="local-6989586621682482685"><span class="annot"><span class="annottext">Int -&gt; Listen -&gt; ShowS
[Listen] -&gt; ShowS
Listen -&gt; String
(Int -&gt; Listen -&gt; ShowS)
-&gt; (Listen -&gt; String) -&gt; ([Listen] -&gt; ShowS) -&gt; Show Listen
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Listen] -&gt; ShowS
$cshowList :: [Listen] -&gt; ShowS
show :: Listen -&gt; String
$cshow :: Listen -&gt; String
showsPrec :: Int -&gt; Listen -&gt; ShowS
$cshowsPrec :: Int -&gt; Listen -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482676"><span id="local-6989586621682482678"><span class="annot"><span class="annottext">Listen -&gt; Listen -&gt; Bool
(Listen -&gt; Listen -&gt; Bool)
-&gt; (Listen -&gt; Listen -&gt; Bool) -&gt; Eq Listen
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Listen -&gt; Listen -&gt; Bool
$c/= :: Listen -&gt; Listen -&gt; Bool
== :: Listen -&gt; Listen -&gt; Bool
$c== :: Listen -&gt; Listen -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="hs-comment">-- | Start the application server, using the given settings and a bound socket.</span><span>
</span><span id="line-707"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#start"><span class="hs-identifier hs-type">start</span></a></span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Warp.Settings</span></a></span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span>
</span><span id="line-710"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.Tls.html#TlsConfiguration"><span class="hs-identifier hs-type">TlsConfiguration</span></a></span><span>
</span><span id="line-711"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Application</span></a></span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span id="start"><span class="annot"><span class="annottext">start :: Settings
-&gt; Tracer IO ApiLog
-&gt; Maybe TlsConfiguration
-&gt; Socket
-&gt; Application
-&gt; IO ()
</span><a href="Cardano.Wallet.Api.Server.html#start"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span id="local-6989586621682482674"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621682482674"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span id="local-6989586621682482673"><span class="annot"><span class="annottext">Tracer IO ApiLog
</span><a href="#local-6989586621682482673"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621682482672"><span class="annot"><span class="annottext">Maybe TlsConfiguration
</span><a href="#local-6989586621682482672"><span class="hs-identifier hs-var">tlsConfig</span></a></span></span><span> </span><span id="local-6989586621682482671"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621682482671"><span class="hs-identifier hs-var">socket</span></a></span></span><span> </span><span id="local-6989586621682482670"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621682482670"><span class="hs-identifier hs-var">application</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>    </span><span id="local-6989586621682482669"><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682482669"><span class="hs-identifier hs-var">logSettings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiLoggerSettings
</span><a href="Network.Wai.Middleware.Logging.html#newApiLoggerSettings"><span class="hs-identifier hs-var">newApiLoggerSettings</span></a></span><span> </span><span class="annot"><span class="annottext">IO ApiLoggerSettings
-&gt; (ApiLoggerSettings -&gt; ApiLoggerSettings) -&gt; IO ApiLoggerSettings
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Request -&gt; [Text]) -&gt; ApiLoggerSettings -&gt; ApiLoggerSettings
</span><a href="Network.Wai.Middleware.Logging.html#obfuscateKeys"><span class="hs-identifier hs-var">obfuscateKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Request -&gt; [Text]
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682482667"><span class="hs-identifier hs-var">sensitive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><span class="annottext">Application -&gt; IO ()
</span><a href="#local-6989586621682482666"><span class="hs-identifier hs-var">runSocket</span></a></span><span>
</span><span id="line-717"></span><span>        </span><span class="annot"><span class="annottext">(Application -&gt; IO ()) -&gt; Application -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Request -&gt; ServerError -&gt; ServerError) -&gt; Middleware
</span><a href="Network.Wai.Middleware.ServerError.html#handleRawError"><span class="hs-identifier hs-var">handleRawError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Request, ServerError) -&gt; ServerError)
-&gt; Request -&gt; ServerError -&gt; ServerError
forall a b c. ((a, b) -&gt; c) -&gt; a -&gt; b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">curry</span></a></span><span> </span><span class="annot"><span class="annottext">(Request, ServerError) -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>        </span><span class="annot"><span class="annottext">Middleware -&gt; Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO ApiLog -&gt; ApiLoggerSettings -&gt; Middleware
</span><a href="Network.Wai.Middleware.Logging.html#withApiLogger"><span class="hs-identifier hs-var">withApiLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO ApiLog
</span><a href="#local-6989586621682482673"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682482669"><span class="hs-identifier hs-var">logSettings</span></a></span><span>
</span><span id="line-719"></span><span>        </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621682482670"><span class="hs-identifier hs-var">application</span></a></span><span>
</span><span id="line-720"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-721"></span><span>    </span><span class="annot"><a href="#local-6989586621682482666"><span class="hs-identifier hs-type">runSocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621682482666"><span class="annot"><span class="annottext">runSocket :: Application -&gt; IO ()
</span><a href="#local-6989586621682482666"><span class="hs-identifier hs-var hs-var">runSocket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TlsConfiguration
</span><a href="#local-6989586621682482672"><span class="hs-identifier hs-var">tlsConfig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-723"></span><span>        </span><span class="annot"><span class="annottext">Maybe TlsConfiguration
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Socket -&gt; Application -&gt; IO ()
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">Warp.runSettingsSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621682482674"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621682482671"><span class="hs-identifier hs-var">socket</span></a></span><span>
</span><span id="line-724"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682482662"><span class="annot"><span class="annottext">TlsConfiguration
</span><a href="#local-6989586621682482662"><span class="hs-identifier hs-var">tls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; Settings -&gt; Socket -&gt; Application -&gt; IO ()
</span><a href="../../../../warp-tls/html/src"><span class="hs-identifier hs-var">Warp.runTLSSocket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TlsConfiguration -&gt; TLSSettings
</span><a href="Cardano.Wallet.Api.Server.Tls.html#requireClientAuth"><span class="hs-identifier hs-var">requireClientAuth</span></a></span><span> </span><span class="annot"><span class="annottext">TlsConfiguration
</span><a href="#local-6989586621682482662"><span class="hs-identifier hs-var">tls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621682482674"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621682482671"><span class="hs-identifier hs-var">socket</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>    </span><span class="annot"><a href="#local-6989586621682482667"><span class="hs-identifier hs-type">sensitive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-727"></span><span>    </span><span id="local-6989586621682482667"><span class="annot"><span class="annottext">sensitive :: [Text]
</span><a href="#local-6989586621682482667"><span class="hs-identifier hs-var hs-var">sensitive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-728"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;passphrase&quot;</span></span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;old_passphrase&quot;</span></span><span>
</span><span id="line-730"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;new_passphrase&quot;</span></span><span>
</span><span id="line-731"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;mnemonic_sentence&quot;</span></span><span>
</span><span id="line-732"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;mnemonic_second_factor&quot;</span></span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">-- | Run an action with a TCP socket bound to a port specified by the `Listen`</span><span>
</span><span id="line-736"></span><span class="hs-comment">-- parameter.</span><span>
</span><span id="line-737"></span><span id="local-6989586621682482660"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withListeningSocket"><span class="hs-identifier hs-type">withListeningSocket</span></a></span><span>
</span><span id="line-738"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-type">HostPreference</span></a></span><span>
</span><span id="line-739"></span><span>    </span><span class="hs-comment">-- ^ Which host to bind.</span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#Listen"><span class="hs-identifier hs-type">Listen</span></a></span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-comment">-- ^ Whether to listen on a given port, or random port.</span><span>
</span><span id="line-742"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenError"><span class="hs-identifier hs-type">ListenError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482660"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>    </span><span class="hs-comment">-- ^ Action to run with listening socket.</span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482660"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-745"></span><span id="withListeningSocket"><span class="annot"><span class="annottext">withListeningSocket :: HostPreference
-&gt; Listen -&gt; (Either ListenError (Int, Socket) -&gt; IO a) -&gt; IO a
</span><a href="Cardano.Wallet.Api.Server.html#withListeningSocket"><span class="hs-identifier hs-var hs-var">withListeningSocket</span></a></span></span><span> </span><span id="local-6989586621682482659"><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482659"><span class="hs-identifier hs-var">hostPreference</span></a></span></span><span> </span><span id="local-6989586621682482658"><span class="annot"><span class="annottext">Listen
</span><a href="#local-6989586621682482658"><span class="hs-identifier hs-var">portOpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either ListenError (Int, Socket))
-&gt; (Either ListenError (Int, Socket) -&gt; IO ())
-&gt; (Either ListenError (Int, Socket) -&gt; IO a)
-&gt; IO a
forall (m :: * -&gt; *) a b c.
MonadUnliftIO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">bracket</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either ListenError (Int, Socket))
</span><a href="#local-6989586621682482657"><span class="hs-identifier hs-var">acquire</span></a></span><span> </span><span class="annot"><span class="annottext">Either ListenError (Int, Socket) -&gt; IO ()
forall (m :: * -&gt; *) a a. MonadIO m =&gt; Either a (a, Socket) -&gt; m ()
</span><a href="#local-6989586621682482656"><span class="hs-identifier hs-var">release</span></a></span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-747"></span><span>    </span><span id="local-6989586621682482657"><span class="annot"><span class="annottext">acquire :: IO (Either ListenError (Int, Socket))
</span><a href="#local-6989586621682482657"><span class="hs-identifier hs-var hs-var">acquire</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; Maybe ListenError)
-&gt; IO (Int, Socket) -&gt; IO (Either ListenError (Int, Socket))
forall (m :: * -&gt; *) e b a.
(MonadUnliftIO m, Exception e) =&gt;
(e -&gt; Maybe b) -&gt; m a -&gt; m (Either b a)
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">tryJust</span></a></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Maybe ListenError
</span><a href="#local-6989586621682482655"><span class="hs-identifier hs-var">handleErr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Int, Socket)
</span><a href="#local-6989586621682482654"><span class="hs-identifier hs-var">bindAndListen</span></a></span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-comment">-- Note: These Data.Streaming.Network functions also listen on the socket,</span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-comment">-- even though their name just says &quot;bind&quot;.</span><span>
</span><span id="line-750"></span><span>    </span><span id="local-6989586621682482654"><span class="annot"><span class="annottext">bindAndListen :: IO (Int, Socket)
</span><a href="#local-6989586621682482654"><span class="hs-identifier hs-var hs-var">bindAndListen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Listen
</span><a href="#local-6989586621682482658"><span class="hs-identifier hs-var">portOpt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-751"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenOnPort"><span class="hs-identifier hs-type">ListenOnPort</span></a></span><span> </span><span id="local-6989586621682482653"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682482653"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682482653"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Socket -&gt; (Int, Socket)) -&gt; IO Socket -&gt; IO (Int, Socket)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; HostPreference -&gt; IO Socket
</span><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-var">bindPortTCP</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682482653"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482659"><span class="hs-identifier hs-var">hostPreference</span></a></span><span>
</span><span id="line-752"></span><span>        </span><span class="annot"><span class="annottext">Listen
</span><a href="Cardano.Wallet.Api.Server.html#ListenOnRandomPort"><span class="hs-identifier hs-var">ListenOnRandomPort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HostPreference -&gt; IO (Int, Socket)
</span><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-var">bindRandomPortTCP</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482659"><span class="hs-identifier hs-var">hostPreference</span></a></span><span>
</span><span id="line-753"></span><span>    </span><span id="local-6989586621682482656"><span class="annot"><span class="annottext">release :: Either a (a, Socket) -&gt; m ()
</span><a href="#local-6989586621682482656"><span class="hs-identifier hs-var hs-var">release</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482651"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621682482651"><span class="hs-identifier hs-var">socket</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621682482651"><span class="hs-identifier hs-var">socket</span></a></span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><a href="#local-6989586621682482656"><span class="hs-identifier hs-var">release</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621682482655"><span class="annot"><span class="annottext">handleErr :: IOException -&gt; Maybe ListenError
</span><a href="#local-6989586621682482655"><span class="hs-identifier hs-var hs-var">handleErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HostPreference -&gt; Listen -&gt; IOException -&gt; Maybe ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ioToListenError"><span class="hs-identifier hs-var">ioToListenError</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482659"><span class="hs-identifier hs-var">hostPreference</span></a></span><span> </span><span class="annot"><span class="annottext">Listen
</span><a href="#local-6989586621682482658"><span class="hs-identifier hs-var">portOpt</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="hs-keyword">data</span><span> </span><span id="ListenError"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenError"><span class="hs-identifier hs-var">ListenError</span></a></span></span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ListenErrorAddressAlreadyInUse"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenErrorAddressAlreadyInUse"><span class="hs-identifier hs-var">ListenErrorAddressAlreadyInUse</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Port</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ListenErrorOperationNotPermitted"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenErrorOperationNotPermitted"><span class="hs-identifier hs-var">ListenErrorOperationNotPermitted</span></a></span></span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ListenErrorHostDoesNotExist"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenErrorHostDoesNotExist"><span class="hs-identifier hs-var">ListenErrorHostDoesNotExist</span></a></span></span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-type">HostPreference</span></a></span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ListenErrorInvalidAddress"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenErrorInvalidAddress"><span class="hs-identifier hs-var">ListenErrorInvalidAddress</span></a></span></span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-type">HostPreference</span></a></span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682482640"><span id="local-6989586621682482642"><span id="local-6989586621682482644"><span class="annot"><span class="annottext">Int -&gt; ListenError -&gt; ShowS
[ListenError] -&gt; ShowS
ListenError -&gt; String
(Int -&gt; ListenError -&gt; ShowS)
-&gt; (ListenError -&gt; String)
-&gt; ([ListenError] -&gt; ShowS)
-&gt; Show ListenError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ListenError] -&gt; ShowS
$cshowList :: [ListenError] -&gt; ShowS
show :: ListenError -&gt; String
$cshow :: ListenError -&gt; String
showsPrec :: Int -&gt; ListenError -&gt; ShowS
$cshowsPrec :: Int -&gt; ListenError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482636"><span id="local-6989586621682482638"><span class="annot"><span class="annottext">ListenError -&gt; ListenError -&gt; Bool
(ListenError -&gt; ListenError -&gt; Bool)
-&gt; (ListenError -&gt; ListenError -&gt; Bool) -&gt; Eq ListenError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ListenError -&gt; ListenError -&gt; Bool
$c/= :: ListenError -&gt; ListenError -&gt; Bool
== :: ListenError -&gt; ListenError -&gt; Bool
$c== :: ListenError -&gt; ListenError -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ioToListenError"><span class="hs-identifier hs-type">ioToListenError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-type">HostPreference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#Listen"><span class="hs-identifier hs-type">Listen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenError"><span class="hs-identifier hs-type">ListenError</span></a></span><span>
</span><span id="line-765"></span><span id="ioToListenError"><span class="annot"><span class="annottext">ioToListenError :: HostPreference -&gt; Listen -&gt; IOException -&gt; Maybe ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ioToListenError"><span class="hs-identifier hs-var hs-var">ioToListenError</span></a></span></span><span> </span><span id="local-6989586621682482635"><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482635"><span class="hs-identifier hs-var">hostPreference</span></a></span></span><span> </span><span id="local-6989586621682482634"><span class="annot"><span class="annottext">Listen
</span><a href="#local-6989586621682482634"><span class="hs-identifier hs-var">portOpt</span></a></span></span><span> </span><span id="local-6989586621682482633"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-comment">-- A socket is already listening on that address and port</span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isAlreadyInUseError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-768"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorAddressAlreadyInUse"><span class="hs-identifier hs-var">ListenErrorAddressAlreadyInUse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Listen -&gt; Maybe Int
</span><a href="#local-6989586621682482632"><span class="hs-identifier hs-var">listenPort</span></a></span><span> </span><span class="annot"><span class="annottext">Listen
</span><a href="#local-6989586621682482634"><span class="hs-identifier hs-var">portOpt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-comment">-- Usually caused by trying to listen on a privileged port</span><span>
</span><span id="line-770"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isPermissionError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-771"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorOperationNotPermitted"><span class="hs-identifier hs-var">ListenErrorOperationNotPermitted</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-comment">-- Bad hostname -- Linux and Darwin</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isDoesNotExistError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-774"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorHostDoesNotExist"><span class="hs-identifier hs-var">ListenErrorHostDoesNotExist</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482635"><span class="hs-identifier hs-var">hostPreference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>    </span><span class="hs-comment">-- Bad hostname -- Windows</span><span>
</span><span id="line-776"></span><span>    </span><span class="hs-comment">-- WSAHOST_NOT_FOUND, WSATRY_AGAIN, or bind: WSAEOPNOTSUPP</span><span>
</span><span id="line-777"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isUserError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="#local-6989586621682482629"><span class="hs-identifier hs-var">hasDescription</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;11001&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;11002&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;10045&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-778"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorHostDoesNotExist"><span class="hs-identifier hs-var">ListenErrorHostDoesNotExist</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482635"><span class="hs-identifier hs-var">hostPreference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>    </span><span class="hs-comment">-- Address is valid, but can't be used for listening -- Linux</span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOErrorType -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; IOErrorType
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ioeGetErrorType</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid argument&quot;</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorInvalidAddress"><span class="hs-identifier hs-var">ListenErrorInvalidAddress</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482635"><span class="hs-identifier hs-var">hostPreference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-comment">-- Address is valid, but can't be used for listening -- Darwin</span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOErrorType -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; IOErrorType
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ioeGetErrorType</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsupported operation&quot;</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-784"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorInvalidAddress"><span class="hs-identifier hs-var">ListenErrorInvalidAddress</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482635"><span class="hs-identifier hs-var">hostPreference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-comment">-- Address is valid, but can't be used for listening -- Windows</span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="#local-6989586621682482627"><span class="hs-identifier hs-var">isOtherError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="#local-6989586621682482629"><span class="hs-identifier hs-var">hasDescription</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WSAEINVAL&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WSAEADDRNOTAVAIL&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-787"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorInvalidAddress"><span class="hs-identifier hs-var">ListenErrorInvalidAddress</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621682482635"><span class="hs-identifier hs-var">hostPreference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>    </span><span class="hs-comment">-- Listening on an unavailable or privileged port -- Windows</span><span>
</span><span id="line-789"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="#local-6989586621682482627"><span class="hs-identifier hs-var">isOtherError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="#local-6989586621682482629"><span class="hs-identifier hs-var">hasDescription</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WSAEACCESS&quot;</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><span class="annottext">ListenError -&gt; Maybe ListenError
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; ListenError
</span><a href="Cardano.Wallet.Api.Server.html#ListenErrorAddressAlreadyInUse"><span class="hs-identifier hs-var">ListenErrorAddressAlreadyInUse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Listen -&gt; Maybe Int
</span><a href="#local-6989586621682482632"><span class="hs-identifier hs-var">listenPort</span></a></span><span> </span><span class="annot"><span class="annottext">Listen
</span><a href="#local-6989586621682482634"><span class="hs-identifier hs-var">portOpt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-791"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><span class="annottext">Maybe ListenError
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-794"></span><span>    </span><span id="local-6989586621682482632"><span class="annot"><span class="annottext">listenPort :: Listen -&gt; Maybe Int
</span><a href="#local-6989586621682482632"><span class="hs-identifier hs-var hs-var">listenPort</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ListenOnPort"><span class="hs-identifier hs-type">ListenOnPort</span></a></span><span> </span><span id="local-6989586621682482626"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682482626"><span class="hs-identifier hs-var">port</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682482626"><span class="hs-identifier hs-var">port</span></a></span><span>
</span><span id="line-795"></span><span>    </span><span class="annot"><a href="#local-6989586621682482632"><span class="hs-identifier hs-var">listenPort</span></a></span><span> </span><span class="annot"><span class="annottext">Listen
</span><a href="Cardano.Wallet.Api.Server.html#ListenOnRandomPort"><span class="hs-identifier hs-var">ListenOnRandomPort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span>    </span><span id="local-6989586621682482627"><span class="annot"><span class="annottext">isOtherError :: IOException -&gt; Bool
</span><a href="#local-6989586621682482627"><span class="hs-identifier hs-var hs-var">isOtherError</span></a></span></span><span> </span><span id="local-6989586621682482625"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482625"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOErrorType -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; IOErrorType
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ioeGetErrorType</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482625"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;failed&quot;</span></span><span>
</span><span id="line-798"></span><span>    </span><span id="local-6989586621682482629"><span class="annot"><span class="annottext">hasDescription :: String -&gt; Bool
</span><a href="#local-6989586621682482629"><span class="hs-identifier hs-var hs-var">hasDescription</span></a></span></span><span> </span><span id="local-6989586621682482624"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682482624"><span class="hs-identifier hs-var">text</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682482624"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`isInfixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621682482633"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                              Wallet Constructors
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="hs-keyword">type</span><span> </span><span id="MkApiWallet"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-var">MkApiWallet</span></a></span></span><span> </span><span id="local-6989586621682482623"><span class="annot"><a href="#local-6989586621682482623"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482622"><span class="annot"><a href="#local-6989586621682482622"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482621"><span class="annot"><a href="#local-6989586621682482621"><span class="hs-identifier hs-type">w</span></a></span></span><span>
</span><span id="line-805"></span><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><a href="#local-6989586621682482623"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482622"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482621"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="hs-comment">--------------------- Shelley</span><span>
</span><span id="line-814"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postWallet"><span class="hs-identifier hs-type">postWallet</span></a></span><span>
</span><span id="line-815"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482620"><span class="annot"><a href="#local-6989586621682482620"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482619"><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482618"><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482617"><span class="annot"><a href="#local-6989586621682482617"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-816"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482617"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482620"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-818"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482617"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482620"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482620"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-824"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-826"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482617"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-827"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-828"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-829"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-830"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482620"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-832"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletOrAccountPostData"><span class="hs-identifier hs-type">WalletOrAccountPostData</span></a></span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWallet"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-836"></span><span id="postWallet"><span class="annot"><span class="annottext">postWallet :: ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; WalletOrAccountPostData
-&gt; Handler ApiWallet
</span><a href="Cardano.Wallet.Api.Server.html#postWallet"><span class="hs-identifier hs-var hs-var">postWallet</span></a></span></span><span> </span><span id="local-6989586621682482616"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482616"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482615"><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482615"><span class="hs-identifier hs-var">generateKey</span></a></span></span><span> </span><span id="local-6989586621682482614"><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482614"><span class="hs-identifier hs-var">liftKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletOrAccountPostData"><span class="hs-identifier hs-type">WalletOrAccountPostData</span></a></span><span> </span><span id="local-6989586621682482612"><span class="annot"><span class="annottext">Either WalletPostData AccountPostData
</span><a href="#local-6989586621682482612"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either WalletPostData AccountPostData
</span><a href="#local-6989586621682482612"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span id="local-6989586621682482611"><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482611"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-838"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; WalletPostData
-&gt; Handler ApiWallet
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(s ~ SeqState n k, ctx ~ ApiLayer s k, SoftDerivation k,
 MkKeyFingerprint k (Proxy n, k 'AddressK XPub),
 MkKeyFingerprint k Address, WalletKey k, HasDBFactory s k ctx,
 HasWorkerRegistry s k ctx, IsOurs s RewardAccount, MaybeLight s,
 Typeable s, Typeable n, (k == SharedKey) ~ 'False,
 AddressBookIso s) =&gt;
ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; WalletPostData
-&gt; Handler ApiWallet
</span><a href="Cardano.Wallet.Api.Server.html#postShelleyWallet"><span class="hs-identifier hs-var">postShelleyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482616"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482615"><span class="hs-identifier hs-var">generateKey</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482611"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682482610"><span class="annot"><span class="annottext">AccountPostData
</span><a href="#local-6989586621682482610"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-840"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx (SeqState n k) ApiWallet
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; AccountPostData
-&gt; Handler ApiWallet
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant) w.
(s ~ SeqState n k, ctx ~ ApiLayer s k, SoftDerivation k,
 MkKeyFingerprint k (Proxy n, k 'AddressK XPub),
 MkKeyFingerprint k Address, WalletKey k, HasWorkerRegistry s k ctx,
 IsOurs s RewardAccount, MaybeLight s, (k == SharedKey) ~ 'False,
 Typeable n, AddressBookIso s) =&gt;
ctx
-&gt; MkApiWallet ctx s w
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; AccountPostData
-&gt; Handler w
</span><a href="Cardano.Wallet.Api.Server.html#postAccountWallet"><span class="hs-identifier hs-var">postAccountWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482616"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx (SeqState n k) ApiWallet
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SeqState n k, IsOurs s Address,
 IsOurs s RewardAccount, HasWorkerRegistry s k ctx) =&gt;
MkApiWallet ctx s ApiWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkShelleyWallet"><span class="hs-identifier hs-var">mkShelleyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482614"><span class="hs-identifier hs-var">liftKey</span></a></span><span>
</span><span id="line-841"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n -&gt; WalletLayer IO (SeqState n k) k -&gt; WalletId -&gt; IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasLogger IO WalletWorkerLog ctx, HasNetworkLayer IO ctx,
 HasDBLayer IO s k ctx, Typeable s, Typeable n) =&gt;
Proxy n -&gt; ctx -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier hs-var">W.manageRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482619"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482618"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482617"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AccountPostData
</span><a href="#local-6989586621682482610"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postShelleyWallet"><span class="hs-identifier hs-type">postShelleyWallet</span></a></span><span>
</span><span id="line-844"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484394"><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484398"><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484396"><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484397"><span class="annot"><a href="#local-6989586621682484397"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-845"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484397"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-846"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-847"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-848"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484397"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-850"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-851"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-852"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-853"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-854"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-855"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-856"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484397"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-857"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-858"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-859"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPostData"><span class="hs-identifier hs-type">WalletPostData</span></a></span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWallet"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-864"></span><span id="postShelleyWallet"><span class="annot"><span class="annottext">postShelleyWallet :: ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; WalletPostData
-&gt; Handler ApiWallet
</span><a href="Cardano.Wallet.Api.Server.html#postShelleyWallet"><span class="hs-identifier hs-var hs-var">postShelleyWallet</span></a></span></span><span> </span><span id="local-6989586621682482608"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482608"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482607"><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482607"><span class="hs-identifier hs-var">generateKey</span></a></span></span><span> </span><span id="local-6989586621682482606"><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482606"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-865"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482605"><span class="annot"><span class="annottext">state :: SeqState n k
</span><a href="#local-6989586621682482605"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Index 'Hardened 'PurposeK -&gt; AddressPoolGap -&gt; SeqState n k
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
(WalletKey k, SupportsDiscovery n k, (k == SharedKey) ~ 'False) =&gt;
(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Index 'Hardened 'PurposeK -&gt; AddressPoolGap -&gt; SeqState n k
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#mkSeqStateFromRootXPrv"><span class="hs-identifier hs-var">mkSeqStateFromRootXPrv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482604"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482603"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeCIP1852"><span class="hs-identifier hs-var">purposeCIP1852</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="#local-6989586621682482602"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-866"></span><span>    </span><span class="annot"><span class="annottext">Handler WalletId -&gt; Handler ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler WalletId -&gt; Handler ()) -&gt; Handler WalletId -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var">createWalletWorker</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482608"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-867"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682482599"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482599"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
(MonadUnliftIO m, MonadTime m, HasGenesisData ctx,
 HasDBLayer m s k ctx, IsOurs s Address, IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var">W.createWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482599"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482597"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="annot"><span class="annottext">s
SeqState n k
</span><a href="#local-6989586621682482605"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682482596"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482596"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proxy n -&gt; WorkerCtx ctx -&gt; WalletId -&gt; IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasLogger IO WalletWorkerLog ctx, HasNetworkLayer IO ctx,
 HasDBLayer IO s k ctx, Typeable s, Typeable n) =&gt;
Proxy n -&gt; ctx -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.html#manageRewardBalance"><span class="hs-identifier hs-var">W.manageRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484394"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484397"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482596"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482608"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482594"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482594"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-870"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwd"><span class="hs-identifier hs-var">W.attachPrivateKeyFromPwd</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682482594"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482604"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482592"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>    </span><span class="annot"><span class="annottext">(ApiWallet, UTCTime) -&gt; ApiWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWallet, UTCTime) -&gt; ApiWallet)
-&gt; Handler (ApiWallet, UTCTime) -&gt; Handler ApiWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s ApiWallet
-&gt; ApiT WalletId
-&gt; Handler (ApiWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482608"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SeqState n k, IsOurs s Address,
 IsOurs s RewardAccount, HasWorkerRegistry s k ctx) =&gt;
MkApiWallet ctx s ApiWallet
forall (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SeqState n k, IsOurs s Address,
 IsOurs s RewardAccount, HasWorkerRegistry s k ctx) =&gt;
MkApiWallet ctx s ApiWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkShelleyWallet"><span class="hs-identifier hs-var">mkShelleyWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484398"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484396"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-873"></span><span>    </span><span id="local-6989586621682482590"><span class="annot"><span class="annottext">seed :: SomeMnemonic
</span><a href="#local-6989586621682482590"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiMnemonicT '[15, 18, 21, 24] -&gt; SomeMnemonic
forall (sizes :: [Nat]). ApiMnemonicT sizes -&gt; SomeMnemonic
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiMnemonicT%3AApiMnemonicT"><span class="hs-identifier hs-var hs-var">getApiMnemonicT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482606"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPostData
-&gt; ((ApiMnemonicT '[15, 18, 21, 24]
     -&gt; Const
          (ApiMnemonicT '[15, 18, 21, 24]) (ApiMnemonicT '[15, 18, 21, 24]))
    -&gt; WalletPostData
    -&gt; Const (ApiMnemonicT '[15, 18, 21, 24]) WalletPostData)
-&gt; ApiMnemonicT '[15, 18, 21, 24]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSentence&quot;
  ((ApiMnemonicT '[15, 18, 21, 24]
    -&gt; Const
         (ApiMnemonicT '[15, 18, 21, 24]) (ApiMnemonicT '[15, 18, 21, 24]))
   -&gt; WalletPostData
   -&gt; Const (ApiMnemonicT '[15, 18, 21, 24]) WalletPostData)
(ApiMnemonicT '[15, 18, 21, 24]
 -&gt; Const
      (ApiMnemonicT '[15, 18, 21, 24]) (ApiMnemonicT '[15, 18, 21, 24]))
-&gt; WalletPostData
-&gt; Const (ApiMnemonicT '[15, 18, 21, 24]) WalletPostData
</span><a href="#local-6989586621682482589"><span class="hs-var">#mnemonicSentence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>    </span><span id="local-6989586621682482588"><span class="annot"><span class="annottext">secondFactor :: Maybe SomeMnemonic
</span><a href="#local-6989586621682482588"><span class="hs-identifier hs-var hs-var">secondFactor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiMnemonicT '[9, 12] -&gt; SomeMnemonic
forall (sizes :: [Nat]). ApiMnemonicT sizes -&gt; SomeMnemonic
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiMnemonicT%3AApiMnemonicT"><span class="hs-identifier hs-var hs-var">getApiMnemonicT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiMnemonicT '[9, 12] -&gt; SomeMnemonic)
-&gt; Maybe (ApiMnemonicT '[9, 12]) -&gt; Maybe SomeMnemonic
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482606"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPostData
-&gt; ((Maybe (ApiMnemonicT '[9, 12])
     -&gt; Const
          (Maybe (ApiMnemonicT '[9, 12])) (Maybe (ApiMnemonicT '[9, 12])))
    -&gt; WalletPostData
    -&gt; Const (Maybe (ApiMnemonicT '[9, 12])) WalletPostData)
-&gt; Maybe (ApiMnemonicT '[9, 12])
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSecondFactor&quot;
  ((Maybe (ApiMnemonicT '[9, 12])
    -&gt; Const
         (Maybe (ApiMnemonicT '[9, 12])) (Maybe (ApiMnemonicT '[9, 12])))
   -&gt; WalletPostData
   -&gt; Const (Maybe (ApiMnemonicT '[9, 12])) WalletPostData)
(Maybe (ApiMnemonicT '[9, 12])
 -&gt; Const
      (Maybe (ApiMnemonicT '[9, 12])) (Maybe (ApiMnemonicT '[9, 12])))
-&gt; WalletPostData
-&gt; Const (Maybe (ApiMnemonicT '[9, 12])) WalletPostData
</span><a href="#local-6989586621682482587"><span class="hs-var">#mnemonicSecondFactor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span>    </span><span id="local-6989586621682482592"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482592"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase &quot;user&quot;) -&gt; Passphrase &quot;user&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482606"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPostData
-&gt; ((ApiT (Passphrase &quot;user&quot;)
     -&gt; Const (ApiT (Passphrase &quot;user&quot;)) (ApiT (Passphrase &quot;user&quot;)))
    -&gt; WalletPostData
    -&gt; Const (ApiT (Passphrase &quot;user&quot;)) WalletPostData)
-&gt; ApiT (Passphrase &quot;user&quot;)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (ApiT (Passphrase &quot;user&quot;)) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; WalletPostData
   -&gt; Const (ApiT (Passphrase &quot;user&quot;)) WalletPostData)
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (ApiT (Passphrase &quot;user&quot;)) (ApiT (Passphrase &quot;user&quot;)))
-&gt; WalletPostData
-&gt; Const (ApiT (Passphrase &quot;user&quot;)) WalletPostData
</span><a href="#local-6989586621682482585"><span class="hs-var">#passphrase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621682482603"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482603"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482592"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-877"></span><span>    </span><span id="local-6989586621682482604"><span class="annot"><span class="annottext">rootXPrv :: k 'RootK XPrv
</span><a href="#local-6989586621682482604"><span class="hs-identifier hs-var hs-var">rootXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482607"><span class="hs-identifier hs-var">generateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482590"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SomeMnemonic
</span><a href="#local-6989586621682482588"><span class="hs-identifier hs-var">secondFactor</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482603"><span class="hs-identifier hs-var">pwdP</span></a></span><span>
</span><span id="line-878"></span><span>    </span><span id="local-6989586621682482602"><span class="annot"><span class="annottext">g :: AddressPoolGap
</span><a href="#local-6989586621682482602"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
-&gt; (ApiT AddressPoolGap -&gt; AddressPoolGap)
-&gt; Maybe (ApiT AddressPoolGap)
-&gt; AddressPoolGap
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier hs-var">defaultAddressPoolGap</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT AddressPoolGap -&gt; AddressPoolGap
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482606"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPostData
-&gt; ((Maybe (ApiT AddressPoolGap)
     -&gt; Const
          (Maybe (ApiT AddressPoolGap)) (Maybe (ApiT AddressPoolGap)))
    -&gt; WalletPostData
    -&gt; Const (Maybe (ApiT AddressPoolGap)) WalletPostData)
-&gt; Maybe (ApiT AddressPoolGap)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;addressPoolGap&quot;
  ((Maybe (ApiT AddressPoolGap)
    -&gt; Const
         (Maybe (ApiT AddressPoolGap)) (Maybe (ApiT AddressPoolGap)))
   -&gt; WalletPostData
   -&gt; Const (Maybe (ApiT AddressPoolGap)) WalletPostData)
(Maybe (ApiT AddressPoolGap)
 -&gt; Const
      (Maybe (ApiT AddressPoolGap)) (Maybe (ApiT AddressPoolGap)))
-&gt; WalletPostData
-&gt; Const (Maybe (ApiT AddressPoolGap)) WalletPostData
</span><a href="#local-6989586621682482583"><span class="hs-var">#addressPoolGap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>    </span><span id="local-6989586621682482600"><span class="annot"><span class="annottext">wid :: WalletId
</span><a href="#local-6989586621682482600"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; WalletId
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-var">WalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; WalletId) -&gt; Digest Blake2b_160 -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPub -&gt; Digest Blake2b_160
forall (key :: Depth -&gt; * -&gt; *) a (depth :: Depth).
(WalletKey key, HashAlgorithm a) =&gt;
key depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var">digest</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPub -&gt; Digest Blake2b_160)
-&gt; k 'RootK XPub -&gt; Digest Blake2b_160
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv -&gt; k 'RootK XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
key depth XPrv -&gt; key depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482604"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span>
</span><span id="line-880"></span><span>    </span><span id="local-6989586621682482597"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482597"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT WalletName -&gt; WalletName
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletPostData
</span><a href="#local-6989586621682482606"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPostData
-&gt; ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
    -&gt; WalletPostData -&gt; Const (ApiT WalletName) WalletPostData)
-&gt; ApiT WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
   -&gt; WalletPostData -&gt; Const (ApiT WalletName) WalletPostData)
(ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
-&gt; WalletPostData -&gt; Const (ApiT WalletName) WalletPostData
</span><a href="#local-6989586621682482581"><span class="hs-var">#name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postAccountWallet"><span class="hs-identifier hs-type">postAccountWallet</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484371"><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484374"><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484372"><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484373"><span class="annot"><a href="#local-6989586621682484373"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682484370"><span class="annot"><a href="#local-6989586621682484370"><span class="hs-identifier hs-type">w</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-884"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484373"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-885"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-886"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-887"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484373"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-890"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-892"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-894"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484373"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-895"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-896"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-898"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-type">MkApiWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484370"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-comment">-- ^ Action to run concurrently with restore action</span><span>
</span><span id="line-902"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AccountPostData"><span class="hs-identifier hs-type">AccountPostData</span></a></span><span>
</span><span id="line-903"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484370"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-904"></span><span id="postAccountWallet"><span class="annot"><span class="annottext">postAccountWallet :: ctx
-&gt; MkApiWallet ctx s w
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; AccountPostData
-&gt; Handler w
</span><a href="Cardano.Wallet.Api.Server.html#postAccountWallet"><span class="hs-identifier hs-var hs-var">postAccountWallet</span></a></span></span><span> </span><span id="local-6989586621682482580"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482580"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482579"><span class="annot"><span class="annottext">MkApiWallet ctx s w
</span><a href="#local-6989586621682482579"><span class="hs-identifier hs-var">mkWallet</span></a></span></span><span> </span><span id="local-6989586621682482578"><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482578"><span class="hs-identifier hs-var">liftKey</span></a></span></span><span> </span><span id="local-6989586621682482577"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682482577"><span class="hs-identifier hs-var">coworker</span></a></span></span><span> </span><span id="local-6989586621682482576"><span class="annot"><span class="annottext">AccountPostData
</span><a href="#local-6989586621682482576"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482575"><span class="annot"><span class="annottext">state :: SeqState n k
</span><a href="#local-6989586621682482575"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; Maybe (k 'PolicyK XPub)
-&gt; Index 'Hardened 'PurposeK
-&gt; AddressPoolGap
-&gt; SeqState n k
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
(SupportsDiscovery n k, (k == SharedKey) ~ 'False) =&gt;
k 'AccountK XPub
-&gt; Maybe (k 'PolicyK XPub)
-&gt; Index 'Hardened 'PurposeK
-&gt; AddressPoolGap
-&gt; SeqState n k
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#mkSeqStateFromAccountXPub"><span class="hs-identifier hs-var">mkSeqStateFromAccountXPub</span></a></span><span>
</span><span id="line-906"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482578"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482574"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (k 'PolicyK XPub)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#purposeCIP1852"><span class="hs-identifier hs-var">purposeCIP1852</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="#local-6989586621682482573"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-907"></span><span>    </span><span class="annot"><span class="annottext">Handler WalletId -&gt; Handler ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler WalletId -&gt; Handler ()) -&gt; Handler WalletId -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var">createWalletWorker</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482580"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482572"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-908"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682482571"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482571"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
(MonadUnliftIO m, MonadTime m, HasGenesisData ctx,
 HasDBLayer m s k ctx, IsOurs s Address, IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var">W.createWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484371"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484374"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484372"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482571"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482572"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482570"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="annot"><span class="annottext">s
SeqState n k
</span><a href="#local-6989586621682482575"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682482577"><span class="hs-identifier hs-var">coworker</span></a></span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><span class="annottext">(w, UTCTime) -&gt; w
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((w, UTCTime) -&gt; w) -&gt; Handler (w, UTCTime) -&gt; Handler w
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx -&gt; MkApiWallet ctx s w -&gt; ApiT WalletId -&gt; Handler (w, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482580"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx s w
</span><a href="#local-6989586621682482579"><span class="hs-identifier hs-var">mkWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482572"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-912"></span><span>    </span><span id="local-6989586621682482573"><span class="annot"><span class="annottext">g :: AddressPoolGap
</span><a href="#local-6989586621682482573"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
-&gt; (ApiT AddressPoolGap -&gt; AddressPoolGap)
-&gt; Maybe (ApiT AddressPoolGap)
-&gt; AddressPoolGap
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier hs-var">defaultAddressPoolGap</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT AddressPoolGap -&gt; AddressPoolGap
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AccountPostData
</span><a href="#local-6989586621682482576"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">AccountPostData
-&gt; ((Maybe (ApiT AddressPoolGap)
     -&gt; Const
          (Maybe (ApiT AddressPoolGap)) (Maybe (ApiT AddressPoolGap)))
    -&gt; AccountPostData
    -&gt; Const (Maybe (ApiT AddressPoolGap)) AccountPostData)
-&gt; Maybe (ApiT AddressPoolGap)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;addressPoolGap&quot;
  ((Maybe (ApiT AddressPoolGap)
    -&gt; Const
         (Maybe (ApiT AddressPoolGap)) (Maybe (ApiT AddressPoolGap)))
   -&gt; AccountPostData
   -&gt; Const (Maybe (ApiT AddressPoolGap)) AccountPostData)
(Maybe (ApiT AddressPoolGap)
 -&gt; Const
      (Maybe (ApiT AddressPoolGap)) (Maybe (ApiT AddressPoolGap)))
-&gt; AccountPostData
-&gt; Const (Maybe (ApiT AddressPoolGap)) AccountPostData
</span><a href="#local-6989586621682482569"><span class="hs-var">#addressPoolGap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>    </span><span id="local-6989586621682482570"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482570"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT WalletName -&gt; WalletName
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AccountPostData
</span><a href="#local-6989586621682482576"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">AccountPostData
-&gt; ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
    -&gt; AccountPostData -&gt; Const (ApiT WalletName) AccountPostData)
-&gt; ApiT WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
   -&gt; AccountPostData -&gt; Const (ApiT WalletName) AccountPostData)
(ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
-&gt; AccountPostData -&gt; Const (ApiT WalletName) AccountPostData
</span><a href="#local-6989586621682482568"><span class="hs-var">#name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAccountPublicKey"><span class="hs-identifier hs-type">ApiAccountPublicKey</span></a></span><span> </span><span id="local-6989586621682482566"><span class="annot"><span class="annottext">ApiT XPub
</span><a href="#local-6989586621682482566"><span class="hs-identifier hs-var">accXPubApiT</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">AccountPostData
</span><a href="#local-6989586621682482576"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">AccountPostData
-&gt; ((ApiAccountPublicKey
     -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
    -&gt; AccountPostData -&gt; Const ApiAccountPublicKey AccountPostData)
-&gt; ApiAccountPublicKey
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;accountPublicKey&quot;
  ((ApiAccountPublicKey
    -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
   -&gt; AccountPostData -&gt; Const ApiAccountPublicKey AccountPostData)
(ApiAccountPublicKey
 -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
-&gt; AccountPostData -&gt; Const ApiAccountPublicKey AccountPostData
</span><a href="#local-6989586621682482565"><span class="hs-var">#accountPublicKey</span></a></span><span>
</span><span id="line-915"></span><span>    </span><span id="local-6989586621682482574"><span class="annot"><span class="annottext">accXPub :: XPub
</span><a href="#local-6989586621682482574"><span class="hs-identifier hs-var hs-var">accXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT XPub -&gt; XPub
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT XPub
</span><a href="#local-6989586621682482566"><span class="hs-identifier hs-var">accXPubApiT</span></a></span><span>
</span><span id="line-916"></span><span>    </span><span id="local-6989586621682482572"><span class="annot"><span class="annottext">wid :: WalletId
</span><a href="#local-6989586621682482572"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; WalletId
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-var">WalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; WalletId) -&gt; Digest Blake2b_160 -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; Digest Blake2b_160
forall (key :: Depth -&gt; * -&gt; *) a (depth :: Depth).
(WalletKey key, HashAlgorithm a) =&gt;
key depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var">digest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482578"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482574"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkShelleyWallet"><span class="hs-identifier hs-type">mkShelleyWallet</span></a></span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484369"><span class="annot"><a href="#local-6989586621682484369"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484368"><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484367"><span class="annot"><a href="#local-6989586621682484367"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484366"><span class="annot"><a href="#local-6989586621682484366"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-920"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484369"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484367"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-921"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484366"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484367"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484367"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484369"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-type">MkApiWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484369"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWallet"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-927"></span><span id="mkShelleyWallet"><span class="annot"><span class="annottext">mkShelleyWallet :: MkApiWallet ctx s ApiWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkShelleyWallet"><span class="hs-identifier hs-var hs-var">mkShelleyWallet</span></a></span></span><span> </span><span id="local-6989586621682482564"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482564"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482563"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482563"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682482562"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482562"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621682482561"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482561"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621682482560"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482560"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span id="local-6989586621682482559"><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482559"><span class="hs-identifier hs-var">progress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-928"></span><span>    </span><span id="local-6989586621682482558"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482558"><span class="hs-identifier hs-var">reward</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler Coin)
-&gt; (ErrWalletNotResponding -&gt; Handler Coin)
-&gt; (WorkerCtx ctx -&gt; Handler Coin)
-&gt; Handler Coin
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484367"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482564"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482563"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler Coin
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler Coin
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler Coin) -&gt; Handler Coin)
-&gt; (WorkerCtx ctx -&gt; Handler Coin) -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482557"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482557"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-comment">-- never fails - returns zero if balance not found</span><span>
</span><span id="line-930"></span><span>        </span><span class="annot"><span class="annottext">IO Coin -&gt; Handler Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; Handler Coin) -&gt; IO Coin -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k -&gt; WalletId -&gt; IO Coin
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx -&gt; WalletId -&gt; IO Coin
</span><a href="Cardano.Wallet.html#fetchRewardBalance"><span class="hs-identifier hs-var">W.fetchRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484367"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682482557"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482563"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482555"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482555"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; TimeInterpreter (ExceptT PastHorizonException IO))
-&gt; NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482564"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-comment">-- In the Shelley era of Byron;Shelley;Allegra toApiWalletDelegation using</span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-comment">-- an unextended @ti@ will simply fail because of uncertainty about the next</span><span>
</span><span id="line-936"></span><span>    </span><span class="hs-comment">-- fork.</span><span>
</span><span id="line-937"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-938"></span><span>    </span><span class="hs-comment">-- @unsafeExtendSafeZone@ performs the calculation as if no fork will occur.</span><span>
</span><span id="line-939"></span><span>    </span><span class="hs-comment">-- This should be fine because:</span><span>
</span><span id="line-940"></span><span>    </span><span class="hs-comment">-- 1. We expect the next few eras to have the same epoch length as Shelley</span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-comment">-- 2. It shouldn't be the end of the world to return the wrong time.</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-comment">-- But ultimately, we might want to make the uncertainty transparent to API</span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-comment">-- users. TODO: ADP-575</span><span>
</span><span id="line-945"></span><span>    </span><span id="local-6989586621682482554"><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682482554"><span class="hs-identifier hs-var">apiDelegation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiWalletDelegation -&gt; Handler ApiWalletDelegation
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiWalletDelegation -&gt; Handler ApiWalletDelegation)
-&gt; IO ApiWalletDelegation -&gt; Handler ApiWalletDelegation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegation -&gt; TimeInterpreter IO -&gt; IO ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Server.html#toApiWalletDelegation"><span class="hs-identifier hs-var">toApiWalletDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482561"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
    -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
-&gt; WalletDelegation
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
   -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
(WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
-&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata
</span><a href="#local-6989586621682482552"><span class="hs-var">#delegation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var">unsafeExtendSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482555"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>    </span><span id="local-6989586621682482551"><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682482551"><span class="hs-identifier hs-var">tip'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiBlockReference -&gt; Handler ApiBlockReference
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiBlockReference -&gt; Handler ApiBlockReference)
-&gt; IO ApiBlockReference -&gt; Handler ApiBlockReference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Wallet s -&gt; IO ApiBlockReference
forall (m :: * -&gt; *) s.
Monad m =&gt;
TimeInterpreter m -&gt; Wallet s -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#getWalletTip"><span class="hs-identifier hs-var">getWalletTip</span></a></span><span>
</span><span id="line-949"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier hs-var">neverFails</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getWalletTip wallet tip should be behind node tip&quot;</span></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482555"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>        </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482562"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-951"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482549"><span class="annot"><span class="annottext">available :: TokenBundle
</span><a href="#local-6989586621682482549"><span class="hs-identifier hs-var hs-var">available</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; TokenBundle
forall s. Set Tx -&gt; Wallet s -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Model.html#availableBalance"><span class="hs-identifier hs-var">availableBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482560"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482562"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-952"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482548"><span class="annot"><span class="annottext">total :: TokenBundle
</span><a href="#local-6989586621682482548"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Coin -&gt; Wallet s -&gt; TokenBundle
forall s.
(IsOurs s Address, IsOurs s RewardAccount) =&gt;
Set Tx -&gt; Coin -&gt; Wallet s -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Model.html#totalBalance"><span class="hs-identifier hs-var">totalBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482560"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482558"><span class="hs-identifier hs-var">reward</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482562"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-953"></span><span>    </span><span class="annot"><span class="annottext">ApiWallet -&gt; Handler ApiWallet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet :: ApiT WalletId
-&gt; ApiT AddressPoolGap
-&gt; ApiWalletBalance
-&gt; ApiWalletAssetsBalance
-&gt; ApiWalletDelegation
-&gt; ApiT WalletName
-&gt; Maybe ApiWalletPassphraseInfo
-&gt; ApiT SyncProgress
-&gt; ApiBlockReference
-&gt; ApiWallet
</span><a href="Cardano.Wallet.Api.Types.html#ApiWallet"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-954"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:addressPoolGap:ApiWallet :: ApiT AddressPoolGap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AaddressPoolGap%3AApiWallet"><span class="hs-identifier hs-var">addressPoolGap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap -&gt; ApiT AddressPoolGap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressPoolGap -&gt; ApiT AddressPoolGap)
-&gt; AddressPoolGap -&gt; ApiT AddressPoolGap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SeqAddressPool 'UtxoExternal k -&gt; AddressPoolGap
forall (c :: Role) (k :: Depth -&gt; * -&gt; *).
SeqAddressPool c k -&gt; AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#getGap"><span class="hs-identifier hs-var">getGap</span></a></span><span> </span><span class="annot"><span class="annottext">(SeqAddressPool 'UtxoExternal k -&gt; AddressPoolGap)
-&gt; SeqAddressPool 'UtxoExternal k -&gt; AddressPoolGap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482562"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; ((SeqAddressPool 'UtxoExternal k
     -&gt; Const
          (SeqAddressPool 'UtxoExternal k) (SeqAddressPool 'UtxoExternal k))
    -&gt; s -&gt; Const (SeqAddressPool 'UtxoExternal k) s)
-&gt; SeqAddressPool 'UtxoExternal k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;externalPool&quot;
  ((SeqAddressPool 'UtxoExternal k
    -&gt; Const
         (SeqAddressPool 'UtxoExternal k) (SeqAddressPool 'UtxoExternal k))
   -&gt; s -&gt; Const (SeqAddressPool 'UtxoExternal k) s)
(SeqAddressPool 'UtxoExternal k
 -&gt; Const
      (SeqAddressPool 'UtxoExternal k) (SeqAddressPool 'UtxoExternal k))
-&gt; s -&gt; Const (SeqAddressPool 'UtxoExternal k) s
</span><a href="#local-6989586621682482545"><span class="hs-var">#externalPool</span></a></span><span>
</span><span id="line-955"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:balance:ApiWallet :: ApiWalletBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Abalance%3AApiWallet"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiWalletBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletBalance"><span class="hs-identifier hs-type">ApiWalletBalance</span></a></span><span>
</span><span id="line-956"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:available:ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aavailable%3AApiWalletBalance"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482549"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682482541"><span class="hs-var">#coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:total:ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atotal%3AApiWalletBalance"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482548"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682482539"><span class="hs-var">#coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reward:ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Areward%3AApiWalletBalance"><span class="hs-identifier hs-var">reward</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482558"><span class="hs-identifier hs-var">reward</span></a></span><span>
</span><span id="line-959"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-960"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWallet :: ApiWalletAssetsBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiWallet"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletAssetsBalance :: ApiT TokenMap -&gt; ApiT TokenMap -&gt; ApiWalletAssetsBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletAssetsBalance"><span class="hs-identifier hs-type">ApiWalletAssetsBalance</span></a></span><span>
</span><span id="line-961"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:available:ApiWalletAssetsBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aavailable%3AApiWalletAssetsBalance"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482549"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482534"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:total:ApiWalletAssetsBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atotal%3AApiWalletAssetsBalance"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482548"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482532"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-964"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegation:ApiWallet :: ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adelegation%3AApiWallet"><span class="hs-identifier hs-var">delegation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682482554"><span class="hs-identifier hs-var">apiDelegation</span></a></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiWallet :: ApiT WalletId
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiWallet"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482563"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-966"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:name:ApiWallet :: ApiT WalletName
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aname%3AApiWallet"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName -&gt; ApiT WalletName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletName -&gt; ApiT WalletName) -&gt; WalletName -&gt; ApiT WalletName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482561"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
(WalletName -&gt; Const WalletName WalletName)
-&gt; WalletMetadata -&gt; Const WalletName WalletMetadata
</span><a href="#local-6989586621682482528"><span class="hs-var">#name</span></a></span><span>
</span><span id="line-967"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:passphrase:ApiWallet :: Maybe ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Apassphrase%3AApiWallet"><span class="hs-identifier hs-var">passphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphraseInfo"><span class="hs-identifier hs-var">ApiWalletPassphraseInfo</span></a></span><span>
</span><span id="line-968"></span><span>            </span><span class="annot"><span class="annottext">(UTCTime -&gt; ApiWalletPassphraseInfo)
-&gt; Maybe UTCTime -&gt; Maybe ApiWalletPassphraseInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletPassphraseInfo -&gt; UTCTime)
-&gt; Maybe WalletPassphraseInfo -&gt; Maybe UTCTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((UTCTime -&gt; Const UTCTime UTCTime)
 -&gt; WalletPassphraseInfo -&gt; Const UTCTime WalletPassphraseInfo)
-&gt; WalletPassphraseInfo -&gt; UTCTime
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;lastUpdatedAt&quot;
  ((UTCTime -&gt; Const UTCTime UTCTime)
   -&gt; WalletPassphraseInfo -&gt; Const UTCTime WalletPassphraseInfo)
(UTCTime -&gt; Const UTCTime UTCTime)
-&gt; WalletPassphraseInfo -&gt; Const UTCTime WalletPassphraseInfo
</span><a href="#local-6989586621682482525"><span class="hs-var">#lastUpdatedAt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482561"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((Maybe WalletPassphraseInfo
     -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
    -&gt; WalletMetadata
    -&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata)
-&gt; Maybe WalletPassphraseInfo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphraseInfo&quot;
  ((Maybe WalletPassphraseInfo
    -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
   -&gt; WalletMetadata
   -&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata)
(Maybe WalletPassphraseInfo
 -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
-&gt; WalletMetadata
-&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata
</span><a href="#local-6989586621682482524"><span class="hs-var">#passphraseInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:state:ApiWallet :: ApiT SyncProgress
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Astate%3AApiWallet"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyncProgress -&gt; ApiT SyncProgress
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482559"><span class="hs-identifier hs-var">progress</span></a></span><span>
</span><span id="line-970"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:tip:ApiWallet :: ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atip%3AApiWallet"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682482551"><span class="hs-identifier hs-var">tip'</span></a></span><span>
</span><span id="line-971"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-972"></span><span>
</span><span id="line-973"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#toApiWalletDelegation"><span class="hs-identifier hs-type">toApiWalletDelegation</span></a></span><span>
</span><span id="line-974"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-type">W.WalletDelegation</span></a></span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-976"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegation"><span class="hs-identifier hs-type">ApiWalletDelegation</span></a></span><span>
</span><span id="line-977"></span><span id="toApiWalletDelegation"><span class="annot"><span class="annottext">toApiWalletDelegation :: WalletDelegation -&gt; TimeInterpreter IO -&gt; IO ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Server.html#toApiWalletDelegation"><span class="hs-identifier hs-var hs-var">toApiWalletDelegation</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegation"><span class="hs-identifier hs-type">W.WalletDelegation</span></a></span><span class="hs-special">{</span><span id="local-6989586621682482520"><span class="annot"><span class="annottext">WalletDelegationStatus
$sel:active:WalletDelegation :: WalletDelegation -&gt; WalletDelegationStatus
active :: WalletDelegationStatus
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Aactive%3AWalletDelegation"><span class="hs-identifier hs-var hs-var">active</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682482518"><span class="annot"><span class="annottext">[WalletDelegationNext]
$sel:next:WalletDelegation :: WalletDelegation -&gt; [WalletDelegationNext]
next :: [WalletDelegationNext]
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Anext%3AWalletDelegation"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621682482516"><span class="annot"><span class="annottext">TimeInterpreter IO
</span><a href="#local-6989586621682482516"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-978"></span><span>    </span><span id="local-6989586621682482515"><span class="annot"><span class="annottext">[ApiWalletDelegationNext]
</span><a href="#local-6989586621682482515"><span class="hs-identifier hs-var">apiNext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext]
-&gt; (WalletDelegationNext -&gt; IO ApiWalletDelegationNext)
-&gt; IO [ApiWalletDelegationNext]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletDelegationNext]
</span><a href="#local-6989586621682482518"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">((WalletDelegationNext -&gt; IO ApiWalletDelegationNext)
 -&gt; IO [ApiWalletDelegationNext])
-&gt; (WalletDelegationNext -&gt; IO ApiWalletDelegationNext)
-&gt; IO [ApiWalletDelegationNext]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletDelegationNext"><span class="hs-identifier hs-type">W.WalletDelegationNext</span></a></span><span class="hs-special">{</span><span id="local-6989586621682482513"><span class="annot"><span class="annottext">WalletDelegationStatus
$sel:status:WalletDelegationNext :: WalletDelegationNext -&gt; WalletDelegationStatus
status :: WalletDelegationStatus
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3Astatus%3AWalletDelegationNext"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682482511"><span class="annot"><span class="annottext">EpochNo
$sel:changesAt:WalletDelegationNext :: WalletDelegationNext -&gt; EpochNo
changesAt :: EpochNo
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AchangesAt%3AWalletDelegationNext"><span class="hs-identifier hs-var hs-var">changesAt</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-979"></span><span>        </span><span id="local-6989586621682482509"><span class="annot"><span class="annottext">ApiEpochInfo
</span><a href="#local-6989586621682482509"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Qry ApiEpochInfo -&gt; IO ApiEpochInfo
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO
</span><a href="#local-6989586621682482516"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry ApiEpochInfo -&gt; IO ApiEpochInfo)
-&gt; Qry ApiEpochInfo -&gt; IO ApiEpochInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Qry ApiEpochInfo
</span><a href="Cardano.Wallet.Api.Types.html#toApiEpochInfo"><span class="hs-identifier hs-var">toApiEpochInfo</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682482511"><span class="hs-identifier hs-var">changesAt</span></a></span><span>
</span><span id="line-980"></span><span>        </span><span class="annot"><span class="annottext">ApiWalletDelegationNext -&gt; IO ApiWalletDelegationNext
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletDelegationNext -&gt; IO ApiWalletDelegationNext)
-&gt; ApiWalletDelegationNext -&gt; IO ApiWalletDelegationNext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiEpochInfo
-&gt; WalletDelegationStatus -&gt; ApiWalletDelegationNext
</span><a href="#local-6989586621682482508"><span class="hs-identifier hs-var">toApiWalletDelegationNext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEpochInfo -&gt; Maybe ApiEpochInfo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEpochInfo
</span><a href="#local-6989586621682482509"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="#local-6989586621682482513"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>    </span><span class="annot"><span class="annottext">ApiWalletDelegation -&gt; IO ApiWalletDelegation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletDelegation -&gt; IO ApiWalletDelegation)
-&gt; ApiWalletDelegation -&gt; IO ApiWalletDelegation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegation :: ApiWalletDelegationNext
-&gt; [ApiWalletDelegationNext] -&gt; ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegation"><span class="hs-identifier hs-type">ApiWalletDelegation</span></a></span><span>
</span><span id="line-983"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:active:ApiWalletDelegation :: ApiWalletDelegationNext
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aactive%3AApiWalletDelegation"><span class="hs-identifier hs-var">active</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiEpochInfo
-&gt; WalletDelegationStatus -&gt; ApiWalletDelegationNext
</span><a href="#local-6989586621682482508"><span class="hs-identifier hs-var">toApiWalletDelegationNext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiEpochInfo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="#local-6989586621682482520"><span class="hs-identifier hs-var">active</span></a></span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:next:ApiWalletDelegation :: [ApiWalletDelegationNext]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Anext%3AApiWalletDelegation"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiWalletDelegationNext]
</span><a href="#local-6989586621682482515"><span class="hs-identifier hs-var">apiNext</span></a></span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-987"></span><span>    </span><span id="local-6989586621682482508"><span class="annot"><span class="annottext">toApiWalletDelegationNext :: Maybe ApiEpochInfo
-&gt; WalletDelegationStatus -&gt; ApiWalletDelegationNext
</span><a href="#local-6989586621682482508"><span class="hs-identifier hs-var hs-var">toApiWalletDelegationNext</span></a></span></span><span> </span><span id="local-6989586621682482504"><span class="annot"><span class="annottext">Maybe ApiEpochInfo
</span><a href="#local-6989586621682482504"><span class="hs-identifier hs-var">mepochInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-988"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Delegating"><span class="hs-identifier hs-type">W.Delegating</span></a></span><span> </span><span id="local-6989586621682482502"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682482502"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegationNext :: ApiWalletDelegationStatus
-&gt; Maybe (ApiT PoolId)
-&gt; Maybe ApiEpochInfo
-&gt; ApiWalletDelegationNext
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegationNext"><span class="hs-identifier hs-type">ApiWalletDelegationNext</span></a></span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:status:ApiWalletDelegationNext :: ApiWalletDelegationStatus
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Astatus%3AApiWalletDelegationNext"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegationStatus
</span><a href="Cardano.Wallet.Api.Types.html#Delegating"><span class="hs-identifier hs-var">Delegating</span></a></span><span>
</span><span id="line-990"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:target:ApiWalletDelegationNext :: Maybe (ApiT PoolId)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atarget%3AApiWalletDelegationNext"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT PoolId -&gt; Maybe (ApiT PoolId)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682482502"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:changesAt:ApiWalletDelegationNext :: Maybe ApiEpochInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AchangesAt%3AApiWalletDelegationNext"><span class="hs-identifier hs-var">changesAt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiEpochInfo
</span><a href="#local-6989586621682482504"><span class="hs-identifier hs-var">mepochInfo</span></a></span><span>
</span><span id="line-992"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span>        </span><span class="annot"><span class="annottext">WalletDelegationStatus
</span><a href="Cardano.Wallet.Primitive.Types.html#NotDelegating"><span class="hs-identifier hs-var">W.NotDelegating</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegationNext :: ApiWalletDelegationStatus
-&gt; Maybe (ApiT PoolId)
-&gt; Maybe ApiEpochInfo
-&gt; ApiWalletDelegationNext
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegationNext"><span class="hs-identifier hs-type">ApiWalletDelegationNext</span></a></span><span>
</span><span id="line-995"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:status:ApiWalletDelegationNext :: ApiWalletDelegationStatus
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Astatus%3AApiWalletDelegationNext"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegationStatus
</span><a href="Cardano.Wallet.Api.Types.html#NotDelegating"><span class="hs-identifier hs-var">NotDelegating</span></a></span><span>
</span><span id="line-996"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:target:ApiWalletDelegationNext :: Maybe (ApiT PoolId)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atarget%3AApiWalletDelegationNext"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT PoolId)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-997"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:changesAt:ApiWalletDelegationNext :: Maybe ApiEpochInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AchangesAt%3AApiWalletDelegationNext"><span class="hs-identifier hs-var">changesAt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiEpochInfo
</span><a href="#local-6989586621682482504"><span class="hs-identifier hs-var">mepochInfo</span></a></span><span>
</span><span id="line-998"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="hs-comment">--------------------- Shared Wallet</span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postSharedWallet"><span class="hs-identifier hs-type">postSharedWallet</span></a></span><span>
</span><span id="line-1003"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482494"><span class="annot"><a href="#local-6989586621682482494"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482493"><span class="annot"><a href="#local-6989586621682482493"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482492"><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482491"><span class="annot"><a href="#local-6989586621682482491"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1004"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482491"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1005"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482494"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1006"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1007"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482491"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1009"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1010"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482494"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1011"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482494"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1012"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482491"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1013"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-1014"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482494"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1016"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482492"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostData"><span class="hs-identifier hs-type">ApiSharedWalletPostData</span></a></span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span>
</span><span id="line-1020"></span><span id="postSharedWallet"><span class="annot"><span class="annottext">postSharedWallet :: ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; ApiSharedWalletPostData
-&gt; Handler ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#postSharedWallet"><span class="hs-identifier hs-var hs-var">postSharedWallet</span></a></span></span><span> </span><span id="local-6989586621682482490"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482490"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482489"><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482489"><span class="hs-identifier hs-var">generateKey</span></a></span></span><span> </span><span id="local-6989586621682482488"><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482488"><span class="hs-identifier hs-var">liftKey</span></a></span></span><span> </span><span id="local-6989586621682482487"><span class="annot"><span class="annottext">ApiSharedWalletPostData
</span><a href="#local-6989586621682482487"><span class="hs-identifier hs-var">postData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostData
</span><a href="#local-6989586621682482487"><span class="hs-identifier hs-var">postData</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1022"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostData"><span class="hs-identifier hs-type">ApiSharedWalletPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682482485"><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482485"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1023"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Handler ApiSharedWallet
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(s ~ SharedState n k, ctx ~ ApiLayer s k, SoftDerivation k,
 MkKeyFingerprint k (Proxy n, k 'AddressK XPub),
 MkKeyFingerprint k Address, WalletKey k, HasDBFactory s k ctx,
 HasWorkerRegistry s k ctx, Typeable n, k ~ SharedKey) =&gt;
ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Handler ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#postSharedWalletFromRootXPrv"><span class="hs-identifier hs-var">postSharedWalletFromRootXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482490"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482489"><span class="hs-identifier hs-var">generateKey</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482485"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1024"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostData"><span class="hs-identifier hs-type">ApiSharedWalletPostData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682482483"><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482483"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1025"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Handler ApiSharedWallet
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(s ~ SharedState n k, ctx ~ ApiLayer s k, SoftDerivation k,
 MkKeyFingerprint k (Proxy n, k 'AddressK XPub),
 MkKeyFingerprint k Address, WalletKey k, HasDBFactory s k ctx,
 HasWorkerRegistry s k ctx, Typeable n, k ~ SharedKey) =&gt;
ctx
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Handler ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#postSharedWalletFromAccountXPub"><span class="hs-identifier hs-var">postSharedWalletFromAccountXPub</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482490"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482488"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482483"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postSharedWalletFromRootXPrv"><span class="hs-identifier hs-type">postSharedWalletFromRootXPrv</span></a></span><span>
</span><span id="line-1028"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484206"><span class="annot"><a href="#local-6989586621682484206"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484210"><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484208"><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484209"><span class="annot"><a href="#local-6989586621682484209"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1029"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484209"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1030"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484206"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1031"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1032"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484209"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1033"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1034"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1035"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484206"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1036"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484206"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1037"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484209"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1038"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-1039"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484206"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1041"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostDataFromMnemonics"><span class="hs-identifier hs-type">ApiSharedWalletPostDataFromMnemonics</span></a></span><span>
</span><span id="line-1043"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span>
</span><span id="line-1044"></span><span id="postSharedWalletFromRootXPrv"><span class="annot"><span class="annottext">postSharedWalletFromRootXPrv :: ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Handler ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#postSharedWalletFromRootXPrv"><span class="hs-identifier hs-var hs-var">postSharedWalletFromRootXPrv</span></a></span></span><span> </span><span id="local-6989586621682482481"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482481"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482480"><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482480"><span class="hs-identifier hs-var">generateKey</span></a></span></span><span> </span><span id="local-6989586621682482479"><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1045"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; ValidationLevel
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; Either ErrScriptTemplate ()
forall (k :: Depth -&gt; * -&gt; *).
WalletKey k =&gt;
k 'AccountK XPub
-&gt; ValidationLevel
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; Either ErrScriptTemplate ()
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#validateScriptTemplates"><span class="hs-identifier hs-var">validateScriptTemplates</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482478"><span class="hs-identifier hs-var">accXPub</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationLevel
</span><a href="#local-6989586621682482477"><span class="hs-identifier hs-var">scriptValidation</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682482476"><span class="hs-identifier hs-var">pTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682482475"><span class="hs-identifier hs-var">dTemplateM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1046"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682482474"><span class="annot"><span class="annottext">ErrScriptTemplate
</span><a href="#local-6989586621682482474"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1047"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrConstructSharedWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructSharedWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructSharedWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructSharedWallet -&gt; ExceptT ErrConstructSharedWallet IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrConstructSharedWallet
 -&gt; ExceptT ErrConstructSharedWallet IO ())
-&gt; ErrConstructSharedWallet
-&gt; ExceptT ErrConstructSharedWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrScriptTemplate -&gt; ErrConstructSharedWallet
</span><a href="Cardano.Wallet.html#ErrConstructSharedWalletWrongScriptTemplate"><span class="hs-identifier hs-var">ErrConstructSharedWalletWrongScriptTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">ErrScriptTemplate
</span><a href="#local-6989586621682482474"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1048"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>    </span><span id="local-6989586621682482472"><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482472"><span class="hs-identifier hs-var">ix'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
-&gt; Handler (Index 'Hardened 'AccountK)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
 -&gt; Handler (Index 'Hardened 'AccountK))
-&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
-&gt; Handler (Index 'Hardened 'AccountK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Hardened 'AccountK
 -&gt; ErrConstructSharedWallet)
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
-&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
-&gt; ErrConstructSharedWallet
</span><a href="Cardano.Wallet.html#ErrConstructSharedWalletInvalidIndex"><span class="hs-identifier hs-var">ErrConstructSharedWalletInvalidIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ErrInvalidDerivationIndex 'Hardened 'AccountK)
   IO
   (Index 'Hardened 'AccountK)
 -&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK))
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
-&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1050"></span><span>        </span><span class="annot"><span class="annottext">DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
forall (m :: * -&gt; *) (level :: Depth) (whatever :: Depth).
Monad m =&gt;
DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
</span><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier hs-var">W.guardHardIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682482469"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-1051"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482468"><span class="annot"><span class="annottext">state :: SharedState n k
</span><a href="#local-6989586621682482468"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Index 'Hardened 'AccountK
-&gt; AddressPoolGap
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; SharedState n k
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
(SupportsDiscovery n k, WalletKey k, k ~ SharedKey) =&gt;
(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Index 'Hardened 'AccountK
-&gt; AddressPoolGap
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; SharedState n k
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#mkSharedStateFromRootXPrv"><span class="hs-identifier hs-var">mkSharedStateFromRootXPrv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482467"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482466"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482472"><span class="hs-identifier hs-var">ix'</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="#local-6989586621682482465"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682482476"><span class="hs-identifier hs-var">pTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682482475"><span class="hs-identifier hs-var">dTemplateM</span></a></span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><span class="annottext">Handler WalletId -&gt; Handler ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler WalletId -&gt; Handler ()) -&gt; Handler WalletId -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var">createWalletWorker</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482464"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1053"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682482463"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482463"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
(MonadUnliftIO m, MonadTime m, HasGenesisData ctx,
 HasDBLayer m s k ctx, IsOurs s Address, IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var">W.createWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484206"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482463"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482464"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482462"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482468"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
forall ctx wid a. ctx -&gt; wid -&gt; IO a
</span><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier hs-var">idleWorker</span></a></span><span>
</span><span id="line-1055"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482464"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482461"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482461"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1056"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwd"><span class="hs-identifier hs-var">W.attachPrivateKeyFromPwd</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682482461"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482464"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482467"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482460"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1057"></span><span>    </span><span class="annot"><span class="annottext">(ApiSharedWallet, UTCTime) -&gt; ApiSharedWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiSharedWallet, UTCTime) -&gt; ApiSharedWallet)
-&gt; Handler (ApiSharedWallet, UTCTime) -&gt; Handler ApiSharedWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s ApiSharedWallet
-&gt; ApiT WalletId
-&gt; Handler (ApiSharedWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SharedState n k,
 HasWorkerRegistry s k ctx, SupportsDiscovery n k) =&gt;
MkApiWallet ctx s ApiSharedWallet
forall (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SharedState n k,
 HasWorkerRegistry s k ctx, SupportsDiscovery n k) =&gt;
MkApiWallet ctx s ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkSharedWallet"><span class="hs-identifier hs-var">mkSharedWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484208"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482464"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1059"></span><span>    </span><span id="local-6989586621682482459"><span class="annot"><span class="annottext">seed :: SomeMnemonic
</span><a href="#local-6989586621682482459"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const SomeMnemonic ApiSharedWalletPostDataFromMnemonics)
-&gt; SomeMnemonic
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSentence&quot;
  ((ApiMnemonicT '[15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[15, 18, 21, 24]))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const SomeMnemonic ApiSharedWalletPostDataFromMnemonics)
(ApiMnemonicT '[15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ApiMnemonicT '[15, 18, 21, 24]))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const SomeMnemonic ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482458"><span class="hs-var">#mnemonicSentence</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiMnemonicT '[15, 18, 21, 24]
  -&gt; Const SomeMnemonic (ApiMnemonicT '[15, 18, 21, 24]))
 -&gt; ApiSharedWalletPostDataFromMnemonics
 -&gt; Const SomeMnemonic ApiSharedWalletPostDataFromMnemonics)
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ApiMnemonicT '[15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[15, 18, 21, 24]))
-&gt; (SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const SomeMnemonic ApiSharedWalletPostDataFromMnemonics
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiMnemonicT&quot;
  ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
   -&gt; ApiMnemonicT '[15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ApiMnemonicT '[15, 18, 21, 24]))
(SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ApiMnemonicT '[15, 18, 21, 24]
-&gt; Const SomeMnemonic (ApiMnemonicT '[15, 18, 21, 24])
</span><a href="#local-6989586621682482456"><span class="hs-var">#getApiMnemonicT</span></a></span><span>
</span><span id="line-1060"></span><span>    </span><span id="local-6989586621682482455"><span class="annot"><span class="annottext">secondFactor :: Maybe SomeMnemonic
</span><a href="#local-6989586621682482455"><span class="hs-identifier hs-var hs-var">secondFactor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiMnemonicT '[9, 12] -&gt; SomeMnemonic
forall (sizes :: [Nat]). ApiMnemonicT sizes -&gt; SomeMnemonic
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiMnemonicT%3AApiMnemonicT"><span class="hs-identifier hs-var hs-var">getApiMnemonicT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiMnemonicT '[9, 12] -&gt; SomeMnemonic)
-&gt; Maybe (ApiMnemonicT '[9, 12]) -&gt; Maybe SomeMnemonic
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((Maybe (ApiMnemonicT '[9, 12])
     -&gt; Const
          (Maybe (ApiMnemonicT '[9, 12])) (Maybe (ApiMnemonicT '[9, 12])))
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const
         (Maybe (ApiMnemonicT '[9, 12]))
         ApiSharedWalletPostDataFromMnemonics)
-&gt; Maybe (ApiMnemonicT '[9, 12])
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSecondFactor&quot;
  ((Maybe (ApiMnemonicT '[9, 12])
    -&gt; Const
         (Maybe (ApiMnemonicT '[9, 12])) (Maybe (ApiMnemonicT '[9, 12])))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const
        (Maybe (ApiMnemonicT '[9, 12]))
        ApiSharedWalletPostDataFromMnemonics)
(Maybe (ApiMnemonicT '[9, 12])
 -&gt; Const
      (Maybe (ApiMnemonicT '[9, 12])) (Maybe (ApiMnemonicT '[9, 12])))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const
     (Maybe (ApiMnemonicT '[9, 12]))
     ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482454"><span class="hs-var">#mnemonicSecondFactor</span></a></span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621682482466"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482466"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482460"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-1062"></span><span>    </span><span id="local-6989586621682482460"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482460"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const (Passphrase &quot;user&quot;) ApiSharedWalletPostDataFromMnemonics)
-&gt; Passphrase &quot;user&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const (Passphrase &quot;user&quot;) ApiSharedWalletPostDataFromMnemonics)
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const (Passphrase &quot;user&quot;) ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482453"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;user&quot;)
  -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
 -&gt; ApiSharedWalletPostDataFromMnemonics
 -&gt; Const (Passphrase &quot;user&quot;) ApiSharedWalletPostDataFromMnemonics)
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; (Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const (Passphrase &quot;user&quot;) ApiSharedWalletPostDataFromMnemonics
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
   -&gt; ApiT (Passphrase &quot;user&quot;)
   -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
(Passphrase &quot;user&quot;
 -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ApiT (Passphrase &quot;user&quot;)
-&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;))
</span><a href="#local-6989586621682482452"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1063"></span><span>    </span><span id="local-6989586621682482467"><span class="annot"><span class="annottext">rootXPrv :: k 'RootK XPrv
</span><a href="#local-6989586621682482467"><span class="hs-identifier hs-var hs-var">rootXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482480"><span class="hs-identifier hs-var">generateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482459"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SomeMnemonic
</span><a href="#local-6989586621682482455"><span class="hs-identifier hs-var">secondFactor</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482466"><span class="hs-identifier hs-var">pwdP</span></a></span><span>
</span><span id="line-1064"></span><span>    </span><span id="local-6989586621682482465"><span class="annot"><span class="annottext">g :: AddressPoolGap
</span><a href="#local-6989586621682482465"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier hs-var">defaultAddressPoolGap</span></a></span><span>
</span><span id="line-1065"></span><span>    </span><span id="local-6989586621682482469"><span class="annot"><span class="annottext">ix :: DerivationIndex
</span><a href="#local-6989586621682482469"><span class="hs-identifier hs-var hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; DerivationIndex
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((ApiT DerivationIndex
     -&gt; Const (ApiT DerivationIndex) (ApiT DerivationIndex))
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const
         (ApiT DerivationIndex) ApiSharedWalletPostDataFromMnemonics)
-&gt; ApiT DerivationIndex
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;accountIndex&quot;
  ((ApiT DerivationIndex
    -&gt; Const (ApiT DerivationIndex) (ApiT DerivationIndex))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const
        (ApiT DerivationIndex) ApiSharedWalletPostDataFromMnemonics)
(ApiT DerivationIndex
 -&gt; Const (ApiT DerivationIndex) (ApiT DerivationIndex))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const
     (ApiT DerivationIndex) ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482451"><span class="hs-var">#accountIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>    </span><span id="local-6989586621682482476"><span class="annot"><span class="annottext">pTemplate :: ScriptTemplate
</span><a href="#local-6989586621682482476"><span class="hs-identifier hs-var hs-var">pTemplate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Api.Server.html#scriptTemplateFromSelf"><span class="hs-identifier hs-var">scriptTemplateFromSelf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482478"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ApiScriptTemplateEntry -&gt; ScriptTemplate)
-&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((ApiScriptTemplateEntry
     -&gt; Const ApiScriptTemplateEntry ApiScriptTemplateEntry)
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const
         ApiScriptTemplateEntry ApiSharedWalletPostDataFromMnemonics)
-&gt; ApiScriptTemplateEntry
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;paymentScriptTemplate&quot;
  ((ApiScriptTemplateEntry
    -&gt; Const ApiScriptTemplateEntry ApiScriptTemplateEntry)
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const
        ApiScriptTemplateEntry ApiSharedWalletPostDataFromMnemonics)
(ApiScriptTemplateEntry
 -&gt; Const ApiScriptTemplateEntry ApiScriptTemplateEntry)
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const
     ApiScriptTemplateEntry ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482448"><span class="hs-var">#paymentScriptTemplate</span></a></span><span>
</span><span id="line-1067"></span><span>    </span><span id="local-6989586621682482475"><span class="annot"><span class="annottext">dTemplateM :: Maybe ScriptTemplate
</span><a href="#local-6989586621682482475"><span class="hs-identifier hs-var hs-var">dTemplateM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Api.Server.html#scriptTemplateFromSelf"><span class="hs-identifier hs-var">scriptTemplateFromSelf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482478"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ApiScriptTemplateEntry -&gt; ScriptTemplate)
-&gt; Maybe ApiScriptTemplateEntry -&gt; Maybe ScriptTemplate
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((Maybe ApiScriptTemplateEntry
     -&gt; Const
          (Maybe ApiScriptTemplateEntry) (Maybe ApiScriptTemplateEntry))
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const
         (Maybe ApiScriptTemplateEntry)
         ApiSharedWalletPostDataFromMnemonics)
-&gt; Maybe ApiScriptTemplateEntry
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegationScriptTemplate&quot;
  ((Maybe ApiScriptTemplateEntry
    -&gt; Const
         (Maybe ApiScriptTemplateEntry) (Maybe ApiScriptTemplateEntry))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const
        (Maybe ApiScriptTemplateEntry)
        ApiSharedWalletPostDataFromMnemonics)
(Maybe ApiScriptTemplateEntry
 -&gt; Const
      (Maybe ApiScriptTemplateEntry) (Maybe ApiScriptTemplateEntry))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const
     (Maybe ApiScriptTemplateEntry) ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482447"><span class="hs-var">#delegationScriptTemplate</span></a></span><span>
</span><span id="line-1068"></span><span>    </span><span id="local-6989586621682482462"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482462"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT WalletName -&gt; WalletName
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const (ApiT WalletName) ApiSharedWalletPostDataFromMnemonics)
-&gt; ApiT WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const (ApiT WalletName) ApiSharedWalletPostDataFromMnemonics)
(ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const (ApiT WalletName) ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482446"><span class="hs-var">#name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>    </span><span id="local-6989586621682482478"><span class="annot"><span class="annottext">accXPub :: k 'AccountK XPub
</span><a href="#local-6989586621682482478"><span class="hs-identifier hs-var hs-var">accXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPrv -&gt; k 'AccountK XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
key depth XPrv -&gt; key depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'AccountK XPrv -&gt; k 'AccountK XPub)
-&gt; k 'AccountK XPrv -&gt; k 'AccountK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; k 'RootK XPrv -&gt; Index 'Hardened 'AccountK -&gt; k 'AccountK XPrv
forall (key :: Depth -&gt; * -&gt; *).
HardDerivation key =&gt;
Passphrase &quot;encryption&quot;
-&gt; key 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; key 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var">deriveAccountPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482466"><span class="hs-identifier hs-var">pwdP</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482467"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Index 'Hardened 'AccountK
forall (derivationType :: DerivationType) (level :: Depth).
Word32 -&gt; Index derivationType level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Index 'Hardened 'AccountK)
-&gt; Word32 -&gt; Index 'Hardened 'AccountK
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getDerivationIndex"><span class="hs-identifier hs-var hs-var">getDerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682482469"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>    </span><span id="local-6989586621682482464"><span class="annot"><span class="annottext">wid :: WalletId
</span><a href="#local-6989586621682482464"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; WalletId
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-var">WalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; WalletId) -&gt; Digest Blake2b_160 -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; ScriptTemplate -&gt; Maybe ScriptTemplate -&gt; Digest Blake2b_160
forall (k :: Depth -&gt; * -&gt; *).
(WalletKey k, k ~ SharedKey) =&gt;
k 'AccountK XPub
-&gt; ScriptTemplate -&gt; Maybe ScriptTemplate -&gt; Digest Blake2b_160
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#toSharedWalletId"><span class="hs-identifier hs-var">toSharedWalletId</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482478"><span class="hs-identifier hs-var">accXPub</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682482476"><span class="hs-identifier hs-var">pTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682482475"><span class="hs-identifier hs-var">dTemplateM</span></a></span><span>
</span><span id="line-1071"></span><span>    </span><span id="local-6989586621682482477"><span class="annot"><span class="annottext">scriptValidation :: ValidationLevel
</span><a href="#local-6989586621682482477"><span class="hs-identifier hs-var hs-var">scriptValidation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationLevel
-&gt; (ApiT ValidationLevel -&gt; ValidationLevel)
-&gt; Maybe (ApiT ValidationLevel)
-&gt; ValidationLevel
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationLevel
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RecommendedValidation</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT ValidationLevel -&gt; ValidationLevel
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482479"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromMnemonics
-&gt; ((Maybe (ApiT ValidationLevel)
     -&gt; Const
          (Maybe (ApiT ValidationLevel)) (Maybe (ApiT ValidationLevel)))
    -&gt; ApiSharedWalletPostDataFromMnemonics
    -&gt; Const
         (Maybe (ApiT ValidationLevel))
         ApiSharedWalletPostDataFromMnemonics)
-&gt; Maybe (ApiT ValidationLevel)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidation&quot;
  ((Maybe (ApiT ValidationLevel)
    -&gt; Const
         (Maybe (ApiT ValidationLevel)) (Maybe (ApiT ValidationLevel)))
   -&gt; ApiSharedWalletPostDataFromMnemonics
   -&gt; Const
        (Maybe (ApiT ValidationLevel))
        ApiSharedWalletPostDataFromMnemonics)
(Maybe (ApiT ValidationLevel)
 -&gt; Const
      (Maybe (ApiT ValidationLevel)) (Maybe (ApiT ValidationLevel)))
-&gt; ApiSharedWalletPostDataFromMnemonics
-&gt; Const
     (Maybe (ApiT ValidationLevel)) ApiSharedWalletPostDataFromMnemonics
</span><a href="#local-6989586621682482441"><span class="hs-var">#scriptValidation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postSharedWalletFromAccountXPub"><span class="hs-identifier hs-type">postSharedWalletFromAccountXPub</span></a></span><span>
</span><span id="line-1074"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484202"><span class="annot"><a href="#local-6989586621682484202"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484205"><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484203"><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484204"><span class="annot"><a href="#local-6989586621682484204"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1075"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484204"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484202"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1078"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484204"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1080"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1081"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484202"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1082"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484202"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1083"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484204"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1084"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-1085"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484202"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1087"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPostDataFromAccountPubX"><span class="hs-identifier hs-type">ApiSharedWalletPostDataFromAccountPubX</span></a></span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span>
</span><span id="line-1090"></span><span id="postSharedWalletFromAccountXPub"><span class="annot"><span class="annottext">postSharedWalletFromAccountXPub :: ctx
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Handler ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#postSharedWalletFromAccountXPub"><span class="hs-identifier hs-var hs-var">postSharedWalletFromAccountXPub</span></a></span></span><span> </span><span id="local-6989586621682482440"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482440"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482439"><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482439"><span class="hs-identifier hs-var">liftKey</span></a></span></span><span> </span><span id="local-6989586621682482438"><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1091"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; ValidationLevel
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; Either ErrScriptTemplate ()
forall (k :: Depth -&gt; * -&gt; *).
WalletKey k =&gt;
k 'AccountK XPub
-&gt; ValidationLevel
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; Either ErrScriptTemplate ()
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#validateScriptTemplates"><span class="hs-identifier hs-var">validateScriptTemplates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482439"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482437"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ValidationLevel
</span><a href="#local-6989586621682482436"><span class="hs-identifier hs-var">scriptValidation</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682482435"><span class="hs-identifier hs-var">pTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682482434"><span class="hs-identifier hs-var">dTemplateM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1092"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682482433"><span class="annot"><span class="annottext">ErrScriptTemplate
</span><a href="#local-6989586621682482433"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1093"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrConstructSharedWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructSharedWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructSharedWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructSharedWallet -&gt; ExceptT ErrConstructSharedWallet IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrConstructSharedWallet
 -&gt; ExceptT ErrConstructSharedWallet IO ())
-&gt; ErrConstructSharedWallet
-&gt; ExceptT ErrConstructSharedWallet IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrScriptTemplate -&gt; ErrConstructSharedWallet
</span><a href="Cardano.Wallet.html#ErrConstructSharedWalletWrongScriptTemplate"><span class="hs-identifier hs-var">ErrConstructSharedWalletWrongScriptTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">ErrScriptTemplate
</span><a href="#local-6989586621682482433"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1094"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>    </span><span id="local-6989586621682482432"><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482432"><span class="hs-identifier hs-var">acctIx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
-&gt; Handler (Index 'Hardened 'AccountK)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
 -&gt; Handler (Index 'Hardened 'AccountK))
-&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
-&gt; Handler (Index 'Hardened 'AccountK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrInvalidDerivationIndex 'Hardened 'AccountK
 -&gt; ErrConstructSharedWallet)
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
-&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
-&gt; ErrConstructSharedWallet
</span><a href="Cardano.Wallet.html#ErrConstructSharedWalletInvalidIndex"><span class="hs-identifier hs-var">ErrConstructSharedWalletInvalidIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (ErrInvalidDerivationIndex 'Hardened 'AccountK)
   IO
   (Index 'Hardened 'AccountK)
 -&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK))
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
-&gt; ExceptT ErrConstructSharedWallet IO (Index 'Hardened 'AccountK)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1096"></span><span>        </span><span class="annot"><span class="annottext">DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened 'AccountK)
     IO
     (Index 'Hardened 'AccountK)
forall (m :: * -&gt; *) (level :: Depth) (whatever :: Depth).
Monad m =&gt;
DerivationIndex
-&gt; ExceptT
     (ErrInvalidDerivationIndex 'Hardened level)
     m
     (Index 'Hardened whatever)
</span><a href="Cardano.Wallet.html#guardHardIndex"><span class="hs-identifier hs-var">W.guardHardIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682482431"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-1097"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482430"><span class="annot"><span class="annottext">state :: SharedState n k
</span><a href="#local-6989586621682482430"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; Index 'Hardened 'AccountK
-&gt; AddressPoolGap
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; SharedState n k
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
(SupportsDiscovery n k, WalletKey k, k ~ SharedKey) =&gt;
k 'AccountK XPub
-&gt; Index 'Hardened 'AccountK
-&gt; AddressPoolGap
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; SharedState n k
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#mkSharedStateFromAccountXPub"><span class="hs-identifier hs-var">mkSharedStateFromAccountXPub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482439"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482437"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482432"><span class="hs-identifier hs-var">acctIx</span></a></span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="#local-6989586621682482429"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682482435"><span class="hs-identifier hs-var">pTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682482434"><span class="hs-identifier hs-var">dTemplateM</span></a></span><span>
</span><span id="line-1098"></span><span>    </span><span class="annot"><span class="annottext">Handler WalletId -&gt; Handler ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler WalletId -&gt; Handler ()) -&gt; Handler WalletId -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var">createWalletWorker</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482440"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482428"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1099"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682482427"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482427"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
(MonadUnliftIO m, MonadTime m, HasGenesisData ctx,
 HasDBLayer m s k ctx, IsOurs s Address, IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var">W.createWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484202"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482427"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482428"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482426"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482430"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
forall ctx wid a. ctx -&gt; wid -&gt; IO a
</span><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier hs-var">idleWorker</span></a></span><span>
</span><span id="line-1101"></span><span>    </span><span class="annot"><span class="annottext">(ApiSharedWallet, UTCTime) -&gt; ApiSharedWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiSharedWallet, UTCTime) -&gt; ApiSharedWallet)
-&gt; Handler (ApiSharedWallet, UTCTime) -&gt; Handler ApiSharedWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s ApiSharedWallet
-&gt; ApiT WalletId
-&gt; Handler (ApiSharedWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482440"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SharedState n k,
 HasWorkerRegistry s k ctx, SupportsDiscovery n k) =&gt;
MkApiWallet ctx s ApiSharedWallet
forall (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SharedState n k,
 HasWorkerRegistry s k ctx, SupportsDiscovery n k) =&gt;
MkApiWallet ctx s ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkSharedWallet"><span class="hs-identifier hs-var">mkSharedWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484205"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484203"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482428"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1103"></span><span>    </span><span id="local-6989586621682482429"><span class="annot"><span class="annottext">g :: AddressPoolGap
</span><a href="#local-6989586621682482429"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#defaultAddressPoolGap"><span class="hs-identifier hs-var">defaultAddressPoolGap</span></a></span><span>
</span><span id="line-1104"></span><span>    </span><span id="local-6989586621682482431"><span class="annot"><span class="annottext">ix :: DerivationIndex
</span><a href="#local-6989586621682482431"><span class="hs-identifier hs-var hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; DerivationIndex
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
-&gt; ((ApiT DerivationIndex
     -&gt; Const (ApiT DerivationIndex) (ApiT DerivationIndex))
    -&gt; ApiSharedWalletPostDataFromAccountPubX
    -&gt; Const
         (ApiT DerivationIndex) ApiSharedWalletPostDataFromAccountPubX)
-&gt; ApiT DerivationIndex
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;accountIndex&quot;
  ((ApiT DerivationIndex
    -&gt; Const (ApiT DerivationIndex) (ApiT DerivationIndex))
   -&gt; ApiSharedWalletPostDataFromAccountPubX
   -&gt; Const
        (ApiT DerivationIndex) ApiSharedWalletPostDataFromAccountPubX)
(ApiT DerivationIndex
 -&gt; Const (ApiT DerivationIndex) (ApiT DerivationIndex))
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Const
     (ApiT DerivationIndex) ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482425"><span class="hs-var">#accountIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>    </span><span id="local-6989586621682482435"><span class="annot"><span class="annottext">pTemplate :: ScriptTemplate
</span><a href="#local-6989586621682482435"><span class="hs-identifier hs-var hs-var">pTemplate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Api.Server.html#scriptTemplateFromSelf"><span class="hs-identifier hs-var">scriptTemplateFromSelf</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482437"><span class="hs-identifier hs-var">accXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiScriptTemplateEntry -&gt; ScriptTemplate)
-&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
-&gt; ((ApiScriptTemplateEntry
     -&gt; Const ApiScriptTemplateEntry ApiScriptTemplateEntry)
    -&gt; ApiSharedWalletPostDataFromAccountPubX
    -&gt; Const
         ApiScriptTemplateEntry ApiSharedWalletPostDataFromAccountPubX)
-&gt; ApiScriptTemplateEntry
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;paymentScriptTemplate&quot;
  ((ApiScriptTemplateEntry
    -&gt; Const ApiScriptTemplateEntry ApiScriptTemplateEntry)
   -&gt; ApiSharedWalletPostDataFromAccountPubX
   -&gt; Const
        ApiScriptTemplateEntry ApiSharedWalletPostDataFromAccountPubX)
(ApiScriptTemplateEntry
 -&gt; Const ApiScriptTemplateEntry ApiScriptTemplateEntry)
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Const
     ApiScriptTemplateEntry ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482424"><span class="hs-var">#paymentScriptTemplate</span></a></span><span>
</span><span id="line-1106"></span><span>    </span><span id="local-6989586621682482434"><span class="annot"><span class="annottext">dTemplateM :: Maybe ScriptTemplate
</span><a href="#local-6989586621682482434"><span class="hs-identifier hs-var hs-var">dTemplateM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Api.Server.html#scriptTemplateFromSelf"><span class="hs-identifier hs-var">scriptTemplateFromSelf</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482437"><span class="hs-identifier hs-var">accXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiScriptTemplateEntry -&gt; ScriptTemplate)
-&gt; Maybe ApiScriptTemplateEntry -&gt; Maybe ScriptTemplate
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
-&gt; ((Maybe ApiScriptTemplateEntry
     -&gt; Const
          (Maybe ApiScriptTemplateEntry) (Maybe ApiScriptTemplateEntry))
    -&gt; ApiSharedWalletPostDataFromAccountPubX
    -&gt; Const
         (Maybe ApiScriptTemplateEntry)
         ApiSharedWalletPostDataFromAccountPubX)
-&gt; Maybe ApiScriptTemplateEntry
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegationScriptTemplate&quot;
  ((Maybe ApiScriptTemplateEntry
    -&gt; Const
         (Maybe ApiScriptTemplateEntry) (Maybe ApiScriptTemplateEntry))
   -&gt; ApiSharedWalletPostDataFromAccountPubX
   -&gt; Const
        (Maybe ApiScriptTemplateEntry)
        ApiSharedWalletPostDataFromAccountPubX)
(Maybe ApiScriptTemplateEntry
 -&gt; Const
      (Maybe ApiScriptTemplateEntry) (Maybe ApiScriptTemplateEntry))
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Const
     (Maybe ApiScriptTemplateEntry)
     ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482423"><span class="hs-var">#delegationScriptTemplate</span></a></span><span>
</span><span id="line-1107"></span><span>    </span><span id="local-6989586621682482426"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482426"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT WalletName -&gt; WalletName
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
-&gt; ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
    -&gt; ApiSharedWalletPostDataFromAccountPubX
    -&gt; Const (ApiT WalletName) ApiSharedWalletPostDataFromAccountPubX)
-&gt; ApiT WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
   -&gt; ApiSharedWalletPostDataFromAccountPubX
   -&gt; Const (ApiT WalletName) ApiSharedWalletPostDataFromAccountPubX)
(ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Const (ApiT WalletName) ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482422"><span class="hs-var">#name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1108"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAccountPublicKey"><span class="hs-identifier hs-type">ApiAccountPublicKey</span></a></span><span> </span><span id="local-6989586621682482421"><span class="annot"><span class="annottext">ApiT XPub
</span><a href="#local-6989586621682482421"><span class="hs-identifier hs-var">accXPubApiT</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
-&gt; ((ApiAccountPublicKey
     -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
    -&gt; ApiSharedWalletPostDataFromAccountPubX
    -&gt; Const
         ApiAccountPublicKey ApiSharedWalletPostDataFromAccountPubX)
-&gt; ApiAccountPublicKey
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;accountPublicKey&quot;
  ((ApiAccountPublicKey
    -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
   -&gt; ApiSharedWalletPostDataFromAccountPubX
   -&gt; Const
        ApiAccountPublicKey ApiSharedWalletPostDataFromAccountPubX)
(ApiAccountPublicKey
 -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Const ApiAccountPublicKey ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482420"><span class="hs-var">#accountPublicKey</span></a></span><span>
</span><span id="line-1109"></span><span>    </span><span id="local-6989586621682482437"><span class="annot"><span class="annottext">accXPub :: XPub
</span><a href="#local-6989586621682482437"><span class="hs-identifier hs-var hs-var">accXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT XPub -&gt; XPub
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT XPub
</span><a href="#local-6989586621682482421"><span class="hs-identifier hs-var">accXPubApiT</span></a></span><span>
</span><span id="line-1110"></span><span>    </span><span id="local-6989586621682482428"><span class="annot"><span class="annottext">wid :: WalletId
</span><a href="#local-6989586621682482428"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; WalletId
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-var">WalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; WalletId) -&gt; Digest Blake2b_160 -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
-&gt; ScriptTemplate -&gt; Maybe ScriptTemplate -&gt; Digest Blake2b_160
forall (k :: Depth -&gt; * -&gt; *).
(WalletKey k, k ~ SharedKey) =&gt;
k 'AccountK XPub
-&gt; ScriptTemplate -&gt; Maybe ScriptTemplate -&gt; Digest Blake2b_160
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#toSharedWalletId"><span class="hs-identifier hs-var">toSharedWalletId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482439"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482437"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptTemplate
</span><a href="#local-6989586621682482435"><span class="hs-identifier hs-var">pTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptTemplate
</span><a href="#local-6989586621682482434"><span class="hs-identifier hs-var">dTemplateM</span></a></span><span>
</span><span id="line-1111"></span><span>    </span><span id="local-6989586621682482436"><span class="annot"><span class="annottext">scriptValidation :: ValidationLevel
</span><a href="#local-6989586621682482436"><span class="hs-identifier hs-var hs-var">scriptValidation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationLevel
-&gt; (ApiT ValidationLevel -&gt; ValidationLevel)
-&gt; Maybe (ApiT ValidationLevel)
-&gt; ValidationLevel
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationLevel
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RecommendedValidation</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT ValidationLevel -&gt; ValidationLevel
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482438"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPostDataFromAccountPubX
-&gt; ((Maybe (ApiT ValidationLevel)
     -&gt; Const
          (Maybe (ApiT ValidationLevel)) (Maybe (ApiT ValidationLevel)))
    -&gt; ApiSharedWalletPostDataFromAccountPubX
    -&gt; Const
         (Maybe (ApiT ValidationLevel))
         ApiSharedWalletPostDataFromAccountPubX)
-&gt; Maybe (ApiT ValidationLevel)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidation&quot;
  ((Maybe (ApiT ValidationLevel)
    -&gt; Const
         (Maybe (ApiT ValidationLevel)) (Maybe (ApiT ValidationLevel)))
   -&gt; ApiSharedWalletPostDataFromAccountPubX
   -&gt; Const
        (Maybe (ApiT ValidationLevel))
        ApiSharedWalletPostDataFromAccountPubX)
(Maybe (ApiT ValidationLevel)
 -&gt; Const
      (Maybe (ApiT ValidationLevel)) (Maybe (ApiT ValidationLevel)))
-&gt; ApiSharedWalletPostDataFromAccountPubX
-&gt; Const
     (Maybe (ApiT ValidationLevel))
     ApiSharedWalletPostDataFromAccountPubX
</span><a href="#local-6989586621682482419"><span class="hs-var">#scriptValidation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#scriptTemplateFromSelf"><span class="hs-identifier hs-type">scriptTemplateFromSelf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiScriptTemplateEntry"><span class="hs-identifier hs-type">ApiScriptTemplateEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">ScriptTemplate</span></a></span><span>
</span><span id="line-1114"></span><span id="scriptTemplateFromSelf"><span class="annot"><span class="annottext">scriptTemplateFromSelf :: XPub -&gt; ApiScriptTemplateEntry -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Api.Server.html#scriptTemplateFromSelf"><span class="hs-identifier hs-var hs-var">scriptTemplateFromSelf</span></a></span></span><span> </span><span id="local-6989586621682482418"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482418"><span class="hs-identifier hs-var">xpub</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiScriptTemplateEntry"><span class="hs-identifier hs-type">ApiScriptTemplateEntry</span></a></span><span> </span><span id="local-6989586621682482416"><span class="annot"><span class="annottext">Map Cosigner XPubOrSelf
</span><a href="#local-6989586621682482416"><span class="hs-identifier hs-var">cosigners'</span></a></span></span><span> </span><span id="local-6989586621682482415"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682482415"><span class="hs-identifier hs-var">template'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1115"></span><span>    </span><span class="annot"><span class="annottext">Map Cosigner XPub -&gt; Script Cosigner -&gt; ScriptTemplate
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">ScriptTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Map Cosigner XPub
</span><a href="#local-6989586621682482413"><span class="hs-identifier hs-var">cosignersWithoutSelf</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682482415"><span class="hs-identifier hs-var">template'</span></a></span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1117"></span><span>    </span><span id="local-6989586621682482412"><span class="annot"><span class="annottext">unSelf :: XPubOrSelf -&gt; XPub
</span><a href="#local-6989586621682482412"><span class="hs-identifier hs-var hs-var">unSelf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#SomeAccountKey"><span class="hs-identifier hs-type">SomeAccountKey</span></a></span><span> </span><span id="local-6989586621682482410"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482410"><span class="hs-identifier hs-var">xpub'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482410"><span class="hs-identifier hs-var">xpub'</span></a></span><span>
</span><span id="line-1118"></span><span>    </span><span class="annot"><a href="#local-6989586621682482412"><span class="hs-identifier hs-var">unSelf</span></a></span><span> </span><span class="annot"><span class="annottext">XPubOrSelf
</span><a href="Cardano.Wallet.Api.Types.html#Self"><span class="hs-identifier hs-var">Self</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482418"><span class="hs-identifier hs-var">xpub</span></a></span><span>
</span><span id="line-1119"></span><span>    </span><span id="local-6989586621682482413"><span class="annot"><span class="annottext">cosignersWithoutSelf :: Map Cosigner XPub
</span><a href="#local-6989586621682482413"><span class="hs-identifier hs-var hs-var">cosignersWithoutSelf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(XPubOrSelf -&gt; XPub)
-&gt; Map Cosigner XPubOrSelf -&gt; Map Cosigner XPub
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="annot"><span class="annottext">XPubOrSelf -&gt; XPub
</span><a href="#local-6989586621682482412"><span class="hs-identifier hs-var">unSelf</span></a></span><span> </span><span class="annot"><span class="annottext">Map Cosigner XPubOrSelf
</span><a href="#local-6989586621682482416"><span class="hs-identifier hs-var">cosigners'</span></a></span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkSharedWallet"><span class="hs-identifier hs-type">mkSharedWallet</span></a></span><span>
</span><span id="line-1122"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484174"><span class="annot"><a href="#local-6989586621682484174"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484173"><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484172"><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484171"><span class="annot"><a href="#local-6989586621682484171"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1123"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484174"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1124"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484171"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1125"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484174"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SupportsDiscovery"><span class="hs-identifier hs-type">Shared.SupportsDiscovery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484171"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1127"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-type">MkApiWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484174"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span>
</span><span id="line-1129"></span><span id="mkSharedWallet"><span class="annot"><span class="annottext">mkSharedWallet :: MkApiWallet ctx s ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkSharedWallet"><span class="hs-identifier hs-var hs-var">mkSharedWallet</span></a></span></span><span> </span><span id="local-6989586621682482407"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482407"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482406"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482406"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682482405"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482405"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621682482404"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482404"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621682482403"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482403"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span id="local-6989586621682482402"><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482402"><span class="hs-identifier hs-var">progress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; Readiness (SharedAddressPools k)
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; Readiness (SharedAddressPools k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ready"><span class="hs-identifier hs-var hs-var">Shared.ready</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1130"></span><span>    </span><span class="annot"><span class="annottext">Readiness (SharedAddressPools k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#Pending"><span class="hs-identifier hs-var">Shared.Pending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiSharedWallet -&gt; Handler ApiSharedWallet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSharedWallet -&gt; Handler ApiSharedWallet)
-&gt; ApiSharedWallet -&gt; Handler ApiSharedWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-var">ApiSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; ApiSharedWallet)
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; ApiSharedWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPendingSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiPendingSharedWallet
 -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet)
-&gt; ApiPendingSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPendingSharedWallet :: ApiT WalletId
-&gt; ApiT WalletName
-&gt; ApiT DerivationIndex
-&gt; ApiT AddressPoolGap
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; ApiPendingSharedWallet
</span><a href="Cardano.Wallet.Api.Types.html#ApiPendingSharedWallet"><span class="hs-identifier hs-type">ApiPendingSharedWallet</span></a></span><span>
</span><span id="line-1131"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiPendingSharedWallet :: ApiT WalletId
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiPendingSharedWallet"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482406"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1132"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:name:ApiPendingSharedWallet :: ApiT WalletName
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aname%3AApiPendingSharedWallet"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName -&gt; ApiT WalletName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletName -&gt; ApiT WalletName) -&gt; WalletName -&gt; ApiT WalletName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482404"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
(WalletName -&gt; Const WalletName WalletName)
-&gt; WalletMetadata -&gt; Const WalletName WalletMetadata
</span><a href="#local-6989586621682482394"><span class="hs-var">#name</span></a></span><span>
</span><span id="line-1133"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:accountIndex:ApiPendingSharedWallet :: ApiT DerivationIndex
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AaccountIndex%3AApiPendingSharedWallet"><span class="hs-identifier hs-var">accountIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; DerivationIndex -&gt; ApiT DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DerivationIndex) -&gt; Word32 -&gt; DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482390"><span class="hs-identifier hs-var">accIx</span></a></span><span>
</span><span id="line-1134"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:addressPoolGap:ApiPendingSharedWallet :: ApiT AddressPoolGap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AaddressPoolGap%3AApiPendingSharedWallet"><span class="hs-identifier hs-var">addressPoolGap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap -&gt; ApiT AddressPoolGap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressPoolGap -&gt; ApiT AddressPoolGap)
-&gt; AddressPoolGap -&gt; ApiT AddressPoolGap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; AddressPoolGap
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#poolGap"><span class="hs-identifier hs-var hs-var">Shared.poolGap</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1135"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:paymentScriptTemplate:ApiPendingSharedWallet :: ScriptTemplate
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3ApaymentScriptTemplate%3AApiPendingSharedWallet"><span class="hs-identifier hs-var">paymentScriptTemplate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; ScriptTemplate
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#paymentTemplate"><span class="hs-identifier hs-var hs-var">Shared.paymentTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1136"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegationScriptTemplate:ApiPendingSharedWallet :: Maybe ScriptTemplate
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdelegationScriptTemplate%3AApiPendingSharedWallet"><span class="hs-identifier hs-var">delegationScriptTemplate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; Maybe ScriptTemplate
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; Maybe ScriptTemplate
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#delegationTemplate"><span class="hs-identifier hs-var hs-var">Shared.delegationTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1137"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1138"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#Active"><span class="hs-identifier hs-type">Shared.Active</span></a></span><span> </span><span class="annot"><span class="annottext">SharedAddressPools k
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1139"></span><span>        </span><span id="local-6989586621682482382"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482382"><span class="hs-identifier hs-var">reward</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler Coin)
-&gt; (ErrWalletNotResponding -&gt; Handler Coin)
-&gt; (WorkerCtx ctx -&gt; Handler Coin)
-&gt; Handler Coin
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482407"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482406"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler Coin
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler Coin
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler Coin) -&gt; Handler Coin)
-&gt; (WorkerCtx ctx -&gt; Handler Coin) -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482381"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482381"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1140"></span><span>            </span><span class="hs-comment">-- never fails - returns zero if balance not found</span><span>
</span><span id="line-1141"></span><span>            </span><span class="annot"><span class="annottext">IO Coin -&gt; Handler Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; Handler Coin) -&gt; IO Coin -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n k) k -&gt; WalletId -&gt; IO Coin
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx -&gt; WalletId -&gt; IO Coin
</span><a href="Cardano.Wallet.html#fetchRewardBalance"><span class="hs-identifier hs-var">W.fetchRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484172"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682482381"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482406"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482380"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482380"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; TimeInterpreter (ExceptT PastHorizonException IO))
-&gt; NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482407"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-1144"></span><span>        </span><span id="local-6989586621682482379"><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682482379"><span class="hs-identifier hs-var">apiDelegation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiWalletDelegation -&gt; Handler ApiWalletDelegation
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiWalletDelegation -&gt; Handler ApiWalletDelegation)
-&gt; IO ApiWalletDelegation -&gt; Handler ApiWalletDelegation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegation -&gt; TimeInterpreter IO -&gt; IO ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Server.html#toApiWalletDelegation"><span class="hs-identifier hs-var">toApiWalletDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482404"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
    -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
-&gt; WalletDelegation
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
   -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
(WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
-&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata
</span><a href="#local-6989586621682482378"><span class="hs-var">#delegation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var">unsafeExtendSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482380"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span>        </span><span id="local-6989586621682482377"><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682482377"><span class="hs-identifier hs-var">tip'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiBlockReference -&gt; Handler ApiBlockReference
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiBlockReference -&gt; Handler ApiBlockReference)
-&gt; IO ApiBlockReference -&gt; Handler ApiBlockReference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Wallet s -&gt; IO ApiBlockReference
forall (m :: * -&gt; *) s.
Monad m =&gt;
TimeInterpreter m -&gt; Wallet s -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#getWalletTip"><span class="hs-identifier hs-var">getWalletTip</span></a></span><span>
</span><span id="line-1148"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier hs-var">neverFails</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getWalletTip wallet tip should be behind node tip&quot;</span></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482380"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1149"></span><span>            </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482405"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1150"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482376"><span class="annot"><span class="annottext">available :: TokenBundle
</span><a href="#local-6989586621682482376"><span class="hs-identifier hs-var hs-var">available</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; TokenBundle
forall s. Set Tx -&gt; Wallet s -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Model.html#availableBalance"><span class="hs-identifier hs-var">availableBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482403"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482405"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1151"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482375"><span class="annot"><span class="annottext">total :: TokenBundle
</span><a href="#local-6989586621682482375"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Coin -&gt; Wallet s -&gt; TokenBundle
forall s.
(IsOurs s Address, IsOurs s RewardAccount) =&gt;
Set Tx -&gt; Coin -&gt; Wallet s -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Model.html#totalBalance"><span class="hs-identifier hs-var">totalBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482403"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482382"><span class="hs-identifier hs-var">reward</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482405"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1152"></span><span>        </span><span class="annot"><span class="annottext">ApiSharedWallet -&gt; Handler ApiSharedWallet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSharedWallet -&gt; Handler ApiSharedWallet)
-&gt; ApiSharedWallet -&gt; Handler ApiSharedWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-var">ApiSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; ApiSharedWallet)
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; ApiSharedWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiActiveSharedWallet
 -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet)
-&gt; ApiActiveSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet :: ApiT WalletId
-&gt; ApiT WalletName
-&gt; ApiT DerivationIndex
-&gt; ApiT AddressPoolGap
-&gt; Maybe ApiWalletPassphraseInfo
-&gt; ScriptTemplate
-&gt; Maybe ScriptTemplate
-&gt; ApiWalletDelegation
-&gt; ApiWalletBalance
-&gt; ApiWalletAssetsBalance
-&gt; ApiT SyncProgress
-&gt; ApiBlockReference
-&gt; ApiActiveSharedWallet
</span><a href="Cardano.Wallet.Api.Types.html#ApiActiveSharedWallet"><span class="hs-identifier hs-type">ApiActiveSharedWallet</span></a></span><span>
</span><span id="line-1153"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiActiveSharedWallet :: ApiT WalletId
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482406"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1154"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:name:ApiActiveSharedWallet :: ApiT WalletName
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aname%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName -&gt; ApiT WalletName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletName -&gt; ApiT WalletName) -&gt; WalletName -&gt; ApiT WalletName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482404"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
(WalletName -&gt; Const WalletName WalletName)
-&gt; WalletMetadata -&gt; Const WalletName WalletMetadata
</span><a href="#local-6989586621682482371"><span class="hs-var">#name</span></a></span><span>
</span><span id="line-1155"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:accountIndex:ApiActiveSharedWallet :: ApiT DerivationIndex
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AaccountIndex%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">accountIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; DerivationIndex -&gt; ApiT DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DerivationIndex) -&gt; Word32 -&gt; DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482390"><span class="hs-identifier hs-var">accIx</span></a></span><span>
</span><span id="line-1156"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:addressPoolGap:ApiActiveSharedWallet :: ApiT AddressPoolGap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AaddressPoolGap%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">addressPoolGap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressPoolGap -&gt; ApiT AddressPoolGap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressPoolGap -&gt; ApiT AddressPoolGap)
-&gt; AddressPoolGap -&gt; ApiT AddressPoolGap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; AddressPoolGap
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; AddressPoolGap
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#poolGap"><span class="hs-identifier hs-var hs-var">Shared.poolGap</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1157"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:passphrase:ApiActiveSharedWallet :: Maybe ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Apassphrase%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">passphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphraseInfo"><span class="hs-identifier hs-var">ApiWalletPassphraseInfo</span></a></span><span>
</span><span id="line-1158"></span><span>                </span><span class="annot"><span class="annottext">(UTCTime -&gt; ApiWalletPassphraseInfo)
-&gt; Maybe UTCTime -&gt; Maybe ApiWalletPassphraseInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletPassphraseInfo -&gt; UTCTime)
-&gt; Maybe WalletPassphraseInfo -&gt; Maybe UTCTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((UTCTime -&gt; Const UTCTime UTCTime)
 -&gt; WalletPassphraseInfo -&gt; Const UTCTime WalletPassphraseInfo)
-&gt; WalletPassphraseInfo -&gt; UTCTime
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;lastUpdatedAt&quot;
  ((UTCTime -&gt; Const UTCTime UTCTime)
   -&gt; WalletPassphraseInfo -&gt; Const UTCTime WalletPassphraseInfo)
(UTCTime -&gt; Const UTCTime UTCTime)
-&gt; WalletPassphraseInfo -&gt; Const UTCTime WalletPassphraseInfo
</span><a href="#local-6989586621682482367"><span class="hs-var">#lastUpdatedAt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482404"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((Maybe WalletPassphraseInfo
     -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
    -&gt; WalletMetadata
    -&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata)
-&gt; Maybe WalletPassphraseInfo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphraseInfo&quot;
  ((Maybe WalletPassphraseInfo
    -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
   -&gt; WalletMetadata
   -&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata)
(Maybe WalletPassphraseInfo
 -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
-&gt; WalletMetadata
-&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata
</span><a href="#local-6989586621682482366"><span class="hs-var">#passphraseInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:paymentScriptTemplate:ApiActiveSharedWallet :: ScriptTemplate
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3ApaymentScriptTemplate%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">paymentScriptTemplate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; ScriptTemplate
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; ScriptTemplate
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#paymentTemplate"><span class="hs-identifier hs-var hs-var">Shared.paymentTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1160"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegationScriptTemplate:ApiActiveSharedWallet :: Maybe ScriptTemplate
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdelegationScriptTemplate%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">delegationScriptTemplate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; Maybe ScriptTemplate
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; Maybe ScriptTemplate
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#delegationTemplate"><span class="hs-identifier hs-var hs-var">Shared.delegationTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1161"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegation:ApiActiveSharedWallet :: ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adelegation%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">delegation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682482379"><span class="hs-identifier hs-var">apiDelegation</span></a></span><span>
</span><span id="line-1162"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:balance:ApiActiveSharedWallet :: ApiWalletBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Abalance%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiWalletBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletBalance"><span class="hs-identifier hs-type">ApiWalletBalance</span></a></span><span>
</span><span id="line-1163"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:available:ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aavailable%3AApiWalletBalance"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482376"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682482361"><span class="hs-var">#coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:total:ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atotal%3AApiWalletBalance"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482375"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682482360"><span class="hs-var">#coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reward:ApiWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Areward%3AApiWalletBalance"><span class="hs-identifier hs-var">reward</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482382"><span class="hs-identifier hs-var">reward</span></a></span><span>
</span><span id="line-1166"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1167"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiActiveSharedWallet :: ApiWalletAssetsBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletAssetsBalance :: ApiT TokenMap -&gt; ApiT TokenMap -&gt; ApiWalletAssetsBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletAssetsBalance"><span class="hs-identifier hs-type">ApiWalletAssetsBalance</span></a></span><span>
</span><span id="line-1168"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:available:ApiWalletAssetsBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aavailable%3AApiWalletAssetsBalance"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482376"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482358"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:total:ApiWalletAssetsBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atotal%3AApiWalletAssetsBalance"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482375"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482357"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1171"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:state:ApiActiveSharedWallet :: ApiT SyncProgress
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Astate%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyncProgress -&gt; ApiT SyncProgress
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482402"><span class="hs-identifier hs-var">progress</span></a></span><span>
</span><span id="line-1172"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:tip:ApiActiveSharedWallet :: ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atip%3AApiActiveSharedWallet"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682482377"><span class="hs-identifier hs-var">tip'</span></a></span><span>
</span><span id="line-1173"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1175"></span><span>    </span><span id="local-6989586621682482400"><span class="annot"><span class="annottext">st :: s
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482405"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1176"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationPrefix"><span class="hs-identifier hs-type">DerivationPrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Index 'Hardened 'CoinTypeK
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682482390"><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682482390"><span class="hs-identifier hs-var">accIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SharedState n k -&gt; DerivationPrefix
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; DerivationPrefix
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#derivationPrefix"><span class="hs-identifier hs-var hs-var">Shared.derivationPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">s
SharedState n k
</span><a href="#local-6989586621682482400"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#patchSharedWallet"><span class="hs-identifier hs-type">patchSharedWallet</span></a></span><span>
</span><span id="line-1179"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482352"><span class="annot"><a href="#local-6989586621682482352"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482351"><span class="annot"><a href="#local-6989586621682482351"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482350"><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482349"><span class="annot"><a href="#local-6989586621682482349"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1180"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482351"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482349"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1181"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482352"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482351"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1182"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1183"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482349"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1185"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1186"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482351"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482352"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482349"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1188"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-1189"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482352"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1191"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#CredentialType"><span class="hs-identifier hs-type">CredentialType</span></a></span><span>
</span><span id="line-1193"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1194"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWalletPatchData"><span class="hs-identifier hs-type">ApiSharedWalletPatchData</span></a></span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSharedWallet"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span>
</span><span id="line-1196"></span><span id="patchSharedWallet"><span class="annot"><span class="annottext">patchSharedWallet :: ctx
-&gt; (XPub -&gt; k 'AccountK XPub)
-&gt; CredentialType
-&gt; ApiT WalletId
-&gt; ApiSharedWalletPatchData
-&gt; Handler ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#patchSharedWallet"><span class="hs-identifier hs-var hs-var">patchSharedWallet</span></a></span></span><span> </span><span id="local-6989586621682482348"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482348"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482347"><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482347"><span class="hs-identifier hs-var">liftKey</span></a></span></span><span> </span><span id="local-6989586621682482346"><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682482346"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482345"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482345"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682482344"><span class="annot"><span class="annottext">ApiSharedWalletPatchData
</span><a href="#local-6989586621682482344"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1197"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482348"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482345"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482343"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482343"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1198"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrAddCosignerKey IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrAddCosignerKey IO () -&gt; Handler ())
-&gt; ExceptT ErrAddCosignerKey IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; WalletId
-&gt; k 'AccountK XPub
-&gt; Cosigner
-&gt; CredentialType
-&gt; ExceptT ErrAddCosignerKey IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(s ~ SharedState n k, MkKeyFingerprint k Address, SoftDerivation k,
 Typeable n, WalletKey k, HasDBLayer IO s k ctx, k ~ SharedKey) =&gt;
ctx
-&gt; WalletId
-&gt; k 'AccountK XPub
-&gt; Cosigner
-&gt; CredentialType
-&gt; ExceptT ErrAddCosignerKey IO ()
</span><a href="Cardano.Wallet.html#updateCosigner"><span class="hs-identifier hs-var">W.updateCosigner</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682482343"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482345"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; k 'AccountK XPub
</span><a href="#local-6989586621682482347"><span class="hs-identifier hs-var">liftKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682482341"><span class="hs-identifier hs-var">accXPub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cosigner
</span><a href="#local-6989586621682482340"><span class="hs-identifier hs-var">cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682482346"><span class="hs-identifier hs-var">cred</span></a></span><span>
</span><span id="line-1199"></span><span>    </span><span class="annot"><span class="annottext">(ApiSharedWallet, UTCTime) -&gt; ApiSharedWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiSharedWallet, UTCTime) -&gt; ApiSharedWallet)
-&gt; Handler (ApiSharedWallet, UTCTime) -&gt; Handler ApiSharedWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s ApiSharedWallet
-&gt; ApiT WalletId
-&gt; Handler (ApiSharedWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482348"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SharedState n k,
 HasWorkerRegistry s k ctx, SupportsDiscovery n k) =&gt;
MkApiWallet ctx s ApiSharedWallet
forall (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, s ~ SharedState n k,
 HasWorkerRegistry s k ctx, SupportsDiscovery n k) =&gt;
MkApiWallet ctx s ApiSharedWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkSharedWallet"><span class="hs-identifier hs-var">mkSharedWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482351"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482350"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482345"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1201"></span><span>      </span><span id="local-6989586621682482340"><span class="annot"><span class="annottext">cosigner :: Cosigner
</span><a href="#local-6989586621682482340"><span class="hs-identifier hs-var hs-var">cosigner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT Cosigner -&gt; Cosigner
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPatchData
</span><a href="#local-6989586621682482344"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPatchData
-&gt; ((ApiT Cosigner -&gt; Const (ApiT Cosigner) (ApiT Cosigner))
    -&gt; ApiSharedWalletPatchData
    -&gt; Const (ApiT Cosigner) ApiSharedWalletPatchData)
-&gt; ApiT Cosigner
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;cosigner&quot;
  ((ApiT Cosigner -&gt; Const (ApiT Cosigner) (ApiT Cosigner))
   -&gt; ApiSharedWalletPatchData
   -&gt; Const (ApiT Cosigner) ApiSharedWalletPatchData)
(ApiT Cosigner -&gt; Const (ApiT Cosigner) (ApiT Cosigner))
-&gt; ApiSharedWalletPatchData
-&gt; Const (ApiT Cosigner) ApiSharedWalletPatchData
</span><a href="#local-6989586621682482339"><span class="hs-var">#cosigner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1202"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAccountPublicKey"><span class="hs-identifier hs-type">ApiAccountPublicKey</span></a></span><span> </span><span id="local-6989586621682482338"><span class="annot"><span class="annottext">ApiT XPub
</span><a href="#local-6989586621682482338"><span class="hs-identifier hs-var">accXPubApiT</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSharedWalletPatchData
</span><a href="#local-6989586621682482344"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWalletPatchData
-&gt; ((ApiAccountPublicKey
     -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
    -&gt; ApiSharedWalletPatchData
    -&gt; Const ApiAccountPublicKey ApiSharedWalletPatchData)
-&gt; ApiAccountPublicKey
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;accountPublicKey&quot;
  ((ApiAccountPublicKey
    -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
   -&gt; ApiSharedWalletPatchData
   -&gt; Const ApiAccountPublicKey ApiSharedWalletPatchData)
(ApiAccountPublicKey
 -&gt; Const ApiAccountPublicKey ApiAccountPublicKey)
-&gt; ApiSharedWalletPatchData
-&gt; Const ApiAccountPublicKey ApiSharedWalletPatchData
</span><a href="#local-6989586621682482337"><span class="hs-var">#accountPublicKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>      </span><span id="local-6989586621682482341"><span class="annot"><span class="annottext">accXPub :: XPub
</span><a href="#local-6989586621682482341"><span class="hs-identifier hs-var hs-var">accXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT XPub -&gt; XPub
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT XPub
</span><a href="#local-6989586621682482338"><span class="hs-identifier hs-var">accXPubApiT</span></a></span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span class="hs-comment">--------------------- Legacy</span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postLegacyWallet"><span class="hs-identifier hs-type">postLegacyWallet</span></a></span><span>
</span><span id="line-1208"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484077"><span class="annot"><a href="#local-6989586621682484077"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484076"><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484075"><span class="annot"><a href="#local-6989586621682484075"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1209"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484077"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484075"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1210"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KnownDiscovery"><span class="hs-identifier hs-type">KnownDiscovery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1211"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-1212"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1213"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1214"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484077"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1215"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484075"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1216"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1217"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484077"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1219"></span><span>        </span><span class="hs-comment">-- ^ Surrounding Context</span><span>
</span><span id="line-1220"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682484075"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>        </span><span class="hs-comment">-- ^ Root key</span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484077"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1223"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1224"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1225"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>        </span><span class="hs-comment">-- ^ How to create this legacy wallet</span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1228"></span><span id="postLegacyWallet"><span class="annot"><span class="annottext">postLegacyWallet :: ctx
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postLegacyWallet"><span class="hs-identifier hs-var hs-var">postLegacyWallet</span></a></span></span><span> </span><span id="local-6989586621682482335"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482335"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682482334"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482334"><span class="hs-identifier hs-var">rootXPrv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482333"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482333"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682482332"><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="#local-6989586621682482332"><span class="hs-identifier hs-var">createWallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1229"></span><span>    </span><span class="annot"><span class="annottext">Handler WalletId -&gt; Handler ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler WalletId -&gt; Handler ()) -&gt; Handler WalletId -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var">createWalletWorker</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484076"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484075"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482335"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482331"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="#local-6989586621682482332"><span class="hs-operator hs-var">`createWallet`</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482331"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
forall ctx wid a. ctx -&gt; wid -&gt; IO a
</span><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier hs-var">idleWorker</span></a></span><span>
</span><span id="line-1231"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482335"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482331"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482330"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482330"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1232"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwd"><span class="hs-identifier hs-var">W.attachPrivateKeyFromPwd</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482330"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482331"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482334"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482333"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1233"></span><span>    </span><span class="annot"><span class="annottext">(ApiByronWallet, UTCTime) -&gt; ApiByronWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiByronWallet, UTCTime) -&gt; ApiByronWallet)
-&gt; Handler (ApiByronWallet, UTCTime) -&gt; Handler ApiByronWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s ApiByronWallet
-&gt; ApiT WalletId
-&gt; Handler (ApiByronWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482335"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx s ApiByronWallet
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, KnownDiscovery s,
 HasNetworkLayer IO ctx, IsOurs s Address,
 IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; Set Tx
-&gt; SyncProgress
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkLegacyWallet"><span class="hs-identifier hs-var">mkLegacyWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482331"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1234"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1235"></span><span>    </span><span id="local-6989586621682482331"><span class="annot"><span class="annottext">wid :: WalletId
</span><a href="#local-6989586621682482331"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; WalletId
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-var">WalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; WalletId) -&gt; Digest Blake2b_160 -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPub -&gt; Digest Blake2b_160
forall (key :: Depth -&gt; * -&gt; *) a (depth :: Depth).
(WalletKey key, HashAlgorithm a) =&gt;
key depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var">digest</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'RootK XPub -&gt; Digest Blake2b_160)
-&gt; k 'RootK XPub -&gt; Digest Blake2b_160
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv -&gt; k 'RootK XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
key depth XPrv -&gt; key depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482334"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkLegacyWallet"><span class="hs-identifier hs-type">mkLegacyWallet</span></a></span><span>
</span><span id="line-1238"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484114"><span class="annot"><a href="#local-6989586621682484114"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484116"><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484115"><span class="annot"><a href="#local-6989586621682484115"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1239"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484115"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484114"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1240"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484115"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484114"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1241"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KnownDiscovery"><span class="hs-identifier hs-type">KnownDiscovery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1242"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484114"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1243"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1244"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-1245"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484114"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1247"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1248"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1249"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-1250"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.SyncProgress.html#SyncProgress"><span class="hs-identifier hs-type">SyncProgress</span></a></span><span>
</span><span id="line-1252"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1253"></span><span id="mkLegacyWallet"><span class="annot"><span class="annottext">mkLegacyWallet :: ctx
-&gt; WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; Set Tx
-&gt; SyncProgress
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkLegacyWallet"><span class="hs-identifier hs-var hs-var">mkLegacyWallet</span></a></span></span><span> </span><span id="local-6989586621682482329"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482329"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482328"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482328"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682482327"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482327"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621682482326"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482326"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span id="local-6989586621682482325"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482325"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span id="local-6989586621682482324"><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482324"><span class="hs-identifier hs-var">progress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1254"></span><span>    </span><span class="hs-comment">-- NOTE</span><span>
</span><span id="line-1255"></span><span>    </span><span class="hs-comment">-- Legacy wallets imported through via XPrv might have an empty passphrase</span><span>
</span><span id="line-1256"></span><span>    </span><span class="hs-comment">-- set. The passphrase is empty from a client perspective, but in practice</span><span>
</span><span id="line-1257"></span><span>    </span><span class="hs-comment">-- it still exists (it is a CBOR-serialized empty bytestring!).</span><span>
</span><span id="line-1258"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1259"></span><span>    </span><span class="hs-comment">-- Therefore, if we detect an empty passphrase, we choose to return the</span><span>
</span><span id="line-1260"></span><span>    </span><span class="hs-comment">-- metadata as if no passphrase was set, so that clients can react</span><span>
</span><span id="line-1261"></span><span>    </span><span class="hs-comment">-- appropriately.</span><span>
</span><span id="line-1262"></span><span>    </span><span id="local-6989586621682482323"><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
</span><a href="#local-6989586621682482323"><span class="hs-identifier hs-var">pwdInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482326"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((Maybe WalletPassphraseInfo
     -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
    -&gt; WalletMetadata
    -&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata)
-&gt; Maybe WalletPassphraseInfo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphraseInfo&quot;
  ((Maybe WalletPassphraseInfo
    -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
   -&gt; WalletMetadata
   -&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata)
(Maybe WalletPassphraseInfo
 -&gt; Const (Maybe WalletPassphraseInfo) (Maybe WalletPassphraseInfo))
-&gt; WalletMetadata
-&gt; Const (Maybe WalletPassphraseInfo) WalletMetadata
</span><a href="#local-6989586621682482322"><span class="hs-var">#passphraseInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1263"></span><span>        </span><span class="annot"><span class="annottext">Maybe WalletPassphraseInfo
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1264"></span><span>            </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1265"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#WalletPassphraseInfo"><span class="hs-identifier hs-type">WalletPassphraseInfo</span></a></span><span> </span><span id="local-6989586621682482320"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682482320"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#EncryptWithPBKDF2"><span class="hs-identifier hs-var">EncryptWithPBKDF2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1266"></span><span>            </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ApiWalletPassphraseInfo
 -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; Maybe ApiWalletPassphraseInfo
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletPassphraseInfo -&gt; Maybe ApiWalletPassphraseInfo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletPassphraseInfo -&gt; Maybe ApiWalletPassphraseInfo)
-&gt; ApiWalletPassphraseInfo -&gt; Maybe ApiWalletPassphraseInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphraseInfo"><span class="hs-identifier hs-var">ApiWalletPassphraseInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682482320"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-1267"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#WalletPassphraseInfo"><span class="hs-identifier hs-type">WalletPassphraseInfo</span></a></span><span> </span><span id="local-6989586621682482318"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682482318"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#EncryptWithScrypt"><span class="hs-identifier hs-var">EncryptWithScrypt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1268"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; (WorkerCtx ctx -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484115"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482329"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482328"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (Maybe ApiWalletPassphraseInfo))
 -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; (WorkerCtx ctx -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1269"></span><span>                </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; Handler (Either ErrWithRootKey ())
</span><a href="#local-6989586621682482316"><span class="hs-identifier hs-var">matchEmptyPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkerCtx ctx -&gt; Handler (Either ErrWithRootKey ()))
-&gt; (Either ErrWithRootKey ()
    -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; WorkerCtx ctx
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1270"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1271"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ApiWalletPassphraseInfo
 -&gt; Handler (Maybe ApiWalletPassphraseInfo))
-&gt; Maybe ApiWalletPassphraseInfo
-&gt; Handler (Maybe ApiWalletPassphraseInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletPassphraseInfo -&gt; Maybe ApiWalletPassphraseInfo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletPassphraseInfo -&gt; Maybe ApiWalletPassphraseInfo)
-&gt; ApiWalletPassphraseInfo -&gt; Maybe ApiWalletPassphraseInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphraseInfo"><span class="hs-identifier hs-var">ApiWalletPassphraseInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682482318"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span>    </span><span id="local-6989586621682482315"><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682482315"><span class="hs-identifier hs-var">tip'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiBlockReference -&gt; Handler ApiBlockReference
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiBlockReference -&gt; Handler ApiBlockReference)
-&gt; IO ApiBlockReference -&gt; Handler ApiBlockReference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Wallet s -&gt; IO ApiBlockReference
forall (m :: * -&gt; *) s.
Monad m =&gt;
TimeInterpreter m -&gt; Wallet s -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#getWalletTip"><span class="hs-identifier hs-var">getWalletTip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#expectAndThrowFailures"><span class="hs-identifier hs-var">expectAndThrowFailures</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482314"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482327"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1274"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482313"><span class="annot"><span class="annottext">available :: TokenBundle
</span><a href="#local-6989586621682482313"><span class="hs-identifier hs-var hs-var">available</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; TokenBundle
forall s. Set Tx -&gt; Wallet s -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Model.html#availableBalance"><span class="hs-identifier hs-var">availableBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482325"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482327"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482312"><span class="annot"><span class="annottext">total :: TokenBundle
</span><a href="#local-6989586621682482312"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Coin -&gt; Wallet s -&gt; TokenBundle
forall s.
(IsOurs s Address, IsOurs s RewardAccount) =&gt;
Set Tx -&gt; Coin -&gt; Wallet s -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Model.html#totalBalance"><span class="hs-identifier hs-var">totalBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482325"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482327"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1276"></span><span>    </span><span class="annot"><span class="annottext">ApiByronWallet -&gt; Handler ApiByronWallet
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ApiByronWallet :: ApiT WalletId
-&gt; ApiByronWalletBalance
-&gt; ApiWalletAssetsBalance
-&gt; ApiWalletDiscovery
-&gt; ApiT WalletName
-&gt; Maybe ApiWalletPassphraseInfo
-&gt; ApiT SyncProgress
-&gt; ApiBlockReference
-&gt; ApiByronWallet
</span><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1277"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:balance:ApiByronWallet :: ApiByronWalletBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Abalance%3AApiByronWallet"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiByronWalletBalance :: Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; ApiByronWalletBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiByronWalletBalance"><span class="hs-identifier hs-type">ApiByronWalletBalance</span></a></span><span>
</span><span id="line-1278"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:available:ApiByronWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aavailable%3AApiByronWalletBalance"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482313"><span class="hs-identifier hs-var">available</span></a></span><span>
</span><span id="line-1279"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:total:ApiByronWalletBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atotal%3AApiByronWalletBalance"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482312"><span class="hs-identifier hs-var">total</span></a></span><span>
</span><span id="line-1280"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1281"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiByronWallet :: ApiWalletAssetsBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiByronWallet"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletAssetsBalance :: ApiT TokenMap -&gt; ApiT TokenMap -&gt; ApiWalletAssetsBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletAssetsBalance"><span class="hs-identifier hs-type">ApiWalletAssetsBalance</span></a></span><span>
</span><span id="line-1282"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:available:ApiWalletAssetsBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aavailable%3AApiWalletAssetsBalance"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482313"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482303"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:total:ApiWalletAssetsBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atotal%3AApiWalletAssetsBalance"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482312"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482302"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1284"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1285"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiByronWallet :: ApiT WalletId
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiByronWallet"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482328"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1286"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:name:ApiByronWallet :: ApiT WalletName
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aname%3AApiByronWallet"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName -&gt; ApiT WalletName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletName -&gt; ApiT WalletName) -&gt; WalletName -&gt; ApiT WalletName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482326"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; WalletMetadata -&gt; Const WalletName WalletMetadata)
(WalletName -&gt; Const WalletName WalletName)
-&gt; WalletMetadata -&gt; Const WalletName WalletMetadata
</span><a href="#local-6989586621682482299"><span class="hs-var">#name</span></a></span><span>
</span><span id="line-1287"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:passphrase:ApiByronWallet :: Maybe ApiWalletPassphraseInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Apassphrase%3AApiByronWallet"><span class="hs-identifier hs-var">passphrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiWalletPassphraseInfo
</span><a href="#local-6989586621682482323"><span class="hs-identifier hs-var">pwdInfo</span></a></span><span>
</span><span id="line-1288"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:state:ApiByronWallet :: ApiT SyncProgress
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Astate%3AApiByronWallet"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyncProgress -&gt; ApiT SyncProgress
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482324"><span class="hs-identifier hs-var">progress</span></a></span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:tip:ApiByronWallet :: ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atip%3AApiByronWallet"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682482315"><span class="hs-identifier hs-var">tip'</span></a></span><span>
</span><span id="line-1290"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:discovery:ApiByronWallet :: ApiWalletDiscovery
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adiscovery%3AApiByronWallet"><span class="hs-identifier hs-var">discovery</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownDiscovery s =&gt; ApiWalletDiscovery
forall k (s :: k). KnownDiscovery s =&gt; ApiWalletDiscovery
</span><a href="Cardano.Wallet.Api.Types.html#knownDiscovery"><span class="hs-identifier hs-var">knownDiscovery</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1291"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1293"></span><span>    </span><span class="annot"><a href="#local-6989586621682482314"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1294"></span><span>    </span><span id="local-6989586621682482314"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682482314"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; TimeInterpreter (ExceptT PastHorizonException IO))
-&gt; NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482329"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-1295"></span><span>
</span><span id="line-1296"></span><span>    </span><span class="annot"><a href="#local-6989586621682482316"><span class="hs-identifier hs-type">matchEmptyPassphrase</span></a></span><span>
</span><span id="line-1297"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484114"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1298"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>    </span><span id="local-6989586621682482316"><span class="annot"><span class="annottext">matchEmptyPassphrase :: WorkerCtx ctx -&gt; Handler (Either ErrWithRootKey ())
</span><a href="#local-6989586621682482316"><span class="hs-identifier hs-var hs-var">matchEmptyPassphrase</span></a></span></span><span> </span><span id="local-6989586621682482293"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482293"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either ErrWithRootKey ()) -&gt; Handler (Either ErrWithRootKey ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrWithRootKey ())
 -&gt; Handler (Either ErrWithRootKey ()))
-&gt; IO (Either ErrWithRootKey ())
-&gt; Handler (Either ErrWithRootKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrWithRootKey IO () -&gt; IO (Either ErrWithRootKey ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWithRootKey IO () -&gt; IO (Either ErrWithRootKey ()))
-&gt; ExceptT ErrWithRootKey IO () -&gt; IO (Either ErrWithRootKey ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1300"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrWithRootKey)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme -&gt; ExceptT ErrWithRootKey IO ())
-&gt; ExceptT ErrWithRootKey IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">W.withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484116"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484115"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482293"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482328"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrWithRootKey
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT ErrWithRootKey IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>
</span><span id="line-1302"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postRandomWallet"><span class="hs-identifier hs-type">postRandomWallet</span></a></span><span>
</span><span id="line-1303"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482290"><span class="annot"><a href="#local-6989586621682482290"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482289"><span class="annot"><a href="#local-6989586621682482289"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482288"><span class="annot"><a href="#local-6989586621682482288"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482287"><span class="annot"><a href="#local-6989586621682482287"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1304"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482290"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482289"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482288"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1305"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482289"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482287"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1306"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482288"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1307"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482290"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1309"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPostData"><span class="hs-identifier hs-type">ByronWalletPostData</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">15</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">18</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">21</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">24</span></span><span class="hs-special">]</span><span>
</span><span id="line-1310"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1311"></span><span id="postRandomWallet"><span class="annot"><span class="annottext">postRandomWallet :: ctx
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postRandomWallet"><span class="hs-identifier hs-var hs-var">postRandomWallet</span></a></span></span><span> </span><span id="local-6989586621682482286"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482286"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482285"><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482285"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1312"></span><span>    </span><span id="local-6989586621682482284"><span class="annot"><span class="annottext">RndState n
</span><a href="#local-6989586621682482284"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (RndState n) -&gt; Handler (RndState n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (RndState n) -&gt; Handler (RndState n))
-&gt; IO (RndState n) -&gt; Handler (RndState n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv -&gt; Int -&gt; RndState n
forall (n :: NetworkDiscriminant).
ByronKey 'RootK XPrv -&gt; Int -&gt; RndState n
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#mkRndState"><span class="hs-identifier hs-var">mkRndState</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482283"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; RndState n) -&gt; IO Int -&gt; IO (RndState n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Int, StdGen)) -&gt; IO Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; (StdGen -&gt; (a, StdGen)) -&gt; m a
</span><a href="../../../../random/html/src"><span class="hs-identifier hs-var">getStdRandom</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (Int, StdGen)
forall a g. (Random a, RandomGen g) =&gt; g -&gt; (a, g)
</span><a href="../../../../random/html/src"><span class="hs-identifier hs-var">random</span></a></span><span>
</span><span id="line-1313"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; (ByronKey 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, KnownDiscovery s, IsOurs s RewardAccount,
 IsOurs s Address, MaybeLight s, HasNetworkLayer IO ctx,
 WalletKey k, AddressBookIso s) =&gt;
ctx
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postLegacyWallet"><span class="hs-identifier hs-var">postLegacyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482286"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482283"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482282"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
 -&gt; Handler ApiByronWallet)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482281"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482281"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span id="local-6989586621682482280"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482280"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1314"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
(MonadUnliftIO m, MonadTime m, HasGenesisData ctx,
 HasDBLayer m s k ctx, IsOurs s Address, IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var">W.createWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482290"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482289"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482288"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482281"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482280"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482279"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="annot"><span class="annottext">s
RndState n
</span><a href="#local-6989586621682482284"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1315"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1316"></span><span>    </span><span id="local-6989586621682482279"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482279"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482285"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482278"><span class="hs-var">#name</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; (WalletName -&gt; Const WalletName WalletName)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
(WalletName -&gt; Const WalletName WalletName)
-&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName)
</span><a href="#local-6989586621682482277"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1317"></span><span>    </span><span id="local-6989586621682482276"><span class="annot"><span class="annottext">seed :: SomeMnemonic
</span><a href="#local-6989586621682482276"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482285"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; SomeMnemonic
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSentence&quot;
  ((ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiMnemonicT '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482275"><span class="hs-var">#mnemonicSentence</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiMnemonicT '[12, 15, 18, 21, 24]
  -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; (SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiMnemonicT&quot;
  ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
   -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
(SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482274"><span class="hs-var">#getApiMnemonicT</span></a></span><span>
</span><span id="line-1318"></span><span>    </span><span id="local-6989586621682482282"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482282"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482285"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const
         (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; Passphrase &quot;user&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const
        (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482273"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;user&quot;)
  -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const
      (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; (Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
   -&gt; ApiT (Passphrase &quot;user&quot;)
   -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
(Passphrase &quot;user&quot;
 -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ApiT (Passphrase &quot;user&quot;)
-&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;))
</span><a href="#local-6989586621682482272"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1319"></span><span>    </span><span id="local-6989586621682482271"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482271"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482282"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-1320"></span><span>    </span><span id="local-6989586621682482283"><span class="annot"><span class="annottext">rootXPrv :: ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482283"><span class="hs-identifier hs-var hs-var">rootXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; ByronKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#generateKeyFromSeed"><span class="hs-identifier hs-var">Byron.generateKeyFromSeed</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482276"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482271"><span class="hs-identifier hs-var">pwdP</span></a></span><span>
</span><span id="line-1321"></span><span>
</span><span id="line-1322"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postRandomWalletFromXPrv"><span class="hs-identifier hs-type">postRandomWalletFromXPrv</span></a></span><span>
</span><span id="line-1323"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482269"><span class="annot"><a href="#local-6989586621682482269"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482268"><span class="annot"><a href="#local-6989586621682482268"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482267"><span class="annot"><a href="#local-6989586621682482267"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482266"><span class="annot"><a href="#local-6989586621682482266"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1324"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482269"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482267"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482266"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1326"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482267"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1327"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482269"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1328"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1329"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482269"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1330"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletFromXPrvPostData"><span class="hs-identifier hs-type">ByronWalletFromXPrvPostData</span></a></span><span>
</span><span id="line-1331"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1332"></span><span id="postRandomWalletFromXPrv"><span class="annot"><span class="annottext">postRandomWalletFromXPrv :: ctx -&gt; ByronWalletFromXPrvPostData -&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postRandomWalletFromXPrv"><span class="hs-identifier hs-var hs-var">postRandomWalletFromXPrv</span></a></span></span><span> </span><span id="local-6989586621682482265"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482265"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482264"><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482264"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1333"></span><span>    </span><span id="local-6989586621682482263"><span class="annot"><span class="annottext">RndState n
</span><a href="#local-6989586621682482263"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (RndState n) -&gt; Handler (RndState n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (RndState n) -&gt; Handler (RndState n))
-&gt; IO (RndState n) -&gt; Handler (RndState n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv -&gt; Int -&gt; RndState n
forall (n :: NetworkDiscriminant).
ByronKey 'RootK XPrv -&gt; Int -&gt; RndState n
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#mkRndState"><span class="hs-identifier hs-var">mkRndState</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482262"><span class="hs-identifier hs-var">byronKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; RndState n) -&gt; IO Int -&gt; IO (RndState n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Int, StdGen)) -&gt; IO Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; (StdGen -&gt; (a, StdGen)) -&gt; m a
</span><a href="../../../../random/html/src"><span class="hs-identifier hs-var">getStdRandom</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (Int, StdGen)
forall a g. (Random a, RandomGen g) =&gt; g -&gt; (a, g)
</span><a href="../../../../random/html/src"><span class="hs-identifier hs-var">random</span></a></span><span>
</span><span id="line-1334"></span><span>    </span><span class="annot"><span class="annottext">Handler WalletId -&gt; Handler ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler WalletId -&gt; Handler ()) -&gt; Handler WalletId -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId -&gt; Handler WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var">createWalletWorker</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482267"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482265"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482261"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1335"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682482260"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482260"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
(MonadUnliftIO m, MonadTime m, HasGenesisData ctx,
 HasDBLayer m s k ctx, IsOurs s Address, IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; s
-&gt; ExceptT ErrWalletAlreadyExists m WalletId
</span><a href="Cardano.Wallet.html#createWallet"><span class="hs-identifier hs-var">W.createWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482269"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482268"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482267"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482260"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482261"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482259"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="annot"><span class="annottext">s
RndState n
</span><a href="#local-6989586621682482263"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1336"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
forall ctx wid a. ctx -&gt; wid -&gt; IO a
</span><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier hs-var">idleWorker</span></a></span><span>
</span><span id="line-1337"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482265"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482261"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482258"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482258"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1338"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
-&gt; WalletId
-&gt; (ByronKey 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, PassphraseHash)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#attachPrivateKeyFromPwdHash"><span class="hs-identifier hs-var">W.attachPrivateKeyFromPwdHash</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
WorkerCtx ctx
</span><a href="#local-6989586621682482258"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482261"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482262"><span class="hs-identifier hs-var">byronKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682482256"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span>    </span><span class="annot"><span class="annottext">(ApiByronWallet, UTCTime) -&gt; ApiByronWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiByronWallet, UTCTime) -&gt; ApiByronWallet)
-&gt; Handler (ApiByronWallet, UTCTime) -&gt; Handler ApiByronWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx (RndState n) ApiByronWallet
-&gt; ApiT WalletId
-&gt; Handler (ApiByronWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482265"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx (RndState n) ApiByronWallet
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, KnownDiscovery s,
 HasNetworkLayer IO ctx, IsOurs s Address,
 IsOurs s RewardAccount) =&gt;
ctx
-&gt; WalletId
-&gt; Wallet s
-&gt; WalletMetadata
-&gt; Set Tx
-&gt; SyncProgress
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#mkLegacyWallet"><span class="hs-identifier hs-var">mkLegacyWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482261"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1341"></span><span>    </span><span id="local-6989586621682482259"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482259"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT WalletName -&gt; WalletName
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482264"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
-&gt; ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
    -&gt; ByronWalletFromXPrvPostData
    -&gt; Const (ApiT WalletName) ByronWalletFromXPrvPostData)
-&gt; ApiT WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
   -&gt; ByronWalletFromXPrvPostData
   -&gt; Const (ApiT WalletName) ByronWalletFromXPrvPostData)
(ApiT WalletName -&gt; Const (ApiT WalletName) (ApiT WalletName))
-&gt; ByronWalletFromXPrvPostData
-&gt; Const (ApiT WalletName) ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482255"><span class="hs-var">#name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1342"></span><span>    </span><span id="local-6989586621682482256"><span class="annot"><span class="annottext">pwd :: PassphraseHash
</span><a href="#local-6989586621682482256"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT PassphraseHash -&gt; PassphraseHash
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482264"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
-&gt; ((ApiT PassphraseHash
     -&gt; Const (ApiT PassphraseHash) (ApiT PassphraseHash))
    -&gt; ByronWalletFromXPrvPostData
    -&gt; Const (ApiT PassphraseHash) ByronWalletFromXPrvPostData)
-&gt; ApiT PassphraseHash
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphraseHash&quot;
  ((ApiT PassphraseHash
    -&gt; Const (ApiT PassphraseHash) (ApiT PassphraseHash))
   -&gt; ByronWalletFromXPrvPostData
   -&gt; Const (ApiT PassphraseHash) ByronWalletFromXPrvPostData)
(ApiT PassphraseHash
 -&gt; Const (ApiT PassphraseHash) (ApiT PassphraseHash))
-&gt; ByronWalletFromXPrvPostData
-&gt; Const (ApiT PassphraseHash) ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482254"><span class="hs-var">#passphraseHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>    </span><span id="local-6989586621682482253"><span class="annot"><span class="annottext">masterKey :: XPrv
</span><a href="#local-6989586621682482253"><span class="hs-identifier hs-var hs-var">masterKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT XPrv -&gt; XPrv
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482264"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletFromXPrvPostData
-&gt; ((ApiT XPrv -&gt; Const (ApiT XPrv) (ApiT XPrv))
    -&gt; ByronWalletFromXPrvPostData
    -&gt; Const (ApiT XPrv) ByronWalletFromXPrvPostData)
-&gt; ApiT XPrv
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;encryptedRootPrivateKey&quot;
  ((ApiT XPrv -&gt; Const (ApiT XPrv) (ApiT XPrv))
   -&gt; ByronWalletFromXPrvPostData
   -&gt; Const (ApiT XPrv) ByronWalletFromXPrvPostData)
(ApiT XPrv -&gt; Const (ApiT XPrv) (ApiT XPrv))
-&gt; ByronWalletFromXPrvPostData
-&gt; Const (ApiT XPrv) ByronWalletFromXPrvPostData
</span><a href="#local-6989586621682482252"><span class="hs-var">#encryptedRootPrivateKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span>    </span><span id="local-6989586621682482262"><span class="annot"><span class="annottext">byronKey :: ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482262"><span class="hs-identifier hs-var hs-var">byronKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; ByronKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#mkByronKeyFromMasterKey"><span class="hs-identifier hs-var">mkByronKeyFromMasterKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682482253"><span class="hs-identifier hs-var">masterKey</span></a></span><span>
</span><span id="line-1345"></span><span>    </span><span id="local-6989586621682482261"><span class="annot"><span class="annottext">wid :: WalletId
</span><a href="#local-6989586621682482261"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; WalletId
</span><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-var">WalletId</span></a></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; WalletId) -&gt; Digest Blake2b_160 -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPub -&gt; Digest Blake2b_160
forall (key :: Depth -&gt; * -&gt; *) a (depth :: Depth).
(WalletKey key, HashAlgorithm a) =&gt;
key depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var">digest</span></a></span><span> </span><span class="annot"><span class="annottext">(ByronKey 'RootK XPub -&gt; Digest Blake2b_160)
-&gt; ByronKey 'RootK XPub -&gt; Digest Blake2b_160
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv -&gt; ByronKey 'RootK XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
key depth XPrv -&gt; key depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKey 'RootK XPrv
</span><a href="#local-6989586621682482262"><span class="hs-identifier hs-var">byronKey</span></a></span><span>
</span><span id="line-1346"></span><span>
</span><span id="line-1347"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postIcarusWallet"><span class="hs-identifier hs-type">postIcarusWallet</span></a></span><span>
</span><span id="line-1348"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482251"><span class="annot"><a href="#local-6989586621682482251"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482250"><span class="annot"><a href="#local-6989586621682482250"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482249"><span class="annot"><a href="#local-6989586621682482249"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482248"><span class="annot"><a href="#local-6989586621682482248"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1349"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482251"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482250"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482249"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1350"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482250"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482248"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482249"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1351"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482249"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1352"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482250"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482249"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482251"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1353"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482248"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1354"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482248"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1355"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1356"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482251"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1357"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPostData"><span class="hs-identifier hs-type">ByronWalletPostData</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">15</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">18</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">21</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">24</span></span><span class="hs-special">]</span><span>
</span><span id="line-1358"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1359"></span><span id="postIcarusWallet"><span class="annot"><span class="annottext">postIcarusWallet :: ctx
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postIcarusWallet"><span class="hs-identifier hs-var hs-var">postIcarusWallet</span></a></span></span><span> </span><span id="local-6989586621682482247"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482247"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482246"><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482246"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1360"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; (IcarusKey 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, KnownDiscovery s, IsOurs s RewardAccount,
 IsOurs s Address, MaybeLight s, HasNetworkLayer IO ctx,
 WalletKey k, AddressBookIso s) =&gt;
ctx
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postLegacyWallet"><span class="hs-identifier hs-var">postLegacyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482247"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482245"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482244"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
 -&gt; Handler ApiByronWallet)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482243"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482243"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span id="local-6989586621682482242"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482242"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1361"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasGenesisData ctx, HasDBLayer IO s k ctx, PaymentAddress n k,
 k ~ IcarusKey, s ~ SeqState n k, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="Cardano.Wallet.html#createIcarusWallet"><span class="hs-identifier hs-var">W.createIcarusWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482251"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482250"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482249"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482243"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482242"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482240"><span class="hs-identifier hs-var">wName</span></a></span><span>
</span><span id="line-1362"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482245"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482239"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1364"></span><span>    </span><span id="local-6989586621682482240"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482240"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482246"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482238"><span class="hs-var">#name</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; (WalletName -&gt; Const WalletName WalletName)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
(WalletName -&gt; Const WalletName WalletName)
-&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName)
</span><a href="#local-6989586621682482237"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1365"></span><span>    </span><span id="local-6989586621682482236"><span class="annot"><span class="annottext">seed :: SomeMnemonic
</span><a href="#local-6989586621682482236"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482246"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; SomeMnemonic
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSentence&quot;
  ((ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiMnemonicT '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482235"><span class="hs-var">#mnemonicSentence</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiMnemonicT '[12, 15, 18, 21, 24]
  -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; (SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiMnemonicT&quot;
  ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
   -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
(SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482234"><span class="hs-var">#getApiMnemonicT</span></a></span><span>
</span><span id="line-1366"></span><span>    </span><span id="local-6989586621682482244"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482244"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482246"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const
         (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; Passphrase &quot;user&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const
        (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482233"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;user&quot;)
  -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const
      (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; (Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
   -&gt; ApiT (Passphrase &quot;user&quot;)
   -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
(Passphrase &quot;user&quot;
 -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ApiT (Passphrase &quot;user&quot;)
-&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;))
</span><a href="#local-6989586621682482232"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1367"></span><span>    </span><span id="local-6989586621682482239"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482239"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482244"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-1368"></span><span>    </span><span id="local-6989586621682482245"><span class="annot"><span class="annottext">rootXPrv :: IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482245"><span class="hs-identifier hs-var hs-var">rootXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromSeed"><span class="hs-identifier hs-var">Icarus.generateKeyFromSeed</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482236"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482239"><span class="hs-identifier hs-var">pwdP</span></a></span><span>
</span><span id="line-1369"></span><span>
</span><span id="line-1370"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postTrezorWallet"><span class="hs-identifier hs-type">postTrezorWallet</span></a></span><span>
</span><span id="line-1371"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482230"><span class="annot"><a href="#local-6989586621682482230"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482229"><span class="annot"><a href="#local-6989586621682482229"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482228"><span class="annot"><a href="#local-6989586621682482228"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482227"><span class="annot"><a href="#local-6989586621682482227"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1372"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482230"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482229"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482228"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1373"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482229"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482227"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482228"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1374"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482228"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1375"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482229"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482228"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482230"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1376"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482227"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1377"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482227"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1378"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1379"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482230"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1380"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPostData"><span class="hs-identifier hs-type">ByronWalletPostData</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">15</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">18</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">21</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">24</span></span><span class="hs-special">]</span><span>
</span><span id="line-1381"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1382"></span><span id="postTrezorWallet"><span class="annot"><span class="annottext">postTrezorWallet :: ctx
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postTrezorWallet"><span class="hs-identifier hs-var hs-var">postTrezorWallet</span></a></span></span><span> </span><span id="local-6989586621682482226"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482226"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482225"><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482225"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1383"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; (IcarusKey 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, KnownDiscovery s, IsOurs s RewardAccount,
 IsOurs s Address, MaybeLight s, HasNetworkLayer IO ctx,
 WalletKey k, AddressBookIso s) =&gt;
ctx
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postLegacyWallet"><span class="hs-identifier hs-var">postLegacyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482226"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482224"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482223"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
 -&gt; Handler ApiByronWallet)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482222"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482222"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span id="local-6989586621682482221"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482221"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1384"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasGenesisData ctx, HasDBLayer IO s k ctx, PaymentAddress n k,
 k ~ IcarusKey, s ~ SeqState n k, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="Cardano.Wallet.html#createIcarusWallet"><span class="hs-identifier hs-var">W.createIcarusWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482230"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482229"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482228"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482222"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482221"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482220"><span class="hs-identifier hs-var">wName</span></a></span><span>
</span><span id="line-1385"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482224"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482219"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1387"></span><span>    </span><span id="local-6989586621682482220"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482220"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482225"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482218"><span class="hs-var">#name</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; (WalletName -&gt; Const WalletName WalletName)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
(WalletName -&gt; Const WalletName WalletName)
-&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName)
</span><a href="#local-6989586621682482217"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1388"></span><span>    </span><span id="local-6989586621682482216"><span class="annot"><span class="annottext">seed :: SomeMnemonic
</span><a href="#local-6989586621682482216"><span class="hs-identifier hs-var hs-var">seed</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482225"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; SomeMnemonic
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSentence&quot;
  ((ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiMnemonicT '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482215"><span class="hs-var">#mnemonicSentence</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiMnemonicT '[12, 15, 18, 21, 24]
  -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; (SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiMnemonicT&quot;
  ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
   -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
(SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482214"><span class="hs-var">#getApiMnemonicT</span></a></span><span>
</span><span id="line-1389"></span><span>    </span><span id="local-6989586621682482223"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482223"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482225"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const
         (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; Passphrase &quot;user&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const
        (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482213"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;user&quot;)
  -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const
      (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; (Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
   -&gt; ApiT (Passphrase &quot;user&quot;)
   -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
(Passphrase &quot;user&quot;
 -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ApiT (Passphrase &quot;user&quot;)
-&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;))
</span><a href="#local-6989586621682482212"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1390"></span><span>    </span><span id="local-6989586621682482219"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482219"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482223"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-1391"></span><span>    </span><span id="local-6989586621682482224"><span class="annot"><span class="annottext">rootXPrv :: IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482224"><span class="hs-identifier hs-var hs-var">rootXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromSeed"><span class="hs-identifier hs-var">Icarus.generateKeyFromSeed</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482216"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482219"><span class="hs-identifier hs-var">pwdP</span></a></span><span>
</span><span id="line-1392"></span><span>
</span><span id="line-1393"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postLedgerWallet"><span class="hs-identifier hs-type">postLedgerWallet</span></a></span><span>
</span><span id="line-1394"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482211"><span class="annot"><a href="#local-6989586621682482211"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482210"><span class="annot"><a href="#local-6989586621682482210"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482209"><span class="annot"><a href="#local-6989586621682482209"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482208"><span class="annot"><a href="#local-6989586621682482208"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1395"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482211"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482209"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1396"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482208"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482209"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1397"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482209"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1398"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482209"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482211"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1399"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482208"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1400"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482208"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1401"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1402"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482211"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1403"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPostData"><span class="hs-identifier hs-type">ByronWalletPostData</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">12</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">15</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">18</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">21</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">24</span></span><span class="hs-special">]</span><span>
</span><span id="line-1404"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiByronWallet"><span class="hs-identifier hs-type">ApiByronWallet</span></a></span><span>
</span><span id="line-1405"></span><span id="postLedgerWallet"><span class="annot"><span class="annottext">postLedgerWallet :: ctx
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postLedgerWallet"><span class="hs-identifier hs-var hs-var">postLedgerWallet</span></a></span></span><span> </span><span id="local-6989586621682482207"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482207"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482206"><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482206"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1406"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; (IcarusKey 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, KnownDiscovery s, IsOurs s RewardAccount,
 IsOurs s Address, MaybeLight s, HasNetworkLayer IO ctx,
 WalletKey k, AddressBookIso s) =&gt;
ctx
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
</span><a href="Cardano.Wallet.Api.Server.html#postLegacyWallet"><span class="hs-identifier hs-var">postLegacyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482207"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482205"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482204"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
 -&gt; Handler ApiByronWallet)
-&gt; (WorkerCtx ctx
    -&gt; WalletId -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; Handler ApiByronWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482203"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482203"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span id="local-6989586621682482202"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482202"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1407"></span><span>        </span><span class="annot"><span class="annottext">WorkerCtx ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasGenesisData ctx, HasDBLayer IO s k ctx, PaymentAddress n k,
 k ~ IcarusKey, s ~ SeqState n k, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; WalletName
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="Cardano.Wallet.html#createIcarusWallet"><span class="hs-identifier hs-var">W.createIcarusWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482211"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482210"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482209"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482203"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482202"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482201"><span class="hs-identifier hs-var">wName</span></a></span><span>
</span><span id="line-1408"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482205"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482200"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1409"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1410"></span><span>    </span><span id="local-6989586621682482201"><span class="annot"><span class="annottext">wName :: WalletName
</span><a href="#local-6989586621682482201"><span class="hs-identifier hs-var hs-var">wName</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482206"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; WalletName
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482199"><span class="hs-var">#name</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((WalletName -&gt; Const WalletName WalletName)
    -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
-&gt; (WalletName -&gt; Const WalletName WalletName)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const WalletName (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((WalletName -&gt; Const WalletName WalletName)
   -&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName))
(WalletName -&gt; Const WalletName WalletName)
-&gt; ApiT WalletName -&gt; Const WalletName (ApiT WalletName)
</span><a href="#local-6989586621682482198"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1411"></span><span>    </span><span id="local-6989586621682482197"><span class="annot"><span class="annottext">mw :: SomeMnemonic
</span><a href="#local-6989586621682482197"><span class="hs-identifier hs-var hs-var">mw</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482206"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; SomeMnemonic
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mnemonicSentence&quot;
  ((ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiMnemonicT '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482196"><span class="hs-var">#mnemonicSentence</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiMnemonicT '[12, 15, 18, 21, 24]
  -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
    -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
    -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
-&gt; (SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiMnemonicT&quot;
  ((SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
   -&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
   -&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24]))
(SomeMnemonic -&gt; Const SomeMnemonic SomeMnemonic)
-&gt; ApiMnemonicT '[12, 15, 18, 21, 24]
-&gt; Const SomeMnemonic (ApiMnemonicT '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482195"><span class="hs-var">#getApiMnemonicT</span></a></span><span>
</span><span id="line-1412"></span><span>    </span><span id="local-6989586621682482204"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482204"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
</span><a href="#local-6989586621682482206"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
    -&gt; Const
         (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; Passphrase &quot;user&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
   -&gt; Const
        (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
</span><a href="#local-6989586621682482194"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;user&quot;)
  -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
 -&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
 -&gt; Const
      (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24]))
-&gt; ((Passphrase &quot;user&quot;
     -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
    -&gt; ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
-&gt; (Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ByronWalletPostData '[12, 15, 18, 21, 24]
-&gt; Const
     (Passphrase &quot;user&quot;) (ByronWalletPostData '[12, 15, 18, 21, 24])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;user&quot;
    -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
   -&gt; ApiT (Passphrase &quot;user&quot;)
   -&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;)))
(Passphrase &quot;user&quot;
 -&gt; Const (Passphrase &quot;user&quot;) (Passphrase &quot;user&quot;))
-&gt; ApiT (Passphrase &quot;user&quot;)
-&gt; Const (Passphrase &quot;user&quot;) (ApiT (Passphrase &quot;user&quot;))
</span><a href="#local-6989586621682482193"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1413"></span><span>    </span><span id="local-6989586621682482200"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482200"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482204"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-1414"></span><span>    </span><span id="local-6989586621682482205"><span class="annot"><span class="annottext">rootXPrv :: IcarusKey 'RootK XPrv
</span><a href="#local-6989586621682482205"><span class="hs-identifier hs-var hs-var">rootXPrv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Passphrase &quot;encryption&quot; -&gt; IcarusKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#generateKeyFromHardwareLedger"><span class="hs-identifier hs-var">Icarus.generateKeyFromHardwareLedger</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482197"><span class="hs-identifier hs-var">mw</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482200"><span class="hs-identifier hs-var">pwdP</span></a></span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                             ApiLayer Discrimination
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span class="hs-comment">-- Legacy wallets like 'Byron Random' and 'Icarus Sequential' are handled</span><span>
</span><span id="line-1421"></span><span class="hs-comment">-- through the same API endpoints. However, they rely on different contexts.</span><span>
</span><span id="line-1422"></span><span class="hs-comment">-- Since they have identical ids, we actually lookup both contexts in sequence.</span><span>
</span><span id="line-1423"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer"><span class="hs-identifier hs-type">withLegacyLayer</span></a></span><span>
</span><span id="line-1424"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482191"><span class="annot"><a href="#local-6989586621682482191"><span class="hs-identifier hs-type">byron</span></a></span></span><span> </span><span id="local-6989586621682482190"><span class="annot"><a href="#local-6989586621682482190"><span class="hs-identifier hs-type">icarus</span></a></span></span><span> </span><span id="local-6989586621682482189"><span class="annot"><a href="#local-6989586621682482189"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682482188"><span class="annot"><a href="#local-6989586621682482188"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1425"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482191"><span class="hs-identifier hs-type">byron</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482189"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1426"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482190"><span class="hs-identifier hs-type">icarus</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482189"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1427"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1429"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482191"><span class="hs-identifier hs-type">byron</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482188"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1430"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482190"><span class="hs-identifier hs-type">icarus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482188"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1431"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482188"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1432"></span><span id="withLegacyLayer"><span class="annot"><span class="annottext">withLegacyLayer :: ApiT WalletId
-&gt; (byron, Handler a) -&gt; (icarus, Handler a) -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer"><span class="hs-identifier hs-var hs-var">withLegacyLayer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482187"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482187"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682482186"><span class="annot"><span class="annottext">byron
</span><a href="#local-6989586621682482186"><span class="hs-identifier hs-var">byron</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482185"><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482185"><span class="hs-identifier hs-var">withByron</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682482184"><span class="annot"><span class="annottext">icarus
</span><a href="#local-6989586621682482184"><span class="hs-identifier hs-var">icarus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482183"><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482183"><span class="hs-identifier hs-var">withIcarus</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1433"></span><span>    </span><span class="annot"><span class="annottext">ApiT WalletId
-&gt; (byron, Handler a, ErrWalletNotResponding -&gt; Handler a)
-&gt; (icarus, Handler a, ErrWalletNotResponding -&gt; Handler a)
-&gt; Handler a
forall byron icarus (n :: NetworkDiscriminant) a.
(byron ~ ApiLayer (RndState n) ByronKey,
 icarus ~ ApiLayer (SeqState n IcarusKey) IcarusKey) =&gt;
ApiT WalletId
-&gt; (byron, Handler a, ErrWalletNotResponding -&gt; Handler a)
-&gt; (icarus, Handler a, ErrWalletNotResponding -&gt; Handler a)
-&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer%27"><span class="hs-identifier hs-var">withLegacyLayer'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482187"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byron
</span><a href="#local-6989586621682482186"><span class="hs-identifier hs-var">byron</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482185"><span class="hs-identifier hs-var">withByron</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1435"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">icarus
</span><a href="#local-6989586621682482184"><span class="hs-identifier hs-var">icarus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482183"><span class="hs-identifier hs-var">withIcarus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- | Like 'withLegacyLayer' but allow passing a custom handler for handling dead</span><span>
</span><span id="line-1438"></span><span class="hs-comment">-- workers.</span><span>
</span><span id="line-1439"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer%27"><span class="hs-identifier hs-type">withLegacyLayer'</span></a></span><span>
</span><span id="line-1440"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484050"><span class="annot"><a href="#local-6989586621682484050"><span class="hs-identifier hs-type">byron</span></a></span></span><span> </span><span id="local-6989586621682484048"><span class="annot"><a href="#local-6989586621682484048"><span class="hs-identifier hs-type">icarus</span></a></span></span><span> </span><span id="local-6989586621682484049"><span class="annot"><a href="#local-6989586621682484049"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682484047"><span class="annot"><a href="#local-6989586621682484047"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1441"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484050"><span class="hs-identifier hs-type">byron</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1442"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682484048"><span class="hs-identifier hs-type">icarus</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484049"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1443"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1445"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682484050"><span class="hs-identifier hs-type">byron</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484047"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-type">ErrWalletNotResponding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484047"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1446"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682484048"><span class="hs-identifier hs-type">icarus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484047"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-type">ErrWalletNotResponding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484047"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484047"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1448"></span><span id="withLegacyLayer%27"><span class="annot"><span class="annottext">withLegacyLayer' :: ApiT WalletId
-&gt; (byron, Handler a, ErrWalletNotResponding -&gt; Handler a)
-&gt; (icarus, Handler a, ErrWalletNotResponding -&gt; Handler a)
-&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#withLegacyLayer%27"><span class="hs-identifier hs-var hs-var">withLegacyLayer'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482182"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482182"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682482181"><span class="annot"><span class="annottext">byron
</span><a href="#local-6989586621682482181"><span class="hs-identifier hs-var">byron</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482180"><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482180"><span class="hs-identifier hs-var">withByron</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482179"><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482179"><span class="hs-identifier hs-var">deadByron</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682482178"><span class="annot"><span class="annottext">icarus
</span><a href="#local-6989586621682482178"><span class="hs-identifier hs-var">icarus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482177"><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482177"><span class="hs-identifier hs-var">withIcarus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482176"><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482176"><span class="hs-identifier hs-var">deadIcarus</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1451"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a) -&gt; Handler a
</span><a href="#local-6989586621682482175"><span class="hs-identifier hs-var">tryByron</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler a -&gt; ErrNoSuchWallet -&gt; Handler a
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler a -&gt; ErrNoSuchWallet -&gt; Handler a)
-&gt; Handler a -&gt; ErrNoSuchWallet -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a) -&gt; Handler a
</span><a href="#local-6989586621682482174"><span class="hs-identifier hs-var">tryIcarus</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler a
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482176"><span class="hs-identifier hs-var">deadIcarus</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482179"><span class="hs-identifier hs-var">deadByron</span></a></span><span>
</span><span id="line-1452"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1453"></span><span>    </span><span id="local-6989586621682482174"><span class="annot"><span class="annottext">tryIcarus :: (ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a) -&gt; Handler a
</span><a href="#local-6989586621682482174"><span class="hs-identifier hs-var hs-var">tryIcarus</span></a></span></span><span> </span><span id="local-6989586621682482173"><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler a
</span><a href="#local-6989586621682482173"><span class="hs-identifier hs-var">onMissing</span></a></span></span><span> </span><span id="local-6989586621682482172"><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482172"><span class="hs-identifier hs-var">onNotResponding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">icarus
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a)
-&gt; (WorkerCtx icarus -&gt; Handler a)
-&gt; Handler a
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-1454"></span><span>        </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484049"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1455"></span><span>        </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Icarus.html#IcarusKey"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-1456"></span><span>        </span><span class="annot"><span class="annottext">icarus
</span><a href="#local-6989586621682482178"><span class="hs-identifier hs-var">icarus</span></a></span><span>
</span><span id="line-1457"></span><span>        </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482182"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1458"></span><span>        </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler a
</span><a href="#local-6989586621682482173"><span class="hs-identifier hs-var">onMissing</span></a></span><span>
</span><span id="line-1459"></span><span>        </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482172"><span class="hs-identifier hs-var">onNotResponding</span></a></span><span>
</span><span id="line-1460"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler a
-&gt; WalletLayer IO (SeqState n IcarusKey) IcarusKey -&gt; Handler a
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482177"><span class="hs-identifier hs-var">withIcarus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1461"></span><span>
</span><span id="line-1462"></span><span>    </span><span id="local-6989586621682482175"><span class="annot"><span class="annottext">tryByron :: (ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a) -&gt; Handler a
</span><a href="#local-6989586621682482175"><span class="hs-identifier hs-var hs-var">tryByron</span></a></span></span><span> </span><span id="local-6989586621682482171"><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler a
</span><a href="#local-6989586621682482171"><span class="hs-identifier hs-var">onMissing</span></a></span></span><span> </span><span id="local-6989586621682482170"><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482170"><span class="hs-identifier hs-var">onNotResponding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">byron
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a)
-&gt; (WorkerCtx byron -&gt; Handler a)
-&gt; Handler a
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-1463"></span><span>        </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1464"></span><span>        </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1465"></span><span>        </span><span class="annot"><span class="annottext">byron
</span><a href="#local-6989586621682482181"><span class="hs-identifier hs-var">byron</span></a></span><span>
</span><span id="line-1466"></span><span>        </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482182"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1467"></span><span>        </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler a
</span><a href="#local-6989586621682482171"><span class="hs-identifier hs-var">onMissing</span></a></span><span>
</span><span id="line-1468"></span><span>        </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
</span><a href="#local-6989586621682482170"><span class="hs-identifier hs-var">onNotResponding</span></a></span><span>
</span><span id="line-1469"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler a -&gt; WalletLayer IO (RndState n) ByronKey -&gt; Handler a
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Handler a
</span><a href="#local-6989586621682482180"><span class="hs-identifier hs-var">withByron</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                   Wallets
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1474"></span><span>
</span><span id="line-1475"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#deleteWallet"><span class="hs-identifier hs-type">deleteWallet</span></a></span><span>
</span><span id="line-1476"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482169"><span class="annot"><a href="#local-6989586621682482169"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482168"><span class="annot"><a href="#local-6989586621682482168"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482167"><span class="annot"><a href="#local-6989586621682482167"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1477"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482169"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482168"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482167"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1478"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1479"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482169"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1480"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1481"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">NoContent</span></a></span><span>
</span><span id="line-1482"></span><span id="deleteWallet"><span class="annot"><span class="annottext">deleteWallet :: ctx -&gt; ApiT WalletId -&gt; Handler NoContent
</span><a href="Cardano.Wallet.Api.Server.html#deleteWallet"><span class="hs-identifier hs-var hs-var">deleteWallet</span></a></span></span><span> </span><span id="local-6989586621682482166"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482166"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482165"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482165"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1483"></span><span>    </span><span class="hs-comment">-- Start a context so that an error is throw if the wallet doesn't exist.</span><span>
</span><span id="line-1484"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482168"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482167"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482166"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482165"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span>
</span><span id="line-1485"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler () -&gt; ErrWalletNotResponding -&gt; Handler ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; ErrWalletNotResponding -&gt; Handler ())
-&gt; Handler () -&gt; ErrWalletNotResponding -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler () -&gt; WalletLayer IO s k -&gt; Handler ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; WalletLayer IO s k -&gt; Handler ())
-&gt; Handler () -&gt; WalletLayer IO s k -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1486"></span><span>
</span><span id="line-1487"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Handler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Handler ()) -&gt; IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k) -&gt; WalletId -&gt; IO ()
forall key resource.
Ord key =&gt;
WorkerRegistry key resource -&gt; key -&gt; IO ()
</span><a href="Cardano.Wallet.Registry.html#unregister"><span class="hs-identifier hs-var">Registry.unregister</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682482163"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482165"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1488"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Handler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Handler ()) -&gt; IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k -&gt; WalletId -&gt; IO ()
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
DBFactory m s k -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.DB.html#removeDatabase"><span class="hs-identifier hs-var hs-var">removeDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682482161"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482165"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span>    </span><span class="annot"><span class="annottext">NoContent -&gt; Handler NoContent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">NoContent
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">NoContent</span></a></span><span>
</span><span id="line-1491"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1492"></span><span>    </span><span id="local-6989586621682482163"><span class="annot"><span class="annottext">re :: WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682482163"><span class="hs-identifier hs-var hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482166"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((WorkerRegistry WalletId (DBLayer IO s k)
     -&gt; Const
          (WorkerRegistry WalletId (DBLayer IO s k))
          (WorkerRegistry WalletId (DBLayer IO s k)))
    -&gt; ctx -&gt; Const (WorkerRegistry WalletId (DBLayer IO s k)) ctx)
-&gt; WorkerRegistry WalletId (DBLayer IO s k)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
</span><a href="Cardano.Wallet.Api.html#workerRegistry"><span class="hs-identifier hs-var">workerRegistry</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482168"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482167"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1493"></span><span>    </span><span id="local-6989586621682482161"><span class="annot"><span class="annottext">df :: DBFactory IO s k
</span><a href="#local-6989586621682482161"><span class="hs-identifier hs-var hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482166"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBFactory IO s k
     -&gt; Const (DBFactory IO s k) (DBFactory IO s k))
    -&gt; ctx -&gt; Const (DBFactory IO s k) ctx)
-&gt; DBFactory IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBFactory s k ctx =&gt; Lens' ctx (DBFactory IO s k)
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBFactory s k ctx =&gt;
Lens' ctx (DBFactory IO s k)
</span><a href="Cardano.Wallet.Api.html#dbFactory"><span class="hs-identifier hs-var">dbFactory</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482168"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482167"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-type">getWallet</span></a></span><span>
</span><span id="line-1496"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484310"><span class="annot"><a href="#local-6989586621682484310"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484309"><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484308"><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484307"><span class="annot"><a href="#local-6989586621682484307"><span class="hs-identifier hs-type">apiWallet</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1497"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484310"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1498"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484310"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1499"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484310"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1500"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1501"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484310"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1502"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-type">MkApiWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484310"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484307"><span class="hs-identifier hs-type">apiWallet</span></a></span><span>
</span><span id="line-1503"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1504"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682484307"><span class="hs-identifier hs-type">apiWallet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span id="getWallet"><span class="annot"><span class="annottext">getWallet :: ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var hs-var">getWallet</span></a></span></span><span> </span><span id="local-6989586621682482159"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482158"><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482158"><span class="hs-identifier hs-var">mkApiWallet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482157"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1506"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (apiWallet, UTCTime))
-&gt; (ErrWalletNotResponding -&gt; Handler (apiWallet, UTCTime))
-&gt; (WorkerCtx ctx -&gt; Handler (apiWallet, UTCTime))
-&gt; Handler (apiWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (apiWallet, UTCTime)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (apiWallet, UTCTime)
</span><a href="#local-6989586621682482156"><span class="hs-identifier hs-var">whenNotResponding</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k -&gt; Handler (apiWallet, UTCTime)
WorkerCtx ctx -&gt; Handler (apiWallet, UTCTime)
</span><a href="#local-6989586621682482155"><span class="hs-identifier hs-var">whenAlive</span></a></span><span>
</span><span id="line-1507"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1508"></span><span>    </span><span id="local-6989586621682482154"><span class="annot"><span class="annottext">df :: DBFactory IO s k
</span><a href="#local-6989586621682482154"><span class="hs-identifier hs-var hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBFactory IO s k
     -&gt; Const (DBFactory IO s k) (DBFactory IO s k))
    -&gt; ctx -&gt; Const (DBFactory IO s k) ctx)
-&gt; DBFactory IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBFactory s k ctx =&gt; Lens' ctx (DBFactory IO s k)
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBFactory s k ctx =&gt;
Lens' ctx (DBFactory IO s k)
</span><a href="Cardano.Wallet.Api.html#dbFactory"><span class="hs-identifier hs-var">dbFactory</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1509"></span><span>
</span><span id="line-1510"></span><span>    </span><span id="local-6989586621682482155"><span class="annot"><span class="annottext">whenAlive :: WalletLayer IO s k -&gt; Handler (apiWallet, UTCTime)
</span><a href="#local-6989586621682482155"><span class="hs-identifier hs-var hs-var">whenAlive</span></a></span></span><span> </span><span id="local-6989586621682482153"><span class="annot"><span class="annottext">WalletLayer IO s k
</span><a href="#local-6989586621682482153"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1511"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682482152"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482152"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482151"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482151"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482150"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482150"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; Handler (Wallet s, WalletMetadata, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
 -&gt; Handler (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; Handler (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">W.readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
</span><a href="#local-6989586621682482153"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1512"></span><span>        </span><span id="local-6989586621682482148"><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482148"><span class="hs-identifier hs-var">progress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SyncProgress -&gt; Handler SyncProgress
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SyncProgress -&gt; Handler SyncProgress)
-&gt; IO SyncProgress -&gt; Handler SyncProgress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx -&gt; Wallet s -&gt; IO SyncProgress
forall ctx s.
HasNetworkLayer IO ctx =&gt;
ctx -&gt; Wallet s -&gt; IO SyncProgress
</span><a href="Cardano.Wallet.html#walletSyncProgress"><span class="hs-identifier hs-var">W.walletSyncProgress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482152"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1513"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482151"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((UTCTime -&gt; Const UTCTime UTCTime)
    -&gt; WalletMetadata -&gt; Const UTCTime WalletMetadata)
-&gt; UTCTime
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;creationTime&quot;
  ((UTCTime -&gt; Const UTCTime UTCTime)
   -&gt; WalletMetadata -&gt; Const UTCTime WalletMetadata)
(UTCTime -&gt; Const UTCTime UTCTime)
-&gt; WalletMetadata -&gt; Const UTCTime WalletMetadata
</span><a href="#local-6989586621682482146"><span class="hs-var">#creationTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(apiWallet -&gt; (apiWallet, UTCTime))
-&gt; Handler apiWallet -&gt; Handler (apiWallet, UTCTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482158"><span class="hs-identifier hs-var">mkApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482152"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482151"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482150"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682482148"><span class="hs-identifier hs-var">progress</span></a></span><span>
</span><span id="line-1514"></span><span>
</span><span id="line-1515"></span><span>    </span><span id="local-6989586621682482156"><span class="annot"><span class="annottext">whenNotResponding :: ErrWalletNotResponding -&gt; Handler (apiWallet, UTCTime)
</span><a href="#local-6989586621682482156"><span class="hs-identifier hs-var hs-var">whenNotResponding</span></a></span></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ServerError IO (apiWallet, UTCTime)
-&gt; Handler (apiWallet, UTCTime)
forall a. ExceptT ServerError IO a -&gt; Handler a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Handler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ServerError IO (apiWallet, UTCTime)
 -&gt; Handler (apiWallet, UTCTime))
-&gt; ExceptT ServerError IO (apiWallet, UTCTime)
-&gt; Handler (apiWallet, UTCTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either ServerError (apiWallet, UTCTime))
-&gt; ExceptT ServerError IO (apiWallet, UTCTime)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ServerError (apiWallet, UTCTime))
 -&gt; ExceptT ServerError IO (apiWallet, UTCTime))
-&gt; IO (Either ServerError (apiWallet, UTCTime))
-&gt; ExceptT ServerError IO (apiWallet, UTCTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
-&gt; WalletId
-&gt; (DBLayer IO s k -&gt; IO (Either ServerError (apiWallet, UTCTime)))
-&gt; IO (Either ServerError (apiWallet, UTCTime))
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
DBFactory m s k
-&gt; forall a. WalletId -&gt; (DBLayer m s k -&gt; IO a) -&gt; IO a
</span><a href="Cardano.Wallet.DB.html#withDatabase"><span class="hs-identifier hs-var hs-var">withDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682482154"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">((DBLayer IO s k -&gt; IO (Either ServerError (apiWallet, UTCTime)))
 -&gt; IO (Either ServerError (apiWallet, UTCTime)))
-&gt; (DBLayer IO s k -&gt; IO (Either ServerError (apiWallet, UTCTime)))
-&gt; IO (Either ServerError (apiWallet, UTCTime))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482142"><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682482142"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handler (apiWallet, UTCTime)
-&gt; IO (Either ServerError (apiWallet, UTCTime))
forall a. Handler a -&gt; IO (Either ServerError a)
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (apiWallet, UTCTime)
 -&gt; IO (Either ServerError (apiWallet, UTCTime)))
-&gt; Handler (apiWallet, UTCTime)
-&gt; IO (Either ServerError (apiWallet, UTCTime))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1516"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482141"><span class="annot"><span class="annottext">wrk :: WorkerCtx ctx
</span><a href="#local-6989586621682482141"><span class="hs-identifier hs-var hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (WorkerMsg ctx -&gt; WorkerLog (WorkerKey ctx) (WorkerMsg ctx))
-&gt; ctx
-&gt; WorkerCtx ctx
forall resource ctx.
HasWorkerCtx resource ctx =&gt;
resource
-&gt; (WorkerMsg ctx -&gt; WorkerLog (WorkerKey ctx) (WorkerMsg ctx))
-&gt; ctx
-&gt; WorkerCtx ctx
</span><a href="Cardano.Wallet.Registry.html#hoistResource"><span class="hs-identifier hs-var">hoistResource</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682482142"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; WalletWorkerLog -&gt; WorkerLog WalletId WalletWorkerLog
forall key msg. key -&gt; msg -&gt; WorkerLog key msg
</span><a href="Cardano.Wallet.Registry.html#MsgFromWorker"><span class="hs-identifier hs-var">MsgFromWorker</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1517"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682482138"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482138"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482137"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482137"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482136"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482136"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; Handler (Wallet s, WalletMetadata, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
 -&gt; Handler (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; Handler (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">W.readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484308"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482141"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1518"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482137"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((UTCTime -&gt; Const UTCTime UTCTime)
    -&gt; WalletMetadata -&gt; Const UTCTime WalletMetadata)
-&gt; UTCTime
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;creationTime&quot;
  ((UTCTime -&gt; Const UTCTime UTCTime)
   -&gt; WalletMetadata -&gt; Const UTCTime WalletMetadata)
(UTCTime -&gt; Const UTCTime UTCTime)
-&gt; WalletMetadata -&gt; Const UTCTime WalletMetadata
</span><a href="#local-6989586621682482135"><span class="hs-var">#creationTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(apiWallet -&gt; (apiWallet, UTCTime))
-&gt; Handler apiWallet -&gt; Handler (apiWallet, UTCTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482158"><span class="hs-identifier hs-var">mkApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482157"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482138"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482137"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482136"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="Cardano.Wallet.Primitive.SyncProgress.html#NotResponding"><span class="hs-identifier hs-var">NotResponding</span></a></span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listWallets"><span class="hs-identifier hs-type">listWallets</span></a></span><span>
</span><span id="line-1521"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482133"><span class="annot"><a href="#local-6989586621682482133"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482132"><span class="annot"><a href="#local-6989586621682482132"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482131"><span class="annot"><a href="#local-6989586621682482131"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482130"><span class="annot"><a href="#local-6989586621682482130"><span class="hs-identifier hs-type">apiWallet</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1522"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482133"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482132"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482131"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1523"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482130"><span class="hs-identifier hs-type">apiWallet</span></a></span><span>
</span><span id="line-1524"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1525"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482133"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1526"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-type">MkApiWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482133"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482132"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482130"><span class="hs-identifier hs-type">apiWallet</span></a></span><span>
</span><span id="line-1527"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482130"><span class="hs-identifier hs-type">apiWallet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1528"></span><span id="listWallets"><span class="annot"><span class="annottext">listWallets :: ctx
-&gt; MkApiWallet ctx s apiWallet -&gt; Handler [(apiWallet, UTCTime)]
</span><a href="Cardano.Wallet.Api.Server.html#listWallets"><span class="hs-identifier hs-var hs-var">listWallets</span></a></span></span><span> </span><span id="local-6989586621682482129"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482129"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482128"><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482128"><span class="hs-identifier hs-var">mkApiWallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1529"></span><span>    </span><span id="local-6989586621682482127"><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682482127"><span class="hs-identifier hs-var">wids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [WalletId] -&gt; Handler [WalletId]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [WalletId] -&gt; Handler [WalletId])
-&gt; IO [WalletId] -&gt; Handler [WalletId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k -&gt; IO [WalletId]
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
DBFactory m s k -&gt; IO [WalletId]
</span><a href="Cardano.Wallet.DB.html#listDatabases"><span class="hs-identifier hs-var hs-var">listDatabases</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682482125"><span class="hs-identifier hs-var">df</span></a></span><span>
</span><span id="line-1530"></span><span>    </span><span class="annot"><span class="annottext">IO [(apiWallet, UTCTime)] -&gt; Handler [(apiWallet, UTCTime)]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [(apiWallet, UTCTime)] -&gt; Handler [(apiWallet, UTCTime)])
-&gt; IO [(apiWallet, UTCTime)] -&gt; Handler [(apiWallet, UTCTime)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((apiWallet, UTCTime) -&gt; UTCTime)
-&gt; [(apiWallet, UTCTime)] -&gt; [(apiWallet, UTCTime)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sortOn</span></a></span><span> </span><span class="annot"><span class="annottext">(apiWallet, UTCTime) -&gt; UTCTime
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(apiWallet, UTCTime)] -&gt; [(apiWallet, UTCTime)])
-&gt; ([Maybe (apiWallet, UTCTime)] -&gt; [(apiWallet, UTCTime)])
-&gt; [Maybe (apiWallet, UTCTime)]
-&gt; [(apiWallet, UTCTime)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (apiWallet, UTCTime)] -&gt; [(apiWallet, UTCTime)]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe (apiWallet, UTCTime)] -&gt; [(apiWallet, UTCTime)])
-&gt; IO [Maybe (apiWallet, UTCTime)] -&gt; IO [(apiWallet, UTCTime)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT WalletId -&gt; IO (Maybe (apiWallet, UTCTime)))
-&gt; [ApiT WalletId] -&gt; IO [Maybe (apiWallet, UTCTime)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT WalletId -&gt; IO (Maybe (apiWallet, UTCTime))
</span><a href="#local-6989586621682482123"><span class="hs-identifier hs-var">maybeGetWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletId -&gt; ApiT WalletId) -&gt; [WalletId] -&gt; [ApiT WalletId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682482127"><span class="hs-identifier hs-var">wids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1532"></span><span>    </span><span id="local-6989586621682482125"><span class="annot"><span class="annottext">df :: DBFactory IO s k
</span><a href="#local-6989586621682482125"><span class="hs-identifier hs-var hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482129"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBFactory IO s k
     -&gt; Const (DBFactory IO s k) (DBFactory IO s k))
    -&gt; ctx -&gt; Const (DBFactory IO s k) ctx)
-&gt; DBFactory IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBFactory s k ctx =&gt; Lens' ctx (DBFactory IO s k)
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBFactory s k ctx =&gt;
Lens' ctx (DBFactory IO s k)
</span><a href="Cardano.Wallet.Api.html#dbFactory"><span class="hs-identifier hs-var">dbFactory</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482132"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482131"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1533"></span><span>
</span><span id="line-1534"></span><span>    </span><span class="hs-comment">-- Under extreme circumstances (like integration tests running in parallel)</span><span>
</span><span id="line-1535"></span><span>    </span><span class="hs-comment">-- there may be race conditions where the wallet is deleted just before we</span><span>
</span><span id="line-1536"></span><span>    </span><span class="hs-comment">-- try to read it.</span><span>
</span><span id="line-1537"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1538"></span><span>    </span><span class="hs-comment">-- But.. why do we need to both runHandler and tryAnyDeep?</span><span>
</span><span id="line-1539"></span><span>    </span><span class="annot"><a href="#local-6989586621682482123"><span class="hs-identifier hs-type">maybeGetWallet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482130"><span class="hs-identifier hs-type">apiWallet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1540"></span><span>    </span><span id="local-6989586621682482123"><span class="annot"><span class="annottext">maybeGetWallet :: ApiT WalletId -&gt; IO (Maybe (apiWallet, UTCTime))
</span><a href="#local-6989586621682482123"><span class="hs-identifier hs-var hs-var">maybeGetWallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1541"></span><span>        </span><span class="annot"><span class="annottext">(Either SomeException (Maybe (apiWallet, UTCTime))
 -&gt; Maybe (apiWallet, UTCTime))
-&gt; IO (Either SomeException (Maybe (apiWallet, UTCTime)))
-&gt; IO (Maybe (apiWallet, UTCTime))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Maybe (apiWallet, UTCTime)) -&gt; Maybe (apiWallet, UTCTime)
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Maybe (apiWallet, UTCTime)) -&gt; Maybe (apiWallet, UTCTime))
-&gt; (Either SomeException (Maybe (apiWallet, UTCTime))
    -&gt; Maybe (Maybe (apiWallet, UTCTime)))
-&gt; Either SomeException (Maybe (apiWallet, UTCTime))
-&gt; Maybe (apiWallet, UTCTime)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either SomeException (Maybe (apiWallet, UTCTime))
-&gt; Maybe (Maybe (apiWallet, UTCTime))
forall a b. Either a b -&gt; Maybe b
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1542"></span><span>        </span><span class="annot"><span class="annottext">(IO (Either SomeException (Maybe (apiWallet, UTCTime)))
 -&gt; IO (Maybe (apiWallet, UTCTime)))
-&gt; (ApiT WalletId
    -&gt; IO (Either SomeException (Maybe (apiWallet, UTCTime))))
-&gt; ApiT WalletId
-&gt; IO (Maybe (apiWallet, UTCTime))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (apiWallet, UTCTime))
-&gt; IO (Either SomeException (Maybe (apiWallet, UTCTime)))
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, NFData a) =&gt;
m a -&gt; m (Either SomeException a)
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">tryAnyDeep</span></a></span><span>
</span><span id="line-1543"></span><span>        </span><span class="annot"><span class="annottext">(IO (Maybe (apiWallet, UTCTime))
 -&gt; IO (Either SomeException (Maybe (apiWallet, UTCTime))))
-&gt; (ApiT WalletId -&gt; IO (Maybe (apiWallet, UTCTime)))
-&gt; ApiT WalletId
-&gt; IO (Either SomeException (Maybe (apiWallet, UTCTime)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ServerError (apiWallet, UTCTime)
 -&gt; Maybe (apiWallet, UTCTime))
-&gt; IO (Either ServerError (apiWallet, UTCTime))
-&gt; IO (Maybe (apiWallet, UTCTime))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Either ServerError (apiWallet, UTCTime)
-&gt; Maybe (apiWallet, UTCTime)
forall a b. Either a b -&gt; Maybe b
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span>
</span><span id="line-1544"></span><span>        </span><span class="annot"><span class="annottext">(IO (Either ServerError (apiWallet, UTCTime))
 -&gt; IO (Maybe (apiWallet, UTCTime)))
-&gt; (ApiT WalletId -&gt; IO (Either ServerError (apiWallet, UTCTime)))
-&gt; ApiT WalletId
-&gt; IO (Maybe (apiWallet, UTCTime))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Handler (apiWallet, UTCTime)
-&gt; IO (Either ServerError (apiWallet, UTCTime))
forall a. Handler a -&gt; IO (Either ServerError a)
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">runHandler</span></a></span><span>
</span><span id="line-1545"></span><span>        </span><span class="annot"><span class="annottext">(Handler (apiWallet, UTCTime)
 -&gt; IO (Either ServerError (apiWallet, UTCTime)))
-&gt; (ApiT WalletId -&gt; Handler (apiWallet, UTCTime))
-&gt; ApiT WalletId
-&gt; IO (Either ServerError (apiWallet, UTCTime))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482129"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482128"><span class="hs-identifier hs-var">mkApiWallet</span></a></span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putWallet"><span class="hs-identifier hs-type">putWallet</span></a></span><span>
</span><span id="line-1548"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482122"><span class="annot"><a href="#local-6989586621682482122"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482121"><span class="annot"><a href="#local-6989586621682482121"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482120"><span class="annot"><a href="#local-6989586621682482120"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482119"><span class="annot"><a href="#local-6989586621682482119"><span class="hs-identifier hs-type">apiWallet</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1549"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482122"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482121"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482120"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1550"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1551"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482122"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1552"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiWallet"><span class="hs-identifier hs-type">MkApiWallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482122"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482121"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482119"><span class="hs-identifier hs-type">apiWallet</span></a></span><span>
</span><span id="line-1553"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1554"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutData"><span class="hs-identifier hs-type">WalletPutData</span></a></span><span>
</span><span id="line-1555"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482119"><span class="hs-identifier hs-type">apiWallet</span></a></span><span>
</span><span id="line-1556"></span><span id="putWallet"><span class="annot"><span class="annottext">putWallet :: ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; WalletPutData
-&gt; Handler apiWallet
</span><a href="Cardano.Wallet.Api.Server.html#putWallet"><span class="hs-identifier hs-var hs-var">putWallet</span></a></span></span><span> </span><span id="local-6989586621682482118"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482118"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482117"><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482117"><span class="hs-identifier hs-var">mkApiWallet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482116"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482116"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682482115"><span class="annot"><span class="annottext">WalletPutData
</span><a href="#local-6989586621682482115"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1557"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WalletPutData
</span><a href="#local-6989586621682482115"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">WalletPutData
-&gt; ((Maybe (ApiT WalletName)
     -&gt; Const (Maybe (ApiT WalletName)) (Maybe (ApiT WalletName)))
    -&gt; WalletPutData -&gt; Const (Maybe (ApiT WalletName)) WalletPutData)
-&gt; Maybe (ApiT WalletName)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;name&quot;
  ((Maybe (ApiT WalletName)
    -&gt; Const (Maybe (ApiT WalletName)) (Maybe (ApiT WalletName)))
   -&gt; WalletPutData -&gt; Const (Maybe (ApiT WalletName)) WalletPutData)
(Maybe (ApiT WalletName)
 -&gt; Const (Maybe (ApiT WalletName)) (Maybe (ApiT WalletName)))
-&gt; WalletPutData -&gt; Const (Maybe (ApiT WalletName)) WalletPutData
</span><a href="#local-6989586621682482114"><span class="hs-var">#name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1558"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ApiT WalletName)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1559"></span><span>            </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1560"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482113"><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482113"><span class="hs-identifier hs-var">wName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482118"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482116"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482112"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482112"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1561"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; Handler ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; (WalletMetadata -&gt; WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (WalletMetadata -&gt; WalletMetadata)
-&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#updateWallet"><span class="hs-identifier hs-var">W.updateWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482112"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482116"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletName -&gt; WalletMetadata -&gt; WalletMetadata
</span><a href="#local-6989586621682482110"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482113"><span class="hs-identifier hs-var">wName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1562"></span><span>    </span><span class="annot"><span class="annottext">(apiWallet, UTCTime) -&gt; apiWallet
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((apiWallet, UTCTime) -&gt; apiWallet)
-&gt; Handler (apiWallet, UTCTime) -&gt; Handler apiWallet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
forall ctx s (k :: Depth -&gt; * -&gt; *) apiWallet.
(ctx ~ ApiLayer s k, HasWorkerRegistry s k ctx,
 HasDBFactory s k ctx) =&gt;
ctx
-&gt; MkApiWallet ctx s apiWallet
-&gt; ApiT WalletId
-&gt; Handler (apiWallet, UTCTime)
</span><a href="Cardano.Wallet.Api.Server.html#getWallet"><span class="hs-identifier hs-var">getWallet</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482118"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiWallet ctx s apiWallet
</span><a href="#local-6989586621682482117"><span class="hs-identifier hs-var">mkApiWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ApiT WalletId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482116"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1564"></span><span>    </span><span class="annot"><a href="#local-6989586621682482110"><span class="hs-identifier hs-type">modify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletName"><span class="hs-identifier hs-type">W.WalletName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletMetadata"><span class="hs-identifier hs-type">WalletMetadata</span></a></span><span>
</span><span id="line-1565"></span><span>    </span><span id="local-6989586621682482110"><span class="annot"><span class="annottext">modify :: WalletName -&gt; WalletMetadata -&gt; WalletMetadata
</span><a href="#local-6989586621682482110"><span class="hs-identifier hs-var hs-var">modify</span></a></span></span><span> </span><span id="local-6989586621682482109"><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482109"><span class="hs-identifier hs-var">wName</span></a></span></span><span> </span><span id="local-6989586621682482108"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482108"><span class="hs-identifier hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682482108"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:name:WalletMetadata :: WalletName
</span><a href="#local-6989586621682482107"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletName
</span><a href="#local-6989586621682482109"><span class="hs-identifier hs-var">wName</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1566"></span><span>
</span><span id="line-1567"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putWalletPassphrase"><span class="hs-identifier hs-type">putWalletPassphrase</span></a></span><span>
</span><span id="line-1568"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482106"><span class="annot"><a href="#local-6989586621682482106"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482105"><span class="annot"><a href="#local-6989586621682482105"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482104"><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1569"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1570"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482106"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482105"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1571"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier hs-type">GetAccount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482105"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1572"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1573"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482106"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1574"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1575"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-1576"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-1577"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AccountK"><span class="hs-identifier hs-type">AccountK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1579"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1580"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutPassphraseData"><span class="hs-identifier hs-type">WalletPutPassphraseData</span></a></span><span>
</span><span id="line-1581"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">NoContent</span></a></span><span>
</span><span id="line-1582"></span><span id="putWalletPassphrase"><span class="annot"><span class="annottext">putWalletPassphrase :: ctx
-&gt; ((SomeMnemonic, Maybe SomeMnemonic)
    -&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv)
-&gt; (k 'AccountK XPub -&gt; XPub)
-&gt; ApiT WalletId
-&gt; WalletPutPassphraseData
-&gt; Handler NoContent
</span><a href="Cardano.Wallet.Api.Server.html#putWalletPassphrase"><span class="hs-identifier hs-var hs-var">putWalletPassphrase</span></a></span></span><span> </span><span id="local-6989586621682482103"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482103"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482102"><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482102"><span class="hs-identifier hs-var">createKey</span></a></span></span><span> </span><span id="local-6989586621682482101"><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
</span><a href="#local-6989586621682482101"><span class="hs-identifier hs-var">getKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482100"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482100"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutPassphraseData"><span class="hs-identifier hs-type">WalletPutPassphraseData</span></a></span><span> </span><span id="local-6989586621682482098"><span class="annot"><span class="annottext">Either
  WalletPutPassphraseOldPassphraseData
  WalletPutPassphraseMnemonicData
</span><a href="#local-6989586621682482098"><span class="hs-identifier hs-var">method</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerCtx (ApiLayer s k) -&gt; Handler NoContent)
-&gt; Handler NoContent
forall a. (WorkerCtx (ApiLayer s k) -&gt; Handler a) -&gt; Handler a
</span><a href="#local-6989586621682482097"><span class="hs-identifier hs-var">withWrk</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx (ApiLayer s k) -&gt; Handler NoContent)
 -&gt; Handler NoContent)
-&gt; (WorkerCtx (ApiLayer s k) -&gt; Handler NoContent)
-&gt; Handler NoContent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482096"><span class="annot"><span class="annottext">WorkerCtx (ApiLayer s k)
</span><a href="#local-6989586621682482096"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1584"></span><span>        </span><span class="annot"><span class="annottext">NoContent
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">NoContent</span></a></span><span> </span><span class="annot"><span class="annottext">NoContent -&gt; Handler () -&gt; Handler NoContent
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  WalletPutPassphraseOldPassphraseData
  WalletPutPassphraseMnemonicData
</span><a href="#local-6989586621682482098"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1585"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>
</span><span id="line-1586"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutPassphraseOldPassphraseData"><span class="hs-identifier hs-type">Api.WalletPutPassphraseOldPassphraseData</span></a></span><span>
</span><span id="line-1587"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482093"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482093"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482092"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482092"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1589"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1590"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrUpdatePassphrase IO () -&gt; Handler ())
-&gt; ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; (Passphrase &quot;user&quot;, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, WalletKey k) =&gt;
ctx
-&gt; WalletId
-&gt; (Passphrase &quot;user&quot;, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
</span><a href="Cardano.Wallet.html#updateWalletPassphraseWithOldPassphrase"><span class="hs-identifier hs-var">W.updateWalletPassphraseWithOldPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx (ApiLayer s k)
</span><a href="#local-6989586621682482096"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482100"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482093"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482092"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1591"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span>
</span><span id="line-1592"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletPutPassphraseMnemonicData"><span class="hs-identifier hs-type">Api.WalletPutPassphraseMnemonicData</span></a></span><span>
</span><span id="line-1593"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMnemonicT"><span class="hs-identifier hs-type">ApiMnemonicT</span></a></span><span> </span><span id="local-6989586621682482088"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482088"><span class="hs-identifier hs-var">mnemonic</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682482087"><span class="annot"><span class="annottext">Maybe (ApiMnemonicT (AllowedMnemonics 'SndFactor))
</span><a href="#local-6989586621682482087"><span class="hs-identifier hs-var">sndFactor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482086"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482086"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1595"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482085"><span class="annot"><span class="annottext">encrPass :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482085"><span class="hs-identifier hs-var hs-var">encrPass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#currentPassphraseScheme"><span class="hs-identifier hs-var">currentPassphraseScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482086"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-1596"></span><span>                </span><span id="local-6989586621682482084"><span class="annot"><span class="annottext">challengeKey :: k 'RootK XPrv
</span><a href="#local-6989586621682482084"><span class="hs-identifier hs-var hs-var">challengeKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv
</span><a href="#local-6989586621682482102"><span class="hs-identifier hs-var">createKey</span></a></span><span>
</span><span id="line-1597"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682482088"><span class="hs-identifier hs-var">mnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiMnemonicT '[9, 12] -&gt; SomeMnemonic
forall (sizes :: [Nat]). ApiMnemonicT sizes -&gt; SomeMnemonic
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiMnemonicT%3AApiMnemonicT"><span class="hs-identifier hs-var hs-var">getApiMnemonicT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiMnemonicT '[9, 12] -&gt; SomeMnemonic)
-&gt; Maybe (ApiMnemonicT '[9, 12]) -&gt; Maybe SomeMnemonic
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiMnemonicT '[9, 12])
Maybe (ApiMnemonicT (AllowedMnemonics 'SndFactor))
</span><a href="#local-6989586621682482087"><span class="hs-identifier hs-var">sndFactor</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482085"><span class="hs-identifier hs-var">encrPass</span></a></span><span>
</span><span id="line-1598"></span><span>                </span><span id="local-6989586621682482083"><span class="annot"><span class="annottext">challengPubKey :: k 'AccountK XPub
</span><a href="#local-6989586621682482083"><span class="hs-identifier hs-var hs-var">challengPubKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPrv -&gt; k 'AccountK XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
key depth XPrv -&gt; key depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var">publicKey</span></a></span><span>
</span><span id="line-1599"></span><span>                    </span><span class="annot"><span class="annottext">(k 'AccountK XPrv -&gt; k 'AccountK XPub)
-&gt; k 'AccountK XPrv -&gt; k 'AccountK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; k 'RootK XPrv -&gt; Index 'Hardened 'AccountK -&gt; k 'AccountK XPrv
forall (key :: Depth -&gt; * -&gt; *).
HardDerivation key =&gt;
Passphrase &quot;encryption&quot;
-&gt; key 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; key 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var">deriveAccountPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682482085"><span class="hs-identifier hs-var">encrPass</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482084"><span class="hs-identifier hs-var">challengeKey</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span>
</span><span id="line-1600"></span><span>            </span><span id="local-6989586621682482081"><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482081"><span class="hs-identifier hs-var">storedPubKey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
-&gt; Handler (k 'AccountK XPub)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1601"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
 -&gt; Handler (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
-&gt; Handler (k 'AccountK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, GetAccount s k) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
</span><a href="Cardano.Wallet.html#readAccountPublicKey"><span class="hs-identifier hs-var">W.readAccountPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx (ApiLayer s k)
</span><a href="#local-6989586621682482096"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482100"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1602"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
</span><a href="#local-6989586621682482101"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482083"><span class="hs-identifier hs-var">challengPubKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; XPub -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
</span><a href="#local-6989586621682482101"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682482081"><span class="hs-identifier hs-var">storedPubKey</span></a></span><span>
</span><span id="line-1603"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1604"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT ErrUpdatePassphrase IO () -&gt; Handler ())
-&gt; ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; (k 'RootK XPrv, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
</span><a href="Cardano.Wallet.html#updateWalletPassphraseWithMnemonic"><span class="hs-identifier hs-var">W.updateWalletPassphraseWithMnemonic</span></a></span><span>
</span><span id="line-1605"></span><span>                        </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx (ApiLayer s k)
</span><a href="#local-6989586621682482096"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482100"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682482084"><span class="hs-identifier hs-var">challengeKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482086"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1607"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT ErrUpdatePassphrase IO () -&gt; Handler ())
-&gt; ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrUpdatePassphrase -&gt; ExceptT ErrUpdatePassphrase IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span>
</span><span id="line-1608"></span><span>                    </span><span class="annot"><span class="annottext">(ErrUpdatePassphrase -&gt; ExceptT ErrUpdatePassphrase IO ())
-&gt; ErrUpdatePassphrase -&gt; ExceptT ErrUpdatePassphrase IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrUpdatePassphrase
</span><a href="Cardano.Wallet.html#ErrUpdatePassphraseWithRootKey"><span class="hs-identifier hs-var">ErrUpdatePassphraseWithRootKey</span></a></span><span>
</span><span id="line-1609"></span><span>                    </span><span class="annot"><span class="annottext">(ErrWithRootKey -&gt; ErrUpdatePassphrase)
-&gt; ErrWithRootKey -&gt; ErrUpdatePassphrase
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ErrWithRootKey
</span><a href="Cardano.Wallet.html#ErrWithRootKeyWrongMnemonic"><span class="hs-identifier hs-var">ErrWithRootKeyWrongMnemonic</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482100"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1610"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1611"></span><span>        </span><span id="local-6989586621682483966"><span class="annot"><a href="#local-6989586621682482097"><span class="hs-identifier hs-type">withWrk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482105"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482104"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483966"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483966"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1612"></span><span>        </span><span id="local-6989586621682482097"><span class="annot"><span class="annottext">withWrk :: (WorkerCtx (ApiLayer s k) -&gt; Handler a) -&gt; Handler a
</span><a href="#local-6989586621682482097"><span class="hs-identifier hs-var hs-var">withWrk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler a)
-&gt; (ErrWalletNotResponding -&gt; Handler a)
-&gt; (WorkerCtx ctx -&gt; Handler a)
-&gt; Handler a
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482103"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482100"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler a
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler a
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span>
</span><span id="line-1613"></span><span>
</span><span id="line-1614"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putByronWalletPassphrase"><span class="hs-identifier hs-type">putByronWalletPassphrase</span></a></span><span>
</span><span id="line-1615"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482076"><span class="annot"><a href="#local-6989586621682482076"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482075"><span class="annot"><a href="#local-6989586621682482075"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482074"><span class="annot"><a href="#local-6989586621682482074"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1616"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482074"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1617"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682482076"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482075"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482074"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1618"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1619"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482076"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1620"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1621"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPutPassphraseData"><span class="hs-identifier hs-type">ByronWalletPutPassphraseData</span></a></span><span>
</span><span id="line-1622"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">NoContent</span></a></span><span>
</span><span id="line-1623"></span><span id="putByronWalletPassphrase"><span class="annot"><span class="annottext">putByronWalletPassphrase :: ctx
-&gt; ApiT WalletId
-&gt; ByronWalletPutPassphraseData
-&gt; Handler NoContent
</span><a href="Cardano.Wallet.Api.Server.html#putByronWalletPassphrase"><span class="hs-identifier hs-var hs-var">putByronWalletPassphrase</span></a></span></span><span> </span><span id="local-6989586621682482073"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482073"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482072"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482072"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682482071"><span class="annot"><span class="annottext">ByronWalletPutPassphraseData
</span><a href="#local-6989586621682482071"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1624"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ByronWalletPutPassphraseData"><span class="hs-identifier hs-type">ByronWalletPutPassphraseData</span></a></span><span> </span><span id="local-6989586621682482069"><span class="annot"><span class="annottext">Maybe (ApiT (Passphrase &quot;lenient&quot;))
</span><a href="#local-6989586621682482069"><span class="hs-identifier hs-var">oldM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482068"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482068"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByronWalletPutPassphraseData
</span><a href="#local-6989586621682482071"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1625"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482073"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482072"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482067"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482067"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrUpdatePassphrase IO () -&gt; Handler ())
-&gt; ExceptT ErrUpdatePassphrase IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1626"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482066"><span class="annot"><span class="annottext">old :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482066"><span class="hs-identifier hs-var hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
-&gt; (ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;user&quot;)
-&gt; Maybe (ApiT (Passphrase &quot;lenient&quot;))
-&gt; Passphrase &quot;user&quot;
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;)
-&gt; (ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;)
-&gt; ApiT (Passphrase &quot;lenient&quot;)
-&gt; Passphrase &quot;user&quot;
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT (Passphrase &quot;lenient&quot;))
</span><a href="#local-6989586621682482069"><span class="hs-identifier hs-var">oldM</span></a></span><span>
</span><span id="line-1627"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; (Passphrase &quot;user&quot;, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, WalletKey k) =&gt;
ctx
-&gt; WalletId
-&gt; (Passphrase &quot;user&quot;, Passphrase &quot;user&quot;)
-&gt; ExceptT ErrUpdatePassphrase IO ()
</span><a href="Cardano.Wallet.html#updateWalletPassphraseWithOldPassphrase"><span class="hs-identifier hs-var">W.updateWalletPassphraseWithOldPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482067"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482072"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482066"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682482068"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1628"></span><span>    </span><span class="annot"><span class="annottext">NoContent -&gt; Handler NoContent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">NoContent
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">NoContent</span></a></span><span>
</span><span id="line-1629"></span><span>
</span><span id="line-1630"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getUTxOsStatistics"><span class="hs-identifier hs-type">getUTxOsStatistics</span></a></span><span>
</span><span id="line-1631"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482065"><span class="annot"><a href="#local-6989586621682482065"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482064"><span class="annot"><a href="#local-6989586621682482064"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482063"><span class="annot"><a href="#local-6989586621682482063"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1632"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482065"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482064"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482063"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1633"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482065"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1635"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1636"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiUtxoStatistics"><span class="hs-identifier hs-type">ApiUtxoStatistics</span></a></span><span>
</span><span id="line-1637"></span><span id="getUTxOsStatistics"><span class="annot"><span class="annottext">getUTxOsStatistics :: ctx -&gt; ApiT WalletId -&gt; Handler ApiUtxoStatistics
</span><a href="Cardano.Wallet.Api.Server.html#getUTxOsStatistics"><span class="hs-identifier hs-var hs-var">getUTxOsStatistics</span></a></span></span><span> </span><span id="local-6989586621682482062"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482062"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482061"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482061"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1638"></span><span>    </span><span id="local-6989586621682482060"><span class="annot"><span class="annottext">UTxOStatistics
</span><a href="#local-6989586621682482060"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler UTxOStatistics)
-&gt; (ErrWalletNotResponding -&gt; Handler UTxOStatistics)
-&gt; (WorkerCtx ctx -&gt; Handler UTxOStatistics)
-&gt; Handler UTxOStatistics
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482062"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482061"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler UTxOStatistics
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler UTxOStatistics
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler UTxOStatistics)
 -&gt; Handler UTxOStatistics)
-&gt; (WorkerCtx ctx -&gt; Handler UTxOStatistics)
-&gt; Handler UTxOStatistics
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482059"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482059"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrListUTxOStatistics IO UTxOStatistics
-&gt; Handler UTxOStatistics
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrListUTxOStatistics IO UTxOStatistics
 -&gt; Handler UTxOStatistics)
-&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics
-&gt; Handler UTxOStatistics
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1639"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx -&gt; WalletId -&gt; ExceptT ErrListUTxOStatistics IO UTxOStatistics
</span><a href="Cardano.Wallet.html#listUtxoStatistics"><span class="hs-identifier hs-var">W.listUtxoStatistics</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482059"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482061"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1640"></span><span>    </span><span class="annot"><span class="annottext">ApiUtxoStatistics -&gt; Handler ApiUtxoStatistics
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiUtxoStatistics -&gt; Handler ApiUtxoStatistics)
-&gt; ApiUtxoStatistics -&gt; Handler ApiUtxoStatistics
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics -&gt; ApiUtxoStatistics
</span><a href="Cardano.Wallet.Api.Types.html#toApiUtxoStatistics"><span class="hs-identifier hs-var">toApiUtxoStatistics</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOStatistics
</span><a href="#local-6989586621682482060"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-1641"></span><span>
</span><span id="line-1642"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getWalletUtxoSnapshot"><span class="hs-identifier hs-type">getWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-1643"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482057"><span class="annot"><a href="#local-6989586621682482057"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482056"><span class="annot"><a href="#local-6989586621682482056"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482055"><span class="annot"><a href="#local-6989586621682482055"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682482057"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482056"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482055"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1644"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482057"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1645"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1646"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshot"><span class="hs-identifier hs-type">ApiWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-1647"></span><span id="getWalletUtxoSnapshot"><span class="annot"><span class="annottext">getWalletUtxoSnapshot :: ctx -&gt; ApiT WalletId -&gt; Handler ApiWalletUtxoSnapshot
</span><a href="Cardano.Wallet.Api.Server.html#getWalletUtxoSnapshot"><span class="hs-identifier hs-var hs-var">getWalletUtxoSnapshot</span></a></span></span><span> </span><span id="local-6989586621682482054"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482054"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482053"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482053"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1648"></span><span>    </span><span id="local-6989586621682482052"><span class="annot"><span class="annottext">[(TokenBundle, Coin)]
</span><a href="#local-6989586621682482052"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler [(TokenBundle, Coin)])
-&gt; (ErrWalletNotResponding -&gt; Handler [(TokenBundle, Coin)])
-&gt; (WorkerCtx ctx -&gt; Handler [(TokenBundle, Coin)])
-&gt; Handler [(TokenBundle, Coin)]
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482054"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482053"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler [(TokenBundle, Coin)]
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler [(TokenBundle, Coin)]
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler [(TokenBundle, Coin)])
 -&gt; Handler [(TokenBundle, Coin)])
-&gt; (WorkerCtx ctx -&gt; Handler [(TokenBundle, Coin)])
-&gt; Handler [(TokenBundle, Coin)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482051"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482051"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
-&gt; Handler [(TokenBundle, Coin)]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
 -&gt; Handler [(TokenBundle, Coin)])
-&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
-&gt; Handler [(TokenBundle, Coin)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1649"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx,
 HasTransactionLayer k ctx) =&gt;
ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO [(TokenBundle, Coin)]
</span><a href="Cardano.Wallet.html#getWalletUtxoSnapshot"><span class="hs-identifier hs-var">W.getWalletUtxoSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482051"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482053"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1650"></span><span>    </span><span class="annot"><span class="annottext">ApiWalletUtxoSnapshot -&gt; Handler ApiWalletUtxoSnapshot
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletUtxoSnapshot -&gt; Handler ApiWalletUtxoSnapshot)
-&gt; ApiWalletUtxoSnapshot -&gt; Handler ApiWalletUtxoSnapshot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(TokenBundle, Coin)] -&gt; ApiWalletUtxoSnapshot
</span><a href="#local-6989586621682482049"><span class="hs-identifier hs-var">mkApiWalletUtxoSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">[(TokenBundle, Coin)]
</span><a href="#local-6989586621682482052"><span class="hs-identifier hs-var">entries</span></a></span><span>
</span><span id="line-1651"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1652"></span><span>    </span><span class="annot"><a href="#local-6989586621682482049"><span class="hs-identifier hs-type">mkApiWalletUtxoSnapshot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshot"><span class="hs-identifier hs-type">ApiWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-1653"></span><span>    </span><span id="local-6989586621682482049"><span class="annot"><span class="annottext">mkApiWalletUtxoSnapshot :: [(TokenBundle, Coin)] -&gt; ApiWalletUtxoSnapshot
</span><a href="#local-6989586621682482049"><span class="hs-identifier hs-var hs-var">mkApiWalletUtxoSnapshot</span></a></span></span><span> </span><span id="local-6989586621682482048"><span class="annot"><span class="annottext">[(TokenBundle, Coin)]
</span><a href="#local-6989586621682482048"><span class="hs-identifier hs-var">bundleMinCoins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletUtxoSnapshot :: [ApiWalletUtxoSnapshotEntry] -&gt; ApiWalletUtxoSnapshot
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshot"><span class="hs-identifier hs-type">ApiWalletUtxoSnapshot</span></a></span><span>
</span><span id="line-1654"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:entries:ApiWalletUtxoSnapshot :: [ApiWalletUtxoSnapshotEntry]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aentries%3AApiWalletUtxoSnapshot"><span class="hs-identifier hs-var">entries</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenBundle, Coin) -&gt; ApiWalletUtxoSnapshotEntry
</span><a href="#local-6989586621682482045"><span class="hs-identifier hs-var">mkApiWalletUtxoSnapshotEntry</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenBundle, Coin) -&gt; ApiWalletUtxoSnapshotEntry)
-&gt; [(TokenBundle, Coin)] -&gt; [ApiWalletUtxoSnapshotEntry]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TokenBundle, Coin)]
</span><a href="#local-6989586621682482048"><span class="hs-identifier hs-var">bundleMinCoins</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span>    </span><span class="annot"><a href="#local-6989586621682482045"><span class="hs-identifier hs-type">mkApiWalletUtxoSnapshotEntry</span></a></span><span>
</span><span id="line-1657"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshotEntry"><span class="hs-identifier hs-type">ApiWalletUtxoSnapshotEntry</span></a></span><span>
</span><span id="line-1658"></span><span>    </span><span id="local-6989586621682482045"><span class="annot"><span class="annottext">mkApiWalletUtxoSnapshotEntry :: (TokenBundle, Coin) -&gt; ApiWalletUtxoSnapshotEntry
</span><a href="#local-6989586621682482045"><span class="hs-identifier hs-var hs-var">mkApiWalletUtxoSnapshotEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682482044"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482044"><span class="hs-identifier hs-var">bundle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482043"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482043"><span class="hs-identifier hs-var">minCoin</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletUtxoSnapshotEntry :: Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiWalletUtxoSnapshotEntry
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletUtxoSnapshotEntry"><span class="hs-identifier hs-type">ApiWalletUtxoSnapshotEntry</span></a></span><span>
</span><span id="line-1659"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:ada:ApiWalletUtxoSnapshotEntry :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aada%3AApiWalletUtxoSnapshotEntry"><span class="hs-identifier hs-var">ada</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; TokenBundle -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682482040"><span class="hs-var">#coin</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482044"><span class="hs-identifier hs-var">bundle</span></a></span><span>
</span><span id="line-1660"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:adaMinimum:ApiWalletUtxoSnapshotEntry :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AadaMinimum%3AApiWalletUtxoSnapshotEntry"><span class="hs-identifier hs-var">adaMinimum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682482043"><span class="hs-identifier hs-var">minCoin</span></a></span><span>
</span><span id="line-1661"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletUtxoSnapshotEntry :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiWalletUtxoSnapshotEntry"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenMap -&gt; ApiT TokenMap) -&gt; TokenMap -&gt; ApiT TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenMap -&gt; Const TokenMap TokenMap)
 -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenBundle -&gt; TokenMap
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682482037"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682482044"><span class="hs-identifier hs-var">bundle</span></a></span><span>
</span><span id="line-1662"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Coin Selections
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#selectCoins"><span class="hs-identifier hs-type">selectCoins</span></a></span><span>
</span><span id="line-1669"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682482036"><span class="annot"><a href="#local-6989586621682482036"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682482035"><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682482034"><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682482033"><span class="annot"><a href="#local-6989586621682482033"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1670"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682482036"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1671"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1672"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1673"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1674"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482033"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1676"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1677"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1678"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1679"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482036"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1681"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1682"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1683"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSelectCoinsPayments"><span class="hs-identifier hs-type">ApiSelectCoinsPayments</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482033"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1684"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482033"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span id="selectCoins"><span class="annot"><span class="annottext">selectCoins :: ctx
-&gt; ArgGenChange s
-&gt; ApiT WalletId
-&gt; ApiSelectCoinsPayments n
-&gt; Handler (ApiCoinSelection n)
</span><a href="Cardano.Wallet.Api.Server.html#selectCoins"><span class="hs-identifier hs-var hs-var">selectCoins</span></a></span></span><span> </span><span id="local-6989586621682482032"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482032"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682482031"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682482031"><span class="hs-identifier hs-var">genChange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682482030"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482030"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682482029"><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
</span><a href="#local-6989586621682482029"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1686"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482028"><span class="annot"><span class="annottext">md :: Maybe TxMetadata
</span><a href="#local-6989586621682482028"><span class="hs-identifier hs-var hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
</span><a href="#local-6989586621682482029"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; ApiSelectCoinsPayments n
    -&gt; Const (First TxMetadata) (ApiSelectCoinsPayments n))
-&gt; Maybe TxMetadata
forall s a.
s
-&gt; ((a -&gt; Const (First a) a) -&gt; s -&gt; Const (First a) s) -&gt; Maybe a
</span><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe (ApiT TxMetadata)
    -&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata)))
   -&gt; ApiSelectCoinsPayments n
   -&gt; Const (First TxMetadata) (ApiSelectCoinsPayments n))
(Maybe (ApiT TxMetadata)
 -&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata)))
-&gt; ApiSelectCoinsPayments n
-&gt; Const (First TxMetadata) (ApiSelectCoinsPayments n)
</span><a href="#local-6989586621682482027"><span class="hs-var">#metadata</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (ApiT TxMetadata)
  -&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata)))
 -&gt; ApiSelectCoinsPayments n
 -&gt; Const (First TxMetadata) (ApiSelectCoinsPayments n))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; Maybe (ApiT TxMetadata)
    -&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata)))
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; ApiSelectCoinsPayments n
-&gt; Const (First TxMetadata) (ApiSelectCoinsPayments n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TxMetadata -&gt; Const (First TxMetadata) (ApiT TxMetadata))
-&gt; Maybe (ApiT TxMetadata)
-&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxMetadata -&gt; Const (First TxMetadata) (ApiT TxMetadata))
 -&gt; Maybe (ApiT TxMetadata)
 -&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata)))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; ApiT TxMetadata -&gt; Const (First TxMetadata) (ApiT TxMetadata))
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; Maybe (ApiT TxMetadata)
-&gt; Const (First TxMetadata) (Maybe (ApiT TxMetadata))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
   -&gt; ApiT TxMetadata -&gt; Const (First TxMetadata) (ApiT TxMetadata))
(TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; ApiT TxMetadata -&gt; Const (First TxMetadata) (ApiT TxMetadata)
</span><a href="#local-6989586621682482025"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span>    </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-1689"></span><span>    </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-1690"></span><span>    </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-1691"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682482024"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682482024"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1692"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482033"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482032"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482030"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
</span><a href="#local-6989586621682482029"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
-&gt; ((Maybe ApiWithdrawalPostData
     -&gt; Const
          (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
    -&gt; ApiSelectCoinsPayments n
    -&gt; Const (Maybe ApiWithdrawalPostData) (ApiSelectCoinsPayments n))
-&gt; Maybe ApiWithdrawalPostData
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawal&quot;
  ((Maybe ApiWithdrawalPostData
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
   -&gt; ApiSelectCoinsPayments n
   -&gt; Const (Maybe ApiWithdrawalPostData) (ApiSelectCoinsPayments n))
(Maybe ApiWithdrawalPostData
 -&gt; Const
      (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
-&gt; ApiSelectCoinsPayments n
-&gt; Const (Maybe ApiWithdrawalPostData) (ApiSelectCoinsPayments n)
</span><a href="#local-6989586621682482022"><span class="hs-var">#withdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1693"></span><span>
</span><span id="line-1694"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiCoinSelection n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiCoinSelection n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
-&gt; Handler (ApiCoinSelection n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682482032"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482030"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiCoinSelection n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiCoinSelection n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
 -&gt; Handler (ApiCoinSelection n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
-&gt; Handler (ApiCoinSelection n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682482021"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682482021"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1695"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482020"><span class="annot"><span class="annottext">outs :: NonEmpty TxOut
</span><a href="#local-6989586621682482020"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall (n :: NetworkDiscriminant).
AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var">addressAmountToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n) -&gt; TxOut)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; NonEmpty TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
</span><a href="#local-6989586621682482029"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
-&gt; ((NonEmpty (AddressAmount (ApiT Address, Proxy n))
     -&gt; Const
          (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
          (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
    -&gt; ApiSelectCoinsPayments n
    -&gt; Const
         (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
         (ApiSelectCoinsPayments n))
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((NonEmpty (AddressAmount (ApiT Address, Proxy n))
    -&gt; Const
         (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
         (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
   -&gt; ApiSelectCoinsPayments n
   -&gt; Const
        (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
        (ApiSelectCoinsPayments n))
(NonEmpty (AddressAmount (ApiT Address, Proxy n))
 -&gt; Const
      (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
      (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
-&gt; ApiSelectCoinsPayments n
-&gt; Const
     (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
     (ApiSelectCoinsPayments n)
</span><a href="#local-6989586621682482018"><span class="hs-var">#payments</span></a></span><span>
</span><span id="line-1696"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482017"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682482017"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-1697"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682482024"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-1698"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:TransactionCtx :: Maybe TxMetadata
</span><a href="#local-6989586621682482015"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT TxMetadata -&gt; TxMetadata
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TxMetadata -&gt; TxMetadata)
-&gt; Maybe (ApiT TxMetadata) -&gt; Maybe TxMetadata
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
</span><a href="#local-6989586621682482029"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSelectCoinsPayments n
-&gt; ((Maybe (ApiT TxMetadata)
     -&gt; Const (Maybe (ApiT TxMetadata)) (Maybe (ApiT TxMetadata)))
    -&gt; ApiSelectCoinsPayments n
    -&gt; Const (Maybe (ApiT TxMetadata)) (ApiSelectCoinsPayments n))
-&gt; Maybe (ApiT TxMetadata)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe (ApiT TxMetadata)
    -&gt; Const (Maybe (ApiT TxMetadata)) (Maybe (ApiT TxMetadata)))
   -&gt; ApiSelectCoinsPayments n
   -&gt; Const (Maybe (ApiT TxMetadata)) (ApiSelectCoinsPayments n))
(Maybe (ApiT TxMetadata)
 -&gt; Const (Maybe (ApiT TxMetadata)) (Maybe (ApiT TxMetadata)))
-&gt; ApiSelectCoinsPayments n
-&gt; Const (Maybe (ApiT TxMetadata)) (ApiSelectCoinsPayments n)
</span><a href="#local-6989586621682482014"><span class="hs-var">#metadata</span></a></span><span>
</span><span id="line-1699"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1700"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682482013"><span class="annot"><span class="annottext">transform :: s
-&gt; Selection
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682482013"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621682482012"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682482012"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682482011"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682482011"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1701"></span><span>                </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">W.assignChangeAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682482031"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682482011"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682482012"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1702"></span><span>                </span><span class="annot"><span class="annottext">(SelectionOf TxOut, s)
-&gt; ((SelectionOf TxOut, s)
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionOf TxOut
 -&gt; s
 -&gt; UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (SelectionOf TxOut, s)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall s input output change withdrawal.
(IsOurs s Address, input ~ (TxIn, TxOut, NonEmpty DerivationIndex),
 output ~ TxOut, change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var">W.selectionToUnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682482017"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1703"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682482007"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682482007"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482006"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682482006"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682482005"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682482005"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1704"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482021"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682482030"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1705"></span><span>        </span><span id="local-6989586621682482003"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682482003"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482021"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1706"></span><span>        </span><span id="local-6989586621682482001"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682482001"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482021"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1707"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481999"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682481999"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-1708"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut
</span><a href="#local-6989586621682482020"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-1709"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
pendingTxs :: Set Tx
</span><a href="Cardano.Wallet.html#%24sel%3ApendingTxs%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-1710"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1711"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682482017"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-1712"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682482007"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-1713"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682482007"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-1714"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
wallet :: Wallet s
</span><a href="Cardano.Wallet.html#%24sel%3Awallet%3ASelectAssetsParams"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-1715"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-1716"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1717"></span><span>        </span><span id="local-6989586621682481985"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481985"><span class="hs-identifier hs-var">utx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrSelectAssets
  IO
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrSelectAssets
   IO
   (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
 -&gt; Handler
      (UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1718"></span><span>            </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams
     s
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (s
    -&gt; Selection
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482035"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682482034"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682482021"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682482001"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682482003"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682481999"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Selection
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682482013"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1719"></span><span>        </span><span class="annot"><span class="annottext">ApiCoinSelection n -&gt; Handler (ApiCoinSelection n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelection n -&gt; Handler (ApiCoinSelection n))
-&gt; ApiCoinSelection n -&gt; Handler (ApiCoinSelection n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant) input output change withdrawal.
(input ~ (TxIn, TxOut, NonEmpty DerivationIndex), output ~ TxOut,
 change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var">mkApiCoinSelection</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe (DelegationAction, NonEmpty DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682482028"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481985"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#selectCoinsForJoin"><span class="hs-identifier hs-type">selectCoinsForJoin</span></a></span><span>
</span><span id="line-1722"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481982"><span class="annot"><a href="#local-6989586621682481982"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481981"><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481980"><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682481979"><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1723"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1724"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481982"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1725"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier hs-type">DelegationAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1726"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1727"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1728"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1729"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1730"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1731"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481982"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1733"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1734"></span><span>       </span><span class="hs-comment">-- ^ Known pools</span><span>
</span><span id="line-1735"></span><span>       </span><span class="hs-comment">-- We could maybe replace this with a @IO (PoolId -&gt; Bool)@</span><span>
</span><span id="line-1736"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier hs-type">PoolLifeCycleStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1737"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-1738"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1739"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">Api.ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1740"></span><span id="selectCoinsForJoin"><span class="annot"><span class="annottext">selectCoinsForJoin :: ctx
-&gt; IO (Set PoolId)
-&gt; (PoolId -&gt; IO PoolLifeCycleStatus)
-&gt; PoolId
-&gt; WalletId
-&gt; Handler (ApiCoinSelection n)
</span><a href="Cardano.Wallet.Api.Server.html#selectCoinsForJoin"><span class="hs-identifier hs-var hs-var">selectCoinsForJoin</span></a></span></span><span> </span><span id="local-6989586621682481978"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481978"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481977"><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682481977"><span class="hs-identifier hs-var">knownPools</span></a></span></span><span> </span><span id="local-6989586621682481976"><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682481976"><span class="hs-identifier hs-var">getPoolStatus</span></a></span></span><span> </span><span id="local-6989586621682481975"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481975"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621682481974"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481974"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1741"></span><span>    </span><span id="local-6989586621682481973"><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682481973"><span class="hs-identifier hs-var">poolStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO PoolLifeCycleStatus -&gt; Handler PoolLifeCycleStatus
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682481976"><span class="hs-identifier hs-var">getPoolStatus</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481975"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span>    </span><span id="local-6989586621682481972"><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682481972"><span class="hs-identifier hs-var">pools</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set PoolId) -&gt; Handler (Set PoolId)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682481977"><span class="hs-identifier hs-var">knownPools</span></a></span><span>
</span><span id="line-1743"></span><span>    </span><span id="local-6989586621682481971"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682481971"><span class="hs-identifier hs-var">curEpoch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx -&gt; Handler EpochNo
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k) =&gt;
ctx -&gt; Handler EpochNo
</span><a href="Cardano.Wallet.Api.Server.html#getCurrentEpoch"><span class="hs-identifier hs-var">getCurrentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481978"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1744"></span><span>
</span><span id="line-1745"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiCoinSelection n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiCoinSelection n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
-&gt; Handler (ApiCoinSelection n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481978"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481974"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiCoinSelection n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiCoinSelection n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
 -&gt; Handler (ApiCoinSelection n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
-&gt; Handler (ApiCoinSelection n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481970"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1746"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481969"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481969"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481968"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481968"><span class="hs-identifier hs-var">deposit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1747"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
 -&gt; Handler (DelegationAction, Maybe Coin))
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
</span><a href="Cardano.Wallet.html#joinStakePool"><span class="hs-identifier hs-var">W.joinStakePool</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682481971"><span class="hs-identifier hs-var">curEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682481972"><span class="hs-identifier hs-var">pools</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481975"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682481973"><span class="hs-identifier hs-var">poolStatus</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481974"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1748"></span><span>
</span><span id="line-1749"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481966"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682481966"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-1750"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481969"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-1751"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1752"></span><span>
</span><span id="line-1753"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481964"><span class="annot"><span class="annottext">transform :: s
-&gt; Selection
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481964"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621682481963"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481963"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682481962"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481962"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1754"></span><span>                </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">W.assignChangeAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (network :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
DelegationAddress network key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
forall (key :: Depth -&gt; * -&gt; *).
DelegationAddress n key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#delegationAddress"><span class="hs-identifier hs-var">delegationAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481962"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481963"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1755"></span><span>                </span><span class="annot"><span class="annottext">(SelectionOf TxOut, s)
-&gt; ((SelectionOf TxOut, s)
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionOf TxOut
 -&gt; s
 -&gt; UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (SelectionOf TxOut, s)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall s input output change withdrawal.
(IsOurs s Address, input ~ (TxIn, TxOut, NonEmpty DerivationIndex),
 output ~ TxOut, change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var">W.selectionToUnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481966"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1756"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481960"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481960"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481959"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481959"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481958"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682481958"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1757"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481974"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1758"></span><span>        </span><span id="local-6989586621682481957"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481957"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1759"></span><span>        </span><span id="local-6989586621682481956"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481956"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1760"></span><span>
</span><span id="line-1761"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481955"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682481955"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-1762"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1763"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682481958"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-1764"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1765"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481966"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-1766"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481960"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-1767"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481960"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-1768"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682481959"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-1769"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-1770"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1771"></span><span>        </span><span id="local-6989586621682481954"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481954"><span class="hs-identifier hs-var">utx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrSelectAssets
  IO
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1772"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   ErrSelectAssets
   IO
   (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
 -&gt; Handler
      (UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams
     s
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (s
    -&gt; Selection
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481956"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481957"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682481955"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Selection
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481964"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1773"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481953"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481953"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount
  IO
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1774"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">W.readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481979"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481980"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481970"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481974"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481951"><span class="annot"><span class="annottext">deposits :: [Coin]
</span><a href="#local-6989586621682481951"><span class="hs-identifier hs-var hs-var">deposits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Coin -&gt; [Coin]
forall a. Maybe a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481968"><span class="hs-identifier hs-var">deposit</span></a></span><span>
</span><span id="line-1777"></span><span>
</span><span id="line-1778"></span><span>        </span><span class="annot"><span class="annottext">ApiCoinSelection n -&gt; Handler (ApiCoinSelection n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelection n -&gt; Handler (ApiCoinSelection n))
-&gt; ApiCoinSelection n -&gt; Handler (ApiCoinSelection n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant) input output change withdrawal.
(input ~ (TxIn, TxOut, NonEmpty DerivationIndex), output ~ TxOut,
 change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var">mkApiCoinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682481951"><span class="hs-identifier hs-var">deposits</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481969"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481953"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481954"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-1779"></span><span>
</span><span id="line-1780"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#selectCoinsForQuit"><span class="hs-identifier hs-type">selectCoinsForQuit</span></a></span><span>
</span><span id="line-1781"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481950"><span class="annot"><a href="#local-6989586621682481950"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481949"><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481948"><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682481947"><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1782"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1783"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481950"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1784"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier hs-type">DelegationAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1785"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1786"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1788"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1789"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1790"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1791"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1792"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1793"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481950"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1794"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1795"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">Api.ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1796"></span><span id="selectCoinsForQuit"><span class="annot"><span class="annottext">selectCoinsForQuit :: ctx -&gt; ApiT WalletId -&gt; Handler (ApiCoinSelection n)
</span><a href="Cardano.Wallet.Api.Server.html#selectCoinsForQuit"><span class="hs-identifier hs-var hs-var">selectCoinsForQuit</span></a></span></span><span> </span><span id="local-6989586621682481946"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481946"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481945"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481945"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1797"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiCoinSelection n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiCoinSelection n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
-&gt; Handler (ApiCoinSelection n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481946"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481945"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiCoinSelection n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiCoinSelection n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
 -&gt; Handler (ApiCoinSelection n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiCoinSelection n))
-&gt; Handler (ApiCoinSelection n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481944"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1798"></span><span>        </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-1799"></span><span>        </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-1800"></span><span>        </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-1801"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481943"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481943"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481942"><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682481942"><span class="hs-identifier hs-var">_mkRwdAcct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1802"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481946"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481945"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWithdrawalPostData -&gt; Maybe ApiWithdrawalPostData
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalPostData
</span><a href="Cardano.Wallet.Api.Types.html#SelfWithdrawal"><span class="hs-identifier hs-var">SelfWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1803"></span><span>        </span><span id="local-6989586621682481940"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481940"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrStakePoolDelegation IO DelegationAction
-&gt; Handler DelegationAction
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation IO DelegationAction
 -&gt; Handler DelegationAction)
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
-&gt; Handler DelegationAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
</span><a href="Cardano.Wallet.html#quitStakePool"><span class="hs-identifier hs-var">W.quitStakePool</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481945"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481943"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-1804"></span><span>
</span><span id="line-1805"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481938"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682481938"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-1806"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481940"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-1807"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481943"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-1808"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481937"><span class="annot"><span class="annottext">transform :: s
-&gt; Selection
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481937"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621682481936"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481936"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682481935"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481935"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1811"></span><span>                </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">W.assignChangeAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (network :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
DelegationAddress network key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
forall (key :: Depth -&gt; * -&gt; *).
DelegationAddress n key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#delegationAddress"><span class="hs-identifier hs-var">delegationAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481935"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481936"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1812"></span><span>                </span><span class="annot"><span class="annottext">(SelectionOf TxOut, s)
-&gt; ((SelectionOf TxOut, s)
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionOf TxOut
 -&gt; s
 -&gt; UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (SelectionOf TxOut, s)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall s input output change withdrawal.
(IsOurs s Address, input ~ (TxIn, TxOut, NonEmpty DerivationIndex),
 output ~ TxOut, change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var">W.selectionToUnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481938"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481934"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481934"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481933"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481933"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481932"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682481932"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1814"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481945"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1815"></span><span>        </span><span id="local-6989586621682481931"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481931"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1816"></span><span>        </span><span id="local-6989586621682481930"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481930"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1817"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481929"><span class="annot"><span class="annottext">refund :: Coin
</span><a href="#local-6989586621682481929"><span class="hs-identifier hs-var hs-var">refund</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481931"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1818"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481927"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682481927"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-1819"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1820"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682481932"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-1821"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1822"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481938"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-1823"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481934"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-1824"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481934"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-1825"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682481933"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-1826"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-1827"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1828"></span><span>        </span><span id="local-6989586621682481926"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481926"><span class="hs-identifier hs-var">utx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrSelectAssets
  IO
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-1829"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   ErrSelectAssets
   IO
   (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
 -&gt; Handler
      (UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams
     s
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (s
    -&gt; Selection
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481930"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481931"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex))
</span><a href="#local-6989586621682481927"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Selection
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481937"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1830"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481925"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481925"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount
  IO
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">W.readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481947"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481948"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682481944"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481945"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1831"></span><span>
</span><span id="line-1832"></span><span>        </span><span class="annot"><span class="annottext">ApiCoinSelection n -&gt; Handler (ApiCoinSelection n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelection n -&gt; Handler (ApiCoinSelection n))
-&gt; ApiCoinSelection n -&gt; Handler (ApiCoinSelection n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant) input output change withdrawal.
(input ~ (TxIn, TxOut, NonEmpty DerivationIndex), output ~ TxOut,
 change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var">mkApiCoinSelection</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481929"><span class="hs-identifier hs-var">refund</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481940"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481925"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481926"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-1833"></span><span>
</span><span id="line-1834"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                     Assets
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1837"></span><span>
</span><span id="line-1838"></span><span class="hs-keyword">data</span><span> </span><span id="ErrGetAsset"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrGetAsset"><span class="hs-identifier hs-var">ErrGetAsset</span></a></span></span><span>
</span><span id="line-1839"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="ErrGetAssetNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrGetAssetNoSuchWallet"><span class="hs-identifier hs-var">ErrGetAssetNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-1840"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="ErrGetAssetNotPresent"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrGetAssetNotPresent"><span class="hs-identifier hs-var">ErrGetAssetNotPresent</span></a></span></span><span>
</span><span id="line-1841"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481919"><span id="local-6989586621682481921"><span class="annot"><span class="annottext">ErrGetAsset -&gt; ErrGetAsset -&gt; Bool
(ErrGetAsset -&gt; ErrGetAsset -&gt; Bool)
-&gt; (ErrGetAsset -&gt; ErrGetAsset -&gt; Bool) -&gt; Eq ErrGetAsset
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrGetAsset -&gt; ErrGetAsset -&gt; Bool
$c/= :: ErrGetAsset -&gt; ErrGetAsset -&gt; Bool
== :: ErrGetAsset -&gt; ErrGetAsset -&gt; Bool
$c== :: ErrGetAsset -&gt; ErrGetAsset -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481913"><span id="local-6989586621682481915"><span id="local-6989586621682481917"><span class="annot"><span class="annottext">Int -&gt; ErrGetAsset -&gt; ShowS
[ErrGetAsset] -&gt; ShowS
ErrGetAsset -&gt; String
(Int -&gt; ErrGetAsset -&gt; ShowS)
-&gt; (ErrGetAsset -&gt; String)
-&gt; ([ErrGetAsset] -&gt; ShowS)
-&gt; Show ErrGetAsset
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrGetAsset] -&gt; ShowS
$cshowList :: [ErrGetAsset] -&gt; ShowS
show :: ErrGetAsset -&gt; String
$cshow :: ErrGetAsset -&gt; String
showsPrec :: Int -&gt; ErrGetAsset -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrGetAsset -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1842"></span><span>
</span><span id="line-1843"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrListAssets"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrListAssets"><span class="hs-identifier hs-var">ErrListAssets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ErrListAssetsNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrListAssetsNoSuchWallet"><span class="hs-identifier hs-var">ErrListAssetsNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span>
</span><span id="line-1844"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481908"><span id="local-6989586621682481910"><span class="annot"><span class="annottext">ErrListAssets -&gt; ErrListAssets -&gt; Bool
(ErrListAssets -&gt; ErrListAssets -&gt; Bool)
-&gt; (ErrListAssets -&gt; ErrListAssets -&gt; Bool) -&gt; Eq ErrListAssets
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrListAssets -&gt; ErrListAssets -&gt; Bool
$c/= :: ErrListAssets -&gt; ErrListAssets -&gt; Bool
== :: ErrListAssets -&gt; ErrListAssets -&gt; Bool
$c== :: ErrListAssets -&gt; ErrListAssets -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481902"><span id="local-6989586621682481904"><span id="local-6989586621682481906"><span class="annot"><span class="annottext">Int -&gt; ErrListAssets -&gt; ShowS
[ErrListAssets] -&gt; ShowS
ErrListAssets -&gt; String
(Int -&gt; ErrListAssets -&gt; ShowS)
-&gt; (ErrListAssets -&gt; String)
-&gt; ([ErrListAssets] -&gt; ShowS)
-&gt; Show ErrListAssets
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrListAssets] -&gt; ShowS
$cshowList :: [ErrListAssets] -&gt; ShowS
show :: ErrListAssets -&gt; String
$cshow :: ErrListAssets -&gt; String
showsPrec :: Int -&gt; ErrListAssets -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrListAssets -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span class="hs-comment">-- | All assets associated with this wallet, and their metadata (if metadata is</span><span>
</span><span id="line-1847"></span><span class="hs-comment">-- available). This list may include assets which have already been spent.</span><span>
</span><span id="line-1848"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listAssets"><span class="hs-identifier hs-type">listAssets</span></a></span><span>
</span><span id="line-1849"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481901"><span class="annot"><a href="#local-6989586621682481901"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481900"><span class="annot"><a href="#local-6989586621682481900"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481899"><span class="annot"><a href="#local-6989586621682481899"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1850"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481901"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481900"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481899"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1851"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481900"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1852"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasTokenMetadataClient"><span class="hs-identifier hs-type">HasTokenMetadataClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481901"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1853"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1854"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481901"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1855"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1856"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAsset"><span class="hs-identifier hs-type">ApiAsset</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1857"></span><span id="listAssets"><span class="annot"><span class="annottext">listAssets :: ctx -&gt; ApiT WalletId -&gt; Handler [ApiAsset]
</span><a href="Cardano.Wallet.Api.Server.html#listAssets"><span class="hs-identifier hs-var hs-var">listAssets</span></a></span></span><span> </span><span id="local-6989586621682481898"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481898"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481897"><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481897"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1858"></span><span>    </span><span id="local-6989586621682481896"><span class="annot"><span class="annottext">Set AssetId
</span><a href="#local-6989586621682481896"><span class="hs-identifier hs-var">assets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ApiLayer s k -&gt; ApiT WalletId -&gt; Handler (Set AssetId)
forall s (k :: Depth -&gt; * -&gt; *).
IsOurs s Address =&gt;
ApiLayer s k -&gt; ApiT WalletId -&gt; Handler (Set AssetId)
</span><a href="Cardano.Wallet.Api.Server.html#listAssetsBase"><span class="hs-identifier hs-var">listAssetsBase</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
ApiLayer s k
</span><a href="#local-6989586621682481898"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481897"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1859"></span><span>    </span><span class="annot"><span class="annottext">IO [ApiAsset] -&gt; Handler [ApiAsset]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [ApiAsset] -&gt; Handler [ApiAsset])
-&gt; IO [ApiAsset] -&gt; Handler [ApiAsset]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMetadataClient IO
-&gt; [AssetId]
-&gt; (Either TokenMetadataError (Maybe AssetMetadata)
    -&gt; AssetId -&gt; ApiAsset)
-&gt; IO [ApiAsset]
forall (t :: * -&gt; *) a.
(Foldable t, Functor t) =&gt;
TokenMetadataClient IO
-&gt; t AssetId
-&gt; (Either TokenMetadataError (Maybe AssetMetadata)
    -&gt; AssetId -&gt; a)
-&gt; IO (t a)
</span><a href="Cardano.Wallet.TokenMetadata.html#fillMetadata"><span class="hs-identifier hs-var">fillMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMetadataClient IO
</span><a href="#local-6989586621682481894"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set AssetId -&gt; [AssetId]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set AssetId
</span><a href="#local-6989586621682481896"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either TokenMetadataError (Maybe AssetMetadata)
-&gt; AssetId -&gt; ApiAsset
</span><a href="Cardano.Wallet.Api.Types.html#toApiAsset"><span class="hs-identifier hs-var">toApiAsset</span></a></span><span>
</span><span id="line-1860"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1861"></span><span>    </span><span id="local-6989586621682481894"><span class="annot"><span class="annottext">client :: TokenMetadataClient IO
</span><a href="#local-6989586621682481894"><span class="hs-identifier hs-var hs-var">client</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481898"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TokenMetadataClient IO
     -&gt; Const (TokenMetadataClient IO) (TokenMetadataClient IO))
    -&gt; ctx -&gt; Const (TokenMetadataClient IO) ctx)
-&gt; TokenMetadataClient IO
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenMetadataClient IO
 -&gt; Const (TokenMetadataClient IO) (TokenMetadataClient IO))
-&gt; ctx -&gt; Const (TokenMetadataClient IO) ctx
forall ctx.
HasTokenMetadataClient ctx =&gt;
Lens' ctx (TokenMetadataClient IO)
</span><a href="Cardano.Wallet.Api.html#tokenMetadataClient"><span class="hs-identifier hs-var">tokenMetadataClient</span></a></span><span>
</span><span id="line-1862"></span><span>
</span><span id="line-1863"></span><span class="hs-comment">-- | Return a list of all AssetIds involved in the transaction history of this</span><span>
</span><span id="line-1864"></span><span class="hs-comment">-- wallet.</span><span>
</span><span id="line-1865"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listAssetsBase"><span class="hs-identifier hs-type">listAssetsBase</span></a></span><span>
</span><span id="line-1866"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483807"><span class="annot"><a href="#local-6989586621682483807"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483806"><span class="annot"><a href="#local-6989586621682483806"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483807"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1867"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483807"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483806"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-type">AssetId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1868"></span><span id="listAssetsBase"><span class="annot"><span class="annottext">listAssetsBase :: ApiLayer s k -&gt; ApiT WalletId -&gt; Handler (Set AssetId)
</span><a href="Cardano.Wallet.Api.Server.html#listAssetsBase"><span class="hs-identifier hs-var hs-var">listAssetsBase</span></a></span></span><span> </span><span id="local-6989586621682481892"><span class="annot"><span class="annottext">ApiLayer s k
</span><a href="#local-6989586621682481892"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481891"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481891"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1869"></span><span>    </span><span class="annot"><span class="annottext">ApiLayer s k
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (Set AssetId))
-&gt; (ErrWalletNotResponding -&gt; Handler (Set AssetId))
-&gt; (WorkerCtx (ApiLayer s k) -&gt; Handler (Set AssetId))
-&gt; Handler (Set AssetId)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLayer s k
</span><a href="#local-6989586621682481892"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481891"><span class="hs-identifier hs-var">wallet</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (Set AssetId)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (Set AssetId)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx (ApiLayer s k) -&gt; Handler (Set AssetId))
 -&gt; Handler (Set AssetId))
-&gt; (WorkerCtx (ApiLayer s k) -&gt; Handler (Set AssetId))
-&gt; Handler (Set AssetId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481890"><span class="annot"><span class="annottext">WorkerCtx (ApiLayer s k)
</span><a href="#local-6989586621682481890"><span class="hs-identifier hs-var">wctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1870"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (Set AssetId) -&gt; Handler (Set AssetId)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Set AssetId) -&gt; Handler (Set AssetId))
-&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
-&gt; Handler (Set AssetId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
forall s (k :: Depth -&gt; * -&gt; *) ctx.
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO (Set AssetId)
</span><a href="Cardano.Wallet.html#listAssets"><span class="hs-identifier hs-var">W.listAssets</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx (ApiLayer s k)
</span><a href="#local-6989586621682481890"><span class="hs-identifier hs-var">wctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481891"><span class="hs-identifier hs-var">wallet</span></a></span><span>
</span><span id="line-1871"></span><span>
</span><span id="line-1872"></span><span class="hs-comment">-- | Look up a single asset and its metadata.</span><span>
</span><span id="line-1873"></span><span class="hs-comment">--</span><span>
</span><span id="line-1874"></span><span class="hs-comment">-- NOTE: This is slightly inefficient because it greps through the transaction</span><span>
</span><span id="line-1875"></span><span class="hs-comment">-- history to check if the asset is associated with this wallet.</span><span>
</span><span id="line-1876"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getAsset"><span class="hs-identifier hs-type">getAsset</span></a></span><span>
</span><span id="line-1877"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483778"><span class="annot"><a href="#local-6989586621682483778"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682483777"><span class="annot"><a href="#local-6989586621682483777"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483776"><span class="annot"><a href="#local-6989586621682483776"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1878"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682483778"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483777"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483776"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1879"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483777"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1880"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasTokenMetadataClient"><span class="hs-identifier hs-type">HasTokenMetadataClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483778"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1881"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483778"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1883"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1884"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier hs-type">TokenPolicyId</span></a></span><span>
</span><span id="line-1885"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenName"><span class="hs-identifier hs-type">TokenName</span></a></span><span>
</span><span id="line-1886"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAsset"><span class="hs-identifier hs-type">ApiAsset</span></a></span><span>
</span><span id="line-1887"></span><span id="getAsset"><span class="annot"><span class="annottext">getAsset :: ctx
-&gt; ApiT WalletId
-&gt; ApiT TokenPolicyId
-&gt; ApiT TokenName
-&gt; Handler ApiAsset
</span><a href="Cardano.Wallet.Api.Server.html#getAsset"><span class="hs-identifier hs-var hs-var">getAsset</span></a></span></span><span> </span><span id="local-6989586621682481888"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481888"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481887"><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481887"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481886"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481886"><span class="hs-identifier hs-var">policyId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481885"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481885"><span class="hs-identifier hs-var">assetName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1888"></span><span>    </span><span id="local-6989586621682481884"><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481884"><span class="hs-identifier hs-var">assetId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrGetAsset IO AssetId -&gt; Handler AssetId
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrGetAsset IO AssetId -&gt; Handler AssetId)
-&gt; (Set AssetId -&gt; ExceptT ErrGetAsset IO AssetId)
-&gt; Set AssetId
-&gt; Handler AssetId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Set AssetId -&gt; ExceptT ErrGetAsset IO AssetId
</span><a href="#local-6989586621682481883"><span class="hs-identifier hs-var">findAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(Set AssetId -&gt; Handler AssetId)
-&gt; Handler (Set AssetId) -&gt; Handler AssetId
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLayer s k -&gt; ApiT WalletId -&gt; Handler (Set AssetId)
forall s (k :: Depth -&gt; * -&gt; *).
IsOurs s Address =&gt;
ApiLayer s k -&gt; ApiT WalletId -&gt; Handler (Set AssetId)
</span><a href="Cardano.Wallet.Api.Server.html#listAssetsBase"><span class="hs-identifier hs-var">listAssetsBase</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
ApiLayer s k
</span><a href="#local-6989586621682481888"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481887"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-1889"></span><span>    </span><span class="annot"><span class="annottext">IO ApiAsset -&gt; Handler ApiAsset
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiAsset -&gt; Handler ApiAsset)
-&gt; IO ApiAsset -&gt; Handler ApiAsset
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Identity ApiAsset -&gt; ApiAsset
forall a. Identity a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">runIdentity</span></a></span><span> </span><span class="annot"><span class="annottext">(Identity ApiAsset -&gt; ApiAsset)
-&gt; IO (Identity ApiAsset) -&gt; IO ApiAsset
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMetadataClient IO
-&gt; Identity AssetId
-&gt; (Either TokenMetadataError (Maybe AssetMetadata)
    -&gt; AssetId -&gt; ApiAsset)
-&gt; IO (Identity ApiAsset)
forall (t :: * -&gt; *) a.
(Foldable t, Functor t) =&gt;
TokenMetadataClient IO
-&gt; t AssetId
-&gt; (Either TokenMetadataError (Maybe AssetMetadata)
    -&gt; AssetId -&gt; a)
-&gt; IO (t a)
</span><a href="Cardano.Wallet.TokenMetadata.html#fillMetadata"><span class="hs-identifier hs-var">fillMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMetadataClient IO
</span><a href="#local-6989586621682481880"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId -&gt; Identity AssetId
forall a. a -&gt; Identity a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Identity</span></a></span><span> </span><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481884"><span class="hs-identifier hs-var">assetId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either TokenMetadataError (Maybe AssetMetadata)
-&gt; AssetId -&gt; ApiAsset
</span><a href="Cardano.Wallet.Api.Types.html#toApiAsset"><span class="hs-identifier hs-var">toApiAsset</span></a></span><span>
</span><span id="line-1890"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1891"></span><span>    </span><span id="local-6989586621682481883"><span class="annot"><span class="annottext">findAsset :: Set AssetId -&gt; ExceptT ErrGetAsset IO AssetId
</span><a href="#local-6989586621682481883"><span class="hs-identifier hs-var hs-var">findAsset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrGetAsset IO AssetId
-&gt; (AssetId -&gt; ExceptT ErrGetAsset IO AssetId)
-&gt; Maybe AssetId
-&gt; ExceptT ErrGetAsset IO AssetId
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrGetAsset -&gt; ExceptT ErrGetAsset IO AssetId
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrGetAsset
</span><a href="Cardano.Wallet.Api.Server.html#ErrGetAssetNotPresent"><span class="hs-identifier hs-var">ErrGetAssetNotPresent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AssetId -&gt; ExceptT ErrGetAsset IO AssetId
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-1892"></span><span>        </span><span class="annot"><span class="annottext">(Maybe AssetId -&gt; ExceptT ErrGetAsset IO AssetId)
-&gt; (Set AssetId -&gt; Maybe AssetId)
-&gt; Set AssetId
-&gt; ExceptT ErrGetAsset IO AssetId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; Bool) -&gt; Set AssetId -&gt; Maybe AssetId
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.find</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId -&gt; AssetId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#AssetId"><span class="hs-identifier hs-var">AssetId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481886"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481885"><span class="hs-identifier hs-var">assetName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1893"></span><span>    </span><span id="local-6989586621682481880"><span class="annot"><span class="annottext">client :: TokenMetadataClient IO
</span><a href="#local-6989586621682481880"><span class="hs-identifier hs-var hs-var">client</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481888"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TokenMetadataClient IO
     -&gt; Const (TokenMetadataClient IO) (TokenMetadataClient IO))
    -&gt; ctx -&gt; Const (TokenMetadataClient IO) ctx)
-&gt; TokenMetadataClient IO
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenMetadataClient IO
 -&gt; Const (TokenMetadataClient IO) (TokenMetadataClient IO))
-&gt; ctx -&gt; Const (TokenMetadataClient IO) ctx
forall ctx.
HasTokenMetadataClient ctx =&gt;
Lens' ctx (TokenMetadataClient IO)
</span><a href="Cardano.Wallet.Api.html#tokenMetadataClient"><span class="hs-identifier hs-var">tokenMetadataClient</span></a></span><span>
</span><span id="line-1894"></span><span>
</span><span id="line-1895"></span><span class="hs-comment">-- | The handler for 'getAsset' when 'TokenName' is empty.</span><span>
</span><span id="line-1896"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getAssetDefault"><span class="hs-identifier hs-type">getAssetDefault</span></a></span><span>
</span><span id="line-1897"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481876"><span class="annot"><a href="#local-6989586621682481876"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481875"><span class="annot"><a href="#local-6989586621682481875"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481874"><span class="annot"><a href="#local-6989586621682481874"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1898"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481876"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481875"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481874"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1899"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481875"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-1900"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasTokenMetadataClient"><span class="hs-identifier hs-type">HasTokenMetadataClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481876"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1901"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1902"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481876"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1903"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1904"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#TokenPolicyId"><span class="hs-identifier hs-type">TokenPolicyId</span></a></span><span>
</span><span id="line-1905"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAsset"><span class="hs-identifier hs-type">ApiAsset</span></a></span><span>
</span><span id="line-1906"></span><span id="getAssetDefault"><span class="annot"><span class="annottext">getAssetDefault :: ctx -&gt; ApiT WalletId -&gt; ApiT TokenPolicyId -&gt; Handler ApiAsset
</span><a href="Cardano.Wallet.Api.Server.html#getAssetDefault"><span class="hs-identifier hs-var hs-var">getAssetDefault</span></a></span></span><span> </span><span id="local-6989586621682481873"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481873"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481872"><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481872"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682481871"><span class="annot"><span class="annottext">ApiT TokenPolicyId
</span><a href="#local-6989586621682481871"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ApiT WalletId
-&gt; ApiT TokenPolicyId
-&gt; ApiT TokenName
-&gt; Handler ApiAsset
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s Address,
 HasTokenMetadataClient ctx) =&gt;
ctx
-&gt; ApiT WalletId
-&gt; ApiT TokenPolicyId
-&gt; ApiT TokenName
-&gt; Handler ApiAsset
</span><a href="Cardano.Wallet.Api.Server.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481873"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481872"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenPolicyId
</span><a href="#local-6989586621682481871"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenName -&gt; ApiT TokenName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#nullTokenName"><span class="hs-identifier hs-var">nullTokenName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1907"></span><span>
</span><span id="line-1908"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                    Addresses
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1911"></span><span>
</span><span id="line-1912"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postRandomAddress"><span class="hs-identifier hs-type">postRandomAddress</span></a></span><span>
</span><span id="line-1913"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481870"><span class="annot"><a href="#local-6989586621682481870"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481869"><span class="annot"><a href="#local-6989586621682481869"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481868"><span class="annot"><a href="#local-6989586621682481868"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481867"><span class="annot"><a href="#local-6989586621682481867"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1914"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481869"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481867"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1915"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481868"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1916"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481870"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481869"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481868"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1917"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PaymentAddress"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481867"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1918"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1919"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481870"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1920"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1921"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostRandomAddressData"><span class="hs-identifier hs-type">ApiPostRandomAddressData</span></a></span><span>
</span><span id="line-1922"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAddress"><span class="hs-identifier hs-type">ApiAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481867"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1923"></span><span id="postRandomAddress"><span class="annot"><span class="annottext">postRandomAddress :: ctx
-&gt; ApiT WalletId
-&gt; ApiPostRandomAddressData
-&gt; Handler (ApiAddress n)
</span><a href="Cardano.Wallet.Api.Server.html#postRandomAddress"><span class="hs-identifier hs-var hs-var">postRandomAddress</span></a></span></span><span> </span><span id="local-6989586621682481866"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481866"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481865"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481865"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481864"><span class="annot"><span class="annottext">ApiPostRandomAddressData
</span><a href="#local-6989586621682481864"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1924"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481863"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481863"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;)
-&gt; Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;)
-&gt; ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPostRandomAddressData
</span><a href="#local-6989586621682481864"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPostRandomAddressData
-&gt; ((ApiT (Passphrase &quot;lenient&quot;)
     -&gt; Const
          (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
    -&gt; ApiPostRandomAddressData
    -&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiPostRandomAddressData)
-&gt; ApiT (Passphrase &quot;lenient&quot;)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const
         (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
   -&gt; ApiPostRandomAddressData
   -&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiPostRandomAddressData)
(ApiT (Passphrase &quot;lenient&quot;)
 -&gt; Const
      (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; ApiPostRandomAddressData
-&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiPostRandomAddressData
</span><a href="#local-6989586621682481862"><span class="hs-var">#passphrase</span></a></span><span>
</span><span id="line-1925"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481861"><span class="annot"><span class="annottext">mix :: Maybe (Index 'Hardened 'AddressK)
</span><a href="#local-6989586621682481861"><span class="hs-identifier hs-var hs-var">mix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT (Index 'Hardened 'AddressK) -&gt; Index 'Hardened 'AddressK
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT (Index 'Hardened 'AddressK) -&gt; Index 'Hardened 'AddressK)
-&gt; Maybe (ApiT (Index 'Hardened 'AddressK))
-&gt; Maybe (Index 'Hardened 'AddressK)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiPostRandomAddressData
</span><a href="#local-6989586621682481864"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPostRandomAddressData
-&gt; ((Maybe (ApiT (Index 'Hardened 'AddressK))
     -&gt; Const
          (Maybe (ApiT (Index 'Hardened 'AddressK)))
          (Maybe (ApiT (Index 'Hardened 'AddressK))))
    -&gt; ApiPostRandomAddressData
    -&gt; Const
         (Maybe (ApiT (Index 'Hardened 'AddressK)))
         ApiPostRandomAddressData)
-&gt; Maybe (ApiT (Index 'Hardened 'AddressK))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;addressIndex&quot;
  ((Maybe (ApiT (Index 'Hardened 'AddressK))
    -&gt; Const
         (Maybe (ApiT (Index 'Hardened 'AddressK)))
         (Maybe (ApiT (Index 'Hardened 'AddressK))))
   -&gt; ApiPostRandomAddressData
   -&gt; Const
        (Maybe (ApiT (Index 'Hardened 'AddressK)))
        ApiPostRandomAddressData)
(Maybe (ApiT (Index 'Hardened 'AddressK))
 -&gt; Const
      (Maybe (ApiT (Index 'Hardened 'AddressK)))
      (Maybe (ApiT (Index 'Hardened 'AddressK))))
-&gt; ApiPostRandomAddressData
-&gt; Const
     (Maybe (ApiT (Index 'Hardened 'AddressK))) ApiPostRandomAddressData
</span><a href="#local-6989586621682481860"><span class="hs-var">#addressIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1926"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481859"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481859"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481858"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481858"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (Address, NonEmpty DerivationIndex))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (Address, NonEmpty DerivationIndex))
-&gt; (WorkerCtx ctx -&gt; Handler (Address, NonEmpty DerivationIndex))
-&gt; Handler (Address, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481866"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481865"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (Address, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler (Address, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span>
</span><span id="line-1927"></span><span>        </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (Address, NonEmpty DerivationIndex))
 -&gt; Handler (Address, NonEmpty DerivationIndex))
-&gt; (WorkerCtx ctx -&gt; Handler (Address, NonEmpty DerivationIndex))
-&gt; Handler (Address, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481857"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481857"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
-&gt; Handler (Address, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
 -&gt; Handler (Address, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
-&gt; Handler (Address, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; Maybe (Index 'Hardened 'AddressK)
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasDBLayer IO s k ctx, PaymentAddress n k, RndStateLike s,
 k ~ ByronKey, AddressBookIso s) =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; Maybe (Index 'Hardened 'AddressK)
-&gt; ExceptT
     ErrCreateRandomAddress IO (Address, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#createRandomAddress"><span class="hs-identifier hs-var">W.createRandomAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481869"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481868"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481867"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
WorkerCtx ctx
</span><a href="#local-6989586621682481857"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481865"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481863"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Index 'Hardened 'AddressK)
</span><a href="#local-6989586621682481861"><span class="hs-identifier hs-var">mix</span></a></span><span>
</span><span id="line-1928"></span><span>    </span><span class="annot"><span class="annottext">ApiAddress n -&gt; Handler (ApiAddress n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; Handler (ApiAddress n))
-&gt; ApiAddress n -&gt; Handler (ApiAddress n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, AddressState, NonEmpty DerivationIndex) -&gt; ApiAddress n
</span><a href="#local-6989586621682481855"><span class="hs-identifier hs-var">coerceAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481859"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AddressState
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Unused"><span class="hs-identifier hs-var">Unused</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481858"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1929"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1930"></span><span>    </span><span id="local-6989586621682481855"><span class="annot"><span class="annottext">coerceAddress :: (Address, AddressState, NonEmpty DerivationIndex) -&gt; ApiAddress n
</span><a href="#local-6989586621682481855"><span class="hs-identifier hs-var hs-var">coerceAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481853"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481853"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481852"><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481852"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481851"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481851"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1931"></span><span>        </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; ApiT AddressState
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiAddress n
forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; ApiT AddressState
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiAddress n
</span><a href="Cardano.Wallet.Api.Types.html#ApiAddress"><span class="hs-identifier hs-var">ApiAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481853"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481867"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressState -&gt; ApiT AddressState
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481852"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481851"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1932"></span><span>
</span><span id="line-1933"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putRandomAddress"><span class="hs-identifier hs-type">putRandomAddress</span></a></span><span>
</span><span id="line-1934"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481848"><span class="annot"><a href="#local-6989586621682481848"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481847"><span class="annot"><a href="#local-6989586621682481847"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481846"><span class="annot"><a href="#local-6989586621682481846"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481845"><span class="annot"><a href="#local-6989586621682481845"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1935"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481847"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481845"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1936"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481846"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1937"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481848"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481847"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481846"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1938"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1939"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481848"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1940"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1941"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481845"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1942"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">NoContent</span></a></span><span>
</span><span id="line-1943"></span><span id="putRandomAddress"><span class="annot"><span class="annottext">putRandomAddress :: ctx
-&gt; ApiT WalletId -&gt; (ApiT Address, Proxy n) -&gt; Handler NoContent
</span><a href="Cardano.Wallet.Api.Server.html#putRandomAddress"><span class="hs-identifier hs-var hs-var">putRandomAddress</span></a></span></span><span> </span><span id="local-6989586621682481844"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481844"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481843"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481843"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481842"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481842"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481841"><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621682481841"><span class="hs-identifier hs-var">_proxy</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1944"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481844"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481843"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span>
</span><span id="line-1945"></span><span>        </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481840"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481840"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrImportRandomAddress IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrImportRandomAddress IO () -&gt; Handler ())
-&gt; ExceptT ErrImportRandomAddress IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
-&gt; WalletId -&gt; [Address] -&gt; ExceptT ErrImportRandomAddress IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, RndStateLike s, k ~ ByronKey,
 AddressBookIso s) =&gt;
ctx
-&gt; WalletId -&gt; [Address] -&gt; ExceptT ErrImportRandomAddress IO ()
</span><a href="Cardano.Wallet.html#importRandomAddresses"><span class="hs-identifier hs-var">W.importRandomAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481847"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481846"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
WorkerCtx ctx
</span><a href="#local-6989586621682481840"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481843"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481842"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1946"></span><span>    </span><span class="annot"><span class="annottext">NoContent -&gt; Handler NoContent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">NoContent
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">NoContent</span></a></span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#putRandomAddresses"><span class="hs-identifier hs-type">putRandomAddresses</span></a></span><span>
</span><span id="line-1949"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481838"><span class="annot"><a href="#local-6989586621682481838"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481837"><span class="annot"><a href="#local-6989586621682481837"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481836"><span class="annot"><a href="#local-6989586621682481836"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481835"><span class="annot"><a href="#local-6989586621682481835"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1950"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481837"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481835"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1951"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481836"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-1952"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481838"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481837"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481836"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1953"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1954"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481838"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1955"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1956"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPutAddressesData"><span class="hs-identifier hs-type">ApiPutAddressesData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481835"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1957"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">NoContent</span></a></span><span>
</span><span id="line-1958"></span><span id="putRandomAddresses"><span class="annot"><span class="annottext">putRandomAddresses :: ctx -&gt; ApiT WalletId -&gt; ApiPutAddressesData n -&gt; Handler NoContent
</span><a href="Cardano.Wallet.Api.Server.html#putRandomAddresses"><span class="hs-identifier hs-var hs-var">putRandomAddresses</span></a></span></span><span> </span><span id="local-6989586621682481834"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481834"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481833"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481833"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPutAddressesData"><span class="hs-identifier hs-type">ApiPutAddressesData</span></a></span><span> </span><span id="local-6989586621682481831"><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><a href="#local-6989586621682481831"><span class="hs-identifier hs-var">addrs</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1959"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481834"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481833"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span>
</span><span id="line-1960"></span><span>        </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481830"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481830"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrImportRandomAddress IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrImportRandomAddress IO () -&gt; Handler ())
-&gt; ExceptT ErrImportRandomAddress IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
-&gt; WalletId -&gt; [Address] -&gt; ExceptT ErrImportRandomAddress IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, RndStateLike s, k ~ ByronKey,
 AddressBookIso s) =&gt;
ctx
-&gt; WalletId -&gt; [Address] -&gt; ExceptT ErrImportRandomAddress IO ()
</span><a href="Cardano.Wallet.html#importRandomAddresses"><span class="hs-identifier hs-var">W.importRandomAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481837"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481836"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
WorkerCtx ctx
</span><a href="#local-6989586621682481830"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481833"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[Address]
</span><a href="#local-6989586621682481829"><span class="hs-identifier hs-var">addrs'</span></a></span><span>
</span><span id="line-1961"></span><span>    </span><span class="annot"><span class="annottext">NoContent -&gt; Handler NoContent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">NoContent
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">NoContent</span></a></span><span>
</span><span id="line-1962"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1963"></span><span>    </span><span id="local-6989586621682481829"><span class="annot"><span class="annottext">addrs' :: [Address]
</span><a href="#local-6989586621682481829"><span class="hs-identifier hs-var hs-var">addrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ApiT Address, Proxy n) -&gt; Address)
-&gt; [(ApiT Address, Proxy n)] -&gt; [Address]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT Address -&gt; Address
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address -&gt; Address)
-&gt; ((ApiT Address, Proxy n) -&gt; ApiT Address)
-&gt; (ApiT Address, Proxy n)
-&gt; Address
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n) -&gt; ApiT Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><a href="#local-6989586621682481831"><span class="hs-identifier hs-var">addrs</span></a></span><span>
</span><span id="line-1964"></span><span>
</span><span id="line-1965"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listAddresses"><span class="hs-identifier hs-type">listAddresses</span></a></span><span>
</span><span id="line-1966"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481828"><span class="annot"><a href="#local-6989586621682481828"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481827"><span class="annot"><a href="#local-6989586621682481827"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481826"><span class="annot"><a href="#local-6989586621682481826"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481825"><span class="annot"><a href="#local-6989586621682481825"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1967"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481828"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481827"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481826"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1968"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#CompareDiscovery"><span class="hs-identifier hs-type">CompareDiscovery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481827"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1969"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#KnownAddresses"><span class="hs-identifier hs-type">KnownAddresses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481827"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1970"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1971"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481828"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-1972"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682481827"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1973"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-1974"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#AddressState"><span class="hs-identifier hs-type">AddressState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1975"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiAddress"><span class="hs-identifier hs-type">ApiAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481825"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1976"></span><span id="listAddresses"><span class="annot"><span class="annottext">listAddresses :: ctx
-&gt; (s -&gt; Address -&gt; Maybe Address)
-&gt; ApiT WalletId
-&gt; Maybe (ApiT AddressState)
-&gt; Handler [ApiAddress n]
</span><a href="Cardano.Wallet.Api.Server.html#listAddresses"><span class="hs-identifier hs-var hs-var">listAddresses</span></a></span></span><span> </span><span id="local-6989586621682481824"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481824"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481823"><span class="annot"><span class="annottext">s -&gt; Address -&gt; Maybe Address
</span><a href="#local-6989586621682481823"><span class="hs-identifier hs-var">normalize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481822"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481822"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481821"><span class="annot"><span class="annottext">Maybe (ApiT AddressState)
</span><a href="#local-6989586621682481821"><span class="hs-identifier hs-var">stateFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1977"></span><span>    </span><span id="local-6989586621682481820"><span class="annot"><span class="annottext">[(Address, AddressState, NonEmpty DerivationIndex)]
</span><a href="#local-6989586621682481820"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; (ErrWalletNotResponding
    -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; (WorkerCtx ctx
    -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)]
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481824"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481822"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
-&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)]
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)]
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
 -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; (WorkerCtx ctx
    -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481819"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481819"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrNoSuchWallet
  IO
  [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet
   IO
   [(Address, AddressState, NonEmpty DerivationIndex)]
 -&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)])
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; Handler [(Address, AddressState, NonEmpty DerivationIndex)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1978"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; (s -&gt; Address -&gt; Maybe Address)
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, CompareDiscovery s, KnownAddresses s) =&gt;
ctx
-&gt; WalletId
-&gt; (s -&gt; Address -&gt; Maybe Address)
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     [(Address, AddressState, NonEmpty DerivationIndex)]
</span><a href="Cardano.Wallet.html#listAddresses"><span class="hs-identifier hs-var">W.listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481827"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481826"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481819"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481822"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Address -&gt; Maybe Address
</span><a href="#local-6989586621682481823"><span class="hs-identifier hs-var">normalize</span></a></span><span>
</span><span id="line-1979"></span><span>    </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Handler [ApiAddress n]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; Handler [ApiAddress n])
-&gt; [ApiAddress n] -&gt; Handler [ApiAddress n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, AddressState, NonEmpty DerivationIndex) -&gt; ApiAddress n
</span><a href="#local-6989586621682481817"><span class="hs-identifier hs-var">coerceAddress</span></a></span><span> </span><span class="annot"><span class="annottext">((Address, AddressState, NonEmpty DerivationIndex) -&gt; ApiAddress n)
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; [ApiAddress n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((Address, AddressState, NonEmpty DerivationIndex) -&gt; Bool)
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
-&gt; [(Address, AddressState, NonEmpty DerivationIndex)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, AddressState, NonEmpty DerivationIndex) -&gt; Bool
</span><a href="#local-6989586621682481816"><span class="hs-identifier hs-var">filterCondition</span></a></span><span> </span><span class="annot"><span class="annottext">[(Address, AddressState, NonEmpty DerivationIndex)]
</span><a href="#local-6989586621682481820"><span class="hs-identifier hs-var">addrs</span></a></span><span>
</span><span id="line-1980"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1981"></span><span>    </span><span class="annot"><a href="#local-6989586621682481816"><span class="hs-identifier hs-type">filterCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#AddressState"><span class="hs-identifier hs-type">AddressState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1982"></span><span>    </span><span id="local-6989586621682481816"><span class="annot"><span class="annottext">filterCondition :: (Address, AddressState, NonEmpty DerivationIndex) -&gt; Bool
</span><a href="#local-6989586621682481816"><span class="hs-identifier hs-var hs-var">filterCondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT AddressState)
</span><a href="#local-6989586621682481821"><span class="hs-identifier hs-var">stateFilter</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1983"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ApiT AddressState)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (Address, AddressState, NonEmpty DerivationIndex) -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1984"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481815"><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481815"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682481814"><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481814"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481814"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">AddressState -&gt; AddressState -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481815"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1985"></span><span>    </span><span id="local-6989586621682481817"><span class="annot"><span class="annottext">coerceAddress :: (Address, AddressState, NonEmpty DerivationIndex) -&gt; ApiAddress n
</span><a href="#local-6989586621682481817"><span class="hs-identifier hs-var hs-var">coerceAddress</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481813"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481813"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481812"><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481812"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481811"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481811"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1986"></span><span>        </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; ApiT AddressState
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiAddress n
forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; ApiT AddressState
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiAddress n
</span><a href="Cardano.Wallet.Api.Types.html#ApiAddress"><span class="hs-identifier hs-var">ApiAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481813"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481825"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressState -&gt; ApiT AddressState
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">AddressState
</span><a href="#local-6989586621682481812"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481811"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1987"></span><span>
</span><span id="line-1988"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                    Transactions
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-1991"></span><span>
</span><span id="line-1992"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#signTransaction"><span class="hs-identifier hs-type">signTransaction</span></a></span><span>
</span><span id="line-1993"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481810"><span class="annot"><a href="#local-6989586621682481810"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481809"><span class="annot"><a href="#local-6989586621682481809"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481808"><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1994"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481810"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481809"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1995"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1996"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1997"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481809"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1998"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1999"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2000"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481810"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2001"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2002"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSignTransactionPostData"><span class="hs-identifier hs-type">ApiSignTransactionPostData</span></a></span><span>
</span><span id="line-2003"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span>
</span><span id="line-2004"></span><span id="signTransaction"><span class="annot"><span class="annottext">signTransaction :: ctx
-&gt; ApiT WalletId
-&gt; ApiSignTransactionPostData
-&gt; Handler ApiSerialisedTransaction
</span><a href="Cardano.Wallet.Api.Server.html#signTransaction"><span class="hs-identifier hs-var hs-var">signTransaction</span></a></span></span><span> </span><span id="local-6989586621682481807"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481807"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481806"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481806"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481805"><span class="annot"><span class="annottext">ApiSignTransactionPostData
</span><a href="#local-6989586621682481805"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2005"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481804"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481804"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;)
-&gt; Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSignTransactionPostData
</span><a href="#local-6989586621682481805"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSignTransactionPostData
-&gt; ((Passphrase &quot;lenient&quot;
     -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
    -&gt; ApiSignTransactionPostData
    -&gt; Const (Passphrase &quot;lenient&quot;) ApiSignTransactionPostData)
-&gt; Passphrase &quot;lenient&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
   -&gt; ApiSignTransactionPostData
   -&gt; Const (Passphrase &quot;lenient&quot;) ApiSignTransactionPostData)
(ApiT (Passphrase &quot;lenient&quot;)
 -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; ApiSignTransactionPostData
-&gt; Const (Passphrase &quot;lenient&quot;) ApiSignTransactionPostData
</span><a href="#local-6989586621682481803"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;lenient&quot;)
  -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
 -&gt; ApiSignTransactionPostData
 -&gt; Const (Passphrase &quot;lenient&quot;) ApiSignTransactionPostData)
-&gt; ((Passphrase &quot;lenient&quot;
     -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
    -&gt; ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; (Passphrase &quot;lenient&quot;
    -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
-&gt; ApiSignTransactionPostData
-&gt; Const (Passphrase &quot;lenient&quot;) ApiSignTransactionPostData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;lenient&quot;
    -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
   -&gt; ApiT (Passphrase &quot;lenient&quot;)
   -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
(Passphrase &quot;lenient&quot;
 -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
-&gt; ApiT (Passphrase &quot;lenient&quot;)
-&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;))
</span><a href="#local-6989586621682481802"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span>    </span><span id="local-6989586621682481801"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481801"><span class="hs-identifier hs-var">sealedTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler SealedTx)
-&gt; (ErrWalletNotResponding -&gt; Handler SealedTx)
-&gt; (WorkerCtx ctx -&gt; Handler SealedTx)
-&gt; Handler SealedTx
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481807"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481806"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler SealedTx
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler SealedTx
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler SealedTx) -&gt; Handler SealedTx)
-&gt; (WorkerCtx ctx -&gt; Handler SealedTx) -&gt; Handler SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481800"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481800"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrWitnessTx IO SealedTx -&gt; Handler SealedTx
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWitnessTx IO SealedTx -&gt; Handler SealedTx)
-&gt; ExceptT ErrWitnessTx IO SealedTx -&gt; Handler SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2008"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-2009"></span><span>            </span><span id="local-6989586621682481799"><span class="annot"><span class="annottext">db :: DBLayer IO s k
</span><a href="#local-6989586621682481799"><span class="hs-identifier hs-var hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481800"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((DBLayer IO s k -&gt; Const (DBLayer IO s k) (DBLayer IO s k))
    -&gt; WalletLayer IO s k
    -&gt; Const (DBLayer IO s k) (WalletLayer IO s k))
-&gt; DBLayer IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBLayer IO s k ctx =&gt; Lens' ctx (DBLayer IO s k)
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBLayer m s k ctx =&gt;
Lens' ctx (DBLayer m s k)
</span><a href="Cardano.Wallet.html#dbLayer"><span class="hs-identifier hs-var">W.dbLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481809"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2010"></span><span>            </span><span id="local-6989586621682481797"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682481797"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481800"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; WalletLayer IO s k
    -&gt; Const (TransactionLayer k SealedTx) (WalletLayer IO s k))
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">W.transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2011"></span><span>            </span><span id="local-6989586621682481795"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682481795"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481800"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">W.networkLayer</span></a></span><span>
</span><span id="line-2012"></span><span>        </span><span class="annot"><span class="annottext">DBLayer IO s k
</span><a href="#local-6989586621682481799"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (DBLayer IO s k -&gt; ExceptT ErrWitnessTx IO SealedTx)
-&gt; ExceptT ErrWitnessTx IO SealedTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Cardano.Wallet.DB.html#DBLayer"><span class="hs-identifier hs-type">W.DBLayer</span></a></span><span class="hs-special">{</span><span id="local-6989586621682481793"><span class="annot"><span class="annottext">forall a. stm a -&gt; IO a
atomically :: ()
atomically :: forall a. stm a -&gt; IO a
</span><a href="Cardano.Wallet.DB.html#atomically"><span class="hs-identifier hs-var hs-var">atomically</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481791"><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
readCheckpoint :: ()
readCheckpoint :: WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="Cardano.Wallet.DB.html#readCheckpoint"><span class="hs-identifier hs-var hs-var">readCheckpoint</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2013"></span><span>            </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrWitnessTx)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme -&gt; ExceptT ErrWitnessTx IO SealedTx)
-&gt; ExceptT ErrWitnessTx IO SealedTx
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">W.withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481809"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481800"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481806"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481804"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrWitnessTx
</span><a href="Cardano.Wallet.html#ErrWitnessTxWithRootKey"><span class="hs-identifier hs-var">ErrWitnessTxWithRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme -&gt; ExceptT ErrWitnessTx IO SealedTx)
 -&gt; ExceptT ErrWitnessTx IO SealedTx)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme -&gt; ExceptT ErrWitnessTx IO SealedTx)
-&gt; ExceptT ErrWitnessTx IO SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481788"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682481788"><span class="hs-identifier hs-var">rootK</span></a></span></span><span> </span><span id="local-6989586621682481787"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682481787"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2014"></span><span>                </span><span id="local-6989586621682481786"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481786"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(stm (Either ErrWitnessTx (Wallet s))
 -&gt; IO (Either ErrWitnessTx (Wallet s)))
-&gt; ExceptT ErrWitnessTx stm (Wallet s)
-&gt; ExceptT ErrWitnessTx IO (Wallet s)
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">mapExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">stm (Either ErrWitnessTx (Wallet s))
-&gt; IO (Either ErrWitnessTx (Wallet s))
forall a. stm a -&gt; IO a
</span><a href="#local-6989586621682481793"><span class="hs-identifier hs-var">atomically</span></a></span><span>
</span><span id="line-2015"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT ErrWitnessTx stm (Wallet s)
 -&gt; ExceptT ErrWitnessTx IO (Wallet s))
-&gt; ExceptT ErrWitnessTx stm (Wallet s)
-&gt; ExceptT ErrWitnessTx IO (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrWitnessTx)
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrWitnessTx stm (Wallet s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrWitnessTx
</span><a href="Cardano.Wallet.html#ErrWitnessTxNoSuchWallet"><span class="hs-identifier hs-var">ErrWitnessTxNoSuchWallet</span></a></span><span>
</span><span id="line-2016"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet stm (Wallet s)
 -&gt; ExceptT ErrWitnessTx stm (Wallet s))
-&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
-&gt; ExceptT ErrWitnessTx stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall (m :: * -&gt; *) a.
Monad m =&gt;
WalletId -&gt; m (Maybe a) -&gt; ExceptT ErrNoSuchWallet m a
</span><a href="Cardano.Wallet.html#withNoSuchWallet"><span class="hs-identifier hs-var">W.withNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481806"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2017"></span><span>                    </span><span class="annot"><span class="annottext">(stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s))
-&gt; stm (Maybe (Wallet s)) -&gt; ExceptT ErrNoSuchWallet stm (Wallet s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; stm (Maybe (Wallet s))
</span><a href="#local-6989586621682481791"><span class="hs-identifier hs-var">readCheckpoint</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481806"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2018"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-2019"></span><span>                    </span><span class="annot"><a href="#local-6989586621682481783"><span class="hs-identifier hs-type">pwdP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-2020"></span><span>                    </span><span id="local-6989586621682481783"><span class="annot"><span class="annottext">pwdP :: Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682481783"><span class="hs-identifier hs-var hs-var">pwdP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682481787"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481804"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-2021"></span><span>
</span><span id="line-2022"></span><span>                    </span><span class="annot"><a href="#local-6989586621682481782"><span class="hs-identifier hs-type">utxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO.UTxO</span></a></span><span>
</span><span id="line-2023"></span><span>                    </span><span id="local-6989586621682481782"><span class="annot"><span class="annottext">utxo :: UTxO
</span><a href="#local-6989586621682481782"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. IsOurs s Address =&gt; Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#totalUTxO"><span class="hs-identifier hs-var">totalUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481786"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-2024"></span><span>
</span><span id="line-2025"></span><span>                    </span><span class="annot"><a href="#local-6989586621682481781"><span class="hs-identifier hs-type">keyLookup</span></a></span><span>
</span><span id="line-2026"></span><span>                        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2027"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682481808"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>                    </span><span id="local-6989586621682481781"><span class="annot"><span class="annottext">keyLookup :: Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682481781"><span class="hs-identifier hs-var hs-var">keyLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Address
-&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
forall s (key :: Depth -&gt; * -&gt; *).
IsOwned s key =&gt;
s
-&gt; (key 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Address
-&gt; Maybe (key 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#isOwned"><span class="hs-identifier hs-var">isOwned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481786"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682481788"><span class="hs-identifier hs-var">rootK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682481783"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span>                </span><span id="local-6989586621682481780"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481780"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; ExceptT ErrWitnessTx IO AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; ExceptT ErrWitnessTx IO AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; ExceptT ErrWitnessTx IO AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481795"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2031"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481779"><span class="annot"><span class="annottext">sealedTx :: SealedTx
</span><a href="#local-6989586621682481779"><span class="hs-identifier hs-var hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiSignTransactionPostData
</span><a href="#local-6989586621682481805"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSignTransactionPostData
-&gt; ((SealedTx -&gt; Const SealedTx SealedTx)
    -&gt; ApiSignTransactionPostData
    -&gt; Const SealedTx ApiSignTransactionPostData)
-&gt; SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const SealedTx (ApiT SealedTx))
   -&gt; ApiSignTransactionPostData
   -&gt; Const SealedTx ApiSignTransactionPostData)
(ApiT SealedTx -&gt; Const SealedTx (ApiT SealedTx))
-&gt; ApiSignTransactionPostData
-&gt; Const SealedTx ApiSignTransactionPostData
</span><a href="#local-6989586621682481778"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT SealedTx -&gt; Const SealedTx (ApiT SealedTx))
 -&gt; ApiSignTransactionPostData
 -&gt; Const SealedTx ApiSignTransactionPostData)
-&gt; ((SealedTx -&gt; Const SealedTx SealedTx)
    -&gt; ApiT SealedTx -&gt; Const SealedTx (ApiT SealedTx))
-&gt; (SealedTx -&gt; Const SealedTx SealedTx)
-&gt; ApiSignTransactionPostData
-&gt; Const SealedTx ApiSignTransactionPostData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((SealedTx -&gt; Const SealedTx SealedTx)
   -&gt; ApiT SealedTx -&gt; Const SealedTx (ApiT SealedTx))
(SealedTx -&gt; Const SealedTx SealedTx)
-&gt; ApiT SealedTx -&gt; Const SealedTx (ApiT SealedTx)
</span><a href="#local-6989586621682481777"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-2032"></span><span>                </span><span class="annot"><span class="annottext">SealedTx -&gt; ExceptT ErrWitnessTx IO SealedTx
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; ExceptT ErrWitnessTx IO SealedTx)
-&gt; SealedTx -&gt; ExceptT ErrWitnessTx IO SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; UTxO
-&gt; SealedTx
-&gt; SealedTx
forall (k :: Depth -&gt; * -&gt; *).
(WalletKey k, HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK)) =&gt;
TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; (Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; UTxO
-&gt; SealedTx
-&gt; SealedTx
</span><a href="Cardano.Wallet.html#signTransaction"><span class="hs-identifier hs-var">W.signTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682481797"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481780"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Maybe (k 'AddressK XPrv, Passphrase &quot;encryption&quot;)
</span><a href="#local-6989586621682481781"><span class="hs-identifier hs-var">keyLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682481788"><span class="hs-identifier hs-var">rootK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682481783"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682481782"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481779"><span class="hs-identifier hs-var">sealedTx</span></a></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span>    </span><span class="hs-comment">-- TODO: The body+witnesses seem redundant with the sealedTx already. What's</span><span>
</span><span id="line-2035"></span><span>    </span><span class="hs-comment">-- the use-case for having them provided separately? In the end, the client</span><span>
</span><span id="line-2036"></span><span>    </span><span class="hs-comment">-- should be able to decouple them if they need to.</span><span>
</span><span id="line-2037"></span><span>    </span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Handler ApiSerialisedTransaction
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Handler ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction -&gt; Handler ApiSerialisedTransaction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction :: ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">Api.ApiSerialisedTransaction</span></a></span><span>
</span><span id="line-2038"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:transaction:ApiSerialisedTransaction :: ApiT SealedTx
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atransaction%3AApiSerialisedTransaction"><span class="hs-identifier hs-var">transaction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; ApiT SealedTx
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481801"><span class="hs-identifier hs-var">sealedTx'</span></a></span><span>
</span><span id="line-2039"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2040"></span><span>
</span><span id="line-2041"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postTransactionOld"><span class="hs-identifier hs-type">postTransactionOld</span></a></span><span>
</span><span id="line-2042"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481773"><span class="annot"><a href="#local-6989586621682481773"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481772"><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481771"><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481770"><span class="annot"><a href="#local-6989586621682481770"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2043"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481773"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2044"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2045"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2046"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2047"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481773"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2048"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2049"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481770"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2050"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2051"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2052"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2053"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2054"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2055"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481773"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2056"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2057"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2058"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#PostTransactionOldData"><span class="hs-identifier hs-type">PostTransactionOldData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481770"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2059"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481770"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2060"></span><span id="postTransactionOld"><span class="annot"><span class="annottext">postTransactionOld :: ctx
-&gt; ArgGenChange s
-&gt; ApiT WalletId
-&gt; PostTransactionOldData n
-&gt; Handler (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#postTransactionOld"><span class="hs-identifier hs-var hs-var">postTransactionOld</span></a></span></span><span> </span><span id="local-6989586621682481769"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481769"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481768"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481768"><span class="hs-identifier hs-var">genChange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481767"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481766"><span class="annot"><span class="annottext">PostTransactionOldData n
</span><a href="#local-6989586621682481766"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2061"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481765"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481765"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;)
-&gt; Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
</span><a href="#local-6989586621682481766"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
-&gt; ((Passphrase &quot;lenient&quot;
     -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
    -&gt; PostTransactionOldData n
    -&gt; Const (Passphrase &quot;lenient&quot;) (PostTransactionOldData n))
-&gt; Passphrase &quot;lenient&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
   -&gt; PostTransactionOldData n
   -&gt; Const (Passphrase &quot;lenient&quot;) (PostTransactionOldData n))
(ApiT (Passphrase &quot;lenient&quot;)
 -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; PostTransactionOldData n
-&gt; Const (Passphrase &quot;lenient&quot;) (PostTransactionOldData n)
</span><a href="#local-6989586621682481764"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;lenient&quot;)
  -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
 -&gt; PostTransactionOldData n
 -&gt; Const (Passphrase &quot;lenient&quot;) (PostTransactionOldData n))
-&gt; ((Passphrase &quot;lenient&quot;
     -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
    -&gt; ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; (Passphrase &quot;lenient&quot;
    -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
-&gt; PostTransactionOldData n
-&gt; Const (Passphrase &quot;lenient&quot;) (PostTransactionOldData n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;lenient&quot;
    -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
   -&gt; ApiT (Passphrase &quot;lenient&quot;)
   -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
(Passphrase &quot;lenient&quot;
 -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
-&gt; ApiT (Passphrase &quot;lenient&quot;)
-&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;))
</span><a href="#local-6989586621682481763"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-2062"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481762"><span class="annot"><span class="annottext">outs :: NonEmpty TxOut
</span><a href="#local-6989586621682481762"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall (n :: NetworkDiscriminant).
AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var">addressAmountToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n) -&gt; TxOut)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; NonEmpty TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
</span><a href="#local-6989586621682481766"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
-&gt; ((NonEmpty (AddressAmount (ApiT Address, Proxy n))
     -&gt; Const
          (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
          (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
    -&gt; PostTransactionOldData n
    -&gt; Const
         (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
         (PostTransactionOldData n))
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((NonEmpty (AddressAmount (ApiT Address, Proxy n))
    -&gt; Const
         (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
         (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
   -&gt; PostTransactionOldData n
   -&gt; Const
        (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
        (PostTransactionOldData n))
(NonEmpty (AddressAmount (ApiT Address, Proxy n))
 -&gt; Const
      (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
      (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
-&gt; PostTransactionOldData n
-&gt; Const
     (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
     (PostTransactionOldData n)
</span><a href="#local-6989586621682481761"><span class="hs-var">#payments</span></a></span><span>
</span><span id="line-2063"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481760"><span class="annot"><span class="annottext">md :: Maybe TxMetadata
</span><a href="#local-6989586621682481760"><span class="hs-identifier hs-var hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
</span><a href="#local-6989586621682481766"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; PostTransactionOldData n
    -&gt; Const (First TxMetadata) (PostTransactionOldData n))
-&gt; Maybe TxMetadata
forall s a.
s
-&gt; ((a -&gt; Const (First a) a) -&gt; s -&gt; Const (First a) s) -&gt; Maybe a
</span><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
   -&gt; PostTransactionOldData n
   -&gt; Const (First TxMetadata) (PostTransactionOldData n))
(Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; PostTransactionOldData n
-&gt; Const (First TxMetadata) (PostTransactionOldData n)
</span><a href="#local-6989586621682481759"><span class="hs-var">#metadata</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe TxMetadataWithSchema
  -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
 -&gt; PostTransactionOldData n
 -&gt; Const (First TxMetadata) (PostTransactionOldData n))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; PostTransactionOldData n
-&gt; Const (First TxMetadata) (PostTransactionOldData n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadataWithSchema
 -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMetadataWithSchema
  -&gt; Const (First TxMetadata) TxMetadataWithSchema)
 -&gt; Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; TxMetadataWithSchema
    -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadataWithSchema_metadata&quot;
  ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
   -&gt; TxMetadataWithSchema
   -&gt; Const (First TxMetadata) TxMetadataWithSchema)
(TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; TxMetadataWithSchema
-&gt; Const (First TxMetadata) TxMetadataWithSchema
</span><a href="#local-6989586621682481758"><span class="hs-var">#txMetadataWithSchema_metadata</span></a></span><span>
</span><span id="line-2064"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481757"><span class="annot"><span class="annottext">mTTL :: Maybe NominalDiffTime
</span><a href="#local-6989586621682481757"><span class="hs-identifier hs-var hs-var">mTTL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
</span><a href="#local-6989586621682481766"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
-&gt; ((NominalDiffTime
     -&gt; Const (First NominalDiffTime) NominalDiffTime)
    -&gt; PostTransactionOldData n
    -&gt; Const (First NominalDiffTime) (PostTransactionOldData n))
-&gt; Maybe NominalDiffTime
forall s a.
s
-&gt; ((a -&gt; Const (First a) a) -&gt; s -&gt; Const (First a) s) -&gt; Maybe a
</span><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;timeToLive&quot;
  ((Maybe (Quantity &quot;second&quot; NominalDiffTime)
    -&gt; Const
         (First NominalDiffTime)
         (Maybe (Quantity &quot;second&quot; NominalDiffTime)))
   -&gt; PostTransactionOldData n
   -&gt; Const (First NominalDiffTime) (PostTransactionOldData n))
(Maybe (Quantity &quot;second&quot; NominalDiffTime)
 -&gt; Const
      (First NominalDiffTime)
      (Maybe (Quantity &quot;second&quot; NominalDiffTime)))
-&gt; PostTransactionOldData n
-&gt; Const (First NominalDiffTime) (PostTransactionOldData n)
</span><a href="#local-6989586621682481756"><span class="hs-var">#timeToLive</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (Quantity &quot;second&quot; NominalDiffTime)
  -&gt; Const
       (First NominalDiffTime)
       (Maybe (Quantity &quot;second&quot; NominalDiffTime)))
 -&gt; PostTransactionOldData n
 -&gt; Const (First NominalDiffTime) (PostTransactionOldData n))
-&gt; ((NominalDiffTime
     -&gt; Const (First NominalDiffTime) NominalDiffTime)
    -&gt; Maybe (Quantity &quot;second&quot; NominalDiffTime)
    -&gt; Const
         (First NominalDiffTime)
         (Maybe (Quantity &quot;second&quot; NominalDiffTime)))
-&gt; (NominalDiffTime
    -&gt; Const (First NominalDiffTime) NominalDiffTime)
-&gt; PostTransactionOldData n
-&gt; Const (First NominalDiffTime) (PostTransactionOldData n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity &quot;second&quot; NominalDiffTime
 -&gt; Const
      (First NominalDiffTime) (Quantity &quot;second&quot; NominalDiffTime))
-&gt; Maybe (Quantity &quot;second&quot; NominalDiffTime)
-&gt; Const
     (First NominalDiffTime) (Maybe (Quantity &quot;second&quot; NominalDiffTime))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;second&quot; NominalDiffTime
  -&gt; Const
       (First NominalDiffTime) (Quantity &quot;second&quot; NominalDiffTime))
 -&gt; Maybe (Quantity &quot;second&quot; NominalDiffTime)
 -&gt; Const
      (First NominalDiffTime)
      (Maybe (Quantity &quot;second&quot; NominalDiffTime)))
-&gt; ((NominalDiffTime
     -&gt; Const (First NominalDiffTime) NominalDiffTime)
    -&gt; Quantity &quot;second&quot; NominalDiffTime
    -&gt; Const
         (First NominalDiffTime) (Quantity &quot;second&quot; NominalDiffTime))
-&gt; (NominalDiffTime
    -&gt; Const (First NominalDiffTime) NominalDiffTime)
-&gt; Maybe (Quantity &quot;second&quot; NominalDiffTime)
-&gt; Const
     (First NominalDiffTime) (Maybe (Quantity &quot;second&quot; NominalDiffTime))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((NominalDiffTime -&gt; Const (First NominalDiffTime) NominalDiffTime)
   -&gt; Quantity &quot;second&quot; NominalDiffTime
   -&gt; Const
        (First NominalDiffTime) (Quantity &quot;second&quot; NominalDiffTime))
(NominalDiffTime -&gt; Const (First NominalDiffTime) NominalDiffTime)
-&gt; Quantity &quot;second&quot; NominalDiffTime
-&gt; Const
     (First NominalDiffTime) (Quantity &quot;second&quot; NominalDiffTime)
</span><a href="#local-6989586621682481755"><span class="hs-var">#getQuantity</span></a></span><span>
</span><span id="line-2065"></span><span>
</span><span id="line-2066"></span><span>    </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-2067"></span><span>    </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-2068"></span><span>    </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-2069"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481754"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481754"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481753"><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682481753"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2070"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481770"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481769"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PostTransactionOldData n
</span><a href="#local-6989586621682481766"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionOldData n
-&gt; ((Maybe ApiWithdrawalPostData
     -&gt; Const
          (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
    -&gt; PostTransactionOldData n
    -&gt; Const (Maybe ApiWithdrawalPostData) (PostTransactionOldData n))
-&gt; Maybe ApiWithdrawalPostData
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawal&quot;
  ((Maybe ApiWithdrawalPostData
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
   -&gt; PostTransactionOldData n
   -&gt; Const (Maybe ApiWithdrawalPostData) (PostTransactionOldData n))
(Maybe ApiWithdrawalPostData
 -&gt; Const
      (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
-&gt; PostTransactionOldData n
-&gt; Const (Maybe ApiWithdrawalPostData) (PostTransactionOldData n)
</span><a href="#local-6989586621682481752"><span class="hs-var">#withdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2071"></span><span>
</span><span id="line-2072"></span><span>    </span><span id="local-6989586621682481751"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481751"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlotNo -&gt; Handler SlotNo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlotNo -&gt; Handler SlotNo) -&gt; IO SlotNo -&gt; Handler SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481749"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621682481757"><span class="hs-identifier hs-var">mTTL</span></a></span><span>
</span><span id="line-2073"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481748"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682481748"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-2074"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481754"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-2075"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:TransactionCtx :: Maybe TxMetadata
</span><a href="#local-6989586621682482015"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481760"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-2076"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SlotNo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481751"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2077"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481746"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481746"><span class="hs-identifier hs-var">sel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481745"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481744"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682481744"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481743"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682481743"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481742"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481742"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (WorkerCtx ctx
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481769"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
 -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (WorkerCtx ctx
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481741"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2080"></span><span>        </span><span class="annot"><span class="annottext">Concierge IO WalletLock
-&gt; WalletLock
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall lock a.
Ord lock =&gt;
Concierge IO lock -&gt; lock -&gt; Handler a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#atomicallyWithHandler"><span class="hs-identifier hs-var">atomicallyWithHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481769"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((Concierge IO WalletLock
     -&gt; Const (Concierge IO WalletLock) (Concierge IO WalletLock))
    -&gt; ctx -&gt; Const (Concierge IO WalletLock) ctx)
-&gt; Concierge IO WalletLock
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Concierge IO WalletLock
 -&gt; Const (Concierge IO WalletLock) (Concierge IO WalletLock))
-&gt; ctx -&gt; Const (Concierge IO WalletLock) ctx
forall ctx.
HasType (Concierge IO WalletLock) ctx =&gt;
Lens' ctx (Concierge IO WalletLock)
</span><a href="Cardano.Wallet.Api.html#walletLocks"><span class="hs-identifier hs-var">walletLocks</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; WalletLock
</span><a href="Cardano.Wallet.Api.html#PostTransactionOld"><span class="hs-identifier hs-var">PostTransactionOld</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
 -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2081"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682481738"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481738"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481737"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481737"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481736"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682481736"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2082"></span><span>                </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2083"></span><span>            </span><span id="local-6989586621682481735"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481735"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2084"></span><span>            </span><span id="local-6989586621682481734"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481734"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2085"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481733"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams s Selection
</span><a href="#local-6989586621682481733"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-2086"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut
</span><a href="#local-6989586621682481762"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2087"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682481736"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-2088"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2089"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481748"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-2090"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2091"></span><span>                        </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481738"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2092"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2093"></span><span>                        </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481738"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2094"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682481737"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-2095"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-2096"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2097"></span><span>            </span><span id="local-6989586621682481732"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481732"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2098"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection)
-&gt; ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s Selection
-&gt; (s -&gt; Selection -&gt; Selection)
-&gt; ExceptT ErrSelectAssets IO Selection
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481734"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481735"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s Selection
</span><a href="#local-6989586621682481733"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span>
</span><span id="line-2099"></span><span>                </span><span class="annot"><span class="annottext">((s -&gt; Selection -&gt; Selection)
 -&gt; ExceptT ErrSelectAssets IO Selection)
-&gt; (s -&gt; Selection -&gt; Selection)
-&gt; ExceptT ErrSelectAssets IO Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Selection -&gt; Selection) -&gt; s -&gt; Selection -&gt; Selection
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; Selection
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-2100"></span><span>            </span><span id="local-6989586621682481731"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481731"><span class="hs-identifier hs-var">sel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2101"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (SelectionOf TxOut)
 -&gt; Handler (SelectionOf TxOut))
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(GenChange s, HasDBLayer IO s k ctx, AddressBookIso s) =&gt;
ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesAndUpdateDb"><span class="hs-identifier hs-var">W.assignChangeAddressesAndUpdateDb</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481768"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481732"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2102"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682481729"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481729"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481728"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682481728"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481727"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682481727"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481726"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481726"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2103"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
 -&gt; Handler (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; RewardAccountBuilder k
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasTransactionLayer k ctx, HasDBLayer IO s k ctx,
 HasNetworkLayer IO ctx, IsOwned s k) =&gt;
ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; ((k 'RootK XPrv, Passphrase &quot;encryption&quot;)
    -&gt; (XPrv, Passphrase &quot;encryption&quot;))
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
</span><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier hs-var">W.buildAndSignTransaction</span></a></span><span>
</span><span id="line-2104"></span><span>                    </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481734"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682481753"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682481765"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481748"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481731"><span class="hs-identifier hs-var">sel'</span></a></span><span>
</span><span id="line-2105"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2106"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasDBLayer IO s k ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
</span><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-var">W.submitTx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481771"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481741"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481767"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481729"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682481728"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481726"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2107"></span><span>            </span><span class="annot"><span class="annottext">(Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481732"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481729"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682481728"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682481727"><span class="hs-identifier hs-var">txTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481735"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2108"></span><span>
</span><span id="line-2109"></span><span>    </span><span class="annot"><span class="annottext">IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ApiTransaction n) -&gt; Handler (ApiTransaction n))
-&gt; IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
forall (n :: NetworkDiscriminant).
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-var">mkApiTransaction</span></a></span><span>
</span><span id="line-2110"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; TimeInterpreter (ExceptT PastHorizonException IO))
-&gt; NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481769"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
        #pendingSince
</span><span>        </span><span class="annot"><span class="annottext">(MkApiTransactionParams -&gt; IO (ApiTransaction n))
-&gt; MkApiTransactionParams -&gt; IO (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams :: Hash &quot;Tx&quot;
-&gt; Maybe Coin
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [TxOut]
-&gt; Maybe TxOut
-&gt; Map RewardAccount Coin
-&gt; TxMeta
-&gt; Maybe TxMetadata
-&gt; UTCTime
-&gt; Maybe TxScriptValidity
-&gt; Coin
-&gt; TxMetadataSchema
-&gt; MkApiTransactionParams
</span><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-type">MkApiTransactionParams</span></a></span><span>
</span><span id="line-2113"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txId:MkApiTransactionParams :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxId%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682481719"><span class="hs-var">#txId</span></a></span><span>
</span><span id="line-2114"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txFee:MkApiTransactionParams :: Maybe Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxFee%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; Tx -&gt; Const (Maybe Coin) Tx)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; Tx -&gt; Const (Maybe Coin) Tx)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; Tx -&gt; Const (Maybe Coin) Tx
</span><a href="#local-6989586621682481717"><span class="hs-var">#fee</span></a></span><span>
</span><span id="line-2115"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)])
-&gt; NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe TxOut) -&gt; (TxIn, TxOut) -&gt; (TxIn, Maybe TxOut)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Maybe TxOut
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; (TxIn, Maybe TxOut))
-&gt; NonEmpty (TxIn, TxOut) -&gt; NonEmpty (TxIn, Maybe TxOut)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481746"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
-&gt; ((NonEmpty (TxIn, TxOut)
     -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
    -&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection)
-&gt; NonEmpty (TxIn, TxOut)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection)
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection
</span><a href="#local-6989586621682481714"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-2116"></span><span>              </span><span class="hs-comment">-- TODO: ADP-957:</span><span>
</span><span id="line-2117"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2118"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txOutputs:MkApiTransactionParams :: [TxOut]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx
</span><a href="#local-6989586621682481711"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-2119"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralOutput:MkApiTransactionParams :: Maybe TxOut
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
    -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
-&gt; Maybe TxOut
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateralOutput&quot;
  ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
   -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
(Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
-&gt; Tx -&gt; Const (Maybe TxOut) Tx
</span><a href="#local-6989586621682481709"><span class="hs-var">#collateralOutput</span></a></span><span>
</span><span id="line-2120"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawals:MkApiTransactionParams :: Map RewardAccount Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx
</span><a href="#local-6989586621682481707"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-2121"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
$sel:txMeta:MkApiTransactionParams :: TxMeta
txMeta :: TxMeta
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMeta%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txMeta</span></a></span><span>
</span><span id="line-2122"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:MkApiTransactionParams :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxMetadata
     -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
    -&gt; Tx -&gt; Const (Maybe TxMetadata) Tx)
-&gt; Maybe TxMetadata
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadata -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
   -&gt; Tx -&gt; Const (Maybe TxMetadata) Tx)
(Maybe TxMetadata -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
-&gt; Tx -&gt; Const (Maybe TxMetadata) Tx
</span><a href="#local-6989586621682481704"><span class="hs-var">#metadata</span></a></span><span>
</span><span id="line-2123"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
$sel:txTime:MkApiTransactionParams :: UTCTime
txTime :: UTCTime
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxTime%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txTime</span></a></span><span>
</span><span id="line-2124"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txScriptValidity:MkApiTransactionParams :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481745"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxScriptValidity
     -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
    -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
-&gt; Maybe TxScriptValidity
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe TxScriptValidity
    -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
   -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
(Maybe TxScriptValidity
 -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
-&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx
</span><a href="#local-6989586621682481701"><span class="hs-var">#scriptValidity</span></a></span><span>
</span><span id="line-2125"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDeposit:MkApiTransactionParams :: Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txDeposit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481742"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2126"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadataSchema:MkApiTransactionParams :: TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadataSchema</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataDetailedSchema"><span class="hs-identifier hs-var">TxMetadataDetailedSchema</span></a></span><span>
</span><span id="line-2127"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2128"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2129"></span><span>    </span><span class="annot"><a href="#local-6989586621682481749"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2130"></span><span>    </span><span id="local-6989586621682481749"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481749"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481769"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#deleteTransaction"><span class="hs-identifier hs-type">deleteTransaction</span></a></span><span>
</span><span id="line-2133"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481697"><span class="annot"><a href="#local-6989586621682481697"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481696"><span class="annot"><a href="#local-6989586621682481696"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481695"><span class="annot"><a href="#local-6989586621682481695"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621682481697"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481696"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481695"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2134"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481697"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2135"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2136"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span>
</span><span id="line-2137"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">NoContent</span></a></span><span>
</span><span id="line-2138"></span><span id="deleteTransaction"><span class="annot"><span class="annottext">deleteTransaction :: ctx -&gt; ApiT WalletId -&gt; ApiTxId -&gt; Handler NoContent
</span><a href="Cardano.Wallet.Api.Server.html#deleteTransaction"><span class="hs-identifier hs-var hs-var">deleteTransaction</span></a></span></span><span> </span><span id="local-6989586621682481694"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481694"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481693"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481693"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481691"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481691"><span class="hs-identifier hs-var">tid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2139"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481694"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481693"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481690"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481690"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrRemoveTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrRemoveTx IO () -&gt; Handler ())
-&gt; ExceptT ErrRemoveTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2140"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx -&gt; WalletId -&gt; Hash &quot;Tx&quot; -&gt; ExceptT ErrRemoveTx IO ()
</span><a href="Cardano.Wallet.html#forgetTx"><span class="hs-identifier hs-var">W.forgetTx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481690"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481693"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481691"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-2141"></span><span>    </span><span class="annot"><span class="annottext">NoContent -&gt; Handler NoContent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">NoContent
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">NoContent</span></a></span><span>
</span><span id="line-2142"></span><span>
</span><span id="line-2143"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listTransactions"><span class="hs-identifier hs-type">listTransactions</span></a></span><span>
</span><span id="line-2144"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481688"><span class="annot"><a href="#local-6989586621682481688"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481687"><span class="annot"><a href="#local-6989586621682481687"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481686"><span class="annot"><a href="#local-6989586621682481686"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481685"><span class="annot"><a href="#local-6989586621682481685"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682481688"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481687"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481686"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2145"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481688"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2146"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2147"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#MinWithdrawal"><span class="hs-identifier hs-type">MinWithdrawal</span></a></span><span>
</span><span id="line-2148"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Iso8601Time"><span class="hs-identifier hs-type">Iso8601Time</span></a></span><span>
</span><span id="line-2149"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Iso8601Time"><span class="hs-identifier hs-type">Iso8601Time</span></a></span><span>
</span><span id="line-2150"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier hs-type">SortOrder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2151"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataSchema"><span class="hs-identifier hs-type">TxMetadataSchema</span></a></span><span>
</span><span id="line-2152"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481685"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2153"></span><span id="listTransactions"><span class="annot"><span class="annottext">listTransactions :: ctx
-&gt; ApiT WalletId
-&gt; Maybe MinWithdrawal
-&gt; Maybe Iso8601Time
-&gt; Maybe Iso8601Time
-&gt; Maybe (ApiT SortOrder)
-&gt; TxMetadataSchema
-&gt; Handler [ApiTransaction n]
</span><a href="Cardano.Wallet.Api.Server.html#listTransactions"><span class="hs-identifier hs-var hs-var">listTransactions</span></a></span></span><span>
</span><span id="line-2154"></span><span>    </span><span id="local-6989586621682481684"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481684"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481683"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481683"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481682"><span class="annot"><span class="annottext">Maybe MinWithdrawal
</span><a href="#local-6989586621682481682"><span class="hs-identifier hs-var">mMinWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682481681"><span class="annot"><span class="annottext">Maybe Iso8601Time
</span><a href="#local-6989586621682481681"><span class="hs-identifier hs-var">mStart</span></a></span></span><span> </span><span id="local-6989586621682481680"><span class="annot"><span class="annottext">Maybe Iso8601Time
</span><a href="#local-6989586621682481680"><span class="hs-identifier hs-var">mEnd</span></a></span></span><span> </span><span id="local-6989586621682481679"><span class="annot"><span class="annottext">Maybe (ApiT SortOrder)
</span><a href="#local-6989586621682481679"><span class="hs-identifier hs-var">mOrder</span></a></span></span><span> </span><span id="local-6989586621682481678"><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="#local-6989586621682481678"><span class="hs-identifier hs-var">metadataSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2155"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481677"><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682481677"><span class="hs-identifier hs-var">txs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481676"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481676"><span class="hs-identifier hs-var">depo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ([TransactionInfo], Coin))
-&gt; (ErrWalletNotResponding -&gt; Handler ([TransactionInfo], Coin))
-&gt; (WorkerCtx ctx -&gt; Handler ([TransactionInfo], Coin))
-&gt; Handler ([TransactionInfo], Coin)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481684"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481683"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ([TransactionInfo], Coin)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ([TransactionInfo], Coin)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ([TransactionInfo], Coin))
 -&gt; Handler ([TransactionInfo], Coin))
-&gt; (WorkerCtx ctx -&gt; Handler ([TransactionInfo], Coin))
-&gt; Handler ([TransactionInfo], Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481675"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481675"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2156"></span><span>            </span><span id="local-6989586621682481674"><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682481674"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrListTransactions IO [TransactionInfo]
-&gt; Handler [TransactionInfo]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrListTransactions IO [TransactionInfo]
 -&gt; Handler [TransactionInfo])
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
-&gt; Handler [TransactionInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2157"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; Maybe Coin
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; SortOrder
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe Coin
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; SortOrder
-&gt; ExceptT ErrListTransactions IO [TransactionInfo]
</span><a href="Cardano.Wallet.html#listTransactions"><span class="hs-identifier hs-var">W.listTransactions</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481675"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481683"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2158"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Coin)
-&gt; (MinWithdrawal -&gt; Natural) -&gt; MinWithdrawal -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural)
-&gt; (MinWithdrawal -&gt; Natural) -&gt; MinWithdrawal -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MinWithdrawal -&gt; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetMinWithdrawal%3AMinWithdrawal"><span class="hs-identifier hs-var hs-var">getMinWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">(MinWithdrawal -&gt; Coin) -&gt; Maybe MinWithdrawal -&gt; Maybe Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MinWithdrawal
</span><a href="#local-6989586621682481682"><span class="hs-identifier hs-var">mMinWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2159"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Iso8601Time -&gt; UTCTime
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetIso8601Time%3AIso8601Time"><span class="hs-identifier hs-var hs-var">getIso8601Time</span></a></span><span> </span><span class="annot"><span class="annottext">(Iso8601Time -&gt; UTCTime) -&gt; Maybe Iso8601Time -&gt; Maybe UTCTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Iso8601Time
</span><a href="#local-6989586621682481681"><span class="hs-identifier hs-var">mStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Iso8601Time -&gt; UTCTime
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetIso8601Time%3AIso8601Time"><span class="hs-identifier hs-var hs-var">getIso8601Time</span></a></span><span> </span><span class="annot"><span class="annottext">(Iso8601Time -&gt; UTCTime) -&gt; Maybe Iso8601Time -&gt; Maybe UTCTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Iso8601Time
</span><a href="#local-6989586621682481680"><span class="hs-identifier hs-var">mEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SortOrder
-&gt; (ApiT SortOrder -&gt; SortOrder)
-&gt; Maybe (ApiT SortOrder)
-&gt; SortOrder
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">SortOrder
</span><a href="#local-6989586621682481670"><span class="hs-identifier hs-var">defaultSortOrder</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SortOrder -&gt; SortOrder
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT SortOrder)
</span><a href="#local-6989586621682481679"><span class="hs-identifier hs-var">mOrder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>            </span><span id="local-6989586621682481669"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481669"><span class="hs-identifier hs-var">depo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Coin -&gt; Handler Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; Handler Coin) -&gt; IO Coin -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Coin) -&gt; IO ProtocolParameters -&gt; IO Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2163"></span><span>                </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481675"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>            </span><span class="annot"><span class="annottext">([TransactionInfo], Coin) -&gt; Handler ([TransactionInfo], Coin)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682481674"><span class="hs-identifier hs-var">txs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481669"><span class="hs-identifier hs-var">depo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2165"></span><span>        </span><span class="annot"><span class="annottext">IO [ApiTransaction n] -&gt; Handler [ApiTransaction n]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [ApiTransaction n] -&gt; Handler [ApiTransaction n])
-&gt; IO [ApiTransaction n] -&gt; Handler [ApiTransaction n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TransactionInfo]
-&gt; (TransactionInfo -&gt; IO (ApiTransaction n))
-&gt; IO [ApiTransaction n]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[TransactionInfo]
</span><a href="#local-6989586621682481677"><span class="hs-identifier hs-var">txs</span></a></span><span> </span><span class="annot"><span class="annottext">((TransactionInfo -&gt; IO (ApiTransaction n))
 -&gt; IO [ApiTransaction n])
-&gt; (TransactionInfo -&gt; IO (ApiTransaction n))
-&gt; IO [ApiTransaction n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481668"><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481668"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2166"></span><span>            </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Coin
-&gt; TransactionInfo
-&gt; TxMetadataSchema
-&gt; IO (ApiTransaction n)
forall (m :: * -&gt; *) (n :: NetworkDiscriminant).
MonadIO m =&gt;
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Coin
-&gt; TransactionInfo
-&gt; TxMetadataSchema
-&gt; m (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransactionFromInfo"><span class="hs-identifier hs-var">mkApiTransactionFromInfo</span></a></span><span>
</span><span id="line-2167"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481684"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2168"></span><span>                </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481676"><span class="hs-identifier hs-var">depo</span></a></span><span>
</span><span id="line-2169"></span><span>                </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481668"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2170"></span><span>                </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="#local-6989586621682481678"><span class="hs-identifier hs-var">metadataSchema</span></a></span><span>
</span><span id="line-2171"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2172"></span><span>    </span><span class="annot"><a href="#local-6989586621682481670"><span class="hs-identifier hs-type">defaultSortOrder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SortOrder"><span class="hs-identifier hs-type">SortOrder</span></a></span><span>
</span><span id="line-2173"></span><span>    </span><span id="local-6989586621682481670"><span class="annot"><span class="annottext">defaultSortOrder :: SortOrder
</span><a href="#local-6989586621682481670"><span class="hs-identifier hs-var hs-var">defaultSortOrder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SortOrder
</span><a href="Cardano.Wallet.Primitive.Types.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span>
</span><span id="line-2174"></span><span>
</span><span id="line-2175"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getTransaction"><span class="hs-identifier hs-type">getTransaction</span></a></span><span>
</span><span id="line-2176"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481665"><span class="annot"><a href="#local-6989586621682481665"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481664"><span class="annot"><a href="#local-6989586621682481664"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481663"><span class="annot"><a href="#local-6989586621682481663"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481662"><span class="annot"><a href="#local-6989586621682481662"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682481665"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481664"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481663"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2177"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481665"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2178"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2179"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span>
</span><span id="line-2180"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataSchema"><span class="hs-identifier hs-type">TxMetadataSchema</span></a></span><span>
</span><span id="line-2181"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481662"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2182"></span><span id="getTransaction"><span class="annot"><span class="annottext">getTransaction :: ctx
-&gt; ApiT WalletId
-&gt; ApiTxId
-&gt; TxMetadataSchema
-&gt; Handler (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#getTransaction"><span class="hs-identifier hs-var hs-var">getTransaction</span></a></span></span><span> </span><span id="local-6989586621682481661"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481661"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481660"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481660"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481659"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481659"><span class="hs-identifier hs-var">tid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481658"><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="#local-6989586621682481658"><span class="hs-identifier hs-var">metadataSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2183"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481657"><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481657"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481656"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481656"><span class="hs-identifier hs-var">depo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (TransactionInfo, Coin))
-&gt; (ErrWalletNotResponding -&gt; Handler (TransactionInfo, Coin))
-&gt; (WorkerCtx ctx -&gt; Handler (TransactionInfo, Coin))
-&gt; Handler (TransactionInfo, Coin)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481661"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481660"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (TransactionInfo, Coin)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (TransactionInfo, Coin)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (TransactionInfo, Coin))
 -&gt; Handler (TransactionInfo, Coin))
-&gt; (WorkerCtx ctx -&gt; Handler (TransactionInfo, Coin))
-&gt; Handler (TransactionInfo, Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481655"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481655"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2184"></span><span>        </span><span id="local-6989586621682481654"><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481654"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrGetTransaction IO TransactionInfo
-&gt; Handler TransactionInfo
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrGetTransaction IO TransactionInfo
 -&gt; Handler TransactionInfo)
-&gt; ExceptT ErrGetTransaction IO TransactionInfo
-&gt; Handler TransactionInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; ExceptT ErrGetTransaction IO TransactionInfo
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Hash &quot;Tx&quot;
-&gt; ExceptT ErrGetTransaction IO TransactionInfo
</span><a href="Cardano.Wallet.html#getTransaction"><span class="hs-identifier hs-var">W.getTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481655"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481660"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481659"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-2185"></span><span>        </span><span id="local-6989586621682481652"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481652"><span class="hs-identifier hs-var">depo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Coin -&gt; Handler Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; Handler Coin) -&gt; IO Coin -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Coin) -&gt; IO ProtocolParameters -&gt; IO Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2186"></span><span>            </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481655"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2187"></span><span>        </span><span class="annot"><span class="annottext">(TransactionInfo, Coin) -&gt; Handler (TransactionInfo, Coin)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481654"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481652"><span class="hs-identifier hs-var">depo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>    </span><span class="annot"><span class="annottext">IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span>
</span><span id="line-2189"></span><span>        </span><span class="annot"><span class="annottext">(IO (ApiTransaction n) -&gt; Handler (ApiTransaction n))
-&gt; IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Coin
-&gt; TransactionInfo
-&gt; TxMetadataSchema
-&gt; IO (ApiTransaction n)
forall (m :: * -&gt; *) (n :: NetworkDiscriminant).
MonadIO m =&gt;
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Coin
-&gt; TransactionInfo
-&gt; TxMetadataSchema
-&gt; m (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransactionFromInfo"><span class="hs-identifier hs-var">mkApiTransactionFromInfo</span></a></span><span>
</span><span id="line-2190"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481661"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481656"><span class="hs-identifier hs-var">depo</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481657"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2191"></span><span>            </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="#local-6989586621682481658"><span class="hs-identifier hs-var">metadataSchema</span></a></span><span>
</span><span id="line-2192"></span><span>
</span><span id="line-2193"></span><span class="hs-comment">-- Populate an API transaction record with 'TransactionInfo' from the wallet</span><span>
</span><span id="line-2194"></span><span class="hs-comment">-- layer.</span><span>
</span><span id="line-2195"></span><span id="local-6989586621682483648"><span id="local-6989586621682483649"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiTransactionFromInfo"><span class="hs-identifier hs-type">mkApiTransactionFromInfo</span></a></span><span>
</span><span id="line-2196"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483649"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2197"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2198"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-2199"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TransactionInfo"><span class="hs-identifier hs-type">TransactionInfo</span></a></span><span>
</span><span id="line-2200"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataSchema"><span class="hs-identifier hs-type">TxMetadataSchema</span></a></span><span>
</span><span id="line-2201"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483649"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483648"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-2202"></span><span id="mkApiTransactionFromInfo"><span class="annot"><span class="annottext">mkApiTransactionFromInfo :: TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Coin
-&gt; TransactionInfo
-&gt; TxMetadataSchema
-&gt; m (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransactionFromInfo"><span class="hs-identifier hs-var hs-var">mkApiTransactionFromInfo</span></a></span></span><span> </span><span id="local-6989586621682481651"><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481651"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682481650"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481650"><span class="hs-identifier hs-var">deposit</span></a></span></span><span> </span><span id="local-6989586621682481649"><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682481648"><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="#local-6989586621682481648"><span class="hs-identifier hs-var">metadataSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2203"></span><span>    </span><span id="local-6989586621682481647"><span class="annot"><span class="annottext">ApiTransaction n
</span><a href="#local-6989586621682481647"><span class="hs-identifier hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ApiTransaction n) -&gt; m (ApiTransaction n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ApiTransaction n) -&gt; m (ApiTransaction n))
-&gt; IO (ApiTransaction n) -&gt; m (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
forall (n :: NetworkDiscriminant).
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-var">mkApiTransaction</span></a></span><span>
</span><span id="line-2204"></span><span>        </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481651"><span class="hs-identifier hs-var">ti</span></a></span><span>
</span><span id="line-2205"></span><span>        </span><span class="annot"><span class="annottext">forall (n :: NetworkDiscriminant).
Lens' (ApiTransaction n) (Maybe ApiBlockReference)
Lens' (ApiTransaction n) (Maybe ApiBlockReference)
</span><a href="#local-6989586621682481646"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-2206"></span><span>        </span><span class="annot"><span class="annottext">MkApiTransactionParams :: Hash &quot;Tx&quot;
-&gt; Maybe Coin
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [TxOut]
-&gt; Maybe TxOut
-&gt; Map RewardAccount Coin
-&gt; TxMeta
-&gt; Maybe TxMetadata
-&gt; UTCTime
-&gt; Maybe TxScriptValidity
-&gt; Coin
-&gt; TxMetadataSchema
-&gt; MkApiTransactionParams
</span><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-type">MkApiTransactionParams</span></a></span><span>
</span><span id="line-2207"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txId:MkApiTransactionParams :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxId%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; TransactionInfo -&gt; Const (Hash &quot;Tx&quot;) TransactionInfo)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; TransactionInfo -&gt; Const (Hash &quot;Tx&quot;) TransactionInfo)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; TransactionInfo -&gt; Const (Hash &quot;Tx&quot;) TransactionInfo
</span><a href="#local-6989586621682481645"><span class="hs-var">#txInfoId</span></a></span><span>
</span><span id="line-2208"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txFee:MkApiTransactionParams :: Maybe Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxFee%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; TransactionInfo -&gt; Const (Maybe Coin) TransactionInfo)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoFee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; TransactionInfo -&gt; Const (Maybe Coin) TransactionInfo)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; TransactionInfo -&gt; Const (Maybe Coin) TransactionInfo
</span><a href="#local-6989586621682481644"><span class="hs-var">#txInfoFee</span></a></span><span>
</span><span id="line-2209"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; (([(TxIn, Coin, Maybe TxOut)]
     -&gt; Const [(TxIn, Coin, Maybe TxOut)] [(TxIn, Coin, Maybe TxOut)])
    -&gt; TransactionInfo
    -&gt; Const [(TxIn, Coin, Maybe TxOut)] TransactionInfo)
-&gt; [(TxIn, Coin, Maybe TxOut)]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoInputs&quot;
  (([(TxIn, Coin, Maybe TxOut)]
    -&gt; Const [(TxIn, Coin, Maybe TxOut)] [(TxIn, Coin, Maybe TxOut)])
   -&gt; TransactionInfo
   -&gt; Const [(TxIn, Coin, Maybe TxOut)] TransactionInfo)
([(TxIn, Coin, Maybe TxOut)]
 -&gt; Const [(TxIn, Coin, Maybe TxOut)] [(TxIn, Coin, Maybe TxOut)])
-&gt; TransactionInfo
-&gt; Const [(TxIn, Coin, Maybe TxOut)] TransactionInfo
</span><a href="#local-6989586621682481643"><span class="hs-var">#txInfoInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin, Maybe TxOut)]
-&gt; ((TxIn, Coin, Maybe TxOut) -&gt; (TxIn, Maybe TxOut))
-&gt; [(TxIn, Maybe TxOut)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Coin, Maybe TxOut) -&gt; (TxIn, Maybe TxOut)
forall a b b. (a, b, b) -&gt; (a, b)
</span><a href="#local-6989586621682481642"><span class="hs-identifier hs-var">drop2nd</span></a></span><span>
</span><span id="line-2210"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; (([(TxIn, Coin, Maybe TxOut)]
     -&gt; Const [(TxIn, Coin, Maybe TxOut)] [(TxIn, Coin, Maybe TxOut)])
    -&gt; TransactionInfo
    -&gt; Const [(TxIn, Coin, Maybe TxOut)] TransactionInfo)
-&gt; [(TxIn, Coin, Maybe TxOut)]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoCollateralInputs&quot;
  (([(TxIn, Coin, Maybe TxOut)]
    -&gt; Const [(TxIn, Coin, Maybe TxOut)] [(TxIn, Coin, Maybe TxOut)])
   -&gt; TransactionInfo
   -&gt; Const [(TxIn, Coin, Maybe TxOut)] TransactionInfo)
([(TxIn, Coin, Maybe TxOut)]
 -&gt; Const [(TxIn, Coin, Maybe TxOut)] [(TxIn, Coin, Maybe TxOut)])
-&gt; TransactionInfo
-&gt; Const [(TxIn, Coin, Maybe TxOut)] TransactionInfo
</span><a href="#local-6989586621682481641"><span class="hs-var">#txInfoCollateralInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin, Maybe TxOut)]
-&gt; ((TxIn, Coin, Maybe TxOut) -&gt; (TxIn, Maybe TxOut))
-&gt; [(TxIn, Maybe TxOut)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Coin, Maybe TxOut) -&gt; (TxIn, Maybe TxOut)
forall a b b. (a, b, b) -&gt; (a, b)
</span><a href="#local-6989586621682481642"><span class="hs-identifier hs-var">drop2nd</span></a></span><span>
</span><span id="line-2211"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txOutputs:MkApiTransactionParams :: [TxOut]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut])
    -&gt; TransactionInfo -&gt; Const [TxOut] TransactionInfo)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoOutputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; TransactionInfo -&gt; Const [TxOut] TransactionInfo)
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; TransactionInfo -&gt; Const [TxOut] TransactionInfo
</span><a href="#local-6989586621682481640"><span class="hs-var">#txInfoOutputs</span></a></span><span>
</span><span id="line-2212"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralOutput:MkApiTransactionParams :: Maybe TxOut
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
    -&gt; TransactionInfo -&gt; Const (Maybe TxOut) TransactionInfo)
-&gt; Maybe TxOut
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoCollateralOutput&quot;
  ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
   -&gt; TransactionInfo -&gt; Const (Maybe TxOut) TransactionInfo)
(Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
-&gt; TransactionInfo -&gt; Const (Maybe TxOut) TransactionInfo
</span><a href="#local-6989586621682481639"><span class="hs-var">#txInfoCollateralOutput</span></a></span><span>
</span><span id="line-2213"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawals:MkApiTransactionParams :: Map RewardAccount Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; TransactionInfo
    -&gt; Const (Map RewardAccount Coin) TransactionInfo)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoWithdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; TransactionInfo
   -&gt; Const (Map RewardAccount Coin) TransactionInfo)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; TransactionInfo
-&gt; Const (Map RewardAccount Coin) TransactionInfo
</span><a href="#local-6989586621682481638"><span class="hs-var">#txInfoWithdrawals</span></a></span><span>
</span><span id="line-2214"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMeta:MkApiTransactionParams :: TxMeta
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMeta%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMeta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((TxMeta -&gt; Const TxMeta TxMeta)
    -&gt; TransactionInfo -&gt; Const TxMeta TransactionInfo)
-&gt; TxMeta
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoMeta&quot;
  ((TxMeta -&gt; Const TxMeta TxMeta)
   -&gt; TransactionInfo -&gt; Const TxMeta TransactionInfo)
(TxMeta -&gt; Const TxMeta TxMeta)
-&gt; TransactionInfo -&gt; Const TxMeta TransactionInfo
</span><a href="#local-6989586621682481637"><span class="hs-var">#txInfoMeta</span></a></span><span>
</span><span id="line-2215"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:MkApiTransactionParams :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Maybe TxMetadata
     -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
    -&gt; TransactionInfo -&gt; Const (Maybe TxMetadata) TransactionInfo)
-&gt; Maybe TxMetadata
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoMetadata&quot;
  ((Maybe TxMetadata -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
   -&gt; TransactionInfo -&gt; Const (Maybe TxMetadata) TransactionInfo)
(Maybe TxMetadata -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
-&gt; TransactionInfo -&gt; Const (Maybe TxMetadata) TransactionInfo
</span><a href="#local-6989586621682481636"><span class="hs-var">#txInfoMetadata</span></a></span><span>
</span><span id="line-2216"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txTime:MkApiTransactionParams :: UTCTime
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxTime%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((UTCTime -&gt; Const UTCTime UTCTime)
    -&gt; TransactionInfo -&gt; Const UTCTime TransactionInfo)
-&gt; UTCTime
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoTime&quot;
  ((UTCTime -&gt; Const UTCTime UTCTime)
   -&gt; TransactionInfo -&gt; Const UTCTime TransactionInfo)
(UTCTime -&gt; Const UTCTime UTCTime)
-&gt; TransactionInfo -&gt; Const UTCTime TransactionInfo
</span><a href="#local-6989586621682481635"><span class="hs-var">#txInfoTime</span></a></span><span>
</span><span id="line-2217"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txScriptValidity:MkApiTransactionParams :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Maybe TxScriptValidity
     -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
    -&gt; TransactionInfo
    -&gt; Const (Maybe TxScriptValidity) TransactionInfo)
-&gt; Maybe TxScriptValidity
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoScriptValidity&quot;
  ((Maybe TxScriptValidity
    -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
   -&gt; TransactionInfo
   -&gt; Const (Maybe TxScriptValidity) TransactionInfo)
(Maybe TxScriptValidity
 -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
-&gt; TransactionInfo
-&gt; Const (Maybe TxScriptValidity) TransactionInfo
</span><a href="#local-6989586621682481634"><span class="hs-var">#txInfoScriptValidity</span></a></span><span>
</span><span id="line-2218"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDeposit:MkApiTransactionParams :: Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txDeposit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481650"><span class="hs-identifier hs-var">deposit</span></a></span><span>
</span><span id="line-2219"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadataSchema:MkApiTransactionParams :: TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadataSchema</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="#local-6989586621682481648"><span class="hs-identifier hs-var">metadataSchema</span></a></span><span>
</span><span id="line-2220"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2221"></span><span>    </span><span class="annot"><span class="annottext">ApiTransaction n -&gt; m (ApiTransaction n)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTransaction n -&gt; m (ApiTransaction n))
-&gt; ApiTransaction n -&gt; m (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((TxStatus -&gt; Const TxStatus TxStatus)
    -&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo)
-&gt; TxStatus
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoMeta&quot;
  ((TxMeta -&gt; Const TxStatus TxMeta)
   -&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo)
(TxMeta -&gt; Const TxStatus TxMeta)
-&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo
</span><a href="#local-6989586621682481633"><span class="hs-var">#txInfoMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const TxStatus TxMeta)
 -&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo)
-&gt; ((TxStatus -&gt; Const TxStatus TxStatus)
    -&gt; TxMeta -&gt; Const TxStatus TxMeta)
-&gt; (TxStatus -&gt; Const TxStatus TxStatus)
-&gt; TransactionInfo
-&gt; Const TxStatus TransactionInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((TxStatus -&gt; Const TxStatus TxStatus)
   -&gt; TxMeta -&gt; Const TxStatus TxMeta)
(TxStatus -&gt; Const TxStatus TxStatus)
-&gt; TxMeta -&gt; Const TxStatus TxMeta
</span><a href="#local-6989586621682481632"><span class="hs-var">#status</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2222"></span><span>        </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiTransaction n
</span><a href="#local-6989586621682481647"><span class="hs-identifier hs-var">apiTx</span></a></span><span>
</span><span id="line-2223"></span><span>        </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#InLedger"><span class="hs-identifier hs-var">InLedger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiTransaction n
</span><a href="#local-6989586621682481647"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:depth:ApiTransaction :: Maybe (Quantity &quot;block&quot; Natural)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adepth%3AApiTransaction"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Natural -&gt; Maybe (Quantity &quot;block&quot; Natural)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity &quot;block&quot; Natural -&gt; Maybe (Quantity &quot;block&quot; Natural))
-&gt; Quantity &quot;block&quot; Natural -&gt; Maybe (Quantity &quot;block&quot; Natural)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((Quantity &quot;block&quot; Natural
     -&gt; Const (Quantity &quot;block&quot; Natural) (Quantity &quot;block&quot; Natural))
    -&gt; TransactionInfo
    -&gt; Const (Quantity &quot;block&quot; Natural) TransactionInfo)
-&gt; Quantity &quot;block&quot; Natural
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoDepth&quot;
  ((Quantity &quot;block&quot; Natural
    -&gt; Const (Quantity &quot;block&quot; Natural) (Quantity &quot;block&quot; Natural))
   -&gt; TransactionInfo
   -&gt; Const (Quantity &quot;block&quot; Natural) TransactionInfo)
(Quantity &quot;block&quot; Natural
 -&gt; Const (Quantity &quot;block&quot; Natural) (Quantity &quot;block&quot; Natural))
-&gt; TransactionInfo
-&gt; Const (Quantity &quot;block&quot; Natural) TransactionInfo
</span><a href="#local-6989586621682481628"><span class="hs-var">#txInfoDepth</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2224"></span><span>        </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Expired"><span class="hs-identifier hs-var">Expired</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiTransaction n
</span><a href="#local-6989586621682481647"><span class="hs-identifier hs-var">apiTx</span></a></span><span>
</span><span id="line-2225"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2226"></span><span>    </span><span id="local-6989586621682481642"><span class="annot"><span class="annottext">drop2nd :: (a, b, b) -&gt; (a, b)
</span><a href="#local-6989586621682481642"><span class="hs-identifier hs-var hs-var">drop2nd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481626"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481626"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682481625"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682481625"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481626"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682481625"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span>    </span><span id="local-6989586621682483637"><span class="annot"><a href="#local-6989586621682481646"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483637"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier hs-type">ApiBlockReference</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2228"></span><span>    </span><span id="local-6989586621682481646"><span class="annot"><span class="annottext">status :: (Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682481646"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionInfo
</span><a href="#local-6989586621682481649"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionInfo
-&gt; ((TxStatus -&gt; Const TxStatus TxStatus)
    -&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo)
-&gt; TxStatus
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txInfoMeta&quot;
  ((TxMeta -&gt; Const TxStatus TxMeta)
   -&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo)
(TxMeta -&gt; Const TxStatus TxMeta)
-&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo
</span><a href="#local-6989586621682481624"><span class="hs-var">#txInfoMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const TxStatus TxMeta)
 -&gt; TransactionInfo -&gt; Const TxStatus TransactionInfo)
-&gt; ((TxStatus -&gt; Const TxStatus TxStatus)
    -&gt; TxMeta -&gt; Const TxStatus TxMeta)
-&gt; (TxStatus -&gt; Const TxStatus TxStatus)
-&gt; TransactionInfo
-&gt; Const TxStatus TransactionInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((TxStatus -&gt; Const TxStatus TxStatus)
   -&gt; TxMeta -&gt; Const TxStatus TxMeta)
(TxStatus -&gt; Const TxStatus TxStatus)
-&gt; TxMeta -&gt; Const TxStatus TxMeta
</span><a href="#local-6989586621682481623"><span class="hs-var">#status</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2229"></span><span>        </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;pendingSince&quot;
  ((Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682481622"><span class="hs-var">#pendingSince</span></a></span><span>
</span><span id="line-2230"></span><span>        </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#InLedger"><span class="hs-identifier hs-var">InLedger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;insertedAt&quot;
  ((Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682481621"><span class="hs-var">#insertedAt</span></a></span><span>
</span><span id="line-2231"></span><span>        </span><span class="annot"><span class="annottext">TxStatus
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Expired"><span class="hs-identifier hs-var">Expired</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;pendingSince&quot;
  ((Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682481620"><span class="hs-var">#pendingSince</span></a></span><span>
</span><span id="line-2232"></span><span>
</span><span id="line-2233"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postTransactionFeeOld"><span class="hs-identifier hs-type">postTransactionFeeOld</span></a></span><span>
</span><span id="line-2234"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481619"><span class="annot"><a href="#local-6989586621682481619"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481618"><span class="annot"><a href="#local-6989586621682481618"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481617"><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481616"><span class="annot"><a href="#local-6989586621682481616"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2235"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481619"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481618"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2236"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2237"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2238"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481616"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2239"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481618"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2240"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2241"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2242"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2243"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481619"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2244"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2245"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#PostTransactionFeeOldData"><span class="hs-identifier hs-type">PostTransactionFeeOldData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481616"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2246"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiFee"><span class="hs-identifier hs-type">ApiFee</span></a></span><span>
</span><span id="line-2247"></span><span id="postTransactionFeeOld"><span class="annot"><span class="annottext">postTransactionFeeOld :: ctx
-&gt; ApiT WalletId -&gt; PostTransactionFeeOldData n -&gt; Handler ApiFee
</span><a href="Cardano.Wallet.Api.Server.html#postTransactionFeeOld"><span class="hs-identifier hs-var hs-var">postTransactionFeeOld</span></a></span></span><span> </span><span id="local-6989586621682481615"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481615"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481614"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481614"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481613"><span class="annot"><span class="annottext">PostTransactionFeeOldData n
</span><a href="#local-6989586621682481613"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2248"></span><span>
</span><span id="line-2249"></span><span>    </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-2250"></span><span>    </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-2251"></span><span>    </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-2252"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481612"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481612"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481618"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481616"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481615"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481614"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PostTransactionFeeOldData n
</span><a href="#local-6989586621682481613"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionFeeOldData n
-&gt; ((Maybe ApiWithdrawalPostData
     -&gt; Const
          (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
    -&gt; PostTransactionFeeOldData n
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (PostTransactionFeeOldData n))
-&gt; Maybe ApiWithdrawalPostData
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawal&quot;
  ((Maybe ApiWithdrawalPostData
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
   -&gt; PostTransactionFeeOldData n
   -&gt; Const
        (Maybe ApiWithdrawalPostData) (PostTransactionFeeOldData n))
(Maybe ApiWithdrawalPostData
 -&gt; Const
      (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
-&gt; PostTransactionFeeOldData n
-&gt; Const
     (Maybe ApiWithdrawalPostData) (PostTransactionFeeOldData n)
</span><a href="#local-6989586621682481611"><span class="hs-var">#withdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2253"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481610"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682481610"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-2254"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481612"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-2255"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:TransactionCtx :: Maybe TxMetadata
</span><a href="#local-6989586621682482015"><span class="hs-identifier hs-var">txMetadata</span></a></span><span>
</span><span id="line-2256"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostTransactionFeeOldData n
</span><a href="#local-6989586621682481613"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionFeeOldData n
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; PostTransactionFeeOldData n
    -&gt; Const (First TxMetadata) (PostTransactionFeeOldData n))
-&gt; Maybe TxMetadata
forall s a.
s
-&gt; ((a -&gt; Const (First a) a) -&gt; s -&gt; Const (First a) s) -&gt; Maybe a
</span><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
   -&gt; PostTransactionFeeOldData n
   -&gt; Const (First TxMetadata) (PostTransactionFeeOldData n))
(Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; PostTransactionFeeOldData n
-&gt; Const (First TxMetadata) (PostTransactionFeeOldData n)
</span><a href="#local-6989586621682481609"><span class="hs-var">#metadata</span></a></span><span>
</span><span id="line-2257"></span><span>                </span><span class="annot"><span class="annottext">((Maybe TxMetadataWithSchema
  -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
 -&gt; PostTransactionFeeOldData n
 -&gt; Const (First TxMetadata) (PostTransactionFeeOldData n))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; PostTransactionFeeOldData n
-&gt; Const (First TxMetadata) (PostTransactionFeeOldData n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadataWithSchema
 -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span>
</span><span id="line-2258"></span><span>                </span><span class="annot"><span class="annottext">((TxMetadataWithSchema
  -&gt; Const (First TxMetadata) TxMetadataWithSchema)
 -&gt; Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; TxMetadataWithSchema
    -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadataWithSchema_metadata&quot;
  ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
   -&gt; TxMetadataWithSchema
   -&gt; Const (First TxMetadata) TxMetadataWithSchema)
(TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; TxMetadataWithSchema
-&gt; Const (First TxMetadata) TxMetadataWithSchema
</span><a href="#local-6989586621682481608"><span class="hs-var">#txMetadataWithSchema_metadata</span></a></span><span>
</span><span id="line-2259"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2260"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ApiFee)
-&gt; (ErrWalletNotResponding -&gt; Handler ApiFee)
-&gt; (WorkerCtx ctx -&gt; Handler ApiFee)
-&gt; Handler ApiFee
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481615"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481614"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ApiFee
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ApiFee
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ApiFee) -&gt; Handler ApiFee)
-&gt; (WorkerCtx ctx -&gt; Handler ApiFee) -&gt; Handler ApiFee
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481607"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481607"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2261"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481606"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481606"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481605"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481605"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481604"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682481604"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2262"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481618"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481607"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481614"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2263"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481603"><span class="annot"><span class="annottext">outs :: NonEmpty TxOut
</span><a href="#local-6989586621682481603"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall (n :: NetworkDiscriminant).
AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var">addressAmountToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n) -&gt; TxOut)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; NonEmpty TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionFeeOldData n
</span><a href="#local-6989586621682481613"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PostTransactionFeeOldData n
-&gt; ((NonEmpty (AddressAmount (ApiT Address, Proxy n))
     -&gt; Const
          (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
          (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
    -&gt; PostTransactionFeeOldData n
    -&gt; Const
         (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
         (PostTransactionFeeOldData n))
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((NonEmpty (AddressAmount (ApiT Address, Proxy n))
    -&gt; Const
         (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
         (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
   -&gt; PostTransactionFeeOldData n
   -&gt; Const
        (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
        (PostTransactionFeeOldData n))
(NonEmpty (AddressAmount (ApiT Address, Proxy n))
 -&gt; Const
      (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
      (NonEmpty (AddressAmount (ApiT Address, Proxy n))))
-&gt; PostTransactionFeeOldData n
-&gt; Const
     (NonEmpty (AddressAmount (ApiT Address, Proxy n)))
     (PostTransactionFeeOldData n)
</span><a href="#local-6989586621682481602"><span class="hs-var">#payments</span></a></span><span>
</span><span id="line-2264"></span><span>        </span><span id="local-6989586621682481601"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481601"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481607"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2265"></span><span>        </span><span id="local-6989586621682481600"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481600"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481607"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2266"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481599"><span class="annot"><span class="annottext">getFee :: b -&gt; Selection -&gt; Coin
</span><a href="#local-6989586621682481599"><span class="hs-identifier hs-var hs-var">getFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Selection -&gt; Coin) -&gt; b -&gt; Selection -&gt; Coin
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; Selection -&gt; Coin
forall change. (change -&gt; Coin) -&gt; SelectionOf change -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#selectionDelta"><span class="hs-identifier hs-var">selectionDelta</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2267"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481598"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams s Coin
</span><a href="#local-6989586621682481598"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-2268"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut
</span><a href="#local-6989586621682481603"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2269"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682481604"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-2270"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2271"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481610"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-2272"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481606"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2273"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481606"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2274"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682481605"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-2275"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-2276"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-2277"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481597"><span class="annot"><span class="annottext">runSelection :: ExceptT ErrSelectAssets IO Coin
</span><a href="#local-6989586621682481597"><span class="hs-identifier hs-var hs-var">runSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2278"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s Coin
-&gt; (s -&gt; Selection -&gt; Coin)
-&gt; ExceptT ErrSelectAssets IO Coin
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481618"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481607"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481600"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481601"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s Coin
</span><a href="#local-6989586621682481598"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Selection -&gt; Coin
forall b. b -&gt; Selection -&gt; Coin
</span><a href="#local-6989586621682481599"><span class="hs-identifier hs-var">getFee</span></a></span><span>
</span><span id="line-2279"></span><span>        </span><span id="local-6989586621682481596"><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682481596"><span class="hs-identifier hs-var">minCoins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Coin] -&gt; Handler [Coin]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k -&gt; AnyCardanoEra -&gt; [TxOut] -&gt; IO [Coin]
forall ctx (k :: Depth -&gt; * -&gt; *) (f :: * -&gt; *).
(HasTransactionLayer k ctx, HasNetworkLayer IO ctx,
 Applicative f) =&gt;
ctx -&gt; AnyCardanoEra -&gt; f TxOut -&gt; IO (f Coin)
</span><a href="Cardano.Wallet.html#calcMinimumCoinValues"><span class="hs-identifier hs-var">W.calcMinimumCoinValues</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481617"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481607"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481600"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut
</span><a href="#local-6989586621682481603"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2280"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO ApiFee -&gt; Handler ApiFee
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO ApiFee -&gt; Handler ApiFee)
-&gt; ExceptT ErrSelectAssets IO ApiFee -&gt; Handler ApiFee
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin -&gt; [Coin] -&gt; FeeEstimation -&gt; ApiFee
</span><a href="Cardano.Wallet.Api.Server.html#mkApiFee"><span class="hs-identifier hs-var">mkApiFee</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682481596"><span class="hs-identifier hs-var">minCoins</span></a></span><span> </span><span class="annot"><span class="annottext">(FeeEstimation -&gt; ApiFee)
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
-&gt; ExceptT ErrSelectAssets IO ApiFee
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Coin
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
forall (m :: * -&gt; *).
Monad m =&gt;
ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m FeeEstimation
</span><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier hs-var">W.estimateFee</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Coin
</span><a href="#local-6989586621682481597"><span class="hs-identifier hs-var">runSelection</span></a></span><span>
</span><span id="line-2281"></span><span>
</span><span id="line-2282"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#constructTransaction"><span class="hs-identifier hs-type">constructTransaction</span></a></span><span>
</span><span id="line-2283"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481592"><span class="annot"><a href="#local-6989586621682481592"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481591"><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481590"><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481589"><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2284"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481592"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2285"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2287"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2288"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481592"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2289"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2290"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2291"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2292"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2293"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2294"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2295"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481592"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2296"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2297"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2298"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier hs-type">PoolLifeCycleStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2299"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2300"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransactionData"><span class="hs-identifier hs-type">ApiConstructTransactionData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2301"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransaction"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2302"></span><span id="constructTransaction"><span class="annot"><span class="annottext">constructTransaction :: ctx
-&gt; ArgGenChange s
-&gt; IO (Set PoolId)
-&gt; (PoolId -&gt; IO PoolLifeCycleStatus)
-&gt; ApiT WalletId
-&gt; ApiConstructTransactionData n
-&gt; Handler (ApiConstructTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#constructTransaction"><span class="hs-identifier hs-var hs-var">constructTransaction</span></a></span></span><span> </span><span id="local-6989586621682481588"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481588"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481587"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481587"><span class="hs-identifier hs-var">genChange</span></a></span></span><span> </span><span id="local-6989586621682481586"><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682481586"><span class="hs-identifier hs-var">knownPools</span></a></span></span><span> </span><span id="local-6989586621682481585"><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682481585"><span class="hs-identifier hs-var">getPoolStatus</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481584"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481583"><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2303"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481582"><span class="annot"><span class="annottext">isNoPayload :: Bool
</span><a href="#local-6989586621682481582"><span class="hs-identifier hs-var hs-var">isNoPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2304"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ApiPaymentDestination n) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (ApiPaymentDestination n)
     -&gt; Const
          (Maybe (ApiPaymentDestination n))
          (Maybe (ApiPaymentDestination n)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
-&gt; Maybe (ApiPaymentDestination n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((Maybe (ApiPaymentDestination n)
    -&gt; Const
         (Maybe (ApiPaymentDestination n))
         (Maybe (ApiPaymentDestination n)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
(Maybe (ApiPaymentDestination n)
 -&gt; Const
      (Maybe (ApiPaymentDestination n))
      (Maybe (ApiPaymentDestination n)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481581"><span class="hs-var">#payments</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2305"></span><span>            </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe ApiWithdrawalPostData
     -&gt; Const
          (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n))
-&gt; Maybe ApiWithdrawalPostData
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawal&quot;
  ((Maybe ApiWithdrawalPostData
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n))
(Maybe ApiWithdrawalPostData
 -&gt; Const
      (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481580"><span class="hs-var">#withdrawal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2306"></span><span>            </span><span class="annot"><span class="annottext">Maybe TxMetadataWithSchema -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe TxMetadataWithSchema
     -&gt; Const (Maybe TxMetadataWithSchema) (Maybe TxMetadataWithSchema))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe TxMetadataWithSchema) (ApiConstructTransactionData n))
-&gt; Maybe TxMetadataWithSchema
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema
    -&gt; Const (Maybe TxMetadataWithSchema) (Maybe TxMetadataWithSchema))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe TxMetadataWithSchema) (ApiConstructTransactionData n))
(Maybe TxMetadataWithSchema
 -&gt; Const (Maybe TxMetadataWithSchema) (Maybe TxMetadataWithSchema))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe TxMetadataWithSchema) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481579"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2307"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty (ApiMintBurnData n))
     -&gt; Const
          (Maybe (NonEmpty (ApiMintBurnData n)))
          (Maybe (NonEmpty (ApiMintBurnData n))))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty (ApiMintBurnData n)))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty (ApiMintBurnData n))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mintBurn&quot;
  ((Maybe (NonEmpty (ApiMintBurnData n))
    -&gt; Const
         (Maybe (NonEmpty (ApiMintBurnData n)))
         (Maybe (NonEmpty (ApiMintBurnData n))))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty (ApiMintBurnData n)))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty (ApiMintBurnData n))
 -&gt; Const
      (Maybe (NonEmpty (ApiMintBurnData n)))
      (Maybe (NonEmpty (ApiMintBurnData n))))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty (ApiMintBurnData n)))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481578"><span class="hs-var">#mintBurn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2308"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty ApiMultiDelegationAction) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty ApiMultiDelegationAction)
     -&gt; Const
          (Maybe (NonEmpty ApiMultiDelegationAction))
          (Maybe (NonEmpty ApiMultiDelegationAction)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty ApiMultiDelegationAction)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegations&quot;
  ((Maybe (NonEmpty ApiMultiDelegationAction)
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (Maybe (NonEmpty ApiMultiDelegationAction)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty ApiMultiDelegationAction))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty ApiMultiDelegationAction)
 -&gt; Const
      (Maybe (NonEmpty ApiMultiDelegationAction))
      (Maybe (NonEmpty ApiMultiDelegationAction)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty ApiMultiDelegationAction))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481577"><span class="hs-var">#delegations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2309"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481582"><span class="hs-identifier hs-var">isNoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2310"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongPayload"><span class="hs-identifier hs-var">ErrConstructTxWrongPayload</span></a></span><span>
</span><span id="line-2311"></span><span>
</span><span id="line-2312"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481575"><span class="annot"><span class="annottext">mintingBurning :: Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481575"><span class="hs-identifier hs-var hs-var">mintingBurning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty (ApiMintBurnData n))
     -&gt; Const
          (Maybe (NonEmpty (ApiMintBurnData n)))
          (Maybe (NonEmpty (ApiMintBurnData n))))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty (ApiMintBurnData n)))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty (ApiMintBurnData n))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mintBurn&quot;
  ((Maybe (NonEmpty (ApiMintBurnData n))
    -&gt; Const
         (Maybe (NonEmpty (ApiMintBurnData n)))
         (Maybe (NonEmpty (ApiMintBurnData n))))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty (ApiMintBurnData n)))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty (ApiMintBurnData n))
 -&gt; Const
      (Maybe (NonEmpty (ApiMintBurnData n)))
      (Maybe (NonEmpty (ApiMintBurnData n))))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty (ApiMintBurnData n)))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481574"><span class="hs-var">#mintBurn</span></a></span><span>
</span><span id="line-2313"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682481573"><span class="hs-identifier hs-type">handleMissingAssetName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2314"></span><span>        </span><span id="local-6989586621682481573"><span class="annot"><span class="annottext">handleMissingAssetName :: ApiMintBurnData n -&gt; ApiMintBurnData n
</span><a href="#local-6989586621682481573"><span class="hs-identifier hs-var hs-var">handleMissingAssetName</span></a></span></span><span> </span><span id="local-6989586621682481572"><span class="annot"><span class="annottext">ApiMintBurnData n
</span><a href="#local-6989586621682481572"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><a href="#local-6989586621682481572"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
-&gt; ((Maybe (ApiT TokenName)
     -&gt; Const (Maybe (ApiT TokenName)) (Maybe (ApiT TokenName)))
    -&gt; ApiMintBurnData n
    -&gt; Const (Maybe (ApiT TokenName)) (ApiMintBurnData n))
-&gt; Maybe (ApiT TokenName)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assetName&quot;
  ((Maybe (ApiT TokenName)
    -&gt; Const (Maybe (ApiT TokenName)) (Maybe (ApiT TokenName)))
   -&gt; ApiMintBurnData n
   -&gt; Const (Maybe (ApiT TokenName)) (ApiMintBurnData n))
(Maybe (ApiT TokenName)
 -&gt; Const (Maybe (ApiT TokenName)) (Maybe (ApiT TokenName)))
-&gt; ApiMintBurnData n
-&gt; Const (Maybe (ApiT TokenName)) (ApiMintBurnData n)
</span><a href="#local-6989586621682481571"><span class="hs-var">#assetName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2315"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><a href="#local-6989586621682481572"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:assetName:ApiMintBurnData :: Maybe (ApiT TokenName)
</span><a href="#local-6989586621682481570"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT TokenName -&gt; Maybe (ApiT TokenName)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TokenName -&gt; Maybe (ApiT TokenName))
-&gt; ApiT TokenName -&gt; Maybe (ApiT TokenName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; ApiT TokenName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#nullTokenName"><span class="hs-identifier hs-var">nullTokenName</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2316"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><a href="#local-6989586621682481572"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-2317"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481569"><span class="annot"><span class="annottext">mintingBurning' :: Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var hs-var">mintingBurning'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; ApiMintBurnData n)
-&gt; NonEmpty (ApiMintBurnData n) -&gt; NonEmpty (ApiMintBurnData n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; ApiMintBurnData n
</span><a href="#local-6989586621682481573"><span class="hs-identifier hs-var">handleMissingAssetName</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; NonEmpty (ApiMintBurnData n))
-&gt; Maybe (NonEmpty (ApiMintBurnData n))
-&gt; Maybe (NonEmpty (ApiMintBurnData n))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481575"><span class="hs-identifier hs-var">mintingBurning</span></a></span><span>
</span><span id="line-2318"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481568"><span class="annot"><span class="annottext">retrieveAllCosigners :: Script a -&gt; [a]
</span><a href="#local-6989586621682481568"><span class="hs-identifier hs-var hs-var">retrieveAllCosigners</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [a] -&gt; [a]) -&gt; [a] -&gt; Script a -&gt; [a]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Script a -&gt; b
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">foldScript</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2319"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481567"><span class="annot"><span class="annottext">wrongMintingTemplate :: ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481567"><span class="hs-identifier hs-var hs-var">wrongMintingTemplate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481565"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481565"><span class="hs-identifier hs-var">scriptTempl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnOperation n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2320"></span><span>            </span><span class="annot"><span class="annottext">Either ErrValidateScript () -&gt; Bool
forall a b. Either a b -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationLevel -&gt; Script Cosigner -&gt; Either ErrValidateScript ()
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">validateScriptOfTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationLevel
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RecommendedValidation</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481565"><span class="hs-identifier hs-var">scriptTempl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2321"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">[Cosigner] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script Cosigner -&gt; [Cosigner]
forall a. Script a -&gt; [a]
</span><a href="#local-6989586621682481568"><span class="hs-identifier hs-var">retrieveAllCosigners</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481565"><span class="hs-identifier hs-var">scriptTempl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2322"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Cosigner -&gt; Bool) -&gt; [Cosigner] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner -&gt; Cosigner -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Cosigner
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script Cosigner -&gt; [Cosigner]
forall a. Script a -&gt; [a]
</span><a href="#local-6989586621682481568"><span class="hs-identifier hs-var">retrieveAllCosigners</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481565"><span class="hs-identifier hs-var">scriptTempl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2323"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span>
</span><span id="line-2324"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2325"></span><span>          </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool) -&gt; [ApiMintBurnData n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481567"><span class="hs-identifier hs-var">wrongMintingTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n])
-&gt; NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
-&gt; NonEmpty (ApiMintBurnData n)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2326"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongMintingBurningTemplate"><span class="hs-identifier hs-var">ErrConstructTxWrongMintingBurningTemplate</span></a></span><span>
</span><span id="line-2327"></span><span>
</span><span id="line-2328"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481559"><span class="annot"><span class="annottext">assetNameTooLong :: ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481559"><span class="hs-identifier hs-var hs-var">assetNameTooLong</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2329"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Script Cosigner)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#UnsafeTokenName"><span class="hs-identifier hs-type">UnsafeTokenName</span></a></span><span> </span><span id="local-6989586621682481557"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682481557"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiMintBurnOperation n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2330"></span><span>                </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682481557"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#tokenNameMaxLength"><span class="hs-identifier hs-var">tokenNameMaxLength</span></a></span><span>
</span><span id="line-2331"></span><span>            </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2332"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tokenName should be nonempty at this step&quot;</span></span><span>
</span><span id="line-2333"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span>
</span><span id="line-2334"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2335"></span><span>          </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool) -&gt; [ApiMintBurnData n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481559"><span class="hs-identifier hs-var">assetNameTooLong</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n])
-&gt; NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
-&gt; NonEmpty (ApiMintBurnData n)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2336"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxAssetNameTooLong"><span class="hs-identifier hs-var">ErrConstructTxAssetNameTooLong</span></a></span><span>
</span><span id="line-2337"></span><span>
</span><span id="line-2338"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481552"><span class="annot"><span class="annottext">assetQuantityOutOfBounds :: ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481552"><span class="hs-identifier hs-var hs-var">assetQuantityOutOfBounds</span></a></span></span><span>
</span><span id="line-2339"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Script Cosigner)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMint"><span class="hs-identifier hs-type">ApiMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintData"><span class="hs-identifier hs-type">ApiMintData</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682481549"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481549"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2340"></span><span>            </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481549"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481549"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#unTokenQuantity"><span class="hs-identifier hs-var hs-var">unTokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txMintBurnMaxTokenQuantity"><span class="hs-identifier hs-var">txMintBurnMaxTokenQuantity</span></a></span><span>
</span><span id="line-2341"></span><span>        </span><span class="annot"><a href="#local-6989586621682481552"><span class="hs-identifier hs-var">assetQuantityOutOfBounds</span></a></span><span>
</span><span id="line-2342"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Script Cosigner)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBurn"><span class="hs-identifier hs-type">ApiBurn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBurnData"><span class="hs-identifier hs-type">ApiBurnData</span></a></span><span> </span><span id="local-6989586621682481544"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481544"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2343"></span><span>            </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481544"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481544"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#unTokenQuantity"><span class="hs-identifier hs-var hs-var">unTokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txMintBurnMaxTokenQuantity"><span class="hs-identifier hs-var">txMintBurnMaxTokenQuantity</span></a></span><span>
</span><span id="line-2344"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span>
</span><span id="line-2345"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2346"></span><span>          </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool) -&gt; [ApiMintBurnData n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481552"><span class="hs-identifier hs-var">assetQuantityOutOfBounds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n])
-&gt; NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
-&gt; NonEmpty (ApiMintBurnData n)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2347"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2348"></span><span>            </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxMintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier hs-var">ErrConstructTxMintOrBurnAssetQuantityOutOfBounds</span></a></span><span>
</span><span id="line-2349"></span><span>
</span><span id="line-2350"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481542"><span class="annot"><span class="annottext">checkIx :: ApiStakeKeyIndex -&gt; Bool
</span><a href="#local-6989586621682481542"><span class="hs-identifier hs-var hs-var">checkIx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiStakeKeyIndex"><span class="hs-identifier hs-type">ApiStakeKeyIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481540"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682481540"><span class="hs-identifier hs-var">derIndex</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2351"></span><span>            </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682481540"><span class="hs-identifier hs-var">derIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; DerivationIndex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened Any -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened Any
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2352"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481539"><span class="annot"><span class="annottext">validApiDelAction :: ApiMultiDelegationAction -&gt; Bool
</span><a href="#local-6989586621682481539"><span class="hs-identifier hs-var hs-var">validApiDelAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2353"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Joining"><span class="hs-identifier hs-type">Joining</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682481537"><span class="annot"><span class="annottext">ApiStakeKeyIndex
</span><a href="#local-6989586621682481537"><span class="hs-identifier hs-var">stakeKeyIx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiStakeKeyIndex -&gt; Bool
</span><a href="#local-6989586621682481542"><span class="hs-identifier hs-var">checkIx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiStakeKeyIndex
</span><a href="#local-6989586621682481537"><span class="hs-identifier hs-var">stakeKeyIx</span></a></span><span>
</span><span id="line-2354"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Leaving"><span class="hs-identifier hs-type">Leaving</span></a></span><span> </span><span id="local-6989586621682481535"><span class="annot"><span class="annottext">ApiStakeKeyIndex
</span><a href="#local-6989586621682481535"><span class="hs-identifier hs-var">stakeKeyIx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiStakeKeyIndex -&gt; Bool
</span><a href="#local-6989586621682481542"><span class="hs-identifier hs-var">checkIx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiStakeKeyIndex
</span><a href="#local-6989586621682481535"><span class="hs-identifier hs-var">stakeKeyIx</span></a></span><span>
</span><span id="line-2355"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481534"><span class="annot"><span class="annottext">notall0Haccount :: Bool
</span><a href="#local-6989586621682481534"><span class="hs-identifier hs-var hs-var">notall0Haccount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty ApiMultiDelegationAction)
     -&gt; Const
          (Maybe (NonEmpty ApiMultiDelegationAction))
          (Maybe (NonEmpty ApiMultiDelegationAction)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty ApiMultiDelegationAction)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegations&quot;
  ((Maybe (NonEmpty ApiMultiDelegationAction)
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (Maybe (NonEmpty ApiMultiDelegationAction)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty ApiMultiDelegationAction))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty ApiMultiDelegationAction)
 -&gt; Const
      (Maybe (NonEmpty ApiMultiDelegationAction))
      (Maybe (NonEmpty ApiMultiDelegationAction)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty ApiMultiDelegationAction))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481533"><span class="hs-var">#delegations</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2356"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty ApiMultiDelegationAction)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2357"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481532"><span class="annot"><span class="annottext">NonEmpty ApiMultiDelegationAction
</span><a href="#local-6989586621682481532"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiMultiDelegationAction] -&gt; Bool)
-&gt; [ApiMultiDelegationAction]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiMultiDelegationAction -&gt; Bool)
-&gt; [ApiMultiDelegationAction] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMultiDelegationAction -&gt; Bool
</span><a href="#local-6989586621682481539"><span class="hs-identifier hs-var">validApiDelAction</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiMultiDelegationAction] -&gt; Bool)
-&gt; [ApiMultiDelegationAction] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ApiMultiDelegationAction -&gt; [ApiMultiDelegationAction]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ApiMultiDelegationAction
</span><a href="#local-6989586621682481532"><span class="hs-identifier hs-var">delegs</span></a></span><span>
</span><span id="line-2358"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481534"><span class="hs-identifier hs-var">notall0Haccount</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2359"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxMultiaccountNotSupported"><span class="hs-identifier hs-var">ErrConstructTxMultiaccountNotSupported</span></a></span><span>
</span><span id="line-2360"></span><span>
</span><span id="line-2361"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481528"><span class="annot"><span class="annottext">md :: Maybe TxMetadata
</span><a href="#local-6989586621682481528"><span class="hs-identifier hs-var hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; ApiConstructTransactionData n
    -&gt; Const (First TxMetadata) (ApiConstructTransactionData n))
-&gt; Maybe TxMetadata
forall s a.
s
-&gt; ((a -&gt; Const (First a) a) -&gt; s -&gt; Const (First a) s) -&gt; Maybe a
</span><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
   -&gt; ApiConstructTransactionData n
   -&gt; Const (First TxMetadata) (ApiConstructTransactionData n))
(Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; ApiConstructTransactionData n
-&gt; Const (First TxMetadata) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481527"><span class="hs-var">#metadata</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe TxMetadataWithSchema
  -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
 -&gt; ApiConstructTransactionData n
 -&gt; Const (First TxMetadata) (ApiConstructTransactionData n))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; ApiConstructTransactionData n
-&gt; Const (First TxMetadata) (ApiConstructTransactionData n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadataWithSchema
 -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMetadataWithSchema
  -&gt; Const (First TxMetadata) TxMetadataWithSchema)
 -&gt; Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; TxMetadataWithSchema
    -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadataWithSchema_metadata&quot;
  ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
   -&gt; TxMetadataWithSchema
   -&gt; Const (First TxMetadata) TxMetadataWithSchema)
(TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; TxMetadataWithSchema
-&gt; Const (First TxMetadata) TxMetadataWithSchema
</span><a href="#local-6989586621682481526"><span class="hs-var">#txMetadataWithSchema_metadata</span></a></span><span>
</span><span id="line-2362"></span><span>
</span><span id="line-2363"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481525"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481525"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481524"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481524"><span class="hs-identifier hs-var">hereafter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481523"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481523"><span class="hs-identifier hs-var">isThereNegativeTime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2364"></span><span>        </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe ApiValidityInterval -&gt; Handler (SlotNo, SlotNo, Bool)
</span><a href="Cardano.Wallet.Api.Server.html#decodeValidityInterval"><span class="hs-identifier hs-var">decodeValidityInterval</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481521"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe ApiValidityInterval
     -&gt; Const (Maybe ApiValidityInterval) (Maybe ApiValidityInterval))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe ApiValidityInterval) (ApiConstructTransactionData n))
-&gt; Maybe ApiValidityInterval
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;validityInterval&quot;
  ((Maybe ApiValidityInterval
    -&gt; Const (Maybe ApiValidityInterval) (Maybe ApiValidityInterval))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe ApiValidityInterval) (ApiConstructTransactionData n))
(Maybe ApiValidityInterval
 -&gt; Const (Maybe ApiValidityInterval) (Maybe ApiValidityInterval))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe ApiValidityInterval) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481520"><span class="hs-var">#validityInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2365"></span><span>
</span><span id="line-2366"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481524"><span class="hs-identifier hs-var">hereafter</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481525"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481523"><span class="hs-identifier hs-var">isThereNegativeTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2367"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongValidityBounds"><span class="hs-identifier hs-var">ErrConstructTxWrongValidityBounds</span></a></span><span>
</span><span id="line-2368"></span><span>
</span><span id="line-2369"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481517"><span class="annot"><span class="annottext">notWithinValidityInterval :: ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481517"><span class="hs-identifier hs-var hs-var">notWithinValidityInterval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481516"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481516"><span class="hs-identifier hs-var">scriptTempl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnOperation n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2370"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; [Interval Natural] -&gt; Bool
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#withinSlotInterval"><span class="hs-identifier hs-var">withinSlotInterval</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481525"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481524"><span class="hs-identifier hs-var">hereafter</span></a></span><span> </span><span class="annot"><span class="annottext">([Interval Natural] -&gt; Bool) -&gt; [Interval Natural] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2371"></span><span>            </span><span class="annot"><span class="annottext">Script Cosigner -&gt; [Interval Natural]
forall a. Script a -&gt; [Interval Natural]
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#scriptSlotIntervals"><span class="hs-identifier hs-var">scriptSlotIntervals</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481516"><span class="hs-identifier hs-var">scriptTempl</span></a></span><span>
</span><span id="line-2372"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span>
</span><span id="line-2373"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2374"></span><span>          </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool) -&gt; [ApiMintBurnData n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481517"><span class="hs-identifier hs-var">notWithinValidityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n])
-&gt; NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
-&gt; NonEmpty (ApiMintBurnData n)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2375"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2376"></span><span>        </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2377"></span><span>        </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxValidityIntervalNotWithinScriptTimelock"><span class="hs-identifier hs-var">ErrConstructTxValidityIntervalNotWithinScriptTimelock</span></a></span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span>
</span><span id="line-2380"></span><span>    </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-2381"></span><span>    </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-2382"></span><span>    </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-2383"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481514"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481514"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2384"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481588"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe ApiWithdrawalPostData
     -&gt; Const
          (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n))
-&gt; Maybe ApiWithdrawalPostData
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawal&quot;
  ((Maybe ApiWithdrawalPostData
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n))
(Maybe ApiWithdrawalPostData
 -&gt; Const
      (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481513"><span class="hs-var">#withdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2385"></span><span>
</span><span id="line-2386"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiConstructTransaction n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiConstructTransaction n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiConstructTransaction n))
-&gt; Handler (ApiConstructTransaction n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481588"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiConstructTransaction n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiConstructTransaction n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiConstructTransaction n))
 -&gt; Handler (ApiConstructTransaction n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiConstructTransaction n))
-&gt; Handler (ApiConstructTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481512"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2387"></span><span>        </span><span id="local-6989586621682481511"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481511"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2388"></span><span>        </span><span id="local-6989586621682481510"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481510"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2389"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481509"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481509"><span class="hs-identifier hs-var">deposit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481508"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481508"><span class="hs-identifier hs-var">refund</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481507"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481507"><span class="hs-identifier hs-var">txCtx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty ApiMultiDelegationAction)
     -&gt; Const
          (Maybe (NonEmpty ApiMultiDelegationAction))
          (Maybe (NonEmpty ApiMultiDelegationAction)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty ApiMultiDelegationAction)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegations&quot;
  ((Maybe (NonEmpty ApiMultiDelegationAction)
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (Maybe (NonEmpty ApiMultiDelegationAction)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty ApiMultiDelegationAction))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty ApiMultiDelegationAction)
 -&gt; Const
      (Maybe (NonEmpty ApiMultiDelegationAction))
      (Maybe (NonEmpty ApiMultiDelegationAction)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty ApiMultiDelegationAction))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481506"><span class="hs-var">#delegations</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2390"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty ApiMultiDelegationAction)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe Coin, Maybe Coin, TransactionCtx)
-&gt; Handler (Maybe Coin, Maybe Coin, TransactionCtx)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-2391"></span><span>                 </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481514"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-2392"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:TransactionCtx :: Maybe TxMetadata
</span><a href="#local-6989586621682482015"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481528"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-2393"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Maybe SlotNo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481525"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481524"><span class="hs-identifier hs-var">hereafter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2394"></span><span>                 </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2395"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481505"><span class="annot"><span class="annottext">NonEmpty ApiMultiDelegationAction
</span><a href="#local-6989586621682481505"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2396"></span><span>                </span><span class="hs-comment">-- TODO: Current limitation:</span><span>
</span><span id="line-2397"></span><span>                </span><span class="hs-comment">-- at this moment we are handling just one delegation action:</span><span>
</span><span id="line-2398"></span><span>                </span><span class="hs-comment">-- either joining pool, or rejoining or quitting</span><span>
</span><span id="line-2399"></span><span>                </span><span class="hs-comment">-- When we support multi-account this should be lifted</span><span>
</span><span id="line-2400"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682481504"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481504"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481503"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481503"><span class="hs-identifier hs-var">deposit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481502"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481502"><span class="hs-identifier hs-var">refund</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty ApiMultiDelegationAction -&gt; [ApiMultiDelegationAction]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ApiMultiDelegationAction
</span><a href="#local-6989586621682481505"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2401"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Joining"><span class="hs-identifier hs-type">Joining</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481501"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481501"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiStakeKeyIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2402"></span><span>                        </span><span id="local-6989586621682481500"><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682481500"><span class="hs-identifier hs-var">poolStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO PoolLifeCycleStatus -&gt; Handler PoolLifeCycleStatus
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682481585"><span class="hs-identifier hs-var">getPoolStatus</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481501"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2403"></span><span>                        </span><span id="local-6989586621682481499"><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682481499"><span class="hs-identifier hs-var">pools</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set PoolId) -&gt; Handler (Set PoolId)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682481586"><span class="hs-identifier hs-var">knownPools</span></a></span><span>
</span><span id="line-2404"></span><span>                        </span><span id="local-6989586621682481498"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682481498"><span class="hs-identifier hs-var">curEpoch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx -&gt; Handler EpochNo
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k) =&gt;
ctx -&gt; Handler EpochNo
</span><a href="Cardano.Wallet.Api.Server.html#getCurrentEpoch"><span class="hs-identifier hs-var">getCurrentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481588"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2405"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621682481497"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481497"><span class="hs-identifier hs-var">del</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481496"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481496"><span class="hs-identifier hs-var">act</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
 -&gt; Handler (DelegationAction, Maybe Coin))
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
</span><a href="Cardano.Wallet.html#joinStakePool"><span class="hs-identifier hs-var">W.joinStakePool</span></a></span><span>
</span><span id="line-2406"></span><span>                            </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682481498"><span class="hs-identifier hs-var">curEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682481499"><span class="hs-identifier hs-var">pools</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481501"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682481500"><span class="hs-identifier hs-var">poolStatus</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2407"></span><span>                        </span><span class="annot"><span class="annottext">(DelegationAction, Maybe Coin, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin, Maybe Coin)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481497"><span class="hs-identifier hs-var">del</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481496"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2408"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#Leaving"><span class="hs-identifier hs-type">Leaving</span></a></span><span> </span><span class="annot"><span class="annottext">ApiStakeKeyIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2409"></span><span>                        </span><span id="local-6989586621682481495"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481495"><span class="hs-identifier hs-var">del</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrStakePoolDelegation IO DelegationAction
-&gt; Handler DelegationAction
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation IO DelegationAction
 -&gt; Handler DelegationAction)
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
-&gt; Handler DelegationAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2410"></span><span>                            </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
</span><a href="Cardano.Wallet.html#quitStakePool"><span class="hs-identifier hs-var">W.quitStakePool</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481514"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-2411"></span><span>                        </span><span class="annot"><span class="annottext">(DelegationAction, Maybe Coin, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin, Maybe Coin)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481495"><span class="hs-identifier hs-var">del</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Maybe Coin) -&gt; Coin -&gt; Maybe Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481511"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2412"></span><span>                    </span><span class="annot"><span class="annottext">[ApiMultiDelegationAction]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2413"></span><span>                        </span><span class="annot"><span class="annottext">ExceptT
  ErrConstructTx IO (DelegationAction, Maybe Coin, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin, Maybe Coin)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrConstructTx IO (DelegationAction, Maybe Coin, Maybe Coin)
 -&gt; Handler (DelegationAction, Maybe Coin, Maybe Coin))
-&gt; ExceptT
     ErrConstructTx IO (DelegationAction, Maybe Coin, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin, Maybe Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2414"></span><span>                            </span><span class="annot"><span class="annottext">ErrConstructTx
-&gt; ExceptT
     ErrConstructTx IO (DelegationAction, Maybe Coin, Maybe Coin)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxMultidelegationNotSupported"><span class="hs-identifier hs-var">ErrConstructTxMultidelegationNotSupported</span></a></span><span>
</span><span id="line-2415"></span><span>
</span><span id="line-2416"></span><span>                </span><span class="annot"><span class="annottext">(Maybe Coin, Maybe Coin, TransactionCtx)
-&gt; Handler (Maybe Coin, Maybe Coin, TransactionCtx)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481503"><span class="hs-identifier hs-var">deposit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481502"><span class="hs-identifier hs-var">refund</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-2417"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481514"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-2418"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:TransactionCtx :: Maybe TxMetadata
</span><a href="#local-6989586621682482015"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481528"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-2419"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Maybe SlotNo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481525"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481524"><span class="hs-identifier hs-var">hereafter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2420"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481504"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-2421"></span><span>                    </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2422"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481493"><span class="annot"><span class="annottext">transform :: s
-&gt; Selection
-&gt; (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex),
    Selection, Coin)
</span><a href="#local-6989586621682481493"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621682481492"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481492"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682481491"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481491"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2423"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">W.assignChangeAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481587"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481491"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481492"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2424"></span><span>                    </span><span class="annot"><span class="annottext">(SelectionOf TxOut, s)
-&gt; ((SelectionOf TxOut, s)
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionOf TxOut
 -&gt; s
 -&gt; UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (SelectionOf TxOut, s)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall s input output change withdrawal.
(IsOurs s Address, input ~ (TxIn, TxOut, NonEmpty DerivationIndex),
 output ~ TxOut, change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var">W.selectionToUnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481507"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2425"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481491"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2426"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; Selection -&gt; Coin
forall change. (change -&gt; Coin) -&gt; SelectionOf change -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#selectionDelta"><span class="hs-identifier hs-var">selectionDelta</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481491"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2427"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-2428"></span><span>
</span><span id="line-2429"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481490"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481490"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481489"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481489"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481488"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682481488"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2430"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2431"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481487"><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481487"><span class="hs-identifier hs-var">txCtx'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481486"><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481486"><span class="hs-identifier hs-var">policyXPubM</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2432"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2433"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682481485"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682481485"><span class="hs-identifier hs-var">policyXPub</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2434"></span><span>                    </span><span class="annot"><span class="annottext">ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
 -&gt; Handler (XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier hs-var">W.readPolicyPublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2435"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481483"><span class="annot"><span class="annottext">isMinting :: ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481483"><span class="hs-identifier hs-var hs-var">isMinting</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Script Cosigner)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMint"><span class="hs-identifier hs-type">ApiMint</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintData n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-2436"></span><span>                    </span><span class="annot"><a href="#local-6989586621682481483"><span class="hs-identifier hs-var">isMinting</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2437"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481482"><span class="annot"><span class="annottext">getMinting :: ApiMintBurnData n -&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="#local-6989586621682481482"><span class="hs-identifier hs-var hs-var">getMinting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2438"></span><span>                        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span>
</span><span id="line-2439"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481481"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481481"><span class="hs-identifier hs-var">scriptT</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2440"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481480"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481480"><span class="hs-identifier hs-var">tName</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2441"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMint"><span class="hs-identifier hs-type">ApiMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintData"><span class="hs-identifier hs-type">ApiMintData</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682481479"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481479"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2442"></span><span>                            </span><span class="annot"><span class="annottext">Script Cosigner
-&gt; Map Cosigner XPub
-&gt; TokenName
-&gt; Natural
-&gt; (AssetId, TokenQuantity, Script KeyHash)
forall (key :: Depth -&gt; * -&gt; *).
WalletKey key =&gt;
Script Cosigner
-&gt; Map Cosigner XPub
-&gt; TokenName
-&gt; Natural
-&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#toTokenMapAndScript"><span class="hs-identifier hs-var">toTokenMapAndScript</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2443"></span><span>                                </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481481"><span class="hs-identifier hs-var">scriptT</span></a></span><span>
</span><span id="line-2444"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner -&gt; XPub -&gt; Map Cosigner XPub
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Cosigner
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682481485"><span class="hs-identifier hs-var">policyXPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2445"></span><span>                                </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481480"><span class="hs-identifier hs-var">tName</span></a></span><span>
</span><span id="line-2446"></span><span>                                </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481479"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-2447"></span><span>                        </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (AssetId, TokenQuantity, Script KeyHash)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getMinting should not be used in this way&quot;</span></span><span>
</span><span id="line-2448"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481477"><span class="annot"><span class="annottext">getBurning :: ApiMintBurnData n -&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="#local-6989586621682481477"><span class="hs-identifier hs-var hs-var">getBurning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2449"></span><span>                        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span>
</span><span id="line-2450"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481476"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481476"><span class="hs-identifier hs-var">scriptT</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2451"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481475"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481475"><span class="hs-identifier hs-var">tName</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2452"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBurn"><span class="hs-identifier hs-type">ApiBurn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBurnData"><span class="hs-identifier hs-type">ApiBurnData</span></a></span><span> </span><span id="local-6989586621682481474"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481474"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2453"></span><span>                            </span><span class="annot"><span class="annottext">Script Cosigner
-&gt; Map Cosigner XPub
-&gt; TokenName
-&gt; Natural
-&gt; (AssetId, TokenQuantity, Script KeyHash)
forall (key :: Depth -&gt; * -&gt; *).
WalletKey key =&gt;
Script Cosigner
-&gt; Map Cosigner XPub
-&gt; TokenName
-&gt; Natural
-&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#toTokenMapAndScript"><span class="hs-identifier hs-var">toTokenMapAndScript</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2454"></span><span>                                </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481476"><span class="hs-identifier hs-var">scriptT</span></a></span><span>
</span><span id="line-2455"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner -&gt; XPub -&gt; Map Cosigner XPub
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Cosigner
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682481485"><span class="hs-identifier hs-var">policyXPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2456"></span><span>                                </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481475"><span class="hs-identifier hs-var">tName</span></a></span><span>
</span><span id="line-2457"></span><span>                                </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481474"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-2458"></span><span>                        </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (AssetId, TokenQuantity, Script KeyHash)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getBurning should not be used in this way&quot;</span></span><span>
</span><span id="line-2459"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481473"><span class="annot"><span class="annottext">toTokenMap :: [(AssetId, TokenQuantity, c)] -&gt; TokenMap
</span><a href="#local-6989586621682481473"><span class="hs-identifier hs-var hs-var">toTokenMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2460"></span><span>                        </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity)] -&gt; TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#fromFlatList"><span class="hs-identifier hs-var">fromFlatList</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, TokenQuantity)] -&gt; TokenMap)
-&gt; ([(AssetId, TokenQuantity, c)] -&gt; [(AssetId, TokenQuantity)])
-&gt; [(AssetId, TokenQuantity, c)]
-&gt; TokenMap
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-2461"></span><span>                        </span><span class="annot"><span class="annottext">((AssetId, TokenQuantity, c) -&gt; (AssetId, TokenQuantity))
-&gt; [(AssetId, TokenQuantity, c)] -&gt; [(AssetId, TokenQuantity)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682481472"><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481472"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682481471"><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682481471"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481472"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682481471"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2462"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481470"><span class="annot"><span class="annottext">toScriptTemplateMap :: [(AssetId, b, a)] -&gt; Map AssetId a
</span><a href="#local-6989586621682481470"><span class="hs-identifier hs-var hs-var">toScriptTemplateMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2463"></span><span>                        </span><span class="annot"><span class="annottext">[(AssetId, a)] -&gt; Map AssetId a
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, a)] -&gt; Map AssetId a)
-&gt; ([(AssetId, b, a)] -&gt; [(AssetId, a)])
-&gt; [(AssetId, b, a)]
-&gt; Map AssetId a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-2464"></span><span>                        </span><span class="annot"><span class="annottext">((AssetId, b, a) -&gt; (AssetId, a))
-&gt; [(AssetId, b, a)] -&gt; [(AssetId, a)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682481468"><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481468"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682481467"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481467"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481468"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481467"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481466"><span class="annot"><span class="annottext">mintingData :: (TokenMap, Map AssetId (Script KeyHash))
</span><a href="#local-6989586621682481466"><span class="hs-identifier hs-var hs-var">mintingData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2466"></span><span>                        </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity, Script KeyHash)] -&gt; TokenMap
forall c. [(AssetId, TokenQuantity, c)] -&gt; TokenMap
</span><a href="#local-6989586621682481473"><span class="hs-identifier hs-var">toTokenMap</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, TokenQuantity, Script KeyHash)] -&gt; TokenMap)
-&gt; ([(AssetId, TokenQuantity, Script KeyHash)]
    -&gt; Map AssetId (Script KeyHash))
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
-&gt; (TokenMap, Map AssetId (Script KeyHash))
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity, Script KeyHash)]
-&gt; Map AssetId (Script KeyHash)
forall b a. [(AssetId, b, a)] -&gt; Map AssetId a
</span><a href="#local-6989586621682481470"><span class="hs-identifier hs-var">toScriptTemplateMap</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, TokenQuantity, Script KeyHash)]
 -&gt; (TokenMap, Map AssetId (Script KeyHash)))
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
-&gt; (TokenMap, Map AssetId (Script KeyHash))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2467"></span><span>                        </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; (AssetId, TokenQuantity, Script KeyHash))
-&gt; [ApiMintBurnData n]
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="#local-6989586621682481482"><span class="hs-identifier hs-var">getMinting</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiMintBurnData n] -&gt; [(AssetId, TokenQuantity, Script KeyHash)])
-&gt; [ApiMintBurnData n]
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2468"></span><span>                        </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool)
-&gt; [ApiMintBurnData n] -&gt; [ApiMintBurnData n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481483"><span class="hs-identifier hs-var">isMinting</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiMintBurnData n] -&gt; [ApiMintBurnData n])
-&gt; [ApiMintBurnData n] -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2469"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n])
-&gt; NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
-&gt; NonEmpty (ApiMintBurnData n)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span>
</span><span id="line-2470"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481465"><span class="annot"><span class="annottext">burningData :: (TokenMap, Map AssetId (Script KeyHash))
</span><a href="#local-6989586621682481465"><span class="hs-identifier hs-var hs-var">burningData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2471"></span><span>                        </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity, Script KeyHash)] -&gt; TokenMap
forall c. [(AssetId, TokenQuantity, c)] -&gt; TokenMap
</span><a href="#local-6989586621682481473"><span class="hs-identifier hs-var">toTokenMap</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, TokenQuantity, Script KeyHash)] -&gt; TokenMap)
-&gt; ([(AssetId, TokenQuantity, Script KeyHash)]
    -&gt; Map AssetId (Script KeyHash))
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
-&gt; (TokenMap, Map AssetId (Script KeyHash))
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity, Script KeyHash)]
-&gt; Map AssetId (Script KeyHash)
forall b a. [(AssetId, b, a)] -&gt; Map AssetId a
</span><a href="#local-6989586621682481470"><span class="hs-identifier hs-var">toScriptTemplateMap</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, TokenQuantity, Script KeyHash)]
 -&gt; (TokenMap, Map AssetId (Script KeyHash)))
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
-&gt; (TokenMap, Map AssetId (Script KeyHash))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2472"></span><span>                        </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; (AssetId, TokenQuantity, Script KeyHash))
-&gt; [ApiMintBurnData n]
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="#local-6989586621682481477"><span class="hs-identifier hs-var">getBurning</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiMintBurnData n] -&gt; [(AssetId, TokenQuantity, Script KeyHash)])
-&gt; [ApiMintBurnData n]
-&gt; [(AssetId, TokenQuantity, Script KeyHash)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2473"></span><span>                        </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool)
-&gt; [ApiMintBurnData n] -&gt; [ApiMintBurnData n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (ApiMintBurnData n -&gt; Bool) -&gt; ApiMintBurnData n -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481483"><span class="hs-identifier hs-var">isMinting</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiMintBurnData n] -&gt; [ApiMintBurnData n])
-&gt; [ApiMintBurnData n] -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2474"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n])
-&gt; NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
-&gt; NonEmpty (ApiMintBurnData n)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span>
</span><span id="line-2475"></span><span>                </span><span class="annot"><span class="annottext">(TransactionCtx, Maybe XPub)
-&gt; Handler (TransactionCtx, Maybe XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481507"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-2476"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txAssetsToMint:TransactionCtx :: (TokenMap, Map AssetId (Script KeyHash))
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxAssetsToMint%3ATransactionCtx"><span class="hs-identifier hs-var">txAssetsToMint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenMap, Map AssetId (Script KeyHash))
</span><a href="#local-6989586621682481466"><span class="hs-identifier hs-var">mintingData</span></a></span><span>
</span><span id="line-2477"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txAssetsToBurn:TransactionCtx :: (TokenMap, Map AssetId (Script KeyHash))
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxAssetsToBurn%3ATransactionCtx"><span class="hs-identifier hs-var">txAssetsToBurn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenMap, Map AssetId (Script KeyHash))
</span><a href="#local-6989586621682481465"><span class="hs-identifier hs-var">burningData</span></a></span><span>
</span><span id="line-2478"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-2479"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; Maybe XPub
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682481485"><span class="hs-identifier hs-var">policyXPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2480"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-2481"></span><span>                </span><span class="annot"><span class="annottext">(TransactionCtx, Maybe XPub)
-&gt; Handler (TransactionCtx, Maybe XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481507"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe XPub
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2482"></span><span>
</span><span id="line-2483"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481462"><span class="annot"><span class="annottext">runSelection :: [TxOut]
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
</span><a href="#local-6989586621682481462"><span class="hs-identifier hs-var hs-var">runSelection</span></a></span></span><span> </span><span id="local-6989586621682481461"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481461"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2484"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams
     s
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
-&gt; (s
    -&gt; Selection
    -&gt; (UnsignedTx
          (TxIn, TxOut, NonEmpty DerivationIndex)
          TxOut
          (TxChange (NonEmpty DerivationIndex))
          (RewardAccount, Coin, NonEmpty DerivationIndex),
        Selection, Coin))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481510"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481511"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex),
   Selection, Coin)
</span><a href="#local-6989586621682481460"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Selection
-&gt; (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex),
    Selection, Coin)
</span><a href="#local-6989586621682481493"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-2485"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-2486"></span><span>                </span><span id="local-6989586621682481460"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex),
   Selection, Coin)
</span><a href="#local-6989586621682481460"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-2487"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481461"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2488"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682481488"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-2489"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2490"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481487"><span class="hs-identifier hs-var">txCtx'</span></a></span><span>
</span><span id="line-2491"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2492"></span><span>                        </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481490"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2493"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2494"></span><span>                        </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481490"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2495"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682481489"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-2496"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-2497"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2498"></span><span>
</span><span id="line-2499"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481459"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481459"><span class="hs-identifier hs-var">sel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481458"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481458"><span class="hs-identifier hs-var">sel'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481457"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481457"><span class="hs-identifier hs-var">fee</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2500"></span><span>            </span><span id="local-6989586621682481456"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481456"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481583"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (ApiPaymentDestination n)
     -&gt; Const
          (Maybe (ApiPaymentDestination n))
          (Maybe (ApiPaymentDestination n)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
-&gt; Maybe (ApiPaymentDestination n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((Maybe (ApiPaymentDestination n)
    -&gt; Const
         (Maybe (ApiPaymentDestination n))
         (Maybe (ApiPaymentDestination n)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
(Maybe (ApiPaymentDestination n)
 -&gt; Const
      (Maybe (ApiPaymentDestination n))
      (Maybe (ApiPaymentDestination n)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481455"><span class="hs-var">#payments</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2501"></span><span>                </span><span class="annot"><span class="annottext">Maybe (ApiPaymentDestination n)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TxOut] -&gt; Handler [TxOut]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2502"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPaymentAddresses"><span class="hs-identifier hs-type">ApiPaymentAddresses</span></a></span><span> </span><span id="local-6989586621682481453"><span class="annot"><span class="annottext">NonEmpty (AddressAmount (ApiAddressIdT n))
</span><a href="#local-6989586621682481453"><span class="hs-identifier hs-var">content</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2503"></span><span>                    </span><span class="annot"><span class="annottext">[TxOut] -&gt; Handler [TxOut]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; Handler [TxOut]) -&gt; [TxOut] -&gt; Handler [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall (n :: NetworkDiscriminant).
AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var">addressAmountToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n) -&gt; TxOut)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; NonEmpty TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AddressAmount (ApiT Address, Proxy n))
NonEmpty (AddressAmount (ApiAddressIdT n))
</span><a href="#local-6989586621682481453"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2504"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPaymentAll"><span class="hs-identifier hs-type">ApiPaymentAll</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2505"></span><span>                    </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO [TxOut] -&gt; Handler [TxOut]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO [TxOut] -&gt; Handler [TxOut])
-&gt; ExceptT ErrConstructTx IO [TxOut] -&gt; Handler [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2506"></span><span>                        </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO [TxOut]
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrConstructTx -&gt; ExceptT ErrConstructTx IO [TxOut])
-&gt; ErrConstructTx -&gt; ExceptT ErrConstructTx IO [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxNotImplemented"><span class="hs-identifier hs-var">ErrConstructTxNotImplemented</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ADP-1189&quot;</span></span><span>
</span><span id="line-2507"></span><span>
</span><span id="line-2508"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481450"><span class="annot"><span class="annottext">mintWithAddress :: ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481450"><span class="hs-identifier hs-var hs-var">mintWithAddress</span></a></span></span><span>
</span><span id="line-2509"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Script Cosigner)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TokenName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMint"><span class="hs-identifier hs-type">ApiMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintData"><span class="hs-identifier hs-type">ApiMintData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2510"></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-2511"></span><span>                </span><span class="annot"><a href="#local-6989586621682481450"><span class="hs-identifier hs-var">mintWithAddress</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2512"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481449"><span class="annot"><span class="annottext">mintingOuts :: [TxOut]
</span><a href="#local-6989586621682481449"><span class="hs-identifier hs-var hs-var">mintingOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="#local-6989586621682481569"><span class="hs-identifier hs-var">mintingBurning'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2513"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481448"><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n)
</span><a href="#local-6989586621682481448"><span class="hs-identifier hs-var">mintBurns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2514"></span><span>                        </span><span class="annot"><span class="annottext">[((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut]
forall (n :: NetworkDiscriminant).
[((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut]
</span><a href="#local-6989586621682481447"><span class="hs-identifier hs-var">coalesceTokensPerAddr</span></a></span><span> </span><span class="annot"><span class="annottext">([((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut])
-&gt; [((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2515"></span><span>                        </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; ((ApiT Address, Proxy n), TokenMap))
-&gt; [ApiMintBurnData n] -&gt; [((ApiT Address, Proxy n), TokenMap)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; ApiMintBurnData n -&gt; ((ApiT Address, Proxy n), TokenMap)
</span><a href="#local-6989586621682481446"><span class="hs-identifier hs-var">toMintTxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe XPub -&gt; XPub
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481486"><span class="hs-identifier hs-var">policyXPubM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiMintBurnData n] -&gt; [((ApiT Address, Proxy n), TokenMap)])
-&gt; [ApiMintBurnData n] -&gt; [((ApiT Address, Proxy n), TokenMap)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2516"></span><span>                        </span><span class="annot"><span class="annottext">(ApiMintBurnData n -&gt; Bool)
-&gt; [ApiMintBurnData n] -&gt; [ApiMintBurnData n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiMintBurnData n -&gt; Bool
</span><a href="#local-6989586621682481450"><span class="hs-identifier hs-var">mintWithAddress</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiMintBurnData n] -&gt; [ApiMintBurnData n])
-&gt; [ApiMintBurnData n] -&gt; [ApiMintBurnData n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2517"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n) -&gt; [ApiMintBurnData n]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiMintBurnData n)
</span><a href="#local-6989586621682481448"><span class="hs-identifier hs-var">mintBurns</span></a></span><span>
</span><span id="line-2518"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n))
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2519"></span><span>
</span><span id="line-2520"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682481445"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481445"><span class="hs-identifier hs-var">sel'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481444"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481444"><span class="hs-identifier hs-var">utx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481443"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481443"><span class="hs-identifier hs-var">fee'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrSelectAssets
  IO
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex),
   Selection, Coin)
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrSelectAssets
   IO
   (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex),
    Selection, Coin)
 -&gt; Handler
      (UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex),
       Selection, Coin))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2521"></span><span>                </span><span class="annot"><span class="annottext">[TxOut]
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
</span><a href="#local-6989586621682481462"><span class="hs-identifier hs-var">runSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481456"><span class="hs-identifier hs-var">outs</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut] -&gt; [TxOut] -&gt; [TxOut]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481449"><span class="hs-identifier hs-var">mintingOuts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2522"></span><span>            </span><span id="local-6989586621682481442"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481442"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO (SelectionOf TxOut)
 -&gt; Handler (SelectionOf TxOut))
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2523"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(GenChange s, HasDBLayer IO s k ctx) =&gt;
ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesWithoutDbUpdate"><span class="hs-identifier hs-var">W.assignChangeAddressesWithoutDbUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481587"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481444"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-2524"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-type">FeeEstimation</span></a></span><span> </span><span id="local-6989586621682481439"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481439"><span class="hs-identifier hs-var">estMin</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO FeeEstimation -&gt; Handler FeeEstimation
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO FeeEstimation -&gt; Handler FeeEstimation)
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
-&gt; Handler FeeEstimation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Coin
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
forall (m :: * -&gt; *).
Monad m =&gt;
ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m FeeEstimation
</span><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier hs-var">W.estimateFee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; ExceptT ErrSelectAssets IO Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481443"><span class="hs-identifier hs-var">fee'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2525"></span><span>            </span><span class="annot"><span class="annottext">(SelectionOf TxOut,
 UnsignedTx
   (TxIn, TxOut, NonEmpty DerivationIndex)
   TxOut
   (TxChange (NonEmpty DerivationIndex))
   (RewardAccount, Coin, NonEmpty DerivationIndex),
 Word64)
-&gt; Handler
     (SelectionOf TxOut,
      UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Word64)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481442"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481445"><span class="hs-identifier hs-var">sel'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481439"><span class="hs-identifier hs-var">estMin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2526"></span><span>
</span><span id="line-2527"></span><span>        </span><span id="local-6989586621682481438"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481438"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO SealedTx -&gt; Handler SealedTx
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2528"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO SealedTx -&gt; Handler SealedTx)
-&gt; ExceptT ErrConstructTx IO SealedTx -&gt; Handler SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrConstructTx IO SealedTx
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasTransactionLayer k ctx, HasDBLayer IO s k ctx,
 HasNetworkLayer IO ctx, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrConstructTx IO SealedTx
</span><a href="Cardano.Wallet.html#constructTransaction"><span class="hs-identifier hs-var">W.constructTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481591"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481589"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481584"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481510"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481487"><span class="hs-identifier hs-var">txCtx'</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481459"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2529"></span><span>
</span><span id="line-2530"></span><span>        </span><span class="annot"><span class="annottext">ApiConstructTransaction n -&gt; Handler (ApiConstructTransaction n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiConstructTransaction n -&gt; Handler (ApiConstructTransaction n))
-&gt; ApiConstructTransaction n -&gt; Handler (ApiConstructTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransaction :: forall (n :: NetworkDiscriminant).
ApiT SealedTx
-&gt; ApiCoinSelection n
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiConstructTransaction n
</span><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransaction"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span>
</span><span id="line-2531"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:transaction:ApiConstructTransaction :: ApiT SealedTx
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atransaction%3AApiConstructTransaction"><span class="hs-identifier hs-var">transaction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; ApiT SealedTx
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481438"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2532"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:coinSelection:ApiConstructTransaction :: ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AcoinSelection%3AApiConstructTransaction"><span class="hs-identifier hs-var">coinSelection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant) input output change withdrawal.
(input ~ (TxIn, TxOut, NonEmpty DerivationIndex), output ~ TxOut,
 change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var">mkApiCoinSelection</span></a></span><span>
</span><span id="line-2533"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; [Coin]
forall a. Maybe a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481509"><span class="hs-identifier hs-var">deposit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; [Coin]
forall a. Maybe a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481508"><span class="hs-identifier hs-var">refund</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (DelegationAction, NonEmpty DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481528"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481458"><span class="hs-identifier hs-var">sel'</span></a></span><span>
</span><span id="line-2534"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fee:ApiConstructTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Afee%3AApiConstructTransaction"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481457"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-2535"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2536"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2537"></span><span>    </span><span class="annot"><a href="#local-6989586621682481521"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2538"></span><span>    </span><span id="local-6989586621682481521"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481521"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481588"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2539"></span><span>
</span><span id="line-2540"></span><span>    </span><span id="local-6989586621682481446"><span class="annot"><span class="annottext">toMintTxOut :: XPub -&gt; ApiMintBurnData n -&gt; ((ApiT Address, Proxy n), TokenMap)
</span><a href="#local-6989586621682481446"><span class="hs-identifier hs-var hs-var">toMintTxOut</span></a></span></span><span> </span><span id="local-6989586621682481431"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682481431"><span class="hs-identifier hs-var">policyXPub</span></a></span></span><span>
</span><span id="line-2541"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintBurnData"><span class="hs-identifier hs-type">ApiMintBurnData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481430"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481430"><span class="hs-identifier hs-var">scriptT</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481429"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481429"><span class="hs-identifier hs-var">tName</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2542"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMint"><span class="hs-identifier hs-type">ApiMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMintData"><span class="hs-identifier hs-type">ApiMintData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481428"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682481428"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481427"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481427"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2543"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481426"><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481426"><span class="hs-identifier hs-var">assetId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481425"><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682481425"><span class="hs-identifier hs-var">tokenQuantity</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2544"></span><span>                        </span><span class="annot"><span class="annottext">Script Cosigner
-&gt; Map Cosigner XPub
-&gt; TokenName
-&gt; Natural
-&gt; (AssetId, TokenQuantity, Script KeyHash)
forall (key :: Depth -&gt; * -&gt; *).
WalletKey key =&gt;
Script Cosigner
-&gt; Map Cosigner XPub
-&gt; TokenName
-&gt; Natural
-&gt; (AssetId, TokenQuantity, Script KeyHash)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#toTokenMapAndScript"><span class="hs-identifier hs-var">toTokenMapAndScript</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481590"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2545"></span><span>                            </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682481430"><span class="hs-identifier hs-var">scriptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner -&gt; XPub -&gt; Map Cosigner XPub
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Cosigner
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682481431"><span class="hs-identifier hs-var">policyXPub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2546"></span><span>                            </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481429"><span class="hs-identifier hs-var">tName</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481427"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-2547"></span><span>                    </span><span id="local-6989586621682481424"><span class="annot"><span class="annottext">assets :: TokenMap
</span><a href="#local-6989586621682481424"><span class="hs-identifier hs-var hs-var">assets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity)] -&gt; TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#fromFlatList"><span class="hs-identifier hs-var">fromFlatList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682481426"><span class="hs-identifier hs-var">assetId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682481425"><span class="hs-identifier hs-var">tokenQuantity</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2548"></span><span>                </span><span class="hs-keyword">in</span><span>
</span><span id="line-2549"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682481428"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481424"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2550"></span><span>    </span><span class="annot"><a href="#local-6989586621682481446"><span class="hs-identifier hs-var">toMintTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiMintBurnData n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ((ApiT Address, Proxy n), TokenMap)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span>
</span><span id="line-2551"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toMintTxOut can only be used in the minting context with addr \
        \specified&quot;</span></span><span>
</span><span id="line-2553"></span><span>
</span><span id="line-2554"></span><span>    </span><span id="local-6989586621682481447"><span class="annot"><span class="annottext">coalesceTokensPerAddr :: [((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut]
</span><a href="#local-6989586621682481447"><span class="hs-identifier hs-var hs-var">coalesceTokensPerAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2555"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481423"><span class="annot"><span class="annottext">toTxOut :: ((ApiT Address, Proxy n), TokenMap) -&gt; TxOut
</span><a href="#local-6989586621682481423"><span class="hs-identifier hs-var hs-var">toTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481422"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682481422"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481421"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481421"><span class="hs-identifier hs-var">assets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2556"></span><span>                </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall (n :: NetworkDiscriminant).
AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var">addressAmountToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n) -&gt; TxOut)
-&gt; AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2557"></span><span>                </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="Cardano.Wallet.Api.Types.html#AddressAmount"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682481422"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481421"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2558"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-2559"></span><span>        </span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n), TokenMap) -&gt; TxOut)
-&gt; [((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Address, Proxy n), TokenMap) -&gt; TxOut
forall (n :: NetworkDiscriminant).
((ApiT Address, Proxy n), TokenMap) -&gt; TxOut
</span><a href="#local-6989586621682481423"><span class="hs-identifier hs-var">toTxOut</span></a></span><span>
</span><span id="line-2560"></span><span>            </span><span class="annot"><span class="annottext">([((ApiT Address, Proxy n), TokenMap)] -&gt; [TxOut])
-&gt; ([((ApiT Address, Proxy n), TokenMap)]
    -&gt; [((ApiT Address, Proxy n), TokenMap)])
-&gt; [((ApiT Address, Proxy n), TokenMap)]
-&gt; [TxOut]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ApiT Address, Proxy n) TokenMap
-&gt; [((ApiT Address, Proxy n), TokenMap)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span>
</span><span id="line-2561"></span><span>            </span><span class="annot"><span class="annottext">(Map (ApiT Address, Proxy n) TokenMap
 -&gt; [((ApiT Address, Proxy n), TokenMap)])
-&gt; ([((ApiT Address, Proxy n), TokenMap)]
    -&gt; Map (ApiT Address, Proxy n) TokenMap)
-&gt; [((ApiT Address, Proxy n), TokenMap)]
-&gt; [((ApiT Address, Proxy n), TokenMap)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n), TokenMap)
 -&gt; Map (ApiT Address, Proxy n) TokenMap
 -&gt; Map (ApiT Address, Proxy n) TokenMap)
-&gt; Map (ApiT Address, Proxy n) TokenMap
-&gt; [((ApiT Address, Proxy n), TokenMap)]
-&gt; Map (ApiT Address, Proxy n) TokenMap
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT Address, Proxy n)
 -&gt; TokenMap
 -&gt; Map (ApiT Address, Proxy n) TokenMap
 -&gt; Map (ApiT Address, Proxy n) TokenMap)
-&gt; ((ApiT Address, Proxy n), TokenMap)
-&gt; Map (ApiT Address, Proxy n) TokenMap
-&gt; Map (ApiT Address, Proxy n) TokenMap
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TokenMap -&gt; TokenMap -&gt; TokenMap)
-&gt; (ApiT Address, Proxy n)
-&gt; TokenMap
-&gt; Map (ApiT Address, Proxy n) TokenMap
-&gt; Map (ApiT Address, Proxy n) TokenMap
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; TokenMap
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (ApiT Address, Proxy n) TokenMap
forall k a. Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#decodeValidityInterval"><span class="hs-identifier hs-type">decodeValidityInterval</span></a></span><span>
</span><span id="line-2564"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2565"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityInterval"><span class="hs-identifier hs-type">ApiValidityInterval</span></a></span><span>
</span><span id="line-2566"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2567"></span><span id="decodeValidityInterval"><span class="annot"><span class="annottext">decodeValidityInterval :: TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe ApiValidityInterval -&gt; Handler (SlotNo, SlotNo, Bool)
</span><a href="Cardano.Wallet.Api.Server.html#decodeValidityInterval"><span class="hs-identifier hs-var hs-var">decodeValidityInterval</span></a></span></span><span> </span><span id="local-6989586621682481415"><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481415"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682481414"><span class="annot"><span class="annottext">Maybe ApiValidityInterval
</span><a href="#local-6989586621682481414"><span class="hs-identifier hs-var">validityInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2568"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481413"><span class="annot"><span class="annottext">isValidityBoundTimeNegative :: ApiValidityBound -&gt; Bool
</span><a href="#local-6989586621682481413"><span class="hs-identifier hs-var hs-var">isValidityBoundTimeNegative</span></a></span></span><span>
</span><span id="line-2569"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundAsTimeFromNow"><span class="hs-identifier hs-type">ApiValidityBoundAsTimeFromNow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682481411"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682481411"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682481411"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2570"></span><span>        </span><span class="annot"><a href="#local-6989586621682481413"><span class="hs-identifier hs-var">isValidityBoundTimeNegative</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2571"></span><span>
</span><span id="line-2572"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481410"><span class="annot"><span class="annottext">isThereNegativeTime :: Bool
</span><a href="#local-6989586621682481410"><span class="hs-identifier hs-var hs-var">isThereNegativeTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ApiValidityInterval
</span><a href="#local-6989586621682481414"><span class="hs-identifier hs-var">validityInterval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2573"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityInterval"><span class="hs-identifier hs-type">ApiValidityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481408"><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481408"><span class="hs-identifier hs-var">before'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2574"></span><span>                </span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Bool
</span><a href="#local-6989586621682481413"><span class="hs-identifier hs-var">isValidityBoundTimeNegative</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481408"><span class="hs-identifier hs-var">before'</span></a></span><span>
</span><span id="line-2575"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityInterval"><span class="hs-identifier hs-type">ApiValidityInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481407"><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481407"><span class="hs-identifier hs-var">hereafter'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2576"></span><span>                </span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Bool
</span><a href="#local-6989586621682481413"><span class="hs-identifier hs-var">isValidityBoundTimeNegative</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481407"><span class="hs-identifier hs-var">hereafter'</span></a></span><span>
</span><span id="line-2577"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityInterval"><span class="hs-identifier hs-type">ApiValidityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481406"><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481406"><span class="hs-identifier hs-var">before'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481405"><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481405"><span class="hs-identifier hs-var">hereafter'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2578"></span><span>                </span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Bool
</span><a href="#local-6989586621682481413"><span class="hs-identifier hs-var">isValidityBoundTimeNegative</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481406"><span class="hs-identifier hs-var">before'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-2579"></span><span>                </span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Bool
</span><a href="#local-6989586621682481413"><span class="hs-identifier hs-var">isValidityBoundTimeNegative</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481405"><span class="hs-identifier hs-var">hereafter'</span></a></span><span>
</span><span id="line-2580"></span><span>            </span><span class="annot"><span class="annottext">Maybe ApiValidityInterval
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2581"></span><span>
</span><span id="line-2582"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481404"><span class="annot"><span class="annottext">fromValidityBound :: Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var hs-var">fromValidityBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO SlotNo -&gt; Handler SlotNo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlotNo -&gt; Handler SlotNo)
-&gt; (Either ApiValidityBound ApiValidityBound -&gt; IO SlotNo)
-&gt; Either ApiValidityBound ApiValidityBound
-&gt; Handler SlotNo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2583"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundUnspecified"><span class="hs-identifier hs-var">ApiValidityBoundUnspecified</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2584"></span><span>                </span><span class="annot"><span class="annottext">SlotNo -&gt; IO SlotNo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; IO SlotNo) -&gt; SlotNo -&gt; IO SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var">SlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2585"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundUnspecified"><span class="hs-identifier hs-var">ApiValidityBoundUnspecified</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2586"></span><span>                </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481415"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2587"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundAsTimeFromNow"><span class="hs-identifier hs-type">ApiValidityBoundAsTimeFromNow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682481401"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682481401"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2588"></span><span>                </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481415"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Maybe NominalDiffTime
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682481401"><span class="hs-identifier hs-var">sec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2589"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundAsTimeFromNow"><span class="hs-identifier hs-type">ApiValidityBoundAsTimeFromNow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682481400"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682481400"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2590"></span><span>                </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481415"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Maybe NominalDiffTime
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682481400"><span class="hs-identifier hs-var">sec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2591"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundAsSlot"><span class="hs-identifier hs-type">ApiValidityBoundAsSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682481398"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481398"><span class="hs-identifier hs-var">slot</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2592"></span><span>                </span><span class="annot"><span class="annottext">SlotNo -&gt; IO SlotNo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; IO SlotNo) -&gt; SlotNo -&gt; IO SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var">SlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481398"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-2593"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundAsSlot"><span class="hs-identifier hs-type">ApiValidityBoundAsSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682481397"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481397"><span class="hs-identifier hs-var">slot</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2594"></span><span>                </span><span class="annot"><span class="annottext">SlotNo -&gt; IO SlotNo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; IO SlotNo) -&gt; SlotNo -&gt; IO SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-var">SlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481397"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-2595"></span><span>
</span><span id="line-2596"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481396"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481396"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481395"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481395"><span class="hs-identifier hs-var">hereafter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ApiValidityInterval
</span><a href="#local-6989586621682481414"><span class="hs-identifier hs-var">validityInterval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2597"></span><span>        </span><span class="annot"><span class="annottext">Maybe ApiValidityInterval
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2598"></span><span>            </span><span id="local-6989586621682481394"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481394"><span class="hs-identifier hs-var">before'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2599"></span><span>                </span><span class="annot"><span class="annottext">Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var">fromValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Either ApiValidityBound ApiValidityBound
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundUnspecified"><span class="hs-identifier hs-var">ApiValidityBoundUnspecified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2600"></span><span>            </span><span id="local-6989586621682481393"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481393"><span class="hs-identifier hs-var">hereafter'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2601"></span><span>                </span><span class="annot"><span class="annottext">Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var">fromValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Either ApiValidityBound ApiValidityBound
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundUnspecified"><span class="hs-identifier hs-var">ApiValidityBoundUnspecified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2602"></span><span>            </span><span class="annot"><span class="annottext">(SlotNo, SlotNo) -&gt; Handler (SlotNo, SlotNo)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481394"><span class="hs-identifier hs-var">before'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481393"><span class="hs-identifier hs-var">hereafter'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2603"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiValidityInterval"><span class="hs-identifier hs-type">ApiValidityInterval</span></a></span><span> </span><span id="local-6989586621682481392"><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="#local-6989586621682481392"><span class="hs-identifier hs-var">before'</span></a></span></span><span> </span><span id="local-6989586621682481391"><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="#local-6989586621682481391"><span class="hs-identifier hs-var">hereafter'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2604"></span><span>            </span><span id="local-6989586621682481390"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481390"><span class="hs-identifier hs-var">before''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="#local-6989586621682481392"><span class="hs-identifier hs-var">before'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2605"></span><span>                </span><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2606"></span><span>                    </span><span class="annot"><span class="annottext">Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var">fromValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Either ApiValidityBound ApiValidityBound
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundUnspecified"><span class="hs-identifier hs-var">ApiValidityBoundUnspecified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2607"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481389"><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481389"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2608"></span><span>                    </span><span class="annot"><span class="annottext">Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var">fromValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Either ApiValidityBound ApiValidityBound
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481389"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2609"></span><span>            </span><span id="local-6989586621682481388"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481388"><span class="hs-identifier hs-var">hereafter''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="#local-6989586621682481391"><span class="hs-identifier hs-var">hereafter'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2610"></span><span>                </span><span class="annot"><span class="annottext">Maybe ApiValidityBound
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2611"></span><span>                    </span><span class="annot"><span class="annottext">Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var">fromValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Either ApiValidityBound ApiValidityBound
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="Cardano.Wallet.Api.Types.html#ApiValidityBoundUnspecified"><span class="hs-identifier hs-var">ApiValidityBoundUnspecified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2612"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481387"><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481387"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2613"></span><span>                    </span><span class="annot"><span class="annottext">Either ApiValidityBound ApiValidityBound -&gt; Handler SlotNo
</span><a href="#local-6989586621682481404"><span class="hs-identifier hs-var">fromValidityBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiValidityBound -&gt; Either ApiValidityBound ApiValidityBound
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiValidityBound
</span><a href="#local-6989586621682481387"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2614"></span><span>            </span><span class="annot"><span class="annottext">(SlotNo, SlotNo) -&gt; Handler (SlotNo, SlotNo)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481390"><span class="hs-identifier hs-var">before''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481388"><span class="hs-identifier hs-var">hereafter''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2615"></span><span>
</span><span id="line-2616"></span><span>    </span><span class="annot"><span class="annottext">(SlotNo, SlotNo, Bool) -&gt; Handler (SlotNo, SlotNo, Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481396"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481395"><span class="hs-identifier hs-var">hereafter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481410"><span class="hs-identifier hs-var">isThereNegativeTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2617"></span><span>
</span><span id="line-2618"></span><span class="hs-comment">-- TO-DO delegations/withdrawals</span><span>
</span><span id="line-2619"></span><span class="hs-comment">-- TO-DO minting/burning</span><span>
</span><span id="line-2620"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#constructSharedTransaction"><span class="hs-identifier hs-type">constructSharedTransaction</span></a></span><span>
</span><span id="line-2621"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481386"><span class="annot"><a href="#local-6989586621682481386"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481385"><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481384"><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481383"><span class="annot"><a href="#local-6989586621682481383"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2622"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span>
</span><span id="line-2623"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#SharedState"><span class="hs-identifier hs-type">SharedState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481383"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2624"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682481386"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2625"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2626"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481386"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2627"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2628"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2629"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2630"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481386"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2631"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2632"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2633"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier hs-type">PoolLifeCycleStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2634"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2635"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransactionData"><span class="hs-identifier hs-type">ApiConstructTransactionData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481383"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2636"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransaction"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481383"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2637"></span><span id="constructSharedTransaction"><span class="annot"><span class="annottext">constructSharedTransaction :: ctx
-&gt; ArgGenChange s
-&gt; IO (Set PoolId)
-&gt; (PoolId -&gt; IO PoolLifeCycleStatus)
-&gt; ApiT WalletId
-&gt; ApiConstructTransactionData n
-&gt; Handler (ApiConstructTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#constructSharedTransaction"><span class="hs-identifier hs-var hs-var">constructSharedTransaction</span></a></span></span><span>
</span><span id="line-2638"></span><span>    </span><span id="local-6989586621682481382"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481382"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481381"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481381"><span class="hs-identifier hs-var">genChange</span></a></span></span><span> </span><span id="local-6989586621682481380"><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682481380"><span class="hs-identifier hs-var">_knownPools</span></a></span></span><span> </span><span id="local-6989586621682481379"><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682481379"><span class="hs-identifier hs-var">_getPoolStatus</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481378"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481378"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481377"><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2639"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481376"><span class="annot"><span class="annottext">isNoPayload :: Bool
</span><a href="#local-6989586621682481376"><span class="hs-identifier hs-var hs-var">isNoPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2640"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ApiPaymentDestination n) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (ApiPaymentDestination n)
     -&gt; Const
          (Maybe (ApiPaymentDestination n))
          (Maybe (ApiPaymentDestination n)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
-&gt; Maybe (ApiPaymentDestination n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((Maybe (ApiPaymentDestination n)
    -&gt; Const
         (Maybe (ApiPaymentDestination n))
         (Maybe (ApiPaymentDestination n)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
(Maybe (ApiPaymentDestination n)
 -&gt; Const
      (Maybe (ApiPaymentDestination n))
      (Maybe (ApiPaymentDestination n)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481375"><span class="hs-var">#payments</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2641"></span><span>            </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe ApiWithdrawalPostData
     -&gt; Const
          (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n))
-&gt; Maybe ApiWithdrawalPostData
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawal&quot;
  ((Maybe ApiWithdrawalPostData
    -&gt; Const
         (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n))
(Maybe ApiWithdrawalPostData
 -&gt; Const
      (Maybe ApiWithdrawalPostData) (Maybe ApiWithdrawalPostData))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe ApiWithdrawalPostData) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481374"><span class="hs-var">#withdrawal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2642"></span><span>            </span><span class="annot"><span class="annottext">Maybe TxMetadataWithSchema -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe TxMetadataWithSchema
     -&gt; Const (Maybe TxMetadataWithSchema) (Maybe TxMetadataWithSchema))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe TxMetadataWithSchema) (ApiConstructTransactionData n))
-&gt; Maybe TxMetadataWithSchema
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema
    -&gt; Const (Maybe TxMetadataWithSchema) (Maybe TxMetadataWithSchema))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe TxMetadataWithSchema) (ApiConstructTransactionData n))
(Maybe TxMetadataWithSchema
 -&gt; Const (Maybe TxMetadataWithSchema) (Maybe TxMetadataWithSchema))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe TxMetadataWithSchema) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481373"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2643"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiMintBurnData n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty (ApiMintBurnData n))
     -&gt; Const
          (Maybe (NonEmpty (ApiMintBurnData n)))
          (Maybe (NonEmpty (ApiMintBurnData n))))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty (ApiMintBurnData n)))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty (ApiMintBurnData n))
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mintBurn&quot;
  ((Maybe (NonEmpty (ApiMintBurnData n))
    -&gt; Const
         (Maybe (NonEmpty (ApiMintBurnData n)))
         (Maybe (NonEmpty (ApiMintBurnData n))))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty (ApiMintBurnData n)))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty (ApiMintBurnData n))
 -&gt; Const
      (Maybe (NonEmpty (ApiMintBurnData n)))
      (Maybe (NonEmpty (ApiMintBurnData n))))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty (ApiMintBurnData n)))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481372"><span class="hs-var">#mintBurn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-2644"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty ApiMultiDelegationAction) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (NonEmpty ApiMultiDelegationAction)
     -&gt; Const
          (Maybe (NonEmpty ApiMultiDelegationAction))
          (Maybe (NonEmpty ApiMultiDelegationAction)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (ApiConstructTransactionData n))
-&gt; Maybe (NonEmpty ApiMultiDelegationAction)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegations&quot;
  ((Maybe (NonEmpty ApiMultiDelegationAction)
    -&gt; Const
         (Maybe (NonEmpty ApiMultiDelegationAction))
         (Maybe (NonEmpty ApiMultiDelegationAction)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (NonEmpty ApiMultiDelegationAction))
        (ApiConstructTransactionData n))
(Maybe (NonEmpty ApiMultiDelegationAction)
 -&gt; Const
      (Maybe (NonEmpty ApiMultiDelegationAction))
      (Maybe (NonEmpty ApiMultiDelegationAction)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (NonEmpty ApiMultiDelegationAction))
     (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481371"><span class="hs-var">#delegations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2645"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481376"><span class="hs-identifier hs-var">isNoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2646"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongPayload"><span class="hs-identifier hs-var">ErrConstructTxWrongPayload</span></a></span><span>
</span><span id="line-2647"></span><span>
</span><span id="line-2648"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481370"><span class="annot"><span class="annottext">md :: Maybe TxMetadata
</span><a href="#local-6989586621682481370"><span class="hs-identifier hs-var hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; ApiConstructTransactionData n
    -&gt; Const (First TxMetadata) (ApiConstructTransactionData n))
-&gt; Maybe TxMetadata
forall s a.
s
-&gt; ((a -&gt; Const (First a) a) -&gt; s -&gt; Const (First a) s) -&gt; Maybe a
</span><a href="Cardano.Wallet.Compat.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
   -&gt; ApiConstructTransactionData n
   -&gt; Const (First TxMetadata) (ApiConstructTransactionData n))
(Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; ApiConstructTransactionData n
-&gt; Const (First TxMetadata) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481369"><span class="hs-var">#metadata</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe TxMetadataWithSchema
  -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
 -&gt; ApiConstructTransactionData n
 -&gt; Const (First TxMetadata) (ApiConstructTransactionData n))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; Maybe TxMetadataWithSchema
    -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; ApiConstructTransactionData n
-&gt; Const (First TxMetadata) (ApiConstructTransactionData n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadataWithSchema
 -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMetadataWithSchema
  -&gt; Const (First TxMetadata) TxMetadataWithSchema)
 -&gt; Maybe TxMetadataWithSchema
 -&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema))
-&gt; ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
    -&gt; TxMetadataWithSchema
    -&gt; Const (First TxMetadata) TxMetadataWithSchema)
-&gt; (TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; Maybe TxMetadataWithSchema
-&gt; Const (First TxMetadata) (Maybe TxMetadataWithSchema)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadataWithSchema_metadata&quot;
  ((TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
   -&gt; TxMetadataWithSchema
   -&gt; Const (First TxMetadata) TxMetadataWithSchema)
(TxMetadata -&gt; Const (First TxMetadata) TxMetadata)
-&gt; TxMetadataWithSchema
-&gt; Const (First TxMetadata) TxMetadataWithSchema
</span><a href="#local-6989586621682481368"><span class="hs-var">#txMetadataWithSchema_metadata</span></a></span><span>
</span><span id="line-2649"></span><span>
</span><span id="line-2650"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481367"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481367"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481366"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481366"><span class="hs-identifier hs-var">hereafter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481365"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481365"><span class="hs-identifier hs-var">isThereNegativeTime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2651"></span><span>        </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe ApiValidityInterval -&gt; Handler (SlotNo, SlotNo, Bool)
</span><a href="Cardano.Wallet.Api.Server.html#decodeValidityInterval"><span class="hs-identifier hs-var">decodeValidityInterval</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481364"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe ApiValidityInterval
     -&gt; Const (Maybe ApiValidityInterval) (Maybe ApiValidityInterval))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe ApiValidityInterval) (ApiConstructTransactionData n))
-&gt; Maybe ApiValidityInterval
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;validityInterval&quot;
  ((Maybe ApiValidityInterval
    -&gt; Const (Maybe ApiValidityInterval) (Maybe ApiValidityInterval))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe ApiValidityInterval) (ApiConstructTransactionData n))
(Maybe ApiValidityInterval
 -&gt; Const (Maybe ApiValidityInterval) (Maybe ApiValidityInterval))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe ApiValidityInterval) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481363"><span class="hs-var">#validityInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2652"></span><span>
</span><span id="line-2653"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481366"><span class="hs-identifier hs-var">hereafter</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481367"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682481365"><span class="hs-identifier hs-var">isThereNegativeTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2654"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO () -&gt; Handler ())
-&gt; ExceptT ErrConstructTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx -&gt; ExceptT ErrConstructTx IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongValidityBounds"><span class="hs-identifier hs-var">ErrConstructTxWrongValidityBounds</span></a></span><span>
</span><span id="line-2655"></span><span>
</span><span id="line-2656"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481362"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682481362"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-2657"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span>
</span><span id="line-2658"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:TransactionCtx :: Maybe TxMetadata
</span><a href="#local-6989586621682482015"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481370"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-2659"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Maybe SlotNo
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481367"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481366"><span class="hs-identifier hs-var">hereafter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2660"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DelegationAction
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2661"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2662"></span><span>
</span><span id="line-2663"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481360"><span class="annot"><span class="annottext">transform :: s
-&gt; Selection
-&gt; (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex),
    Selection, Coin)
</span><a href="#local-6989586621682481360"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span id="local-6989586621682481359"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481359"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682481358"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481358"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2664"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
forall s.
GenChange s =&gt;
ArgGenChange s -&gt; Selection -&gt; s -&gt; (SelectionOf TxOut, s)
</span><a href="Cardano.Wallet.html#assignChangeAddresses"><span class="hs-identifier hs-var">W.assignChangeAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481381"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481358"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481359"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2665"></span><span>                </span><span class="annot"><span class="annottext">(SelectionOf TxOut, s)
-&gt; ((SelectionOf TxOut, s)
    -&gt; UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionOf TxOut
 -&gt; s
 -&gt; UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; (SelectionOf TxOut, s)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall s input output change withdrawal.
(IsOurs s Address, input ~ (TxIn, TxOut, NonEmpty DerivationIndex),
 output ~ TxOut, change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var">W.selectionToUnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransactionCtx -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481362"><span class="hs-identifier hs-var">txCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2666"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481358"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2667"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; Selection -&gt; Coin
forall change. (change -&gt; Coin) -&gt; SelectionOf change -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#selectionDelta"><span class="hs-identifier hs-var">selectionDelta</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481358"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2668"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-2669"></span><span>
</span><span id="line-2670"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiConstructTransaction n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiConstructTransaction n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiConstructTransaction n))
-&gt; Handler (ApiConstructTransaction n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481382"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481378"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiConstructTransaction n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiConstructTransaction n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiConstructTransaction n))
 -&gt; Handler (ApiConstructTransaction n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiConstructTransaction n))
-&gt; Handler (ApiConstructTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481357"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2671"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481356"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481356"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO (Wallet s, WalletMetadata, Set Tx)
-&gt; Handler (Wallet s, WalletMetadata, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO (Wallet s, WalletMetadata, Set Tx)
 -&gt; Handler (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrConstructTx IO (Wallet s, WalletMetadata, Set Tx)
-&gt; Handler (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrConstructTx)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT ErrConstructTx IO (Wallet s, WalletMetadata, Set Tx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxNoSuchWallet"><span class="hs-identifier hs-var">ErrConstructTxNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
 -&gt; ExceptT ErrConstructTx IO (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT ErrConstructTx IO (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2672"></span><span>            </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">W.readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481378"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2673"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SharedState n SharedKey -&gt; Readiness (SharedAddressPools SharedKey)
forall (n :: NetworkDiscriminant) (k :: Depth -&gt; * -&gt; *).
SharedState n k -&gt; Readiness (SharedAddressPools k)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ready"><span class="hs-identifier hs-var hs-var">Shared.ready</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481356"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2674"></span><span>            </span><span class="annot"><span class="annottext">Readiness (SharedAddressPools SharedKey)
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#Pending"><span class="hs-identifier hs-var">Shared.Pending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2675"></span><span>                </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO (ApiConstructTransaction n)
-&gt; Handler (ApiConstructTransaction n)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO (ApiConstructTransaction n)
 -&gt; Handler (ApiConstructTransaction n))
-&gt; ExceptT ErrConstructTx IO (ApiConstructTransaction n)
-&gt; Handler (ApiConstructTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
-&gt; ExceptT ErrConstructTx IO (ApiConstructTransaction n)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxSharedWalletPending"><span class="hs-identifier hs-var">ErrConstructTxSharedWalletPending</span></a></span><span>
</span><span id="line-2676"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#Active"><span class="hs-identifier hs-type">Shared.Active</span></a></span><span> </span><span class="annot"><span class="annottext">SharedAddressPools SharedKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2677"></span><span>                </span><span id="local-6989586621682481353"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481353"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SharedState n SharedKey) SharedKey
    -&gt; Const
         (NetworkLayer IO Block)
         (WalletLayer IO (SharedState n SharedKey) SharedKey))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; Const
     (NetworkLayer IO Block)
     (WalletLayer IO (SharedState n SharedKey) SharedKey)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2678"></span><span>                </span><span id="local-6989586621682481352"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481352"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SharedState n SharedKey) SharedKey
    -&gt; Const
         (NetworkLayer IO Block)
         (WalletLayer IO (SharedState n SharedKey) SharedKey))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; Const
     (NetworkLayer IO Block)
     (WalletLayer IO (SharedState n SharedKey) SharedKey)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2679"></span><span>
</span><span id="line-2680"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682481351"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481351"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481350"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682481350"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481349"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682481349"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2681"></span><span>                    </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481378"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2682"></span><span>
</span><span id="line-2683"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481348"><span class="annot"><span class="annottext">runSelection :: [TxOut]
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
</span><a href="#local-6989586621682481348"><span class="hs-identifier hs-var hs-var">runSelection</span></a></span></span><span> </span><span id="local-6989586621682481347"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481347"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams
     s
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
-&gt; (s
    -&gt; Selection
    -&gt; (UnsignedTx
          (TxIn, TxOut, NonEmpty DerivationIndex)
          TxOut
          (TxChange (NonEmpty DerivationIndex))
          (RewardAccount, Coin, NonEmpty DerivationIndex),
        Selection, Coin))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2684"></span><span>                        </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481352"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481353"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex),
   Selection, Coin)
</span><a href="#local-6989586621682481346"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Selection
-&gt; (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex),
    Selection, Coin)
</span><a href="#local-6989586621682481360"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-2685"></span><span>                      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2686"></span><span>                        </span><span id="local-6989586621682481346"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams
  s
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex),
   Selection, Coin)
</span><a href="#local-6989586621682481346"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-2687"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481347"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2688"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682481349"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-2689"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2690"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481362"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-2691"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2692"></span><span>                                </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481351"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2693"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2694"></span><span>                                </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682481351"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-2695"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682481350"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-2696"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-2697"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-2698"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682481345"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481345"><span class="hs-identifier hs-var">sel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481344"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481344"><span class="hs-identifier hs-var">sel'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481343"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481343"><span class="hs-identifier hs-var">fee</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2699"></span><span>                    </span><span id="local-6989586621682481342"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481342"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiConstructTransactionData n
</span><a href="#local-6989586621682481377"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransactionData n
-&gt; ((Maybe (ApiPaymentDestination n)
     -&gt; Const
          (Maybe (ApiPaymentDestination n))
          (Maybe (ApiPaymentDestination n)))
    -&gt; ApiConstructTransactionData n
    -&gt; Const
         (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
-&gt; Maybe (ApiPaymentDestination n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;payments&quot;
  ((Maybe (ApiPaymentDestination n)
    -&gt; Const
         (Maybe (ApiPaymentDestination n))
         (Maybe (ApiPaymentDestination n)))
   -&gt; ApiConstructTransactionData n
   -&gt; Const
        (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n))
(Maybe (ApiPaymentDestination n)
 -&gt; Const
      (Maybe (ApiPaymentDestination n))
      (Maybe (ApiPaymentDestination n)))
-&gt; ApiConstructTransactionData n
-&gt; Const
     (Maybe (ApiPaymentDestination n)) (ApiConstructTransactionData n)
</span><a href="#local-6989586621682481341"><span class="hs-var">#payments</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2700"></span><span>                        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPaymentAddresses"><span class="hs-identifier hs-type">ApiPaymentAddresses</span></a></span><span> </span><span id="local-6989586621682481340"><span class="annot"><span class="annottext">NonEmpty (AddressAmount (ApiAddressIdT n))
</span><a href="#local-6989586621682481340"><span class="hs-identifier hs-var">content</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2701"></span><span>                            </span><span class="annot"><span class="annottext">[TxOut] -&gt; Handler [TxOut]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; Handler [TxOut]) -&gt; [TxOut] -&gt; Handler [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TxOut -&gt; [TxOut]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
forall (n :: NetworkDiscriminant).
AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var">addressAmountToTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n) -&gt; TxOut)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; NonEmpty TxOut
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AddressAmount (ApiT Address, Proxy n))
NonEmpty (AddressAmount (ApiAddressIdT n))
</span><a href="#local-6989586621682481340"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2702"></span><span>                        </span><span class="annot"><span class="annottext">Maybe (ApiPaymentDestination n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2703"></span><span>                            </span><span class="annot"><span class="annottext">[TxOut] -&gt; Handler [TxOut]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2704"></span><span>
</span><span id="line-2705"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682481339"><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481339"><span class="hs-identifier hs-var">sel'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481338"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481338"><span class="hs-identifier hs-var">utx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481337"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481337"><span class="hs-identifier hs-var">fee'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrSelectAssets
  IO
  (UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex),
   Selection, Coin)
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrSelectAssets
   IO
   (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex),
    Selection, Coin)
 -&gt; Handler
      (UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex),
       Selection, Coin))
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
-&gt; Handler
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
-&gt; ExceptT
     ErrSelectAssets
     IO
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Selection, Coin)
</span><a href="#local-6989586621682481348"><span class="hs-identifier hs-var">runSelection</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481342"><span class="hs-identifier hs-var">outs</span></a></span><span>
</span><span id="line-2706"></span><span>                    </span><span id="local-6989586621682481336"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481336"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO (SelectionOf TxOut)
 -&gt; Handler (SelectionOf TxOut))
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2707"></span><span>                        </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; WalletId
-&gt; ArgGenChange (SharedState n SharedKey)
-&gt; Selection
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(GenChange s, HasDBLayer IO s k ctx) =&gt;
ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrConstructTx IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesWithoutDbUpdate"><span class="hs-identifier hs-var">W.assignChangeAddressesWithoutDbUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481378"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange s
ArgGenChange (SharedState n SharedKey)
</span><a href="#local-6989586621682481381"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682481338"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-2708"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-type">FeeEstimation</span></a></span><span> </span><span id="local-6989586621682481335"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481335"><span class="hs-identifier hs-var">estMin</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO FeeEstimation -&gt; Handler FeeEstimation
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO FeeEstimation -&gt; Handler FeeEstimation)
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
-&gt; Handler FeeEstimation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Coin
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
forall (m :: * -&gt; *).
Monad m =&gt;
ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m FeeEstimation
</span><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier hs-var">W.estimateFee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; ExceptT ErrSelectAssets IO Coin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481337"><span class="hs-identifier hs-var">fee'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2709"></span><span>                    </span><span class="annot"><span class="annottext">(SelectionOf TxOut,
 UnsignedTx
   (TxIn, TxOut, NonEmpty DerivationIndex)
   TxOut
   (TxChange (NonEmpty DerivationIndex))
   (RewardAccount, Coin, NonEmpty DerivationIndex),
 Word64)
-&gt; Handler
     (SelectionOf TxOut,
      UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex),
      Word64)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481336"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481339"><span class="hs-identifier hs-var">sel'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481335"><span class="hs-identifier hs-var">estMin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2710"></span><span>
</span><span id="line-2711"></span><span>                </span><span id="local-6989586621682481334"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481334"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrConstructTx IO SealedTx -&gt; Handler SealedTx
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-2712"></span><span>                    </span><span class="annot"><span class="annottext">(ExceptT ErrConstructTx IO SealedTx -&gt; Handler SealedTx)
-&gt; ExceptT ErrConstructTx IO SealedTx -&gt; Handler SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrConstructTx IO SealedTx
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasTransactionLayer k ctx, HasDBLayer IO s k ctx,
 HasNetworkLayer IO ctx, k ~ SharedKey, s ~ SharedState n k) =&gt;
ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrConstructTx IO SealedTx
</span><a href="Cardano.Wallet.html#constructSharedTransaction"><span class="hs-identifier hs-var">W.constructSharedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481385"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481384"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481383"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SharedState n SharedKey) SharedKey
WorkerCtx ctx
</span><a href="#local-6989586621682481357"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481378"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481352"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481362"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682481345"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-2713"></span><span>
</span><span id="line-2714"></span><span>                </span><span class="annot"><span class="annottext">ApiConstructTransaction n -&gt; Handler (ApiConstructTransaction n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiConstructTransaction n -&gt; Handler (ApiConstructTransaction n))
-&gt; ApiConstructTransaction n -&gt; Handler (ApiConstructTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransaction :: forall (n :: NetworkDiscriminant).
ApiT SealedTx
-&gt; ApiCoinSelection n
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiConstructTransaction n
</span><a href="Cardano.Wallet.Api.Types.html#ApiConstructTransaction"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span>
</span><span id="line-2715"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:transaction:ApiConstructTransaction :: ApiT SealedTx
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atransaction%3AApiConstructTransaction"><span class="hs-identifier hs-var">transaction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; ApiT SealedTx
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481334"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2716"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:coinSelection:ApiConstructTransaction :: ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AcoinSelection%3AApiConstructTransaction"><span class="hs-identifier hs-var">coinSelection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant) input output change withdrawal.
(input ~ (TxIn, TxOut, NonEmpty DerivationIndex), output ~ TxOut,
 change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var">mkApiCoinSelection</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe (DelegationAction, NonEmpty DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481370"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481344"><span class="hs-identifier hs-var">sel'</span></a></span><span>
</span><span id="line-2717"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fee:ApiConstructTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Afee%3AApiConstructTransaction"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682481343"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-2718"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2719"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2720"></span><span>    </span><span class="annot"><a href="#local-6989586621682481364"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2721"></span><span>    </span><span id="local-6989586621682481364"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481364"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481382"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2722"></span><span>
</span><span id="line-2723"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#decodeSharedTransaction"><span class="hs-identifier hs-type">decodeSharedTransaction</span></a></span><span>
</span><span id="line-2724"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481332"><span class="annot"><a href="#local-6989586621682481332"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481331"><span class="annot"><a href="#local-6989586621682481331"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481330"><span class="annot"><a href="#local-6989586621682481330"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682481329"><span class="annot"><a href="#local-6989586621682481329"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2725"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481332"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481331"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481330"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2726"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481331"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2727"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481332"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2728"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2729"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481332"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2730"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2731"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span>
</span><span id="line-2732"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiDecodedTransaction"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481329"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2733"></span><span id="decodeSharedTransaction"><span class="annot"><span class="annottext">decodeSharedTransaction :: ctx
-&gt; ApiT WalletId
-&gt; ApiSerialisedTransaction
-&gt; Handler (ApiDecodedTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#decodeSharedTransaction"><span class="hs-identifier hs-var hs-var">decodeSharedTransaction</span></a></span></span><span> </span><span id="local-6989586621682481328"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481328"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481327"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481327"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481326"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481326"><span class="hs-identifier hs-var">sealed</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2734"></span><span>    </span><span id="local-6989586621682481325"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481325"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481324"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2735"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481323"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481323"><span class="hs-identifier hs-var">decodedTx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481322"><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481322"><span class="hs-identifier hs-var">_toMint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481321"><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481321"><span class="hs-identifier hs-var">_toBurn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481320"><span class="annot"><span class="annottext">[Certificate]
</span><a href="#local-6989586621682481320"><span class="hs-identifier hs-var">_allCerts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481319"><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><a href="#local-6989586621682481319"><span class="hs-identifier hs-var">interval</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2736"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; SealedTx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; tx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AdecodeTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">decodeTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682481317"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481325"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481326"><span class="hs-identifier hs-var">sealed</span></a></span><span>
</span><span id="line-2737"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682481315"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
$sel:txId:Tx :: Tx -&gt; Hash &quot;Tx&quot;
txId :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AtxId%3ATx"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span>
</span><span id="line-2738"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481313"><span class="annot"><span class="annottext">Maybe Coin
$sel:fee:Tx :: Tx -&gt; Maybe Coin
fee :: Maybe Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Afee%3ATx"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span>
</span><span id="line-2739"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481311"><span class="annot"><span class="annottext">[(TxIn, Coin)]
$sel:resolvedInputs:Tx :: Tx -&gt; [(TxIn, Coin)]
resolvedInputs :: [(TxIn, Coin)]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AresolvedInputs%3ATx"><span class="hs-identifier hs-var hs-var">resolvedInputs</span></a></span></span><span>
</span><span id="line-2740"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481309"><span class="annot"><span class="annottext">[(TxIn, Coin)]
$sel:resolvedCollateralInputs:Tx :: Tx -&gt; [(TxIn, Coin)]
resolvedCollateralInputs :: [(TxIn, Coin)]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AresolvedCollateralInputs%3ATx"><span class="hs-identifier hs-var hs-var">resolvedCollateralInputs</span></a></span></span><span>
</span><span id="line-2741"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481307"><span class="annot"><span class="annottext">[TxOut]
$sel:outputs:Tx :: Tx -&gt; [TxOut]
outputs :: [TxOut]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Aoutputs%3ATx"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span>
</span><span id="line-2742"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481305"><span class="annot"><span class="annottext">Maybe TxMetadata
$sel:metadata:Tx :: Tx -&gt; Maybe TxMetadata
metadata :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Ametadata%3ATx"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span>
</span><span id="line-2743"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481303"><span class="annot"><span class="annottext">Maybe TxScriptValidity
$sel:scriptValidity:Tx :: Tx -&gt; Maybe TxScriptValidity
scriptValidity :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3AscriptValidity%3ATx"><span class="hs-identifier hs-var hs-var">scriptValidity</span></a></span></span><span>
</span><span id="line-2744"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481323"><span class="hs-identifier hs-var">decodedTx</span></a></span><span>
</span><span id="line-2745"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481301"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481301"><span class="hs-identifier hs-var">txinsOutsPaths</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481300"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481300"><span class="hs-identifier hs-var">collateralInsOutsPaths</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481299"><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481299"><span class="hs-identifier hs-var">outsPath</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2746"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))]))
-&gt; (ErrWalletNotResponding
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))]))
-&gt; (WorkerCtx ctx
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))]))
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))])
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481328"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481327"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))])
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))])
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler
       ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
        [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
        [(TxOut, Maybe (NonEmpty DerivationIndex))]))
 -&gt; Handler
      ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
       [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
       [(TxOut, Maybe (NonEmpty DerivationIndex))]))
-&gt; (WorkerCtx ctx
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))]))
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481298"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481298"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2747"></span><span>        </span><span id="local-6989586621682481297"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481297"><span class="hs-identifier hs-var">inputPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2748"></span><span>            </span><span class="annot"><span class="annottext">ExceptT
  ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
 -&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier hs-var">W.lookupTxIns</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481331"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481330"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481298"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481327"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn]
 -&gt; ExceptT
      ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2749"></span><span>            </span><span class="annot"><span class="annottext">(TxIn, Coin) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, Coin) -&gt; TxIn) -&gt; [(TxIn, Coin)] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682481311"><span class="hs-identifier hs-var">resolvedInputs</span></a></span><span>
</span><span id="line-2750"></span><span>        </span><span id="local-6989586621682481295"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481295"><span class="hs-identifier hs-var">collateralInputPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2751"></span><span>            </span><span class="annot"><span class="annottext">ExceptT
  ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
 -&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier hs-var">W.lookupTxIns</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481331"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481330"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481298"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481327"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn]
 -&gt; ExceptT
      ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2752"></span><span>            </span><span class="annot"><span class="annottext">(TxIn, Coin) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, Coin) -&gt; TxIn) -&gt; [(TxIn, Coin)] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682481309"><span class="hs-identifier hs-var">resolvedCollateralInputs</span></a></span><span>
</span><span id="line-2753"></span><span>        </span><span id="local-6989586621682481294"><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481294"><span class="hs-identifier hs-var">outputPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2754"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; Handler [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
 -&gt; Handler [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; Handler [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; [TxOut]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx
-&gt; WalletId
-&gt; [TxOut]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxOuts"><span class="hs-identifier hs-var">W.lookupTxOuts</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481331"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481330"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481298"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481327"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481307"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-2755"></span><span>        </span><span class="annot"><span class="annottext">([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
 [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
 [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-2756"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481297"><span class="hs-identifier hs-var">inputPaths</span></a></span><span>
</span><span id="line-2757"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481295"><span class="hs-identifier hs-var">collateralInputPaths</span></a></span><span>
</span><span id="line-2758"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481294"><span class="hs-identifier hs-var">outputPaths</span></a></span><span>
</span><span id="line-2759"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-2760"></span><span>    </span><span class="annot"><span class="annottext">ApiDecodedTransaction n -&gt; Handler (ApiDecodedTransaction n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiDecodedTransaction n -&gt; Handler (ApiDecodedTransaction n))
-&gt; ApiDecodedTransaction n -&gt; Handler (ApiDecodedTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction :: forall (n :: NetworkDiscriminant).
ApiT (Hash &quot;Tx&quot;)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; [ApiTxInputGeneral n]
-&gt; [ApiTxOutputGeneral n]
-&gt; [ApiTxInputGeneral n]
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutputGeneral n))
-&gt; [ApiWithdrawalGeneral n]
-&gt; ApiAssetMintBurn
-&gt; ApiAssetMintBurn
-&gt; [ApiAnyCertificate n]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; ApiTxMetadata
-&gt; Maybe (ApiT TxScriptValidity)
-&gt; Maybe ValidityIntervalExplicit
-&gt; ApiDecodedTransaction n
</span><a href="Cardano.Wallet.Api.Types.html#ApiDecodedTransaction"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span>
</span><span id="line-2761"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiDecodedTransaction :: ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiDecodedTransaction"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481315"><span class="hs-identifier hs-var">txId</span></a></span><span>
</span><span id="line-2762"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fee:ApiDecodedTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Afee%3AApiDecodedTransaction"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
-&gt; (Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Maybe Coin
-&gt; Quantity &quot;lovelace&quot; Natural
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481313"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-2763"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:inputs:ApiDecodedTransaction :: [ApiTxInputGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ainputs%3AApiDecodedTransaction"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
 -&gt; ApiTxInputGeneral n)
-&gt; [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; [ApiTxInputGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant).
(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toInp"><span class="hs-identifier hs-var">toInp</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481301"><span class="hs-identifier hs-var">txinsOutsPaths</span></a></span><span>
</span><span id="line-2764"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:ApiDecodedTransaction :: [ApiTxOutputGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aoutputs%3AApiDecodedTransaction"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n)
-&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; [ApiTxOutputGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
(TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toOut"><span class="hs-identifier hs-var">toOut</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481299"><span class="hs-identifier hs-var">outsPath</span></a></span><span>
</span><span id="line-2765"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateral:ApiDecodedTransaction :: [ApiTxInputGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acollateral%3AApiDecodedTransaction"><span class="hs-identifier hs-var">collateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
 -&gt; ApiTxInputGeneral n)
-&gt; [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; [ApiTxInputGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant).
(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toInp"><span class="hs-identifier hs-var">toInp</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481300"><span class="hs-identifier hs-var">collateralInsOutsPaths</span></a></span><span>
</span><span id="line-2766"></span><span>        </span><span class="hs-comment">-- TODO: [ADP-1670]</span><span>
</span><span id="line-2767"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralOutputs:ApiDecodedTransaction :: ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutputGeneral n))
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AcollateralOutputs%3AApiDecodedTransaction"><span class="hs-identifier hs-var">collateralOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiTxOutputGeneral n)
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutputGeneral n))
forall (s :: Symbol) a. a -&gt; ApiAsArray s a
</span><a href="Cardano.Wallet.Api.Types.html#ApiAsArray"><span class="hs-identifier hs-var">ApiAsArray</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiTxOutputGeneral n)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2768"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:ApiDecodedTransaction :: [ApiWithdrawalGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Awithdrawals%3AApiDecodedTransaction"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2769"></span><span>        </span><span class="hs-comment">-- TODO minting/burning multisig</span><span>
</span><span id="line-2770"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:mint:ApiDecodedTransaction :: ApiAssetMintBurn
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Amint%3AApiDecodedTransaction"><span class="hs-identifier hs-var">mint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682481279"><span class="hs-identifier hs-var">emptyApiAssetMntBurn</span></a></span><span>
</span><span id="line-2771"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:burn:ApiDecodedTransaction :: ApiAssetMintBurn
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aburn%3AApiDecodedTransaction"><span class="hs-identifier hs-var">burn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682481279"><span class="hs-identifier hs-var">emptyApiAssetMntBurn</span></a></span><span>
</span><span id="line-2772"></span><span>        </span><span class="hs-comment">-- TODO delegation/withdrawals multisig</span><span>
</span><span id="line-2773"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificates:ApiDecodedTransaction :: [ApiAnyCertificate n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acertificates%3AApiDecodedTransaction"><span class="hs-identifier hs-var">certificates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2774"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositsTaken:ApiDecodedTransaction :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositsTaken%3AApiDecodedTransaction"><span class="hs-identifier hs-var">depositsTaken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2775"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositsReturned:ApiDecodedTransaction :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositsReturned%3AApiDecodedTransaction"><span class="hs-identifier hs-var">depositsReturned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2776"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:metadata:ApiDecodedTransaction :: ApiTxMetadata
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ametadata%3AApiDecodedTransaction"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="Cardano.Wallet.Api.Types.html#ApiTxMetadata"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata)
-&gt; Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadata -&gt; ApiT TxMetadata
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; ApiT TxMetadata)
-&gt; Maybe TxMetadata -&gt; Maybe (ApiT TxMetadata)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481305"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-2777"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:scriptValidity:ApiDecodedTransaction :: Maybe (ApiT TxScriptValidity)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AscriptValidity%3AApiDecodedTransaction"><span class="hs-identifier hs-var">scriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity -&gt; ApiT TxScriptValidity
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TxScriptValidity -&gt; ApiT TxScriptValidity)
-&gt; Maybe TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxScriptValidity
</span><a href="#local-6989586621682481303"><span class="hs-identifier hs-var">scriptValidity</span></a></span><span>
</span><span id="line-2778"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:validityInterval:ApiDecodedTransaction :: Maybe ValidityIntervalExplicit
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AvalidityInterval%3AApiDecodedTransaction"><span class="hs-identifier hs-var">validityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><a href="#local-6989586621682481319"><span class="hs-identifier hs-var">interval</span></a></span><span>
</span><span id="line-2779"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2780"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2781"></span><span>    </span><span id="local-6989586621682481317"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682481317"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481328"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">W.transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481330"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2782"></span><span>    </span><span id="local-6989586621682481324"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682481324"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481328"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasNetworkLayer IO ctx =&gt;
Lens' ctx (NetworkLayer IO Block)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">W.networkLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-2783"></span><span>
</span><span id="line-2784"></span><span>    </span><span id="local-6989586621682481279"><span class="annot"><span class="annottext">emptyApiAssetMntBurn :: ApiAssetMintBurn
</span><a href="#local-6989586621682481279"><span class="hs-identifier hs-var hs-var">emptyApiAssetMntBurn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="Cardano.Wallet.Api.Types.html#ApiAssetMintBurn"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-2785"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atokens%3AApiAssetMintBurn"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2786"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AwalletPolicyKeyHash%3AApiAssetMintBurn"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiPolicyKey
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2787"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AwalletPolicyKeyIndex%3AApiAssetMintBurn"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2788"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2789"></span><span>
</span><span id="line-2790"></span><span class="hs-comment">-- TODO: Most of the body of this function should really belong to</span><span>
</span><span id="line-2791"></span><span class="hs-comment">-- Cardano.Wallet to keep the Api.Server module free of business logic!</span><span>
</span><span id="line-2792"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#balanceTransaction"><span class="hs-identifier hs-type">balanceTransaction</span></a></span><span>
</span><span id="line-2793"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481266"><span class="annot"><a href="#local-6989586621682481266"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481265"><span class="annot"><a href="#local-6989586621682481265"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481264"><span class="annot"><a href="#local-6989586621682481264"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481263"><span class="annot"><a href="#local-6989586621682481263"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-2794"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481266"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481265"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481264"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2795"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481266"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2796"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481265"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2797"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481264"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2798"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2799"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481266"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2800"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481265"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2801"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2802"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBalanceTransactionPostData"><span class="hs-identifier hs-type">ApiBalanceTransactionPostData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481263"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2803"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span>
</span><span id="line-2804"></span><span id="balanceTransaction"><span class="annot"><span class="annottext">balanceTransaction :: ctx
-&gt; ArgGenChange s
-&gt; ApiT WalletId
-&gt; ApiBalanceTransactionPostData n
-&gt; Handler ApiSerialisedTransaction
</span><a href="Cardano.Wallet.Api.Server.html#balanceTransaction"><span class="hs-identifier hs-var hs-var">balanceTransaction</span></a></span></span><span> </span><span id="local-6989586621682481262"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481262"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481261"><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481261"><span class="hs-identifier hs-var">genChange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481260"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481260"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481259"><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
</span><a href="#local-6989586621682481259"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2805"></span><span>    </span><span class="hs-comment">-- NOTE: Ideally we'd read @pp@ and @era@ atomically.</span><span>
</span><span id="line-2806"></span><span>    </span><span id="local-6989586621682481258"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481258"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481257"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2807"></span><span>    </span><span class="hs-comment">-- TODO: This throws when still in the Byron era.</span><span>
</span><span id="line-2808"></span><span>    </span><span id="local-6989586621682481256"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481256"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481257"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2809"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481255"><span class="annot"><span class="annottext">nodePParams :: ProtocolParameters
</span><a href="#local-6989586621682481255"><span class="hs-identifier hs-var hs-var">nodePParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ProtocolParameters -&gt; ProtocolParameters
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ProtocolParameters -&gt; ProtocolParameters)
-&gt; Maybe ProtocolParameters -&gt; ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Maybe ProtocolParameters
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AcurrentNodeProtocolParameters%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.currentNodeProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481258"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2810"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ApiSerialisedTransaction)
-&gt; (ErrWalletNotResponding -&gt; Handler ApiSerialisedTransaction)
-&gt; (WorkerCtx ctx -&gt; Handler ApiSerialisedTransaction)
-&gt; Handler ApiSerialisedTransaction
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481262"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481260"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ApiSerialisedTransaction
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ApiSerialisedTransaction
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ApiSerialisedTransaction)
 -&gt; Handler ApiSerialisedTransaction)
-&gt; (WorkerCtx ctx -&gt; Handler ApiSerialisedTransaction)
-&gt; Handler ApiSerialisedTransaction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481253"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481253"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2811"></span><span>        </span><span id="local-6989586621682481252"><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="#local-6989586621682481252"><span class="hs-identifier hs-var">wallet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481265"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481264"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481253"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481260"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2812"></span><span>        </span><span id="local-6989586621682481251"><span class="annot"><span class="annottext">TimeInterpreter (Either PastHorizonException)
</span><a href="#local-6989586621682481251"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TimeInterpreter (Either PastHorizonException))
-&gt; Handler (TimeInterpreter (Either PastHorizonException))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (TimeInterpreter (Either PastHorizonException))
 -&gt; Handler (TimeInterpreter (Either PastHorizonException)))
-&gt; IO (TimeInterpreter (Either PastHorizonException))
-&gt; Handler (TimeInterpreter (Either PastHorizonException))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; IO (TimeInterpreter (Either PastHorizonException))
</span><a href="Cardano.Wallet.Primitive.Slotting.html#snapshot"><span class="hs-identifier hs-var">snapshot</span></a></span><span> </span><span class="annot"><span class="annottext">(TimeInterpreter (ExceptT PastHorizonException IO)
 -&gt; IO (TimeInterpreter (Either PastHorizonException)))
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; IO (TimeInterpreter (Either PastHorizonException))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; TimeInterpreter (ExceptT PastHorizonException IO))
-&gt; NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481262"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2813"></span><span>
</span><span id="line-2814"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682481250"><span class="hs-identifier hs-type">mkPartialTx</span></a></span><span>
</span><span id="line-2815"></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483465"><span class="annot"><a href="#local-6989586621682483465"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483465"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-2816"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">W.PartialTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483465"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-2817"></span><span>            </span><span id="local-6989586621682481250"><span class="annot"><span class="annottext">mkPartialTx :: Tx era -&gt; PartialTx era
</span><a href="#local-6989586621682481250"><span class="hs-identifier hs-var hs-var">mkPartialTx</span></a></span></span><span> </span><span id="local-6989586621682481249"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682481249"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
-&gt; [Redeemer]
-&gt; PartialTx era
forall era.
Tx era
-&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
-&gt; [Redeemer]
-&gt; PartialTx era
</span><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-var">W.PartialTx</span></a></span><span>
</span><span id="line-2818"></span><span>                    </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682481249"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-2819"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiExternalInput n -&gt; (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))
forall (n :: NetworkDiscriminant).
ApiExternalInput n -&gt; (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))
</span><a href="Cardano.Wallet.Api.Server.html#fromExternalInput"><span class="hs-identifier hs-var">fromExternalInput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiExternalInput n -&gt; (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;)))
-&gt; [ApiExternalInput n] -&gt; [(TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
</span><a href="#local-6989586621682481259"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
-&gt; (([ApiExternalInput n]
     -&gt; Const [ApiExternalInput n] [ApiExternalInput n])
    -&gt; ApiBalanceTransactionPostData n
    -&gt; Const [ApiExternalInput n] (ApiBalanceTransactionPostData n))
-&gt; [ApiExternalInput n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiExternalInput n]
    -&gt; Const [ApiExternalInput n] [ApiExternalInput n])
   -&gt; ApiBalanceTransactionPostData n
   -&gt; Const [ApiExternalInput n] (ApiBalanceTransactionPostData n))
([ApiExternalInput n]
 -&gt; Const [ApiExternalInput n] [ApiExternalInput n])
-&gt; ApiBalanceTransactionPostData n
-&gt; Const [ApiExternalInput n] (ApiBalanceTransactionPostData n)
</span><a href="#local-6989586621682481246"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2820"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRedeemer n -&gt; Redeemer
forall (n :: NetworkDiscriminant). ApiRedeemer n -&gt; Redeemer
</span><a href="Cardano.Wallet.Api.Server.html#fromApiRedeemer"><span class="hs-identifier hs-var">fromApiRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiRedeemer n -&gt; Redeemer) -&gt; [ApiRedeemer n] -&gt; [Redeemer]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
</span><a href="#local-6989586621682481259"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
-&gt; (([ApiRedeemer n] -&gt; Const [ApiRedeemer n] [ApiRedeemer n])
    -&gt; ApiBalanceTransactionPostData n
    -&gt; Const [ApiRedeemer n] (ApiBalanceTransactionPostData n))
-&gt; [ApiRedeemer n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;redeemers&quot;
  (([ApiRedeemer n] -&gt; Const [ApiRedeemer n] [ApiRedeemer n])
   -&gt; ApiBalanceTransactionPostData n
   -&gt; Const [ApiRedeemer n] (ApiBalanceTransactionPostData n))
([ApiRedeemer n] -&gt; Const [ApiRedeemer n] [ApiRedeemer n])
-&gt; ApiBalanceTransactionPostData n
-&gt; Const [ApiRedeemer n] (ApiBalanceTransactionPostData n)
</span><a href="#local-6989586621682481244"><span class="hs-var">#redeemers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2821"></span><span>
</span><span id="line-2822"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682481243"><span class="hs-identifier hs-type">balanceTx</span></a></span><span>
</span><span id="line-2823"></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483466"><span class="annot"><a href="#local-6989586621682483466"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.IsShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483466"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-2824"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#PartialTx"><span class="hs-identifier hs-type">W.PartialTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483466"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-2825"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483466"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2826"></span><span>            </span><span id="local-6989586621682481243"><span class="annot"><span class="annottext">balanceTx :: PartialTx era -&gt; Handler (Tx era)
</span><a href="#local-6989586621682481243"><span class="hs-identifier hs-var hs-var">balanceTx</span></a></span></span><span> </span><span id="local-6989586621682481242"><span class="annot"><span class="annottext">PartialTx era
</span><a href="#local-6989586621682481242"><span class="hs-identifier hs-var">partialTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2827"></span><span>                </span><span class="annot"><span class="annottext">ExceptT ErrBalanceTx IO (Tx era) -&gt; Handler (Tx era)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrBalanceTx IO (Tx era) -&gt; Handler (Tx era))
-&gt; ExceptT ErrBalanceTx IO (Tx era) -&gt; Handler (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ArgGenChange s
-&gt; (ProtocolParameters, ProtocolParameters)
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; PartialTx era
-&gt; ExceptT ErrBalanceTx IO (Tx era)
forall era (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) ctx.
(HasTransactionLayer k ctx, GenChange s, MonadRandom m,
 HasLogger m WalletWorkerLog ctx, IsShelleyBasedEra era,
 BoundedAddressLength k) =&gt;
ctx
-&gt; ArgGenChange s
-&gt; (ProtocolParameters, ProtocolParameters)
-&gt; TimeInterpreter (Either PastHorizonException)
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; PartialTx era
-&gt; ExceptT ErrBalanceTx m (Tx era)
</span><a href="Cardano.Wallet.html#balanceTransaction"><span class="hs-identifier hs-var">W.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481265"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481264"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2828"></span><span>                    </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481253"><span class="hs-identifier hs-var">wrk</span></a></span><span>
</span><span id="line-2829"></span><span>                    </span><span class="annot"><span class="annottext">ArgGenChange s
</span><a href="#local-6989586621682481261"><span class="hs-identifier hs-var">genChange</span></a></span><span>
</span><span id="line-2830"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481258"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481255"><span class="hs-identifier hs-var">nodePParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2831"></span><span>                    </span><span class="annot"><span class="annottext">TimeInterpreter (Either PastHorizonException)
</span><a href="#local-6989586621682481251"><span class="hs-identifier hs-var">ti</span></a></span><span>
</span><span id="line-2832"></span><span>                    </span><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="#local-6989586621682481252"><span class="hs-identifier hs-var">wallet</span></a></span><span>
</span><span id="line-2833"></span><span>                    </span><span class="annot"><span class="annottext">PartialTx era
</span><a href="#local-6989586621682481242"><span class="hs-identifier hs-var">partialTx</span></a></span><span>
</span><span id="line-2834"></span><span>
</span><span id="line-2835"></span><span>        </span><span id="local-6989586621682481240"><span class="annot"><span class="annottext">InAnyShelleyBasedEra Tx
</span><a href="#local-6989586621682481240"><span class="hs-identifier hs-var">anyShelleyTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
-&gt; Maybe (InAnyShelleyBasedEra Tx)
-&gt; Handler (InAnyShelleyBasedEra Tx)
forall e a. IsServerError e =&gt; e -&gt; Maybe a -&gt; Handler a
</span><a href="#local-6989586621682481239"><span class="hs-identifier hs-var">maybeToHandler</span></a></span><span> </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrByronTxNotSupported"><span class="hs-identifier hs-var">ErrByronTxNotSupported</span></a></span><span>
</span><span id="line-2836"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (InAnyShelleyBasedEra Tx)
 -&gt; Handler (InAnyShelleyBasedEra Tx))
-&gt; (ApiT SealedTx -&gt; Maybe (InAnyShelleyBasedEra Tx))
-&gt; ApiT SealedTx
-&gt; Handler (InAnyShelleyBasedEra Tx)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx -&gt; Maybe (InAnyShelleyBasedEra Tx)
forall (a :: * -&gt; *).
InAnyCardanoEra a -&gt; Maybe (InAnyShelleyBasedEra a)
</span><a href="Cardano.Api.Extra.html#asAnyShelleyBasedEra"><span class="hs-identifier hs-var">asAnyShelleyBasedEra</span></a></span><span>
</span><span id="line-2837"></span><span>            </span><span class="annot"><span class="annottext">(InAnyCardanoEra Tx -&gt; Maybe (InAnyShelleyBasedEra Tx))
-&gt; (ApiT SealedTx -&gt; InAnyCardanoEra Tx)
-&gt; ApiT SealedTx
-&gt; Maybe (InAnyShelleyBasedEra Tx)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra -&gt; SealedTx -&gt; InAnyCardanoEra Tx
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#cardanoTxIdeallyNoLaterThan"><span class="hs-identifier hs-var">cardanoTxIdeallyNoLaterThan</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481256"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-2838"></span><span>            </span><span class="annot"><span class="annottext">(SealedTx -&gt; InAnyCardanoEra Tx)
-&gt; (ApiT SealedTx -&gt; SealedTx)
-&gt; ApiT SealedTx
-&gt; InAnyCardanoEra Tx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; SealedTx
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT SealedTx -&gt; Handler (InAnyShelleyBasedEra Tx))
-&gt; ApiT SealedTx -&gt; Handler (InAnyShelleyBasedEra Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
</span><a href="#local-6989586621682481259"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBalanceTransactionPostData n
-&gt; ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
    -&gt; ApiBalanceTransactionPostData n
    -&gt; Const (ApiT SealedTx) (ApiBalanceTransactionPostData n))
-&gt; ApiT SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiBalanceTransactionPostData n
   -&gt; Const (ApiT SealedTx) (ApiBalanceTransactionPostData n))
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiBalanceTransactionPostData n
-&gt; Const (ApiT SealedTx) (ApiBalanceTransactionPostData n)
</span><a href="#local-6989586621682481237"><span class="hs-var">#transaction</span></a></span><span>
</span><span id="line-2839"></span><span>
</span><span id="line-2840"></span><span>        </span><span id="local-6989586621682481236"><span class="annot"><span class="annottext">InAnyCardanoEra Tx
</span><a href="#local-6989586621682481236"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InAnyShelleyBasedEra Tx
-&gt; (forall era.
    IsShelleyBasedEra era =&gt;
    Tx era -&gt; Handler (InAnyCardanoEra Tx))
-&gt; Handler (InAnyCardanoEra Tx)
forall a.
InAnyShelleyBasedEra Tx
-&gt; (forall era. IsShelleyBasedEra era =&gt; Tx era -&gt; a) -&gt; a
</span><a href="Cardano.Api.Extra.html#withShelleyBasedTx"><span class="hs-identifier hs-var">withShelleyBasedTx</span></a></span><span> </span><span class="annot"><span class="annottext">InAnyShelleyBasedEra Tx
</span><a href="#local-6989586621682481240"><span class="hs-identifier hs-var">anyShelleyTx</span></a></span><span>
</span><span id="line-2841"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tx era -&gt; InAnyCardanoEra Tx)
-&gt; Handler (Tx era) -&gt; Handler (InAnyCardanoEra Tx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; InAnyCardanoEra Tx
forall era. IsCardanoEra era =&gt; Tx era -&gt; InAnyCardanoEra Tx
</span><a href="Cardano.Api.Extra.html#inAnyCardanoEra"><span class="hs-identifier hs-var">inAnyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler (Tx era) -&gt; Handler (InAnyCardanoEra Tx))
-&gt; (Tx era -&gt; Handler (Tx era))
-&gt; Tx era
-&gt; Handler (InAnyCardanoEra Tx)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PartialTx era -&gt; Handler (Tx era)
forall era.
IsShelleyBasedEra era =&gt;
PartialTx era -&gt; Handler (Tx era)
</span><a href="#local-6989586621682481243"><span class="hs-identifier hs-var">balanceTx</span></a></span><span> </span><span class="annot"><span class="annottext">(PartialTx era -&gt; Handler (Tx era))
-&gt; (Tx era -&gt; PartialTx era) -&gt; Tx era -&gt; Handler (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; PartialTx era
forall era. Tx era -&gt; PartialTx era
</span><a href="#local-6989586621682481250"><span class="hs-identifier hs-var">mkPartialTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2842"></span><span>
</span><span id="line-2843"></span><span>        </span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Handler ApiSerialisedTransaction
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Handler ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction -&gt; Handler ApiSerialisedTransaction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT SealedTx -&gt; ApiSerialisedTransaction)
-&gt; ApiT SealedTx -&gt; ApiSerialisedTransaction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; ApiT SealedTx
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; ApiT SealedTx) -&gt; SealedTx -&gt; ApiT SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx -&gt; SealedTx
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#sealedTxFromCardano"><span class="hs-identifier hs-var">W.sealedTxFromCardano</span></a></span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx
</span><a href="#local-6989586621682481236"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-2844"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2845"></span><span>    </span><span id="local-6989586621682481257"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682481257"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481262"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-2846"></span><span>
</span><span id="line-2847"></span><span>    </span><span id="local-6989586621682483474"><span id="local-6989586621682483475"><span class="annot"><a href="#local-6989586621682481239"><span class="hs-identifier hs-type">maybeToHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483475"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483475"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483474"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483474"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-2848"></span><span>    </span><span id="local-6989586621682481239"><span class="annot"><span class="annottext">maybeToHandler :: e -&gt; Maybe a -&gt; Handler a
</span><a href="#local-6989586621682481239"><span class="hs-identifier hs-var hs-var">maybeToHandler</span></a></span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481234"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481234"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Handler a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481234"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2849"></span><span>    </span><span class="annot"><a href="#local-6989586621682481239"><span class="hs-identifier hs-var">maybeToHandler</span></a></span><span> </span><span id="local-6989586621682481233"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682481233"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT e IO a -&gt; Handler a
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT e IO a -&gt; Handler a) -&gt; ExceptT e IO a -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; ExceptT e IO a
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682481233"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2850"></span><span>
</span><span id="line-2851"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#decodeTransaction"><span class="hs-identifier hs-type">decodeTransaction</span></a></span><span>
</span><span id="line-2852"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483412"><span class="annot"><a href="#local-6989586621682483412"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682483411"><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483410"><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682483409"><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2853"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682483412"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2854"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-2855"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-2856"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-2857"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483412"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2858"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-2859"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483412"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-2860"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-2861"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span>
</span><span id="line-2862"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiDecodedTransaction"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2863"></span><span id="decodeTransaction"><span class="annot"><span class="annottext">decodeTransaction :: ctx
-&gt; ApiT WalletId
-&gt; ApiSerialisedTransaction
-&gt; Handler (ApiDecodedTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#decodeTransaction"><span class="hs-identifier hs-var hs-var">decodeTransaction</span></a></span></span><span> </span><span id="local-6989586621682481232"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481232"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481231"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481230"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481230"><span class="hs-identifier hs-var">sealed</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2864"></span><span>    </span><span id="local-6989586621682481229"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481229"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481228"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-2865"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481227"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481227"><span class="hs-identifier hs-var">decodedTx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481226"><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481226"><span class="hs-identifier hs-var">toMint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481225"><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481225"><span class="hs-identifier hs-var">toBurn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481224"><span class="annot"><span class="annottext">[Certificate]
</span><a href="#local-6989586621682481224"><span class="hs-identifier hs-var">allCerts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481223"><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><a href="#local-6989586621682481223"><span class="hs-identifier hs-var">interval</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2866"></span><span>            </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; SealedTx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; tx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AdecodeTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">decodeTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682481222"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481229"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481230"><span class="hs-identifier hs-var">sealed</span></a></span><span>
</span><span id="line-2867"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682481221"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
txId :: Hash &quot;Tx&quot;
$sel:txId:Tx :: Tx -&gt; Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481221"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span>
</span><span id="line-2868"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481220"><span class="annot"><span class="annottext">Maybe Coin
fee :: Maybe Coin
$sel:fee:Tx :: Tx -&gt; Maybe Coin
</span><a href="#local-6989586621682481220"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span>
</span><span id="line-2869"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481219"><span class="annot"><span class="annottext">[(TxIn, Coin)]
resolvedInputs :: [(TxIn, Coin)]
$sel:resolvedInputs:Tx :: Tx -&gt; [(TxIn, Coin)]
</span><a href="#local-6989586621682481219"><span class="hs-identifier hs-var hs-var">resolvedInputs</span></a></span></span><span>
</span><span id="line-2870"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481218"><span class="annot"><span class="annottext">[(TxIn, Coin)]
resolvedCollateralInputs :: [(TxIn, Coin)]
$sel:resolvedCollateralInputs:Tx :: Tx -&gt; [(TxIn, Coin)]
</span><a href="#local-6989586621682481218"><span class="hs-identifier hs-var hs-var">resolvedCollateralInputs</span></a></span></span><span>
</span><span id="line-2871"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481217"><span class="annot"><span class="annottext">[TxOut]
outputs :: [TxOut]
$sel:outputs:Tx :: Tx -&gt; [TxOut]
</span><a href="#local-6989586621682481217"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span>
</span><span id="line-2872"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481216"><span class="annot"><span class="annottext">Map RewardAccount Coin
$sel:withdrawals:Tx :: Tx -&gt; Map RewardAccount Coin
withdrawals :: Map RewardAccount Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#%24sel%3Awithdrawals%3ATx"><span class="hs-identifier hs-var hs-var">withdrawals</span></a></span></span><span>
</span><span id="line-2873"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481214"><span class="annot"><span class="annottext">Maybe TxMetadata
metadata :: Maybe TxMetadata
$sel:metadata:Tx :: Tx -&gt; Maybe TxMetadata
</span><a href="#local-6989586621682481214"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span>
</span><span id="line-2874"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481213"><span class="annot"><span class="annottext">Maybe TxScriptValidity
scriptValidity :: Maybe TxScriptValidity
$sel:scriptValidity:Tx :: Tx -&gt; Maybe TxScriptValidity
</span><a href="#local-6989586621682481213"><span class="hs-identifier hs-var hs-var">scriptValidity</span></a></span></span><span>
</span><span id="line-2875"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481227"><span class="hs-identifier hs-var">decodedTx</span></a></span><span>
</span><span id="line-2876"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682481212"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481212"><span class="hs-identifier hs-var">txinsOutsPaths</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481211"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481211"><span class="hs-identifier hs-var">collateralInsOutsPaths</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481210"><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481210"><span class="hs-identifier hs-var">outsPath</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481209"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481209"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481208"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481208"><span class="hs-identifier hs-var">acctPath</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481207"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481207"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481206"><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481206"><span class="hs-identifier hs-var">policyXPubM</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2877"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
          NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub))
-&gt; (ErrWalletNotResponding
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
          NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub))
-&gt; (WorkerCtx ctx
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
          NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub))
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
      NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481232"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
      NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
      NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler
       ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
        [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
        [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
        NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub))
 -&gt; Handler
      ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
       [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
       [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
       NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub))
-&gt; (WorkerCtx ctx
    -&gt; Handler
         ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
          [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
          NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub))
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
      NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481205"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2878"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481204"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481204"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481203"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481203"><span class="hs-identifier hs-var">acctPath</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2879"></span><span>            </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount
  IO
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">W.readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2880"></span><span>        </span><span id="local-6989586621682481202"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481202"><span class="hs-identifier hs-var">inputPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2881"></span><span>            </span><span class="annot"><span class="annottext">ExceptT
  ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
 -&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier hs-var">W.lookupTxIns</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn]
 -&gt; ExceptT
      ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2882"></span><span>            </span><span class="annot"><span class="annottext">(TxIn, Coin) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, Coin) -&gt; TxIn) -&gt; [(TxIn, Coin)] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682481219"><span class="hs-identifier hs-var">resolvedInputs</span></a></span><span>
</span><span id="line-2883"></span><span>        </span><span id="local-6989586621682481201"><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481201"><span class="hs-identifier hs-var">collateralInputPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2884"></span><span>            </span><span class="annot"><span class="annottext">ExceptT
  ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
 -&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; Handler [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx
-&gt; WalletId
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxIns"><span class="hs-identifier hs-var">W.lookupTxIns</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn]
 -&gt; ExceptT
      ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))])
-&gt; [TxIn]
-&gt; ExceptT
     ErrDecodeTx IO [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2885"></span><span>            </span><span class="annot"><span class="annottext">(TxIn, Coin) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, Coin) -&gt; TxIn) -&gt; [(TxIn, Coin)] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682481218"><span class="hs-identifier hs-var">resolvedCollateralInputs</span></a></span><span>
</span><span id="line-2886"></span><span>        </span><span id="local-6989586621682481200"><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481200"><span class="hs-identifier hs-var">outputPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2887"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; Handler [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
 -&gt; Handler [(TxOut, Maybe (NonEmpty DerivationIndex))])
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; Handler [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; [TxOut]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, IsOurs s Address) =&gt;
ctx
-&gt; WalletId
-&gt; [TxOut]
-&gt; ExceptT
     ErrDecodeTx IO [(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="Cardano.Wallet.html#lookupTxOuts"><span class="hs-identifier hs-var">W.lookupTxOuts</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481217"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-2888"></span><span>        </span><span id="local-6989586621682481199"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481199"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2889"></span><span>        </span><span id="local-6989586621682481198"><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481198"><span class="hs-identifier hs-var">policyXPubM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)
 -&gt; Maybe XPub)
-&gt; Handler
     (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
-&gt; Handler (Maybe XPub)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((XPub, NonEmpty DerivationIndex) -&gt; XPub)
-&gt; Maybe (XPub, NonEmpty DerivationIndex) -&gt; Maybe XPub
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub, NonEmpty DerivationIndex) -&gt; XPub
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (XPub, NonEmpty DerivationIndex) -&gt; Maybe XPub)
-&gt; (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)
    -&gt; Maybe (XPub, NonEmpty DerivationIndex))
-&gt; Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)
-&gt; Maybe XPub
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)
-&gt; Maybe (XPub, NonEmpty DerivationIndex)
forall a b. Either a b -&gt; Maybe b
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2890"></span><span>            </span><span class="annot"><span class="annottext">(Handler
   (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
 -&gt; Handler (Maybe XPub))
-&gt; (ExceptT
      ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
    -&gt; Handler
         (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (Maybe XPub)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
-&gt; Handler
     (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
 -&gt; Handler
      (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)))
-&gt; (ExceptT
      ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
    -&gt; IO
         (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler
     (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; IO
     (Either ErrReadPolicyPublicKey (XPub, NonEmpty DerivationIndex))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
 -&gt; Handler (Maybe XPub))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (Maybe XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier hs-var">W.readPolicyPublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483411"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481205"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481231"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-2891"></span><span>        </span><span class="annot"><span class="annottext">([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
 [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
 [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
 NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub)
-&gt; Handler
     ([(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))],
      [(TxOut, Maybe (NonEmpty DerivationIndex))], RewardAccount,
      NonEmpty DerivationIndex, ProtocolParameters, Maybe XPub)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-2892"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481202"><span class="hs-identifier hs-var">inputPaths</span></a></span><span>
</span><span id="line-2893"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481201"><span class="hs-identifier hs-var">collateralInputPaths</span></a></span><span>
</span><span id="line-2894"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481200"><span class="hs-identifier hs-var">outputPaths</span></a></span><span>
</span><span id="line-2895"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481204"><span class="hs-identifier hs-var">acct</span></a></span><span>
</span><span id="line-2896"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481203"><span class="hs-identifier hs-var">acctPath</span></a></span><span>
</span><span id="line-2897"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481199"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-2898"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481198"><span class="hs-identifier hs-var">policyXPubM</span></a></span><span>
</span><span id="line-2899"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-2900"></span><span>    </span><span class="annot"><span class="annottext">ApiDecodedTransaction n -&gt; Handler (ApiDecodedTransaction n)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiDecodedTransaction n -&gt; Handler (ApiDecodedTransaction n))
-&gt; ApiDecodedTransaction n -&gt; Handler (ApiDecodedTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction :: forall (n :: NetworkDiscriminant).
ApiT (Hash &quot;Tx&quot;)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; [ApiTxInputGeneral n]
-&gt; [ApiTxOutputGeneral n]
-&gt; [ApiTxInputGeneral n]
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutputGeneral n))
-&gt; [ApiWithdrawalGeneral n]
-&gt; ApiAssetMintBurn
-&gt; ApiAssetMintBurn
-&gt; [ApiAnyCertificate n]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; ApiTxMetadata
-&gt; Maybe (ApiT TxScriptValidity)
-&gt; Maybe ValidityIntervalExplicit
-&gt; ApiDecodedTransaction n
</span><a href="Cardano.Wallet.Api.Types.html#ApiDecodedTransaction"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span>
</span><span id="line-2901"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiDecodedTransaction :: ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiDecodedTransaction"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481221"><span class="hs-identifier hs-var">txId</span></a></span><span>
</span><span id="line-2902"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fee:ApiDecodedTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Afee%3AApiDecodedTransaction"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
-&gt; (Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Maybe Coin
-&gt; Quantity &quot;lovelace&quot; Natural
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682481220"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-2903"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:inputs:ApiDecodedTransaction :: [ApiTxInputGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ainputs%3AApiDecodedTransaction"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
 -&gt; ApiTxInputGeneral n)
-&gt; [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; [ApiTxInputGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant).
(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toInp"><span class="hs-identifier hs-var">toInp</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481212"><span class="hs-identifier hs-var">txinsOutsPaths</span></a></span><span>
</span><span id="line-2904"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:ApiDecodedTransaction :: [ApiTxOutputGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aoutputs%3AApiDecodedTransaction"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n)
-&gt; [(TxOut, Maybe (NonEmpty DerivationIndex))]
-&gt; [ApiTxOutputGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
(TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toOut"><span class="hs-identifier hs-var">toOut</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxOut, Maybe (NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481210"><span class="hs-identifier hs-var">outsPath</span></a></span><span>
</span><span id="line-2905"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateral:ApiDecodedTransaction :: [ApiTxInputGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acollateral%3AApiDecodedTransaction"><span class="hs-identifier hs-var">collateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
 -&gt; ApiTxInputGeneral n)
-&gt; [(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
-&gt; [ApiTxInputGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant).
(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toInp"><span class="hs-identifier hs-var">toInp</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Maybe (TxOut, NonEmpty DerivationIndex))]
</span><a href="#local-6989586621682481211"><span class="hs-identifier hs-var">collateralInsOutsPaths</span></a></span><span>
</span><span id="line-2906"></span><span>        </span><span class="hs-comment">-- TODO: [ADP-1670]</span><span>
</span><span id="line-2907"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralOutputs:ApiDecodedTransaction :: ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutputGeneral n))
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AcollateralOutputs%3AApiDecodedTransaction"><span class="hs-identifier hs-var">collateralOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiTxOutputGeneral n)
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutputGeneral n))
forall (s :: Symbol) a. a -&gt; ApiAsArray s a
</span><a href="Cardano.Wallet.Api.Types.html#ApiAsArray"><span class="hs-identifier hs-var">ApiAsArray</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiTxOutputGeneral n)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2908"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:ApiDecodedTransaction :: [ApiWithdrawalGeneral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Awithdrawals%3AApiDecodedTransaction"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((RewardAccount, Coin) -&gt; ApiWithdrawalGeneral n)
-&gt; [(RewardAccount, Coin)] -&gt; [ApiWithdrawalGeneral n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; (RewardAccount, Coin) -&gt; ApiWithdrawalGeneral n
</span><a href="#local-6989586621682481197"><span class="hs-identifier hs-var">toWrdl</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481209"><span class="hs-identifier hs-var">acct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(RewardAccount, Coin)] -&gt; [ApiWithdrawalGeneral n])
-&gt; [(RewardAccount, Coin)] -&gt; [ApiWithdrawalGeneral n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin -&gt; [(RewardAccount, Coin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.assocs</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin
</span><a href="#local-6989586621682481216"><span class="hs-identifier hs-var">withdrawals</span></a></span><span>
</span><span id="line-2909"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:mint:ApiDecodedTransaction :: ApiAssetMintBurn
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Amint%3AApiDecodedTransaction"><span class="hs-identifier hs-var">mint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe XPub -&gt; TokenMapWithScripts -&gt; ApiAssetMintBurn
</span><a href="#local-6989586621682481195"><span class="hs-identifier hs-var">toApiAssetMintBurn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481206"><span class="hs-identifier hs-var">policyXPubM</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481226"><span class="hs-identifier hs-var">toMint</span></a></span><span>
</span><span id="line-2910"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:burn:ApiDecodedTransaction :: ApiAssetMintBurn
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aburn%3AApiDecodedTransaction"><span class="hs-identifier hs-var">burn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe XPub -&gt; TokenMapWithScripts -&gt; ApiAssetMintBurn
</span><a href="#local-6989586621682481195"><span class="hs-identifier hs-var">toApiAssetMintBurn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481206"><span class="hs-identifier hs-var">policyXPubM</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481225"><span class="hs-identifier hs-var">toBurn</span></a></span><span>
</span><span id="line-2911"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificates:ApiDecodedTransaction :: [ApiAnyCertificate n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acertificates%3AApiDecodedTransaction"><span class="hs-identifier hs-var">certificates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Certificate -&gt; ApiAnyCertificate n)
-&gt; [Certificate] -&gt; [ApiAnyCertificate n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
-&gt; NonEmpty DerivationIndex -&gt; Certificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481194"><span class="hs-identifier hs-var">toApiAnyCert</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481209"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481208"><span class="hs-identifier hs-var">acctPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Certificate]
</span><a href="#local-6989586621682481224"><span class="hs-identifier hs-var">allCerts</span></a></span><span>
</span><span id="line-2912"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositsTaken:ApiDecodedTransaction :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositsTaken%3AApiDecodedTransaction"><span class="hs-identifier hs-var">depositsTaken</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2913"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ProtocolParameters -&gt; Natural)
-&gt; ProtocolParameters
-&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural)
-&gt; (ProtocolParameters -&gt; Natural) -&gt; ProtocolParameters -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Natural)
-&gt; (ProtocolParameters -&gt; Coin) -&gt; ProtocolParameters -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ProtocolParameters -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481207"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2914"></span><span>                </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
-&gt; [ApiAnyCertificate n] -&gt; [Quantity &quot;lovelace&quot; Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiAnyCertificate n -&gt; Bool)
-&gt; [ApiAnyCertificate n] -&gt; [ApiAnyCertificate n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiAnyCertificate n -&gt; Bool
</span><a href="#local-6989586621682481193"><span class="hs-identifier hs-var">ourRewardAccountRegistration</span></a></span><span>
</span><span id="line-2915"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
-&gt; NonEmpty DerivationIndex -&gt; Certificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481194"><span class="hs-identifier hs-var">toApiAnyCert</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481209"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481208"><span class="hs-identifier hs-var">acctPath</span></a></span><span> </span><span class="annot"><span class="annottext">(Certificate -&gt; ApiAnyCertificate n)
-&gt; [Certificate] -&gt; [ApiAnyCertificate n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Certificate]
</span><a href="#local-6989586621682481224"><span class="hs-identifier hs-var">allCerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2916"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositsReturned:ApiDecodedTransaction :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositsReturned%3AApiDecodedTransaction"><span class="hs-identifier hs-var">depositsReturned</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2917"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ProtocolParameters -&gt; Natural)
-&gt; ProtocolParameters
-&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural)
-&gt; (ProtocolParameters -&gt; Natural) -&gt; ProtocolParameters -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Natural)
-&gt; (ProtocolParameters -&gt; Coin) -&gt; ProtocolParameters -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ProtocolParameters -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682481207"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2918"></span><span>                </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
-&gt; [ApiAnyCertificate n] -&gt; [Quantity &quot;lovelace&quot; Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiAnyCertificate n -&gt; Bool)
-&gt; [ApiAnyCertificate n] -&gt; [ApiAnyCertificate n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiAnyCertificate n -&gt; Bool
</span><a href="#local-6989586621682481192"><span class="hs-identifier hs-var">ourRewardAccountDeregistration</span></a></span><span>
</span><span id="line-2919"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
-&gt; NonEmpty DerivationIndex -&gt; Certificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481194"><span class="hs-identifier hs-var">toApiAnyCert</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481209"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481208"><span class="hs-identifier hs-var">acctPath</span></a></span><span> </span><span class="annot"><span class="annottext">(Certificate -&gt; ApiAnyCertificate n)
-&gt; [Certificate] -&gt; [ApiAnyCertificate n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Certificate]
</span><a href="#local-6989586621682481224"><span class="hs-identifier hs-var">allCerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2920"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:metadata:ApiDecodedTransaction :: ApiTxMetadata
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ametadata%3AApiDecodedTransaction"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="Cardano.Wallet.Api.Types.html#ApiTxMetadata"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata)
-&gt; Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadata -&gt; ApiT TxMetadata
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; ApiT TxMetadata)
-&gt; Maybe TxMetadata -&gt; Maybe (ApiT TxMetadata)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682481214"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-2921"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:scriptValidity:ApiDecodedTransaction :: Maybe (ApiT TxScriptValidity)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AscriptValidity%3AApiDecodedTransaction"><span class="hs-identifier hs-var">scriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity -&gt; ApiT TxScriptValidity
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TxScriptValidity -&gt; ApiT TxScriptValidity)
-&gt; Maybe TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxScriptValidity
</span><a href="#local-6989586621682481213"><span class="hs-identifier hs-var">scriptValidity</span></a></span><span>
</span><span id="line-2922"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:validityInterval:ApiDecodedTransaction :: Maybe ValidityIntervalExplicit
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AvalidityInterval%3AApiDecodedTransaction"><span class="hs-identifier hs-var">validityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><a href="#local-6989586621682481223"><span class="hs-identifier hs-var">interval</span></a></span><span>
</span><span id="line-2923"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2924"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2925"></span><span>    </span><span id="local-6989586621682481222"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682481222"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481232"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">W.transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483410"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-2926"></span><span>    </span><span id="local-6989586621682481228"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682481228"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481232"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasNetworkLayer IO ctx =&gt;
Lens' ctx (NetworkLayer IO Block)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">W.networkLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-2927"></span><span>
</span><span id="line-2928"></span><span>    </span><span id="local-6989586621682481191"><span class="annot"><span class="annottext">policyIx :: ApiT DerivationIndex
</span><a href="#local-6989586621682481191"><span class="hs-identifier hs-var hs-var">policyIx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; DerivationIndex -&gt; ApiT DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DerivationIndex) -&gt; Word32 -&gt; DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2929"></span><span>        </span><span class="annot"><span class="annottext">Index 'Hardened 'PolicyK -&gt; Word32
forall (derivationType :: DerivationType) (level :: Depth).
Index derivationType level -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PolicyK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PolicyK"><span class="hs-identifier hs-type">PolicyK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2930"></span><span>
</span><span id="line-2931"></span><span>    </span><span id="local-6989586621682481190"><span class="annot"><span class="annottext">askForScript :: k -&gt; Map k p -&gt; p
</span><a href="#local-6989586621682481190"><span class="hs-identifier hs-var hs-var">askForScript</span></a></span></span><span> </span><span id="local-6989586621682481189"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621682481189"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621682481188"><span class="annot"><span class="annottext">Map k p
</span><a href="#local-6989586621682481188"><span class="hs-identifier hs-var">scriptMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2932"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k p -&gt; Maybe p
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621682481189"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">Map k p
</span><a href="#local-6989586621682481188"><span class="hs-identifier hs-var">scriptMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2933"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481186"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682481186"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682481186"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-2934"></span><span>            </span><span class="annot"><span class="annottext">Maybe p
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; p
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;askForScript: no minting/burning without either\
                             \ native or plutus script&quot;</span></span><span>
</span><span id="line-2936"></span><span>
</span><span id="line-2937"></span><span>    </span><span id="local-6989586621682481185"><span class="annot"><span class="annottext">toIdScriptAssets :: Map TokenPolicyId b
-&gt; TokenMap
-&gt; [(TokenPolicyId, b, NonEmpty (TokenName, TokenQuantity))]
</span><a href="#local-6989586621682481185"><span class="hs-identifier hs-var hs-var">toIdScriptAssets</span></a></span></span><span> </span><span id="local-6989586621682481184"><span class="annot"><span class="annottext">Map TokenPolicyId b
</span><a href="#local-6989586621682481184"><span class="hs-identifier hs-var">scriptmap</span></a></span></span><span> </span><span id="local-6989586621682481183"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481183"><span class="hs-identifier hs-var">tokenmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2938"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481182"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; Map TokenPolicyId b -&gt; b
forall k p. Ord k =&gt; k -&gt; Map k p -&gt; p
</span><a href="#local-6989586621682481190"><span class="hs-identifier hs-var">askForScript</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481182"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">Map TokenPolicyId b
</span><a href="#local-6989586621682481184"><span class="hs-identifier hs-var">scriptmap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TokenName, TokenQuantity)
</span><a href="#local-6989586621682481181"><span class="hs-identifier hs-var">tokenQuantities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2939"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481182"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481182"><span class="hs-identifier hs-var">policy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481181"><span class="annot"><span class="annottext">NonEmpty (TokenName, TokenQuantity)
</span><a href="#local-6989586621682481181"><span class="hs-identifier hs-var">tokenQuantities</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; [(TokenPolicyId, NonEmpty (TokenName, TokenQuantity))]
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#toNestedList"><span class="hs-identifier hs-var">toNestedList</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481183"><span class="hs-identifier hs-var">tokenmap</span></a></span><span>
</span><span id="line-2940"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2941"></span><span>
</span><span id="line-2942"></span><span>    </span><span id="local-6989586621682481180"><span class="annot"><span class="annottext">toTokenAmountFingerprint :: TokenPolicyId
-&gt; (TokenName, TokenQuantity) -&gt; ApiTokenAmountFingerprint
</span><a href="#local-6989586621682481180"><span class="hs-identifier hs-var hs-var">toTokenAmountFingerprint</span></a></span></span><span> </span><span id="local-6989586621682481179"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481179"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481178"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481178"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481177"><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682481177"><span class="hs-identifier hs-var">tokenquantity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2943"></span><span>        </span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint :: ApiT TokenName
-&gt; Natural -&gt; ApiT TokenFingerprint -&gt; ApiTokenAmountFingerprint
</span><a href="Cardano.Wallet.Api.Types.html#ApiTokenAmountFingerprint"><span class="hs-identifier hs-type">ApiTokenAmountFingerprint</span></a></span><span>
</span><span id="line-2944"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assetName:ApiTokenAmountFingerprint :: ApiT TokenName
</span><a href="#local-6989586621682481175"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; ApiT TokenName
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481178"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2945"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:quantity:ApiTokenAmountFingerprint :: Natural
</span><a href="#local-6989586621682481174"><span class="hs-identifier hs-var">quantity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenQuantity -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.TokenQuantity.html#unTokenQuantity"><span class="hs-identifier hs-var hs-var">unTokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682481177"><span class="hs-identifier hs-var">tokenquantity</span></a></span><span>
</span><span id="line-2946"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fingerprint:ApiTokenAmountFingerprint :: ApiT TokenFingerprint
</span><a href="#local-6989586621682481173"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenFingerprint -&gt; ApiT TokenFingerprint
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenFingerprint -&gt; ApiT TokenFingerprint)
-&gt; TokenFingerprint -&gt; ApiT TokenFingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; TokenFingerprint
</span><a href="Cardano.Wallet.Primitive.Types.TokenPolicy.html#mkTokenFingerprint"><span class="hs-identifier hs-var">mkTokenFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481179"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682481178"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2947"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2948"></span><span>
</span><span id="line-2949"></span><span>    </span><span id="local-6989586621682481172"><span class="annot"><span class="annottext">fromIdScriptAssets :: (TokenPolicyId, AnyScript, NonEmpty (TokenName, TokenQuantity))
-&gt; ApiTokens
</span><a href="#local-6989586621682481172"><span class="hs-identifier hs-var hs-var">fromIdScriptAssets</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481171"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481171"><span class="hs-identifier hs-var">policy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481170"><span class="annot"><span class="annottext">AnyScript
</span><a href="#local-6989586621682481170"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481169"><span class="annot"><span class="annottext">NonEmpty (TokenName, TokenQuantity)
</span><a href="#local-6989586621682481169"><span class="hs-identifier hs-var">tokens</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokens :: ApiT TokenPolicyId
-&gt; ApiT AnyScript
-&gt; NonEmpty ApiTokenAmountFingerprint
-&gt; ApiTokens
</span><a href="Cardano.Wallet.Api.Types.html#ApiTokens"><span class="hs-identifier hs-type">ApiTokens</span></a></span><span>
</span><span id="line-2950"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:policyId:ApiTokens :: ApiT TokenPolicyId
</span><a href="#local-6989586621682481167"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; ApiT TokenPolicyId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481171"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-2951"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:policyScript:ApiTokens :: ApiT AnyScript
</span><a href="#local-6989586621682481166"><span class="hs-identifier hs-var">policyScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyScript -&gt; ApiT AnyScript
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">AnyScript
</span><a href="#local-6989586621682481170"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-2952"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiTokens :: NonEmpty ApiTokenAmountFingerprint
</span><a href="#local-6989586621682481165"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TokenName, TokenQuantity) -&gt; ApiTokenAmountFingerprint)
-&gt; NonEmpty (TokenName, TokenQuantity)
-&gt; NonEmpty ApiTokenAmountFingerprint
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenPolicyId
-&gt; (TokenName, TokenQuantity) -&gt; ApiTokenAmountFingerprint
</span><a href="#local-6989586621682481180"><span class="hs-identifier hs-var">toTokenAmountFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682481171"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TokenName, TokenQuantity)
</span><a href="#local-6989586621682481169"><span class="hs-identifier hs-var">tokens</span></a></span><span>
</span><span id="line-2953"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2954"></span><span>
</span><span id="line-2955"></span><span>    </span><span id="local-6989586621682481164"><span class="annot"><span class="annottext">toApiTokens :: TokenMapWithScripts -&gt; [ApiTokens]
</span><a href="#local-6989586621682481164"><span class="hs-identifier hs-var hs-var">toApiTokens</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TokenMapWithScripts"><span class="hs-identifier hs-type">TokenMapWithScripts</span></a></span><span> </span><span id="local-6989586621682481162"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481162"><span class="hs-identifier hs-var">tokenMap</span></a></span></span><span> </span><span id="local-6989586621682481161"><span class="annot"><span class="annottext">Map TokenPolicyId AnyScript
</span><a href="#local-6989586621682481161"><span class="hs-identifier hs-var">scriptMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2956"></span><span>        </span><span class="annot"><span class="annottext">((TokenPolicyId, AnyScript, NonEmpty (TokenName, TokenQuantity))
 -&gt; ApiTokens)
-&gt; [(TokenPolicyId, AnyScript,
     NonEmpty (TokenName, TokenQuantity))]
-&gt; [ApiTokens]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenPolicyId, AnyScript, NonEmpty (TokenName, TokenQuantity))
-&gt; ApiTokens
</span><a href="#local-6989586621682481172"><span class="hs-identifier hs-var">fromIdScriptAssets</span></a></span><span> </span><span class="annot"><span class="annottext">([(TokenPolicyId, AnyScript, NonEmpty (TokenName, TokenQuantity))]
 -&gt; [ApiTokens])
-&gt; [(TokenPolicyId, AnyScript,
     NonEmpty (TokenName, TokenQuantity))]
-&gt; [ApiTokens]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2957"></span><span>        </span><span class="annot"><span class="annottext">Map TokenPolicyId AnyScript
-&gt; TokenMap
-&gt; [(TokenPolicyId, AnyScript,
     NonEmpty (TokenName, TokenQuantity))]
forall b.
Map TokenPolicyId b
-&gt; TokenMap
-&gt; [(TokenPolicyId, b, NonEmpty (TokenName, TokenQuantity))]
</span><a href="#local-6989586621682481185"><span class="hs-identifier hs-var">toIdScriptAssets</span></a></span><span> </span><span class="annot"><span class="annottext">Map TokenPolicyId AnyScript
</span><a href="#local-6989586621682481161"><span class="hs-identifier hs-var">scriptMap</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481162"><span class="hs-identifier hs-var">tokenMap</span></a></span><span>
</span><span id="line-2958"></span><span>    </span><span id="local-6989586621682481160"><span class="annot"><span class="annottext">includePolicyKeyInfo :: TokenMapWithScripts -&gt; Maybe a -&gt; Maybe a
</span><a href="#local-6989586621682481160"><span class="hs-identifier hs-var hs-var">includePolicyKeyInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TokenMapWithScripts"><span class="hs-identifier hs-type">TokenMapWithScripts</span></a></span><span> </span><span id="local-6989586621682481159"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481159"><span class="hs-identifier hs-var">tokenMap</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map TokenPolicyId AnyScript
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481158"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682481158"><span class="hs-identifier hs-var">xpubM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2959"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481159"><span class="hs-identifier hs-var">tokenMap</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#empty"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2960"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2961"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-2962"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682481158"><span class="hs-identifier hs-var">xpubM</span></a></span><span>
</span><span id="line-2963"></span><span>    </span><span id="local-6989586621682481195"><span class="annot"><span class="annottext">toApiAssetMintBurn :: Maybe XPub -&gt; TokenMapWithScripts -&gt; ApiAssetMintBurn
</span><a href="#local-6989586621682481195"><span class="hs-identifier hs-var hs-var">toApiAssetMintBurn</span></a></span></span><span> </span><span id="local-6989586621682481156"><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481156"><span class="hs-identifier hs-var">xpubM</span></a></span></span><span> </span><span id="local-6989586621682481155"><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481155"><span class="hs-identifier hs-var">tokenWithScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="Cardano.Wallet.Api.Types.html#ApiAssetMintBurn"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-2964"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atokens%3AApiAssetMintBurn"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts -&gt; [ApiTokens]
</span><a href="#local-6989586621682481164"><span class="hs-identifier hs-var">toApiTokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481155"><span class="hs-identifier hs-var">tokenWithScripts</span></a></span><span>
</span><span id="line-2965"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AwalletPolicyKeyHash%3AApiAssetMintBurn"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2966"></span><span>            </span><span class="annot"><span class="annottext">(ByteString -&gt; VerificationKeyHashing -&gt; ApiPolicyKey)
-&gt; (ByteString, VerificationKeyHashing) -&gt; ApiPolicyKey
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; VerificationKeyHashing -&gt; ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Types.html#ApiPolicyKey"><span class="hs-identifier hs-var">ApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString, VerificationKeyHashing) -&gt; ApiPolicyKey)
-&gt; (XPub -&gt; (ByteString, VerificationKeyHashing))
-&gt; XPub
-&gt; ApiPolicyKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; XPub -&gt; (ByteString, VerificationKeyHashing)
</span><a href="Cardano.Wallet.Api.Server.html#computeKeyPayload"><span class="hs-identifier hs-var">computeKeyPayload</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ApiPolicyKey) -&gt; Maybe XPub -&gt; Maybe ApiPolicyKey
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2967"></span><span>            </span><span class="annot"><span class="annottext">TokenMapWithScripts -&gt; Maybe XPub -&gt; Maybe XPub
forall a. TokenMapWithScripts -&gt; Maybe a -&gt; Maybe a
</span><a href="#local-6989586621682481160"><span class="hs-identifier hs-var">includePolicyKeyInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481155"><span class="hs-identifier hs-var">tokenWithScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481156"><span class="hs-identifier hs-var">xpubM</span></a></span><span>
</span><span id="line-2968"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AwalletPolicyKeyIndex%3AApiAssetMintBurn"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2969"></span><span>            </span><span class="annot"><span class="annottext">ApiT DerivationIndex
</span><a href="#local-6989586621682481191"><span class="hs-identifier hs-var">policyIx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; Maybe XPub -&gt; Maybe (ApiT DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts -&gt; Maybe XPub -&gt; Maybe XPub
forall a. TokenMapWithScripts -&gt; Maybe a -&gt; Maybe a
</span><a href="#local-6989586621682481160"><span class="hs-identifier hs-var">includePolicyKeyInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><a href="#local-6989586621682481155"><span class="hs-identifier hs-var">tokenWithScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe XPub
</span><a href="#local-6989586621682481156"><span class="hs-identifier hs-var">xpubM</span></a></span><span>
</span><span id="line-2970"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2971"></span><span>    </span><span id="local-6989586621682481197"><span class="annot"><span class="annottext">toWrdl :: RewardAccount -&gt; (RewardAccount, Coin) -&gt; ApiWithdrawalGeneral n
</span><a href="#local-6989586621682481197"><span class="hs-identifier hs-var hs-var">toWrdl</span></a></span></span><span> </span><span id="local-6989586621682481152"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481152"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481151"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481151"><span class="hs-identifier hs-var">rewardKey</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621682481150"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481150"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2972"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481151"><span class="hs-identifier hs-var">rewardKey</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; RewardAccount -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481152"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2973"></span><span>           </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ResourceContext
-&gt; ApiWithdrawalGeneral n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ResourceContext
-&gt; ApiWithdrawalGeneral n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalGeneral"><span class="hs-identifier hs-var">ApiWithdrawalGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481151"><span class="hs-identifier hs-var">rewardKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481150"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="Cardano.Wallet.Api.Types.html#Our"><span class="hs-identifier hs-var">Our</span></a></span><span>
</span><span id="line-2974"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-2975"></span><span>           </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ResourceContext
-&gt; ApiWithdrawalGeneral n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ResourceContext
-&gt; ApiWithdrawalGeneral n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalGeneral"><span class="hs-identifier hs-var">ApiWithdrawalGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481151"><span class="hs-identifier hs-var">rewardKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481150"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="Cardano.Wallet.Api.Types.html#External"><span class="hs-identifier hs-var">External</span></a></span><span>
</span><span id="line-2976"></span><span>
</span><span id="line-2977"></span><span>    </span><span id="local-6989586621682481194"><span class="annot"><span class="annottext">toApiAnyCert :: RewardAccount
-&gt; NonEmpty DerivationIndex -&gt; Certificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481194"><span class="hs-identifier hs-var hs-var">toApiAnyCert</span></a></span></span><span> </span><span id="local-6989586621682481146"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481146"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span id="local-6989586621682481145"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481145"><span class="hs-identifier hs-var">acctPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2978"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertificateOfDelegation"><span class="hs-identifier hs-type">W.CertificateOfDelegation</span></a></span><span> </span><span id="local-6989586621682481143"><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682481143"><span class="hs-identifier hs-var">delCert</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewardAccount
-&gt; NonEmpty DerivationIndex
-&gt; DelegationCertificate
-&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481142"><span class="hs-identifier hs-var">toApiDelCert</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481146"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481145"><span class="hs-identifier hs-var">acctPath</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationCertificate
</span><a href="#local-6989586621682481143"><span class="hs-identifier hs-var">delCert</span></a></span><span>
</span><span id="line-2979"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertificateOfPool"><span class="hs-identifier hs-type">W.CertificateOfPool</span></a></span><span> </span><span id="local-6989586621682481140"><span class="annot"><span class="annottext">PoolCertificate
</span><a href="#local-6989586621682481140"><span class="hs-identifier hs-var">poolCert</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PoolCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
PoolCertificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481139"><span class="hs-identifier hs-var">toApiPoolCert</span></a></span><span> </span><span class="annot"><span class="annottext">PoolCertificate
</span><a href="#local-6989586621682481140"><span class="hs-identifier hs-var">poolCert</span></a></span><span>
</span><span id="line-2980"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertificateOther"><span class="hs-identifier hs-type">W.CertificateOther</span></a></span><span> </span><span id="local-6989586621682481137"><span class="annot"><span class="annottext">NonWalletCertificate
</span><a href="#local-6989586621682481137"><span class="hs-identifier hs-var">otherCert</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonWalletCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
NonWalletCertificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481136"><span class="hs-identifier hs-var">toApiOtherCert</span></a></span><span> </span><span class="annot"><span class="annottext">NonWalletCertificate
</span><a href="#local-6989586621682481137"><span class="hs-identifier hs-var">otherCert</span></a></span><span>
</span><span id="line-2981"></span><span>    </span><span id="local-6989586621682481136"><span class="annot"><span class="annottext">toApiOtherCert :: NonWalletCertificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481136"><span class="hs-identifier hs-var hs-var">toApiOtherCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT NonWalletCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiT NonWalletCertificate -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#OtherCertificate"><span class="hs-identifier hs-var">OtherCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT NonWalletCertificate -&gt; ApiAnyCertificate n)
-&gt; (NonWalletCertificate -&gt; ApiT NonWalletCertificate)
-&gt; NonWalletCertificate
-&gt; ApiAnyCertificate n
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NonWalletCertificate -&gt; ApiT NonWalletCertificate
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span>
</span><span id="line-2982"></span><span>
</span><span id="line-2983"></span><span>    </span><span id="local-6989586621682481139"><span class="annot"><span class="annottext">toApiPoolCert :: PoolCertificate -&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481139"><span class="hs-identifier hs-var hs-var">toApiPoolCert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Registration"><span class="hs-identifier hs-type">W.Registration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolRegistrationCertificate"><span class="hs-identifier hs-type">W.PoolRegistrationCertificate</span></a></span><span> </span><span id="local-6989586621682481132"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481132"><span class="hs-identifier hs-var">poolId'</span></a></span></span><span> </span><span id="local-6989586621682481131"><span class="annot"><span class="annottext">[PoolOwner]
</span><a href="#local-6989586621682481131"><span class="hs-identifier hs-var">poolOwners'</span></a></span></span><span> </span><span id="local-6989586621682481130"><span class="annot"><span class="annottext">Percentage
</span><a href="#local-6989586621682481130"><span class="hs-identifier hs-var">poolMargin'</span></a></span></span><span> </span><span id="local-6989586621682481129"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481129"><span class="hs-identifier hs-var">poolCost'</span></a></span></span><span> </span><span id="local-6989586621682481128"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481128"><span class="hs-identifier hs-var">poolPledge'</span></a></span></span><span> </span><span id="local-6989586621682481127"><span class="annot"><span class="annottext">Maybe (StakePoolMetadataUrl, StakePoolMetadataHash)
</span><a href="#local-6989586621682481127"><span class="hs-identifier hs-var">poolMetadata'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2984"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481126"><span class="annot"><span class="annottext">enrich :: (a, a) -&gt; (ApiT a, ApiT a)
</span><a href="#local-6989586621682481126"><span class="hs-identifier hs-var hs-var">enrich</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481125"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481125"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481124"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481124"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ApiT a
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481125"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; ApiT a
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682481124"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2985"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ApiRegisterPool -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiRegisterPool -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#StakePoolRegister"><span class="hs-identifier hs-var">StakePoolRegister</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiRegisterPool -&gt; ApiAnyCertificate n)
-&gt; ApiRegisterPool -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
-&gt; [ApiT PoolOwner]
-&gt; Quantity &quot;percent&quot; Percentage
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Maybe (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
-&gt; ApiRegisterPool
</span><a href="Cardano.Wallet.Api.Types.html#ApiRegisterPool"><span class="hs-identifier hs-var">ApiRegisterPool</span></a></span><span>
</span><span id="line-2986"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481132"><span class="hs-identifier hs-var">poolId'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2987"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PoolOwner -&gt; ApiT PoolOwner) -&gt; [PoolOwner] -&gt; [ApiT PoolOwner]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">PoolOwner -&gt; ApiT PoolOwner
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">[PoolOwner]
</span><a href="#local-6989586621682481131"><span class="hs-identifier hs-var">poolOwners'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2988"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Percentage -&gt; Quantity &quot;percent&quot; Percentage
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Percentage
</span><a href="#local-6989586621682481130"><span class="hs-identifier hs-var">poolMargin'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2989"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481129"><span class="hs-identifier hs-var">poolCost'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2990"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682481128"><span class="hs-identifier hs-var">poolPledge'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2991"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StakePoolMetadataUrl, StakePoolMetadataHash)
-&gt; (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
forall a a. (a, a) -&gt; (ApiT a, ApiT a)
</span><a href="#local-6989586621682481126"><span class="hs-identifier hs-var">enrich</span></a></span><span> </span><span class="annot"><span class="annottext">((StakePoolMetadataUrl, StakePoolMetadataHash)
 -&gt; (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash))
-&gt; Maybe (StakePoolMetadataUrl, StakePoolMetadataHash)
-&gt; Maybe (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (StakePoolMetadataUrl, StakePoolMetadataHash)
</span><a href="#local-6989586621682481127"><span class="hs-identifier hs-var">poolMetadata'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2992"></span><span>    </span><span class="annot"><a href="#local-6989586621682481139"><span class="hs-identifier hs-var">toApiPoolCert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Retirement"><span class="hs-identifier hs-type">W.Retirement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolRetirementCertificate"><span class="hs-identifier hs-type">W.PoolRetirementCertificate</span></a></span><span> </span><span id="local-6989586621682481119"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481119"><span class="hs-identifier hs-var">poolId'</span></a></span></span><span> </span><span id="local-6989586621682481118"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682481118"><span class="hs-identifier hs-var">retirementEpoch'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2993"></span><span>        </span><span class="annot"><span class="annottext">ApiDeregisterPool -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiDeregisterPool -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#StakePoolDeregister"><span class="hs-identifier hs-var">StakePoolDeregister</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiDeregisterPool -&gt; ApiAnyCertificate n)
-&gt; ApiDeregisterPool -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId -&gt; ApiT EpochNo -&gt; ApiDeregisterPool
</span><a href="Cardano.Wallet.Api.Types.html#ApiDeregisterPool"><span class="hs-identifier hs-var">ApiDeregisterPool</span></a></span><span>
</span><span id="line-2994"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481119"><span class="hs-identifier hs-var">poolId'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2995"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; ApiT EpochNo
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682481118"><span class="hs-identifier hs-var">retirementEpoch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2996"></span><span>
</span><span id="line-2997"></span><span>    </span><span id="local-6989586621682481142"><span class="annot"><span class="annottext">toApiDelCert :: RewardAccount
-&gt; NonEmpty DerivationIndex
-&gt; DelegationCertificate
-&gt; ApiAnyCertificate n
</span><a href="#local-6989586621682481142"><span class="hs-identifier hs-var hs-var">toApiDelCert</span></a></span></span><span> </span><span id="local-6989586621682481115"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481115"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span id="local-6989586621682481114"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481114"><span class="hs-identifier hs-var">acctPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertDelegateNone"><span class="hs-identifier hs-type">W.CertDelegateNone</span></a></span><span> </span><span id="local-6989586621682481112"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481112"><span class="hs-identifier hs-var">rewardKey</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2998"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481112"><span class="hs-identifier hs-var">rewardKey</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; RewardAccount -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481115"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2999"></span><span>            </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#QuitPool"><span class="hs-identifier hs-var">QuitPool</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate)
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481114"><span class="hs-identifier hs-var">acctPath</span></a></span><span>
</span><span id="line-3000"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-3001"></span><span>            </span><span class="annot"><span class="annottext">ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiExternalCertificate n -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#DelegationCertificate"><span class="hs-identifier hs-var">DelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiExternalCertificate n -&gt; ApiAnyCertificate n)
-&gt; ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#QuitPoolExternal"><span class="hs-identifier hs-var">QuitPoolExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481112"><span class="hs-identifier hs-var">rewardKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3002"></span><span>    </span><span class="annot"><a href="#local-6989586621682481142"><span class="hs-identifier hs-var">toApiDelCert</span></a></span><span> </span><span id="local-6989586621682481107"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481107"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span id="local-6989586621682481106"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481106"><span class="hs-identifier hs-var">acctPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertRegisterKey"><span class="hs-identifier hs-type">W.CertRegisterKey</span></a></span><span> </span><span id="local-6989586621682481104"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481104"><span class="hs-identifier hs-var">rewardKey</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3003"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481104"><span class="hs-identifier hs-var">rewardKey</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; RewardAccount -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481107"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-3004"></span><span>            </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3005"></span><span>            </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#RegisterRewardAccount"><span class="hs-identifier hs-var">RegisterRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate)
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481106"><span class="hs-identifier hs-var">acctPath</span></a></span><span>
</span><span id="line-3006"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-3007"></span><span>            </span><span class="annot"><span class="annottext">ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiExternalCertificate n -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#DelegationCertificate"><span class="hs-identifier hs-var">DelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiExternalCertificate n -&gt; ApiAnyCertificate n)
-&gt; ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3008"></span><span>            </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#RegisterRewardAccountExternal"><span class="hs-identifier hs-var">RegisterRewardAccountExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481104"><span class="hs-identifier hs-var">rewardKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3009"></span><span>    </span><span class="annot"><a href="#local-6989586621682481142"><span class="hs-identifier hs-var">toApiDelCert</span></a></span><span> </span><span id="local-6989586621682481101"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481101"><span class="hs-identifier hs-var">acct</span></a></span></span><span> </span><span id="local-6989586621682481100"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481100"><span class="hs-identifier hs-var">acctPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#CertDelegateFull"><span class="hs-identifier hs-type">W.CertDelegateFull</span></a></span><span> </span><span id="local-6989586621682481098"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481098"><span class="hs-identifier hs-var">rewardKey</span></a></span></span><span> </span><span id="local-6989586621682481097"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481097"><span class="hs-identifier hs-var">poolId'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3010"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481098"><span class="hs-identifier hs-var">rewardKey</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; RewardAccount -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481101"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-3011"></span><span>            </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3012"></span><span>            </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiT PoolId -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#JoinPool"><span class="hs-identifier hs-var">JoinPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481100"><span class="hs-identifier hs-var">acctPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481097"><span class="hs-identifier hs-var">poolId'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3013"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-3014"></span><span>            </span><span class="annot"><span class="annottext">ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiExternalCertificate n -&gt; ApiAnyCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#DelegationCertificate"><span class="hs-identifier hs-var">DelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiExternalCertificate n -&gt; ApiAnyCertificate n)
-&gt; ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3015"></span><span>            </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
-&gt; ApiT PoolId -&gt; ApiExternalCertificate n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n)
-&gt; ApiT PoolId -&gt; ApiExternalCertificate n
</span><a href="Cardano.Wallet.Api.Types.html#JoinPoolExternal"><span class="hs-identifier hs-var">JoinPoolExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481098"><span class="hs-identifier hs-var">rewardKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682481097"><span class="hs-identifier hs-var">poolId'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3016"></span><span>
</span><span id="line-3017"></span><span>    </span><span id="local-6989586621682481193"><span class="annot"><span class="annottext">ourRewardAccountRegistration :: ApiAnyCertificate n -&gt; Bool
</span><a href="#local-6989586621682481193"><span class="hs-identifier hs-var hs-var">ourRewardAccountRegistration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3018"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-type">WalletDelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#RegisterRewardAccount"><span class="hs-identifier hs-type">RegisterRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-3019"></span><span>        </span><span class="annot"><span class="annottext">ApiAnyCertificate n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-3020"></span><span>    </span><span id="local-6989586621682481192"><span class="annot"><span class="annottext">ourRewardAccountDeregistration :: ApiAnyCertificate n -&gt; Bool
</span><a href="#local-6989586621682481192"><span class="hs-identifier hs-var hs-var">ourRewardAccountDeregistration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3021"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-type">WalletDelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#QuitPool"><span class="hs-identifier hs-type">QuitPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-3022"></span><span>        </span><span class="annot"><span class="annottext">ApiAnyCertificate n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-3023"></span><span>
</span><span id="line-3024"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#toInp"><span class="hs-identifier hs-type">toInp</span></a></span><span>
</span><span id="line-3025"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483505"><span class="annot"><a href="#local-6989586621682483505"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3026"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxInputGeneral"><span class="hs-identifier hs-type">ApiTxInputGeneral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483505"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3027"></span><span id="toInp"><span class="annot"><span class="annottext">toInp :: (TxIn, Maybe (TxOut, NonEmpty DerivationIndex))
-&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toInp"><span class="hs-identifier hs-var hs-var">toInp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481094"><span class="annot"><span class="annottext">txin :: TxIn
</span><a href="#local-6989586621682481094"><span class="hs-identifier hs-var">txin</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span id="local-6989586621682481092"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481092"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621682481091"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682481091"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481090"><span class="annot"><span class="annottext">Maybe (TxOut, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481090"><span class="hs-identifier hs-var">txoutPathM</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3028"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682481090"><span class="hs-identifier hs-var">txoutPathM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3029"></span><span>        </span><span class="annot"><span class="annottext">Maybe (TxOut, NonEmpty DerivationIndex)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3030"></span><span>            </span><span class="annot"><span class="annottext">ApiT TxIn -&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant). ApiT TxIn -&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Types.html#ExternalInput"><span class="hs-identifier hs-var">ExternalInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; ApiT TxIn
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682481094"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3031"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682481087"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481087"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621682481085"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481085"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481084"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481084"><span class="hs-identifier hs-var">tmap</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481083"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481083"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3032"></span><span>            </span><span class="annot"><span class="annottext">ApiWalletInput n -&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletInput n -&gt; ApiTxInputGeneral n
</span><a href="Cardano.Wallet.Api.Types.html#WalletInput"><span class="hs-identifier hs-var">WalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletInput n -&gt; ApiTxInputGeneral n)
-&gt; ApiWalletInput n -&gt; ApiTxInputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletInput :: forall (n :: NetworkDiscriminant).
ApiT (Hash &quot;Tx&quot;)
-&gt; Word32
-&gt; (ApiT Address, Proxy n)
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiWalletInput n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span>
</span><span id="line-3033"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiWalletInput :: ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiWalletInput"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682481092"><span class="hs-identifier hs-var">txid</span></a></span><span>
</span><span id="line-3034"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:index:ApiWalletInput :: Word32
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aindex%3AApiWalletInput"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682481091"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3035"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletInput :: (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aaddress%3AApiWalletInput"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481087"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483505"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3036"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletInput :: NonEmpty (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AderivationPath%3AApiWalletInput"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481083"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-3037"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletInput :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiWalletInput"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481085"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-3038"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletInput :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiWalletInput"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481084"><span class="hs-identifier hs-var">tmap</span></a></span><span>
</span><span id="line-3039"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3040"></span><span>
</span><span id="line-3041"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#toOut"><span class="hs-identifier hs-type">toOut</span></a></span><span>
</span><span id="line-3042"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483504"><span class="annot"><a href="#local-6989586621682483504"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3043"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxOutputGeneral"><span class="hs-identifier hs-type">ApiTxOutputGeneral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483504"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3044"></span><span id="toOut"><span class="annot"><span class="annottext">toOut :: (TxOut, Maybe (NonEmpty DerivationIndex)) -&gt; ApiTxOutputGeneral n
</span><a href="Cardano.Wallet.Api.Server.html#toOut"><span class="hs-identifier hs-var hs-var">toOut</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481074"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682481074"><span class="hs-identifier hs-var">txoutIncoming</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty DerivationIndex)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3045"></span><span>    </span><span class="annot"><span class="annottext">ApiTxOutput n -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
ApiTxOutput n -&gt; ApiTxOutputGeneral n
</span><a href="Cardano.Wallet.Api.Types.html#ExternalOutput"><span class="hs-identifier hs-var">ExternalOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxOutput n -&gt; ApiTxOutputGeneral n)
-&gt; ApiTxOutput n -&gt; ApiTxOutputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; ApiTxOutput n
forall (n :: NetworkDiscriminant).
TxOut -&gt; AddressAmount (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Server.html#toAddressAmount"><span class="hs-identifier hs-var">toAddressAmount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483504"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621682481074"><span class="hs-identifier hs-var">txoutIncoming</span></a></span><span>
</span><span id="line-3046"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#toOut"><span class="hs-identifier hs-var">toOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682481071"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481071"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621682481070"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481070"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481069"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481069"><span class="hs-identifier hs-var">tmap</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481068"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481068"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3047"></span><span>        </span><span class="annot"><span class="annottext">ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletOutput n -&gt; ApiTxOutputGeneral n
</span><a href="Cardano.Wallet.Api.Types.html#WalletOutput"><span class="hs-identifier hs-var">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletOutput n -&gt; ApiTxOutputGeneral n)
-&gt; ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput :: forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiWalletOutput n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletOutput"><span class="hs-identifier hs-type">ApiWalletOutput</span></a></span><span>
</span><span id="line-3048"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletOutput :: (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aaddress%3AApiWalletOutput"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481071"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483504"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3049"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletOutput :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiWalletOutput"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481070"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-3050"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletOutput :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiWalletOutput"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481069"><span class="hs-identifier hs-var">tmap</span></a></span><span>
</span><span id="line-3051"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletOutput :: NonEmpty (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AderivationPath%3AApiWalletOutput"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481068"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-3052"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-3053"></span><span>
</span><span id="line-3054"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#submitTransaction"><span class="hs-identifier hs-type">submitTransaction</span></a></span><span>
</span><span id="line-3055"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682481061"><span class="annot"><a href="#local-6989586621682481061"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682481060"><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682481059"><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481058"><span class="annot"><a href="#local-6989586621682481058"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-3056"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682481061"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3057"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481061"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3058"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3059"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3060"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682481058"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3061"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3062"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682481061"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3063"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3064"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSerialisedTransaction"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span>
</span><span id="line-3065"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span>
</span><span id="line-3066"></span><span id="submitTransaction"><span class="annot"><span class="annottext">submitTransaction :: ctx -&gt; ApiT WalletId -&gt; ApiSerialisedTransaction -&gt; Handler ApiTxId
</span><a href="Cardano.Wallet.Api.Server.html#submitTransaction"><span class="hs-identifier hs-var hs-var">submitTransaction</span></a></span></span><span> </span><span id="local-6989586621682481057"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481057"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682481056"><span class="annot"><span class="annottext">apiw :: ApiT WalletId
</span><a href="#local-6989586621682481056"><span class="hs-identifier hs-var">apiw</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481055"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481055"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682481054"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682481054"><span class="hs-identifier hs-var">apitx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3067"></span><span>    </span><span class="hs-comment">--TODO: revisit/possibly set proper ttls in ADP-1193</span><span>
</span><span id="line-3068"></span><span>    </span><span id="local-6989586621682481053"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481053"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlotNo -&gt; Handler SlotNo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlotNo -&gt; Handler SlotNo) -&gt; IO SlotNo -&gt; Handler SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481052"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3069"></span><span>    </span><span id="local-6989586621682481051"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481051"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481050"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3070"></span><span>
</span><span id="line-3071"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481049"><span class="annot"><span class="annottext">sealedTx :: SealedTx
</span><a href="#local-6989586621682481049"><span class="hs-identifier hs-var hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; SealedTx
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT SealedTx -&gt; SealedTx)
-&gt; (ApiSerialisedTransaction -&gt; ApiT SealedTx)
-&gt; ApiSerialisedTransaction
-&gt; SealedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
 -&gt; ApiSerialisedTransaction
 -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction -&gt; ApiT SealedTx
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction
   -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiSerialisedTransaction
-&gt; Const (ApiT SealedTx) ApiSerialisedTransaction
</span><a href="#local-6989586621682481048"><span class="hs-var">#transaction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; SealedTx)
-&gt; ApiSerialisedTransaction -&gt; SealedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682481054"><span class="hs-identifier hs-var">apitx</span></a></span><span>
</span><span id="line-3072"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682481047"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481047"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TokenMapWithScripts
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Certificate]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra
-&gt; SealedTx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra
-&gt; tx
-&gt; (Tx, TokenMapWithScripts, TokenMapWithScripts, [Certificate],
    Maybe ValidityIntervalExplicit)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AdecodeTx%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">decodeTx</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682481046"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682481051"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481049"><span class="hs-identifier hs-var">sealedTx</span></a></span><span>
</span><span id="line-3073"></span><span>
</span><span id="line-3074"></span><span>    </span><span id="local-6989586621682481045"><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ApiT WalletId
-&gt; ApiSerialisedTransaction
-&gt; Handler (ApiDecodedTransaction n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(ctx ~ ApiLayer s k, IsOurs s Address, Typeable s, Typeable n,
 HasNetworkLayer IO ctx) =&gt;
ctx
-&gt; ApiT WalletId
-&gt; ApiSerialisedTransaction
-&gt; Handler (ApiDecodedTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#decodeTransaction"><span class="hs-identifier hs-var">decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481058"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481057"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT WalletId
</span><a href="#local-6989586621682481056"><span class="hs-identifier hs-var">apiw</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682481054"><span class="hs-identifier hs-var">apitx</span></a></span><span>
</span><span id="line-3075"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiDecodedTransaction n -&gt; Bool
forall s (t :: * -&gt; *) (n :: NetworkDiscriminant) (t :: * -&gt; *)
       (n :: NetworkDiscriminant).
(HasField' &quot;inputs&quot; s (t (ApiTxInputGeneral n)),
 HasField' &quot;withdrawals&quot; s (t (ApiWithdrawalGeneral n)), Foldable t,
 Foldable t) =&gt;
s -&gt; Bool
</span><a href="#local-6989586621682481044"><span class="hs-identifier hs-var">isForeign</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3076"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTransaction IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTransaction IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTransaction IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSubmitTransaction -&gt; ExceptT ErrSubmitTransaction IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSubmitTransaction
</span><a href="Cardano.Wallet.html#ErrSubmitTransactionForeignWallet"><span class="hs-identifier hs-var">ErrSubmitTransactionForeignWallet</span></a></span><span>
</span><span id="line-3077"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481042"><span class="annot"><span class="annottext">ourOuts :: [TxOut]
</span><a href="#local-6989586621682481042"><span class="hs-identifier hs-var hs-var">ourOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n -&gt; [TxOut]
forall s (n :: NetworkDiscriminant).
HasField' &quot;outputs&quot; s [ApiTxOutputGeneral n] =&gt;
s -&gt; [TxOut]
</span><a href="#local-6989586621682481041"><span class="hs-identifier hs-var">getOurOuts</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span>
</span><span id="line-3078"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481040"><span class="annot"><span class="annottext">ourInps :: [(TxIn, Coin)]
</span><a href="#local-6989586621682481040"><span class="hs-identifier hs-var hs-var">ourInps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n -&gt; [(TxIn, Coin)]
forall s (n :: NetworkDiscriminant).
HasField' &quot;inputs&quot; s [ApiTxInputGeneral n] =&gt;
s -&gt; [(TxIn, Coin)]
</span><a href="#local-6989586621682481039"><span class="hs-identifier hs-var">getOurInps</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span>
</span><span id="line-3079"></span><span>
</span><span id="line-3080"></span><span>    </span><span class="hs-comment">-- TODO: when partial signing is switched on we will need to revise this.</span><span>
</span><span id="line-3081"></span><span>    </span><span class="hs-comment">-- The following needs to be taken into account. Wits could come from:</span><span>
</span><span id="line-3082"></span><span>    </span><span class="hs-comment">-- (a) our wallet</span><span>
</span><span id="line-3083"></span><span>    </span><span class="hs-comment">-- (b) other parties</span><span>
</span><span id="line-3084"></span><span>    </span><span class="hs-comment">-- (c) script inputs</span><span>
</span><span id="line-3085"></span><span>    </span><span class="hs-comment">-- With (b) not supported we can now filter our inputs and look for the unique payment keys</span><span>
</span><span id="line-3086"></span><span>    </span><span class="hs-comment">-- Also with multisig switched on the input would need more than 1 wits</span><span>
</span><span id="line-3087"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481038"><span class="annot"><span class="annottext">witsRequiredForInputs :: Int
</span><a href="#local-6989586621682481038"><span class="hs-identifier hs-var hs-var">witsRequiredForInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxInputGeneral n] -&gt; Int) -&gt; [ApiTxInputGeneral n] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; ApiTxInputGeneral n -&gt; Bool)
-&gt; [ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.nubBy</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; ApiTxInputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant) (n :: NetworkDiscriminant).
ApiTxInputGeneral n -&gt; ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481036"><span class="hs-identifier hs-var">samePaymentKey</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n])
-&gt; [ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3088"></span><span>            </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; Bool)
-&gt; [ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481035"><span class="hs-identifier hs-var">isInpOurs</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n])
-&gt; [ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3089"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
-&gt; (([ApiTxInputGeneral n]
     -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
    -&gt; ApiDecodedTransaction n
    -&gt; Const [ApiTxInputGeneral n] (ApiDecodedTransaction n))
-&gt; [ApiTxInputGeneral n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n]
    -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n
   -&gt; Const [ApiTxInputGeneral n] (ApiDecodedTransaction n))
([ApiTxInputGeneral n]
 -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
-&gt; ApiDecodedTransaction n
-&gt; Const [ApiTxInputGeneral n] (ApiDecodedTransaction n)
</span><a href="#local-6989586621682481034"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n]
-&gt; [ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
-&gt; (([ApiTxInputGeneral n]
     -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
    -&gt; ApiDecodedTransaction n
    -&gt; Const [ApiTxInputGeneral n] (ApiDecodedTransaction n))
-&gt; [ApiTxInputGeneral n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([ApiTxInputGeneral n]
    -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n
   -&gt; Const [ApiTxInputGeneral n] (ApiDecodedTransaction n))
([ApiTxInputGeneral n]
 -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
-&gt; ApiDecodedTransaction n
-&gt; Const [ApiTxInputGeneral n] (ApiDecodedTransaction n)
</span><a href="#local-6989586621682481033"><span class="hs-var">#collateral</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3090"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481032"><span class="annot"><span class="annottext">totalNumberOfWits :: Int
</span><a href="#local-6989586621682481032"><span class="hs-identifier hs-var hs-var">totalNumberOfWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InAnyCardanoEra KeyWitness] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([InAnyCardanoEra KeyWitness] -&gt; Int)
-&gt; [InAnyCardanoEra KeyWitness] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; [InAnyCardanoEra KeyWitness]
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#getSealedTxWitnesses"><span class="hs-identifier hs-var">getSealedTxWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481049"><span class="hs-identifier hs-var">sealedTx</span></a></span><span>
</span><span id="line-3091"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481031"><span class="annot"><span class="annottext">ourDel :: [Maybe DelegationAction]
</span><a href="#local-6989586621682481031"><span class="hs-identifier hs-var hs-var">ourDel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3092"></span><span>            </span><span class="annot"><span class="annottext">(Maybe DelegationAction -&gt; Bool)
-&gt; [Maybe DelegationAction] -&gt; [Maybe DelegationAction]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DelegationAction -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe DelegationAction] -&gt; [Maybe DelegationAction])
-&gt; [Maybe DelegationAction] -&gt; [Maybe DelegationAction]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3093"></span><span>            </span><span class="annot"><span class="annottext">(ApiAnyCertificate n -&gt; Maybe DelegationAction)
-&gt; [ApiAnyCertificate n] -&gt; [Maybe DelegationAction]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n -&gt; Maybe DelegationAction
forall (n :: NetworkDiscriminant).
ApiAnyCertificate n -&gt; Maybe DelegationAction
</span><a href="#local-6989586621682481030"><span class="hs-identifier hs-var">isJoiningOrQuitting</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiAnyCertificate n] -&gt; [Maybe DelegationAction])
-&gt; [ApiAnyCertificate n] -&gt; [Maybe DelegationAction]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
-&gt; (([ApiAnyCertificate n]
     -&gt; Const [ApiAnyCertificate n] [ApiAnyCertificate n])
    -&gt; ApiDecodedTransaction n
    -&gt; Const [ApiAnyCertificate n] (ApiDecodedTransaction n))
-&gt; [ApiAnyCertificate n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n]
    -&gt; Const [ApiAnyCertificate n] [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n
   -&gt; Const [ApiAnyCertificate n] (ApiDecodedTransaction n))
([ApiAnyCertificate n]
 -&gt; Const [ApiAnyCertificate n] [ApiAnyCertificate n])
-&gt; ApiDecodedTransaction n
-&gt; Const [ApiAnyCertificate n] (ApiDecodedTransaction n)
</span><a href="#local-6989586621682481029"><span class="hs-var">#certificates</span></a></span><span>
</span><span id="line-3094"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe DelegationAction] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe DelegationAction]
</span><a href="#local-6989586621682481031"><span class="hs-identifier hs-var">ourDel</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3095"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTransaction IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTransaction IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTransaction IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSubmitTransaction -&gt; ExceptT ErrSubmitTransaction IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSubmitTransaction
</span><a href="Cardano.Wallet.html#ErrSubmitTransactionMultidelegationNotSupported"><span class="hs-identifier hs-var">ErrSubmitTransactionMultidelegationNotSupported</span></a></span><span>
</span><span id="line-3096"></span><span>
</span><span id="line-3097"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481027"><span class="annot"><span class="annottext">delAction :: Maybe DelegationAction
</span><a href="#local-6989586621682481027"><span class="hs-identifier hs-var hs-var">delAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe DelegationAction]
</span><a href="#local-6989586621682481031"><span class="hs-identifier hs-var">ourDel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3098"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682481026"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481026"><span class="hs-identifier hs-var">del</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682481026"><span class="hs-identifier hs-var">del</span></a></span><span>
</span><span id="line-3099"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe DelegationAction
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3100"></span><span>            </span><span class="annot"><span class="annottext">[Maybe DelegationAction]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe DelegationAction
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible to be here due to check above&quot;</span></span><span>
</span><span id="line-3101"></span><span>
</span><span id="line-3102"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682481038"><span class="hs-identifier hs-var">witsRequiredForInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682481032"><span class="hs-identifier hs-var">totalNumberOfWits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3103"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTransaction IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTransaction IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTransaction IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSubmitTransaction -&gt; ExceptT ErrSubmitTransaction IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrSubmitTransaction -&gt; ExceptT ErrSubmitTransaction IO ())
-&gt; ErrSubmitTransaction -&gt; ExceptT ErrSubmitTransaction IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3104"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ErrSubmitTransaction
</span><a href="Cardano.Wallet.html#ErrSubmitTransactionPartiallySignedOrNoSignedTx"><span class="hs-identifier hs-var">ErrSubmitTransactionPartiallySignedOrNoSignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682481038"><span class="hs-identifier hs-var">witsRequiredForInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682481032"><span class="hs-identifier hs-var">totalNumberOfWits</span></a></span><span>
</span><span id="line-3105"></span><span>
</span><span id="line-3106"></span><span>    </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ())
-&gt; (ErrWalletNotResponding -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ())
-&gt; Handler ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481057"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481055"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ()
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ())
-&gt; (WorkerCtx ctx -&gt; Handler ()) -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682481024"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682481024"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3107"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682481023"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481023"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682481022"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481022"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount
  IO
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">W.readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481058"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481024"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481055"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3108"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481021"><span class="annot"><span class="annottext">wdrl :: Withdrawal
</span><a href="#local-6989586621682481021"><span class="hs-identifier hs-var hs-var">wdrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardAccount
-&gt; NonEmpty DerivationIndex
-&gt; ApiDecodedTransaction n
-&gt; Withdrawal
forall s (n :: NetworkDiscriminant).
HasField' &quot;withdrawals&quot; s [ApiWithdrawalGeneral n] =&gt;
RewardAccount -&gt; NonEmpty DerivationIndex -&gt; s -&gt; Withdrawal
</span><a href="#local-6989586621682481020"><span class="hs-identifier hs-var">getOurWdrl</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481023"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481022"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span>
</span><span id="line-3109"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481019"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682481019"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-3110"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- TODO: [ADP-1193]</span><span>
</span><span id="line-3111"></span><span>                  </span><span class="hs-comment">-- Get this from decodeTx:</span><span>
</span><span id="line-3112"></span><span>                  </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SlotNo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682481053"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3113"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682481021"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-3114"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DelegationAction
</span><a href="#local-6989586621682481027"><span class="hs-identifier hs-var">delAction</span></a></span><span>
</span><span id="line-3115"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3116"></span><span>        </span><span id="local-6989586621682481018"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682481018"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTransaction IO TxMeta -&gt; Handler TxMeta
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTransaction IO TxMeta -&gt; Handler TxMeta)
-&gt; ExceptT ErrSubmitTransaction IO TxMeta -&gt; Handler TxMeta
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; TransactionCtx
-&gt; [(TxIn, Coin)]
-&gt; [TxOut]
-&gt; ExceptT ErrSubmitTransaction IO TxMeta
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; TransactionCtx
-&gt; [(TxIn, Coin)]
-&gt; [TxOut]
-&gt; ExceptT ErrSubmitTransaction IO TxMeta
</span><a href="Cardano.Wallet.html#constructTxMeta"><span class="hs-identifier hs-var">W.constructTxMeta</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481024"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481055"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682481019"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, Coin)]
</span><a href="#local-6989586621682481040"><span class="hs-identifier hs-var">ourInps</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621682481042"><span class="hs-identifier hs-var">ourOuts</span></a></span><span>
</span><span id="line-3117"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3118"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasDBLayer IO s k ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
</span><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-var">W.submitTx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682481024"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682481055"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682481047"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682481018"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682481049"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3119"></span><span>    </span><span class="annot"><span class="annottext">ApiTxId -&gt; Handler ApiTxId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxId -&gt; Handler ApiTxId) -&gt; ApiTxId -&gt; Handler ApiTxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiDecodedTransaction n
</span><a href="#local-6989586621682481045"><span class="hs-identifier hs-var">apiDecoded</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDecodedTransaction n
-&gt; ((ApiT (Hash &quot;Tx&quot;)
     -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiT (Hash &quot;Tx&quot;)))
    -&gt; ApiDecodedTransaction n
    -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiDecodedTransaction n))
-&gt; ApiT (Hash &quot;Tx&quot;)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiDecodedTransaction n
   -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiDecodedTransaction n))
(ApiT (Hash &quot;Tx&quot;) -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiT (Hash &quot;Tx&quot;)))
-&gt; ApiDecodedTransaction n
-&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiDecodedTransaction n)
</span><a href="#local-6989586621682481016"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3121"></span><span>    </span><span id="local-6989586621682481046"><span class="annot"><span class="annottext">tl :: TransactionLayer k SealedTx
</span><a href="#local-6989586621682481046"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481057"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((TransactionLayer k SealedTx
     -&gt; Const
          (TransactionLayer k SealedTx) (TransactionLayer k SealedTx))
    -&gt; ctx -&gt; Const (TransactionLayer k SealedTx) ctx)
-&gt; TransactionLayer k SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
forall (k :: Depth -&gt; * -&gt; *) ctx.
HasTransactionLayer k ctx =&gt;
Lens' ctx (TransactionLayer k SealedTx)
</span><a href="Cardano.Wallet.html#transactionLayer"><span class="hs-identifier hs-var">W.transactionLayer</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682481059"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3122"></span><span>    </span><span class="annot"><a href="#local-6989586621682481052"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3123"></span><span>    </span><span id="local-6989586621682481050"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682481050"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682481057"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-3124"></span><span>    </span><span id="local-6989586621682481052"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682481052"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682481050"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3125"></span><span>
</span><span id="line-3126"></span><span>    </span><span id="local-6989586621682481015"><span class="annot"><span class="annottext">isOutOurs :: ApiTxOutputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481015"><span class="hs-identifier hs-var hs-var">isOutOurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletOutput"><span class="hs-identifier hs-type">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-3127"></span><span>    </span><span class="annot"><a href="#local-6989586621682481015"><span class="hs-identifier hs-var">isOutOurs</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-3128"></span><span>    </span><span id="local-6989586621682481014"><span class="annot"><span class="annottext">toTxOut :: ApiTxOutputGeneral n -&gt; TxOut
</span><a href="#local-6989586621682481014"><span class="hs-identifier hs-var hs-var">toTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletOutput"><span class="hs-identifier hs-type">WalletOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletOutput"><span class="hs-identifier hs-type">ApiWalletOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481013"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481013"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682481012"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481012"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481011"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481011"><span class="hs-identifier hs-var">tmap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3129"></span><span>        </span><span class="annot"><span class="annottext">Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682481013"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; TokenMap -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-var">TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Coin) -&gt; Natural -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682481012"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682481011"><span class="hs-identifier hs-var">tmap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3130"></span><span>    </span><span class="annot"><a href="#local-6989586621682481014"><span class="hs-identifier hs-var">toTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TxOut
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;we should have only our outputs at this point&quot;</span></span><span>
</span><span id="line-3131"></span><span>    </span><span id="local-6989586621682481041"><span class="annot"><span class="annottext">getOurOuts :: s -&gt; [TxOut]
</span><a href="#local-6989586621682481041"><span class="hs-identifier hs-var hs-var">getOurOuts</span></a></span></span><span> </span><span id="local-6989586621682481010"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481010"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3132"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481009"><span class="annot"><span class="annottext">generalOuts :: [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682481009"><span class="hs-identifier hs-var hs-var">generalOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481010"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; (([ApiTxOutputGeneral n]
     -&gt; Const [ApiTxOutputGeneral n] [ApiTxOutputGeneral n])
    -&gt; s -&gt; Const [ApiTxOutputGeneral n] s)
-&gt; [ApiTxOutputGeneral n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n]
    -&gt; Const [ApiTxOutputGeneral n] [ApiTxOutputGeneral n])
   -&gt; s -&gt; Const [ApiTxOutputGeneral n] s)
([ApiTxOutputGeneral n]
 -&gt; Const [ApiTxOutputGeneral n] [ApiTxOutputGeneral n])
-&gt; s -&gt; Const [ApiTxOutputGeneral n] s
</span><a href="#local-6989586621682481008"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-3133"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ApiTxOutputGeneral n -&gt; TxOut)
-&gt; [ApiTxOutputGeneral n] -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n -&gt; TxOut
forall (n :: NetworkDiscriminant). ApiTxOutputGeneral n -&gt; TxOut
</span><a href="#local-6989586621682481014"><span class="hs-identifier hs-var">toTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxOutputGeneral n] -&gt; [TxOut])
-&gt; [ApiTxOutputGeneral n] -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxOutputGeneral n -&gt; Bool)
-&gt; [ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxOutputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481015"><span class="hs-identifier hs-var">isOutOurs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n]
</span><a href="#local-6989586621682481009"><span class="hs-identifier hs-var">generalOuts</span></a></span><span>
</span><span id="line-3134"></span><span>
</span><span id="line-3135"></span><span>    </span><span id="local-6989586621682481020"><span class="annot"><span class="annottext">getOurWdrl :: RewardAccount -&gt; NonEmpty DerivationIndex -&gt; s -&gt; Withdrawal
</span><a href="#local-6989586621682481020"><span class="hs-identifier hs-var hs-var">getOurWdrl</span></a></span></span><span> </span><span id="local-6989586621682481007"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481007"><span class="hs-identifier hs-var">rewardAcct</span></a></span></span><span> </span><span id="local-6989586621682481006"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481006"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682481005"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481005"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3136"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682481004"><span class="annot"><span class="annottext">generalWdrls :: [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682481004"><span class="hs-identifier hs-var hs-var">generalWdrls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682481005"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; (([ApiWithdrawalGeneral n]
     -&gt; Const [ApiWithdrawalGeneral n] [ApiWithdrawalGeneral n])
    -&gt; s -&gt; Const [ApiWithdrawalGeneral n] s)
-&gt; [ApiWithdrawalGeneral n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n]
    -&gt; Const [ApiWithdrawalGeneral n] [ApiWithdrawalGeneral n])
   -&gt; s -&gt; Const [ApiWithdrawalGeneral n] s)
([ApiWithdrawalGeneral n]
 -&gt; Const [ApiWithdrawalGeneral n] [ApiWithdrawalGeneral n])
-&gt; s -&gt; Const [ApiWithdrawalGeneral n] s
</span><a href="#local-6989586621682481003"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-3137"></span><span>            </span><span id="local-6989586621682481002"><span class="annot"><span class="annottext">isWdrlOurs :: ApiWithdrawalGeneral n -&gt; Bool
</span><a href="#local-6989586621682481002"><span class="hs-identifier hs-var hs-var">isWdrlOurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalGeneral"><span class="hs-identifier hs-type">ApiWithdrawalGeneral</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682481001"><span class="annot"><span class="annottext">ResourceContext
</span><a href="#local-6989586621682481001"><span class="hs-identifier hs-var">context</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="#local-6989586621682481001"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext -&gt; ResourceContext -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="Cardano.Wallet.Api.Types.html#Our"><span class="hs-identifier hs-var">Our</span></a></span><span>
</span><span id="line-3138"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(ApiWithdrawalGeneral n -&gt; Bool)
-&gt; [ApiWithdrawalGeneral n] -&gt; [ApiWithdrawalGeneral n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiWithdrawalGeneral n -&gt; Bool
</span><a href="#local-6989586621682481002"><span class="hs-identifier hs-var">isWdrlOurs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682481004"><span class="hs-identifier hs-var">generalWdrls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3139"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalGeneral"><span class="hs-identifier hs-type">ApiWithdrawalGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682481000"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481000"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682480999"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480999"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3140"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480998"><span class="annot"><span class="annottext">acct' :: RewardAccount
</span><a href="#local-6989586621682480998"><span class="hs-identifier hs-var hs-var">acct'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RewardAccount -&gt; (RewardAccount -&gt; Bool) -&gt; RewardAccount
forall a. HasCallStack =&gt; String -&gt; a -&gt; (a -&gt; Bool) -&gt; a
</span><a href="Cardano.Wallet.Util.html#invariant"><span class="hs-identifier hs-var">invariant</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reward account should be the same&quot;</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481000"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682481007"><span class="hs-identifier hs-var">rewardAcct</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; RewardAccount -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3141"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; NonEmpty DerivationIndex -&gt; Coin -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-var">WithdrawalSelf</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480998"><span class="hs-identifier hs-var">acct'</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682481006"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480999"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3142"></span><span>            </span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3143"></span><span>                </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span>
</span><span id="line-3144"></span><span>
</span><span id="line-3145"></span><span>    </span><span id="local-6989586621682481035"><span class="annot"><span class="annottext">isInpOurs :: ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481035"><span class="hs-identifier hs-var hs-var">isInpOurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletInput"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletInput n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-3146"></span><span>    </span><span class="annot"><a href="#local-6989586621682481035"><span class="hs-identifier hs-var">isInpOurs</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-3147"></span><span>    </span><span id="local-6989586621682480996"><span class="annot"><span class="annottext">toTxInp :: ApiTxInputGeneral n -&gt; (TxIn, Coin)
</span><a href="#local-6989586621682480996"><span class="hs-identifier hs-var hs-var">toTxInp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletInput"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480995"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682480995"><span class="hs-identifier hs-var">txid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480994"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682480994"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682480993"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480993"><span class="hs-identifier hs-var">amt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3148"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Word32 -&gt; TxIn
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682480995"><span class="hs-identifier hs-var">txid</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682480994"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Coin) -&gt; Natural -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480993"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3149"></span><span>    </span><span class="annot"><a href="#local-6989586621682480996"><span class="hs-identifier hs-var">toTxInp</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (TxIn, Coin)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;we should have only our inputs at this point&quot;</span></span><span>
</span><span id="line-3150"></span><span>    </span><span id="local-6989586621682481039"><span class="annot"><span class="annottext">getOurInps :: s -&gt; [(TxIn, Coin)]
</span><a href="#local-6989586621682481039"><span class="hs-identifier hs-var hs-var">getOurInps</span></a></span></span><span> </span><span id="local-6989586621682480992"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480992"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3151"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480991"><span class="annot"><span class="annottext">generalInps :: [ApiTxInputGeneral n]
</span><a href="#local-6989586621682480991"><span class="hs-identifier hs-var hs-var">generalInps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480992"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; (([ApiTxInputGeneral n]
     -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
    -&gt; s -&gt; Const [ApiTxInputGeneral n] s)
-&gt; [ApiTxInputGeneral n]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n]
    -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
   -&gt; s -&gt; Const [ApiTxInputGeneral n] s)
([ApiTxInputGeneral n]
 -&gt; Const [ApiTxInputGeneral n] [ApiTxInputGeneral n])
-&gt; s -&gt; Const [ApiTxInputGeneral n] s
</span><a href="#local-6989586621682480990"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-3152"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; (TxIn, Coin))
-&gt; [ApiTxInputGeneral n] -&gt; [(TxIn, Coin)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; (TxIn, Coin)
forall (n :: NetworkDiscriminant).
ApiTxInputGeneral n -&gt; (TxIn, Coin)
</span><a href="#local-6989586621682480996"><span class="hs-identifier hs-var">toTxInp</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxInputGeneral n] -&gt; [(TxIn, Coin)])
-&gt; [ApiTxInputGeneral n] -&gt; [(TxIn, Coin)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; Bool)
-&gt; [ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481035"><span class="hs-identifier hs-var">isInpOurs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n]
</span><a href="#local-6989586621682480991"><span class="hs-identifier hs-var">generalInps</span></a></span><span>
</span><span id="line-3153"></span><span>
</span><span id="line-3154"></span><span>    </span><span id="local-6989586621682481044"><span class="annot"><span class="annottext">isForeign :: s -&gt; Bool
</span><a href="#local-6989586621682481044"><span class="hs-identifier hs-var hs-var">isForeign</span></a></span></span><span> </span><span id="local-6989586621682480989"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480989"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3155"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480988"><span class="annot"><span class="annottext">generalInps :: t (ApiTxInputGeneral n)
</span><a href="#local-6989586621682480988"><span class="hs-identifier hs-var hs-var">generalInps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480989"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; ((t (ApiTxInputGeneral n)
     -&gt; Const (t (ApiTxInputGeneral n)) (t (ApiTxInputGeneral n)))
    -&gt; s -&gt; Const (t (ApiTxInputGeneral n)) s)
-&gt; t (ApiTxInputGeneral n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((t (ApiTxInputGeneral n)
    -&gt; Const (t (ApiTxInputGeneral n)) (t (ApiTxInputGeneral n)))
   -&gt; s -&gt; Const (t (ApiTxInputGeneral n)) s)
(t (ApiTxInputGeneral n)
 -&gt; Const (t (ApiTxInputGeneral n)) (t (ApiTxInputGeneral n)))
-&gt; s -&gt; Const (t (ApiTxInputGeneral n)) s
</span><a href="#local-6989586621682480987"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-3156"></span><span>            </span><span id="local-6989586621682480986"><span class="annot"><span class="annottext">generalWdrls :: t (ApiWithdrawalGeneral n)
</span><a href="#local-6989586621682480986"><span class="hs-identifier hs-var hs-var">generalWdrls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480989"><span class="hs-identifier hs-var">apiDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; ((t (ApiWithdrawalGeneral n)
     -&gt; Const (t (ApiWithdrawalGeneral n)) (t (ApiWithdrawalGeneral n)))
    -&gt; s -&gt; Const (t (ApiWithdrawalGeneral n)) s)
-&gt; t (ApiWithdrawalGeneral n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  ((t (ApiWithdrawalGeneral n)
    -&gt; Const (t (ApiWithdrawalGeneral n)) (t (ApiWithdrawalGeneral n)))
   -&gt; s -&gt; Const (t (ApiWithdrawalGeneral n)) s)
(t (ApiWithdrawalGeneral n)
 -&gt; Const (t (ApiWithdrawalGeneral n)) (t (ApiWithdrawalGeneral n)))
-&gt; s -&gt; Const (t (ApiWithdrawalGeneral n)) s
</span><a href="#local-6989586621682480985"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-3157"></span><span>            </span><span id="local-6989586621682480984"><span class="annot"><span class="annottext">isInpForeign :: ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682480984"><span class="hs-identifier hs-var hs-var">isInpForeign</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletInput"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletInput n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-3158"></span><span>            </span><span class="annot"><a href="#local-6989586621682480984"><span class="hs-identifier hs-var">isInpForeign</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-3159"></span><span>            </span><span id="local-6989586621682480983"><span class="annot"><span class="annottext">isWdrlForeign :: ApiWithdrawalGeneral n -&gt; Bool
</span><a href="#local-6989586621682480983"><span class="hs-identifier hs-var hs-var">isWdrlForeign</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalGeneral"><span class="hs-identifier hs-type">ApiWithdrawalGeneral</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682480982"><span class="annot"><span class="annottext">ResourceContext
</span><a href="#local-6989586621682480982"><span class="hs-identifier hs-var">context</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="#local-6989586621682480982"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext -&gt; ResourceContext -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="Cardano.Wallet.Api.Types.html#External"><span class="hs-identifier hs-var">External</span></a></span><span>
</span><span id="line-3160"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-3161"></span><span>            </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; Bool) -&gt; t (ApiTxInputGeneral n) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682480984"><span class="hs-identifier hs-var">isInpForeign</span></a></span><span> </span><span class="annot"><span class="annottext">t (ApiTxInputGeneral n)
</span><a href="#local-6989586621682480988"><span class="hs-identifier hs-var">generalInps</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-3162"></span><span>            </span><span class="annot"><span class="annottext">(ApiWithdrawalGeneral n -&gt; Bool)
-&gt; t (ApiWithdrawalGeneral n) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiWithdrawalGeneral n -&gt; Bool
</span><a href="#local-6989586621682480983"><span class="hs-identifier hs-var">isWdrlForeign</span></a></span><span> </span><span class="annot"><span class="annottext">t (ApiWithdrawalGeneral n)
</span><a href="#local-6989586621682480986"><span class="hs-identifier hs-var">generalWdrls</span></a></span><span>
</span><span id="line-3163"></span><span>
</span><span id="line-3164"></span><span>    </span><span id="local-6989586621682481036"><span class="annot"><span class="annottext">samePaymentKey :: ApiTxInputGeneral n -&gt; ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682481036"><span class="hs-identifier hs-var hs-var">samePaymentKey</span></a></span></span><span> </span><span id="local-6989586621682480981"><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682480981"><span class="hs-identifier hs-var">inp1</span></a></span></span><span> </span><span id="local-6989586621682480980"><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682480980"><span class="hs-identifier hs-var">inp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682480981"><span class="hs-identifier hs-var">inp1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682480980"><span class="hs-identifier hs-var">inp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3165"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletInput"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682480979"><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480979"><span class="hs-identifier hs-var">derPath1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletInput"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682480978"><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480978"><span class="hs-identifier hs-var">derPath2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3166"></span><span>               </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480979"><span class="hs-identifier hs-var">derPath1</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480978"><span class="hs-identifier hs-var">derPath2</span></a></span><span>
</span><span id="line-3167"></span><span>        </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n, ApiTxInputGeneral n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-3168"></span><span>    </span><span id="local-6989586621682481030"><span class="annot"><span class="annottext">isJoiningOrQuitting :: ApiAnyCertificate n -&gt; Maybe DelegationAction
</span><a href="#local-6989586621682481030"><span class="hs-identifier hs-var hs-var">isJoiningOrQuitting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3169"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-type">WalletDelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#JoinPool"><span class="hs-identifier hs-type">JoinPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480977"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480977"><span class="hs-identifier hs-var">poolId</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3170"></span><span>            </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(DelegationAction -&gt; Maybe DelegationAction)
-&gt; DelegationAction -&gt; Maybe DelegationAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#Join"><span class="hs-identifier hs-var">Join</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480977"><span class="hs-identifier hs-var">poolId</span></a></span><span>
</span><span id="line-3171"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#WalletDelegationCertificate"><span class="hs-identifier hs-type">WalletDelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#QuitPool"><span class="hs-identifier hs-type">QuitPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3172"></span><span>            </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#Quit"><span class="hs-identifier hs-var">Quit</span></a></span><span>
</span><span id="line-3173"></span><span>        </span><span class="annot"><span class="annottext">ApiAnyCertificate n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3174"></span><span>            </span><span class="annot"><span class="annottext">Maybe DelegationAction
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3175"></span><span>
</span><span id="line-3176"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#joinStakePool"><span class="hs-identifier hs-type">joinStakePool</span></a></span><span>
</span><span id="line-3177"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480974"><span class="annot"><a href="#local-6989586621682480974"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480973"><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480972"><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682480971"><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3178"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480974"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3179"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3180"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span>
</span><span id="line-3181"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier hs-type">DelegationAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3182"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3183"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3184"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3185"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3186"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3188"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3189"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3190"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3191"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480974"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3192"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3193"></span><span>       </span><span class="hs-comment">-- ^ Known pools</span><span>
</span><span id="line-3194"></span><span>       </span><span class="hs-comment">-- We could maybe replace this with a @IO (PoolId -&gt; Bool)@</span><span>
</span><span id="line-3195"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolLifeCycleStatus"><span class="hs-identifier hs-type">PoolLifeCycleStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3196"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPoolId"><span class="hs-identifier hs-type">ApiPoolId</span></a></span><span>
</span><span id="line-3197"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3198"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphrase"><span class="hs-identifier hs-type">ApiWalletPassphrase</span></a></span><span>
</span><span id="line-3199"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3200"></span><span id="joinStakePool"><span class="annot"><span class="annottext">joinStakePool :: ctx
-&gt; IO (Set PoolId)
-&gt; (PoolId -&gt; IO PoolLifeCycleStatus)
-&gt; ApiPoolId
-&gt; ApiT WalletId
-&gt; ApiWalletPassphrase
-&gt; Handler (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#joinStakePool"><span class="hs-identifier hs-var hs-var">joinStakePool</span></a></span></span><span> </span><span id="local-6989586621682480970"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480970"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480969"><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682480969"><span class="hs-identifier hs-var">knownPools</span></a></span></span><span> </span><span id="local-6989586621682480968"><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682480968"><span class="hs-identifier hs-var">getPoolStatus</span></a></span></span><span> </span><span id="local-6989586621682480967"><span class="annot"><span class="annottext">ApiPoolId
</span><a href="#local-6989586621682480967"><span class="hs-identifier hs-var">apiPoolId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480966"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480965"><span class="annot"><span class="annottext">ApiWalletPassphrase
</span><a href="#local-6989586621682480965"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3201"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480964"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480964"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;)
-&gt; Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;)
-&gt; ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletPassphrase
</span><a href="#local-6989586621682480965"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletPassphrase
-&gt; ((ApiT (Passphrase &quot;lenient&quot;)
     -&gt; Const
          (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
    -&gt; ApiWalletPassphrase
    -&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiWalletPassphrase)
-&gt; ApiT (Passphrase &quot;lenient&quot;)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const
         (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
   -&gt; ApiWalletPassphrase
   -&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiWalletPassphrase)
(ApiT (Passphrase &quot;lenient&quot;)
 -&gt; Const
      (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; ApiWalletPassphrase
-&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiWalletPassphrase
</span><a href="#local-6989586621682480963"><span class="hs-var">#passphrase</span></a></span><span>
</span><span id="line-3202"></span><span>
</span><span id="line-3203"></span><span>    </span><span id="local-6989586621682480962"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480962"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiPoolId
</span><a href="#local-6989586621682480967"><span class="hs-identifier hs-var">apiPoolId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3204"></span><span>        </span><span class="annot"><span class="annottext">ApiPoolId
</span><a href="Cardano.Wallet.Api.Types.html#ApiPoolIdPlaceholder"><span class="hs-identifier hs-var">ApiPoolIdPlaceholder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrUnexpectedPoolIdPlaceholder -&gt; Handler PoolId
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrUnexpectedPoolIdPlaceholder
</span><a href="Cardano.Wallet.Api.Server.html#ErrUnexpectedPoolIdPlaceholder"><span class="hs-identifier hs-var">ErrUnexpectedPoolIdPlaceholder</span></a></span><span>
</span><span id="line-3205"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPoolId"><span class="hs-identifier hs-type">ApiPoolId</span></a></span><span> </span><span id="local-6989586621682480958"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480958"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; Handler PoolId
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480958"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-3206"></span><span>
</span><span id="line-3207"></span><span>    </span><span id="local-6989586621682480957"><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682480957"><span class="hs-identifier hs-var">poolStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO PoolLifeCycleStatus -&gt; Handler PoolLifeCycleStatus
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; IO PoolLifeCycleStatus
</span><a href="#local-6989586621682480968"><span class="hs-identifier hs-var">getPoolStatus</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480962"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3208"></span><span>    </span><span id="local-6989586621682480956"><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682480956"><span class="hs-identifier hs-var">pools</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set PoolId) -&gt; Handler (Set PoolId)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Set PoolId)
</span><a href="#local-6989586621682480969"><span class="hs-identifier hs-var">knownPools</span></a></span><span>
</span><span id="line-3209"></span><span>    </span><span id="local-6989586621682480955"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682480955"><span class="hs-identifier hs-var">curEpoch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx -&gt; Handler EpochNo
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k) =&gt;
ctx -&gt; Handler EpochNo
</span><a href="Cardano.Wallet.Api.Server.html#getCurrentEpoch"><span class="hs-identifier hs-var">getCurrentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480970"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3210"></span><span>
</span><span id="line-3211"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682480954"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480954"><span class="hs-identifier hs-var">sel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480953"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480952"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480952"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480951"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480951"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480950"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480950"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (WorkerCtx ctx
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480970"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
 -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (WorkerCtx ctx
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480949"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3212"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480948"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682480948"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3213"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
 -&gt; Handler (DelegationAction, Maybe Coin))
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
-&gt; Handler (DelegationAction, Maybe Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; EpochNo
-&gt; Set PoolId
-&gt; PoolId
-&gt; PoolLifeCycleStatus
-&gt; WalletId
-&gt; ExceptT ErrStakePoolDelegation IO (DelegationAction, Maybe Coin)
</span><a href="Cardano.Wallet.html#joinStakePool"><span class="hs-identifier hs-var">W.joinStakePool</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682480955"><span class="hs-identifier hs-var">curEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Set PoolId
</span><a href="#local-6989586621682480956"><span class="hs-identifier hs-var">pools</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480962"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PoolLifeCycleStatus
</span><a href="#local-6989586621682480957"><span class="hs-identifier hs-var">poolStatus</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3214"></span><span>
</span><span id="line-3215"></span><span>        </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-3216"></span><span>        </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-3217"></span><span>        </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-3218"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480947"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480947"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480946"><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480946"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480970"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3219"></span><span>        </span><span id="local-6989586621682480945"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480945"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlotNo -&gt; Handler SlotNo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlotNo -&gt; Handler SlotNo) -&gt; IO SlotNo -&gt; Handler SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480944"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3220"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480943"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682480943"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-3221"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480947"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-3222"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SlotNo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480945"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3223"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682480948"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-3224"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3225"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480942"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480942"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480941"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480941"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480940"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682480940"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3226"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3227"></span><span>        </span><span class="hs-comment">-- FIXME [ADP-1489] pp and era are not guaranteed to be consistent,</span><span>
</span><span id="line-3228"></span><span>        </span><span class="hs-comment">-- which could cause problems under exceptional circumstances.</span><span>
</span><span id="line-3229"></span><span>        </span><span id="local-6989586621682480939"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480939"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3230"></span><span>        </span><span id="local-6989586621682480938"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480938"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3231"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480937"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams s Selection
</span><a href="#local-6989586621682480937"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-3232"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3233"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682480940"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-3234"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3235"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682480943"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-3236"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480942"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-3237"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480942"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-3238"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682480941"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-3239"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-3240"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3241"></span><span>        </span><span id="local-6989586621682480936"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480936"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3242"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection)
-&gt; ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s Selection
-&gt; (s -&gt; Selection -&gt; Selection)
-&gt; ExceptT ErrSelectAssets IO Selection
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480938"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480939"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s Selection
</span><a href="#local-6989586621682480937"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span>
</span><span id="line-3243"></span><span>            </span><span class="annot"><span class="annottext">((s -&gt; Selection -&gt; Selection)
 -&gt; ExceptT ErrSelectAssets IO Selection)
-&gt; (s -&gt; Selection -&gt; Selection)
-&gt; ExceptT ErrSelectAssets IO Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Selection -&gt; Selection) -&gt; s -&gt; Selection -&gt; Selection
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; Selection
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-3244"></span><span>        </span><span id="local-6989586621682480935"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682480935"><span class="hs-identifier hs-var">sel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3245"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (SelectionOf TxOut)
 -&gt; Handler (SelectionOf TxOut))
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ArgGenChange (SeqState n k)
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(GenChange s, HasDBLayer IO s k ctx, AddressBookIso s) =&gt;
ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesAndUpdateDb"><span class="hs-identifier hs-var">W.assignChangeAddressesAndUpdateDb</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange (SeqState n k)
k 'AddressK XPub -&gt; k 'AddressK XPub -&gt; Address
</span><a href="#local-6989586621682480934"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480936"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-3246"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480933"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480933"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480932"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480932"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480931"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480931"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480930"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480930"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3247"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
 -&gt; Handler (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; RewardAccountBuilder k
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasTransactionLayer k ctx, HasDBLayer IO s k ctx,
 HasNetworkLayer IO ctx, IsOwned s k) =&gt;
ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; ((k 'RootK XPrv, Passphrase &quot;encryption&quot;)
    -&gt; (XPrv, Passphrase &quot;encryption&quot;))
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
</span><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier hs-var">W.buildAndSignTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3248"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480938"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480946"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480964"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682480943"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682480935"><span class="hs-identifier hs-var">sel'</span></a></span><span>
</span><span id="line-3249"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3250"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasDBLayer IO s k ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
</span><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-var">W.submitTx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480971"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480949"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480966"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480933"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480932"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480930"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3251"></span><span>
</span><span id="line-3252"></span><span>        </span><span class="annot"><span class="annottext">(Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480936"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480933"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480932"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480931"><span class="hs-identifier hs-var">txTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480939"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3253"></span><span>
</span><span id="line-3254"></span><span>    </span><span class="annot"><span class="annottext">IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ApiTransaction n) -&gt; Handler (ApiTransaction n))
-&gt; IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
forall (n :: NetworkDiscriminant).
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-var">mkApiTransaction</span></a></span><span>
</span><span id="line-3255"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480970"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3256"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;pendingSince&quot;
  ((Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682480929"><span class="hs-var">#pendingSince</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3257"></span><span>        </span><span class="annot"><span class="annottext">MkApiTransactionParams :: Hash &quot;Tx&quot;
-&gt; Maybe Coin
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [TxOut]
-&gt; Maybe TxOut
-&gt; Map RewardAccount Coin
-&gt; TxMeta
-&gt; Maybe TxMetadata
-&gt; UTCTime
-&gt; Maybe TxScriptValidity
-&gt; Coin
-&gt; TxMetadataSchema
-&gt; MkApiTransactionParams
</span><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-type">MkApiTransactionParams</span></a></span><span>
</span><span id="line-3258"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txId:MkApiTransactionParams :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxId%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682480928"><span class="hs-var">#txId</span></a></span><span>
</span><span id="line-3259"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txFee:MkApiTransactionParams :: Maybe Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxFee%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; Tx -&gt; Const (Maybe Coin) Tx)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; Tx -&gt; Const (Maybe Coin) Tx)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; Tx -&gt; Const (Maybe Coin) Tx
</span><a href="#local-6989586621682480927"><span class="hs-var">#fee</span></a></span><span>
</span><span id="line-3260"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)])
-&gt; NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe TxOut) -&gt; (TxIn, TxOut) -&gt; (TxIn, Maybe TxOut)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Maybe TxOut
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; (TxIn, Maybe TxOut))
-&gt; NonEmpty (TxIn, TxOut) -&gt; NonEmpty (TxIn, Maybe TxOut)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480954"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
-&gt; ((NonEmpty (TxIn, TxOut)
     -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
    -&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection)
-&gt; NonEmpty (TxIn, TxOut)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection)
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection
</span><a href="#local-6989586621682480926"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-3261"></span><span>              </span><span class="hs-comment">-- Joining a stake pool does not require collateral:</span><span>
</span><span id="line-3262"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3263"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txOutputs:MkApiTransactionParams :: [TxOut]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx
</span><a href="#local-6989586621682480925"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-3264"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralOutput:MkApiTransactionParams :: Maybe TxOut
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
    -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
-&gt; Maybe TxOut
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateralOutput&quot;
  ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
   -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
(Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
-&gt; Tx -&gt; Const (Maybe TxOut) Tx
</span><a href="#local-6989586621682480924"><span class="hs-var">#collateralOutput</span></a></span><span>
</span><span id="line-3265"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawals:MkApiTransactionParams :: Map RewardAccount Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx
</span><a href="#local-6989586621682480923"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-3266"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
txMeta :: TxMeta
$sel:txMeta:MkApiTransactionParams :: TxMeta
</span><a href="#local-6989586621682480952"><span class="hs-identifier hs-var hs-var">txMeta</span></a></span><span>
</span><span id="line-3267"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:MkApiTransactionParams :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3268"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
txTime :: UTCTime
$sel:txTime:MkApiTransactionParams :: UTCTime
</span><a href="#local-6989586621682480951"><span class="hs-identifier hs-var hs-var">txTime</span></a></span><span>
</span><span id="line-3269"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txScriptValidity:MkApiTransactionParams :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480953"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxScriptValidity
     -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
    -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
-&gt; Maybe TxScriptValidity
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe TxScriptValidity
    -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
   -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
(Maybe TxScriptValidity
 -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
-&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx
</span><a href="#local-6989586621682480922"><span class="hs-var">#scriptValidity</span></a></span><span>
</span><span id="line-3270"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDeposit:MkApiTransactionParams :: Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txDeposit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480950"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-3271"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadataSchema:MkApiTransactionParams :: TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadataSchema</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataDetailedSchema"><span class="hs-identifier hs-var">TxMetadataDetailedSchema</span></a></span><span>
</span><span id="line-3272"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-3273"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3274"></span><span>    </span><span class="annot"><a href="#local-6989586621682480944"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3275"></span><span>    </span><span id="local-6989586621682480944"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480944"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480970"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3276"></span><span>
</span><span id="line-3277"></span><span>    </span><span id="local-6989586621682480934"><span class="annot"><span class="annottext">genChange :: k 'AddressK XPub -&gt; k 'AddressK XPub -&gt; Address
</span><a href="#local-6989586621682480934"><span class="hs-identifier hs-var hs-var">genChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (network :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
DelegationAddress network key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
forall (key :: Depth -&gt; * -&gt; *).
DelegationAddress n key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#delegationAddress"><span class="hs-identifier hs-var">delegationAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480972"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3278"></span><span>
</span><span id="line-3279"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#delegationFee"><span class="hs-identifier hs-type">delegationFee</span></a></span><span>
</span><span id="line-3280"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480921"><span class="annot"><a href="#local-6989586621682480921"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480920"><span class="annot"><a href="#local-6989586621682480920"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480919"><span class="annot"><a href="#local-6989586621682480919"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682480918"><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3281"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480920"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480919"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3282"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480921"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480920"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3283"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3284"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3285"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480921"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3286"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3287"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiFee"><span class="hs-identifier hs-type">ApiFee</span></a></span><span>
</span><span id="line-3288"></span><span id="delegationFee"><span class="annot"><span class="annottext">delegationFee :: ctx -&gt; ApiT WalletId -&gt; Handler ApiFee
</span><a href="Cardano.Wallet.Api.Server.html#delegationFee"><span class="hs-identifier hs-var hs-var">delegationFee</span></a></span></span><span> </span><span id="local-6989586621682480917"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480917"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480916"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480916"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3289"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ApiFee)
-&gt; (ErrWalletNotResponding -&gt; Handler ApiFee)
-&gt; (WorkerCtx ctx -&gt; Handler ApiFee)
-&gt; Handler ApiFee
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480917"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480916"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ApiFee
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ApiFee
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ApiFee) -&gt; Handler ApiFee)
-&gt; (WorkerCtx ctx -&gt; Handler ApiFee) -&gt; Handler ApiFee
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480915"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480915"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO ApiFee -&gt; Handler ApiFee
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO ApiFee -&gt; Handler ApiFee)
-&gt; ExceptT ErrSelectAssets IO ApiFee -&gt; Handler ApiFee
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3290"></span><span>        </span><span id="local-6989586621682480914"><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="#local-6989586621682480914"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrSelectAssets)
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; ExceptT
     ErrSelectAssets IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrSelectAssets
</span><a href="Cardano.Wallet.html#ErrSelectAssetsNoSuchWallet"><span class="hs-identifier hs-var">ErrSelectAssetsNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; ExceptT
      ErrSelectAssets IO (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; ExceptT
     ErrSelectAssets IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3291"></span><span>            </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480920"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480915"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480916"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3292"></span><span>        </span><span id="local-6989586621682480912"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480912"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters
-&gt; ExceptT ErrSelectAssets IO ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters
 -&gt; ExceptT ErrSelectAssets IO ProtocolParameters)
-&gt; IO ProtocolParameters
-&gt; ExceptT ErrSelectAssets IO ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480915"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3293"></span><span>        </span><span id="local-6989586621682480911"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480911"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; ExceptT ErrSelectAssets IO AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; ExceptT ErrSelectAssets IO AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; ExceptT ErrSelectAssets IO AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480915"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3294"></span><span>        </span><span id="local-6989586621682480910"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480910"><span class="hs-identifier hs-var">deposit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId -&gt; ExceptT ErrSelectAssets IO Coin
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx) =&gt;
ctx -&gt; WalletId -&gt; ExceptT ErrSelectAssets IO Coin
</span><a href="Cardano.Wallet.html#calcMinimumDeposit"><span class="hs-identifier hs-var">W.calcMinimumDeposit</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480920"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480915"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480916"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3295"></span><span>        </span><span class="annot"><span class="annottext">Maybe Coin -&gt; [Coin] -&gt; FeeEstimation -&gt; ApiFee
</span><a href="Cardano.Wallet.Api.Server.html#mkApiFee"><span class="hs-identifier hs-var">mkApiFee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480910"><span class="hs-identifier hs-var">deposit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(FeeEstimation -&gt; ApiFee)
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
-&gt; ExceptT ErrSelectAssets IO ApiFee
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-3296"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Coin
-&gt; ExceptT ErrSelectAssets IO FeeEstimation
forall (m :: * -&gt; *).
Monad m =&gt;
ExceptT ErrSelectAssets m Coin
-&gt; ExceptT ErrSelectAssets m FeeEstimation
</span><a href="Cardano.Wallet.html#estimateFee"><span class="hs-identifier hs-var">W.estimateFee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; Coin
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; ExceptT ErrSelectAssets IO Coin
</span><a href="#local-6989586621682480908"><span class="hs-identifier hs-var">runSelection</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480915"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480911"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480912"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480910"><span class="hs-identifier hs-var">deposit</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="#local-6989586621682480914"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3297"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3298"></span><span>    </span><span class="annot"><a href="#local-6989586621682480907"><span class="hs-identifier hs-type">txCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionCtx"><span class="hs-identifier hs-type">TransactionCtx</span></a></span><span>
</span><span id="line-3299"></span><span>    </span><span id="local-6989586621682480907"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682480907"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-3300"></span><span>
</span><span id="line-3301"></span><span>    </span><span id="local-6989586621682480908"><span class="annot"><span class="annottext">runSelection :: WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; Coin
-&gt; (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; ExceptT ErrSelectAssets IO Coin
</span><a href="#local-6989586621682480908"><span class="hs-identifier hs-var hs-var">runSelection</span></a></span></span><span> </span><span id="local-6989586621682480906"><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
</span><a href="#local-6989586621682480906"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span id="local-6989586621682480905"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480905"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621682480904"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480904"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621682480903"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480903"><span class="hs-identifier hs-var">_deposit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480902"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480902"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480901"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480901"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480900"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682480900"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3302"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s Coin
-&gt; (s -&gt; Selection -&gt; Coin)
-&gt; ExceptT ErrSelectAssets IO Coin
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480920"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480918"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
</span><a href="#local-6989586621682480906"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480905"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480904"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s Coin
</span><a href="#local-6989586621682480899"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Selection -&gt; Coin
forall b. b -&gt; Selection -&gt; Coin
</span><a href="#local-6989586621682480898"><span class="hs-identifier hs-var">calcFee</span></a></span><span>
</span><span id="line-3303"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3304"></span><span>        </span><span id="local-6989586621682480898"><span class="annot"><span class="annottext">calcFee :: p -&gt; Selection -&gt; Coin
</span><a href="#local-6989586621682480898"><span class="hs-identifier hs-var hs-var">calcFee</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; Selection -&gt; Coin
forall change. (change -&gt; Coin) -&gt; SelectionOf change -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.html#selectionDelta"><span class="hs-identifier hs-var">selectionDelta</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span>
</span><span id="line-3305"></span><span>        </span><span id="local-6989586621682480899"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams s Coin
</span><a href="#local-6989586621682480899"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-3306"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3307"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682480900"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-3308"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3309"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682480907"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-3310"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480902"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-3311"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480902"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-3312"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682480901"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-3313"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-3314"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-3315"></span><span>
</span><span id="line-3316"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#quitStakePool"><span class="hs-identifier hs-type">quitStakePool</span></a></span><span>
</span><span id="line-3317"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480897"><span class="annot"><a href="#local-6989586621682480897"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480896"><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480895"><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682480894"><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3318"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480897"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3319"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3320"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span>
</span><span id="line-3321"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DelegationAddress"><span class="hs-identifier hs-type">DelegationAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3322"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GenChange"><span class="hs-identifier hs-type">GenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3323"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480897"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3324"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3325"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3326"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3327"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3328"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3329"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3330"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3331"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3332"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480897"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3333"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3334"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletPassphrase"><span class="hs-identifier hs-type">ApiWalletPassphrase</span></a></span><span>
</span><span id="line-3335"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3336"></span><span id="quitStakePool"><span class="annot"><span class="annottext">quitStakePool :: ctx
-&gt; ApiT WalletId
-&gt; ApiWalletPassphrase
-&gt; Handler (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#quitStakePool"><span class="hs-identifier hs-var hs-var">quitStakePool</span></a></span></span><span> </span><span id="local-6989586621682480893"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480893"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480892"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480891"><span class="annot"><span class="annottext">ApiWalletPassphrase
</span><a href="#local-6989586621682480891"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3337"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480890"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480890"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;)
-&gt; Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;)
-&gt; ApiT (Passphrase &quot;lenient&quot;) -&gt; Passphrase &quot;lenient&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletPassphrase
</span><a href="#local-6989586621682480891"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletPassphrase
-&gt; ((ApiT (Passphrase &quot;lenient&quot;)
     -&gt; Const
          (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
    -&gt; ApiWalletPassphrase
    -&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiWalletPassphrase)
-&gt; ApiT (Passphrase &quot;lenient&quot;)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const
         (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
   -&gt; ApiWalletPassphrase
   -&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiWalletPassphrase)
(ApiT (Passphrase &quot;lenient&quot;)
 -&gt; Const
      (ApiT (Passphrase &quot;lenient&quot;)) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; ApiWalletPassphrase
-&gt; Const (ApiT (Passphrase &quot;lenient&quot;)) ApiWalletPassphrase
</span><a href="#local-6989586621682480889"><span class="hs-var">#passphrase</span></a></span><span>
</span><span id="line-3338"></span><span>
</span><span id="line-3339"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682480888"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480888"><span class="hs-identifier hs-var">sel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480887"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480886"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480886"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480885"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480885"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480884"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480884"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (WorkerCtx ctx
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480893"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
 -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; (WorkerCtx ctx
    -&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters))
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480883"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3340"></span><span>        </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-3341"></span><span>        </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-3342"></span><span>        </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-3343"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480882"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480882"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480881"><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480881"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3344"></span><span>            </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480893"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWithdrawalPostData -&gt; Maybe ApiWithdrawalPostData
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalPostData
</span><a href="Cardano.Wallet.Api.Types.html#SelfWithdrawal"><span class="hs-identifier hs-var">SelfWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3345"></span><span>        </span><span id="local-6989586621682480880"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682480880"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrStakePoolDelegation IO DelegationAction
-&gt; Handler DelegationAction
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrStakePoolDelegation IO DelegationAction
 -&gt; Handler DelegationAction)
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
-&gt; Handler DelegationAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrStakePoolDelegation IO DelegationAction
</span><a href="Cardano.Wallet.html#quitStakePool"><span class="hs-identifier hs-var">W.quitStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480882"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-3346"></span><span>        </span><span id="local-6989586621682480879"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480879"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlotNo -&gt; Handler SlotNo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlotNo -&gt; Handler SlotNo) -&gt; IO SlotNo -&gt; Handler SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480878"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3347"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480877"><span class="annot"><span class="annottext">txCtx :: TransactionCtx
</span><a href="#local-6989586621682480877"><span class="hs-identifier hs-var hs-var">txCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-3348"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxWithdrawal%3ATransactionCtx"><span class="hs-identifier hs-var">txWithdrawal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480882"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-3349"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SlotNo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480879"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3350"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DelegationAction -&gt; Maybe DelegationAction
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682480880"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-3351"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3352"></span><span>
</span><span id="line-3353"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480876"><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480876"><span class="hs-identifier hs-var">utxoAvailable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480875"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480875"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480874"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682480874"><span class="hs-identifier hs-var">pendingTxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3354"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
 -&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx))
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
-&gt; Handler (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrNoSuchWallet IO (UTxOIndex WalletUTxO, Wallet s, Set Tx)
</span><a href="Cardano.Wallet.html#readWalletUTxOIndex"><span class="hs-identifier hs-var">W.readWalletUTxOIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3355"></span><span>        </span><span id="local-6989586621682480873"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480873"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3356"></span><span>        </span><span id="local-6989586621682480872"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480872"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO (SeqState n k) k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO (SeqState n k) k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO (SeqState n k) k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3357"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480871"><span class="annot"><span class="annottext">selectAssetsParams :: SelectAssetsParams s Selection
</span><a href="#local-6989586621682480871"><span class="hs-identifier hs-var hs-var">selectAssetsParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams :: forall s result.
[TxOut]
-&gt; Set Tx
-&gt; Maybe StdGenSeed
-&gt; TransactionCtx
-&gt; Map WalletUTxO TokenBundle
-&gt; UTxOSelection WalletUTxO
-&gt; Wallet s
-&gt; SelectionStrategy
-&gt; SelectAssetsParams s result
</span><a href="Cardano.Wallet.html#SelectAssetsParams"><span class="hs-identifier hs-type">W.SelectAssetsParams</span></a></span><span>
</span><span id="line-3358"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:SelectAssetsParams :: [TxOut]
</span><a href="Cardano.Wallet.html#%24sel%3Aoutputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3359"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
pendingTxs :: Set Tx
$sel:pendingTxs:SelectAssetsParams :: Set Tx
</span><a href="#local-6989586621682480874"><span class="hs-identifier hs-var hs-var">pendingTxs</span></a></span><span>
</span><span id="line-3360"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:randomSeed:SelectAssetsParams :: Maybe StdGenSeed
</span><a href="Cardano.Wallet.html#%24sel%3ArandomSeed%3ASelectAssetsParams"><span class="hs-identifier hs-var">randomSeed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StdGenSeed
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3361"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txContext:SelectAssetsParams :: TransactionCtx
</span><a href="Cardano.Wallet.html#%24sel%3AtxContext%3ASelectAssetsParams"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682480877"><span class="hs-identifier hs-var">txCtx</span></a></span><span>
</span><span id="line-3362"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForInputs:SelectAssetsParams :: UTxOSelection WalletUTxO
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForInputs%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; UTxOSelection WalletUTxO
forall u. UTxOIndex u -&gt; UTxOSelection u
</span><a href="Cardano.Wallet.Primitive.Types.UTxOSelection.html#fromIndex"><span class="hs-identifier hs-var">UTxOSelection.fromIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480876"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-3363"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoAvailableForCollateral:SelectAssetsParams :: Map WalletUTxO TokenBundle
</span><a href="Cardano.Wallet.html#%24sel%3AutxoAvailableForCollateral%3ASelectAssetsParams"><span class="hs-identifier hs-var">utxoAvailableForCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO -&gt; Map WalletUTxO TokenBundle
forall u. UTxOIndex u -&gt; Map u TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxOIndex.Internal.html#toMap"><span class="hs-identifier hs-var">UTxOIndex.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOIndex WalletUTxO
</span><a href="#local-6989586621682480876"><span class="hs-identifier hs-var">utxoAvailable</span></a></span><span>
</span><span id="line-3364"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet s
wallet :: Wallet s
$sel:wallet:SelectAssetsParams :: Wallet s
</span><a href="#local-6989586621682480875"><span class="hs-identifier hs-var hs-var">wallet</span></a></span><span>
</span><span id="line-3365"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:selectionStrategy:SelectAssetsParams :: SelectionStrategy
</span><a href="Cardano.Wallet.html#%24sel%3AselectionStrategy%3ASelectAssetsParams"><span class="hs-identifier hs-var">selectionStrategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectionStrategy
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionStrategyOptimal"><span class="hs-identifier hs-var">SelectionStrategyOptimal</span></a></span><span>
</span><span id="line-3366"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3367"></span><span>        </span><span id="local-6989586621682480870"><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480870"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3368"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection)
-&gt; ExceptT ErrSelectAssets IO Selection -&gt; Handler Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s Selection
-&gt; (s -&gt; Selection -&gt; Selection)
-&gt; ExceptT ErrSelectAssets IO Selection
forall ctx (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *) result.
(BoundedAddressLength k, HasTransactionLayer k ctx,
 HasLogger m WalletWorkerLog ctx, MonadRandom m) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; ProtocolParameters
-&gt; SelectAssetsParams s result
-&gt; (s -&gt; Selection -&gt; result)
-&gt; ExceptT ErrSelectAssets m result
</span><a href="Cardano.Wallet.html#selectAssets"><span class="hs-identifier hs-var">W.selectAssets</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480872"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480873"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">SelectAssetsParams s Selection
</span><a href="#local-6989586621682480871"><span class="hs-identifier hs-var">selectAssetsParams</span></a></span><span>
</span><span id="line-3369"></span><span>            </span><span class="annot"><span class="annottext">((s -&gt; Selection -&gt; Selection)
 -&gt; ExceptT ErrSelectAssets IO Selection)
-&gt; (s -&gt; Selection -&gt; Selection)
-&gt; ExceptT ErrSelectAssets IO Selection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Selection -&gt; Selection) -&gt; s -&gt; Selection -&gt; Selection
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Selection -&gt; Selection
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-3370"></span><span>        </span><span id="local-6989586621682480869"><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682480869"><span class="hs-identifier hs-var">sel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3371"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (SelectionOf TxOut)
 -&gt; Handler (SelectionOf TxOut))
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
-&gt; Handler (SelectionOf TxOut)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ArgGenChange (SeqState n k)
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(GenChange s, HasDBLayer IO s k ctx, AddressBookIso s) =&gt;
ctx
-&gt; WalletId
-&gt; ArgGenChange s
-&gt; Selection
-&gt; ExceptT ErrSignPayment IO (SelectionOf TxOut)
</span><a href="Cardano.Wallet.html#assignChangeAddressesAndUpdateDb"><span class="hs-identifier hs-var">W.assignChangeAddressesAndUpdateDb</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ArgGenChange (SeqState n k)
k 'AddressK XPub -&gt; k 'AddressK XPub -&gt; Address
</span><a href="#local-6989586621682480868"><span class="hs-identifier hs-var">genChange</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480870"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-3372"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480867"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480867"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480866"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480866"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480865"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480865"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480864"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480864"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3373"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
 -&gt; Handler (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; RewardAccountBuilder k
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasTransactionLayer k ctx, HasDBLayer IO s k ctx,
 HasNetworkLayer IO ctx, IsOwned s k) =&gt;
ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; ((k 'RootK XPrv, Passphrase &quot;encryption&quot;)
    -&gt; (XPrv, Passphrase &quot;encryption&quot;))
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
</span><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier hs-var">W.buildAndSignTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3374"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480872"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480881"><span class="hs-identifier hs-var">mkRwdAcct</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480890"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682480877"><span class="hs-identifier hs-var">txCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOf TxOut
</span><a href="#local-6989586621682480869"><span class="hs-identifier hs-var">sel'</span></a></span><span>
</span><span id="line-3375"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3376"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasDBLayer IO s k ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
</span><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-var">W.submitTx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480894"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480883"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480892"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480867"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480866"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480864"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3377"></span><span>
</span><span id="line-3378"></span><span>        </span><span class="annot"><span class="annottext">(Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
-&gt; Handler (Selection, Tx, TxMeta, UTCTime, ProtocolParameters)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480870"><span class="hs-identifier hs-var">sel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480867"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480866"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480865"><span class="hs-identifier hs-var">txTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480873"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3379"></span><span>
</span><span id="line-3380"></span><span>    </span><span class="annot"><span class="annottext">IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ApiTransaction n) -&gt; Handler (ApiTransaction n))
-&gt; IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
forall (n :: NetworkDiscriminant).
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-var">mkApiTransaction</span></a></span><span>
</span><span id="line-3381"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480893"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3382"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;pendingSince&quot;
  ((Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682480863"><span class="hs-var">#pendingSince</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3383"></span><span>        </span><span class="annot"><span class="annottext">MkApiTransactionParams :: Hash &quot;Tx&quot;
-&gt; Maybe Coin
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [TxOut]
-&gt; Maybe TxOut
-&gt; Map RewardAccount Coin
-&gt; TxMeta
-&gt; Maybe TxMetadata
-&gt; UTCTime
-&gt; Maybe TxScriptValidity
-&gt; Coin
-&gt; TxMetadataSchema
-&gt; MkApiTransactionParams
</span><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-type">MkApiTransactionParams</span></a></span><span>
</span><span id="line-3384"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txId:MkApiTransactionParams :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxId%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682480862"><span class="hs-var">#txId</span></a></span><span>
</span><span id="line-3385"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txFee:MkApiTransactionParams :: Maybe Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxFee%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; Tx -&gt; Const (Maybe Coin) Tx)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; Tx -&gt; Const (Maybe Coin) Tx)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; Tx -&gt; Const (Maybe Coin) Tx
</span><a href="#local-6989586621682480861"><span class="hs-var">#fee</span></a></span><span>
</span><span id="line-3386"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)])
-&gt; NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe TxOut) -&gt; (TxIn, TxOut) -&gt; (TxIn, Maybe TxOut)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Maybe TxOut
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; (TxIn, Maybe TxOut))
-&gt; NonEmpty (TxIn, TxOut) -&gt; NonEmpty (TxIn, Maybe TxOut)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="#local-6989586621682480888"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
-&gt; ((NonEmpty (TxIn, TxOut)
     -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
    -&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection)
-&gt; NonEmpty (TxIn, TxOut)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection)
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; Selection -&gt; Const (NonEmpty (TxIn, TxOut)) Selection
</span><a href="#local-6989586621682480860"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-3387"></span><span>              </span><span class="hs-comment">-- Quitting a stake pool does not require collateral:</span><span>
</span><span id="line-3388"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3389"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txOutputs:MkApiTransactionParams :: [TxOut]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx
</span><a href="#local-6989586621682480859"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-3390"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralOutput:MkApiTransactionParams :: Maybe TxOut
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
    -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
-&gt; Maybe TxOut
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateralOutput&quot;
  ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
   -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
(Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
-&gt; Tx -&gt; Const (Maybe TxOut) Tx
</span><a href="#local-6989586621682480858"><span class="hs-var">#collateralOutput</span></a></span><span>
</span><span id="line-3391"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawals:MkApiTransactionParams :: Map RewardAccount Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx
</span><a href="#local-6989586621682480857"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-3392"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
txMeta :: TxMeta
$sel:txMeta:MkApiTransactionParams :: TxMeta
</span><a href="#local-6989586621682480886"><span class="hs-identifier hs-var hs-var">txMeta</span></a></span><span>
</span><span id="line-3393"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:MkApiTransactionParams :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3394"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
txTime :: UTCTime
$sel:txTime:MkApiTransactionParams :: UTCTime
</span><a href="#local-6989586621682480885"><span class="hs-identifier hs-var hs-var">txTime</span></a></span><span>
</span><span id="line-3395"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txScriptValidity:MkApiTransactionParams :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480887"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxScriptValidity
     -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
    -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
-&gt; Maybe TxScriptValidity
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe TxScriptValidity
    -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
   -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
(Maybe TxScriptValidity
 -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
-&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx
</span><a href="#local-6989586621682480856"><span class="hs-var">#scriptValidity</span></a></span><span>
</span><span id="line-3396"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDeposit:MkApiTransactionParams :: Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txDeposit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480884"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-3397"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadataSchema:MkApiTransactionParams :: TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadataSchema</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataDetailedSchema"><span class="hs-identifier hs-var">TxMetadataDetailedSchema</span></a></span><span>
</span><span id="line-3398"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-3399"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3400"></span><span>    </span><span class="annot"><a href="#local-6989586621682480878"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3401"></span><span>    </span><span id="local-6989586621682480878"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480878"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480893"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3402"></span><span>
</span><span id="line-3403"></span><span>    </span><span id="local-6989586621682480868"><span class="annot"><span class="annottext">genChange :: k 'AddressK XPub -&gt; k 'AddressK XPub -&gt; Address
</span><a href="#local-6989586621682480868"><span class="hs-identifier hs-var hs-var">genChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (network :: NetworkDiscriminant) (key :: Depth -&gt; * -&gt; *).
DelegationAddress network key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
forall (key :: Depth -&gt; * -&gt; *).
DelegationAddress n key =&gt;
key 'AddressK XPub -&gt; key 'AddressK XPub -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#delegationAddress"><span class="hs-identifier hs-var">delegationAddress</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480895"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3404"></span><span>
</span><span id="line-3405"></span><span class="hs-comment">-- More testable helper for `listStakeKeys`.</span><span>
</span><span id="line-3406"></span><span class="hs-comment">--</span><span>
</span><span id="line-3407"></span><span class="hs-comment">-- TODO: Ideally test things like</span><span>
</span><span id="line-3408"></span><span class="hs-comment">-- no rewards =&gt; ada in distr == utxo balance</span><span>
</span><span id="line-3409"></span><span class="hs-comment">-- all keys in inputs appear (once) in output</span><span>
</span><span id="line-3410"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listStakeKeys%27"><span class="hs-identifier hs-type">listStakeKeys'</span></a></span><span>
</span><span id="line-3411"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682483334"><span class="annot"><a href="#local-6989586621682483334"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682483335"><span class="annot"><a href="#local-6989586621682483335"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483335"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3412"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO.UTxO</span></a></span><span>
</span><span id="line-3413"></span><span>        </span><span class="hs-comment">-- ^ The wallet's UTxO</span><span>
</span><span id="line-3414"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3415"></span><span>        </span><span class="hs-comment">-- ^ Lookup reward account of addr</span><span>
</span><span id="line-3416"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3417"></span><span>        </span><span class="hs-comment">-- ^ Batch fetch of rewards</span><span>
</span><span id="line-3418"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletDelegation"><span class="hs-identifier hs-type">ApiWalletDelegation</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3419"></span><span>        </span><span class="hs-comment">-- ^ The wallet's known stake keys, along with derivation index, and</span><span>
</span><span id="line-3420"></span><span>        </span><span class="hs-comment">-- delegation status.</span><span>
</span><span id="line-3421"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiStakeKeys"><span class="hs-identifier hs-type">ApiStakeKeys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483334"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3422"></span><span id="listStakeKeys%27"><span class="annot"><span class="annottext">listStakeKeys' :: UTxO
-&gt; (Address -&gt; Maybe RewardAccount)
-&gt; (Set RewardAccount -&gt; m (Map RewardAccount Coin))
-&gt; [(RewardAccount, Natural, ApiWalletDelegation)]
-&gt; m (ApiStakeKeys n)
</span><a href="Cardano.Wallet.Api.Server.html#listStakeKeys%27"><span class="hs-identifier hs-var hs-var">listStakeKeys'</span></a></span></span><span> </span><span id="local-6989586621682480854"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682480854"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621682480853"><span class="annot"><span class="annottext">Address -&gt; Maybe RewardAccount
</span><a href="#local-6989586621682480853"><span class="hs-identifier hs-var">lookupStakeRef</span></a></span></span><span> </span><span id="local-6989586621682480852"><span class="annot"><span class="annottext">Set RewardAccount -&gt; m (Map RewardAccount Coin)
</span><a href="#local-6989586621682480852"><span class="hs-identifier hs-var">fetchRewards</span></a></span></span><span> </span><span id="local-6989586621682480851"><span class="annot"><span class="annottext">[(RewardAccount, Natural, ApiWalletDelegation)]
</span><a href="#local-6989586621682480851"><span class="hs-identifier hs-var">ourKeysWithInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3423"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480850"><span class="annot"><span class="annottext">distr :: Map (Maybe RewardAccount) Coin
</span><a href="#local-6989586621682480850"><span class="hs-identifier hs-var hs-var">distr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Maybe RewardAccount)
-&gt; UTxO -&gt; Map (Maybe RewardAccount) Coin
</span><a href="Cardano.Wallet.Primitive.Delegation.UTxO.html#stakeKeyCoinDistr"><span class="hs-identifier hs-var">stakeKeyCoinDistr</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Maybe RewardAccount
</span><a href="#local-6989586621682480853"><span class="hs-identifier hs-var">lookupStakeRef</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682480854"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-3424"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480849"><span class="annot"><span class="annottext">stakeKeysInUTxO :: [RewardAccount]
</span><a href="#local-6989586621682480849"><span class="hs-identifier hs-var hs-var">stakeKeysInUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe RewardAccount] -&gt; [RewardAccount]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe RewardAccount] -&gt; [RewardAccount])
-&gt; [Maybe RewardAccount] -&gt; [RewardAccount]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Maybe RewardAccount) Coin -&gt; [Maybe RewardAccount]
forall k a. Map k a -&gt; [k]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Maybe RewardAccount) Coin
</span><a href="#local-6989586621682480850"><span class="hs-identifier hs-var">distr</span></a></span><span>
</span><span id="line-3425"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480847"><span class="annot"><span class="annottext">stake :: Maybe RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480847"><span class="hs-identifier hs-var hs-var">stake</span></a></span></span><span> </span><span id="local-6989586621682480846"><span class="annot"><span class="annottext">Maybe RewardAccount
</span><a href="#local-6989586621682480846"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin -&gt; Coin
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Coin -&gt; Coin) -&gt; Maybe Coin -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RewardAccount -&gt; Map (Maybe RewardAccount) Coin -&gt; Maybe Coin
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RewardAccount
</span><a href="#local-6989586621682480846"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Maybe RewardAccount) Coin
</span><a href="#local-6989586621682480850"><span class="hs-identifier hs-var">distr</span></a></span><span>
</span><span id="line-3426"></span><span>
</span><span id="line-3427"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480845"><span class="annot"><span class="annottext">ourKeys :: [RewardAccount]
</span><a href="#local-6989586621682480845"><span class="hs-identifier hs-var hs-var">ourKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((RewardAccount, Natural, ApiWalletDelegation) -&gt; RewardAccount)
-&gt; [(RewardAccount, Natural, ApiWalletDelegation)]
-&gt; [RewardAccount]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682480844"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480844"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ApiWalletDelegation
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480844"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(RewardAccount, Natural, ApiWalletDelegation)]
</span><a href="#local-6989586621682480851"><span class="hs-identifier hs-var">ourKeysWithInfo</span></a></span><span>
</span><span id="line-3428"></span><span>
</span><span id="line-3429"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480843"><span class="annot"><span class="annottext">allKeys :: [RewardAccount]
</span><a href="#local-6989586621682480843"><span class="hs-identifier hs-var hs-var">allKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RewardAccount]
</span><a href="#local-6989586621682480845"><span class="hs-identifier hs-var">ourKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount] -&gt; [RewardAccount] -&gt; [RewardAccount]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount]
</span><a href="#local-6989586621682480849"><span class="hs-identifier hs-var">stakeKeysInUTxO</span></a></span><span>
</span><span id="line-3430"></span><span>
</span><span id="line-3431"></span><span>        </span><span class="hs-comment">-- If we wanted to know whether a stake key is registered or not, we</span><span>
</span><span id="line-3432"></span><span>        </span><span class="hs-comment">-- could expose the difference between `Nothing` and `Just 0` in the</span><span>
</span><span id="line-3433"></span><span>        </span><span class="hs-comment">-- `NetworkLayer` interface.</span><span>
</span><span id="line-3434"></span><span>        </span><span id="local-6989586621682480842"><span class="annot"><span class="annottext">Map RewardAccount Coin
</span><a href="#local-6989586621682480842"><span class="hs-identifier hs-var">rewardsMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set RewardAccount -&gt; m (Map RewardAccount Coin)
</span><a href="#local-6989586621682480852"><span class="hs-identifier hs-var">fetchRewards</span></a></span><span> </span><span class="annot"><span class="annottext">(Set RewardAccount -&gt; m (Map RewardAccount Coin))
-&gt; Set RewardAccount -&gt; m (Map RewardAccount Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount] -&gt; Set RewardAccount
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount]
</span><a href="#local-6989586621682480843"><span class="hs-identifier hs-var">allKeys</span></a></span><span>
</span><span id="line-3435"></span><span>
</span><span id="line-3436"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480840"><span class="annot"><span class="annottext">rewards :: RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480840"><span class="hs-identifier hs-var hs-var">rewards</span></a></span></span><span> </span><span id="local-6989586621682480839"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480839"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin -&gt; Coin
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Coin -&gt; Coin) -&gt; Maybe Coin -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3437"></span><span>                </span><span class="annot"><span class="annottext">RewardAccount -&gt; Map RewardAccount Coin -&gt; Maybe Coin
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480839"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin
</span><a href="#local-6989586621682480842"><span class="hs-identifier hs-var">rewardsMap</span></a></span><span>
</span><span id="line-3438"></span><span>
</span><span id="line-3439"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480838"><span class="annot"><span class="annottext">mkOurs :: (RewardAccount, Natural, ApiWalletDelegation) -&gt; ApiOurStakeKey n
</span><a href="#local-6989586621682480838"><span class="hs-identifier hs-var hs-var">mkOurs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480837"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480837"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480836"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480836"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480835"><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682480835"><span class="hs-identifier hs-var">deleg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiOurStakeKey :: forall (n :: NetworkDiscriminant).
Natural
-&gt; (ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiWalletDelegation
-&gt; ApiOurStakeKey n
</span><a href="Cardano.Wallet.Api.Types.html#ApiOurStakeKey"><span class="hs-identifier hs-type">ApiOurStakeKey</span></a></span><span>
</span><span id="line-3440"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_index:ApiOurStakeKey :: Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_index%3AApiOurStakeKey"><span class="hs-identifier hs-var">_index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480836"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3441"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_key:ApiOurStakeKey :: (ApiT RewardAccount, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_key%3AApiOurStakeKey"><span class="hs-identifier hs-var">_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480837"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3442"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_rewardBalance:ApiOurStakeKey :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_rewardBalance%3AApiOurStakeKey"><span class="hs-identifier hs-var">_rewardBalance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3443"></span><span>                    </span><span class="annot"><span class="annottext">RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480840"><span class="hs-identifier hs-var">rewards</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480837"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-3444"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_delegation:ApiOurStakeKey :: ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_delegation%3AApiOurStakeKey"><span class="hs-identifier hs-var">_delegation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682480835"><span class="hs-identifier hs-var">deleg</span></a></span><span>
</span><span id="line-3445"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_stake:ApiOurStakeKey :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_stake%3AApiOurStakeKey"><span class="hs-identifier hs-var">_stake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3446"></span><span>                    </span><span class="annot"><span class="annottext">Maybe RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480847"><span class="hs-identifier hs-var">stake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; Maybe RewardAccount
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480837"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480840"><span class="hs-identifier hs-var">rewards</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480837"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-3447"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3448"></span><span>
</span><span id="line-3449"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480828"><span class="annot"><span class="annottext">mkForeign :: RewardAccount -&gt; ApiForeignStakeKey n
</span><a href="#local-6989586621682480828"><span class="hs-identifier hs-var hs-var">mkForeign</span></a></span></span><span> </span><span id="local-6989586621682480827"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480827"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiForeignStakeKey :: forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiForeignStakeKey n
</span><a href="Cardano.Wallet.Api.Types.html#ApiForeignStakeKey"><span class="hs-identifier hs-type">ApiForeignStakeKey</span></a></span><span>
</span><span id="line-3450"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_key:ApiForeignStakeKey :: (ApiT RewardAccount, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_key%3AApiForeignStakeKey"><span class="hs-identifier hs-var">_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480827"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3451"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_rewardBalance:ApiForeignStakeKey :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_rewardBalance%3AApiForeignStakeKey"><span class="hs-identifier hs-var">_rewardBalance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3452"></span><span>                    </span><span class="annot"><span class="annottext">RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480840"><span class="hs-identifier hs-var">rewards</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480827"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-3453"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_stake:ApiForeignStakeKey :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_stake%3AApiForeignStakeKey"><span class="hs-identifier hs-var">_stake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3454"></span><span>                    </span><span class="annot"><span class="annottext">Maybe RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480847"><span class="hs-identifier hs-var">stake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; Maybe RewardAccount
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480827"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480840"><span class="hs-identifier hs-var">rewards</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480827"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-3455"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3456"></span><span>
</span><span id="line-3457"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480822"><span class="annot"><span class="annottext">foreignKeys :: [RewardAccount]
</span><a href="#local-6989586621682480822"><span class="hs-identifier hs-var hs-var">foreignKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RewardAccount]
</span><a href="#local-6989586621682480849"><span class="hs-identifier hs-var">stakeKeysInUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount] -&gt; [RewardAccount] -&gt; [RewardAccount]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount]
</span><a href="#local-6989586621682480845"><span class="hs-identifier hs-var">ourKeys</span></a></span><span>
</span><span id="line-3458"></span><span>
</span><span id="line-3459"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480821"><span class="annot"><span class="annottext">nullKey :: ApiNullStakeKey
</span><a href="#local-6989586621682480821"><span class="hs-identifier hs-var hs-var">nullKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiNullStakeKey :: Quantity &quot;lovelace&quot; Natural -&gt; ApiNullStakeKey
</span><a href="Cardano.Wallet.Api.Types.html#ApiNullStakeKey"><span class="hs-identifier hs-type">ApiNullStakeKey</span></a></span><span>
</span><span id="line-3460"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_stake:ApiNullStakeKey :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_stake%3AApiNullStakeKey"><span class="hs-identifier hs-var">_stake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RewardAccount -&gt; Coin
</span><a href="#local-6989586621682480847"><span class="hs-identifier hs-var">stake</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RewardAccount
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3461"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-3462"></span><span>
</span><span id="line-3463"></span><span>        </span><span class="annot"><span class="annottext">ApiStakeKeys n -&gt; m (ApiStakeKeys n)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiStakeKeys n -&gt; m (ApiStakeKeys n))
-&gt; ApiStakeKeys n -&gt; m (ApiStakeKeys n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiStakeKeys :: forall (n :: NetworkDiscriminant).
[ApiOurStakeKey n]
-&gt; [ApiForeignStakeKey n] -&gt; ApiNullStakeKey -&gt; ApiStakeKeys n
</span><a href="Cardano.Wallet.Api.Types.html#ApiStakeKeys"><span class="hs-identifier hs-type">ApiStakeKeys</span></a></span><span>
</span><span id="line-3464"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_ours:ApiStakeKeys :: [ApiOurStakeKey n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_ours%3AApiStakeKeys"><span class="hs-identifier hs-var">_ours</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((RewardAccount, Natural, ApiWalletDelegation) -&gt; ApiOurStakeKey n)
-&gt; [(RewardAccount, Natural, ApiWalletDelegation)]
-&gt; [ApiOurStakeKey n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount, Natural, ApiWalletDelegation) -&gt; ApiOurStakeKey n
</span><a href="#local-6989586621682480838"><span class="hs-identifier hs-var">mkOurs</span></a></span><span> </span><span class="annot"><span class="annottext">[(RewardAccount, Natural, ApiWalletDelegation)]
</span><a href="#local-6989586621682480851"><span class="hs-identifier hs-var">ourKeysWithInfo</span></a></span><span>
</span><span id="line-3465"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_foreign:ApiStakeKeys :: [ApiForeignStakeKey n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_foreign%3AApiStakeKeys"><span class="hs-identifier hs-var">_foreign</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; ApiForeignStakeKey n)
-&gt; [RewardAccount] -&gt; [ApiForeignStakeKey n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiForeignStakeKey n
</span><a href="#local-6989586621682480828"><span class="hs-identifier hs-var">mkForeign</span></a></span><span> </span><span class="annot"><span class="annottext">[RewardAccount]
</span><a href="#local-6989586621682480822"><span class="hs-identifier hs-var">foreignKeys</span></a></span><span>
</span><span id="line-3466"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_none:ApiStakeKeys :: ApiNullStakeKey
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3A_none%3AApiStakeKeys"><span class="hs-identifier hs-var">_none</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiNullStakeKey
</span><a href="#local-6989586621682480821"><span class="hs-identifier hs-var">nullKey</span></a></span><span>
</span><span id="line-3467"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-3468"></span><span>
</span><span id="line-3469"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#listStakeKeys"><span class="hs-identifier hs-type">listStakeKeys</span></a></span><span>
</span><span id="line-3470"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480814"><span class="annot"><a href="#local-6989586621682480814"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480813"><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480812"><span class="annot"><a href="#local-6989586621682480812"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682480811"><span class="annot"><a href="#local-6989586621682480811"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3471"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480814"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480811"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3472"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480812"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480811"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3473"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480814"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3474"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480812"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3475"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3476"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3477"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3478"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480814"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3479"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3480"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiStakeKeys"><span class="hs-identifier hs-type">ApiStakeKeys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480812"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3481"></span><span id="listStakeKeys"><span class="annot"><span class="annottext">listStakeKeys :: (Address -&gt; Maybe RewardAccount)
-&gt; ctx -&gt; ApiT WalletId -&gt; Handler (ApiStakeKeys n)
</span><a href="Cardano.Wallet.Api.Server.html#listStakeKeys"><span class="hs-identifier hs-var hs-var">listStakeKeys</span></a></span></span><span> </span><span id="local-6989586621682480810"><span class="annot"><span class="annottext">Address -&gt; Maybe RewardAccount
</span><a href="#local-6989586621682480810"><span class="hs-identifier hs-var">lookupStakeRef</span></a></span></span><span> </span><span id="local-6989586621682480809"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480809"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480808"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480808"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3482"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiStakeKeys n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiStakeKeys n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiStakeKeys n))
-&gt; Handler (ApiStakeKeys n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480809"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480808"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiStakeKeys n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiStakeKeys n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiStakeKeys n))
 -&gt; Handler (ApiStakeKeys n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiStakeKeys n))
-&gt; Handler (ApiStakeKeys n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480807"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480807"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO (ApiStakeKeys n)
-&gt; Handler (ApiStakeKeys n)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (ApiStakeKeys n)
 -&gt; Handler (ApiStakeKeys n))
-&gt; ExceptT ErrNoSuchWallet IO (ApiStakeKeys n)
-&gt; Handler (ApiStakeKeys n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3483"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682480806"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480806"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480805"><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682480805"><span class="hs-identifier hs-var">meta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480804"><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682480804"><span class="hs-identifier hs-var">pending</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">W.readWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480811"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480807"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480808"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3484"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480803"><span class="annot"><span class="annottext">utxo :: UTxO
</span><a href="#local-6989586621682480803"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Tx -&gt; Wallet s -&gt; UTxO
forall s. Set Tx -&gt; Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#availableUTxO"><span class="hs-identifier hs-var">availableUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><a href="#local-6989586621682480804"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480806"><span class="hs-identifier hs-var">wal</span></a></span><span>
</span><span id="line-3485"></span><span>
</span><span id="line-3486"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480802"><span class="annot"><span class="annottext">takeFst :: (a, b, c) -&gt; a
</span><a href="#local-6989586621682480802"><span class="hs-identifier hs-var hs-var">takeFst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480801"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682480801"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682480801"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-3487"></span><span>            </span><span id="local-6989586621682480800"><span class="annot"><span class="annottext">Maybe RewardAccount
</span><a href="#local-6989586621682480800"><span class="hs-identifier hs-var">mourAccount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Either
   ErrReadRewardAccount
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Maybe RewardAccount)
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     (Either
        ErrReadRewardAccount
        (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT ErrNoSuchWallet IO (Maybe RewardAccount)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RewardAccount, XPub, NonEmpty DerivationIndex) -&gt; RewardAccount)
-&gt; Maybe (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Maybe RewardAccount
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount, XPub, NonEmpty DerivationIndex) -&gt; RewardAccount
forall a b c. (a, b, c) -&gt; a
</span><a href="#local-6989586621682480802"><span class="hs-identifier hs-var">takeFst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Maybe RewardAccount)
-&gt; (Either
      ErrReadRewardAccount
      (RewardAccount, XPub, NonEmpty DerivationIndex)
    -&gt; Maybe (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; Either
     ErrReadRewardAccount
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Maybe RewardAccount
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  ErrReadRewardAccount
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Maybe (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. Either a b -&gt; Maybe b
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3488"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT
   ErrNoSuchWallet
   IO
   (Either
      ErrReadRewardAccount
      (RewardAccount, XPub, NonEmpty DerivationIndex))
 -&gt; ExceptT ErrNoSuchWallet IO (Maybe RewardAccount))
-&gt; (ExceptT
      ErrReadRewardAccount
      IO
      (RewardAccount, XPub, NonEmpty DerivationIndex)
    -&gt; ExceptT
         ErrNoSuchWallet
         IO
         (Either
            ErrReadRewardAccount
            (RewardAccount, XPub, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT ErrNoSuchWallet IO (Maybe RewardAccount)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO
  (Either
     ErrReadRewardAccount
     (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     (Either
        ErrReadRewardAccount
        (RewardAccount, XPub, NonEmpty DerivationIndex))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either
      ErrReadRewardAccount
      (RewardAccount, XPub, NonEmpty DerivationIndex))
 -&gt; ExceptT
      ErrNoSuchWallet
      IO
      (Either
         ErrReadRewardAccount
         (RewardAccount, XPub, NonEmpty DerivationIndex)))
-&gt; (ExceptT
      ErrReadRewardAccount
      IO
      (RewardAccount, XPub, NonEmpty DerivationIndex)
    -&gt; IO
         (Either
            ErrReadRewardAccount
            (RewardAccount, XPub, NonEmpty DerivationIndex)))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT
     ErrNoSuchWallet
     IO
     (Either
        ErrReadRewardAccount
        (RewardAccount, XPub, NonEmpty DerivationIndex))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount
  IO
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; IO
     (Either
        ErrReadRewardAccount
        (RewardAccount, XPub, NonEmpty DerivationIndex))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; ExceptT ErrNoSuchWallet IO (Maybe RewardAccount))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; ExceptT ErrNoSuchWallet IO (Maybe RewardAccount)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">W.readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480813"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480811"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480812"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480807"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480808"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3489"></span><span>            </span><span id="local-6989586621682480799"><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682480799"><span class="hs-identifier hs-var">ourApiDelegation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ApiWalletDelegation
-&gt; ExceptT ErrNoSuchWallet IO ApiWalletDelegation
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiWalletDelegation
 -&gt; ExceptT ErrNoSuchWallet IO ApiWalletDelegation)
-&gt; IO ApiWalletDelegation
-&gt; ExceptT ErrNoSuchWallet IO ApiWalletDelegation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletDelegation -&gt; TimeInterpreter IO -&gt; IO ApiWalletDelegation
</span><a href="Cardano.Wallet.Api.Server.html#toApiWalletDelegation"><span class="hs-identifier hs-var">toApiWalletDelegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletMetadata
</span><a href="#local-6989586621682480805"><span class="hs-identifier hs-var">meta</span></a></span><span> </span><span class="annot"><span class="annottext">WalletMetadata
-&gt; ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
    -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
-&gt; WalletDelegation
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
   -&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata)
(WalletDelegation -&gt; Const WalletDelegation WalletDelegation)
-&gt; WalletMetadata -&gt; Const WalletDelegation WalletMetadata
</span><a href="#local-6989586621682480798"><span class="hs-var">#delegation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3490"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var">unsafeExtendSafeZone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; TimeInterpreter (ExceptT PastHorizonException IO))
-&gt; NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480809"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3491"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480797"><span class="annot"><span class="annottext">ourKeys :: [(RewardAccount, Natural, ApiWalletDelegation)]
</span><a href="#local-6989586621682480797"><span class="hs-identifier hs-var hs-var">ourKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe RewardAccount
</span><a href="#local-6989586621682480800"><span class="hs-identifier hs-var">mourAccount</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3492"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682480796"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480796"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480796"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiWalletDelegation
</span><a href="#local-6989586621682480799"><span class="hs-identifier hs-var">ourApiDelegation</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3493"></span><span>                    </span><span class="annot"><span class="annottext">Maybe RewardAccount
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3494"></span><span>
</span><span id="line-3495"></span><span>            </span><span class="annot"><span class="annottext">IO (ApiStakeKeys n) -&gt; ExceptT ErrNoSuchWallet IO (ApiStakeKeys n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ApiStakeKeys n)
 -&gt; ExceptT ErrNoSuchWallet IO (ApiStakeKeys n))
-&gt; IO (ApiStakeKeys n)
-&gt; ExceptT ErrNoSuchWallet IO (ApiStakeKeys n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
-&gt; (Address -&gt; Maybe RewardAccount)
-&gt; (Set RewardAccount -&gt; IO (Map RewardAccount Coin))
-&gt; [(RewardAccount, Natural, ApiWalletDelegation)]
-&gt; IO (ApiStakeKeys n)
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
Monad m =&gt;
UTxO
-&gt; (Address -&gt; Maybe RewardAccount)
-&gt; (Set RewardAccount -&gt; m (Map RewardAccount Coin))
-&gt; [(RewardAccount, Natural, ApiWalletDelegation)]
-&gt; m (ApiStakeKeys n)
</span><a href="Cardano.Wallet.Api.Server.html#listStakeKeys%27"><span class="hs-identifier hs-var">listStakeKeys'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480812"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3496"></span><span>                </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682480803"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-3497"></span><span>                </span><span class="annot"><span class="annottext">Address -&gt; Maybe RewardAccount
</span><a href="#local-6989586621682480810"><span class="hs-identifier hs-var">lookupStakeRef</span></a></span><span>
</span><span id="line-3498"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; Set RewardAccount -&gt; IO (Map RewardAccount Coin)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; Set RewardAccount -&gt; m (Map RewardAccount Coin)
</span><a href="Cardano.Wallet.Network.html#fetchRewardAccountBalances"><span class="hs-identifier hs-var hs-var">fetchRewardAccountBalances</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480795"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3499"></span><span>                </span><span class="annot"><span class="annottext">[(RewardAccount, Natural, ApiWalletDelegation)]
</span><a href="#local-6989586621682480797"><span class="hs-identifier hs-var">ourKeys</span></a></span><span>
</span><span id="line-3500"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3501"></span><span>    </span><span id="local-6989586621682480795"><span class="annot"><span class="annottext">nl :: NetworkLayer IO Block
</span><a href="#local-6989586621682480795"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480809"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span>
</span><span id="line-3502"></span><span>
</span><span id="line-3503"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                Migrations
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3506"></span><span>
</span><span id="line-3507"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#createMigrationPlan"><span class="hs-identifier hs-type">createMigrationPlan</span></a></span><span>
</span><span id="line-3508"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480794"><span class="annot"><a href="#local-6989586621682480794"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480793"><span class="annot"><a href="#local-6989586621682480793"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682480792"><span class="annot"><a href="#local-6989586621682480792"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480791"><span class="annot"><a href="#local-6989586621682480791"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3509"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480794"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480792"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480791"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3510"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480791"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3511"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480791"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3512"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480792"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480791"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3513"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480793"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3514"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480792"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3515"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480791"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3516"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3517"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480794"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3518"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalPostData"><span class="hs-identifier hs-type">ApiWithdrawalPostData</span></a></span><span>
</span><span id="line-3519"></span><span>        </span><span class="hs-comment">-- ^ What type of reward withdrawal to attempt</span><span>
</span><span id="line-3520"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3521"></span><span>        </span><span class="hs-comment">-- ^ Source wallet</span><span>
</span><span id="line-3522"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlanPostData"><span class="hs-identifier hs-type">ApiWalletMigrationPlanPostData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480793"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3523"></span><span>        </span><span class="hs-comment">-- ^ Target addresses</span><span>
</span><span id="line-3524"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlan"><span class="hs-identifier hs-type">ApiWalletMigrationPlan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480793"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3525"></span><span id="createMigrationPlan"><span class="annot"><span class="annottext">createMigrationPlan :: ctx
-&gt; Maybe ApiWithdrawalPostData
-&gt; ApiT WalletId
-&gt; ApiWalletMigrationPlanPostData n
-&gt; Handler (ApiWalletMigrationPlan n)
</span><a href="Cardano.Wallet.Api.Server.html#createMigrationPlan"><span class="hs-identifier hs-var hs-var">createMigrationPlan</span></a></span></span><span> </span><span id="local-6989586621682480790"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480790"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480789"><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="#local-6989586621682480789"><span class="hs-identifier hs-var">withdrawalType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480788"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480788"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480787"><span class="annot"><span class="annottext">ApiWalletMigrationPlanPostData n
</span><a href="#local-6989586621682480787"><span class="hs-identifier hs-var">postData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3526"></span><span>    </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-3527"></span><span>    </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-3528"></span><span>    </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-3529"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682480786"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480786"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3530"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480792"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480793"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480790"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480788"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="#local-6989586621682480789"><span class="hs-identifier hs-var">withdrawalType</span></a></span><span>
</span><span id="line-3531"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (ApiWalletMigrationPlan n))
-&gt; (ErrWalletNotResponding -&gt; Handler (ApiWalletMigrationPlan n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiWalletMigrationPlan n))
-&gt; Handler (ApiWalletMigrationPlan n)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480790"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480788"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (ApiWalletMigrationPlan n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (ApiWalletMigrationPlan n)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (ApiWalletMigrationPlan n))
 -&gt; Handler (ApiWalletMigrationPlan n))
-&gt; (WorkerCtx ctx -&gt; Handler (ApiWalletMigrationPlan n))
-&gt; Handler (ApiWalletMigrationPlan n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480785"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480785"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateMigrationPlan IO (ApiWalletMigrationPlan n)
-&gt; Handler (ApiWalletMigrationPlan n)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateMigrationPlan IO (ApiWalletMigrationPlan n)
 -&gt; Handler (ApiWalletMigrationPlan n))
-&gt; ExceptT ErrCreateMigrationPlan IO (ApiWalletMigrationPlan n)
-&gt; Handler (ApiWalletMigrationPlan n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3532"></span><span>        </span><span id="local-6989586621682480784"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480784"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; ExceptT ErrCreateMigrationPlan IO AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra
 -&gt; ExceptT ErrCreateMigrationPlan IO AnyCardanoEra)
-&gt; IO AnyCardanoEra
-&gt; ExceptT ErrCreateMigrationPlan IO AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480785"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3533"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480783"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480783"><span class="hs-identifier hs-var">wallet</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletMetadata
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Tx
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; ErrCreateMigrationPlan)
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT
     ErrCreateMigrationPlan IO (Wallet s, WalletMetadata, Set Tx)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrCreateMigrationPlan
</span><a href="Cardano.Wallet.html#ErrCreateMigrationPlanNoSuchWallet"><span class="hs-identifier hs-var">ErrCreateMigrationPlanNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
 -&gt; ExceptT
      ErrCreateMigrationPlan IO (Wallet s, WalletMetadata, Set Tx))
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
-&gt; ExceptT
     ErrCreateMigrationPlan IO (Wallet s, WalletMetadata, Set Tx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3534"></span><span>            </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrNoSuchWallet IO (Wallet s, WalletMetadata, Set Tx)
</span><a href="Cardano.Wallet.html#readWallet"><span class="hs-identifier hs-var">W.readWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480785"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480788"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3535"></span><span>        </span><span id="local-6989586621682480781"><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480781"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; AnyCardanoEra
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
forall ctx (k :: Depth -&gt; * -&gt; *) s.
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx,
 HasTransactionLayer k ctx) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
</span><a href="Cardano.Wallet.html#createMigrationPlan"><span class="hs-identifier hs-var">W.createMigrationPlan</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480785"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480784"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480788"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480786"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span>
</span><span id="line-3536"></span><span>        </span><span class="annot"><span class="annottext">ErrCreateMigrationPlan
-&gt; Maybe (ApiWalletMigrationPlan n)
-&gt; ExceptT ErrCreateMigrationPlan IO (ApiWalletMigrationPlan n)
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
e -&gt; Maybe a -&gt; ExceptT e m a
</span><a href="../../../../errors/html/src"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCreateMigrationPlan
</span><a href="Cardano.Wallet.html#ErrCreateMigrationPlanEmpty"><span class="hs-identifier hs-var">ErrCreateMigrationPlanEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ApiWalletMigrationPlan n)
 -&gt; ExceptT ErrCreateMigrationPlan IO (ApiWalletMigrationPlan n))
-&gt; Maybe (ApiWalletMigrationPlan n)
-&gt; ExceptT ErrCreateMigrationPlan IO (ApiWalletMigrationPlan n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; NonEmpty (ApiT Address, Proxy n)
-&gt; Withdrawal
-&gt; MigrationPlan
-&gt; Maybe (ApiWalletMigrationPlan n)
forall (n :: NetworkDiscriminant) s.
IsOurs s Address =&gt;
s
-&gt; NonEmpty (ApiT Address, Proxy n)
-&gt; Withdrawal
-&gt; MigrationPlan
-&gt; Maybe (ApiWalletMigrationPlan n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiWalletMigrationPlan"><span class="hs-identifier hs-var">mkApiWalletMigrationPlan</span></a></span><span>
</span><span id="line-3537"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; s
forall s. Wallet s -&gt; s
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AgetState%3AWallet"><span class="hs-identifier hs-var hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682480783"><span class="hs-identifier hs-var">wallet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3538"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((NonEmpty (ApiT Address, Proxy n)
  -&gt; Const
       (NonEmpty (ApiT Address, Proxy n))
       (NonEmpty (ApiT Address, Proxy n)))
 -&gt; ApiWalletMigrationPlanPostData n
 -&gt; Const
      (NonEmpty (ApiT Address, Proxy n))
      (ApiWalletMigrationPlanPostData n))
-&gt; ApiWalletMigrationPlanPostData n
-&gt; NonEmpty (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;addresses&quot;
  ((NonEmpty (ApiT Address, Proxy n)
    -&gt; Const
         (NonEmpty (ApiT Address, Proxy n))
         (NonEmpty (ApiT Address, Proxy n)))
   -&gt; ApiWalletMigrationPlanPostData n
   -&gt; Const
        (NonEmpty (ApiT Address, Proxy n))
        (ApiWalletMigrationPlanPostData n))
(NonEmpty (ApiT Address, Proxy n)
 -&gt; Const
      (NonEmpty (ApiT Address, Proxy n))
      (NonEmpty (ApiT Address, Proxy n)))
-&gt; ApiWalletMigrationPlanPostData n
-&gt; Const
     (NonEmpty (ApiT Address, Proxy n))
     (ApiWalletMigrationPlanPostData n)
</span><a href="#local-6989586621682480777"><span class="hs-var">#addresses</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationPlanPostData n
</span><a href="#local-6989586621682480787"><span class="hs-identifier hs-var">postData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3539"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480786"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3540"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480781"><span class="hs-identifier hs-var">plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3541"></span><span>
</span><span id="line-3542"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiWalletMigrationPlan"><span class="hs-identifier hs-type">mkApiWalletMigrationPlan</span></a></span><span>
</span><span id="line-3543"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483318"><span class="annot"><a href="#local-6989586621682483318"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682483319"><span class="annot"><a href="#local-6989586621682483319"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483319"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-3544"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483319"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3545"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483318"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3546"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span>
</span><span id="line-3547"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Migration.html#MigrationPlan"><span class="hs-identifier hs-type">MigrationPlan</span></a></span><span>
</span><span id="line-3548"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlan"><span class="hs-identifier hs-type">ApiWalletMigrationPlan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483318"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3549"></span><span id="mkApiWalletMigrationPlan"><span class="annot"><span class="annottext">mkApiWalletMigrationPlan :: s
-&gt; NonEmpty (ApiT Address, Proxy n)
-&gt; Withdrawal
-&gt; MigrationPlan
-&gt; Maybe (ApiWalletMigrationPlan n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiWalletMigrationPlan"><span class="hs-identifier hs-var hs-var">mkApiWalletMigrationPlan</span></a></span></span><span> </span><span id="local-6989586621682480776"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480776"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682480775"><span class="annot"><span class="annottext">NonEmpty (ApiT Address, Proxy n)
</span><a href="#local-6989586621682480775"><span class="hs-identifier hs-var">addresses</span></a></span></span><span> </span><span id="local-6989586621682480774"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480774"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span></span><span> </span><span id="local-6989586621682480773"><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480773"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3550"></span><span>    </span><span class="annot"><span class="annottext">NonEmpty (ApiCoinSelection n) -&gt; ApiWalletMigrationPlan n
</span><a href="#local-6989586621682480772"><span class="hs-identifier hs-var">mkApiPlan</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiCoinSelection n) -&gt; ApiWalletMigrationPlan n)
-&gt; Maybe (NonEmpty (ApiCoinSelection n))
-&gt; Maybe (ApiWalletMigrationPlan n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ApiCoinSelection n))
</span><a href="#local-6989586621682480771"><span class="hs-identifier hs-var">maybeSelections</span></a></span><span>
</span><span id="line-3551"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3552"></span><span>    </span><span class="annot"><a href="#local-6989586621682480772"><span class="hs-identifier hs-type">mkApiPlan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483318"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlan"><span class="hs-identifier hs-type">ApiWalletMigrationPlan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483318"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3553"></span><span>    </span><span id="local-6989586621682480772"><span class="annot"><span class="annottext">mkApiPlan :: NonEmpty (ApiCoinSelection n) -&gt; ApiWalletMigrationPlan n
</span><a href="#local-6989586621682480772"><span class="hs-identifier hs-var hs-var">mkApiPlan</span></a></span></span><span> </span><span id="local-6989586621682480770"><span class="annot"><span class="annottext">NonEmpty (ApiCoinSelection n)
</span><a href="#local-6989586621682480770"><span class="hs-identifier hs-var">selections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationPlan :: forall (n :: NetworkDiscriminant).
NonEmpty (ApiCoinSelection n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiWalletMigrationBalance
-&gt; ApiWalletMigrationBalance
-&gt; ApiWalletMigrationPlan n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPlan"><span class="hs-identifier hs-type">ApiWalletMigrationPlan</span></a></span><span>
</span><span id="line-3554"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiCoinSelection n)
$sel:selections:ApiWalletMigrationPlan :: NonEmpty (ApiCoinSelection n)
selections :: NonEmpty (ApiCoinSelection n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aselections%3AApiWalletMigrationPlan"><span class="hs-identifier hs-var hs-var">selections</span></a></span><span>
</span><span id="line-3555"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
$sel:totalFee:ApiWalletMigrationPlan :: Quantity &quot;lovelace&quot; Natural
totalFee :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AtotalFee%3AApiWalletMigrationPlan"><span class="hs-identifier hs-var hs-var">totalFee</span></a></span><span>
</span><span id="line-3556"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationBalance
$sel:balanceLeftover:ApiWalletMigrationPlan :: ApiWalletMigrationBalance
balanceLeftover :: ApiWalletMigrationBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AbalanceLeftover%3AApiWalletMigrationPlan"><span class="hs-identifier hs-var hs-var">balanceLeftover</span></a></span><span>
</span><span id="line-3557"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationBalance
$sel:balanceSelected:ApiWalletMigrationPlan :: ApiWalletMigrationBalance
balanceSelected :: ApiWalletMigrationBalance
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AbalanceSelected%3AApiWalletMigrationPlan"><span class="hs-identifier hs-var hs-var">balanceSelected</span></a></span><span>
</span><span id="line-3558"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-3559"></span><span>
</span><span id="line-3560"></span><span>    </span><span class="annot"><a href="#local-6989586621682480771"><span class="hs-identifier hs-type">maybeSelections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483318"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3561"></span><span>    </span><span id="local-6989586621682480771"><span class="annot"><span class="annottext">maybeSelections :: Maybe (NonEmpty (ApiCoinSelection n))
</span><a href="#local-6989586621682480771"><span class="hs-identifier hs-var hs-var">maybeSelections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnsignedTx
   (TxIn, TxOut, NonEmpty DerivationIndex)
   TxOut
   (TxChange (NonEmpty DerivationIndex))
   (RewardAccount, Coin, NonEmpty DerivationIndex)
 -&gt; ApiCoinSelection n)
-&gt; NonEmpty
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; NonEmpty (ApiCoinSelection n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant).
UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
</span><a href="#local-6989586621682480761"><span class="hs-identifier hs-var">mkApiCoinSelectionForMigration</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty
   (UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
 -&gt; NonEmpty (ApiCoinSelection n))
-&gt; Maybe
     (NonEmpty
        (UnsignedTx
           (TxIn, TxOut, NonEmpty DerivationIndex)
           TxOut
           (TxChange (NonEmpty DerivationIndex))
           (RewardAccount, Coin, NonEmpty DerivationIndex)))
-&gt; Maybe (NonEmpty (ApiCoinSelection n))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (NonEmpty
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex)))
</span><a href="#local-6989586621682480760"><span class="hs-identifier hs-var">maybeUnsignedTxs</span></a></span><span>
</span><span id="line-3562"></span><span>
</span><span id="line-3563"></span><span>    </span><span class="annot"><a href="#local-6989586621682480759"><span class="hs-identifier hs-type">maybeSelectionWithdrawals</span></a></span><span>
</span><span id="line-3564"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#SelectionWithoutChange"><span class="hs-identifier hs-type">W.SelectionWithoutChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3565"></span><span>    </span><span id="local-6989586621682480759"><span class="annot"><span class="annottext">maybeSelectionWithdrawals :: Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
</span><a href="#local-6989586621682480759"><span class="hs-identifier hs-var hs-var">maybeSelectionWithdrawals</span></a></span></span><span>
</span><span id="line-3566"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MigrationPlan
-&gt; Withdrawal
-&gt; NonEmpty Address
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
</span><a href="Cardano.Wallet.html#migrationPlanToSelectionWithdrawals"><span class="hs-identifier hs-var">W.migrationPlanToSelectionWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480773"><span class="hs-identifier hs-var">plan</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480774"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span>
</span><span id="line-3567"></span><span>        </span><span class="annot"><span class="annottext">(NonEmpty Address
 -&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal)))
-&gt; NonEmpty Address
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT Address -&gt; Address
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address -&gt; Address)
-&gt; ((ApiT Address, Proxy n) -&gt; ApiT Address)
-&gt; (ApiT Address, Proxy n)
-&gt; Address
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n) -&gt; ApiT Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Address, Proxy n) -&gt; Address)
-&gt; NonEmpty (ApiT Address, Proxy n) -&gt; NonEmpty Address
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT Address, Proxy n)
</span><a href="#local-6989586621682480775"><span class="hs-identifier hs-var">addresses</span></a></span><span>
</span><span id="line-3568"></span><span>
</span><span id="line-3569"></span><span>    </span><span id="local-6989586621682480760"><span class="annot"><span class="annottext">maybeUnsignedTxs :: Maybe
  (NonEmpty
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex)))
</span><a href="#local-6989586621682480760"><span class="hs-identifier hs-var hs-var">maybeUnsignedTxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SelectionWithoutChange, Withdrawal)
 -&gt; UnsignedTx
      (TxIn, TxOut, NonEmpty DerivationIndex)
      TxOut
      (TxChange (NonEmpty DerivationIndex))
      (RewardAccount, Coin, NonEmpty DerivationIndex))
-&gt; NonEmpty (SelectionWithoutChange, Withdrawal)
-&gt; NonEmpty
     (UnsignedTx
        (TxIn, TxOut, NonEmpty DerivationIndex)
        TxOut
        (TxChange (NonEmpty DerivationIndex))
        (RewardAccount, Coin, NonEmpty DerivationIndex))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectionWithoutChange, Withdrawal)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682480757"><span class="hs-identifier hs-var">mkUnsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (SelectionWithoutChange, Withdrawal)
 -&gt; NonEmpty
      (UnsignedTx
         (TxIn, TxOut, NonEmpty DerivationIndex)
         TxOut
         (TxChange (NonEmpty DerivationIndex))
         (RewardAccount, Coin, NonEmpty DerivationIndex)))
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
-&gt; Maybe
     (NonEmpty
        (UnsignedTx
           (TxIn, TxOut, NonEmpty DerivationIndex)
           TxOut
           (TxChange (NonEmpty DerivationIndex))
           (RewardAccount, Coin, NonEmpty DerivationIndex)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
</span><a href="#local-6989586621682480759"><span class="hs-identifier hs-var">maybeSelectionWithdrawals</span></a></span><span>
</span><span id="line-3570"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3571"></span><span>        </span><span id="local-6989586621682480757"><span class="annot"><span class="annottext">mkUnsignedTx :: (SelectionWithoutChange, Withdrawal)
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682480757"><span class="hs-identifier hs-var hs-var">mkUnsignedTx</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480756"><span class="annot"><span class="annottext">SelectionWithoutChange
</span><a href="#local-6989586621682480756"><span class="hs-identifier hs-var">selection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480755"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480755"><span class="hs-identifier hs-var">withdrawal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
forall s input output change withdrawal.
(IsOurs s Address, input ~ (TxIn, TxOut, NonEmpty DerivationIndex),
 output ~ TxOut, change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
Withdrawal
-&gt; SelectionOf TxOut
-&gt; s
-&gt; UnsignedTx input output change withdrawal
</span><a href="Cardano.Wallet.html#selectionToUnsignedTx"><span class="hs-identifier hs-var">W.selectionToUnsignedTx</span></a></span><span>
</span><span id="line-3572"></span><span>            </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480755"><span class="hs-identifier hs-var">withdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionWithoutChange
</span><a href="#local-6989586621682480756"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:change:Selection :: [TxOut]
</span><a href="#local-6989586621682480754"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621682480776"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-3573"></span><span>
</span><span id="line-3574"></span><span>    </span><span class="annot"><a href="#local-6989586621682480767"><span class="hs-identifier hs-type">totalFee</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lovelace&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-3575"></span><span>    </span><span id="local-6989586621682480767"><span class="annot"><span class="annottext">totalFee :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682480767"><span class="hs-identifier hs-var hs-var">totalFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; MigrationPlan -&gt; Const Coin MigrationPlan)
-&gt; MigrationPlan -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;totalFee&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; MigrationPlan -&gt; Const Coin MigrationPlan)
(Coin -&gt; Const Coin Coin)
-&gt; MigrationPlan -&gt; Const Coin MigrationPlan
</span><a href="#local-6989586621682480753"><span class="hs-var">#totalFee</span></a></span><span> </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480773"><span class="hs-identifier hs-var">plan</span></a></span><span>
</span><span id="line-3576"></span><span>
</span><span id="line-3577"></span><span>    </span><span class="annot"><a href="#local-6989586621682480765"><span class="hs-identifier hs-type">balanceLeftover</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationBalance"><span class="hs-identifier hs-type">ApiWalletMigrationBalance</span></a></span><span>
</span><span id="line-3578"></span><span>    </span><span id="local-6989586621682480765"><span class="annot"><span class="annottext">balanceLeftover :: ApiWalletMigrationBalance
</span><a href="#local-6989586621682480765"><span class="hs-identifier hs-var hs-var">balanceLeftover</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480773"><span class="hs-identifier hs-var">plan</span></a></span><span>
</span><span id="line-3579"></span><span>        </span><span class="annot"><span class="annottext">MigrationPlan -&gt; (MigrationPlan -&gt; UTxO) -&gt; UTxO
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">((UTxO -&gt; Const UTxO UTxO)
 -&gt; MigrationPlan -&gt; Const UTxO MigrationPlan)
-&gt; MigrationPlan -&gt; UTxO
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unselected&quot;
  ((UTxO -&gt; Const UTxO UTxO)
   -&gt; MigrationPlan -&gt; Const UTxO MigrationPlan)
(UTxO -&gt; Const UTxO UTxO)
-&gt; MigrationPlan -&gt; Const UTxO MigrationPlan
</span><a href="#local-6989586621682480752"><span class="hs-var">#unselected</span></a></span><span>
</span><span id="line-3580"></span><span>        </span><span class="annot"><span class="annottext">UTxO -&gt; (UTxO -&gt; TokenBundle) -&gt; TokenBundle
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.UTxO.html#balance"><span class="hs-identifier hs-var">UTxO.balance</span></a></span><span>
</span><span id="line-3581"></span><span>        </span><span class="annot"><span class="annottext">TokenBundle
-&gt; (TokenBundle -&gt; ApiWalletMigrationBalance)
-&gt; ApiWalletMigrationBalance
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; ApiWalletMigrationBalance
</span><a href="#local-6989586621682480750"><span class="hs-identifier hs-var">mkApiWalletMigrationBalance</span></a></span><span>
</span><span id="line-3582"></span><span>
</span><span id="line-3583"></span><span>    </span><span class="annot"><a href="#local-6989586621682480763"><span class="hs-identifier hs-type">balanceSelected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationBalance"><span class="hs-identifier hs-type">ApiWalletMigrationBalance</span></a></span><span>
</span><span id="line-3584"></span><span>    </span><span id="local-6989586621682480763"><span class="annot"><span class="annottext">balanceSelected :: ApiWalletMigrationBalance
</span><a href="#local-6989586621682480763"><span class="hs-identifier hs-var hs-var">balanceSelected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; ApiWalletMigrationBalance
</span><a href="#local-6989586621682480750"><span class="hs-identifier hs-var">mkApiWalletMigrationBalance</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; ApiWalletMigrationBalance)
-&gt; TokenBundle -&gt; ApiWalletMigrationBalance
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3585"></span><span>        </span><span class="annot"><span class="annottext">Coin -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#fromCoin"><span class="hs-identifier hs-var">TokenBundle.fromCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480748"><span class="hs-identifier hs-var">balanceRewardWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; TokenBundle -&gt; TokenBundle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682480747"><span class="hs-identifier hs-var">balanceUTxO</span></a></span><span>
</span><span id="line-3586"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3587"></span><span>        </span><span id="local-6989586621682480747"><span class="annot"><span class="annottext">balanceUTxO :: TokenBundle
</span><a href="#local-6989586621682480747"><span class="hs-identifier hs-var hs-var">balanceUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480773"><span class="hs-identifier hs-var">plan</span></a></span><span>
</span><span id="line-3588"></span><span>            </span><span class="annot"><span class="annottext">MigrationPlan
-&gt; (MigrationPlan -&gt; [Selection (TxIn, TxOut)])
-&gt; [Selection (TxIn, TxOut)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(([Selection (TxIn, TxOut)]
  -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
 -&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan)
-&gt; MigrationPlan -&gt; [Selection (TxIn, TxOut)]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;selections&quot;
  (([Selection (TxIn, TxOut)]
    -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
   -&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan)
([Selection (TxIn, TxOut)]
 -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
-&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan
</span><a href="#local-6989586621682480746"><span class="hs-var">#selections</span></a></span><span>
</span><span id="line-3589"></span><span>            </span><span class="annot"><span class="annottext">[Selection (TxIn, TxOut)]
-&gt; ([Selection (TxIn, TxOut)] -&gt; TokenBundle) -&gt; TokenBundle
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Selection (TxIn, TxOut) -&gt; TokenBundle)
-&gt; [Selection (TxIn, TxOut)] -&gt; TokenBundle
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenBundle -&gt; Const TokenBundle TokenBundle)
 -&gt; Selection (TxIn, TxOut)
 -&gt; Const TokenBundle (Selection (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut) -&gt; TokenBundle
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputBalance&quot;
  ((TokenBundle -&gt; Const TokenBundle TokenBundle)
   -&gt; Selection (TxIn, TxOut)
   -&gt; Const TokenBundle (Selection (TxIn, TxOut)))
(TokenBundle -&gt; Const TokenBundle TokenBundle)
-&gt; Selection (TxIn, TxOut)
-&gt; Const TokenBundle (Selection (TxIn, TxOut))
</span><a href="#local-6989586621682480744"><span class="hs-var">#inputBalance</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3590"></span><span>        </span><span id="local-6989586621682480748"><span class="annot"><span class="annottext">balanceRewardWithdrawal :: Coin
</span><a href="#local-6989586621682480748"><span class="hs-identifier hs-var hs-var">balanceRewardWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480773"><span class="hs-identifier hs-var">plan</span></a></span><span>
</span><span id="line-3591"></span><span>            </span><span class="annot"><span class="annottext">MigrationPlan
-&gt; (MigrationPlan -&gt; [Selection (TxIn, TxOut)])
-&gt; [Selection (TxIn, TxOut)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(([Selection (TxIn, TxOut)]
  -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
 -&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan)
-&gt; MigrationPlan -&gt; [Selection (TxIn, TxOut)]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;selections&quot;
  (([Selection (TxIn, TxOut)]
    -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
   -&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan)
([Selection (TxIn, TxOut)]
 -&gt; Const [Selection (TxIn, TxOut)] [Selection (TxIn, TxOut)])
-&gt; MigrationPlan -&gt; Const [Selection (TxIn, TxOut)] MigrationPlan
</span><a href="#local-6989586621682480743"><span class="hs-var">#selections</span></a></span><span>
</span><span id="line-3592"></span><span>            </span><span class="annot"><span class="annottext">[Selection (TxIn, TxOut)]
-&gt; ([Selection (TxIn, TxOut)] -&gt; Coin) -&gt; Coin
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Selection (TxIn, TxOut) -&gt; Coin)
-&gt; [Selection (TxIn, TxOut)] -&gt; Coin
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut)))
-&gt; Selection (TxIn, TxOut) -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;rewardWithdrawal&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut)))
(Coin -&gt; Const Coin Coin)
-&gt; Selection (TxIn, TxOut) -&gt; Const Coin (Selection (TxIn, TxOut))
</span><a href="#local-6989586621682480742"><span class="hs-var">#rewardWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3593"></span><span>
</span><span id="line-3594"></span><span>    </span><span id="local-6989586621682480761"><span class="annot"><span class="annottext">mkApiCoinSelectionForMigration :: UnsignedTx
  (TxIn, TxOut, NonEmpty DerivationIndex)
  TxOut
  (TxChange (NonEmpty DerivationIndex))
  (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
</span><a href="#local-6989586621682480761"><span class="hs-identifier hs-var hs-var">mkApiCoinSelectionForMigration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx
     (TxIn, TxOut, NonEmpty DerivationIndex)
     TxOut
     (TxChange (NonEmpty DerivationIndex))
     (RewardAccount, Coin, NonEmpty DerivationIndex)
-&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant) input output change withdrawal.
(input ~ (TxIn, TxOut, NonEmpty DerivationIndex), output ~ TxOut,
 change ~ TxChange (NonEmpty DerivationIndex),
 withdrawal ~ (RewardAccount, Coin, NonEmpty DerivationIndex)) =&gt;
[Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var">mkApiCoinSelection</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe (DelegationAction, NonEmpty DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3595"></span><span>
</span><span id="line-3596"></span><span>    </span><span class="annot"><a href="#local-6989586621682480750"><span class="hs-identifier hs-type">mkApiWalletMigrationBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationBalance"><span class="hs-identifier hs-type">ApiWalletMigrationBalance</span></a></span><span>
</span><span id="line-3597"></span><span>    </span><span id="local-6989586621682480750"><span class="annot"><span class="annottext">mkApiWalletMigrationBalance :: TokenBundle -&gt; ApiWalletMigrationBalance
</span><a href="#local-6989586621682480750"><span class="hs-identifier hs-var hs-var">mkApiWalletMigrationBalance</span></a></span></span><span> </span><span id="local-6989586621682480741"><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682480741"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationBalance :: Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap -&gt; ApiWalletMigrationBalance
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationBalance"><span class="hs-identifier hs-type">ApiWalletMigrationBalance</span></a></span><span>
</span><span id="line-3598"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:ada:ApiWalletMigrationBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aada%3AApiWalletMigrationBalance"><span class="hs-identifier hs-var">ada</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; TokenBundle -&gt; Const Coin TokenBundle)
-&gt; TokenBundle -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;coin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; TokenBundle -&gt; Const Coin TokenBundle)
(Coin -&gt; Const Coin Coin) -&gt; TokenBundle -&gt; Const Coin TokenBundle
</span><a href="#local-6989586621682480738"><span class="hs-var">#coin</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682480741"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-3599"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletMigrationBalance :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiWalletMigrationBalance"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenMap -&gt; ApiT TokenMap) -&gt; TokenMap -&gt; ApiT TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenMap -&gt; Const TokenMap TokenMap)
 -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenBundle -&gt; TokenMap
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682480736"><span class="hs-var">#tokens</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
</span><a href="#local-6989586621682480741"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-3600"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-3601"></span><span>
</span><span id="line-3602"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#migrateWallet"><span class="hs-identifier hs-type">migrateWallet</span></a></span><span>
</span><span id="line-3603"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480735"><span class="annot"><a href="#local-6989586621682480735"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480734"><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480733"><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682480732"><span class="annot"><a href="#local-6989586621682480732"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682480731"><span class="annot"><a href="#local-6989586621682480731"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3604"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480735"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3605"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3606"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3607"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#HasNetworkLayer"><span class="hs-identifier hs-type">HasNetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480735"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3608"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOwned"><span class="hs-identifier hs-type">IsOwned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3609"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480732"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3610"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3611"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3612"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3613"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480735"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3614"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalPostData"><span class="hs-identifier hs-type">ApiWithdrawalPostData</span></a></span><span>
</span><span id="line-3615"></span><span>        </span><span class="hs-comment">-- ^ What type of reward withdrawal to attempt</span><span>
</span><span id="line-3616"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3617"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMigrationPostData"><span class="hs-identifier hs-type">ApiWalletMigrationPostData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480732"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480731"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-3618"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480732"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3619"></span><span id="migrateWallet"><span class="annot"><span class="annottext">migrateWallet :: ctx
-&gt; Maybe ApiWithdrawalPostData
-&gt; ApiT WalletId
-&gt; ApiWalletMigrationPostData n p
-&gt; Handler (NonEmpty (ApiTransaction n))
</span><a href="Cardano.Wallet.Api.Server.html#migrateWallet"><span class="hs-identifier hs-var hs-var">migrateWallet</span></a></span></span><span> </span><span id="local-6989586621682480730"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480730"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480729"><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="#local-6989586621682480729"><span class="hs-identifier hs-var">withdrawalType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480728"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480728"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480727"><span class="annot"><span class="annottext">ApiWalletMigrationPostData n p
</span><a href="#local-6989586621682480727"><span class="hs-identifier hs-var">postData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3620"></span><span>    </span><span class="hs-comment">-- FIXME [ADP-1489] mkRewardAccountBuilder does itself read</span><span>
</span><span id="line-3621"></span><span>    </span><span class="hs-comment">-- @currentNodeEra@ which is not guaranteed with the era read here. This</span><span>
</span><span id="line-3622"></span><span>    </span><span class="hs-comment">-- could cause problems under exceptional circumstances.</span><span>
</span><span id="line-3623"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682480726"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480726"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480725"><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480725"><span class="hs-identifier hs-var">mkRewardAccount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3624"></span><span>        </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(ctx ~ ApiLayer s k, shelley ~ SeqState n ShelleyKey,
 HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK),
 WalletKey k, Typeable s, Typeable n) =&gt;
ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var">mkRewardAccountBuilder</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480732"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480730"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480728"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="#local-6989586621682480729"><span class="hs-identifier hs-var">withdrawalType</span></a></span><span>
</span><span id="line-3625"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler (NonEmpty (ApiTransaction n)))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (NonEmpty (ApiTransaction n)))
-&gt; (WorkerCtx ctx -&gt; Handler (NonEmpty (ApiTransaction n)))
-&gt; Handler (NonEmpty (ApiTransaction n))
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480730"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480728"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (NonEmpty (ApiTransaction n))
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler (NonEmpty (ApiTransaction n))
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (NonEmpty (ApiTransaction n)))
 -&gt; Handler (NonEmpty (ApiTransaction n)))
-&gt; (WorkerCtx ctx -&gt; Handler (NonEmpty (ApiTransaction n)))
-&gt; Handler (NonEmpty (ApiTransaction n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480724"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480724"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3626"></span><span>        </span><span id="local-6989586621682480723"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480723"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480724"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3627"></span><span>        </span><span id="local-6989586621682480722"><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480722"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateMigrationPlan IO MigrationPlan
-&gt; Handler MigrationPlan
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrCreateMigrationPlan IO MigrationPlan
 -&gt; Handler MigrationPlan)
-&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
-&gt; Handler MigrationPlan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; AnyCardanoEra
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
forall ctx (k :: Depth -&gt; * -&gt; *) s.
(HasDBLayer IO s k ctx, HasNetworkLayer IO ctx,
 HasTransactionLayer k ctx) =&gt;
ctx
-&gt; AnyCardanoEra
-&gt; WalletId
-&gt; Withdrawal
-&gt; ExceptT ErrCreateMigrationPlan IO MigrationPlan
</span><a href="Cardano.Wallet.html#createMigrationPlan"><span class="hs-identifier hs-var">W.createMigrationPlan</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480724"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480723"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480728"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480726"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span>
</span><span id="line-3628"></span><span>        </span><span id="local-6989586621682480721"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480721"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlotNo -&gt; Handler SlotNo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlotNo -&gt; Handler SlotNo) -&gt; IO SlotNo -&gt; Handler SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Maybe NominalDiffTime -&gt; IO SlotNo
</span><a href="Cardano.Wallet.html#getTxExpiry"><span class="hs-identifier hs-var">W.getTxExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480720"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3629"></span><span>        </span><span id="local-6989586621682480719"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480719"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480724"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3630"></span><span>        </span><span id="local-6989586621682480718"><span class="annot"><span class="annottext">NonEmpty (SelectionWithoutChange, Withdrawal)
</span><a href="#local-6989586621682480718"><span class="hs-identifier hs-var">selectionWithdrawals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrCreateMigrationPlan
  IO
  (NonEmpty (SelectionWithoutChange, Withdrawal))
-&gt; Handler (NonEmpty (SelectionWithoutChange, Withdrawal))
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span>
</span><span id="line-3631"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   ErrCreateMigrationPlan
   IO
   (NonEmpty (SelectionWithoutChange, Withdrawal))
 -&gt; Handler (NonEmpty (SelectionWithoutChange, Withdrawal)))
-&gt; ExceptT
     ErrCreateMigrationPlan
     IO
     (NonEmpty (SelectionWithoutChange, Withdrawal))
-&gt; Handler (NonEmpty (SelectionWithoutChange, Withdrawal))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCreateMigrationPlan
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
-&gt; ExceptT
     ErrCreateMigrationPlan
     IO
     (NonEmpty (SelectionWithoutChange, Withdrawal))
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
e -&gt; Maybe a -&gt; ExceptT e m a
</span><a href="../../../../errors/html/src"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCreateMigrationPlan
</span><a href="Cardano.Wallet.html#ErrCreateMigrationPlanEmpty"><span class="hs-identifier hs-var">ErrCreateMigrationPlanEmpty</span></a></span><span>
</span><span id="line-3632"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
 -&gt; ExceptT
      ErrCreateMigrationPlan
      IO
      (NonEmpty (SelectionWithoutChange, Withdrawal)))
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
-&gt; ExceptT
     ErrCreateMigrationPlan
     IO
     (NonEmpty (SelectionWithoutChange, Withdrawal))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MigrationPlan
-&gt; Withdrawal
-&gt; NonEmpty Address
-&gt; Maybe (NonEmpty (SelectionWithoutChange, Withdrawal))
</span><a href="Cardano.Wallet.html#migrationPlanToSelectionWithdrawals"><span class="hs-identifier hs-var">W.migrationPlanToSelectionWithdrawals</span></a></span><span>
</span><span id="line-3633"></span><span>                </span><span class="annot"><span class="annottext">MigrationPlan
</span><a href="#local-6989586621682480722"><span class="hs-identifier hs-var">plan</span></a></span><span> </span><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480726"><span class="hs-identifier hs-var">rewardWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Address
</span><a href="#local-6989586621682480717"><span class="hs-identifier hs-var">addresses</span></a></span><span>
</span><span id="line-3634"></span><span>        </span><span class="annot"><span class="annottext">NonEmpty (SelectionWithoutChange, Withdrawal)
-&gt; ((SelectionWithoutChange, Withdrawal)
    -&gt; Handler (ApiTransaction n))
-&gt; Handler (NonEmpty (ApiTransaction n))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (SelectionWithoutChange, Withdrawal)
</span><a href="#local-6989586621682480718"><span class="hs-identifier hs-var">selectionWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">(((SelectionWithoutChange, Withdrawal)
  -&gt; Handler (ApiTransaction n))
 -&gt; Handler (NonEmpty (ApiTransaction n)))
-&gt; ((SelectionWithoutChange, Withdrawal)
    -&gt; Handler (ApiTransaction n))
-&gt; Handler (NonEmpty (ApiTransaction n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682480716"><span class="annot"><span class="annottext">SelectionWithoutChange
</span><a href="#local-6989586621682480716"><span class="hs-identifier hs-var">selection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480715"><span class="annot"><span class="annottext">Withdrawal
</span><a href="#local-6989586621682480715"><span class="hs-identifier hs-var">txWithdrawal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3635"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480714"><span class="annot"><span class="annottext">txContext :: TransactionCtx
</span><a href="#local-6989586621682480714"><span class="hs-identifier hs-var hs-var">txContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="Cardano.Wallet.Transaction.html#defaultTransactionCtx"><span class="hs-identifier hs-var">defaultTransactionCtx</span></a></span><span>
</span><span id="line-3636"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Withdrawal
txWithdrawal :: Withdrawal
$sel:txWithdrawal:TransactionCtx :: Withdrawal
</span><a href="#local-6989586621682480715"><span class="hs-identifier hs-var hs-var">txWithdrawal</span></a></span><span>
</span><span id="line-3637"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txValidityInterval:TransactionCtx :: (Maybe SlotNo, SlotNo)
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxValidityInterval%3ATransactionCtx"><span class="hs-identifier hs-var">txValidityInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SlotNo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480721"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3638"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDelegationAction:TransactionCtx :: Maybe DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3AtxDelegationAction%3ATransactionCtx"><span class="hs-identifier hs-var">txDelegationAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DelegationAction
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3639"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-3640"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682480713"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480712"><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480712"><span class="hs-identifier hs-var">txMeta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480711"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480711"><span class="hs-identifier hs-var">txTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480710"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480710"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
 -&gt; Handler (Tx, TxMeta, UTCTime, SealedTx))
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
-&gt; Handler (Tx, TxMeta, UTCTime, SealedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3641"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; RewardAccountBuilder k
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasTransactionLayer k ctx, HasDBLayer IO s k ctx,
 HasNetworkLayer IO ctx, IsOwned s k) =&gt;
ctx
-&gt; WalletId
-&gt; AnyCardanoEra
-&gt; ((k 'RootK XPrv, Passphrase &quot;encryption&quot;)
    -&gt; (XPrv, Passphrase &quot;encryption&quot;))
-&gt; Passphrase &quot;user&quot;
-&gt; TransactionCtx
-&gt; SelectionOf TxOut
-&gt; ExceptT ErrSignPayment IO (Tx, TxMeta, UTCTime, SealedTx)
</span><a href="Cardano.Wallet.html#buildAndSignTransaction"><span class="hs-identifier hs-var">W.buildAndSignTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3642"></span><span>                    </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480724"><span class="hs-identifier hs-var">wrk</span></a></span><span>
</span><span id="line-3643"></span><span>                    </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480728"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3644"></span><span>                    </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480723"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-3645"></span><span>                    </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480725"><span class="hs-identifier hs-var">mkRewardAccount</span></a></span><span>
</span><span id="line-3646"></span><span>                    </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480709"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-3647"></span><span>                    </span><span class="annot"><span class="annottext">TransactionCtx
</span><a href="#local-6989586621682480714"><span class="hs-identifier hs-var">txContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionWithoutChange
</span><a href="#local-6989586621682480716"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:change:Selection :: [TxOut]
</span><a href="#local-6989586621682480754"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3648"></span><span>            </span><span class="annot"><span class="annottext">ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSubmitTx IO () -&gt; Handler ())
-&gt; ExceptT ErrSubmitTx IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3649"></span><span>                </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasDBLayer IO s k ctx,
 HasLogger IO WalletWorkerLog ctx) =&gt;
ctx
-&gt; WalletId -&gt; (Tx, TxMeta, SealedTx) -&gt; ExceptT ErrSubmitTx IO ()
</span><a href="Cardano.Wallet.html#submitTx"><span class="hs-identifier hs-var">W.submitTx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480734"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480733"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480724"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480728"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
</span><a href="#local-6989586621682480712"><span class="hs-identifier hs-var">txMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480710"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3650"></span><span>            </span><span class="annot"><span class="annottext">IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ApiTransaction n) -&gt; Handler (ApiTransaction n))
-&gt; IO (ApiTransaction n) -&gt; Handler (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
forall (n :: NetworkDiscriminant).
TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-var">mkApiTransaction</span></a></span><span>
</span><span id="line-3651"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480730"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3652"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;pendingSince&quot;
  ((Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe ApiBlockReference -&gt; f (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682480708"><span class="hs-var">#pendingSince</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3653"></span><span>                </span><span class="annot"><span class="annottext">MkApiTransactionParams :: Hash &quot;Tx&quot;
-&gt; Maybe Coin
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [(TxIn, Maybe TxOut)]
-&gt; [TxOut]
-&gt; Maybe TxOut
-&gt; Map RewardAccount Coin
-&gt; TxMeta
-&gt; Maybe TxMetadata
-&gt; UTCTime
-&gt; Maybe TxScriptValidity
-&gt; Coin
-&gt; TxMetadataSchema
-&gt; MkApiTransactionParams
</span><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-type">MkApiTransactionParams</span></a></span><span>
</span><span id="line-3654"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txId:MkApiTransactionParams :: Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxId%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682480707"><span class="hs-var">#txId</span></a></span><span>
</span><span id="line-3655"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txFee:MkApiTransactionParams :: Maybe Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxFee%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; Tx -&gt; Const (Maybe Coin) Tx)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; Tx -&gt; Const (Maybe Coin) Tx)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; Tx -&gt; Const (Maybe Coin) Tx
</span><a href="#local-6989586621682480706"><span class="hs-var">#fee</span></a></span><span>
</span><span id="line-3656"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3657"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)])
-&gt; NonEmpty (TxIn, Maybe TxOut) -&gt; [(TxIn, Maybe TxOut)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe TxOut) -&gt; (TxIn, TxOut) -&gt; (TxIn, Maybe TxOut)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Maybe TxOut
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut) -&gt; (TxIn, Maybe TxOut))
-&gt; NonEmpty (TxIn, TxOut) -&gt; NonEmpty (TxIn, Maybe TxOut)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionWithoutChange
</span><a href="#local-6989586621682480716"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionWithoutChange
-&gt; ((NonEmpty (TxIn, TxOut)
     -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
    -&gt; SelectionWithoutChange
    -&gt; Const (NonEmpty (TxIn, TxOut)) SelectionWithoutChange)
-&gt; NonEmpty (TxIn, TxOut)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  ((NonEmpty (TxIn, TxOut)
    -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
   -&gt; SelectionWithoutChange
   -&gt; Const (NonEmpty (TxIn, TxOut)) SelectionWithoutChange)
(NonEmpty (TxIn, TxOut)
 -&gt; Const (NonEmpty (TxIn, TxOut)) (NonEmpty (TxIn, TxOut)))
-&gt; SelectionWithoutChange
-&gt; Const (NonEmpty (TxIn, TxOut)) SelectionWithoutChange
</span><a href="#local-6989586621682480705"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-3658"></span><span>                      </span><span class="hs-comment">-- Migrations never require collateral:</span><span>
</span><span id="line-3659"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralInputs:MkApiTransactionParams :: [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3660"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txOutputs:MkApiTransactionParams :: [TxOut]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx)
([TxOut] -&gt; Const [TxOut] [TxOut]) -&gt; Tx -&gt; Const [TxOut] Tx
</span><a href="#local-6989586621682480704"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-3661"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txCollateralOutput:MkApiTransactionParams :: Maybe TxOut
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txCollateralOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
    -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
-&gt; Maybe TxOut
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateralOutput&quot;
  ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
   -&gt; Tx -&gt; Const (Maybe TxOut) Tx)
(Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
-&gt; Tx -&gt; Const (Maybe TxOut) Tx
</span><a href="#local-6989586621682480703"><span class="hs-var">#collateralOutput</span></a></span><span>
</span><span id="line-3662"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txWithdrawals:MkApiTransactionParams :: Map RewardAccount Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; Tx -&gt; Const (Map RewardAccount Coin) Tx
</span><a href="#local-6989586621682480702"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-3663"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMeta
txMeta :: TxMeta
$sel:txMeta:MkApiTransactionParams :: TxMeta
</span><a href="#local-6989586621682480712"><span class="hs-identifier hs-var hs-var">txMeta</span></a></span><span>
</span><span id="line-3664"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadata:MkApiTransactionParams :: Maybe TxMetadata
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3665"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
txTime :: UTCTime
$sel:txTime:MkApiTransactionParams :: UTCTime
</span><a href="#local-6989586621682480711"><span class="hs-identifier hs-var hs-var">txTime</span></a></span><span>
</span><span id="line-3666"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txScriptValidity:MkApiTransactionParams :: Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480713"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Maybe TxScriptValidity
     -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
    -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
-&gt; Maybe TxScriptValidity
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe TxScriptValidity
    -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
   -&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx)
(Maybe TxScriptValidity
 -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
-&gt; Tx -&gt; Const (Maybe TxScriptValidity) Tx
</span><a href="#local-6989586621682480701"><span class="hs-var">#scriptValidity</span></a></span><span>
</span><span id="line-3667"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txDeposit:MkApiTransactionParams :: Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txDeposit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AstakeKeyDeposit%3AProtocolParameters"><span class="hs-identifier hs-var hs-var">W.stakeKeyDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480719"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-3668"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txMetadataSchema:MkApiTransactionParams :: TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="hs-identifier hs-var">txMetadataSchema</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataDetailedSchema"><span class="hs-identifier hs-var">TxMetadataDetailedSchema</span></a></span><span>
</span><span id="line-3669"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-3670"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3671"></span><span>    </span><span id="local-6989586621682480717"><span class="annot"><span class="annottext">addresses :: NonEmpty Address
</span><a href="#local-6989586621682480717"><span class="hs-identifier hs-var hs-var">addresses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT Address -&gt; Address
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address -&gt; Address)
-&gt; ((ApiT Address, Proxy n) -&gt; ApiT Address)
-&gt; (ApiT Address, Proxy n)
-&gt; Address
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n) -&gt; ApiT Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Address, Proxy n) -&gt; Address)
-&gt; NonEmpty (ApiT Address, Proxy n) -&gt; NonEmpty Address
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (ApiT Address, Proxy n)
  -&gt; Const
       (NonEmpty (ApiT Address, Proxy n))
       (NonEmpty (ApiT Address, Proxy n)))
 -&gt; ApiWalletMigrationPostData n p
 -&gt; Const
      (NonEmpty (ApiT Address, Proxy n))
      (ApiWalletMigrationPostData n p))
-&gt; ApiWalletMigrationPostData n p
-&gt; NonEmpty (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;addresses&quot;
  ((NonEmpty (ApiT Address, Proxy n)
    -&gt; Const
         (NonEmpty (ApiT Address, Proxy n))
         (NonEmpty (ApiT Address, Proxy n)))
   -&gt; ApiWalletMigrationPostData n p
   -&gt; Const
        (NonEmpty (ApiT Address, Proxy n))
        (ApiWalletMigrationPostData n p))
(NonEmpty (ApiT Address, Proxy n)
 -&gt; Const
      (NonEmpty (ApiT Address, Proxy n))
      (NonEmpty (ApiT Address, Proxy n)))
-&gt; ApiWalletMigrationPostData n p
-&gt; Const
     (NonEmpty (ApiT Address, Proxy n)) (ApiWalletMigrationPostData n p)
</span><a href="#local-6989586621682480700"><span class="hs-var">#addresses</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationPostData n p
</span><a href="#local-6989586621682480727"><span class="hs-identifier hs-var">postData</span></a></span><span>
</span><span id="line-3672"></span><span>    </span><span id="local-6989586621682480709"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480709"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase p -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Passphrase p -&gt; Passphrase &quot;user&quot;)
-&gt; Passphrase p -&gt; Passphrase &quot;user&quot;
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase p) -&gt; Passphrase p
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT (Passphrase p) -&gt; Passphrase p)
-&gt; ApiT (Passphrase p) -&gt; Passphrase p
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationPostData n p
</span><a href="#local-6989586621682480727"><span class="hs-identifier hs-var">postData</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletMigrationPostData n p
-&gt; ((ApiT (Passphrase p)
     -&gt; Const (ApiT (Passphrase p)) (ApiT (Passphrase p)))
    -&gt; ApiWalletMigrationPostData n p
    -&gt; Const (ApiT (Passphrase p)) (ApiWalletMigrationPostData n p))
-&gt; ApiT (Passphrase p)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase p)
    -&gt; Const (ApiT (Passphrase p)) (ApiT (Passphrase p)))
   -&gt; ApiWalletMigrationPostData n p
   -&gt; Const (ApiT (Passphrase p)) (ApiWalletMigrationPostData n p))
(ApiT (Passphrase p)
 -&gt; Const (ApiT (Passphrase p)) (ApiT (Passphrase p)))
-&gt; ApiWalletMigrationPostData n p
-&gt; Const (ApiT (Passphrase p)) (ApiWalletMigrationPostData n p)
</span><a href="#local-6989586621682480699"><span class="hs-var">#passphrase</span></a></span><span>
</span><span id="line-3673"></span><span>    </span><span class="annot"><a href="#local-6989586621682480720"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3674"></span><span>    </span><span id="local-6989586621682480720"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480720"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480730"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3675"></span><span>
</span><span id="line-3676"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                    Network
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3679"></span><span>
</span><span id="line-3680"></span><span class="hs-keyword">data</span><span> </span><span id="ErrCurrentEpoch"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCurrentEpoch"><span class="hs-identifier hs-var">ErrCurrentEpoch</span></a></span></span><span>
</span><span id="line-3681"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrUnableToDetermineCurrentEpoch"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrUnableToDetermineCurrentEpoch"><span class="hs-identifier hs-var">ErrUnableToDetermineCurrentEpoch</span></a></span></span><span>  </span><span class="hs-comment">-- fixme: unused</span><span>
</span><span id="line-3682"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCurrentEpochPastHorizonException"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCurrentEpochPastHorizonException"><span class="hs-identifier hs-var">ErrCurrentEpochPastHorizonException</span></a></span></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span>
</span><span id="line-3683"></span><span>
</span><span id="line-3684"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getCurrentEpoch"><span class="hs-identifier hs-type">getCurrentEpoch</span></a></span><span>
</span><span id="line-3685"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483840"><span class="annot"><a href="#local-6989586621682483840"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682483839"><span class="annot"><a href="#local-6989586621682483839"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483838"><span class="annot"><a href="#local-6989586621682483838"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682483840"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483839"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483838"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3686"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483840"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3687"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#EpochNo"><span class="hs-identifier hs-type">W.EpochNo</span></a></span><span>
</span><span id="line-3688"></span><span id="getCurrentEpoch"><span class="annot"><span class="annottext">getCurrentEpoch :: ctx -&gt; Handler EpochNo
</span><a href="Cardano.Wallet.Api.Server.html#getCurrentEpoch"><span class="hs-identifier hs-var hs-var">getCurrentEpoch</span></a></span></span><span> </span><span id="local-6989586621682480696"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480696"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either PastHorizonException EpochNo)
-&gt; Handler (Either PastHorizonException EpochNo)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT PastHorizonException IO EpochNo
-&gt; IO (Either PastHorizonException EpochNo)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; ExceptT PastHorizonException IO EpochNo
forall (m :: * -&gt; *). MonadIO m =&gt; TimeInterpreter m -&gt; m EpochNo
</span><a href="Cardano.Wallet.Primitive.Slotting.html#currentEpoch"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480695"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handler (Either PastHorizonException EpochNo)
-&gt; (Either PastHorizonException EpochNo -&gt; Handler EpochNo)
-&gt; Handler EpochNo
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3689"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682480694"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480694"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCurrentEpoch -&gt; Handler EpochNo
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrCurrentEpoch -&gt; Handler EpochNo)
-&gt; ErrCurrentEpoch -&gt; Handler EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ErrCurrentEpoch
</span><a href="Cardano.Wallet.Api.Server.html#ErrCurrentEpochPastHorizonException"><span class="hs-identifier hs-var">ErrCurrentEpochPastHorizonException</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480694"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-3690"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682480693"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682480693"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Handler EpochNo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682480693"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3691"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3692"></span><span>    </span><span class="annot"><a href="#local-6989586621682480695"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3693"></span><span>    </span><span id="local-6989586621682480695"><span class="annot"><span class="annottext">ti :: TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480695"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480696"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx)
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; ctx -&gt; Const (NetworkLayer IO Block) ctx
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3694"></span><span>
</span><span id="line-3695"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getNetworkInformation"><span class="hs-identifier hs-type">getNetworkInformation</span></a></span><span>
</span><span id="line-3696"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-3697"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">NetworkId</span></a></span><span>
</span><span id="line-3698"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-3699"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletMode"><span class="hs-identifier hs-type">ApiWalletMode</span></a></span><span>
</span><span id="line-3700"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNetworkInformation"><span class="hs-identifier hs-type">ApiNetworkInformation</span></a></span><span>
</span><span id="line-3701"></span><span id="getNetworkInformation"><span class="annot"><span class="annottext">getNetworkInformation :: NetworkId
-&gt; NetworkLayer IO Block
-&gt; ApiWalletMode
-&gt; Handler ApiNetworkInformation
</span><a href="Cardano.Wallet.Api.Server.html#getNetworkInformation"><span class="hs-identifier hs-var hs-var">getNetworkInformation</span></a></span></span><span> </span><span id="local-6989586621682480692"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621682480692"><span class="hs-identifier hs-var">nid</span></a></span></span><span>
</span><span id="line-3702"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span>
</span><span id="line-3703"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682480690"><span class="annot"><span class="annottext">SlotNo -&gt; IO SyncProgress
syncProgress :: forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; SlotNo -&gt; m SyncProgress
syncProgress :: SlotNo -&gt; IO SyncProgress
</span><a href="Cardano.Wallet.Network.html#syncProgress"><span class="hs-identifier hs-var hs-var">syncProgress</span></a></span></span><span>
</span><span id="line-3704"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480688"><span class="annot"><span class="annottext">IO BlockHeader
currentNodeTip :: forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m BlockHeader
currentNodeTip :: IO BlockHeader
</span><a href="Cardano.Wallet.Network.html#currentNodeTip"><span class="hs-identifier hs-var hs-var">currentNodeTip</span></a></span></span><span>
</span><span id="line-3705"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480686"><span class="annot"><span class="annottext">IO AnyCardanoEra
currentNodeEra :: IO AnyCardanoEra
currentNodeEra :: forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="#local-6989586621682480686"><span class="hs-identifier hs-var hs-var">currentNodeEra</span></a></span></span><span>
</span><span id="line-3706"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480685"><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
timeInterpreter :: TimeInterpreter (ExceptT PastHorizonException IO)
timeInterpreter :: forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="#local-6989586621682480685"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span></span><span>
</span><span id="line-3707"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-3708"></span><span>    </span><span id="local-6989586621682480684"><span class="annot"><span class="annottext">ApiWalletMode
</span><a href="#local-6989586621682480684"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ApiNetworkInformation -&gt; Handler ApiNetworkInformation
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiNetworkInformation -&gt; Handler ApiNetworkInformation)
-&gt; IO ApiNetworkInformation -&gt; Handler ApiNetworkInformation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3709"></span><span>        </span><span id="local-6989586621682480683"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682480683"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO) -&gt; IO RelativeTime
forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
TimeInterpreter n -&gt; m RelativeTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#currentRelativeTime"><span class="hs-identifier hs-var">currentRelativeTime</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO)
</span><a href="#local-6989586621682480682"><span class="hs-identifier hs-var">ti</span></a></span><span>
</span><span id="line-3710"></span><span>        </span><span id="local-6989586621682480681"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682480681"><span class="hs-identifier hs-var">nodeTip</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO BlockHeader
</span><a href="#local-6989586621682480688"><span class="hs-identifier hs-var">currentNodeTip</span></a></span><span>
</span><span id="line-3711"></span><span>        </span><span id="local-6989586621682480680"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480680"><span class="hs-identifier hs-var">nodeEra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra
</span><a href="#local-6989586621682480686"><span class="hs-identifier hs-var">currentNodeEra</span></a></span><span>
</span><span id="line-3712"></span><span>        </span><span id="local-6989586621682480679"><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682480679"><span class="hs-identifier hs-var">apiNodeTip</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; BlockHeader -&gt; IO ApiBlockReference
forall (m :: * -&gt; *).
Monad m =&gt;
TimeInterpreter m -&gt; BlockHeader -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReferenceFromHeader"><span class="hs-identifier hs-var">makeApiBlockReferenceFromHeader</span></a></span><span>
</span><span id="line-3713"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier hs-var">neverFails</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;node tip is within safe-zone&quot;</span></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480685"><span class="hs-identifier hs-var">timeInterpreter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3714"></span><span>            </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682480681"><span class="hs-identifier hs-var">nodeTip</span></a></span><span>
</span><span id="line-3715"></span><span>        </span><span id="local-6989586621682480677"><span class="annot"><span class="annottext">Maybe (ApiSlotReference, ApiEpochInfo)
</span><a href="#local-6989586621682480677"><span class="hs-identifier hs-var">nowInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeT IO (ApiSlotReference, ApiEpochInfo)
-&gt; IO (Maybe (ApiSlotReference, ApiEpochInfo))
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO (ApiSlotReference, ApiEpochInfo)
 -&gt; IO (Maybe (ApiSlotReference, ApiEpochInfo)))
-&gt; MaybeT IO (ApiSlotReference, ApiEpochInfo)
-&gt; IO (Maybe (ApiSlotReference, ApiEpochInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; MaybeT IO (ApiSlotReference, ApiEpochInfo)
</span><a href="#local-6989586621682480675"><span class="hs-identifier hs-var">networkTipInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682480683"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-3716"></span><span>        </span><span id="local-6989586621682480674"><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682480674"><span class="hs-identifier hs-var">progress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; IO SyncProgress
</span><a href="#local-6989586621682480690"><span class="hs-identifier hs-var">syncProgress</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; IO SyncProgress) -&gt; SlotNo -&gt; IO SyncProgress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotNo -&gt; Const SlotNo SlotNo)
 -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; BlockHeader -&gt; SlotNo
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682480673"><span class="hs-var">#slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682480681"><span class="hs-identifier hs-var">nodeTip</span></a></span><span>
</span><span id="line-3717"></span><span>        </span><span class="annot"><span class="annottext">ApiNetworkInformation -&gt; IO ApiNetworkInformation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ApiNetworkInformation :: ApiT SyncProgress
-&gt; Maybe ApiEpochInfo
-&gt; ApiBlockReference
-&gt; Maybe ApiSlotReference
-&gt; ApiEra
-&gt; ApiNetworkInfo
-&gt; ApiWalletMode
-&gt; ApiNetworkInformation
</span><a href="Cardano.Wallet.Api.Types.html#ApiNetworkInformation"><span class="hs-identifier hs-type">Api.ApiNetworkInformation</span></a></span><span>
</span><span id="line-3718"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:syncProgress:ApiNetworkInformation :: ApiT SyncProgress
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AsyncProgress%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.syncProgress</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyncProgress -&gt; ApiT SyncProgress
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SyncProgress
</span><a href="#local-6989586621682480674"><span class="hs-identifier hs-var">progress</span></a></span><span>
</span><span id="line-3719"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:nextEpoch:ApiNetworkInformation :: Maybe ApiEpochInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AnextEpoch%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.nextEpoch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiSlotReference, ApiEpochInfo) -&gt; ApiEpochInfo
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiSlotReference, ApiEpochInfo) -&gt; ApiEpochInfo)
-&gt; Maybe (ApiSlotReference, ApiEpochInfo) -&gt; Maybe ApiEpochInfo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiSlotReference, ApiEpochInfo)
</span><a href="#local-6989586621682480677"><span class="hs-identifier hs-var">nowInfo</span></a></span><span>
</span><span id="line-3720"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:nodeTip:ApiNetworkInformation :: ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AnodeTip%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.nodeTip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682480679"><span class="hs-identifier hs-var">apiNodeTip</span></a></span><span>
</span><span id="line-3721"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:networkTip:ApiNetworkInformation :: Maybe ApiSlotReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AnetworkTip%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.networkTip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiSlotReference, ApiEpochInfo) -&gt; ApiSlotReference
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiSlotReference, ApiEpochInfo) -&gt; ApiSlotReference)
-&gt; Maybe (ApiSlotReference, ApiEpochInfo) -&gt; Maybe ApiSlotReference
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiSlotReference, ApiEpochInfo)
</span><a href="#local-6989586621682480677"><span class="hs-identifier hs-var">nowInfo</span></a></span><span>
</span><span id="line-3722"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:nodeEra:ApiNetworkInformation :: ApiEra
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AnodeEra%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.nodeEra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra -&gt; ApiEra
</span><a href="Cardano.Wallet.Api.Types.html#toApiEra"><span class="hs-identifier hs-var">toApiEra</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480680"><span class="hs-identifier hs-var">nodeEra</span></a></span><span>
</span><span id="line-3723"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:networkInfo:ApiNetworkInformation :: ApiNetworkInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AnetworkInfo%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.networkInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3724"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; ApiNetworkInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiNetworkInfo"><span class="hs-identifier hs-var">Api.ApiNetworkInfo</span></a></span><span>
</span><span id="line-3725"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621682480692"><span class="hs-identifier hs-var">nid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3726"></span><span>                        </span><span class="annot"><span class="annottext">NetworkId
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.Mainnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;mainnet&quot;</span></span><span>
</span><span id="line-3727"></span><span>                        </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.Testnet</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkMagic
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;testnet&quot;</span></span><span>
</span><span id="line-3728"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-3729"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Integer) -&gt; Word32 -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkMagic -&gt; Word32
</span><a href="../../../../ouroboros-network/html/src"><span class="hs-identifier hs-var hs-var">unNetworkMagic</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkMagic -&gt; Word32) -&gt; NetworkMagic -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; NetworkMagic
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">toNetworkMagic</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621682480692"><span class="hs-identifier hs-var">nid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3730"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletMode:ApiNetworkInformation :: ApiWalletMode
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AwalletMode%3AApiNetworkInformation"><span class="hs-identifier hs-var">Api.walletMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletMode
</span><a href="#local-6989586621682480684"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-3731"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-3732"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3733"></span><span>    </span><span class="annot"><a href="#local-6989586621682480682"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3734"></span><span>    </span><span id="local-6989586621682480682"><span class="annot"><span class="annottext">ti :: TimeInterpreter (MaybeT IO)
</span><a href="#local-6989586621682480682"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. ExceptT PastHorizonException IO a -&gt; MaybeT IO a)
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter (MaybeT IO)
forall (m :: * -&gt; *) (n :: * -&gt; *).
(forall a. m a -&gt; n a) -&gt; TimeInterpreter m -&gt; TimeInterpreter n
</span><a href="Cardano.Wallet.Primitive.Slotting.html#hoistTimeInterpreter"><span class="hs-identifier hs-var">hoistTimeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ExceptT PastHorizonException IO a -&gt; MaybeT IO a
forall (m :: * -&gt; *) e a. Functor m =&gt; ExceptT e m a -&gt; MaybeT m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">exceptToMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480685"><span class="hs-identifier hs-var">timeInterpreter</span></a></span><span>
</span><span id="line-3735"></span><span>
</span><span id="line-3736"></span><span>    </span><span class="hs-comment">-- (network tip, next epoch)</span><span>
</span><span id="line-3737"></span><span>    </span><span class="hs-comment">-- May be unavailable if the node is still syncing.</span><span>
</span><span id="line-3738"></span><span>    </span><span class="annot"><a href="#local-6989586621682480675"><span class="hs-identifier hs-type">networkTipInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">RelativeTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSlotReference"><span class="hs-identifier hs-type">ApiSlotReference</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiEpochInfo"><span class="hs-identifier hs-type">ApiEpochInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3739"></span><span>    </span><span id="local-6989586621682480675"><span class="annot"><span class="annottext">networkTipInfo :: RelativeTime -&gt; MaybeT IO (ApiSlotReference, ApiEpochInfo)
</span><a href="#local-6989586621682480675"><span class="hs-identifier hs-var hs-var">networkTipInfo</span></a></span></span><span> </span><span id="local-6989586621682480661"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682480661"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3740"></span><span>        </span><span id="local-6989586621682480660"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480660"><span class="hs-identifier hs-var">networkTipSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO) -&gt; Qry SlotNo -&gt; MaybeT IO SlotNo
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO)
</span><a href="#local-6989586621682480682"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry SlotNo -&gt; MaybeT IO SlotNo) -&gt; Qry SlotNo -&gt; MaybeT IO SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime -&gt; Qry SlotNo
</span><a href="Cardano.Wallet.Primitive.Slotting.html#ongoingSlotAt"><span class="hs-identifier hs-var">ongoingSlotAt</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621682480661"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-3741"></span><span>        </span><span id="local-6989586621682480659"><span class="annot"><span class="annottext">ApiSlotReference
</span><a href="#local-6989586621682480659"><span class="hs-identifier hs-var">tip</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO) -&gt; SlotNo -&gt; MaybeT IO ApiSlotReference
forall (m :: * -&gt; *).
Monad m =&gt;
TimeInterpreter m -&gt; SlotNo -&gt; m ApiSlotReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiSlotReference"><span class="hs-identifier hs-var">makeApiSlotReference</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO)
</span><a href="#local-6989586621682480682"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480660"><span class="hs-identifier hs-var">networkTipSlot</span></a></span><span>
</span><span id="line-3742"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480657"><span class="annot"><span class="annottext">curEpoch :: EpochNo
</span><a href="#local-6989586621682480657"><span class="hs-identifier hs-var hs-var">curEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiSlotReference
</span><a href="#local-6989586621682480659"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSlotReference
-&gt; ((EpochNo -&gt; Const EpochNo EpochNo)
    -&gt; ApiSlotReference -&gt; Const EpochNo ApiSlotReference)
-&gt; EpochNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotId&quot;
  ((ApiSlotId -&gt; Const EpochNo ApiSlotId)
   -&gt; ApiSlotReference -&gt; Const EpochNo ApiSlotReference)
(ApiSlotId -&gt; Const EpochNo ApiSlotId)
-&gt; ApiSlotReference -&gt; Const EpochNo ApiSlotReference
</span><a href="#local-6989586621682480656"><span class="hs-var">#slotId</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiSlotId -&gt; Const EpochNo ApiSlotId)
 -&gt; ApiSlotReference -&gt; Const EpochNo ApiSlotReference)
-&gt; ((EpochNo -&gt; Const EpochNo EpochNo)
    -&gt; ApiSlotId -&gt; Const EpochNo ApiSlotId)
-&gt; (EpochNo -&gt; Const EpochNo EpochNo)
-&gt; ApiSlotReference
-&gt; Const EpochNo ApiSlotReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;epochNumber&quot;
  ((ApiT EpochNo -&gt; Const EpochNo (ApiT EpochNo))
   -&gt; ApiSlotId -&gt; Const EpochNo ApiSlotId)
(ApiT EpochNo -&gt; Const EpochNo (ApiT EpochNo))
-&gt; ApiSlotId -&gt; Const EpochNo ApiSlotId
</span><a href="#local-6989586621682480655"><span class="hs-var">#epochNumber</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT EpochNo -&gt; Const EpochNo (ApiT EpochNo))
 -&gt; ApiSlotId -&gt; Const EpochNo ApiSlotId)
-&gt; ((EpochNo -&gt; Const EpochNo EpochNo)
    -&gt; ApiT EpochNo -&gt; Const EpochNo (ApiT EpochNo))
-&gt; (EpochNo -&gt; Const EpochNo EpochNo)
-&gt; ApiSlotId
-&gt; Const EpochNo ApiSlotId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((EpochNo -&gt; Const EpochNo EpochNo)
   -&gt; ApiT EpochNo -&gt; Const EpochNo (ApiT EpochNo))
(EpochNo -&gt; Const EpochNo EpochNo)
-&gt; ApiT EpochNo -&gt; Const EpochNo (ApiT EpochNo)
</span><a href="#local-6989586621682480654"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-3743"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480653"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480653"><span class="hs-identifier hs-var">nextEpochStart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO)
-&gt; Qry (UTCTime, UTCTime) -&gt; MaybeT IO (UTCTime, UTCTime)
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (MaybeT IO)
</span><a href="#local-6989586621682480682"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry (UTCTime, UTCTime) -&gt; MaybeT IO (UTCTime, UTCTime))
-&gt; Qry (UTCTime, UTCTime) -&gt; MaybeT IO (UTCTime, UTCTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Qry (UTCTime, UTCTime)
</span><a href="Cardano.Wallet.Primitive.Slotting.html#timeOfEpoch"><span class="hs-identifier hs-var">timeOfEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682480657"><span class="hs-identifier hs-var">curEpoch</span></a></span><span>
</span><span id="line-3744"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480652"><span class="annot"><span class="annottext">nextEpoch :: ApiEpochInfo
</span><a href="#local-6989586621682480652"><span class="hs-identifier hs-var hs-var">nextEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT EpochNo -&gt; UTCTime -&gt; ApiEpochInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiEpochInfo"><span class="hs-identifier hs-var">ApiEpochInfo</span></a></span><span>
</span><span id="line-3745"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; ApiT EpochNo
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; ApiT EpochNo) -&gt; EpochNo -&gt; ApiT EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621682480657"><span class="hs-identifier hs-var">curEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3746"></span><span>                </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480653"><span class="hs-identifier hs-var">nextEpochStart</span></a></span><span>
</span><span id="line-3747"></span><span>        </span><span class="annot"><span class="annottext">(ApiSlotReference, ApiEpochInfo)
-&gt; MaybeT IO (ApiSlotReference, ApiEpochInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSlotReference
</span><a href="#local-6989586621682480659"><span class="hs-identifier hs-var">tip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiEpochInfo
</span><a href="#local-6989586621682480652"><span class="hs-identifier hs-var">nextEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3748"></span><span>
</span><span id="line-3749"></span><span id="local-6989586621682480650"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getNetworkParameters"><span class="hs-identifier hs-type">getNetworkParameters</span></a></span><span>
</span><span id="line-3750"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3751"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-3752"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480650"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">W.SealedTx</span></a></span><span>
</span><span id="line-3753"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNetworkParameters"><span class="hs-identifier hs-type">ApiNetworkParameters</span></a></span></span><span>
</span><span id="line-3754"></span><span id="getNetworkParameters"><span class="annot"><span class="annottext">getNetworkParameters :: (Block, NetworkParameters)
-&gt; NetworkLayer IO Block
-&gt; TransactionLayer k SealedTx
-&gt; Handler ApiNetworkParameters
</span><a href="Cardano.Wallet.Api.Server.html#getNetworkParameters"><span class="hs-identifier hs-var hs-var">getNetworkParameters</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480649"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621682480649"><span class="hs-identifier hs-var">_block0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480648"><span class="annot"><span class="annottext">NetworkParameters
</span><a href="#local-6989586621682480648"><span class="hs-identifier hs-var">genesisNp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480647"><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480647"><span class="hs-identifier hs-var">nl</span></a></span></span><span> </span><span id="local-6989586621682480646"><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682480646"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3755"></span><span>    </span><span id="local-6989586621682480645"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480645"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProtocolParameters -&gt; Handler ProtocolParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ProtocolParameters -&gt; Handler ProtocolParameters)
-&gt; IO ProtocolParameters -&gt; Handler ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO ProtocolParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m ProtocolParameters
</span><a href="Cardano.Wallet.Network.html#currentProtocolParameters"><span class="hs-identifier hs-var hs-var">NW.currentProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480647"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3756"></span><span>    </span><span id="local-6989586621682480644"><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682480644"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SlottingParameters -&gt; Handler SlottingParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SlottingParameters -&gt; Handler SlottingParameters)
-&gt; IO SlottingParameters -&gt; Handler SlottingParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO SlottingParameters
forall (m :: * -&gt; *) block.
NetworkLayer m block -&gt; m SlottingParameters
</span><a href="Cardano.Wallet.Network.html#currentSlottingParameters"><span class="hs-identifier hs-var hs-var">NW.currentSlottingParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480647"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3757"></span><span>    </span><span id="local-6989586621682480642"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480642"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480647"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-3758"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480641"><span class="annot"><span class="annottext">np :: NetworkParameters
</span><a href="#local-6989586621682480641"><span class="hs-identifier hs-var hs-var">np</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkParameters
</span><a href="#local-6989586621682480648"><span class="hs-identifier hs-var">genesisNp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:protocolParameters:NetworkParameters :: ProtocolParameters
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AprotocolParameters%3ANetworkParameters"><span class="hs-identifier hs-var">protocolParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480645"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slottingParameters:NetworkParameters :: SlottingParameters
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AslottingParameters%3ANetworkParameters"><span class="hs-identifier hs-var">slottingParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlottingParameters
</span><a href="#local-6989586621682480644"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3759"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480638"><span class="annot"><span class="annottext">txConstraints :: TxConstraints
</span><a href="#local-6989586621682480638"><span class="hs-identifier hs-var hs-var">txConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
forall (k :: Depth -&gt; * -&gt; *) tx.
TransactionLayer k tx
-&gt; AnyCardanoEra -&gt; ProtocolParameters -&gt; TxConstraints
</span><a href="Cardano.Wallet.Transaction.html#%24sel%3Aconstraints%3ATransactionLayer"><span class="hs-identifier hs-var hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682480646"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480642"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621682480645"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-3760"></span><span>    </span><span class="annot"><span class="annottext">IO ApiNetworkParameters -&gt; Handler ApiNetworkParameters
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiNetworkParameters -&gt; Handler ApiNetworkParameters)
-&gt; IO ApiNetworkParameters -&gt; Handler ApiNetworkParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkParameters
-&gt; TxConstraints
-&gt; (EpochNo -&gt; IO ApiEpochInfo)
-&gt; IO ApiNetworkParameters
forall (m :: * -&gt; *).
Monad m =&gt;
NetworkParameters
-&gt; TxConstraints
-&gt; (EpochNo -&gt; m ApiEpochInfo)
-&gt; m ApiNetworkParameters
</span><a href="Cardano.Wallet.Api.Types.html#toApiNetworkParameters"><span class="hs-identifier hs-var">toApiNetworkParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkParameters
</span><a href="#local-6989586621682480641"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints
</span><a href="#local-6989586621682480638"><span class="hs-identifier hs-var">txConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; Qry ApiEpochInfo -&gt; IO ApiEpochInfo
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO
</span><a href="#local-6989586621682480636"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry ApiEpochInfo -&gt; IO ApiEpochInfo)
-&gt; (EpochNo -&gt; Qry ApiEpochInfo) -&gt; EpochNo -&gt; IO ApiEpochInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Qry ApiEpochInfo
</span><a href="Cardano.Wallet.Api.Types.html#toApiEpochInfo"><span class="hs-identifier hs-var">toApiEpochInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3761"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3762"></span><span>    </span><span class="annot"><a href="#local-6989586621682480636"><span class="hs-identifier hs-type">ti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-3763"></span><span>    </span><span id="local-6989586621682480636"><span class="annot"><span class="annottext">ti :: TimeInterpreter IO
</span><a href="#local-6989586621682480636"><span class="hs-identifier hs-var hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier hs-var">neverFails</span></a></span><span>
</span><span id="line-3764"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PastHorizonException should never happen in getNetworkParameters \
        \because the ledger is being queried for slotting info about its own \
        \tip.&quot;</span></span><span>
</span><span id="line-3767"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkLayer IO Block
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
forall (m :: * -&gt; *) block.
NetworkLayer m block
-&gt; TimeInterpreter (ExceptT PastHorizonException m)
</span><a href="Cardano.Wallet.Network.html#timeInterpreter"><span class="hs-identifier hs-var hs-var">timeInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480647"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3768"></span><span>
</span><span id="line-3769"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getNetworkClock"><span class="hs-identifier hs-type">getNetworkClock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ntp-client/html/src"><span class="hs-identifier hs-type">NtpClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiNetworkClock"><span class="hs-identifier hs-type">ApiNetworkClock</span></a></span><span>
</span><span id="line-3770"></span><span id="getNetworkClock"><span class="annot"><span class="annottext">getNetworkClock :: NtpClient -&gt; Bool -&gt; Handler ApiNetworkClock
</span><a href="Cardano.Wallet.Api.Server.html#getNetworkClock"><span class="hs-identifier hs-var hs-var">getNetworkClock</span></a></span></span><span> </span><span id="local-6989586621682480635"><span class="annot"><span class="annottext">NtpClient
</span><a href="#local-6989586621682480635"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ApiNetworkClock -&gt; Handler ApiNetworkClock
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ApiNetworkClock -&gt; Handler ApiNetworkClock)
-&gt; (Bool -&gt; IO ApiNetworkClock) -&gt; Bool -&gt; Handler ApiNetworkClock
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NtpClient -&gt; Bool -&gt; IO ApiNetworkClock
</span><a href="Network.Ntp.html#getNtpStatus"><span class="hs-identifier hs-var">getNtpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">NtpClient
</span><a href="#local-6989586621682480635"><span class="hs-identifier hs-var">client</span></a></span><span>
</span><span id="line-3771"></span><span>
</span><span id="line-3772"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                               Miscellaneous
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3775"></span><span>
</span><span id="line-3776"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postExternalTransaction"><span class="hs-identifier hs-type">postExternalTransaction</span></a></span><span>
</span><span id="line-3777"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480634"><span class="annot"><a href="#local-6989586621682480634"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480633"><span class="annot"><a href="#local-6989586621682480633"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480632"><span class="annot"><a href="#local-6989586621682480632"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3778"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480634"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480633"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480632"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3779"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3780"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480634"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3781"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">W.SealedTx</span></a></span><span>
</span><span id="line-3782"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span>
</span><span id="line-3783"></span><span id="postExternalTransaction"><span class="annot"><span class="annottext">postExternalTransaction :: ctx -&gt; ApiT SealedTx -&gt; Handler ApiTxId
</span><a href="Cardano.Wallet.Api.Server.html#postExternalTransaction"><span class="hs-identifier hs-var hs-var">postExternalTransaction</span></a></span></span><span> </span><span id="local-6989586621682480631"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480631"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480630"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480630"><span class="hs-identifier hs-var">sealed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3784"></span><span>    </span><span id="local-6989586621682480629"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480629"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrPostTx IO Tx -&gt; Handler Tx
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrPostTx IO Tx -&gt; Handler Tx)
-&gt; ExceptT ErrPostTx IO Tx -&gt; Handler Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ctx -&gt; SealedTx -&gt; ExceptT ErrPostTx IO Tx
forall ctx (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasTransactionLayer k ctx,
 HasLogger IO TxSubmitLog ctx) =&gt;
ctx -&gt; SealedTx -&gt; ExceptT ErrPostTx IO Tx
</span><a href="Cardano.Wallet.html#submitExternalTx"><span class="hs-identifier hs-var">W.submitExternalTx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480634"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480632"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480631"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682480630"><span class="hs-identifier hs-var">sealed</span></a></span><span>
</span><span id="line-3785"></span><span>    </span><span class="annot"><span class="annottext">ApiTxId -&gt; Handler ApiTxId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxId -&gt; Handler ApiTxId) -&gt; ApiTxId -&gt; Handler ApiTxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="Cardano.Wallet.Api.Types.html#ApiTxId"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682480629"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682480627"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3786"></span><span>
</span><span id="line-3787"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#signMetadata"><span class="hs-identifier hs-type">signMetadata</span></a></span><span>
</span><span id="line-3788"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480626"><span class="annot"><a href="#local-6989586621682480626"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480625"><span class="annot"><a href="#local-6989586621682480625"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480624"><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682480623"><span class="annot"><a href="#local-6989586621682480623"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3789"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480626"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480625"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3790"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480625"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480623"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3791"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3792"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span>
</span><span id="line-3793"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3794"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3795"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480626"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3796"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3797"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-3798"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3799"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletSignData"><span class="hs-identifier hs-type">ApiWalletSignData</span></a></span><span>
</span><span id="line-3800"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-3801"></span><span id="signMetadata"><span class="annot"><span class="annottext">signMetadata :: ctx
-&gt; ApiT WalletId
-&gt; ApiT Role
-&gt; ApiT DerivationIndex
-&gt; ApiWalletSignData
-&gt; Handler ByteString
</span><a href="Cardano.Wallet.Api.Server.html#signMetadata"><span class="hs-identifier hs-var hs-var">signMetadata</span></a></span></span><span> </span><span id="local-6989586621682480622"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480622"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480621"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480621"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480620"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682480620"><span class="hs-identifier hs-var">role_</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480619"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682480619"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480618"><span class="annot"><span class="annottext">ApiWalletSignData
</span><a href="#local-6989586621682480618"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3802"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480617"><span class="annot"><span class="annottext">meta :: TxMetadata
</span><a href="#local-6989586621682480617"><span class="hs-identifier hs-var hs-var">meta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletSignData
</span><a href="#local-6989586621682480618"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletSignData
-&gt; ((TxMetadata -&gt; Const TxMetadata TxMetadata)
    -&gt; ApiWalletSignData -&gt; Const TxMetadata ApiWalletSignData)
-&gt; TxMetadata
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiT TxMetadata -&gt; Const TxMetadata (ApiT TxMetadata))
   -&gt; ApiWalletSignData -&gt; Const TxMetadata ApiWalletSignData)
(ApiT TxMetadata -&gt; Const TxMetadata (ApiT TxMetadata))
-&gt; ApiWalletSignData -&gt; Const TxMetadata ApiWalletSignData
</span><a href="#local-6989586621682480616"><span class="hs-var">#metadata</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxMetadata -&gt; Const TxMetadata (ApiT TxMetadata))
 -&gt; ApiWalletSignData -&gt; Const TxMetadata ApiWalletSignData)
-&gt; ((TxMetadata -&gt; Const TxMetadata TxMetadata)
    -&gt; ApiT TxMetadata -&gt; Const TxMetadata (ApiT TxMetadata))
-&gt; (TxMetadata -&gt; Const TxMetadata TxMetadata)
-&gt; ApiWalletSignData
-&gt; Const TxMetadata ApiWalletSignData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxMetadata -&gt; Const TxMetadata TxMetadata)
   -&gt; ApiT TxMetadata -&gt; Const TxMetadata (ApiT TxMetadata))
(TxMetadata -&gt; Const TxMetadata TxMetadata)
-&gt; ApiT TxMetadata -&gt; Const TxMetadata (ApiT TxMetadata)
</span><a href="#local-6989586621682480615"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-3803"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480614"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;lenient&quot;
</span><a href="#local-6989586621682480614"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletSignData
</span><a href="#local-6989586621682480618"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletSignData
-&gt; ((Passphrase &quot;lenient&quot;
     -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
    -&gt; ApiWalletSignData
    -&gt; Const (Passphrase &quot;lenient&quot;) ApiWalletSignData)
-&gt; Passphrase &quot;lenient&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
   -&gt; ApiWalletSignData
   -&gt; Const (Passphrase &quot;lenient&quot;) ApiWalletSignData)
(ApiT (Passphrase &quot;lenient&quot;)
 -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; ApiWalletSignData
-&gt; Const (Passphrase &quot;lenient&quot;) ApiWalletSignData
</span><a href="#local-6989586621682480613"><span class="hs-var">#passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Passphrase &quot;lenient&quot;)
  -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
 -&gt; ApiWalletSignData
 -&gt; Const (Passphrase &quot;lenient&quot;) ApiWalletSignData)
-&gt; ((Passphrase &quot;lenient&quot;
     -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
    -&gt; ApiT (Passphrase &quot;lenient&quot;)
    -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
-&gt; (Passphrase &quot;lenient&quot;
    -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
-&gt; ApiWalletSignData
-&gt; Const (Passphrase &quot;lenient&quot;) ApiWalletSignData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Passphrase &quot;lenient&quot;
    -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
   -&gt; ApiT (Passphrase &quot;lenient&quot;)
   -&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;)))
(Passphrase &quot;lenient&quot;
 -&gt; Const (Passphrase &quot;lenient&quot;) (Passphrase &quot;lenient&quot;))
-&gt; ApiT (Passphrase &quot;lenient&quot;)
-&gt; Const (Passphrase &quot;lenient&quot;) (ApiT (Passphrase &quot;lenient&quot;))
</span><a href="#local-6989586621682480612"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-3804"></span><span>
</span><span id="line-3805"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ByteString)
-&gt; (ErrWalletNotResponding -&gt; Handler ByteString)
-&gt; (WorkerCtx ctx -&gt; Handler ByteString)
-&gt; Handler ByteString
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480625"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480622"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480621"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ByteString
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ByteString
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ByteString) -&gt; Handler ByteString)
-&gt; (WorkerCtx ctx -&gt; Handler ByteString) -&gt; Handler ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480611"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480611"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignMetadataWith IO ByteString -&gt; Handler ByteString
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSignMetadataWith IO ByteString -&gt; Handler ByteString)
-&gt; ExceptT ErrSignMetadataWith IO ByteString -&gt; Handler ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3806"></span><span>        </span><span class="annot"><span class="annottext">Signature TxMetadata -&gt; ByteString
forall what. Signature what -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.Types.html#%24sel%3AgetSignature%3ASignature"><span class="hs-identifier hs-var hs-var">getSignature</span></a></span><span> </span><span class="annot"><span class="annottext">(Signature TxMetadata -&gt; ByteString)
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
-&gt; ExceptT ErrSignMetadataWith IO ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (Role, DerivationIndex)
-&gt; TxMetadata
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant).
(HasDBLayer IO s k ctx, HardDerivation k,
 AddressIndexDerivationType k ~ 'Soft, WalletKey k,
 s ~ SeqState n k) =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (Role, DerivationIndex)
-&gt; TxMetadata
-&gt; ExceptT ErrSignMetadataWith IO (Signature TxMetadata)
</span><a href="Cardano.Wallet.html#signMetadataWith"><span class="hs-identifier hs-var">W.signMetadataWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480625"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480624"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480623"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3807"></span><span>            </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n k) k
WorkerCtx ctx
</span><a href="#local-6989586621682480611"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480621"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot; -&gt; Passphrase &quot;user&quot;
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;lenient&quot;
</span><a href="#local-6989586621682480614"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682480620"><span class="hs-identifier hs-var">role_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682480619"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621682480617"><span class="hs-identifier hs-var">meta</span></a></span><span>
</span><span id="line-3808"></span><span>
</span><span id="line-3809"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#derivePublicKey"><span class="hs-identifier hs-type">derivePublicKey</span></a></span><span>
</span><span id="line-3810"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480608"><span class="annot"><a href="#local-6989586621682480608"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480607"><span class="annot"><a href="#local-6989586621682480607"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480606"><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682480605"><span class="annot"><a href="#local-6989586621682480605"><span class="hs-identifier hs-type">ver</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3811"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480608"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480607"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3812"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3813"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3814"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier hs-type">GetAccount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480607"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3815"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3816"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480608"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3817"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#VerificationKeyHashing"><span class="hs-identifier hs-type">VerificationKeyHashing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480605"><span class="hs-identifier hs-type">ver</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3818"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3819"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-3820"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3821"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-3822"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480605"><span class="hs-identifier hs-type">ver</span></a></span><span>
</span><span id="line-3823"></span><span id="derivePublicKey"><span class="annot"><span class="annottext">derivePublicKey :: ctx
-&gt; ((ByteString, Role) -&gt; VerificationKeyHashing -&gt; ver)
-&gt; ApiT WalletId
-&gt; ApiT Role
-&gt; ApiT DerivationIndex
-&gt; Maybe Bool
-&gt; Handler ver
</span><a href="Cardano.Wallet.Api.Server.html#derivePublicKey"><span class="hs-identifier hs-var hs-var">derivePublicKey</span></a></span></span><span> </span><span id="local-6989586621682480604"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480604"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480603"><span class="annot"><span class="annottext">(ByteString, Role) -&gt; VerificationKeyHashing -&gt; ver
</span><a href="#local-6989586621682480603"><span class="hs-identifier hs-var">mkVer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480602"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480602"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480601"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682480601"><span class="hs-identifier hs-var">role_</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480600"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682480600"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480599"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480599"><span class="hs-identifier hs-var">hashed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3824"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ver)
-&gt; (ErrWalletNotResponding -&gt; Handler ver)
-&gt; (WorkerCtx ctx -&gt; Handler ver)
-&gt; Handler ver
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480607"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480604"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480602"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ver
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ver
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ver) -&gt; Handler ver)
-&gt; (WorkerCtx ctx -&gt; Handler ver) -&gt; Handler ver
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480598"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480598"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3825"></span><span>        </span><span id="local-6989586621682480597"><span class="annot"><span class="annottext">k 'AddressK XPub
</span><a href="#local-6989586621682480597"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
-&gt; Handler (k 'AddressK XPub)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
 -&gt; Handler (k 'AddressK XPub))
-&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
-&gt; Handler (k 'AddressK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; Role
-&gt; DerivationIndex
-&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, SoftDerivation k, GetAccount s k) =&gt;
ctx
-&gt; WalletId
-&gt; Role
-&gt; DerivationIndex
-&gt; ExceptT ErrDerivePublicKey IO (k 'AddressK XPub)
</span><a href="Cardano.Wallet.html#derivePublicKey"><span class="hs-identifier hs-var">W.derivePublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480607"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480606"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480598"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480602"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682480601"><span class="hs-identifier hs-var">role_</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682480600"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-3826"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480595"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480595"><span class="hs-identifier hs-var">payload</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480594"><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="#local-6989586621682480594"><span class="hs-identifier hs-var">hashing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; XPub -&gt; (ByteString, VerificationKeyHashing)
</span><a href="Cardano.Wallet.Api.Server.html#computeKeyPayload"><span class="hs-identifier hs-var">computeKeyPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480599"><span class="hs-identifier hs-var">hashed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'AddressK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AddressK XPub
</span><a href="#local-6989586621682480597"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3827"></span><span>        </span><span class="annot"><span class="annottext">ver -&gt; Handler ver
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ver -&gt; Handler ver) -&gt; ver -&gt; Handler ver
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Role) -&gt; VerificationKeyHashing -&gt; ver
</span><a href="#local-6989586621682480603"><span class="hs-identifier hs-var">mkVer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480595"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682480601"><span class="hs-identifier hs-var">role_</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="#local-6989586621682480594"><span class="hs-identifier hs-var">hashing</span></a></span><span>
</span><span id="line-3828"></span><span>
</span><span id="line-3829"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#computeKeyPayload"><span class="hs-identifier hs-type">computeKeyPayload</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#VerificationKeyHashing"><span class="hs-identifier hs-type">VerificationKeyHashing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3830"></span><span id="computeKeyPayload"><span class="annot"><span class="annottext">computeKeyPayload :: Maybe Bool -&gt; XPub -&gt; (ByteString, VerificationKeyHashing)
</span><a href="Cardano.Wallet.Api.Server.html#computeKeyPayload"><span class="hs-identifier hs-var hs-var">computeKeyPayload</span></a></span></span><span> </span><span id="local-6989586621682480593"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480593"><span class="hs-identifier hs-var">hashed</span></a></span></span><span> </span><span id="local-6989586621682480592"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480592"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="#local-6989586621682480591"><span class="hs-identifier hs-var">hashing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3831"></span><span>    </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithoutHashing"><span class="hs-identifier hs-var">WithoutHashing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">xpubPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480592"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithoutHashing"><span class="hs-identifier hs-var">WithoutHashing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3832"></span><span>    </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithHashing"><span class="hs-identifier hs-var">WithHashing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall a. ByteArrayAccess a =&gt; a -&gt; ByteString
</span><a href="Crypto.Hash.Utils.html#blake2b224"><span class="hs-identifier hs-var">blake2b224</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">xpubPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480592"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithHashing"><span class="hs-identifier hs-var">WithHashing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3833"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3834"></span><span>    </span><span id="local-6989586621682480591"><span class="annot"><span class="annottext">hashing :: VerificationKeyHashing
</span><a href="#local-6989586621682480591"><span class="hs-identifier hs-var hs-var">hashing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480593"><span class="hs-identifier hs-var">hashed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3835"></span><span>        </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithoutHashing"><span class="hs-identifier hs-var">WithoutHashing</span></a></span><span>
</span><span id="line-3836"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682480588"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682480588"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682480588"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithHashing"><span class="hs-identifier hs-var">WithHashing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">VerificationKeyHashing
</span><a href="Cardano.Wallet.Api.Types.html#WithoutHashing"><span class="hs-identifier hs-var">WithoutHashing</span></a></span><span>
</span><span id="line-3837"></span><span>
</span><span id="line-3838"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postAccountPublicKey"><span class="hs-identifier hs-type">postAccountPublicKey</span></a></span><span>
</span><span id="line-3839"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480587"><span class="annot"><a href="#local-6989586621682480587"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480586"><span class="annot"><a href="#local-6989586621682480586"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480585"><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682480584"><span class="annot"><a href="#local-6989586621682480584"><span class="hs-identifier hs-type">account</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3840"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480587"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480586"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3841"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3842"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier hs-type">GetPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3843"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3844"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480587"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3845"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KeyFormat"><span class="hs-identifier hs-type">KeyFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PurposeK"><span class="hs-identifier hs-type">PurposeK</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480584"><span class="hs-identifier hs-type">account</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3846"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3847"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-3848"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostAccountKeyDataWithPurpose"><span class="hs-identifier hs-type">ApiPostAccountKeyDataWithPurpose</span></a></span><span>
</span><span id="line-3849"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480584"><span class="hs-identifier hs-type">account</span></a></span><span>
</span><span id="line-3850"></span><span id="postAccountPublicKey"><span class="annot"><span class="annottext">postAccountPublicKey :: ctx
-&gt; (ByteString
    -&gt; KeyFormat -&gt; Index 'Hardened 'PurposeK -&gt; account)
-&gt; ApiT WalletId
-&gt; ApiT DerivationIndex
-&gt; ApiPostAccountKeyDataWithPurpose
-&gt; Handler account
</span><a href="Cardano.Wallet.Api.Server.html#postAccountPublicKey"><span class="hs-identifier hs-var hs-var">postAccountPublicKey</span></a></span></span><span> </span><span id="local-6989586621682480583"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480583"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480582"><span class="annot"><span class="annottext">ByteString -&gt; KeyFormat -&gt; Index 'Hardened 'PurposeK -&gt; account
</span><a href="#local-6989586621682480582"><span class="hs-identifier hs-var">mkAccount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480581"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480581"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480580"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682480580"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostAccountKeyDataWithPurpose"><span class="hs-identifier hs-type">ApiPostAccountKeyDataWithPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480578"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480578"><span class="hs-identifier hs-var">pwd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480577"><span class="annot"><span class="annottext">KeyFormat
</span><a href="#local-6989586621682480577"><span class="hs-identifier hs-var">extd</span></a></span></span><span> </span><span id="local-6989586621682480576"><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
</span><a href="#local-6989586621682480576"><span class="hs-identifier hs-var">purposeM</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3851"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler account)
-&gt; (ErrWalletNotResponding -&gt; Handler account)
-&gt; (WorkerCtx ctx -&gt; Handler account)
-&gt; Handler account
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480586"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480583"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480581"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler account
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler account
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler account) -&gt; Handler account)
-&gt; (WorkerCtx ctx -&gt; Handler account) -&gt; Handler account
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480575"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480575"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3852"></span><span>        </span><span id="local-6989586621682480574"><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682480574"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
-&gt; Handler (k 'AccountK XPub)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
 -&gt; Handler (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
-&gt; Handler (k 'AccountK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; DerivationIndex
-&gt; Maybe DerivationIndex
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, WalletKey k, GetPurpose k) =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; DerivationIndex
-&gt; Maybe DerivationIndex
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
</span><a href="Cardano.Wallet.html#getAccountPublicKeyAtIndex"><span class="hs-identifier hs-var">W.getAccountPublicKeyAtIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480586"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480575"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480581"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480578"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682480580"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; DerivationIndex
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT DerivationIndex -&gt; DerivationIndex)
-&gt; Maybe (ApiT DerivationIndex) -&gt; Maybe DerivationIndex
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
</span><a href="#local-6989586621682480576"><span class="hs-identifier hs-var">purposeM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3853"></span><span>        </span><span class="annot"><span class="annottext">account -&gt; Handler account
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(account -&gt; Handler account) -&gt; account -&gt; Handler account
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; KeyFormat -&gt; Index 'Hardened 'PurposeK -&gt; account
</span><a href="#local-6989586621682480582"><span class="hs-identifier hs-var">mkAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyFormat -&gt; XPub -&gt; ByteString
</span><a href="Cardano.Wallet.Api.Server.html#publicKeyToBytes%27"><span class="hs-identifier hs-var">publicKeyToBytes'</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="#local-6989586621682480577"><span class="hs-identifier hs-var">extd</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ByteString) -&gt; XPub -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682480574"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="#local-6989586621682480577"><span class="hs-identifier hs-var">extd</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="#local-6989586621682480571"><span class="hs-identifier hs-var">ixPurpose'</span></a></span><span>
</span><span id="line-3854"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3855"></span><span>    </span><span id="local-6989586621682480571"><span class="annot"><span class="annottext">ixPurpose' :: Index 'Hardened 'PurposeK
</span><a href="#local-6989586621682480571"><span class="hs-identifier hs-var hs-var">ixPurpose'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3856"></span><span>        </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; (ApiT DerivationIndex -&gt; Index 'Hardened 'PurposeK)
-&gt; Maybe (ApiT DerivationIndex)
-&gt; Index 'Hardened 'PurposeK
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetPurpose k =&gt; Index 'Hardened 'PurposeK
forall (key :: Depth -&gt; * -&gt; *).
GetPurpose key =&gt;
Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getPurpose"><span class="hs-identifier hs-var">getPurpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480585"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Index 'Hardened 'PurposeK
forall (derivationType :: DerivationType) (level :: Depth).
Word32 -&gt; Index derivationType level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Index 'Hardened 'PurposeK)
-&gt; (ApiT DerivationIndex -&gt; Word32)
-&gt; ApiT DerivationIndex
-&gt; Index 'Hardened 'PurposeK
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; Word32
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getDerivationIndex"><span class="hs-identifier hs-var hs-var">getDerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; Word32)
-&gt; (ApiT DerivationIndex -&gt; DerivationIndex)
-&gt; ApiT DerivationIndex
-&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; DerivationIndex
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
</span><a href="#local-6989586621682480576"><span class="hs-identifier hs-var">purposeM</span></a></span><span>
</span><span id="line-3857"></span><span>
</span><span id="line-3858"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#publicKeyToBytes%27"><span class="hs-identifier hs-type">publicKeyToBytes'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KeyFormat"><span class="hs-identifier hs-type">KeyFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-3859"></span><span id="publicKeyToBytes%27"><span class="annot"><span class="annottext">publicKeyToBytes' :: KeyFormat -&gt; XPub -&gt; ByteString
</span><a href="Cardano.Wallet.Api.Server.html#publicKeyToBytes%27"><span class="hs-identifier hs-var hs-var">publicKeyToBytes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3860"></span><span>    </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="Cardano.Wallet.Api.Types.html#Extended"><span class="hs-identifier hs-var">Extended</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">xpubToBytes</span></a></span><span>
</span><span id="line-3861"></span><span>    </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="Cardano.Wallet.Api.Types.html#NonExtended"><span class="hs-identifier hs-var">NonExtended</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">xpubPublicKey</span></a></span><span>
</span><span id="line-3862"></span><span>
</span><span id="line-3863"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getAccountPublicKey"><span class="hs-identifier hs-type">getAccountPublicKey</span></a></span><span>
</span><span id="line-3864"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480567"><span class="annot"><a href="#local-6989586621682480567"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480566"><span class="annot"><a href="#local-6989586621682480566"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480565"><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682480564"><span class="annot"><a href="#local-6989586621682480564"><span class="hs-identifier hs-type">account</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3865"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480567"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480566"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3866"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetAccount"><span class="hs-identifier hs-type">GetAccount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480566"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3867"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3868"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier hs-type">GetPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3869"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3870"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480567"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3871"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KeyFormat"><span class="hs-identifier hs-type">KeyFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PurposeK"><span class="hs-identifier hs-type">PurposeK</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480564"><span class="hs-identifier hs-type">account</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3872"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3873"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#KeyFormat"><span class="hs-identifier hs-type">KeyFormat</span></a></span><span>
</span><span id="line-3874"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480564"><span class="hs-identifier hs-type">account</span></a></span><span>
</span><span id="line-3875"></span><span id="getAccountPublicKey"><span class="annot"><span class="annottext">getAccountPublicKey :: ctx
-&gt; (ByteString
    -&gt; KeyFormat -&gt; Index 'Hardened 'PurposeK -&gt; account)
-&gt; ApiT WalletId
-&gt; Maybe KeyFormat
-&gt; Handler account
</span><a href="Cardano.Wallet.Api.Server.html#getAccountPublicKey"><span class="hs-identifier hs-var hs-var">getAccountPublicKey</span></a></span></span><span> </span><span id="local-6989586621682480563"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480563"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480562"><span class="annot"><span class="annottext">ByteString -&gt; KeyFormat -&gt; Index 'Hardened 'PurposeK -&gt; account
</span><a href="#local-6989586621682480562"><span class="hs-identifier hs-var">mkAccount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480561"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480561"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480560"><span class="annot"><span class="annottext">Maybe KeyFormat
</span><a href="#local-6989586621682480560"><span class="hs-identifier hs-var">extended</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3876"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler account)
-&gt; (ErrWalletNotResponding -&gt; Handler account)
-&gt; (WorkerCtx ctx -&gt; Handler account)
-&gt; Handler account
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480566"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480563"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480561"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler account
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler account
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler account) -&gt; Handler account)
-&gt; (WorkerCtx ctx -&gt; Handler account) -&gt; Handler account
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480559"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480559"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3877"></span><span>        </span><span id="local-6989586621682480558"><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682480558"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
-&gt; Handler (k 'AccountK XPub)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
 -&gt; Handler (k 'AccountK XPub))
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
-&gt; Handler (k 'AccountK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasDBLayer IO s k ctx, GetAccount s k) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT ErrReadAccountPublicKey IO (k 'AccountK XPub)
</span><a href="Cardano.Wallet.html#readAccountPublicKey"><span class="hs-identifier hs-var">W.readAccountPublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480566"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480559"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480561"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3878"></span><span>        </span><span class="annot"><span class="annottext">account -&gt; Handler account
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(account -&gt; Handler account) -&gt; account -&gt; Handler account
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; KeyFormat -&gt; Index 'Hardened 'PurposeK -&gt; account
</span><a href="#local-6989586621682480562"><span class="hs-identifier hs-var">mkAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyFormat -&gt; XPub -&gt; ByteString
</span><a href="Cardano.Wallet.Api.Server.html#publicKeyToBytes%27"><span class="hs-identifier hs-var">publicKeyToBytes'</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="#local-6989586621682480557"><span class="hs-identifier hs-var">extd</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ByteString) -&gt; XPub -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">k 'AccountK XPub
</span><a href="#local-6989586621682480558"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="#local-6989586621682480557"><span class="hs-identifier hs-var">extd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetPurpose k =&gt; Index 'Hardened 'PurposeK
forall (key :: Depth -&gt; * -&gt; *).
GetPurpose key =&gt;
Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getPurpose"><span class="hs-identifier hs-var">getPurpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480565"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3879"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3880"></span><span>      </span><span id="local-6989586621682480557"><span class="annot"><span class="annottext">extd :: KeyFormat
</span><a href="#local-6989586621682480557"><span class="hs-identifier hs-var hs-var">extd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe KeyFormat
</span><a href="#local-6989586621682480560"><span class="hs-identifier hs-var">extended</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3881"></span><span>          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="Cardano.Wallet.Api.Types.html#Extended"><span class="hs-identifier hs-var">Extended</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="Cardano.Wallet.Api.Types.html#Extended"><span class="hs-identifier hs-var">Extended</span></a></span><span>
</span><span id="line-3882"></span><span>          </span><span class="annot"><span class="annottext">Maybe KeyFormat
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeyFormat
</span><a href="Cardano.Wallet.Api.Types.html#NonExtended"><span class="hs-identifier hs-var">NonExtended</span></a></span><span>
</span><span id="line-3883"></span><span>
</span><span id="line-3884"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getPolicyKey"><span class="hs-identifier hs-type">getPolicyKey</span></a></span><span>
</span><span id="line-3885"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480556"><span class="annot"><a href="#local-6989586621682480556"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480555"><span class="annot"><a href="#local-6989586621682480555"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480554"><span class="annot"><a href="#local-6989586621682480554"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480553"><span class="annot"><a href="#local-6989586621682480553"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-3886"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480556"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480555"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480554"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3887"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480555"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3888"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480553"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3889"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3890"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480556"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3891"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3892"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-3893"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPolicyKey"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span>
</span><span id="line-3894"></span><span id="getPolicyKey"><span class="annot"><span class="annottext">getPolicyKey :: ctx -&gt; ApiT WalletId -&gt; Maybe Bool -&gt; Handler ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Server.html#getPolicyKey"><span class="hs-identifier hs-var hs-var">getPolicyKey</span></a></span></span><span> </span><span id="local-6989586621682480552"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480552"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480551"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480551"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480550"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480550"><span class="hs-identifier hs-var">hashed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3895"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ApiPolicyKey)
-&gt; (ErrWalletNotResponding -&gt; Handler ApiPolicyKey)
-&gt; (WorkerCtx ctx -&gt; Handler ApiPolicyKey)
-&gt; Handler ApiPolicyKey
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480555"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480554"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480552"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480551"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ApiPolicyKey
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ApiPolicyKey
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ApiPolicyKey) -&gt; Handler ApiPolicyKey)
-&gt; (WorkerCtx ctx -&gt; Handler ApiPolicyKey) -&gt; Handler ApiPolicyKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480549"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480549"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3896"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480548"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480548"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
 -&gt; Handler (XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier hs-var">W.readPolicyPublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480555"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480554"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480553"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480549"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480551"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3897"></span><span>        </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Handler ApiPolicyKey
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiPolicyKey -&gt; Handler ApiPolicyKey)
-&gt; ApiPolicyKey -&gt; Handler ApiPolicyKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; VerificationKeyHashing -&gt; ApiPolicyKey)
-&gt; (ByteString, VerificationKeyHashing) -&gt; ApiPolicyKey
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; VerificationKeyHashing -&gt; ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Types.html#ApiPolicyKey"><span class="hs-identifier hs-var">ApiPolicyKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Bool -&gt; XPub -&gt; (ByteString, VerificationKeyHashing)
</span><a href="Cardano.Wallet.Api.Server.html#computeKeyPayload"><span class="hs-identifier hs-var">computeKeyPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480550"><span class="hs-identifier hs-var">hashed</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480548"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3898"></span><span>
</span><span id="line-3899"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postPolicyKey"><span class="hs-identifier hs-type">postPolicyKey</span></a></span><span>
</span><span id="line-3900"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480547"><span class="annot"><a href="#local-6989586621682480547"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480546"><span class="annot"><a href="#local-6989586621682480546"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480545"><span class="annot"><a href="#local-6989586621682480545"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-3901"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480547"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480546"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-3902"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480546"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480545"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-3903"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3904"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480547"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3905"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3906"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-3907"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostPolicyKeyData"><span class="hs-identifier hs-type">ApiPostPolicyKeyData</span></a></span><span>
</span><span id="line-3908"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPolicyKey"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span>
</span><span id="line-3909"></span><span id="postPolicyKey"><span class="annot"><span class="annottext">postPolicyKey :: ctx
-&gt; ApiT WalletId
-&gt; Maybe Bool
-&gt; ApiPostPolicyKeyData
-&gt; Handler ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Server.html#postPolicyKey"><span class="hs-identifier hs-var hs-var">postPolicyKey</span></a></span></span><span> </span><span id="local-6989586621682480544"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480544"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480543"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480543"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480542"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480542"><span class="hs-identifier hs-var">hashed</span></a></span></span><span> </span><span id="local-6989586621682480541"><span class="annot"><span class="annottext">ApiPostPolicyKeyData
</span><a href="#local-6989586621682480541"><span class="hs-identifier hs-var">apiPassphrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3910"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ApiPolicyKey)
-&gt; (ErrWalletNotResponding -&gt; Handler ApiPolicyKey)
-&gt; (WorkerCtx ctx -&gt; Handler ApiPolicyKey)
-&gt; Handler ApiPolicyKey
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480546"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480544"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480543"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ApiPolicyKey
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ApiPolicyKey
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ApiPolicyKey) -&gt; Handler ApiPolicyKey)
-&gt; (WorkerCtx ctx -&gt; Handler ApiPolicyKey) -&gt; Handler ApiPolicyKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480540"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480540"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3911"></span><span>        </span><span id="local-6989586621682480539"><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682480539"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
-&gt; Handler (ShelleyKey 'PolicyK XPub)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
 -&gt; Handler (ShelleyKey 'PolicyK XPub))
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
-&gt; Handler (ShelleyKey 'PolicyK XPub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) ShelleyKey
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
forall ctx s (n :: NetworkDiscriminant).
(HasDBLayer IO s ShelleyKey ctx, s ~ SeqState n ShelleyKey) =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; ExceptT ErrWritePolicyPublicKey IO (ShelleyKey 'PolicyK XPub)
</span><a href="Cardano.Wallet.html#writePolicyPublicKey"><span class="hs-identifier hs-var">W.writePolicyPublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480546"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480545"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) ShelleyKey
WorkerCtx ctx
</span><a href="#local-6989586621682480540"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480543"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480537"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-3912"></span><span>        </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Handler ApiPolicyKey
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiPolicyKey -&gt; Handler ApiPolicyKey)
-&gt; ApiPolicyKey -&gt; Handler ApiPolicyKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; VerificationKeyHashing -&gt; ApiPolicyKey)
-&gt; (ByteString, VerificationKeyHashing) -&gt; ApiPolicyKey
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; VerificationKeyHashing -&gt; ApiPolicyKey
</span><a href="Cardano.Wallet.Api.Types.html#ApiPolicyKey"><span class="hs-identifier hs-var">ApiPolicyKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Bool -&gt; XPub -&gt; (ByteString, VerificationKeyHashing)
</span><a href="Cardano.Wallet.Api.Server.html#computeKeyPayload"><span class="hs-identifier hs-var">computeKeyPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682480542"><span class="hs-identifier hs-var">hashed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'PolicyK XPub
</span><a href="#local-6989586621682480539"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3913"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3914"></span><span>    </span><span id="local-6989586621682480537"><span class="annot"><span class="annottext">pwd :: Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480537"><span class="hs-identifier hs-var hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT (Passphrase &quot;user&quot;) -&gt; Passphrase &quot;user&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiPostPolicyKeyData
</span><a href="#local-6989586621682480541"><span class="hs-identifier hs-var">apiPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPostPolicyKeyData
-&gt; ((ApiT (Passphrase &quot;user&quot;)
     -&gt; Const (ApiT (Passphrase &quot;user&quot;)) (ApiT (Passphrase &quot;user&quot;)))
    -&gt; ApiPostPolicyKeyData
    -&gt; Const (ApiT (Passphrase &quot;user&quot;)) ApiPostPolicyKeyData)
-&gt; ApiT (Passphrase &quot;user&quot;)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;passphrase&quot;
  ((ApiT (Passphrase &quot;user&quot;)
    -&gt; Const (ApiT (Passphrase &quot;user&quot;)) (ApiT (Passphrase &quot;user&quot;)))
   -&gt; ApiPostPolicyKeyData
   -&gt; Const (ApiT (Passphrase &quot;user&quot;)) ApiPostPolicyKeyData)
(ApiT (Passphrase &quot;user&quot;)
 -&gt; Const (ApiT (Passphrase &quot;user&quot;)) (ApiT (Passphrase &quot;user&quot;)))
-&gt; ApiPostPolicyKeyData
-&gt; Const (ApiT (Passphrase &quot;user&quot;)) ApiPostPolicyKeyData
</span><a href="#local-6989586621682480536"><span class="hs-var">#passphrase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3915"></span><span>
</span><span id="line-3916"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#postPolicyId"><span class="hs-identifier hs-type">postPolicyId</span></a></span><span>
</span><span id="line-3917"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480535"><span class="annot"><a href="#local-6989586621682480535"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480534"><span class="annot"><a href="#local-6989586621682480534"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480533"><span class="annot"><a href="#local-6989586621682480533"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480532"><span class="annot"><a href="#local-6989586621682480532"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-3918"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480535"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480534"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480533"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3919"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480533"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3920"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480534"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3921"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480532"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3922"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3923"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480535"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3924"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3925"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPostPolicyIdData"><span class="hs-identifier hs-type">ApiPostPolicyIdData</span></a></span><span>
</span><span id="line-3926"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiPolicyId"><span class="hs-identifier hs-type">ApiPolicyId</span></a></span><span>
</span><span id="line-3927"></span><span id="postPolicyId"><span class="annot"><span class="annottext">postPolicyId :: ctx -&gt; ApiT WalletId -&gt; ApiPostPolicyIdData -&gt; Handler ApiPolicyId
</span><a href="Cardano.Wallet.Api.Server.html#postPolicyId"><span class="hs-identifier hs-var hs-var">postPolicyId</span></a></span></span><span> </span><span id="local-6989586621682480531"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480531"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480530"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480530"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480529"><span class="annot"><span class="annottext">ApiPostPolicyIdData
</span><a href="#local-6989586621682480529"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3928"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480528"><span class="annot"><span class="annottext">retrieveAllCosigners :: Script a -&gt; [a]
</span><a href="#local-6989586621682480528"><span class="hs-identifier hs-var hs-var">retrieveAllCosigners</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [a] -&gt; [a]) -&gt; [a] -&gt; Script a -&gt; [a]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Script a -&gt; b
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">foldScript</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3929"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480527"><span class="annot"><span class="annottext">wrongMintingTemplate :: Script Cosigner -&gt; Bool
</span><a href="#local-6989586621682480527"><span class="hs-identifier hs-var hs-var">wrongMintingTemplate</span></a></span></span><span> </span><span id="local-6989586621682480526"><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682480526"><span class="hs-identifier hs-var">templ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3930"></span><span>            </span><span class="annot"><span class="annottext">Either ErrValidateScript () -&gt; Bool
forall a b. Either a b -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationLevel -&gt; Script Cosigner -&gt; Either ErrValidateScript ()
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">validateScriptOfTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationLevel
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RecommendedValidation</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682480526"><span class="hs-identifier hs-var">templ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3931"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">[Cosigner] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script Cosigner -&gt; [Cosigner]
forall a. Script a -&gt; [a]
</span><a href="#local-6989586621682480528"><span class="hs-identifier hs-var">retrieveAllCosigners</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682480526"><span class="hs-identifier hs-var">templ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-3932"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Cosigner -&gt; Bool) -&gt; [Cosigner] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner -&gt; Cosigner -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Cosigner
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script Cosigner -&gt; [Cosigner]
forall a. Script a -&gt; [a]
</span><a href="#local-6989586621682480528"><span class="hs-identifier hs-var">retrieveAllCosigners</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682480526"><span class="hs-identifier hs-var">templ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3933"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Script Cosigner -&gt; Bool
</span><a href="#local-6989586621682480527"><span class="hs-identifier hs-var">wrongMintingTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682480525"><span class="hs-identifier hs-var">scriptTempl</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3934"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrGetPolicyId IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrGetPolicyId IO () -&gt; Handler ())
-&gt; ExceptT ErrGetPolicyId IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrGetPolicyId -&gt; ExceptT ErrGetPolicyId IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrGetPolicyId
</span><a href="Cardano.Wallet.html#ErrGetPolicyIdWrongMintingBurningTemplate"><span class="hs-identifier hs-var">ErrGetPolicyIdWrongMintingBurningTemplate</span></a></span><span>
</span><span id="line-3935"></span><span>
</span><span id="line-3936"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; Handler ApiPolicyId)
-&gt; (ErrWalletNotResponding -&gt; Handler ApiPolicyId)
-&gt; (WorkerCtx ctx -&gt; Handler ApiPolicyId)
-&gt; Handler ApiPolicyId
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480534"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480533"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480531"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480530"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler ApiPolicyId
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; Handler ApiPolicyId
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler ApiPolicyId) -&gt; Handler ApiPolicyId)
-&gt; (WorkerCtx ctx -&gt; Handler ApiPolicyId) -&gt; Handler ApiPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480523"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480523"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3937"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682480522"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480522"><span class="hs-identifier hs-var">xpub</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
 -&gt; Handler (XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
-&gt; Handler (XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadPolicyPublicKey IO (XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readPolicyPublicKey"><span class="hs-identifier hs-var">W.readPolicyPublicKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480534"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480533"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480532"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480523"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480530"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3938"></span><span>        </span><span class="annot"><span class="annottext">ApiPolicyId -&gt; Handler ApiPolicyId
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiPolicyId -&gt; Handler ApiPolicyId)
-&gt; ApiPolicyId -&gt; Handler ApiPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenPolicyId -&gt; ApiPolicyId
</span><a href="Cardano.Wallet.Api.Types.html#ApiPolicyId"><span class="hs-identifier hs-var">ApiPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TokenPolicyId -&gt; ApiPolicyId)
-&gt; ApiT TokenPolicyId -&gt; ApiPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; ApiT TokenPolicyId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenPolicyId -&gt; ApiT TokenPolicyId)
-&gt; TokenPolicyId -&gt; ApiT TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3939"></span><span>            </span><span class="annot"><span class="annottext">Script Cosigner -&gt; Map Cosigner XPub -&gt; TokenPolicyId
forall (key :: Depth -&gt; * -&gt; *).
WalletKey key =&gt;
Script Cosigner -&gt; Map Cosigner XPub -&gt; TokenPolicyId
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.MintBurn.html#toTokenPolicyId"><span class="hs-identifier hs-var">toTokenPolicyId</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480533"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">Script Cosigner
</span><a href="#local-6989586621682480525"><span class="hs-identifier hs-var">scriptTempl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cosigner -&gt; XPub -&gt; Map Cosigner XPub
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Cosigner
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Cosigner</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682480522"><span class="hs-identifier hs-var">xpub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3940"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3941"></span><span>    </span><span id="local-6989586621682480525"><span class="annot"><span class="annottext">scriptTempl :: Script Cosigner
</span><a href="#local-6989586621682480525"><span class="hs-identifier hs-var hs-var">scriptTempl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT (Script Cosigner) -&gt; Script Cosigner
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiPostPolicyIdData
</span><a href="#local-6989586621682480529"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPostPolicyIdData
-&gt; ((ApiT (Script Cosigner)
     -&gt; Const (ApiT (Script Cosigner)) (ApiT (Script Cosigner)))
    -&gt; ApiPostPolicyIdData
    -&gt; Const (ApiT (Script Cosigner)) ApiPostPolicyIdData)
-&gt; ApiT (Script Cosigner)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;policyScriptTemplate&quot;
  ((ApiT (Script Cosigner)
    -&gt; Const (ApiT (Script Cosigner)) (ApiT (Script Cosigner)))
   -&gt; ApiPostPolicyIdData
   -&gt; Const (ApiT (Script Cosigner)) ApiPostPolicyIdData)
(ApiT (Script Cosigner)
 -&gt; Const (ApiT (Script Cosigner)) (ApiT (Script Cosigner)))
-&gt; ApiPostPolicyIdData
-&gt; Const (ApiT (Script Cosigner)) ApiPostPolicyIdData
</span><a href="#local-6989586621682480520"><span class="hs-var">#policyScriptTemplate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3942"></span><span>
</span><span id="line-3943"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Helpers
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-3946"></span><span>
</span><span id="line-3947"></span><span class="hs-comment">-- | Handler for fetching the 'ArgGenChange' for the 'RndState' (i.e. the root</span><span>
</span><span id="line-3948"></span><span class="hs-comment">-- XPrv), necessary to derive new change addresses.</span><span>
</span><span id="line-3949"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#rndStateChange"><span class="hs-identifier hs-type">rndStateChange</span></a></span><span>
</span><span id="line-3950"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480519"><span class="annot"><a href="#local-6989586621682480519"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480518"><span class="annot"><a href="#local-6989586621682480518"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480517"><span class="annot"><a href="#local-6989586621682480517"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682480516"><span class="annot"><a href="#local-6989586621682480516"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3951"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480519"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480518"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480517"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3952"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480518"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#RndState"><span class="hs-identifier hs-type">RndState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480516"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3953"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682480517"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Byron.html#ByronKey"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-3954"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3955"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682480519"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3956"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3957"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span>
</span><span id="line-3958"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#ArgGenChange"><span class="hs-identifier hs-type">ArgGenChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480518"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3959"></span><span id="rndStateChange"><span class="annot"><span class="annottext">rndStateChange :: ctx
-&gt; ApiT WalletId -&gt; Passphrase &quot;user&quot; -&gt; Handler (ArgGenChange s)
</span><a href="Cardano.Wallet.Api.Server.html#rndStateChange"><span class="hs-identifier hs-var hs-var">rndStateChange</span></a></span></span><span> </span><span id="local-6989586621682480515"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480515"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480514"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480514"><span class="hs-identifier hs-var">wid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480513"><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480513"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3960"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (WorkerCtx ctx
    -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480518"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480517"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480515"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480514"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx
  -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
 -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (WorkerCtx ctx
    -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480512"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480512"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
 -&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; ExceptT
     ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; Handler (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3961"></span><span>        </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; ErrSignPayment)
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT
         ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; ExceptT
     ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall ctx s (k :: Depth -&gt; * -&gt; *) e a.
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; Passphrase &quot;user&quot;
-&gt; (ErrWithRootKey -&gt; e)
-&gt; (k 'RootK XPrv -&gt; PassphraseScheme -&gt; ExceptT e IO a)
-&gt; ExceptT e IO a
</span><a href="Cardano.Wallet.html#withRootKey"><span class="hs-identifier hs-var">W.withRootKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480518"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682480517"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (RndState n) ByronKey
WorkerCtx ctx
</span><a href="#local-6989586621682480512"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480514"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480513"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ErrSignPayment
</span><a href="Cardano.Wallet.html#ErrSignPaymentWithRootKey"><span class="hs-identifier hs-var">ErrSignPaymentWithRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">((k 'RootK XPrv
  -&gt; PassphraseScheme
  -&gt; ExceptT
       ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
 -&gt; ExceptT
      ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; (k 'RootK XPrv
    -&gt; PassphraseScheme
    -&gt; ExceptT
         ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;))
-&gt; ExceptT
     ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480510"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682480510"><span class="hs-identifier hs-var">xprv</span></a></span></span><span> </span><span id="local-6989586621682480509"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682480509"><span class="hs-identifier hs-var">scheme</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3962"></span><span>            </span><span class="annot"><span class="annottext">(k 'RootK XPrv, Passphrase &quot;encryption&quot;)
-&gt; ExceptT
     ErrSignPayment IO (k 'RootK XPrv, Passphrase &quot;encryption&quot;)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682480510"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Passphrase &quot;user&quot; -&gt; Passphrase &quot;encryption&quot;
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#preparePassphrase"><span class="hs-identifier hs-var">preparePassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682480509"><span class="hs-identifier hs-var">scheme</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;user&quot;
</span><a href="#local-6989586621682480513"><span class="hs-identifier hs-var">pwd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3963"></span><span>
</span><span id="line-3964"></span><span class="hs-keyword">type</span><span> </span><span id="RewardAccountBuilder"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#RewardAccountBuilder"><span class="hs-identifier hs-var">RewardAccountBuilder</span></a></span></span><span> </span><span id="local-6989586621682480508"><span class="annot"><a href="#local-6989586621682480508"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-3965"></span><span>        </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682480508"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3966"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3967"></span><span>
</span><span id="line-3968"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-type">mkRewardAccountBuilder</span></a></span><span>
</span><span id="line-3969"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483903"><span class="annot"><a href="#local-6989586621682483903"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682483902"><span class="annot"><a href="#local-6989586621682483902"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483901"><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682483899"><span class="annot"><a href="#local-6989586621682483899"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682483900"><span class="annot"><a href="#local-6989586621682483900"><span class="hs-identifier hs-type">shelley</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3970"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682483903"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483902"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3971"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682483900"><span class="hs-identifier hs-type">shelley</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Sequential.html#SeqState"><span class="hs-identifier hs-type">SeqState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483899"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-3972"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3973"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-type">AddressIndexDerivationType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3974"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-3975"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483902"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-3976"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483899"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-3977"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3978"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483903"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-3979"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-3980"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawalPostData"><span class="hs-identifier hs-type">ApiWithdrawalPostData</span></a></span><span>
</span><span id="line-3981"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Withdrawal"><span class="hs-identifier hs-type">Withdrawal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#RewardAccountBuilder"><span class="hs-identifier hs-type">RewardAccountBuilder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3982"></span><span id="mkRewardAccountBuilder"><span class="annot"><span class="annottext">mkRewardAccountBuilder :: ctx
-&gt; WalletId
-&gt; Maybe ApiWithdrawalPostData
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
</span><a href="Cardano.Wallet.Api.Server.html#mkRewardAccountBuilder"><span class="hs-identifier hs-var hs-var">mkRewardAccountBuilder</span></a></span></span><span> </span><span id="local-6989586621682480507"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480507"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480506"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480506"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682480505"><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="#local-6989586621682480505"><span class="hs-identifier hs-var">withdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3983"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480504"><span class="annot"><span class="annottext">selfRewardCredentials :: RewardAccountBuilder k
</span><a href="#local-6989586621682480504"><span class="hs-identifier hs-var hs-var">selfRewardCredentials</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480503"><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682480503"><span class="hs-identifier hs-var">rootK</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480502"><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682480502"><span class="hs-identifier hs-var">pwdP</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3984"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k 'AddressK XPrv -&gt; XPrv
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(k 'AddressK XPrv -&gt; XPrv) -&gt; k 'AddressK XPrv -&gt; XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv -&gt; k 'AddressK XPrv
forall (k :: Depth -&gt; * -&gt; *).
(HardDerivation k,
 Bounded (Index (AddressIndexDerivationType k) 'AddressK)) =&gt;
Passphrase &quot;encryption&quot; -&gt; k 'RootK XPrv -&gt; k 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveRewardAccount"><span class="hs-identifier hs-var">deriveRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682480502"><span class="hs-identifier hs-var">pwdP</span></a></span><span> </span><span class="annot"><span class="annottext">k 'RootK XPrv
</span><a href="#local-6989586621682480503"><span class="hs-identifier hs-var">rootK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682480502"><span class="hs-identifier hs-var">pwdP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3985"></span><span>
</span><span id="line-3986"></span><span>    </span><span class="annot"><span class="annottext">ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet
    -&gt; Handler (Withdrawal, RewardAccountBuilder k))
-&gt; (ErrWalletNotResponding
    -&gt; Handler (Withdrawal, RewardAccountBuilder k))
-&gt; (WorkerCtx ctx -&gt; Handler (Withdrawal, RewardAccountBuilder k))
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *) a.
(HasWorkerRegistry s k ctx, HasDBFactory s k ctx, MonadIO m) =&gt;
ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var">withWorkerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480507"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480506"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletNotResponding
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall e a. IsServerError e =&gt; e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerCtx ctx -&gt; Handler (Withdrawal, RewardAccountBuilder k))
 -&gt; Handler (Withdrawal, RewardAccountBuilder k))
-&gt; (WorkerCtx ctx -&gt; Handler (Withdrawal, RewardAccountBuilder k))
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480501"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3987"></span><span>        </span><span id="local-6989586621682480500"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480500"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnyCardanoEra -&gt; Handler AnyCardanoEra)
-&gt; IO AnyCardanoEra -&gt; Handler AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block -&gt; IO AnyCardanoEra
forall (m :: * -&gt; *) block. NetworkLayer m block -&gt; m AnyCardanoEra
</span><a href="Cardano.Wallet.Network.html#currentNodeEra"><span class="hs-identifier hs-var hs-var">NW.currentNodeEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; ((NetworkLayer IO Block
     -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
    -&gt; WalletLayer IO s k
    -&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k))
-&gt; NetworkLayer IO Block
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkLayer IO Block
 -&gt; Const (NetworkLayer IO Block) (NetworkLayer IO Block))
-&gt; WalletLayer IO s k
-&gt; Const (NetworkLayer IO Block) (WalletLayer IO s k)
forall (m :: * -&gt; *) ctx.
HasNetworkLayer m ctx =&gt;
Lens' ctx (NetworkLayer m Block)
</span><a href="Cardano.Wallet.html#networkLayer"><span class="hs-identifier hs-var">networkLayer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3988"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeRep s -&gt; TypeRep shelley -&gt; Maybe (s :~: shelley)
forall k (f :: k -&gt; *) (a :: k) (b :: k).
TestEquality f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">testEquality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typeable s =&gt; TypeRep s
forall k (a :: k). Typeable a =&gt; TypeRep a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483902"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typeable shelley =&gt; TypeRep shelley
forall k (a :: k). Typeable a =&gt; TypeRep a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483900"><span class="hs-identifier hs-type">shelley</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="#local-6989586621682480505"><span class="hs-identifier hs-var">withdrawal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3989"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (s :~: shelley)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3990"></span><span>                </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount IO (Withdrawal, RewardAccountBuilder k)
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount IO (Withdrawal, RewardAccountBuilder k)
 -&gt; Handler (Withdrawal, RewardAccountBuilder k))
-&gt; ExceptT
     ErrReadRewardAccount IO (Withdrawal, RewardAccountBuilder k)
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount
-&gt; ExceptT
     ErrReadRewardAccount IO (Withdrawal, RewardAccountBuilder k)
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="Cardano.Wallet.html#ErrReadRewardAccountNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadRewardAccountNotAShelleyWallet</span></a></span><span>
</span><span id="line-3991"></span><span>
</span><span id="line-3992"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (s :~: shelley)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ApiWithdrawalPostData
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3993"></span><span>                </span><span class="annot"><span class="annottext">(Withdrawal, RewardAccountBuilder k)
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#NoWithdrawal"><span class="hs-identifier hs-var">NoWithdrawal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480504"><span class="hs-identifier hs-var">selfRewardCredentials</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3994"></span><span>
</span><span id="line-3995"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">s :~: shelley
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Refl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalPostData
</span><a href="Cardano.Wallet.Api.Types.html#SelfWithdrawal"><span class="hs-identifier hs-var">SelfWithdrawal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3996"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682480497"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480497"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XPub
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480496"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480496"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrReadRewardAccount
  IO
  (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   ErrReadRewardAccount
   IO
   (RewardAccount, XPub, NonEmpty DerivationIndex)
 -&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex))
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
-&gt; Handler (RewardAccount, XPub, NonEmpty DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
forall ctx s (k :: Depth -&gt; * -&gt; *) (n :: NetworkDiscriminant)
       shelley.
(HasDBLayer IO s k ctx, shelley ~ SeqState n ShelleyKey,
 Typeable n, Typeable s) =&gt;
ctx
-&gt; WalletId
-&gt; ExceptT
     ErrReadRewardAccount
     IO
     (RewardAccount, XPub, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.html#readRewardAccount"><span class="hs-identifier hs-var">W.readRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483902"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483899"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480506"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-3997"></span><span>                </span><span id="local-6989586621682480495"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480495"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrFetchRewards IO Coin -&gt; Handler Coin
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrFetchRewards IO Coin -&gt; Handler Coin)
-&gt; ExceptT ErrFetchRewards IO Coin -&gt; Handler Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
-&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
forall ctx.
HasNetworkLayer IO ctx =&gt;
ctx -&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
</span><a href="Cardano.Wallet.html#queryRewardBalance"><span class="hs-identifier hs-var">W.queryRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480497"><span class="hs-identifier hs-var">acct</span></a></span><span>
</span><span id="line-3998"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">RewardAccountBuilder k
</span><a href="#local-6989586621682480504"><span class="hs-identifier hs-var">selfRewardCredentials</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Withdrawal -&gt; (Withdrawal, RewardAccountBuilder k))
-&gt; (Coin -&gt; Withdrawal)
-&gt; Coin
-&gt; (Withdrawal, RewardAccountBuilder k)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; NonEmpty DerivationIndex -&gt; Coin -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#WithdrawalSelf"><span class="hs-identifier hs-var">WithdrawalSelf</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480497"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480496"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-3999"></span><span>                    </span><span class="annot"><span class="annottext">(Coin -&gt; (Withdrawal, RewardAccountBuilder k))
-&gt; Handler Coin -&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO Coin -&gt; Handler Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
-&gt; AnyCardanoEra -&gt; Coin -&gt; IO Coin
forall ctx (k :: Depth -&gt; * -&gt; *).
(HasTransactionLayer k ctx, HasNetworkLayer IO ctx) =&gt;
ctx -&gt; AnyCardanoEra -&gt; Coin -&gt; IO Coin
</span><a href="Cardano.Wallet.html#readNextWithdrawal"><span class="hs-identifier hs-var">W.readNextWithdrawal</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480500"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480495"><span class="hs-identifier hs-var">wdrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4000"></span><span>
</span><span id="line-4001"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">s :~: shelley
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Refl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ExternalWithdrawal"><span class="hs-identifier hs-type">ExternalWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiMnemonicT"><span class="hs-identifier hs-type">ApiMnemonicT</span></a></span><span> </span><span id="local-6989586621682480491"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682480491"><span class="hs-identifier hs-var">mw</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4002"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480490"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682480490"><span class="hs-identifier hs-var">xprv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480489"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480489"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480488"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480488"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic -&gt; (XPrv, RewardAccount, NonEmpty DerivationIndex)
forall (k :: Depth -&gt; * -&gt; *).
ToRewardAccount k =&gt;
SomeMnemonic -&gt; (XPrv, RewardAccount, NonEmpty DerivationIndex)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#someRewardAccount"><span class="hs-identifier hs-var">W.someRewardAccount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#ShelleyKey"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682480491"><span class="hs-identifier hs-var">mw</span></a></span><span>
</span><span id="line-4003"></span><span>                </span><span id="local-6989586621682480486"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480486"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrFetchRewards IO Coin -&gt; Handler Coin
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
-&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
forall ctx.
HasNetworkLayer IO ctx =&gt;
ctx -&gt; RewardAccount -&gt; ExceptT ErrFetchRewards IO Coin
</span><a href="Cardano.Wallet.html#queryRewardBalance"><span class="hs-identifier hs-var">W.queryRewardBalance</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480489"><span class="hs-identifier hs-var">acct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4004"></span><span>                    </span><span class="annot"><span class="annottext">Handler Coin -&gt; (Coin -&gt; Handler Coin) -&gt; Handler Coin
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">IO Coin -&gt; Handler Coin
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Coin -&gt; Handler Coin)
-&gt; (Coin -&gt; IO Coin) -&gt; Coin -&gt; Handler Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
-&gt; AnyCardanoEra -&gt; Coin -&gt; IO Coin
forall ctx (k :: Depth -&gt; * -&gt; *).
(HasTransactionLayer k ctx, HasNetworkLayer IO ctx) =&gt;
ctx -&gt; AnyCardanoEra -&gt; Coin -&gt; IO Coin
</span><a href="Cardano.Wallet.html#readNextWithdrawal"><span class="hs-identifier hs-var">W.readNextWithdrawal</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483901"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO (SeqState n ShelleyKey) k
WorkerCtx ctx
</span><a href="#local-6989586621682480501"><span class="hs-identifier hs-var">wrk</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480500"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-4005"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Handler () -&gt; Handler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480486"><span class="hs-identifier hs-var">wdrl</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler ()) -&gt; Handler () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4006"></span><span>                    </span><span class="annot"><span class="annottext">ExceptT ErrWithdrawalNotWorth IO () -&gt; Handler ()
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWithdrawalNotWorth IO () -&gt; Handler ())
-&gt; ExceptT ErrWithdrawalNotWorth IO () -&gt; Handler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithdrawalNotWorth -&gt; ExceptT ErrWithdrawalNotWorth IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithdrawalNotWorth
</span><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier hs-var">ErrWithdrawalNotWorth</span></a></span><span>
</span><span id="line-4007"></span><span>                </span><span class="annot"><span class="annottext">(Withdrawal, RewardAccountBuilder k)
-&gt; Handler (Withdrawal, RewardAccountBuilder k)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; NonEmpty DerivationIndex -&gt; Coin -&gt; Withdrawal
</span><a href="Cardano.Wallet.Transaction.html#WithdrawalExternal"><span class="hs-identifier hs-var">WithdrawalExternal</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480489"><span class="hs-identifier hs-var">acct</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480488"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480486"><span class="hs-identifier hs-var">wdrl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(XPrv, Passphrase &quot;encryption&quot;) -&gt; RewardAccountBuilder k
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682480490"><span class="hs-identifier hs-var">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4008"></span><span>
</span><span id="line-4009"></span><span class="hs-comment">-- | Makes an 'ApiCoinSelection' from the given 'UnsignedTx'.</span><span>
</span><span id="line-4010"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-type">mkApiCoinSelection</span></a></span><span>
</span><span id="line-4011"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483844"><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621682483848"><span class="annot"><a href="#local-6989586621682483848"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621682483847"><span class="annot"><a href="#local-6989586621682483847"><span class="hs-identifier hs-type">output</span></a></span></span><span> </span><span id="local-6989586621682483846"><span class="annot"><a href="#local-6989586621682483846"><span class="hs-identifier hs-type">change</span></a></span></span><span> </span><span id="local-6989586621682483845"><span class="annot"><a href="#local-6989586621682483845"><span class="hs-identifier hs-type">withdrawal</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-4012"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682483848"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4013"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682483847"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-4014"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682483846"><span class="hs-identifier hs-type">change</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxChange"><span class="hs-identifier hs-type">TxChange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4015"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682483845"><span class="hs-identifier hs-type">withdrawal</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4016"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-4017"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4018"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4019"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#DelegationAction"><span class="hs-identifier hs-type">DelegationAction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4020"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">W.TxMetadata</span></a></span><span>
</span><span id="line-4021"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483848"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483847"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483846"><span class="hs-identifier hs-type">change</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483845"><span class="hs-identifier hs-type">withdrawal</span></a></span><span>
</span><span id="line-4022"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4023"></span><span id="mkApiCoinSelection"><span class="annot"><span class="annottext">mkApiCoinSelection :: [Coin]
-&gt; [Coin]
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe TxMetadata
-&gt; UnsignedTx input output change withdrawal
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoinSelection"><span class="hs-identifier hs-var hs-var">mkApiCoinSelection</span></a></span></span><span> </span><span id="local-6989586621682480483"><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682480483"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682480482"><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682480482"><span class="hs-identifier hs-var">refunds</span></a></span></span><span> </span><span id="local-6989586621682480481"><span class="annot"><span class="annottext">Maybe (DelegationAction, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682480481"><span class="hs-identifier hs-var">mcerts</span></a></span></span><span> </span><span id="local-6989586621682480480"><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682480480"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span id="local-6989586621682480479"><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
</span><a href="#local-6989586621682480479"><span class="hs-identifier hs-var">unsignedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4024"></span><span>    </span><span class="annot"><span class="annottext">ApiCoinSelection :: forall (n :: NetworkDiscriminant).
[ApiWalletInput n]
-&gt; [ApiCoinSelectionOutput n]
-&gt; [ApiCoinSelectionChange n]
-&gt; [ApiCoinSelectionCollateral n]
-&gt; [ApiCoinSelectionWithdrawal n]
-&gt; Maybe (NonEmpty ApiCertificate)
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; Maybe ApiBase64
-&gt; ApiCoinSelection n
</span><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelection"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span>
</span><span id="line-4025"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:inputs:ApiCoinSelection :: [ApiWalletInput n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ainputs%3AApiCoinSelection"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">input -&gt; ApiWalletInput n
</span><a href="#local-6989586621682480476"><span class="hs-identifier hs-var">mkApiCoinSelectionInput</span></a></span><span>
</span><span id="line-4026"></span><span>            </span><span class="annot"><span class="annottext">(input -&gt; ApiWalletInput n) -&gt; [input] -&gt; [ApiWalletInput n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
</span><a href="#local-6989586621682480479"><span class="hs-identifier hs-var">unsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
-&gt; (([input] -&gt; Const [input] [input])
    -&gt; UnsignedTx input output change withdrawal
    -&gt; Const [input] (UnsignedTx input output change withdrawal))
-&gt; [input]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unsignedInputs&quot;
  (([input] -&gt; Const [input] [input])
   -&gt; UnsignedTx input output change withdrawal
   -&gt; Const [input] (UnsignedTx input output change withdrawal))
([input] -&gt; Const [input] [input])
-&gt; UnsignedTx input output change withdrawal
-&gt; Const [input] (UnsignedTx input output change withdrawal)
</span><a href="#local-6989586621682480475"><span class="hs-var">#unsignedInputs</span></a></span><span>
</span><span id="line-4027"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:ApiCoinSelection :: [ApiCoinSelectionOutput n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aoutputs%3AApiCoinSelection"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">output -&gt; ApiCoinSelectionOutput n
</span><a href="#local-6989586621682480473"><span class="hs-identifier hs-var">mkApiCoinSelectionOutput</span></a></span><span>
</span><span id="line-4028"></span><span>            </span><span class="annot"><span class="annottext">(output -&gt; ApiCoinSelectionOutput n)
-&gt; [output] -&gt; [ApiCoinSelectionOutput n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
</span><a href="#local-6989586621682480479"><span class="hs-identifier hs-var">unsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
-&gt; (([output] -&gt; Const [output] [output])
    -&gt; UnsignedTx input output change withdrawal
    -&gt; Const [output] (UnsignedTx input output change withdrawal))
-&gt; [output]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unsignedOutputs&quot;
  (([output] -&gt; Const [output] [output])
   -&gt; UnsignedTx input output change withdrawal
   -&gt; Const [output] (UnsignedTx input output change withdrawal))
([output] -&gt; Const [output] [output])
-&gt; UnsignedTx input output change withdrawal
-&gt; Const [output] (UnsignedTx input output change withdrawal)
</span><a href="#local-6989586621682480472"><span class="hs-var">#unsignedOutputs</span></a></span><span>
</span><span id="line-4029"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:change:ApiCoinSelection :: [ApiCoinSelectionChange n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Achange%3AApiCoinSelection"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">change -&gt; ApiCoinSelectionChange n
</span><a href="#local-6989586621682480470"><span class="hs-identifier hs-var">mkApiCoinSelectionChange</span></a></span><span>
</span><span id="line-4030"></span><span>            </span><span class="annot"><span class="annottext">(change -&gt; ApiCoinSelectionChange n)
-&gt; [change] -&gt; [ApiCoinSelectionChange n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
</span><a href="#local-6989586621682480479"><span class="hs-identifier hs-var">unsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
-&gt; (([change] -&gt; Const [change] [change])
    -&gt; UnsignedTx input output change withdrawal
    -&gt; Const [change] (UnsignedTx input output change withdrawal))
-&gt; [change]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unsignedChange&quot;
  (([change] -&gt; Const [change] [change])
   -&gt; UnsignedTx input output change withdrawal
   -&gt; Const [change] (UnsignedTx input output change withdrawal))
([change] -&gt; Const [change] [change])
-&gt; UnsignedTx input output change withdrawal
-&gt; Const [change] (UnsignedTx input output change withdrawal)
</span><a href="#local-6989586621682480469"><span class="hs-var">#unsignedChange</span></a></span><span>
</span><span id="line-4031"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateral:ApiCoinSelection :: [ApiCoinSelectionCollateral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acollateral%3AApiCoinSelection"><span class="hs-identifier hs-var">collateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">input -&gt; ApiCoinSelectionCollateral n
</span><a href="#local-6989586621682480467"><span class="hs-identifier hs-var">mkApiCoinSelectionCollateral</span></a></span><span>
</span><span id="line-4032"></span><span>            </span><span class="annot"><span class="annottext">(input -&gt; ApiCoinSelectionCollateral n)
-&gt; [input] -&gt; [ApiCoinSelectionCollateral n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
</span><a href="#local-6989586621682480479"><span class="hs-identifier hs-var">unsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
-&gt; (([input] -&gt; Const [input] [input])
    -&gt; UnsignedTx input output change withdrawal
    -&gt; Const [input] (UnsignedTx input output change withdrawal))
-&gt; [input]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unsignedCollateral&quot;
  (([input] -&gt; Const [input] [input])
   -&gt; UnsignedTx input output change withdrawal
   -&gt; Const [input] (UnsignedTx input output change withdrawal))
([input] -&gt; Const [input] [input])
-&gt; UnsignedTx input output change withdrawal
-&gt; Const [input] (UnsignedTx input output change withdrawal)
</span><a href="#local-6989586621682480466"><span class="hs-var">#unsignedCollateral</span></a></span><span>
</span><span id="line-4033"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:ApiCoinSelection :: [ApiCoinSelectionWithdrawal n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Awithdrawals%3AApiCoinSelection"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">withdrawal -&gt; ApiCoinSelectionWithdrawal n
</span><a href="#local-6989586621682480464"><span class="hs-identifier hs-var">mkApiCoinSelectionWithdrawal</span></a></span><span>
</span><span id="line-4034"></span><span>            </span><span class="annot"><span class="annottext">(withdrawal -&gt; ApiCoinSelectionWithdrawal n)
-&gt; [withdrawal] -&gt; [ApiCoinSelectionWithdrawal n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
</span><a href="#local-6989586621682480479"><span class="hs-identifier hs-var">unsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnsignedTx input output change withdrawal
-&gt; (([withdrawal] -&gt; Const [withdrawal] [withdrawal])
    -&gt; UnsignedTx input output change withdrawal
    -&gt; Const [withdrawal] (UnsignedTx input output change withdrawal))
-&gt; [withdrawal]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unsignedWithdrawals&quot;
  (([withdrawal] -&gt; Const [withdrawal] [withdrawal])
   -&gt; UnsignedTx input output change withdrawal
   -&gt; Const [withdrawal] (UnsignedTx input output change withdrawal))
([withdrawal] -&gt; Const [withdrawal] [withdrawal])
-&gt; UnsignedTx input output change withdrawal
-&gt; Const [withdrawal] (UnsignedTx input output change withdrawal)
</span><a href="#local-6989586621682480463"><span class="hs-var">#unsignedWithdrawals</span></a></span><span>
</span><span id="line-4035"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:certificates:ApiCoinSelection :: Maybe (NonEmpty ApiCertificate)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acertificates%3AApiCoinSelection"><span class="hs-identifier hs-var">certificates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DelegationAction
 -&gt; NonEmpty DerivationIndex -&gt; NonEmpty ApiCertificate)
-&gt; (DelegationAction, NonEmpty DerivationIndex)
-&gt; NonEmpty ApiCertificate
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">DelegationAction
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty ApiCertificate
</span><a href="#local-6989586621682480461"><span class="hs-identifier hs-var">mkCertificates</span></a></span><span>
</span><span id="line-4036"></span><span>            </span><span class="annot"><span class="annottext">((DelegationAction, NonEmpty DerivationIndex)
 -&gt; NonEmpty ApiCertificate)
-&gt; Maybe (DelegationAction, NonEmpty DerivationIndex)
-&gt; Maybe (NonEmpty ApiCertificate)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DelegationAction, NonEmpty DerivationIndex)
</span><a href="#local-6989586621682480481"><span class="hs-identifier hs-var">mcerts</span></a></span><span>
</span><span id="line-4037"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositsTaken:ApiCoinSelection :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositsTaken%3AApiCoinSelection"><span class="hs-identifier hs-var">depositsTaken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-var">mkApiCoin</span></a></span><span>
</span><span id="line-4038"></span><span>            </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; [Coin] -&gt; [Quantity &quot;lovelace&quot; Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682480483"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-4039"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositsReturned:ApiCoinSelection :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositsReturned%3AApiCoinSelection"><span class="hs-identifier hs-var">depositsReturned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-var">mkApiCoin</span></a></span><span>
</span><span id="line-4040"></span><span>            </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; [Coin] -&gt; [Quantity &quot;lovelace&quot; Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682480482"><span class="hs-identifier hs-var">refunds</span></a></span><span>
</span><span id="line-4041"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:metadata:ApiCoinSelection :: Maybe ApiBase64
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ametadata%3AApiCoinSelection"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ApiBase64
forall (base :: Base) bs. bs -&gt; ApiBytesT base bs
</span><a href="Cardano.Wallet.Api.Types.html#ApiBytesT"><span class="hs-identifier hs-var">ApiBytesT</span></a></span><span class="annot"><span class="annottext">(ByteString -&gt; ApiBase64)
-&gt; (TxMetadata -&gt; ByteString) -&gt; TxMetadata -&gt; ApiBase64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadata -&gt; ByteString
forall a. SerialiseAsCBOR a =&gt; a -&gt; ByteString
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">serialiseToCBOR</span></a></span><span>
</span><span id="line-4042"></span><span>            </span><span class="annot"><span class="annottext">(TxMetadata -&gt; ApiBase64) -&gt; Maybe TxMetadata -&gt; Maybe ApiBase64
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621682480480"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-4043"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-4044"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4045"></span><span>    </span><span class="annot"><a href="#local-6989586621682480461"><span class="hs-identifier hs-type">mkCertificates</span></a></span><span>
</span><span id="line-4046"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#DelegationAction"><span class="hs-identifier hs-type">DelegationAction</span></a></span><span>
</span><span id="line-4047"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationIndex"><span class="hs-identifier hs-type">DerivationIndex</span></a></span><span>
</span><span id="line-4048"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCertificate"><span class="hs-identifier hs-type">Api.ApiCertificate</span></a></span><span>
</span><span id="line-4049"></span><span>    </span><span id="local-6989586621682480461"><span class="annot"><span class="annottext">mkCertificates :: DelegationAction
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty ApiCertificate
</span><a href="#local-6989586621682480461"><span class="hs-identifier hs-var hs-var">mkCertificates</span></a></span></span><span> </span><span id="local-6989586621682480454"><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682480454"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621682480453"><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480453"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4050"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="#local-6989586621682480454"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4051"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#Join"><span class="hs-identifier hs-type">Join</span></a></span><span> </span><span id="local-6989586621682480452"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480452"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ApiCertificate] -&gt; NonEmpty ApiCertificate
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-4052"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiT PoolId -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#JoinPool"><span class="hs-identifier hs-var">Api.JoinPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480450"><span class="hs-identifier hs-var">apiStakePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480452"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4053"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4054"></span><span>
</span><span id="line-4055"></span><span>            </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#RegisterKeyAndJoin"><span class="hs-identifier hs-type">RegisterKeyAndJoin</span></a></span><span> </span><span id="local-6989586621682480448"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480448"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ApiCertificate] -&gt; NonEmpty ApiCertificate
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-4056"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#RegisterRewardAccount"><span class="hs-identifier hs-var">Api.RegisterRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480450"><span class="hs-identifier hs-var">apiStakePath</span></a></span><span>
</span><span id="line-4057"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiT PoolId -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#JoinPool"><span class="hs-identifier hs-var">Api.JoinPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480450"><span class="hs-identifier hs-var">apiStakePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682480448"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4058"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4059"></span><span>
</span><span id="line-4060"></span><span>            </span><span class="annot"><span class="annottext">DelegationAction
</span><a href="Cardano.Wallet.Transaction.html#Quit"><span class="hs-identifier hs-var">Quit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ApiCertificate] -&gt; NonEmpty ApiCertificate
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-4061"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
</span><a href="Cardano.Wallet.Api.Types.html#QuitPool"><span class="hs-identifier hs-var">Api.QuitPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480450"><span class="hs-identifier hs-var">apiStakePath</span></a></span><span>
</span><span id="line-4062"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4063"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-4064"></span><span>        </span><span id="local-6989586621682480450"><span class="annot"><span class="annottext">apiStakePath :: NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682480450"><span class="hs-identifier hs-var hs-var">apiStakePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480453"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-4065"></span><span>
</span><span id="line-4066"></span><span>    </span><span class="annot"><a href="#local-6989586621682480476"><span class="hs-identifier hs-type">mkApiCoinSelectionInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682483848"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4067"></span><span>    </span><span id="local-6989586621682480476"><span class="annot"><span class="annottext">mkApiCoinSelectionInput :: input -&gt; ApiWalletInput n
</span><a href="#local-6989586621682480476"><span class="hs-identifier hs-var hs-var">mkApiCoinSelectionInput</span></a></span></span><span>
</span><span id="line-4068"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span id="local-6989586621682480447"><span class="annot"><a href="#local-6989586621682480447"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621682480446"><span class="annot"><a href="#local-6989586621682480446"><span class="hs-identifier hs-var">index</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682480445"><span class="annot"><a href="#local-6989586621682480445"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span id="local-6989586621682480444"><span class="annot"><a href="#local-6989586621682480444"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span id="local-6989586621682480443"><span class="annot"><a href="#local-6989586621682480443"><span class="hs-identifier hs-var">assets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480442"><span class="annot"><a href="#local-6989586621682480442"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4069"></span><span>        </span><span class="annot"><span class="annottext">ApiWalletInput :: forall (n :: NetworkDiscriminant).
ApiT (Hash &quot;Tx&quot;)
-&gt; Word32
-&gt; (ApiT Address, Proxy n)
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiWalletInput n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWalletInput"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span>
</span><span id="line-4070"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiWalletInput :: ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiWalletInput"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682480447"><span class="hs-identifier hs-var">txid</span></a></span><span>
</span><span id="line-4071"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:index:ApiWalletInput :: Word32
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aindex%3AApiWalletInput"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682480446"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-4072"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletInput :: (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aaddress%3AApiWalletInput"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480445"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4073"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletInput :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiWalletInput"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480444"><span class="hs-identifier hs-var">amount</span></a></span><span>
</span><span id="line-4074"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletInput :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiWalletInput"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480443"><span class="hs-identifier hs-var">assets</span></a></span><span>
</span><span id="line-4075"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletInput :: NonEmpty (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AderivationPath%3AApiWalletInput"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480442"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-4076"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4077"></span><span>
</span><span id="line-4078"></span><span>    </span><span class="annot"><a href="#local-6989586621682480473"><span class="hs-identifier hs-type">mkApiCoinSelectionOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682483847"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionOutput"><span class="hs-identifier hs-type">ApiCoinSelectionOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4079"></span><span>    </span><span id="local-6989586621682480473"><span class="annot"><span class="annottext">mkApiCoinSelectionOutput :: output -&gt; ApiCoinSelectionOutput n
</span><a href="#local-6989586621682480473"><span class="hs-identifier hs-var hs-var">mkApiCoinSelectionOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682480441"><span class="annot"><a href="#local-6989586621682480441"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span id="local-6989586621682480440"><span class="annot"><a href="#local-6989586621682480440"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span id="local-6989586621682480439"><span class="annot"><a href="#local-6989586621682480439"><span class="hs-identifier hs-var">assets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4080"></span><span>        </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiCoinSelectionOutput n
forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiCoinSelectionOutput n
</span><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionOutput"><span class="hs-identifier hs-var">ApiCoinSelectionOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480441"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4081"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480440"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4082"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480439"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4083"></span><span>
</span><span id="line-4084"></span><span>    </span><span class="annot"><a href="#local-6989586621682480470"><span class="hs-identifier hs-type">mkApiCoinSelectionChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682483846"><span class="hs-identifier hs-type">change</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionChange"><span class="hs-identifier hs-type">ApiCoinSelectionChange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4085"></span><span>    </span><span id="local-6989586621682480470"><span class="annot"><span class="annottext">mkApiCoinSelectionChange :: change -&gt; ApiCoinSelectionChange n
</span><a href="#local-6989586621682480470"><span class="hs-identifier hs-var hs-var">mkApiCoinSelectionChange</span></a></span></span><span> </span><span id="local-6989586621682480437"><span class="annot"><span class="annottext">change
</span><a href="#local-6989586621682480437"><span class="hs-identifier hs-var">txChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4086"></span><span>        </span><span class="annot"><span class="annottext">ApiCoinSelectionChange :: forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiCoinSelectionChange n
</span><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionChange"><span class="hs-identifier hs-type">ApiCoinSelectionChange</span></a></span><span>
</span><span id="line-4087"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiCoinSelectionChange :: (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aaddress%3AApiCoinSelectionChange"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4088"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; ApiT Address) -&gt; Address -&gt; ApiT Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; change -&gt; Const Address change)
-&gt; change -&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; change -&gt; Const Address change)
(Address -&gt; Const Address Address)
-&gt; change -&gt; Const Address change
</span><a href="#local-6989586621682480434"><span class="hs-var">#address</span></a></span><span> </span><span class="annot"><span class="annottext">change
</span><a href="#local-6989586621682480437"><span class="hs-identifier hs-var">txChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4089"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiCoinSelectionChange :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiCoinSelectionChange"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4090"></span><span>                </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin) -&gt; change -&gt; Const Coin change)
-&gt; change -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;amount&quot; ((Coin -&gt; Const Coin Coin) -&gt; change -&gt; Const Coin change)
(Coin -&gt; Const Coin Coin) -&gt; change -&gt; Const Coin change
</span><a href="#local-6989586621682480432"><span class="hs-var">#amount</span></a></span><span> </span><span class="annot"><span class="annottext">change
</span><a href="#local-6989586621682480437"><span class="hs-identifier hs-var">txChange</span></a></span><span>
</span><span id="line-4091"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiCoinSelectionChange :: ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiCoinSelectionChange"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4092"></span><span>                </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenMap -&gt; ApiT TokenMap) -&gt; TokenMap -&gt; ApiT TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TokenMap -&gt; Const TokenMap TokenMap)
 -&gt; change -&gt; Const TokenMap change)
-&gt; change -&gt; TokenMap
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; change -&gt; Const TokenMap change)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; change -&gt; Const TokenMap change
</span><a href="#local-6989586621682480430"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">change
</span><a href="#local-6989586621682480437"><span class="hs-identifier hs-var">txChange</span></a></span><span>
</span><span id="line-4093"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiCoinSelectionChange :: NonEmpty (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AderivationPath%3AApiCoinSelectionChange"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4094"></span><span>                </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty DerivationIndex
  -&gt; Const (NonEmpty DerivationIndex) (NonEmpty DerivationIndex))
 -&gt; change -&gt; Const (NonEmpty DerivationIndex) change)
-&gt; change -&gt; NonEmpty DerivationIndex
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;derivationPath&quot;
  ((NonEmpty DerivationIndex
    -&gt; Const (NonEmpty DerivationIndex) (NonEmpty DerivationIndex))
   -&gt; change -&gt; Const (NonEmpty DerivationIndex) change)
(NonEmpty DerivationIndex
 -&gt; Const (NonEmpty DerivationIndex) (NonEmpty DerivationIndex))
-&gt; change -&gt; Const (NonEmpty DerivationIndex) change
</span><a href="#local-6989586621682480428"><span class="hs-var">#derivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">change
</span><a href="#local-6989586621682480437"><span class="hs-identifier hs-var">txChange</span></a></span><span>
</span><span id="line-4095"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4096"></span><span>
</span><span id="line-4097"></span><span>    </span><span class="annot"><a href="#local-6989586621682480467"><span class="hs-identifier hs-type">mkApiCoinSelectionCollateral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682483848"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionCollateral"><span class="hs-identifier hs-type">ApiCoinSelectionCollateral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4098"></span><span>    </span><span id="local-6989586621682480467"><span class="annot"><span class="annottext">mkApiCoinSelectionCollateral :: input -&gt; ApiCoinSelectionCollateral n
</span><a href="#local-6989586621682480467"><span class="hs-identifier hs-var hs-var">mkApiCoinSelectionCollateral</span></a></span></span><span>
</span><span id="line-4099"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span id="local-6989586621682480427"><span class="annot"><a href="#local-6989586621682480427"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621682480426"><span class="annot"><a href="#local-6989586621682480426"><span class="hs-identifier hs-var">index</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682480425"><span class="annot"><a href="#local-6989586621682480425"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle</span></a></span><span> </span><span id="local-6989586621682480424"><span class="annot"><a href="#local-6989586621682480424"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480423"><span class="annot"><a href="#local-6989586621682480423"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4100"></span><span>        </span><span class="annot"><span class="annottext">ApiCoinSelectionCollateral :: forall (n :: NetworkDiscriminant).
ApiT (Hash &quot;Tx&quot;)
-&gt; Word32
-&gt; (ApiT Address, Proxy n)
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiCoinSelectionCollateral n
</span><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionCollateral"><span class="hs-identifier hs-type">ApiCoinSelectionCollateral</span></a></span><span>
</span><span id="line-4101"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiCoinSelectionCollateral :: ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiCoinSelectionCollateral"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682480427"><span class="hs-identifier hs-var">txid</span></a></span><span>
</span><span id="line-4102"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:index:ApiCoinSelectionCollateral :: Word32
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aindex%3AApiCoinSelectionCollateral"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682480426"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-4103"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiCoinSelectionCollateral :: (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aaddress%3AApiCoinSelectionCollateral"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480425"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4104"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiCoinSelectionCollateral :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiCoinSelectionCollateral"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480424"><span class="hs-identifier hs-var">amount</span></a></span><span>
</span><span id="line-4105"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiCoinSelectionCollateral :: NonEmpty (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AderivationPath%3AApiCoinSelectionCollateral"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480423"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-4106"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4107"></span><span>
</span><span id="line-4108"></span><span>    </span><span class="annot"><a href="#local-6989586621682480464"><span class="hs-identifier hs-type">mkApiCoinSelectionWithdrawal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682483845"><span class="hs-identifier hs-type">withdrawal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionWithdrawal"><span class="hs-identifier hs-type">ApiCoinSelectionWithdrawal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4109"></span><span>    </span><span id="local-6989586621682480464"><span class="annot"><span class="annottext">mkApiCoinSelectionWithdrawal :: withdrawal -&gt; ApiCoinSelectionWithdrawal n
</span><a href="#local-6989586621682480464"><span class="hs-identifier hs-var hs-var">mkApiCoinSelectionWithdrawal</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480416"><span class="annot"><a href="#local-6989586621682480416"><span class="hs-identifier hs-var">rewardAcct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480415"><span class="annot"><a href="#local-6989586621682480415"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480414"><span class="annot"><a href="#local-6989586621682480414"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4110"></span><span>        </span><span class="annot"><span class="annottext">ApiCoinSelectionWithdrawal :: forall k (n :: k).
(ApiT RewardAccount, Proxy n)
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiCoinSelectionWithdrawal n
</span><a href="Cardano.Wallet.Api.Types.html#ApiCoinSelectionWithdrawal"><span class="hs-identifier hs-type">ApiCoinSelectionWithdrawal</span></a></span><span>
</span><span id="line-4111"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:stakeAddress:ApiCoinSelectionWithdrawal :: (ApiT RewardAccount, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AstakeAddress%3AApiCoinSelectionWithdrawal"><span class="hs-identifier hs-var">stakeAddress</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4112"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480416"><span class="hs-identifier hs-var">rewardAcct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483844"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4113"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiCoinSelectionWithdrawal :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiCoinSelectionWithdrawal"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4114"></span><span>                </span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall n. Integral n =&gt; Coin -&gt; Quantity &quot;lovelace&quot; n
</span><a href="Cardano.Wallet.Api.Types.html#coinToQuantity"><span class="hs-identifier hs-var">coinToQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480415"><span class="hs-identifier hs-var">wdrl</span></a></span><span>
</span><span id="line-4115"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiCoinSelectionWithdrawal :: NonEmpty (ApiT DerivationIndex)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AderivationPath%3AApiCoinSelectionWithdrawal"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4116"></span><span>                </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivationIndex -&gt; ApiT DerivationIndex)
-&gt; NonEmpty DerivationIndex -&gt; NonEmpty (ApiT DerivationIndex)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DerivationIndex
</span><a href="#local-6989586621682480414"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-4117"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4118"></span><span>
</span><span id="line-4119"></span><span id="local-6989586621682480408"><span id="local-6989586621682480409"></span></span><span class="hs-keyword">data</span><span> </span><span id="MkApiTransactionParams"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-var">MkApiTransactionParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MkApiTransactionParams"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-var">MkApiTransactionParams</span></a></span></span><span>
</span><span id="line-4120"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtxId%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Hash &quot;Tx&quot;
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxId%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Tx&quot;</span></span><span>
</span><span id="line-4121"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxFee%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Maybe Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxFee%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txFee</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-4122"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txInputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4123"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; [(TxIn, Maybe TxOut)]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralInputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txCollateralInputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4124"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; [TxOut]
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxOutputs%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txOutputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4125"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Maybe TxOut
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxCollateralOutput%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txCollateralOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-4126"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Map RewardAccount Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxWithdrawals%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txWithdrawals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-4127"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxMeta%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; TxMeta
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMeta%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txMeta</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxMeta"><span class="hs-identifier hs-type">W.TxMeta</span></a></span><span>
</span><span id="line-4128"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Maybe TxMetadata
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadata%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">W.TxMetadata</span></a></span><span>
</span><span id="line-4129"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxTime%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; UTCTime
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxTime%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-4130"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Maybe TxScriptValidity
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxScriptValidity%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txScriptValidity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxScriptValidity"><span class="hs-identifier hs-type">W.TxScriptValidity</span></a></span><span>
</span><span id="line-4131"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; Coin
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxDeposit%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txDeposit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-4132"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; TxMetadataSchema
</span><a href="Cardano.Wallet.Api.Server.html#%24sel%3AtxMetadataSchema%3AMkApiTransactionParams"><span class="hs-identifier hs-var hs-var">txMetadataSchema</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataSchema"><span class="hs-identifier hs-type">TxMetadataSchema</span></a></span><span>
</span><span id="line-4133"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-4134"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480404"><span id="local-6989586621682480406"><span class="annot"><span class="annottext">MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool
(MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool)
-&gt; (MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool)
-&gt; Eq MkApiTransactionParams
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool
$c/= :: MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool
== :: MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool
$c== :: MkApiTransactionParams -&gt; MkApiTransactionParams -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. MkApiTransactionParams -&gt; Rep MkApiTransactionParams x)
-&gt; (forall x.
    Rep MkApiTransactionParams x -&gt; MkApiTransactionParams)
-&gt; Generic MkApiTransactionParams
forall x. Rep MkApiTransactionParams x -&gt; MkApiTransactionParams
forall x. MkApiTransactionParams -&gt; Rep MkApiTransactionParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep MkApiTransactionParams x -&gt; MkApiTransactionParams
$cfrom :: forall x. MkApiTransactionParams -&gt; Rep MkApiTransactionParams x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480395"><span id="local-6989586621682480397"><span id="local-6989586621682480399"><span class="annot"><span class="annottext">Int -&gt; MkApiTransactionParams -&gt; ShowS
[MkApiTransactionParams] -&gt; ShowS
MkApiTransactionParams -&gt; String
(Int -&gt; MkApiTransactionParams -&gt; ShowS)
-&gt; (MkApiTransactionParams -&gt; String)
-&gt; ([MkApiTransactionParams] -&gt; ShowS)
-&gt; Show MkApiTransactionParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MkApiTransactionParams] -&gt; ShowS
$cshowList :: [MkApiTransactionParams] -&gt; ShowS
show :: MkApiTransactionParams -&gt; String
$cshow :: MkApiTransactionParams -&gt; String
showsPrec :: Int -&gt; MkApiTransactionParams -&gt; ShowS
$cshowsPrec :: Int -&gt; MkApiTransactionParams -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-4135"></span><span>
</span><span id="line-4136"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-type">mkApiTransaction</span></a></span><span>
</span><span id="line-4137"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483682"><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4138"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4139"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier hs-type">ApiBlockReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4140"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MkApiTransactionParams"><span class="hs-identifier hs-type">MkApiTransactionParams</span></a></span><span>
</span><span id="line-4141"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4142"></span><span id="mkApiTransaction"><span class="annot"><span class="annottext">mkApiTransaction :: TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; Lens' (ApiTransaction n) (Maybe ApiBlockReference)
-&gt; MkApiTransactionParams
-&gt; IO (ApiTransaction n)
</span><a href="Cardano.Wallet.Api.Server.html#mkApiTransaction"><span class="hs-identifier hs-var hs-var">mkApiTransaction</span></a></span></span><span> </span><span id="local-6989586621682480394"><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480394"><span class="hs-identifier hs-var">timeInterpreter</span></a></span></span><span> </span><span id="local-6989586621682480393"><span class="annot"><span class="annottext">Lens' (ApiTransaction n) (Maybe ApiBlockReference)
</span><a href="#local-6989586621682480393"><span class="hs-identifier hs-var">setTimeReference</span></a></span></span><span> </span><span id="local-6989586621682480392"><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4143"></span><span>    </span><span id="local-6989586621682480391"><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682480391"><span class="hs-identifier hs-var">timeRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;time&quot;
  ((UTCTime -&gt; Identity UTCTime)
   -&gt; ApiBlockReference -&gt; Identity ApiBlockReference)
(UTCTime -&gt; Identity UTCTime)
-&gt; ApiBlockReference -&gt; Identity ApiBlockReference
</span><a href="#local-6989586621682480390"><span class="hs-var">#time</span></a></span><span> </span><span class="annot"><span class="annottext">((UTCTime -&gt; Identity UTCTime)
 -&gt; ApiBlockReference -&gt; Identity ApiBlockReference)
-&gt; UTCTime -&gt; ApiBlockReference -&gt; ApiBlockReference
forall a b s t.
((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; b -&gt; s -&gt; t
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((UTCTime -&gt; Const UTCTime UTCTime)
    -&gt; MkApiTransactionParams -&gt; Const UTCTime MkApiTransactionParams)
-&gt; UTCTime
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txTime&quot;
  ((UTCTime -&gt; Const UTCTime UTCTime)
   -&gt; MkApiTransactionParams -&gt; Const UTCTime MkApiTransactionParams)
(UTCTime -&gt; Const UTCTime UTCTime)
-&gt; MkApiTransactionParams -&gt; Const UTCTime MkApiTransactionParams
</span><a href="#local-6989586621682480389"><span class="hs-var">#txTime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ApiBlockReference -&gt; ApiBlockReference)
-&gt; IO ApiBlockReference -&gt; IO ApiBlockReference
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO
-&gt; SlotNo -&gt; Quantity &quot;block&quot; Natural -&gt; IO ApiBlockReference
forall (m :: * -&gt; *).
Monad m =&gt;
TimeInterpreter m
-&gt; SlotNo -&gt; Quantity &quot;block&quot; Natural -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReference"><span class="hs-identifier hs-var">makeApiBlockReference</span></a></span><span>
</span><span id="line-4144"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#neverFails"><span class="hs-identifier hs-var">neverFails</span></a></span><span>
</span><span id="line-4145"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;makeApiBlockReference shouldn't fail getting the time of \
            \transactions with slots in the past&quot;</span></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480394"><span class="hs-identifier hs-var">timeInterpreter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4147"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; MkApiTransactionParams -&gt; Const SlotNo MkApiTransactionParams)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const SlotNo TxMeta)
   -&gt; MkApiTransactionParams -&gt; Const SlotNo MkApiTransactionParams)
(TxMeta -&gt; Const SlotNo TxMeta)
-&gt; MkApiTransactionParams -&gt; Const SlotNo MkApiTransactionParams
</span><a href="#local-6989586621682480387"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const SlotNo TxMeta)
 -&gt; MkApiTransactionParams -&gt; Const SlotNo MkApiTransactionParams)
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; TxMeta -&gt; Const SlotNo TxMeta)
-&gt; (SlotNo -&gt; Const SlotNo SlotNo)
-&gt; MkApiTransactionParams
-&gt; Const SlotNo MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo) -&gt; TxMeta -&gt; Const SlotNo TxMeta)
(SlotNo -&gt; Const SlotNo SlotNo) -&gt; TxMeta -&gt; Const SlotNo TxMeta
</span><a href="#local-6989586621682480386"><span class="hs-var">#slotNo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4148"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Word32 -&gt; Quantity &quot;block&quot; Natural
forall (q :: Symbol). Quantity q Word32 -&gt; Quantity q Natural
</span><a href="Cardano.Wallet.Api.Server.html#natural"><span class="hs-identifier hs-var">natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; MkApiTransactionParams
    -&gt; Const (Quantity &quot;block&quot; Word32) MkApiTransactionParams)
-&gt; Quantity &quot;block&quot; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const (Quantity &quot;block&quot; Word32) TxMeta)
   -&gt; MkApiTransactionParams
   -&gt; Const (Quantity &quot;block&quot; Word32) MkApiTransactionParams)
(TxMeta -&gt; Const (Quantity &quot;block&quot; Word32) TxMeta)
-&gt; MkApiTransactionParams
-&gt; Const (Quantity &quot;block&quot; Word32) MkApiTransactionParams
</span><a href="#local-6989586621682480384"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const (Quantity &quot;block&quot; Word32) TxMeta)
 -&gt; MkApiTransactionParams
 -&gt; Const (Quantity &quot;block&quot; Word32) MkApiTransactionParams)
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; TxMeta -&gt; Const (Quantity &quot;block&quot; Word32) TxMeta)
-&gt; (Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; MkApiTransactionParams
-&gt; Const (Quantity &quot;block&quot; Word32) MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
   -&gt; TxMeta -&gt; Const (Quantity &quot;block&quot; Word32) TxMeta)
(Quantity &quot;block&quot; Word32
 -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; TxMeta -&gt; Const (Quantity &quot;block&quot; Word32) TxMeta
</span><a href="#local-6989586621682480383"><span class="hs-var">#blockHeight</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4149"></span><span>
</span><span id="line-4150"></span><span>    </span><span id="local-6989586621682480382"><span class="annot"><span class="annottext">Maybe ApiSlotReference
</span><a href="#local-6989586621682480382"><span class="hs-identifier hs-var">expRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; IO ApiSlotReference)
-&gt; Maybe SlotNo -&gt; IO (Maybe ApiSlotReference)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; IO ApiSlotReference
</span><a href="#local-6989586621682480381"><span class="hs-identifier hs-var">makeApiSlotReference'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Maybe SlotNo -&gt; Const (Maybe SlotNo) (Maybe SlotNo))
    -&gt; MkApiTransactionParams
    -&gt; Const (Maybe SlotNo) MkApiTransactionParams)
-&gt; Maybe SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const (Maybe SlotNo) TxMeta)
   -&gt; MkApiTransactionParams
   -&gt; Const (Maybe SlotNo) MkApiTransactionParams)
(TxMeta -&gt; Const (Maybe SlotNo) TxMeta)
-&gt; MkApiTransactionParams
-&gt; Const (Maybe SlotNo) MkApiTransactionParams
</span><a href="#local-6989586621682480380"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const (Maybe SlotNo) TxMeta)
 -&gt; MkApiTransactionParams
 -&gt; Const (Maybe SlotNo) MkApiTransactionParams)
-&gt; ((Maybe SlotNo -&gt; Const (Maybe SlotNo) (Maybe SlotNo))
    -&gt; TxMeta -&gt; Const (Maybe SlotNo) TxMeta)
-&gt; (Maybe SlotNo -&gt; Const (Maybe SlotNo) (Maybe SlotNo))
-&gt; MkApiTransactionParams
-&gt; Const (Maybe SlotNo) MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;expiry&quot;
  ((Maybe SlotNo -&gt; Const (Maybe SlotNo) (Maybe SlotNo))
   -&gt; TxMeta -&gt; Const (Maybe SlotNo) TxMeta)
(Maybe SlotNo -&gt; Const (Maybe SlotNo) (Maybe SlotNo))
-&gt; TxMeta -&gt; Const (Maybe SlotNo) TxMeta
</span><a href="#local-6989586621682480379"><span class="hs-var">#expiry</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4151"></span><span>    </span><span class="annot"><span class="annottext">ApiTransaction n -&gt; IO (ApiTransaction n)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTransaction n -&gt; IO (ApiTransaction n))
-&gt; ApiTransaction n -&gt; IO (ApiTransaction n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTransaction n
</span><a href="#local-6989586621682480378"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTransaction n
-&gt; (ApiTransaction n -&gt; ApiTransaction n) -&gt; ApiTransaction n
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ApiBlockReference -&gt; Identity (Maybe ApiBlockReference))
-&gt; ApiTransaction n -&gt; Identity (ApiTransaction n)
Lens' (ApiTransaction n) (Maybe ApiBlockReference)
</span><a href="#local-6989586621682480393"><span class="hs-identifier hs-var">setTimeReference</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe ApiBlockReference -&gt; Identity (Maybe ApiBlockReference))
 -&gt; ApiTransaction n -&gt; Identity (ApiTransaction n))
-&gt; Maybe ApiBlockReference -&gt; ApiTransaction n -&gt; ApiTransaction n
forall a b s t.
((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; b -&gt; s -&gt; t
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBlockReference -&gt; Maybe ApiBlockReference
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBlockReference
</span><a href="#local-6989586621682480391"><span class="hs-identifier hs-var">timeRef</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTransaction n
-&gt; (ApiTransaction n -&gt; ApiTransaction n) -&gt; ApiTransaction n
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;expiresAt&quot;
  ((Maybe ApiSlotReference -&gt; Identity (Maybe ApiSlotReference))
   -&gt; ApiTransaction n -&gt; Identity (ApiTransaction n))
(Maybe ApiSlotReference -&gt; Identity (Maybe ApiSlotReference))
-&gt; ApiTransaction n -&gt; Identity (ApiTransaction n)
</span><a href="#local-6989586621682480377"><span class="hs-var">#expiresAt</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe ApiSlotReference -&gt; Identity (Maybe ApiSlotReference))
 -&gt; ApiTransaction n -&gt; Identity (ApiTransaction n))
-&gt; Maybe ApiSlotReference -&gt; ApiTransaction n -&gt; ApiTransaction n
forall a b s t.
((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; b -&gt; s -&gt; t
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiSlotReference
</span><a href="#local-6989586621682480382"><span class="hs-identifier hs-var">expRef</span></a></span><span>
</span><span id="line-4152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4153"></span><span>    </span><span class="hs-comment">-- Since tx expiry can be far in the future, we use unsafeExtendSafeZone for</span><span>
</span><span id="line-4154"></span><span>    </span><span class="hs-comment">-- now.</span><span>
</span><span id="line-4155"></span><span>    </span><span id="local-6989586621682480381"><span class="annot"><span class="annottext">makeApiSlotReference' :: SlotNo -&gt; IO ApiSlotReference
</span><a href="#local-6989586621682480381"><span class="hs-identifier hs-var hs-var">makeApiSlotReference'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter IO -&gt; SlotNo -&gt; IO ApiSlotReference
forall (m :: * -&gt; *).
Monad m =&gt;
TimeInterpreter m -&gt; SlotNo -&gt; m ApiSlotReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiSlotReference"><span class="hs-identifier hs-var">makeApiSlotReference</span></a></span><span>
</span><span id="line-4156"></span><span>        </span><span class="annot"><span class="annottext">(TimeInterpreter IO -&gt; SlotNo -&gt; IO ApiSlotReference)
-&gt; TimeInterpreter IO -&gt; SlotNo -&gt; IO ApiSlotReference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
-&gt; TimeInterpreter IO
</span><a href="Cardano.Wallet.Primitive.Slotting.html#unsafeExtendSafeZone"><span class="hs-identifier hs-var">unsafeExtendSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter (ExceptT PastHorizonException IO)
</span><a href="#local-6989586621682480394"><span class="hs-identifier hs-var">timeInterpreter</span></a></span><span>
</span><span id="line-4157"></span><span>
</span><span id="line-4158"></span><span>    </span><span class="annot"><a href="#local-6989586621682480378"><span class="hs-identifier hs-type">apiTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4159"></span><span>    </span><span id="local-6989586621682480378"><span class="annot"><span class="annottext">apiTx :: ApiTransaction n
</span><a href="#local-6989586621682480378"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTransaction :: forall (n :: NetworkDiscriminant).
ApiT (Hash &quot;Tx&quot;)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Maybe ApiBlockReference
-&gt; Maybe ApiBlockReference
-&gt; Maybe ApiSlotReference
-&gt; Maybe (Quantity &quot;block&quot; Natural)
-&gt; ApiT Direction
-&gt; [ApiTxInput n]
-&gt; [ApiTxOutput n]
-&gt; [ApiTxCollateral n]
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutput n))
-&gt; [ApiWithdrawal n]
-&gt; ApiT TxStatus
-&gt; Maybe TxMetadataWithSchema
-&gt; Maybe (ApiT TxScriptValidity)
-&gt; ApiTransaction n
</span><a href="Cardano.Wallet.Api.Types.html#ApiTransaction"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span>
</span><span id="line-4160"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiTransaction :: ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiTransaction"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)) -&gt; Hash &quot;Tx&quot; -&gt; ApiT (Hash &quot;Tx&quot;)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; MkApiTransactionParams
    -&gt; Const (Hash &quot;Tx&quot;) MkApiTransactionParams)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; MkApiTransactionParams
   -&gt; Const (Hash &quot;Tx&quot;) MkApiTransactionParams)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; MkApiTransactionParams
-&gt; Const (Hash &quot;Tx&quot;) MkApiTransactionParams
</span><a href="#local-6989586621682480374"><span class="hs-var">#txId</span></a></span><span>
</span><span id="line-4161"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiTransaction"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (Natural -&gt; Natural) -&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; MkApiTransactionParams -&gt; Const Natural MkApiTransactionParams)
-&gt; Natural
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const Natural TxMeta)
   -&gt; MkApiTransactionParams -&gt; Const Natural MkApiTransactionParams)
(TxMeta -&gt; Const Natural TxMeta)
-&gt; MkApiTransactionParams -&gt; Const Natural MkApiTransactionParams
</span><a href="#local-6989586621682480372"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const Natural TxMeta)
 -&gt; MkApiTransactionParams -&gt; Const Natural MkApiTransactionParams)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; TxMeta -&gt; Const Natural TxMeta)
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; MkApiTransactionParams
-&gt; Const Natural MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;amount&quot;
  ((Coin -&gt; Const Natural Coin) -&gt; TxMeta -&gt; Const Natural TxMeta)
(Coin -&gt; Const Natural Coin) -&gt; TxMeta -&gt; Const Natural TxMeta
</span><a href="#local-6989586621682480371"><span class="hs-var">#amount</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Const Natural Coin) -&gt; TxMeta -&gt; Const Natural TxMeta)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; Coin -&gt; Const Natural Coin)
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; TxMeta
-&gt; Const Natural TxMeta
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;unCoin&quot;
  ((Natural -&gt; Const Natural Natural) -&gt; Coin -&gt; Const Natural Coin)
(Natural -&gt; Const Natural Natural) -&gt; Coin -&gt; Const Natural Coin
</span><a href="#local-6989586621682480370"><span class="hs-var">#unCoin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4162"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fee:ApiTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Afee%3AApiTransaction"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; (Coin -&gt; Natural) -&gt; Maybe Coin -&gt; Natural
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; MkApiTransactionParams
    -&gt; Const (Maybe Coin) MkApiTransactionParams)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txFee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; MkApiTransactionParams
   -&gt; Const (Maybe Coin) MkApiTransactionParams)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; MkApiTransactionParams
-&gt; Const (Maybe Coin) MkApiTransactionParams
</span><a href="#local-6989586621682480368"><span class="hs-var">#txFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4163"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositTaken:ApiTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositTaken%3AApiTransaction"><span class="hs-identifier hs-var">depositTaken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480366"><span class="hs-identifier hs-var">depositIfAny</span></a></span><span>
</span><span id="line-4164"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depositReturned:ApiTransaction :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AdepositReturned%3AApiTransaction"><span class="hs-identifier hs-var">depositReturned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480364"><span class="hs-identifier hs-var">reclaimIfAny</span></a></span><span>
</span><span id="line-4165"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:insertedAt:ApiTransaction :: Maybe ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AinsertedAt%3AApiTransaction"><span class="hs-identifier hs-var">insertedAt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiBlockReference
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4166"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:pendingSince:ApiTransaction :: Maybe ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3ApendingSince%3AApiTransaction"><span class="hs-identifier hs-var">pendingSince</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiBlockReference
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4167"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:expiresAt:ApiTransaction :: Maybe ApiSlotReference
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AexpiresAt%3AApiTransaction"><span class="hs-identifier hs-var">expiresAt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiSlotReference
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4168"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:depth:ApiTransaction :: Maybe (Quantity &quot;block&quot; Natural)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adepth%3AApiTransaction"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Quantity &quot;block&quot; Natural)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4169"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:direction:ApiTransaction :: ApiT Direction
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adirection%3AApiTransaction"><span class="hs-identifier hs-var">direction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Direction -&gt; ApiT Direction
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Direction -&gt; Const Direction Direction)
    -&gt; MkApiTransactionParams
    -&gt; Const Direction MkApiTransactionParams)
-&gt; Direction
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const Direction TxMeta)
   -&gt; MkApiTransactionParams
   -&gt; Const Direction MkApiTransactionParams)
(TxMeta -&gt; Const Direction TxMeta)
-&gt; MkApiTransactionParams -&gt; Const Direction MkApiTransactionParams
</span><a href="#local-6989586621682480359"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const Direction TxMeta)
 -&gt; MkApiTransactionParams
 -&gt; Const Direction MkApiTransactionParams)
-&gt; ((Direction -&gt; Const Direction Direction)
    -&gt; TxMeta -&gt; Const Direction TxMeta)
-&gt; (Direction -&gt; Const Direction Direction)
-&gt; MkApiTransactionParams
-&gt; Const Direction MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((Direction -&gt; Const Direction Direction)
   -&gt; TxMeta -&gt; Const Direction TxMeta)
(Direction -&gt; Const Direction Direction)
-&gt; TxMeta -&gt; Const Direction TxMeta
</span><a href="#local-6989586621682480358"><span class="hs-var">#direction</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4170"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:inputs:ApiTransaction :: [ApiTxInput n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ainputs%3AApiTransaction"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4171"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiTxOutput n) -&gt; ApiT TxIn -&gt; ApiTxInput n
forall (n :: NetworkDiscriminant).
Maybe (ApiTxOutput n) -&gt; ApiT TxIn -&gt; ApiTxInput n
</span><a href="Cardano.Wallet.Api.Types.html#ApiTxInput"><span class="hs-identifier hs-var">ApiTxInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOut -&gt; ApiTxOutput n) -&gt; Maybe TxOut -&gt; Maybe (ApiTxOutput n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; ApiTxOutput n
forall (n :: NetworkDiscriminant).
TxOut -&gt; AddressAmount (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Server.html#toAddressAmount"><span class="hs-identifier hs-var">toAddressAmount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TxOut
</span><a href="#local-6989586621682480355"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; ApiT TxIn
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480354"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4172"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480354"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480354"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480355"><span class="annot"><span class="annottext">Maybe TxOut
</span><a href="#local-6989586621682480355"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; (([(TxIn, Maybe TxOut)]
     -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
    -&gt; MkApiTransactionParams
    -&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams)
-&gt; [(TxIn, Maybe TxOut)]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInputs&quot;
  (([(TxIn, Maybe TxOut)]
    -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
   -&gt; MkApiTransactionParams
   -&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams)
([(TxIn, Maybe TxOut)]
 -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
-&gt; MkApiTransactionParams
-&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams
</span><a href="#local-6989586621682480353"><span class="hs-var">#txInputs</span></a></span><span>
</span><span id="line-4173"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4174"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateral:ApiTransaction :: [ApiTxCollateral n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Acollateral%3AApiTransaction"><span class="hs-identifier hs-var">collateral</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4175"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Maybe (AddressAmountNoAssets (ApiT Address, Proxy n))
-&gt; ApiT TxIn -&gt; ApiTxCollateral n
forall (n :: NetworkDiscriminant).
Maybe (AddressAmountNoAssets (ApiT Address, Proxy n))
-&gt; ApiT TxIn -&gt; ApiTxCollateral n
</span><a href="Cardano.Wallet.Api.Types.html#ApiTxCollateral"><span class="hs-identifier hs-var">ApiTxCollateral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOut -&gt; AddressAmountNoAssets (ApiT Address, Proxy n))
-&gt; Maybe TxOut
-&gt; Maybe (AddressAmountNoAssets (ApiT Address, Proxy n))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; AddressAmountNoAssets (ApiT Address, Proxy n)
</span><a href="#local-6989586621682480350"><span class="hs-identifier hs-var">toAddressAmountNoAssets</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxOut
</span><a href="#local-6989586621682480349"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; ApiT TxIn
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480348"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4176"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480348"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480348"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480349"><span class="annot"><span class="annottext">Maybe TxOut
</span><a href="#local-6989586621682480349"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; (([(TxIn, Maybe TxOut)]
     -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
    -&gt; MkApiTransactionParams
    -&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams)
-&gt; [(TxIn, Maybe TxOut)]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txCollateralInputs&quot;
  (([(TxIn, Maybe TxOut)]
    -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
   -&gt; MkApiTransactionParams
   -&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams)
([(TxIn, Maybe TxOut)]
 -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
-&gt; MkApiTransactionParams
-&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams
</span><a href="#local-6989586621682480347"><span class="hs-var">#txCollateralInputs</span></a></span><span>
</span><span id="line-4177"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4178"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:outputs:ApiTransaction :: [ApiTxOutput n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aoutputs%3AApiTransaction"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; ApiTxOutput n
forall (n :: NetworkDiscriminant).
TxOut -&gt; AddressAmount (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Server.html#toAddressAmount"><span class="hs-identifier hs-var">toAddressAmount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; ApiTxOutput n) -&gt; [TxOut] -&gt; [ApiTxOutput n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut])
    -&gt; MkApiTransactionParams -&gt; Const [TxOut] MkApiTransactionParams)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; MkApiTransactionParams -&gt; Const [TxOut] MkApiTransactionParams)
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; MkApiTransactionParams -&gt; Const [TxOut] MkApiTransactionParams
</span><a href="#local-6989586621682480345"><span class="hs-var">#txOutputs</span></a></span><span>
</span><span id="line-4179"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:collateralOutputs:ApiTransaction :: ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutput n))
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AcollateralOutputs%3AApiTransaction"><span class="hs-identifier hs-var">collateralOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiTxOutput n)
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutput n))
forall (s :: Symbol) a. a -&gt; ApiAsArray s a
</span><a href="Cardano.Wallet.Api.Types.html#ApiAsArray"><span class="hs-identifier hs-var">ApiAsArray</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ApiTxOutput n)
 -&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutput n)))
-&gt; Maybe (ApiTxOutput n)
-&gt; ApiAsArray &quot;collateral_outputs&quot; (Maybe (ApiTxOutput n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4180"></span><span>            </span><span class="annot"><span class="annottext">TxOut -&gt; ApiTxOutput n
forall (n :: NetworkDiscriminant).
TxOut -&gt; AddressAmount (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Server.html#toAddressAmount"><span class="hs-identifier hs-var">toAddressAmount</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; ApiTxOutput n) -&gt; Maybe TxOut -&gt; Maybe (ApiTxOutput n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
    -&gt; MkApiTransactionParams
    -&gt; Const (Maybe TxOut) MkApiTransactionParams)
-&gt; Maybe TxOut
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txCollateralOutput&quot;
  ((Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
   -&gt; MkApiTransactionParams
   -&gt; Const (Maybe TxOut) MkApiTransactionParams)
(Maybe TxOut -&gt; Const (Maybe TxOut) (Maybe TxOut))
-&gt; MkApiTransactionParams
-&gt; Const (Maybe TxOut) MkApiTransactionParams
</span><a href="#local-6989586621682480343"><span class="hs-var">#txCollateralOutput</span></a></span><span>
</span><span id="line-4181"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:withdrawals:ApiTransaction :: [ApiWithdrawal n]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Awithdrawals%3AApiTransaction"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RewardAccount, Coin) -&gt; ApiWithdrawal n
forall (n :: NetworkDiscriminant).
(RewardAccount, Coin) -&gt; ApiWithdrawal n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiWithdrawal"><span class="hs-identifier hs-var">mkApiWithdrawal</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">((RewardAccount, Coin) -&gt; ApiWithdrawal n)
-&gt; [(RewardAccount, Coin)] -&gt; [ApiWithdrawal n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin -&gt; [(RewardAccount, Coin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; MkApiTransactionParams
    -&gt; Const (Map RewardAccount Coin) MkApiTransactionParams)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txWithdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; MkApiTransactionParams
   -&gt; Const (Map RewardAccount Coin) MkApiTransactionParams)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; MkApiTransactionParams
-&gt; Const (Map RewardAccount Coin) MkApiTransactionParams
</span><a href="#local-6989586621682480340"><span class="hs-var">#txWithdrawals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4182"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:status:ApiTransaction :: ApiT TxStatus
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Astatus%3AApiTransaction"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxStatus -&gt; ApiT TxStatus
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((TxStatus -&gt; Const TxStatus TxStatus)
    -&gt; MkApiTransactionParams -&gt; Const TxStatus MkApiTransactionParams)
-&gt; TxStatus
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const TxStatus TxMeta)
   -&gt; MkApiTransactionParams -&gt; Const TxStatus MkApiTransactionParams)
(TxMeta -&gt; Const TxStatus TxMeta)
-&gt; MkApiTransactionParams -&gt; Const TxStatus MkApiTransactionParams
</span><a href="#local-6989586621682480338"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const TxStatus TxMeta)
 -&gt; MkApiTransactionParams -&gt; Const TxStatus MkApiTransactionParams)
-&gt; ((TxStatus -&gt; Const TxStatus TxStatus)
    -&gt; TxMeta -&gt; Const TxStatus TxMeta)
-&gt; (TxStatus -&gt; Const TxStatus TxStatus)
-&gt; MkApiTransactionParams
-&gt; Const TxStatus MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((TxStatus -&gt; Const TxStatus TxStatus)
   -&gt; TxMeta -&gt; Const TxStatus TxMeta)
(TxStatus -&gt; Const TxStatus TxStatus)
-&gt; TxMeta -&gt; Const TxStatus TxMeta
</span><a href="#local-6989586621682480337"><span class="hs-var">#status</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4183"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:metadata:ApiTransaction :: Maybe TxMetadataWithSchema
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ametadata%3AApiTransaction"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataSchema -&gt; TxMetadata -&gt; TxMetadataWithSchema
</span><a href="Cardano.Wallet.Api.Types.SchemaMetadata.html#TxMetadataWithSchema"><span class="hs-identifier hs-var">TxMetadataWithSchema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((TxMetadataSchema -&gt; Const TxMetadataSchema TxMetadataSchema)
    -&gt; MkApiTransactionParams
    -&gt; Const TxMetadataSchema MkApiTransactionParams)
-&gt; TxMetadataSchema
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadataSchema&quot;
  ((TxMetadataSchema -&gt; Const TxMetadataSchema TxMetadataSchema)
   -&gt; MkApiTransactionParams
   -&gt; Const TxMetadataSchema MkApiTransactionParams)
(TxMetadataSchema -&gt; Const TxMetadataSchema TxMetadataSchema)
-&gt; MkApiTransactionParams
-&gt; Const TxMetadataSchema MkApiTransactionParams
</span><a href="#local-6989586621682480335"><span class="hs-var">#txMetadataSchema</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4184"></span><span>            </span><span class="annot"><span class="annottext">(TxMetadata -&gt; TxMetadataWithSchema)
-&gt; Maybe TxMetadata -&gt; Maybe TxMetadataWithSchema
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Maybe TxMetadata
     -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
    -&gt; MkApiTransactionParams
    -&gt; Const (Maybe TxMetadata) MkApiTransactionParams)
-&gt; Maybe TxMetadata
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadata&quot;
  ((Maybe TxMetadata -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
   -&gt; MkApiTransactionParams
   -&gt; Const (Maybe TxMetadata) MkApiTransactionParams)
(Maybe TxMetadata -&gt; Const (Maybe TxMetadata) (Maybe TxMetadata))
-&gt; MkApiTransactionParams
-&gt; Const (Maybe TxMetadata) MkApiTransactionParams
</span><a href="#local-6989586621682480334"><span class="hs-var">#txMetadata</span></a></span><span>
</span><span id="line-4185"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:scriptValidity:ApiTransaction :: Maybe (ApiT TxScriptValidity)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AscriptValidity%3AApiTransaction"><span class="hs-identifier hs-var">scriptValidity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity -&gt; ApiT TxScriptValidity
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TxScriptValidity -&gt; ApiT TxScriptValidity)
-&gt; Maybe TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Maybe TxScriptValidity
     -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
    -&gt; MkApiTransactionParams
    -&gt; Const (Maybe TxScriptValidity) MkApiTransactionParams)
-&gt; Maybe TxScriptValidity
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txScriptValidity&quot;
  ((Maybe TxScriptValidity
    -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
   -&gt; MkApiTransactionParams
   -&gt; Const (Maybe TxScriptValidity) MkApiTransactionParams)
(Maybe TxScriptValidity
 -&gt; Const (Maybe TxScriptValidity) (Maybe TxScriptValidity))
-&gt; MkApiTransactionParams
-&gt; Const (Maybe TxScriptValidity) MkApiTransactionParams
</span><a href="#local-6989586621682480332"><span class="hs-var">#txScriptValidity</span></a></span><span>
</span><span id="line-4186"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-4187"></span><span>
</span><span id="line-4188"></span><span>    </span><span class="annot"><a href="#local-6989586621682480366"><span class="hs-identifier hs-type">depositIfAny</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4189"></span><span>    </span><span id="local-6989586621682480366"><span class="annot"><span class="annottext">depositIfAny :: Natural
</span><a href="#local-6989586621682480366"><span class="hs-identifier hs-var hs-var">depositIfAny</span></a></span></span><span>
</span><span id="line-4190"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Direction -&gt; Const Direction Direction)
    -&gt; MkApiTransactionParams
    -&gt; Const Direction MkApiTransactionParams)
-&gt; Direction
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const Direction TxMeta)
   -&gt; MkApiTransactionParams
   -&gt; Const Direction MkApiTransactionParams)
(TxMeta -&gt; Const Direction TxMeta)
-&gt; MkApiTransactionParams -&gt; Const Direction MkApiTransactionParams
</span><a href="#local-6989586621682480331"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const Direction TxMeta)
 -&gt; MkApiTransactionParams
 -&gt; Const Direction MkApiTransactionParams)
-&gt; ((Direction -&gt; Const Direction Direction)
    -&gt; TxMeta -&gt; Const Direction TxMeta)
-&gt; (Direction -&gt; Const Direction Direction)
-&gt; MkApiTransactionParams
-&gt; Const Direction MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((Direction -&gt; Const Direction Direction)
   -&gt; TxMeta -&gt; Const Direction TxMeta)
(Direction -&gt; Const Direction Direction)
-&gt; TxMeta -&gt; Const Direction TxMeta
</span><a href="#local-6989586621682480330"><span class="hs-var">#direction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Outgoing"><span class="hs-identifier hs-var">W.Outgoing</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4191"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480328"><span class="hs-identifier hs-var">totalIn</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480327"><span class="hs-identifier hs-var">totalOut</span></a></span><span>
</span><span id="line-4192"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-4193"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480328"><span class="hs-identifier hs-var">totalIn</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480327"><span class="hs-identifier hs-var">totalOut</span></a></span><span>
</span><span id="line-4194"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-4195"></span><span>
</span><span id="line-4196"></span><span>    </span><span class="hs-comment">-- (pending) when reclaim is coming we have (fee+out) - inp = deposit</span><span>
</span><span id="line-4197"></span><span>    </span><span class="hs-comment">-- tx is incoming, and the wallet spent for fee and received deposit - fee as out</span><span>
</span><span id="line-4198"></span><span>    </span><span class="hs-comment">-- (inLedger) when reclaim is accommodated we have out - inp &lt; deposit as fee was incurred</span><span>
</span><span id="line-4199"></span><span>    </span><span class="hs-comment">-- So in order to detect this we need to have</span><span>
</span><span id="line-4200"></span><span>    </span><span class="hs-comment">-- 1. deposit</span><span>
</span><span id="line-4201"></span><span>    </span><span class="hs-comment">-- 2. have inpsWithoutFee of the wallet non-empty</span><span>
</span><span id="line-4202"></span><span>    </span><span class="hs-comment">-- 3. outs of the wallet non-empty</span><span>
</span><span id="line-4203"></span><span>    </span><span class="hs-comment">-- 4. tx Incoming</span><span>
</span><span id="line-4204"></span><span>    </span><span class="hs-comment">-- 5. outs - inpsWithoutFee &lt;= deposit</span><span>
</span><span id="line-4205"></span><span>    </span><span class="hs-comment">-- assumption: this should work when</span><span>
</span><span id="line-4206"></span><span>    </span><span class="annot"><a href="#local-6989586621682480326"><span class="hs-identifier hs-type">depositValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4207"></span><span>    </span><span id="local-6989586621682480326"><span class="annot"><span class="annottext">depositValue :: Natural
</span><a href="#local-6989586621682480326"><span class="hs-identifier hs-var hs-var">depositValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; MkApiTransactionParams -&gt; Const Coin MkApiTransactionParams)
-&gt; Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txDeposit&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; MkApiTransactionParams -&gt; Const Coin MkApiTransactionParams)
(Coin -&gt; Const Coin Coin)
-&gt; MkApiTransactionParams -&gt; Const Coin MkApiTransactionParams
</span><a href="#local-6989586621682480325"><span class="hs-var">#txDeposit</span></a></span><span>
</span><span id="line-4208"></span><span>
</span><span id="line-4209"></span><span>    </span><span class="annot"><a href="#local-6989586621682480364"><span class="hs-identifier hs-type">reclaimIfAny</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4210"></span><span>    </span><span id="local-6989586621682480364"><span class="annot"><span class="annottext">reclaimIfAny :: Natural
</span><a href="#local-6989586621682480364"><span class="hs-identifier hs-var hs-var">reclaimIfAny</span></a></span></span><span>
</span><span id="line-4211"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Direction -&gt; Const Direction Direction)
    -&gt; MkApiTransactionParams
    -&gt; Const Direction MkApiTransactionParams)
-&gt; Direction
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;txMeta&quot;
  ((TxMeta -&gt; Const Direction TxMeta)
   -&gt; MkApiTransactionParams
   -&gt; Const Direction MkApiTransactionParams)
(TxMeta -&gt; Const Direction TxMeta)
-&gt; MkApiTransactionParams -&gt; Const Direction MkApiTransactionParams
</span><a href="#local-6989586621682480324"><span class="hs-var">#txMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMeta -&gt; Const Direction TxMeta)
 -&gt; MkApiTransactionParams
 -&gt; Const Direction MkApiTransactionParams)
-&gt; ((Direction -&gt; Const Direction Direction)
    -&gt; TxMeta -&gt; Const Direction TxMeta)
-&gt; (Direction -&gt; Const Direction Direction)
-&gt; MkApiTransactionParams
-&gt; Const Direction MkApiTransactionParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((Direction -&gt; Const Direction Direction)
   -&gt; TxMeta -&gt; Const Direction TxMeta)
(Direction -&gt; Const Direction Direction)
-&gt; TxMeta -&gt; Const Direction TxMeta
</span><a href="#local-6989586621682480323"><span class="hs-var">#direction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#Incoming"><span class="hs-identifier hs-var">W.Incoming</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4212"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480328"><span class="hs-identifier hs-var">totalIn</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480327"><span class="hs-identifier hs-var">totalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480327"><span class="hs-identifier hs-var">totalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480328"><span class="hs-identifier hs-var">totalIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4213"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480327"><span class="hs-identifier hs-var">totalOut</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480328"><span class="hs-identifier hs-var">totalIn</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480326"><span class="hs-identifier hs-var">depositValue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-4214"></span><span>                  </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480326"><span class="hs-identifier hs-var">depositValue</span></a></span><span>
</span><span id="line-4215"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-4216"></span><span>                  </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-4217"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-4218"></span><span>
</span><span id="line-4219"></span><span>    </span><span class="annot"><a href="#local-6989586621682480328"><span class="hs-identifier hs-type">totalIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4220"></span><span>    </span><span id="local-6989586621682480328"><span class="annot"><span class="annottext">totalIn :: Natural
</span><a href="#local-6989586621682480328"><span class="hs-identifier hs-var hs-var">totalIn</span></a></span></span><span>
</span><span id="line-4221"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Natural] -&gt; Natural
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Natural
</span><a href="#local-6989586621682480320"><span class="hs-identifier hs-var">txOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Natural) -&gt; [TxOut] -&gt; [Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, Maybe TxOut) -&gt; Maybe TxOut)
-&gt; [(TxIn, Maybe TxOut)] -&gt; [TxOut]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, Maybe TxOut) -&gt; Maybe TxOut
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; (([(TxIn, Maybe TxOut)]
     -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
    -&gt; MkApiTransactionParams
    -&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams)
-&gt; [(TxIn, Maybe TxOut)]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txInputs&quot;
  (([(TxIn, Maybe TxOut)]
    -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
   -&gt; MkApiTransactionParams
   -&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams)
([(TxIn, Maybe TxOut)]
 -&gt; Const [(TxIn, Maybe TxOut)] [(TxIn, Maybe TxOut)])
-&gt; MkApiTransactionParams
-&gt; Const [(TxIn, Maybe TxOut)] MkApiTransactionParams
</span><a href="#local-6989586621682480319"><span class="hs-var">#txInputs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4222"></span><span>        </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural] -&gt; Natural
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Natural) -&gt; [Coin] -&gt; [Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin -&gt; [Coin]
forall k a. Map k a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Map RewardAccount Coin
     -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
    -&gt; MkApiTransactionParams
    -&gt; Const (Map RewardAccount Coin) MkApiTransactionParams)
-&gt; Map RewardAccount Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txWithdrawals&quot;
  ((Map RewardAccount Coin
    -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
   -&gt; MkApiTransactionParams
   -&gt; Const (Map RewardAccount Coin) MkApiTransactionParams)
(Map RewardAccount Coin
 -&gt; Const (Map RewardAccount Coin) (Map RewardAccount Coin))
-&gt; MkApiTransactionParams
-&gt; Const (Map RewardAccount Coin) MkApiTransactionParams
</span><a href="#local-6989586621682480316"><span class="hs-var">#txWithdrawals</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4223"></span><span>
</span><span id="line-4224"></span><span>    </span><span class="annot"><a href="#local-6989586621682480327"><span class="hs-identifier hs-type">totalOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4225"></span><span>    </span><span id="local-6989586621682480327"><span class="annot"><span class="annottext">totalOut :: Natural
</span><a href="#local-6989586621682480327"><span class="hs-identifier hs-var hs-var">totalOut</span></a></span></span><span>
</span><span id="line-4226"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Natural] -&gt; Natural
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Natural
</span><a href="#local-6989586621682480320"><span class="hs-identifier hs-var">txOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Natural) -&gt; [TxOut] -&gt; [Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; (([TxOut] -&gt; Const [TxOut] [TxOut])
    -&gt; MkApiTransactionParams -&gt; Const [TxOut] MkApiTransactionParams)
-&gt; [TxOut]
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txOutputs&quot;
  (([TxOut] -&gt; Const [TxOut] [TxOut])
   -&gt; MkApiTransactionParams -&gt; Const [TxOut] MkApiTransactionParams)
([TxOut] -&gt; Const [TxOut] [TxOut])
-&gt; MkApiTransactionParams -&gt; Const [TxOut] MkApiTransactionParams
</span><a href="#local-6989586621682480315"><span class="hs-var">#txOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4227"></span><span>        </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; (Coin -&gt; Natural) -&gt; Maybe Coin -&gt; Natural
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkApiTransactionParams
</span><a href="#local-6989586621682480392"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">MkApiTransactionParams
-&gt; ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
    -&gt; MkApiTransactionParams
    -&gt; Const (Maybe Coin) MkApiTransactionParams)
-&gt; Maybe Coin
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txFee&quot;
  ((Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
   -&gt; MkApiTransactionParams
   -&gt; Const (Maybe Coin) MkApiTransactionParams)
(Maybe Coin -&gt; Const (Maybe Coin) (Maybe Coin))
-&gt; MkApiTransactionParams
-&gt; Const (Maybe Coin) MkApiTransactionParams
</span><a href="#local-6989586621682480314"><span class="hs-var">#txFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4228"></span><span>
</span><span id="line-4229"></span><span>    </span><span class="annot"><a href="#local-6989586621682480320"><span class="hs-identifier hs-type">txOutValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4230"></span><span>    </span><span id="local-6989586621682480320"><span class="annot"><span class="annottext">txOutValue :: TxOut -&gt; Natural
</span><a href="#local-6989586621682480320"><span class="hs-identifier hs-var hs-var">txOutValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Natural) -&gt; (TxOut -&gt; Natural) -&gt; TxOut -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Natural) -&gt; (TxOut -&gt; Coin) -&gt; TxOut -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#txOutCoin"><span class="hs-identifier hs-var">txOutCoin</span></a></span><span>
</span><span id="line-4231"></span><span>
</span><span id="line-4232"></span><span>    </span><span class="annot"><a href="#local-6989586621682480350"><span class="hs-identifier hs-type">toAddressAmountNoAssets</span></a></span><span>
</span><span id="line-4233"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-4234"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AddressAmountNoAssets"><span class="hs-identifier hs-type">AddressAmountNoAssets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4235"></span><span>    </span><span id="local-6989586621682480350"><span class="annot"><span class="annottext">toAddressAmountNoAssets :: TxOut -&gt; AddressAmountNoAssets (ApiT Address, Proxy n)
</span><a href="#local-6989586621682480350"><span class="hs-identifier hs-var hs-var">toAddressAmountNoAssets</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682480313"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480313"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span> </span><span id="local-6989586621682480312"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480312"><span class="hs-identifier hs-var">coin</span></a></span></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4236"></span><span>        </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; AddressAmountNoAssets (ApiT Address, Proxy n)
forall addr.
addr -&gt; Quantity &quot;lovelace&quot; Natural -&gt; AddressAmountNoAssets addr
</span><a href="Cardano.Wallet.Api.Types.html#AddressAmountNoAssets"><span class="hs-identifier hs-var">AddressAmountNoAssets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480313"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483682"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-var">mkApiCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480312"><span class="hs-identifier hs-var">coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4237"></span><span>
</span><span id="line-4238"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#toAddressAmount"><span class="hs-identifier hs-type">toAddressAmount</span></a></span><span>
</span><span id="line-4239"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682483418"><span class="annot"><a href="#local-6989586621682483418"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4240"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-4241"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AddressAmount"><span class="hs-identifier hs-type">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483418"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4242"></span><span id="toAddressAmount"><span class="annot"><span class="annottext">toAddressAmount :: TxOut -&gt; AddressAmount (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Server.html#toAddressAmount"><span class="hs-identifier hs-var hs-var">toAddressAmount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621682480310"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480310"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-type">TokenBundle.TokenBundle</span></a></span><span> </span><span id="local-6989586621682480309"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480309"><span class="hs-identifier hs-var">coin</span></a></span></span><span> </span><span id="local-6989586621682480308"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480308"><span class="hs-identifier hs-var">assets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4243"></span><span>    </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="Cardano.Wallet.Api.Types.html#AddressAmount"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; ApiT Address
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480310"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483418"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-var">mkApiCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480309"><span class="hs-identifier hs-var">coin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480308"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4244"></span><span>
</span><span id="line-4245"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-type">mkApiCoin</span></a></span><span>
</span><span id="line-4246"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-4247"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lovelace&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4248"></span><span id="mkApiCoin"><span class="annot"><span class="annottext">mkApiCoin :: Coin -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-var hs-var">mkApiCoin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621682480307"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480307"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480307"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-4249"></span><span>
</span><span id="line-4250"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiFee"><span class="hs-identifier hs-type">mkApiFee</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-type">FeeEstimation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiFee"><span class="hs-identifier hs-type">ApiFee</span></a></span><span>
</span><span id="line-4251"></span><span id="mkApiFee"><span class="annot"><span class="annottext">mkApiFee :: Maybe Coin -&gt; [Coin] -&gt; FeeEstimation -&gt; ApiFee
</span><a href="Cardano.Wallet.Api.Server.html#mkApiFee"><span class="hs-identifier hs-var hs-var">mkApiFee</span></a></span></span><span> </span><span id="local-6989586621682480306"><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682480306"><span class="hs-identifier hs-var">mDeposit</span></a></span></span><span> </span><span id="local-6989586621682480305"><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682480305"><span class="hs-identifier hs-var">minCoins</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#FeeEstimation"><span class="hs-identifier hs-type">FeeEstimation</span></a></span><span> </span><span id="local-6989586621682480304"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682480304"><span class="hs-identifier hs-var">estMin</span></a></span></span><span> </span><span id="local-6989586621682480303"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682480303"><span class="hs-identifier hs-var">estMax</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiFee :: Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiFee
</span><a href="Cardano.Wallet.Api.Types.html#ApiFee"><span class="hs-identifier hs-type">ApiFee</span></a></span><span>
</span><span id="line-4252"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:estimatedMin:ApiFee :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AestimatedMin%3AApiFee"><span class="hs-identifier hs-var">estimatedMin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Word64 -&gt; Quantity unit Natural
</span><a href="#local-6989586621682480300"><span class="hs-identifier hs-var">qty</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682480304"><span class="hs-identifier hs-var">estMin</span></a></span><span>
</span><span id="line-4253"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:estimatedMax:ApiFee :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AestimatedMax%3AApiFee"><span class="hs-identifier hs-var">estimatedMax</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Word64 -&gt; Quantity unit Natural
</span><a href="#local-6989586621682480300"><span class="hs-identifier hs-var">qty</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682480303"><span class="hs-identifier hs-var">estMax</span></a></span><span>
</span><span id="line-4254"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:minimumCoins:ApiFee :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AminimumCoins%3AApiFee"><span class="hs-identifier hs-var">minimumCoins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#toNatural"><span class="hs-identifier hs-var">Coin.toNatural</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; [Coin] -&gt; [Quantity &quot;lovelace&quot; Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin]
</span><a href="#local-6989586621682480305"><span class="hs-identifier hs-var">minCoins</span></a></span><span>
</span><span id="line-4255"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:deposit:ApiFee :: Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adeposit%3AApiFee"><span class="hs-identifier hs-var">deposit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (Coin -&gt; Natural) -&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Natural
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#toNatural"><span class="hs-identifier hs-var">Coin.toNatural</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Coin -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe Coin -&gt; Coin
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="#local-6989586621682480306"><span class="hs-identifier hs-var">mDeposit</span></a></span><span>
</span><span id="line-4256"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-4257"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4258"></span><span>    </span><span id="local-6989586621682480300"><span class="annot"><span class="annottext">qty :: Word64 -&gt; Quantity unit Natural
</span><a href="#local-6989586621682480300"><span class="hs-identifier hs-var hs-var">qty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity unit Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity unit Natural)
-&gt; (Word64 -&gt; Natural) -&gt; Word64 -&gt; Quantity unit Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span>
</span><span id="line-4259"></span><span>
</span><span id="line-4260"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#mkApiWithdrawal"><span class="hs-identifier hs-type">mkApiWithdrawal</span></a></span><span>
</span><span id="line-4261"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682483136"><span class="annot"><a href="#local-6989586621682483136"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4262"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4263"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawal"><span class="hs-identifier hs-type">ApiWithdrawal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483136"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-4264"></span><span id="mkApiWithdrawal"><span class="annot"><span class="annottext">mkApiWithdrawal :: (RewardAccount, Coin) -&gt; ApiWithdrawal n
</span><a href="Cardano.Wallet.Api.Server.html#mkApiWithdrawal"><span class="hs-identifier hs-var hs-var">mkApiWithdrawal</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480295"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480295"><span class="hs-identifier hs-var">acct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480294"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480294"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4265"></span><span>    </span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; ApiWithdrawal n
forall k (n :: k).
(ApiT RewardAccount, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; ApiWithdrawal n
</span><a href="Cardano.Wallet.Api.Types.html#ApiWithdrawal"><span class="hs-identifier hs-var">ApiWithdrawal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621682480295"><span class="hs-identifier hs-var">acct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483136"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Server.html#mkApiCoin"><span class="hs-identifier hs-var">mkApiCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682480294"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4266"></span><span>
</span><span id="line-4267"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-type">addressAmountToTxOut</span></a></span><span>
</span><span id="line-4268"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682483893"><span class="annot"><a href="#local-6989586621682483893"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AddressAmount"><span class="hs-identifier hs-type">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483893"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4269"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span>
</span><span id="line-4270"></span><span id="addressAmountToTxOut"><span class="annot"><span class="annottext">addressAmountToTxOut :: AddressAmount (ApiT Address, Proxy n) -&gt; TxOut
</span><a href="Cardano.Wallet.Api.Server.html#addressAmountToTxOut"><span class="hs-identifier hs-var hs-var">addressAmountToTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#AddressAmount"><span class="hs-identifier hs-type">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480292"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480292"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480291"><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682480291"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480290"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480290"><span class="hs-identifier hs-var">assets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4271"></span><span>    </span><span class="annot"><span class="annottext">Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480292"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; TokenMap -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-var">TokenBundle.TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Coin
forall n. Integral n =&gt; Quantity &quot;lovelace&quot; n -&gt; Coin
</span><a href="Cardano.Wallet.Api.Types.html#coinFromQuantity"><span class="hs-identifier hs-var">coinFromQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682480291"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480290"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4272"></span><span>
</span><span id="line-4273"></span><span id="local-6989586621682483145"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#natural"><span class="hs-identifier hs-type">natural</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483145"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483145"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span></span><span>
</span><span id="line-4274"></span><span id="natural"><span class="annot"><span class="annottext">natural :: Quantity q Word32 -&gt; Quantity q Natural
</span><a href="Cardano.Wallet.Api.Server.html#natural"><span class="hs-identifier hs-var hs-var">natural</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity q Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity q Natural)
-&gt; (Quantity q Word32 -&gt; Natural)
-&gt; Quantity q Word32
-&gt; Quantity q Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Natural)
-&gt; (Quantity q Word32 -&gt; Word32) -&gt; Quantity q Word32 -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity q Word32 -&gt; Word32
forall (unit :: Symbol) a. Quantity unit a -&gt; a
</span><a href="Data.Quantity.html#getQuantity"><span class="hs-identifier hs-var hs-var">getQuantity</span></a></span><span>
</span><span id="line-4275"></span><span>
</span><span id="line-4276"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#apiSlotId"><span class="hs-identifier hs-type">apiSlotId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#SlotId"><span class="hs-identifier hs-type">SlotId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSlotId"><span class="hs-identifier hs-type">ApiSlotId</span></a></span><span>
</span><span id="line-4277"></span><span id="apiSlotId"><span class="annot"><span class="annottext">apiSlotId :: SlotId -&gt; ApiSlotId
</span><a href="Cardano.Wallet.Api.Server.html#apiSlotId"><span class="hs-identifier hs-var hs-var">apiSlotId</span></a></span></span><span> </span><span id="local-6989586621682480287"><span class="annot"><span class="annottext">SlotId
</span><a href="#local-6989586621682480287"><span class="hs-identifier hs-var">slotId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT EpochNo -&gt; ApiT SlotInEpoch -&gt; ApiSlotId
</span><a href="Cardano.Wallet.Api.Types.html#ApiSlotId"><span class="hs-identifier hs-var">ApiSlotId</span></a></span><span>
</span><span id="line-4278"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; ApiT EpochNo
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; ApiT EpochNo) -&gt; EpochNo -&gt; ApiT EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotId
</span><a href="#local-6989586621682480287"><span class="hs-identifier hs-var">slotId</span></a></span><span> </span><span class="annot"><span class="annottext">SlotId
-&gt; ((EpochNo -&gt; Const EpochNo EpochNo)
    -&gt; SlotId -&gt; Const EpochNo SlotId)
-&gt; EpochNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;epochNumber&quot;
  ((EpochNo -&gt; Const EpochNo EpochNo)
   -&gt; SlotId -&gt; Const EpochNo SlotId)
(EpochNo -&gt; Const EpochNo EpochNo)
-&gt; SlotId -&gt; Const EpochNo SlotId
</span><a href="#local-6989586621682480285"><span class="hs-var">#epochNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4279"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotInEpoch -&gt; ApiT SlotInEpoch
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotInEpoch -&gt; ApiT SlotInEpoch)
-&gt; SlotInEpoch -&gt; ApiT SlotInEpoch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotId
</span><a href="#local-6989586621682480287"><span class="hs-identifier hs-var">slotId</span></a></span><span> </span><span class="annot"><span class="annottext">SlotId
-&gt; ((SlotInEpoch -&gt; Const SlotInEpoch SlotInEpoch)
    -&gt; SlotId -&gt; Const SlotInEpoch SlotId)
-&gt; SlotInEpoch
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNumber&quot;
  ((SlotInEpoch -&gt; Const SlotInEpoch SlotInEpoch)
   -&gt; SlotId -&gt; Const SlotInEpoch SlotId)
(SlotInEpoch -&gt; Const SlotInEpoch SlotInEpoch)
-&gt; SlotId -&gt; Const SlotInEpoch SlotId
</span><a href="#local-6989586621682480284"><span class="hs-var">#slotNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4280"></span><span>
</span><span id="line-4281"></span><span id="local-6989586621682483146"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReference"><span class="hs-identifier hs-type">makeApiBlockReference</span></a></span><span>
</span><span id="line-4282"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483146"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4283"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483146"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4284"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-4285"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;block&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-4286"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483146"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier hs-type">ApiBlockReference</span></a></span></span><span>
</span><span id="line-4287"></span><span id="makeApiBlockReference"><span class="annot"><span class="annottext">makeApiBlockReference :: TimeInterpreter m
-&gt; SlotNo -&gt; Quantity &quot;block&quot; Natural -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReference"><span class="hs-identifier hs-var hs-var">makeApiBlockReference</span></a></span></span><span> </span><span id="local-6989586621682480283"><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480283"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682480282"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480282"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621682480281"><span class="annot"><span class="annottext">Quantity &quot;block&quot; Natural
</span><a href="#local-6989586621682480281"><span class="hs-identifier hs-var">height</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4288"></span><span>    </span><span id="local-6989586621682480280"><span class="annot"><span class="annottext">SlotId
</span><a href="#local-6989586621682480280"><span class="hs-identifier hs-var">slotId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; Qry SlotId -&gt; m SlotId
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480283"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Qry SlotId
</span><a href="Cardano.Wallet.Primitive.Slotting.html#toSlotId"><span class="hs-identifier hs-var">toSlotId</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480282"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4289"></span><span>    </span><span id="local-6989586621682480279"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480279"><span class="hs-identifier hs-var">slotTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; Qry UTCTime -&gt; m UTCTime
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480283"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Qry UTCTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier hs-var">slotToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480282"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4290"></span><span>    </span><span class="annot"><span class="annottext">ApiBlockReference -&gt; m ApiBlockReference
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiBlockReference -&gt; m ApiBlockReference)
-&gt; ApiBlockReference -&gt; m ApiBlockReference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiBlockReference :: ApiT SlotNo
-&gt; ApiSlotId -&gt; UTCTime -&gt; ApiBlockInfo -&gt; ApiBlockReference
</span><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier hs-type">ApiBlockReference</span></a></span><span>
</span><span id="line-4291"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:absoluteSlotNumber:ApiBlockReference :: ApiT SlotNo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AabsoluteSlotNumber%3AApiBlockReference"><span class="hs-identifier hs-var">absoluteSlotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; ApiT SlotNo
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480282"><span class="hs-identifier hs-var">sl</span></a></span><span>
</span><span id="line-4292"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slotId:ApiBlockReference :: ApiSlotId
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AslotId%3AApiBlockReference"><span class="hs-identifier hs-var">slotId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotId -&gt; ApiSlotId
</span><a href="Cardano.Wallet.Api.Server.html#apiSlotId"><span class="hs-identifier hs-var">apiSlotId</span></a></span><span> </span><span class="annot"><span class="annottext">SlotId
</span><a href="#local-6989586621682480280"><span class="hs-identifier hs-var">slotId</span></a></span><span>
</span><span id="line-4293"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:time:ApiBlockReference :: UTCTime
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Atime%3AApiBlockReference"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682480279"><span class="hs-identifier hs-var">slotTime</span></a></span><span>
</span><span id="line-4294"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:block:ApiBlockReference :: ApiBlockInfo
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Ablock%3AApiBlockReference"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiBlockInfo :: Quantity &quot;block&quot; Natural -&gt; ApiBlockInfo
</span><a href="Cardano.Wallet.Api.Types.html#ApiBlockInfo"><span class="hs-identifier hs-type">ApiBlockInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Natural
$sel:height:ApiBlockInfo :: Quantity &quot;block&quot; Natural
height :: Quantity &quot;block&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aheight%3AApiBlockInfo"><span class="hs-identifier hs-var hs-var">height</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4295"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-4296"></span><span>
</span><span id="line-4297"></span><span id="local-6989586621682483288"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReferenceFromHeader"><span class="hs-identifier hs-type">makeApiBlockReferenceFromHeader</span></a></span><span>
</span><span id="line-4298"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483288"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4299"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483288"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4300"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-4301"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483288"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier hs-type">ApiBlockReference</span></a></span></span><span>
</span><span id="line-4302"></span><span id="makeApiBlockReferenceFromHeader"><span class="annot"><span class="annottext">makeApiBlockReferenceFromHeader :: TimeInterpreter m -&gt; BlockHeader -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReferenceFromHeader"><span class="hs-identifier hs-var hs-var">makeApiBlockReferenceFromHeader</span></a></span></span><span> </span><span id="local-6989586621682480271"><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480271"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682480270"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682480270"><span class="hs-identifier hs-var">tip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4303"></span><span>    </span><span class="annot"><span class="annottext">TimeInterpreter m
-&gt; SlotNo -&gt; Quantity &quot;block&quot; Natural -&gt; m ApiBlockReference
forall (m :: * -&gt; *).
Monad m =&gt;
TimeInterpreter m
-&gt; SlotNo -&gt; Quantity &quot;block&quot; Natural -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReference"><span class="hs-identifier hs-var">makeApiBlockReference</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480271"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682480270"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((SlotNo -&gt; Const SlotNo SlotNo)
    -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
-&gt; SlotNo
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;slotNo&quot;
  ((SlotNo -&gt; Const SlotNo SlotNo)
   -&gt; BlockHeader -&gt; Const SlotNo BlockHeader)
(SlotNo -&gt; Const SlotNo SlotNo)
-&gt; BlockHeader -&gt; Const SlotNo BlockHeader
</span><a href="#local-6989586621682480269"><span class="hs-var">#slotNo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;block&quot; Word32 -&gt; Quantity &quot;block&quot; Natural
forall (q :: Symbol). Quantity q Word32 -&gt; Quantity q Natural
</span><a href="Cardano.Wallet.Api.Server.html#natural"><span class="hs-identifier hs-var">natural</span></a></span><span> </span><span class="annot"><span class="annottext">(Quantity &quot;block&quot; Word32 -&gt; Quantity &quot;block&quot; Natural)
-&gt; Quantity &quot;block&quot; Word32 -&gt; Quantity &quot;block&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682480270"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((Quantity &quot;block&quot; Word32
     -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
    -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
-&gt; Quantity &quot;block&quot; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
   -&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader)
(Quantity &quot;block&quot; Word32
 -&gt; Const (Quantity &quot;block&quot; Word32) (Quantity &quot;block&quot; Word32))
-&gt; BlockHeader -&gt; Const (Quantity &quot;block&quot; Word32) BlockHeader
</span><a href="#local-6989586621682480268"><span class="hs-var">#blockHeight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4304"></span><span>
</span><span id="line-4305"></span><span id="local-6989586621682483275"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#makeApiSlotReference"><span class="hs-identifier hs-type">makeApiSlotReference</span></a></span><span>
</span><span id="line-4306"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483275"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4307"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483275"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4308"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-4309"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483275"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiSlotReference"><span class="hs-identifier hs-type">ApiSlotReference</span></a></span></span><span>
</span><span id="line-4310"></span><span id="makeApiSlotReference"><span class="annot"><span class="annottext">makeApiSlotReference :: TimeInterpreter m -&gt; SlotNo -&gt; m ApiSlotReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiSlotReference"><span class="hs-identifier hs-var hs-var">makeApiSlotReference</span></a></span></span><span> </span><span id="local-6989586621682480267"><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480267"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621682480266"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480266"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4311"></span><span>    </span><span class="annot"><span class="annottext">ApiT SlotNo -&gt; ApiSlotId -&gt; UTCTime -&gt; ApiSlotReference
</span><a href="Cardano.Wallet.Api.Types.html#ApiSlotReference"><span class="hs-identifier hs-var">ApiSlotReference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; ApiT SlotNo
forall a. a -&gt; ApiT a
</span><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480266"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4312"></span><span>        </span><span class="annot"><span class="annottext">(ApiSlotId -&gt; UTCTime -&gt; ApiSlotReference)
-&gt; m ApiSlotId -&gt; m (UTCTime -&gt; ApiSlotReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotId -&gt; ApiSlotId) -&gt; m SlotId -&gt; m ApiSlotId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">SlotId -&gt; ApiSlotId
</span><a href="Cardano.Wallet.Api.Server.html#apiSlotId"><span class="hs-identifier hs-var">apiSlotId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; Qry SlotId -&gt; m SlotId
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480267"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(Qry SlotId -&gt; m SlotId) -&gt; Qry SlotId -&gt; m SlotId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Qry SlotId
</span><a href="Cardano.Wallet.Primitive.Slotting.html#toSlotId"><span class="hs-identifier hs-var">toSlotId</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480266"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4313"></span><span>        </span><span class="annot"><span class="annottext">m (UTCTime -&gt; ApiSlotReference) -&gt; m UTCTime -&gt; m ApiSlotReference
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; Qry UTCTime -&gt; m UTCTime
forall (m :: * -&gt; *) a.
(HasCallStack, Monad m) =&gt;
TimeInterpreter m -&gt; Qry a -&gt; m a
</span><a href="Cardano.Wallet.Primitive.Slotting.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480267"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Qry UTCTime
</span><a href="Cardano.Wallet.Primitive.Slotting.html#slotToUTCTime"><span class="hs-identifier hs-var">slotToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682480266"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4314"></span><span>
</span><span id="line-4315"></span><span id="local-6989586621682484255"><span id="local-6989586621682484256"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#getWalletTip"><span class="hs-identifier hs-type">getWalletTip</span></a></span><span>
</span><span id="line-4316"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484256"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4317"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Slotting.html#TimeInterpreter"><span class="hs-identifier hs-type">TimeInterpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484256"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4318"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484255"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4319"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484256"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBlockReference"><span class="hs-identifier hs-type">ApiBlockReference</span></a></span></span></span><span>
</span><span id="line-4320"></span><span id="getWalletTip"><span class="annot"><span class="annottext">getWalletTip :: TimeInterpreter m -&gt; Wallet s -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#getWalletTip"><span class="hs-identifier hs-var hs-var">getWalletTip</span></a></span></span><span> </span><span id="local-6989586621682480264"><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480264"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m -&gt; BlockHeader -&gt; m ApiBlockReference
forall (m :: * -&gt; *).
Monad m =&gt;
TimeInterpreter m -&gt; BlockHeader -&gt; m ApiBlockReference
</span><a href="Cardano.Wallet.Api.Server.html#makeApiBlockReferenceFromHeader"><span class="hs-identifier hs-var">makeApiBlockReferenceFromHeader</span></a></span><span> </span><span class="annot"><span class="annottext">TimeInterpreter m
</span><a href="#local-6989586621682480264"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; m ApiBlockReference)
-&gt; (Wallet s -&gt; BlockHeader) -&gt; Wallet s -&gt; m ApiBlockReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span><span>
</span><span id="line-4321"></span><span>
</span><span id="line-4322"></span><span id="local-6989586621682483487"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#fromExternalInput"><span class="hs-identifier hs-type">fromExternalInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiExternalInput"><span class="hs-identifier hs-type">ApiExternalInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483487"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Datum&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-4323"></span><span id="fromExternalInput"><span class="annot"><span class="annottext">fromExternalInput :: ApiExternalInput n -&gt; (TxIn, TxOut, Maybe (Hash &quot;Datum&quot;))
</span><a href="Cardano.Wallet.Api.Server.html#fromExternalInput"><span class="hs-identifier hs-var hs-var">fromExternalInput</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiExternalInput"><span class="hs-identifier hs-type">ApiExternalInput</span></a></span><span>
</span><span id="line-4324"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:id:ApiExternalInput :: forall (n :: NetworkDiscriminant).
ApiExternalInput n -&gt; ApiT (Hash &quot;Tx&quot;)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aid%3AApiExternalInput"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480261"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682480261"><span class="hs-identifier hs-var">tid</span></a></span></span><span>
</span><span id="line-4325"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:index:ApiExternalInput :: forall (n :: NetworkDiscriminant). ApiExternalInput n -&gt; Word32
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aindex%3AApiExternalInput"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682480259"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682480259"><span class="hs-identifier hs-var">ix</span></a></span></span><span>
</span><span id="line-4326"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiExternalInput :: forall (n :: NetworkDiscriminant).
ApiExternalInput n -&gt; (ApiT Address, Proxy n)
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aaddress%3AApiExternalInput"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480257"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480257"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-4327"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiExternalInput :: forall (n :: NetworkDiscriminant).
ApiExternalInput n -&gt; Quantity &quot;lovelace&quot; Natural
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aamount%3AApiExternalInput"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Quantity.html#Quantity"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682480255"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480255"><span class="hs-identifier hs-var">amt</span></a></span></span><span>
</span><span id="line-4328"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiExternalInput :: forall (n :: NetworkDiscriminant).
ApiExternalInput n -&gt; ApiT TokenMap
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Aassets%3AApiExternalInput"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480253"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480253"><span class="hs-identifier hs-var">assets</span></a></span></span><span>
</span><span id="line-4329"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480252"><span class="annot"><span class="annottext">Maybe (ApiT (Hash &quot;Datum&quot;))
$sel:datum:ApiExternalInput :: forall (n :: NetworkDiscriminant).
ApiExternalInput n -&gt; Maybe (ApiT (Hash &quot;Datum&quot;))
datum :: Maybe (ApiT (Hash &quot;Datum&quot;))
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3Adatum%3AApiExternalInput"><span class="hs-identifier hs-var hs-var">datum</span></a></span></span><span>
</span><span id="line-4330"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-4331"></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-4332"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Word32 -&gt; TxIn
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682480261"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682480259"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-4333"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Address -&gt; TokenBundle -&gt; TxOut
</span><a href="Cardano.Wallet.Primitive.Types.Tx.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621682480257"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; TokenMap -&gt; TokenBundle
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#TokenBundle"><span class="hs-identifier hs-var">TokenBundle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Coin) -&gt; Natural -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682480255"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682480253"><span class="hs-identifier hs-var">assets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4334"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Datum&quot;) -&gt; Hash &quot;Datum&quot;
forall a. ApiT a -&gt; a
</span><a href="Cardano.Wallet.Api.Types.html#%24sel%3AgetApiT%3AApiT"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT (Hash &quot;Datum&quot;) -&gt; Hash &quot;Datum&quot;)
-&gt; Maybe (ApiT (Hash &quot;Datum&quot;)) -&gt; Maybe (Hash &quot;Datum&quot;)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT (Hash &quot;Datum&quot;))
</span><a href="#local-6989586621682480252"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-4335"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-4336"></span><span>
</span><span id="line-4337"></span><span id="local-6989586621682483485"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#fromApiRedeemer"><span class="hs-identifier hs-type">fromApiRedeemer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiRedeemer"><span class="hs-identifier hs-type">ApiRedeemer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483485"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#Redeemer"><span class="hs-identifier hs-type">Redeemer</span></a></span></span><span>
</span><span id="line-4338"></span><span id="fromApiRedeemer"><span class="annot"><span class="annottext">fromApiRedeemer :: ApiRedeemer n -&gt; Redeemer
</span><a href="Cardano.Wallet.Api.Server.html#fromApiRedeemer"><span class="hs-identifier hs-var hs-var">fromApiRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4339"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiRedeemerSpending"><span class="hs-identifier hs-type">ApiRedeemerSpending</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBytesT"><span class="hs-identifier hs-type">ApiBytesT</span></a></span><span> </span><span id="local-6989586621682480249"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480249"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480248"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480248"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4340"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; TxIn -&gt; Redeemer
</span><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#RedeemerSpending"><span class="hs-identifier hs-var">RedeemerSpending</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480249"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480248"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-4341"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiRedeemerMinting"><span class="hs-identifier hs-type">ApiRedeemerMinting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBytesT"><span class="hs-identifier hs-type">ApiBytesT</span></a></span><span> </span><span id="local-6989586621682480245"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480245"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiT"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span id="local-6989586621682480244"><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682480244"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4342"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; TokenPolicyId -&gt; Redeemer
</span><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#RedeemerMinting"><span class="hs-identifier hs-var">RedeemerMinting</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480245"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682480244"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-4343"></span><span>    </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiRedeemerRewarding"><span class="hs-identifier hs-type">ApiRedeemerRewarding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiBytesT"><span class="hs-identifier hs-type">ApiBytesT</span></a></span><span> </span><span id="local-6989586621682480241"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480241"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682480240"><span class="annot"><span class="annottext">StakeAddress
</span><a href="#local-6989586621682480240"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4344"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; StakeAddress -&gt; Redeemer
</span><a href="Cardano.Wallet.Primitive.Types.Redeemer.html#RedeemerRewarding"><span class="hs-identifier hs-var">RedeemerRewarding</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682480241"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">StakeAddress
</span><a href="#local-6989586621682480240"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-4345"></span><span>
</span><span id="line-4346"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                Api Layer
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-4349"></span><span>
</span><span id="line-4350"></span><span class="hs-comment">-- | Create a new instance of the wallet layer.</span><span>
</span><span id="line-4351"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#newApiLayer"><span class="hs-identifier hs-type">newApiLayer</span></a></span><span>
</span><span id="line-4352"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682480238"><span class="annot"><a href="#local-6989586621682480238"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682480237"><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682480236"><span class="annot"><a href="#local-6989586621682480236"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-4353"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682480238"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480236"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4354"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-4355"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-4356"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4357"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4358"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-4359"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#WalletEngineLog"><span class="hs-identifier hs-type">WalletEngineLog</span></a></span><span>
</span><span id="line-4360"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4361"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#NetworkLayer"><span class="hs-identifier hs-type">NetworkLayer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-4362"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#TransactionLayer"><span class="hs-identifier hs-type">TransactionLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480236"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Tx.html#SealedTx"><span class="hs-identifier hs-type">W.SealedTx</span></a></span><span>
</span><span id="line-4363"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#DBFactory"><span class="hs-identifier hs-type">DBFactory</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480237"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480236"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4364"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.TokenMetadata.html#TokenMetadataClient"><span class="hs-identifier hs-type">TokenMetadataClient</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-4365"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480238"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4366"></span><span>        </span><span class="hs-comment">-- ^ Action to run concurrently with wallet restore</span><span>
</span><span id="line-4367"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682480238"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4368"></span><span id="newApiLayer"><span class="annot"><span class="annottext">newApiLayer :: Tracer IO WalletEngineLog
-&gt; (Block, NetworkParameters)
-&gt; NetworkLayer IO Block
-&gt; TransactionLayer k SealedTx
-&gt; DBFactory IO s k
-&gt; TokenMetadataClient IO
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; IO ctx
</span><a href="Cardano.Wallet.Api.Server.html#newApiLayer"><span class="hs-identifier hs-var hs-var">newApiLayer</span></a></span></span><span> </span><span id="local-6989586621682480235"><span class="annot"><span class="annottext">Tracer IO WalletEngineLog
</span><a href="#local-6989586621682480235"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621682480234"><span class="annot"><span class="annottext">(Block, NetworkParameters)
</span><a href="#local-6989586621682480234"><span class="hs-identifier hs-var">g0</span></a></span></span><span> </span><span id="local-6989586621682480233"><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480233"><span class="hs-identifier hs-var">nw</span></a></span></span><span> </span><span id="local-6989586621682480232"><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682480232"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621682480231"><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682480231"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span id="local-6989586621682480230"><span class="annot"><span class="annottext">TokenMetadataClient IO
</span><a href="#local-6989586621682480230"><span class="hs-identifier hs-var">tokenMeta</span></a></span></span><span> </span><span id="local-6989586621682480229"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480229"><span class="hs-identifier hs-var">coworker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4369"></span><span>    </span><span id="local-6989586621682480228"><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480228"><span class="hs-identifier hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (WorkerRegistry WalletId (DBLayer IO s k))
forall key resource. Ord key =&gt; IO (WorkerRegistry key resource)
</span><a href="Cardano.Wallet.Registry.html#empty"><span class="hs-identifier hs-var">Registry.empty</span></a></span><span>
</span><span id="line-4370"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480226"><span class="annot"><span class="annottext">trTx :: Tracer IO TxSubmitLog
</span><a href="#local-6989586621682480226"><span class="hs-identifier hs-var hs-var">trTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxSubmitLog -&gt; WalletEngineLog)
-&gt; Tracer IO WalletEngineLog -&gt; Tracer IO TxSubmitLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; WalletEngineLog
</span><a href="Cardano.Wallet.Api.Server.html#MsgSubmitSealedTx"><span class="hs-identifier hs-var">MsgSubmitSealedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletEngineLog
</span><a href="#local-6989586621682480235"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-4371"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480224"><span class="annot"><span class="annottext">trW :: Tracer IO (WorkerLog WalletId WalletWorkerLog)
</span><a href="#local-6989586621682480224"><span class="hs-identifier hs-var hs-var">trW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerLog WalletId WalletWorkerLog -&gt; WalletEngineLog)
-&gt; Tracer IO WalletEngineLog
-&gt; Tracer IO (WorkerLog WalletId WalletWorkerLog)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog -&gt; WalletEngineLog
</span><a href="Cardano.Wallet.Api.Server.html#MsgWalletWorker"><span class="hs-identifier hs-var">MsgWalletWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO WalletEngineLog
</span><a href="#local-6989586621682480235"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-4372"></span><span>    </span><span id="local-6989586621682480222"><span class="annot"><span class="annottext">Concierge IO WalletLock
</span><a href="#local-6989586621682480222"><span class="hs-identifier hs-var">locks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Concierge IO WalletLock)
forall (m :: * -&gt; *) lock. MonadSTM m =&gt; m (Concierge m lock)
</span><a href="Control.Concurrent.Concierge.html#newConcierge"><span class="hs-identifier hs-var">Concierge.newConcierge</span></a></span><span>
</span><span id="line-4373"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682480220"><span class="annot"><span class="annottext">ctx :: ApiLayer s k
</span><a href="#local-6989586621682480220"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO TxSubmitLog
-&gt; Tracer IO (WorkerLog WalletId WalletWorkerLog)
-&gt; (Block, NetworkParameters)
-&gt; NetworkLayer IO Block
-&gt; TransactionLayer k SealedTx
-&gt; DBFactory IO s k
-&gt; WorkerRegistry WalletId (DBLayer IO s k)
-&gt; Concierge IO WalletLock
-&gt; TokenMetadataClient IO
-&gt; ApiLayer s k
forall s (k :: Depth -&gt; * -&gt; *).
Tracer IO TxSubmitLog
-&gt; Tracer IO (WorkerLog WalletId WalletWorkerLog)
-&gt; (Block, NetworkParameters)
-&gt; NetworkLayer IO Block
-&gt; TransactionLayer k SealedTx
-&gt; DBFactory IO s k
-&gt; WorkerRegistry WalletId (DBLayer IO s k)
-&gt; Concierge IO WalletLock
-&gt; TokenMetadataClient IO
-&gt; ApiLayer s k
</span><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-var">ApiLayer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO TxSubmitLog
</span><a href="#local-6989586621682480226"><span class="hs-identifier hs-var">trTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (WorkerLog WalletId WalletWorkerLog)
</span><a href="#local-6989586621682480224"><span class="hs-identifier hs-var">trW</span></a></span><span> </span><span class="annot"><span class="annottext">(Block, NetworkParameters)
</span><a href="#local-6989586621682480234"><span class="hs-identifier hs-var">g0</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkLayer IO Block
</span><a href="#local-6989586621682480233"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionLayer k SealedTx
</span><a href="#local-6989586621682480232"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682480231"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480228"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">Concierge IO WalletLock
</span><a href="#local-6989586621682480222"><span class="hs-identifier hs-var">locks</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMetadataClient IO
</span><a href="#local-6989586621682480230"><span class="hs-identifier hs-var">tokenMeta</span></a></span><span>
</span><span id="line-4374"></span><span>    </span><span class="annot"><span class="annottext">DBFactory IO s k -&gt; IO [WalletId]
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
DBFactory m s k -&gt; IO [WalletId]
</span><a href="Cardano.Wallet.DB.html#listDatabases"><span class="hs-identifier hs-var hs-var">listDatabases</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682480231"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">IO [WalletId] -&gt; ([WalletId] -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletId -&gt; IO ()) -&gt; [WalletId] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiLayer s k
-&gt; (WorkerCtx (ApiLayer s k) -&gt; WalletId -&gt; IO ())
-&gt; WalletId
-&gt; IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx -&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ()) -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.Api.Server.html#startWalletWorker"><span class="hs-identifier hs-var">startWalletWorker</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLayer s k
</span><a href="#local-6989586621682480220"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
WorkerCtx (ApiLayer s k) -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480229"><span class="hs-identifier hs-var">coworker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4375"></span><span>    </span><span class="annot"><span class="annottext">ApiLayer s k -&gt; IO (ApiLayer s k)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLayer s k
</span><a href="#local-6989586621682480220"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4376"></span><span>
</span><span id="line-4377"></span><span class="hs-comment">-- | Register a wallet restoration thread with the worker registry.</span><span>
</span><span id="line-4378"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#startWalletWorker"><span class="hs-identifier hs-type">startWalletWorker</span></a></span><span>
</span><span id="line-4379"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483086"><span class="annot"><a href="#local-6989586621682483086"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682483085"><span class="annot"><a href="#local-6989586621682483085"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483084"><span class="annot"><a href="#local-6989586621682483084"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-4380"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682483086"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483085"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483084"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4381"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483085"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-4382"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483085"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-4383"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483085"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4384"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483085"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4385"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-4386"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483086"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4387"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483086"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4388"></span><span>        </span><span class="hs-comment">-- ^ Action to run concurrently with restore</span><span>
</span><span id="line-4389"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-4390"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4391"></span><span id="startWalletWorker"><span class="annot"><span class="annottext">startWalletWorker :: ctx -&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ()) -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.Api.Server.html#startWalletWorker"><span class="hs-identifier hs-var hs-var">startWalletWorker</span></a></span></span><span> </span><span id="local-6989586621682480216"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480216"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480215"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480215"><span class="hs-identifier hs-var">coworker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ctx) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ctx) -&gt; IO ())
-&gt; (WalletId -&gt; IO (Maybe ctx)) -&gt; WalletId -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; WalletId
-&gt; IO (Maybe ctx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; WalletId
-&gt; IO (Maybe ctx)
</span><a href="Cardano.Wallet.Api.Server.html#registerWorker"><span class="hs-identifier hs-var">registerWorker</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480216"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k -&gt; WalletId -&gt; IO ()
WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480213"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480215"><span class="hs-identifier hs-var">coworker</span></a></span><span>
</span><span id="line-4392"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4393"></span><span>    </span><span id="local-6989586621682480213"><span class="annot"><span class="annottext">before :: WalletLayer IO s k -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480213"><span class="hs-identifier hs-var hs-var">before</span></a></span></span><span> </span><span id="local-6989586621682480212"><span class="annot"><span class="annottext">WalletLayer IO s k
</span><a href="#local-6989586621682480212"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span id="local-6989586621682480211"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480211"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4394"></span><span>        </span><span class="annot"><span class="annottext">ExceptT ErrCheckWalletIntegrity IO ()
-&gt; IO (Either ErrCheckWalletIntegrity ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletLayer IO s k
-&gt; WalletId
-&gt; GenesisParameters
-&gt; ExceptT ErrCheckWalletIntegrity IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
HasDBLayer IO s k ctx =&gt;
ctx
-&gt; WalletId
-&gt; GenesisParameters
-&gt; ExceptT ErrCheckWalletIntegrity IO ()
</span><a href="Cardano.Wallet.html#checkWalletIntegrity"><span class="hs-identifier hs-var">W.checkWalletIntegrity</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
</span><a href="#local-6989586621682480212"><span class="hs-identifier hs-var">ctx'</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480211"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682480209"><span class="hs-identifier hs-var">gp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4395"></span><span>        </span><span class="annot"><span class="annottext">IO (Either ErrCheckWalletIntegrity ())
-&gt; (Either ErrCheckWalletIntegrity () -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrCheckWalletIntegrity -&gt; IO ())
-&gt; (() -&gt; IO ()) -&gt; Either ErrCheckWalletIntegrity () -&gt; IO ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCheckWalletIntegrity -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-4396"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#NetworkParameters"><span class="hs-identifier hs-type">NetworkParameters</span></a></span><span> </span><span id="local-6989586621682480209"><span class="annot"><span class="annottext">GenesisParameters
</span><a href="#local-6989586621682480209"><span class="hs-identifier hs-var">gp</span></a></span></span><span> </span><span class="annot"><span class="annottext">SlottingParameters
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480216"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; (((Block, NetworkParameters)
     -&gt; Const (Block, NetworkParameters) (Block, NetworkParameters))
    -&gt; ctx -&gt; Const (Block, NetworkParameters) ctx)
-&gt; (Block, NetworkParameters)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">((Block, NetworkParameters)
 -&gt; Const (Block, NetworkParameters) (Block, NetworkParameters))
-&gt; ctx -&gt; Const (Block, NetworkParameters) ctx
forall ctx.
HasGenesisData ctx =&gt;
Lens' ctx (Block, NetworkParameters)
</span><a href="Cardano.Wallet.html#genesisData"><span class="hs-identifier hs-var">genesisData</span></a></span><span>
</span><span id="line-4397"></span><span>
</span><span id="line-4398"></span><span class="hs-comment">-- | Register a wallet create and restore thread with the worker registry.</span><span>
</span><span id="line-4399"></span><span class="hs-comment">-- See 'Cardano.Wallet#createWallet'</span><span>
</span><span id="line-4400"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-type">createWalletWorker</span></a></span><span>
</span><span id="line-4401"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484337"><span class="annot"><a href="#local-6989586621682484337"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484336"><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484335"><span class="annot"><a href="#local-6989586621682484335"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-4402"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682484337"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484335"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4403"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-4404"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-4405"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4406"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4407"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-4408"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484337"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4409"></span><span>        </span><span class="hs-comment">-- ^ Surrounding API context</span><span>
</span><span id="line-4410"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-4411"></span><span>        </span><span class="hs-comment">-- ^ Wallet Id</span><span>
</span><span id="line-4412"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484337"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4413"></span><span>        </span><span class="hs-comment">-- ^ Create action</span><span>
</span><span id="line-4414"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484337"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4415"></span><span>        </span><span class="hs-comment">-- ^ Action to run concurrently with restore</span><span>
</span><span id="line-4416"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCreateWallet"><span class="hs-identifier hs-type">ErrCreateWallet</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-4417"></span><span id="createWalletWorker"><span class="annot"><span class="annottext">createWalletWorker :: ctx
-&gt; WalletId
-&gt; (WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId)
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; ExceptT ErrCreateWallet IO WalletId
</span><a href="Cardano.Wallet.Api.Server.html#createWalletWorker"><span class="hs-identifier hs-var hs-var">createWalletWorker</span></a></span></span><span> </span><span id="local-6989586621682480206"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480206"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480205"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480205"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682480204"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="#local-6989586621682480204"><span class="hs-identifier hs-var">createWallet</span></a></span></span><span> </span><span id="local-6989586621682480203"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480203"><span class="hs-identifier hs-var">coworker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4418"></span><span>    </span><span class="annot"><span class="annottext">IO (Maybe (Worker WalletId (DBLayer IO s k)))
-&gt; ExceptT
     ErrCreateWallet IO (Maybe (Worker WalletId (DBLayer IO s k)))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
-&gt; WalletId -&gt; IO (Maybe (Worker WalletId (DBLayer IO s k)))
forall (m :: * -&gt; *) key resource.
(MonadIO m, Ord key) =&gt;
WorkerRegistry key resource
-&gt; key -&gt; m (Maybe (Worker key resource))
</span><a href="Cardano.Wallet.Registry.html#lookup"><span class="hs-identifier hs-var">Registry.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480201"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480205"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT
  ErrCreateWallet IO (Maybe (Worker WalletId (DBLayer IO s k)))
-&gt; (Maybe (Worker WalletId (DBLayer IO s k))
    -&gt; ExceptT ErrCreateWallet IO WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4419"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Worker WalletId (DBLayer IO s k)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4420"></span><span>            </span><span class="annot"><span class="annottext">ErrCreateWallet -&gt; ExceptT ErrCreateWallet IO WalletId
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrCreateWallet -&gt; ExceptT ErrCreateWallet IO WalletId)
-&gt; ErrCreateWallet -&gt; ExceptT ErrCreateWallet IO WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletAlreadyExists -&gt; ErrCreateWallet
</span><a href="Cardano.Wallet.Api.Server.html#ErrCreateWalletAlreadyExists"><span class="hs-identifier hs-var">ErrCreateWalletAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrWalletAlreadyExists -&gt; ErrCreateWallet)
-&gt; ErrWalletAlreadyExists -&gt; ErrCreateWallet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ErrWalletAlreadyExists
</span><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-var">ErrWalletAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480205"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4421"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Worker WalletId (DBLayer IO s k))
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4422"></span><span>            </span><span class="annot"><span class="annottext">IO (Maybe ctx) -&gt; ExceptT ErrCreateWallet IO (Maybe ctx)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; WalletId
-&gt; IO (Maybe ctx)
forall ctx s (k :: Depth -&gt; * -&gt; *).
(ctx ~ ApiLayer s k, IsOurs s RewardAccount, IsOurs s Address,
 AddressBookIso s, MaybeLight s) =&gt;
ctx
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; WalletId
-&gt; IO (Maybe ctx)
</span><a href="Cardano.Wallet.Api.Server.html#registerWorker"><span class="hs-identifier hs-var">registerWorker</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480206"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k -&gt; WalletId -&gt; IO ()
WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480198"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480203"><span class="hs-identifier hs-var">coworker</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480205"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrCreateWallet IO (Maybe ctx)
-&gt; (Maybe ctx -&gt; ExceptT ErrCreateWallet IO WalletId)
-&gt; ExceptT ErrCreateWallet IO WalletId
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4423"></span><span>                </span><span class="annot"><span class="annottext">Maybe ctx
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCreateWallet -&gt; ExceptT ErrCreateWallet IO WalletId
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCreateWallet
</span><a href="Cardano.Wallet.Api.Server.html#ErrCreateWalletFailedToCreateWorker"><span class="hs-identifier hs-var">ErrCreateWalletFailedToCreateWorker</span></a></span><span>
</span><span id="line-4424"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ExceptT ErrCreateWallet IO WalletId
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480205"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4425"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4426"></span><span>    </span><span id="local-6989586621682480198"><span class="annot"><span class="annottext">before :: WalletLayer IO s k -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480198"><span class="hs-identifier hs-var hs-var">before</span></a></span></span><span> </span><span id="local-6989586621682480196"><span class="annot"><span class="annottext">WalletLayer IO s k
</span><a href="#local-6989586621682480196"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO WalletId -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO WalletId -&gt; IO ()) -&gt; IO WalletId -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT ErrWalletAlreadyExists IO WalletId -&gt; IO WalletId
forall (m :: * -&gt; *) e a.
(MonadFail m, Show e) =&gt;
ExceptT e m a -&gt; m a
</span><a href="Cardano.Wallet.Unsafe.html#unsafeRunExceptT"><span class="hs-identifier hs-var">unsafeRunExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrWalletAlreadyExists IO WalletId -&gt; IO WalletId)
-&gt; ExceptT ErrWalletAlreadyExists IO WalletId -&gt; IO WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; ExceptT ErrWalletAlreadyExists IO WalletId
</span><a href="#local-6989586621682480204"><span class="hs-identifier hs-var">createWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480196"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-4427"></span><span>    </span><span id="local-6989586621682480201"><span class="annot"><span class="annottext">re :: WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480201"><span class="hs-identifier hs-var hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480206"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((WorkerRegistry WalletId (DBLayer IO s k)
     -&gt; Const
          (WorkerRegistry WalletId (DBLayer IO s k))
          (WorkerRegistry WalletId (DBLayer IO s k)))
    -&gt; ctx -&gt; Const (WorkerRegistry WalletId (DBLayer IO s k)) ctx)
-&gt; WorkerRegistry WalletId (DBLayer IO s k)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
</span><a href="Cardano.Wallet.Api.html#workerRegistry"><span class="hs-identifier hs-var">workerRegistry</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484336"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484335"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4428"></span><span>
</span><span id="line-4429"></span><span class="hs-comment">-- | Create a worker for an existing wallet, register it, then start the worker</span><span>
</span><span id="line-4430"></span><span class="hs-comment">-- thread. This is used by 'startWalletWorker' and 'createWalletWorker'.</span><span>
</span><span id="line-4431"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#registerWorker"><span class="hs-identifier hs-type">registerWorker</span></a></span><span>
</span><span id="line-4432"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682483082"><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682483081"><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682483080"><span class="annot"><a href="#local-6989586621682483080"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-4433"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#ApiLayer"><span class="hs-identifier hs-type">ApiLayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483080"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4434"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.RewardAccount.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-4435"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#IsOurs"><span class="hs-identifier hs-type">IsOurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-4436"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4437"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#MaybeLight"><span class="hs-identifier hs-type">MaybeLight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-4438"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-4439"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4440"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4441"></span><span>        </span><span class="hs-comment">-- ^ First action to run after starting the worker thread.</span><span>
</span><span id="line-4442"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4443"></span><span>        </span><span class="hs-comment">-- ^ Action to run concurrently with restore.</span><span>
</span><span id="line-4444"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-4445"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4446"></span><span id="registerWorker"><span class="annot"><span class="annottext">registerWorker :: ctx
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; (WorkerCtx ctx -&gt; WalletId -&gt; IO ())
-&gt; WalletId
-&gt; IO (Maybe ctx)
</span><a href="Cardano.Wallet.Api.Server.html#registerWorker"><span class="hs-identifier hs-var hs-var">registerWorker</span></a></span></span><span> </span><span id="local-6989586621682480195"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480195"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480194"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480194"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621682480193"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480193"><span class="hs-identifier hs-var">coworker</span></a></span></span><span> </span><span id="local-6989586621682480192"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480192"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4447"></span><span>    </span><span class="annot"><span class="annottext">(Worker WalletId (DBLayer IO s k) -&gt; ctx)
-&gt; Maybe (Worker WalletId (DBLayer IO s k)) -&gt; Maybe ctx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ctx -&gt; Worker WalletId (DBLayer IO s k) -&gt; ctx
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480195"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Worker WalletId (DBLayer IO s k)) -&gt; Maybe ctx)
-&gt; IO (Maybe (Worker WalletId (DBLayer IO s k))) -&gt; IO (Maybe ctx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
-&gt; ctx
-&gt; WalletId
-&gt; MkWorker WalletId (DBLayer IO s k) WalletWorkerLog ctx
-&gt; IO (Maybe (Worker WalletId (DBLayer IO s k)))
forall resource ctx key msg.
(Ord key, key ~ WorkerKey ctx, msg ~ WorkerMsg ctx,
 HasLogger IO (WorkerLog key msg) ctx, HasWorkerCtx resource ctx) =&gt;
WorkerRegistry key resource
-&gt; ctx
-&gt; key
-&gt; MkWorker key resource msg ctx
-&gt; IO (Maybe (Worker key resource))
</span><a href="Cardano.Wallet.Registry.html#register"><span class="hs-identifier hs-var">Registry.register</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483082"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480190"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480195"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480192"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">MkWorker WalletId (DBLayer IO s k) WalletWorkerLog ctx
</span><a href="#local-6989586621682480189"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-4448"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4449"></span><span>    </span><span id="local-6989586621682480190"><span class="annot"><span class="annottext">re :: WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480190"><span class="hs-identifier hs-var hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480195"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((WorkerRegistry WalletId (DBLayer IO s k)
     -&gt; Const
          (WorkerRegistry WalletId (DBLayer IO s k))
          (WorkerRegistry WalletId (DBLayer IO s k)))
    -&gt; ctx -&gt; Const (WorkerRegistry WalletId (DBLayer IO s k)) ctx)
-&gt; WorkerRegistry WalletId (DBLayer IO s k)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
</span><a href="Cardano.Wallet.Api.html#workerRegistry"><span class="hs-identifier hs-var">workerRegistry</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483081"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682483080"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4450"></span><span>    </span><span id="local-6989586621682480188"><span class="annot"><span class="annottext">df :: DBFactory IO s k
</span><a href="#local-6989586621682480188"><span class="hs-identifier hs-var hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480195"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBFactory IO s k
     -&gt; Const (DBFactory IO s k) (DBFactory IO s k))
    -&gt; ctx -&gt; Const (DBFactory IO s k) ctx)
-&gt; DBFactory IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(DBFactory IO s k -&gt; Const (DBFactory IO s k) (DBFactory IO s k))
-&gt; ctx -&gt; Const (DBFactory IO s k) ctx
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBFactory s k ctx =&gt;
Lens' ctx (DBFactory IO s k)
</span><a href="Cardano.Wallet.Api.html#dbFactory"><span class="hs-identifier hs-var">dbFactory</span></a></span><span>
</span><span id="line-4451"></span><span>    </span><span id="local-6989586621682480189"><span class="annot"><span class="annottext">config :: MkWorker WalletId (DBLayer IO s k) WalletWorkerLog ctx
</span><a href="#local-6989586621682480189"><span class="hs-identifier hs-var hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkWorker :: forall key resource msg ctx.
(WorkerCtx ctx -&gt; key -&gt; IO ())
-&gt; (WorkerCtx ctx -&gt; key -&gt; IO ())
-&gt; (Tracer IO (WorkerLog key msg)
    -&gt; Either SomeException () -&gt; IO ())
-&gt; ((resource -&gt; IO ()) -&gt; IO ())
-&gt; MkWorker key resource msg ctx
</span><a href="Cardano.Wallet.Registry.html#MkWorker"><span class="hs-identifier hs-type">MkWorker</span></a></span><span>
</span><span id="line-4452"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">workerAcquire :: (DBLayer IO s k -&gt; IO ()) -&gt; IO ()
</span><a href="Cardano.Wallet.Registry.html#workerAcquire"><span class="hs-identifier hs-var">workerAcquire</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k -&gt; WalletId -&gt; (DBLayer IO s k -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
DBFactory m s k
-&gt; forall a. WalletId -&gt; (DBLayer m s k -&gt; IO a) -&gt; IO a
</span><a href="Cardano.Wallet.DB.html#withDatabase"><span class="hs-identifier hs-var hs-var">withDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682480188"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480192"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4453"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">workerBefore :: WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.Registry.html#workerBefore"><span class="hs-identifier hs-var">workerBefore</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480194"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-4454"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">workerAfter :: Tracer IO (WorkerLog WalletId WalletWorkerLog)
-&gt; Either SomeException () -&gt; IO ()
</span><a href="Cardano.Wallet.Registry.html#workerAfter"><span class="hs-identifier hs-var">workerAfter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WorkerLog WalletId WalletWorkerLog)
-&gt; Either SomeException () -&gt; IO ()
forall key msg a.
Tracer IO (WorkerLog key msg) -&gt; Either SomeException a -&gt; IO ()
</span><a href="Cardano.Wallet.Registry.html#defaultWorkerAfter"><span class="hs-identifier hs-var">defaultWorkerAfter</span></a></span><span>
</span><span id="line-4455"></span><span>        </span><span class="hs-comment">-- fixme: ADP-641 Review error handling here</span><span>
</span><span id="line-4456"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">workerMain :: WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="Cardano.Wallet.Registry.html#workerMain"><span class="hs-identifier hs-var">workerMain</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682480182"><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480182"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m ()
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">race_</span></a></span><span>
</span><span id="line-4457"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT ErrNoSuchWallet IO () -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadFail m, Show e) =&gt;
ExceptT e m a -&gt; m a
</span><a href="Cardano.Wallet.Unsafe.html#unsafeRunExceptT"><span class="hs-identifier hs-var">unsafeRunExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrNoSuchWallet IO () -&gt; IO ())
-&gt; ExceptT ErrNoSuchWallet IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *).
(HasNetworkLayer IO ctx, HasDBLayer IO s k ctx,
 HasLogger IO WalletWorkerLog ctx, IsOurs s Address,
 IsOurs s RewardAccount, AddressBookIso s, MaybeLight s) =&gt;
ctx -&gt; WalletId -&gt; ExceptT ErrNoSuchWallet IO ()
</span><a href="Cardano.Wallet.html#restoreWallet"><span class="hs-identifier hs-var">W.restoreWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480182"><span class="hs-identifier hs-var">ctx'</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480192"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4458"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Any -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m ()
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">race_</span></a></span><span>
</span><span id="line-4459"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO Any
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO Any) -&gt; IO () -&gt; IO Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionConfig -&gt; WalletLayer IO s k -&gt; WalletId -&gt; IO ()
forall ctx s (k :: Depth -&gt; * -&gt; *) (m :: * -&gt; *).
(MonadUnliftIO m, MonadMonotonicTime m,
 HasLogger IO WalletWorkerLog ctx, HasNetworkLayer m ctx,
 HasDBLayer m s k ctx) =&gt;
LocalTxSubmissionConfig -&gt; ctx -&gt; WalletId -&gt; m ()
</span><a href="Cardano.Wallet.html#runLocalTxSubmissionPool"><span class="hs-identifier hs-var">W.runLocalTxSubmissionPool</span></a></span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionConfig
</span><a href="#local-6989586621682480179"><span class="hs-identifier hs-var">txCfg</span></a></span><span> </span><span class="annot"><span class="annottext">WalletLayer IO s k
WorkerCtx ctx
</span><a href="#local-6989586621682480182"><span class="hs-identifier hs-var">ctx'</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480192"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4460"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; WalletId -&gt; IO ()
</span><a href="#local-6989586621682480193"><span class="hs-identifier hs-var">coworker</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerCtx ctx
</span><a href="#local-6989586621682480182"><span class="hs-identifier hs-var">ctx'</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480192"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4461"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-4462"></span><span>    </span><span id="local-6989586621682480179"><span class="annot"><span class="annottext">txCfg :: LocalTxSubmissionConfig
</span><a href="#local-6989586621682480179"><span class="hs-identifier hs-var hs-var">txCfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalTxSubmissionConfig
</span><a href="Cardano.Wallet.html#defaultLocalTxSubmissionConfig"><span class="hs-identifier hs-var">W.defaultLocalTxSubmissionConfig</span></a></span><span>
</span><span id="line-4463"></span><span>
</span><span id="line-4464"></span><span class="hs-comment">-- | Something to pass as the coworker action to 'newApiLayer', which does</span><span>
</span><span id="line-4465"></span><span class="hs-comment">-- nothing, and never exits.</span><span>
</span><span id="line-4466"></span><span id="local-6989586621682484175"><span id="local-6989586621682484176"><span id="local-6989586621682484177"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier hs-type">idleWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682484177"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484176"><span class="hs-identifier hs-type">wid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484175"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-4467"></span><span id="idleWorker"><span class="annot"><span class="annottext">idleWorker :: ctx -&gt; wid -&gt; IO a
</span><a href="Cardano.Wallet.Api.Server.html#idleWorker"><span class="hs-identifier hs-var hs-var">idleWorker</span></a></span></span><span> </span><span class="annot"><span class="annottext">ctx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">wid
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO a) -&gt; IO () -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Int -&gt; m ()
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span>
</span><span id="line-4468"></span><span>
</span><span id="line-4469"></span><span class="hs-comment">-- | Run an action in a particular worker context. Fails if there's no worker</span><span>
</span><span id="line-4470"></span><span class="hs-comment">-- for a given id.</span><span>
</span><span id="line-4471"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-type">withWorkerCtx</span></a></span><span>
</span><span id="line-4472"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682484322"><span class="annot"><a href="#local-6989586621682484322"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621682484324"><span class="annot"><a href="#local-6989586621682484324"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621682484323"><span class="annot"><a href="#local-6989586621682484323"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621682484321"><span class="annot"><a href="#local-6989586621682484321"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682484320"><span class="annot"><a href="#local-6989586621682484320"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-4473"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasWorkerRegistry"><span class="hs-identifier hs-type">HasWorkerRegistry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484324"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484323"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484322"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4474"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.html#HasDBFactory"><span class="hs-identifier hs-type">HasDBFactory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484324"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484323"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484322"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4475"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484321"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4476"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-4477"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484322"><span class="hs-identifier hs-type">ctx</span></a></span><span>
</span><span id="line-4478"></span><span>        </span><span class="hs-comment">-- ^ A context that has a registry</span><span>
</span><span id="line-4479"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-4480"></span><span>        </span><span class="hs-comment">-- ^ Wallet to look for</span><span>
</span><span id="line-4481"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4482"></span><span>        </span><span class="hs-comment">-- ^ Wallet not present, handle error</span><span>
</span><span id="line-4483"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-type">ErrWalletNotResponding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4484"></span><span>        </span><span class="hs-comment">-- ^ Wallet worker is dead, handle error</span><span>
</span><span id="line-4485"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerCtx"><span class="hs-identifier hs-type">WorkerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484322"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4486"></span><span>        </span><span class="hs-comment">-- ^ Do something with the wallet</span><span>
</span><span id="line-4487"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-4488"></span><span id="withWorkerCtx"><span class="annot"><span class="annottext">withWorkerCtx :: ctx
-&gt; WalletId
-&gt; (ErrNoSuchWallet -&gt; m a)
-&gt; (ErrWalletNotResponding -&gt; m a)
-&gt; (WorkerCtx ctx -&gt; m a)
-&gt; m a
</span><a href="Cardano.Wallet.Api.Server.html#withWorkerCtx"><span class="hs-identifier hs-var hs-var">withWorkerCtx</span></a></span></span><span> </span><span id="local-6989586621682480176"><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480176"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682480175"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480175"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682480174"><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; m a
</span><a href="#local-6989586621682480174"><span class="hs-identifier hs-var">onMissing</span></a></span></span><span> </span><span id="local-6989586621682480173"><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; m a
</span><a href="#local-6989586621682480173"><span class="hs-identifier hs-var">onNotResponding</span></a></span></span><span> </span><span id="local-6989586621682480172"><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; m a
</span><a href="#local-6989586621682480172"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4489"></span><span>    </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
-&gt; WalletId -&gt; m (Maybe (Worker WalletId (DBLayer IO s k)))
forall (m :: * -&gt; *) key resource.
(MonadIO m, Ord key) =&gt;
WorkerRegistry key resource
-&gt; key -&gt; m (Maybe (Worker key resource))
</span><a href="Cardano.Wallet.Registry.html#lookup"><span class="hs-identifier hs-var">Registry.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480171"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480175"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe (Worker WalletId (DBLayer IO s k)))
-&gt; (Maybe (Worker WalletId (DBLayer IO s k)) -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4490"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Worker WalletId (DBLayer IO s k))
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4491"></span><span>            </span><span id="local-6989586621682480170"><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682480170"><span class="hs-identifier hs-var">wids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [WalletId] -&gt; m [WalletId]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [WalletId] -&gt; m [WalletId]) -&gt; IO [WalletId] -&gt; m [WalletId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k -&gt; IO [WalletId]
forall (m :: * -&gt; *) s (k :: Depth -&gt; * -&gt; *).
DBFactory m s k -&gt; IO [WalletId]
</span><a href="Cardano.Wallet.DB.html#listDatabases"><span class="hs-identifier hs-var hs-var">listDatabases</span></a></span><span> </span><span class="annot"><span class="annottext">DBFactory IO s k
</span><a href="#local-6989586621682480169"><span class="hs-identifier hs-var">df</span></a></span><span>
</span><span id="line-4492"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480175"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; [WalletId] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[WalletId]
</span><a href="#local-6989586621682480170"><span class="hs-identifier hs-var">wids</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-4493"></span><span>                </span><span class="annot"><span class="annottext">ErrWalletNotResponding -&gt; m a
</span><a href="#local-6989586621682480173"><span class="hs-identifier hs-var">onNotResponding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ErrWalletNotResponding
</span><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-var">ErrWalletNotResponding</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480175"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4494"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-4495"></span><span>                </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; m a
</span><a href="#local-6989586621682480174"><span class="hs-identifier hs-var">onMissing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ErrNoSuchWallet
</span><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-var">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480175"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4496"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682480165"><span class="annot"><span class="annottext">Worker WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480165"><span class="hs-identifier hs-var">wrk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4497"></span><span>            </span><span class="annot"><span class="annottext">WorkerCtx ctx -&gt; m a
</span><a href="#local-6989586621682480172"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkerCtx ctx -&gt; m a) -&gt; WorkerCtx ctx -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DBLayer IO s k
-&gt; (WorkerMsg ctx -&gt; WorkerLog (WorkerKey ctx) (WorkerMsg ctx))
-&gt; ctx
-&gt; WorkerCtx ctx
forall resource ctx.
HasWorkerCtx resource ctx =&gt;
resource
-&gt; (WorkerMsg ctx -&gt; WorkerLog (WorkerKey ctx) (WorkerMsg ctx))
-&gt; ctx
-&gt; WorkerCtx ctx
</span><a href="Cardano.Wallet.Registry.html#hoistResource"><span class="hs-identifier hs-var">hoistResource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Worker WalletId (DBLayer IO s k) -&gt; DBLayer IO s k
forall key resource. Worker key resource -&gt; resource
</span><a href="Cardano.Wallet.Registry.html#workerResource"><span class="hs-identifier hs-var hs-var">workerResource</span></a></span><span> </span><span class="annot"><span class="annottext">Worker WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480165"><span class="hs-identifier hs-var">wrk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; WalletWorkerLog -&gt; WorkerLog WalletId WalletWorkerLog
forall key msg. key -&gt; msg -&gt; WorkerLog key msg
</span><a href="Cardano.Wallet.Registry.html#MsgFromWorker"><span class="hs-identifier hs-var">MsgFromWorker</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480175"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480176"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4498"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4499"></span><span>    </span><span id="local-6989586621682480171"><span class="annot"><span class="annottext">re :: WorkerRegistry WalletId (DBLayer IO s k)
</span><a href="#local-6989586621682480171"><span class="hs-identifier hs-var hs-var">re</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480176"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((WorkerRegistry WalletId (DBLayer IO s k)
     -&gt; Const
          (WorkerRegistry WalletId (DBLayer IO s k))
          (WorkerRegistry WalletId (DBLayer IO s k)))
    -&gt; ctx -&gt; Const (WorkerRegistry WalletId (DBLayer IO s k)) ctx)
-&gt; WorkerRegistry WalletId (DBLayer IO s k)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasWorkerRegistry s k ctx =&gt;
Lens' ctx (WorkerRegistry WalletId (DBLayer IO s k))
</span><a href="Cardano.Wallet.Api.html#workerRegistry"><span class="hs-identifier hs-var">workerRegistry</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484324"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484323"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4500"></span><span>    </span><span id="local-6989586621682480169"><span class="annot"><span class="annottext">df :: DBFactory IO s k
</span><a href="#local-6989586621682480169"><span class="hs-identifier hs-var hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ctx
</span><a href="#local-6989586621682480176"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ctx
-&gt; ((DBFactory IO s k
     -&gt; Const (DBFactory IO s k) (DBFactory IO s k))
    -&gt; ctx -&gt; Const (DBFactory IO s k) ctx)
-&gt; DBFactory IO s k
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. HasDBFactory s k ctx =&gt; Lens' ctx (DBFactory IO s k)
forall s (k :: Depth -&gt; * -&gt; *) ctx.
HasDBFactory s k ctx =&gt;
Lens' ctx (DBFactory IO s k)
</span><a href="Cardano.Wallet.Api.html#dbFactory"><span class="hs-identifier hs-var">dbFactory</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484324"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682484323"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-4501"></span><span>
</span><span id="line-4502"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Atomic handler operations
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-4505"></span><span id="local-6989586621682483697"><span id="local-6989586621682483698"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#atomicallyWithHandler"><span class="hs-identifier hs-type">atomicallyWithHandler</span></a></span><span>
</span><span id="line-4506"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483698"><span class="hs-identifier hs-type">lock</span></a></span><span>
</span><span id="line-4507"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.Concierge.html#Concierge"><span class="hs-identifier hs-type">Concierge.Concierge</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483698"><span class="hs-identifier hs-type">lock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682483698"><span class="hs-identifier hs-type">lock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483697"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682483697"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-4508"></span><span id="atomicallyWithHandler"><span class="annot"><span class="annottext">atomicallyWithHandler :: Concierge IO lock -&gt; lock -&gt; Handler a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#atomicallyWithHandler"><span class="hs-identifier hs-var hs-var">atomicallyWithHandler</span></a></span></span><span> </span><span id="local-6989586621682480164"><span class="annot"><span class="annottext">Concierge IO lock
</span><a href="#local-6989586621682480164"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682480163"><span class="annot"><span class="annottext">lock
</span><a href="#local-6989586621682480163"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ServerError IO a -&gt; Handler a
forall a. ExceptT ServerError IO a -&gt; Handler a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Handler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ServerError IO a -&gt; Handler a)
-&gt; (Handler a -&gt; ExceptT ServerError IO a)
-&gt; Handler a
-&gt; Handler a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Concierge IO lock
-&gt; lock -&gt; ExceptT ServerError IO a -&gt; ExceptT ServerError IO a
forall lock (m :: * -&gt; *) a.
(Ord lock, MonadIO m, MonadThrow m) =&gt;
Concierge IO lock -&gt; lock -&gt; m a -&gt; m a
</span><a href="Control.Concurrent.Concierge.html#atomicallyWith"><span class="hs-identifier hs-var">Concierge.atomicallyWith</span></a></span><span> </span><span class="annot"><span class="annottext">Concierge IO lock
</span><a href="#local-6989586621682480164"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">lock
</span><a href="#local-6989586621682480163"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ServerError IO a -&gt; ExceptT ServerError IO a)
-&gt; (Handler a -&gt; ExceptT ServerError IO a)
-&gt; Handler a
-&gt; ExceptT ServerError IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Handler a -&gt; ExceptT ServerError IO a
forall a. Handler a -&gt; ExceptT ServerError IO a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">runHandler'</span></a></span><span>
</span><span id="line-4509"></span><span>
</span><span id="line-4510"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                Error Handling
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-4513"></span><span>
</span><span id="line-4514"></span><span class="hs-comment">-- | Maps types to servant error responses.</span><span>
</span><span id="line-4515"></span><span class="hs-keyword">class</span><span> </span><span id="IsServerError"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-var">IsServerError</span></a></span></span><span> </span><span id="local-6989586621682484446"><span class="annot"><a href="#local-6989586621682484446"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4516"></span><span>    </span><span class="hs-comment">-- | A structured human-readable error code to return to API clients.</span><span>
</span><span id="line-4517"></span><span>    </span><span id="toServerError"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-type">toServerError</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682484446"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span>
</span><span id="line-4518"></span><span>
</span><span id="line-4519"></span><span class="hs-comment">-- | Lift our wallet layer into servant 'Handler', by mapping each error to a</span><span>
</span><span id="line-4520"></span><span class="hs-comment">-- corresponding servant error.</span><span>
</span><span id="line-4521"></span><span id="local-6989586621682484339"><span id="local-6989586621682484340"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-type">liftHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484340"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484340"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484339"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484339"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-4522"></span><span id="liftHandler"><span class="annot"><span class="annottext">liftHandler :: ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var hs-var">liftHandler</span></a></span></span><span> </span><span id="local-6989586621682480160"><span class="annot"><span class="annottext">ExceptT e IO a
</span><a href="#local-6989586621682480160"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ServerError IO a -&gt; Handler a
forall a. ExceptT ServerError IO a -&gt; Handler a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Handler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(e -&gt; ServerError) -&gt; ExceptT e IO a -&gt; ExceptT ServerError IO a
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">withExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT e IO a
</span><a href="#local-6989586621682480160"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4523"></span><span>
</span><span id="line-4524"></span><span id="local-6989586621682484318"><span id="local-6989586621682484319"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-type">liftE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484319"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682484319"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682484318"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-4525"></span><span id="liftE"><span class="annot"><span class="annottext">liftE :: e -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftE"><span class="hs-identifier hs-var hs-var">liftE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT e IO a -&gt; Handler a
forall e a. IsServerError e =&gt; ExceptT e IO a -&gt; Handler a
</span><a href="Cardano.Wallet.Api.Server.html#liftHandler"><span class="hs-identifier hs-var">liftHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT e IO a -&gt; Handler a)
-&gt; (e -&gt; ExceptT e IO a) -&gt; e -&gt; Handler a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; ExceptT e IO a
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">throwE</span></a></span><span>
</span><span id="line-4526"></span><span>
</span><span id="line-4527"></span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-type">apiError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Types.html#ApiErrorCode"><span class="hs-identifier hs-type">ApiErrorCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span>
</span><span id="line-4528"></span><span id="apiError"><span class="annot"><span class="annottext">apiError :: ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var hs-var">apiError</span></a></span></span><span> </span><span id="local-6989586621682480159"><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682480159"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621682480158"><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="#local-6989586621682480158"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621682480157"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682480157"><span class="hs-identifier hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682480159"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4529"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.object</span></a></span><span>
</span><span id="line-4530"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;code&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ApiErrorCode -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="#local-6989586621682480158"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-4531"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;message&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.replace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682480157"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-4532"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-4533"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errHeaders :: [Header]
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4534"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">hContentType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MediaType -&gt; ByteString
forall h. RenderHeader h =&gt; h -&gt; ByteString
</span><a href="../../../../http-media/html/src"><span class="hs-identifier hs-var">renderHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(MediaType -&gt; ByteString) -&gt; MediaType -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy JSON -&gt; MediaType
forall k (ctype :: k). Accept ctype =&gt; Proxy ctype -&gt; MediaType
</span><a href="../../../../servant/html/src"><span class="hs-identifier hs-var">contentType</span></a></span><span> </span><span class="annot"><span class="annottext">(Proxy JSON -&gt; MediaType) -&gt; Proxy JSON -&gt; MediaType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy JSON
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../servant/html/src"><span class="hs-identifier hs-type">JSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4535"></span><span>        </span><span class="annot"><span class="annottext">Header -&gt; [Header] -&gt; [Header]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; [Header]
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682480159"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4536"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-4537"></span><span>
</span><span id="line-4538"></span><span class="hs-keyword">data</span><span> </span><span id="ErrUnexpectedPoolIdPlaceholder"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrUnexpectedPoolIdPlaceholder"><span class="hs-identifier hs-var">ErrUnexpectedPoolIdPlaceholder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ErrUnexpectedPoolIdPlaceholder"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrUnexpectedPoolIdPlaceholder"><span class="hs-identifier hs-var">ErrUnexpectedPoolIdPlaceholder</span></a></span></span><span>
</span><span id="line-4539"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480148"><span id="local-6989586621682480150"><span class="annot"><span class="annottext">ErrUnexpectedPoolIdPlaceholder
-&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool
(ErrUnexpectedPoolIdPlaceholder
 -&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool)
-&gt; (ErrUnexpectedPoolIdPlaceholder
    -&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool)
-&gt; Eq ErrUnexpectedPoolIdPlaceholder
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrUnexpectedPoolIdPlaceholder
-&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool
$c/= :: ErrUnexpectedPoolIdPlaceholder
-&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool
== :: ErrUnexpectedPoolIdPlaceholder
-&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool
$c== :: ErrUnexpectedPoolIdPlaceholder
-&gt; ErrUnexpectedPoolIdPlaceholder -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480142"><span id="local-6989586621682480144"><span id="local-6989586621682480146"><span class="annot"><span class="annottext">Int -&gt; ErrUnexpectedPoolIdPlaceholder -&gt; ShowS
[ErrUnexpectedPoolIdPlaceholder] -&gt; ShowS
ErrUnexpectedPoolIdPlaceholder -&gt; String
(Int -&gt; ErrUnexpectedPoolIdPlaceholder -&gt; ShowS)
-&gt; (ErrUnexpectedPoolIdPlaceholder -&gt; String)
-&gt; ([ErrUnexpectedPoolIdPlaceholder] -&gt; ShowS)
-&gt; Show ErrUnexpectedPoolIdPlaceholder
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrUnexpectedPoolIdPlaceholder] -&gt; ShowS
$cshowList :: [ErrUnexpectedPoolIdPlaceholder] -&gt; ShowS
show :: ErrUnexpectedPoolIdPlaceholder -&gt; String
$cshow :: ErrUnexpectedPoolIdPlaceholder -&gt; String
showsPrec :: Int -&gt; ErrUnexpectedPoolIdPlaceholder -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrUnexpectedPoolIdPlaceholder -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-4540"></span><span>
</span><span id="line-4541"></span><span class="hs-keyword">data</span><span> </span><span id="ErrCreateWallet"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCreateWallet"><span class="hs-identifier hs-var">ErrCreateWallet</span></a></span></span><span>
</span><span id="line-4542"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrCreateWalletAlreadyExists"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCreateWalletAlreadyExists"><span class="hs-identifier hs-var">ErrCreateWalletAlreadyExists</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span>
</span><span id="line-4543"></span><span>        </span><span class="hs-comment">-- ^ Wallet already exists</span><span>
</span><span id="line-4544"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ErrCreateWalletFailedToCreateWorker"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCreateWalletFailedToCreateWorker"><span class="hs-identifier hs-var">ErrCreateWalletFailedToCreateWorker</span></a></span></span><span>
</span><span id="line-4545"></span><span>        </span><span class="hs-comment">-- ^ Somehow, we couldn't create a worker or open a db connection</span><span>
</span><span id="line-4546"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480138"><span id="local-6989586621682480140"><span class="annot"><span class="annottext">ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool
(ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool)
-&gt; (ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool)
-&gt; Eq ErrCreateWallet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool
$c/= :: ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool
== :: ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool
$c== :: ErrCreateWallet -&gt; ErrCreateWallet -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480132"><span id="local-6989586621682480134"><span id="local-6989586621682480136"><span class="annot"><span class="annottext">Int -&gt; ErrCreateWallet -&gt; ShowS
[ErrCreateWallet] -&gt; ShowS
ErrCreateWallet -&gt; String
(Int -&gt; ErrCreateWallet -&gt; ShowS)
-&gt; (ErrCreateWallet -&gt; String)
-&gt; ([ErrCreateWallet] -&gt; ShowS)
-&gt; Show ErrCreateWallet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrCreateWallet] -&gt; ShowS
$cshowList :: [ErrCreateWallet] -&gt; ShowS
show :: ErrCreateWallet -&gt; String
$cshow :: ErrCreateWallet -&gt; String
showsPrec :: Int -&gt; ErrCreateWallet -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrCreateWallet -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-4547"></span><span>
</span><span id="line-4548"></span><span class="hs-keyword">data</span><span> </span><span id="ErrTemporarilyDisabled"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrTemporarilyDisabled"><span class="hs-identifier hs-var">ErrTemporarilyDisabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ErrTemporarilyDisabled"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrTemporarilyDisabled"><span class="hs-identifier hs-var">ErrTemporarilyDisabled</span></a></span></span><span>
</span><span id="line-4549"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682480127"><span id="local-6989586621682480129"><span class="annot"><span class="annottext">ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool
(ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool)
-&gt; (ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool)
-&gt; Eq ErrTemporarilyDisabled
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool
$c/= :: ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool
== :: ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool
$c== :: ErrTemporarilyDisabled -&gt; ErrTemporarilyDisabled -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682480121"><span id="local-6989586621682480123"><span id="local-6989586621682480125"><span class="annot"><span class="annottext">Int -&gt; ErrTemporarilyDisabled -&gt; ShowS
[ErrTemporarilyDisabled] -&gt; ShowS
ErrTemporarilyDisabled -&gt; String
(Int -&gt; ErrTemporarilyDisabled -&gt; ShowS)
-&gt; (ErrTemporarilyDisabled -&gt; String)
-&gt; ([ErrTemporarilyDisabled] -&gt; ShowS)
-&gt; Show ErrTemporarilyDisabled
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrTemporarilyDisabled] -&gt; ShowS
$cshowList :: [ErrTemporarilyDisabled] -&gt; ShowS
show :: ErrTemporarilyDisabled -&gt; String
$cshow :: ErrTemporarilyDisabled -&gt; String
showsPrec :: Int -&gt; ErrTemporarilyDisabled -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrTemporarilyDisabled -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-4550"></span><span>
</span><span id="line-4551"></span><span class="hs-comment">-- | Small helper to easy show things to Text</span><span>
</span><span id="line-4552"></span><span id="local-6989586621682482969"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#showT"><span class="hs-identifier hs-type">showT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682482969"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682482969"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span></span><span>
</span><span id="line-4553"></span><span id="showT"><span class="annot"><span class="annottext">showT :: a -&gt; Text
</span><a href="Cardano.Wallet.Api.Server.html#showT"><span class="hs-identifier hs-var hs-var">showT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (a -&gt; String) -&gt; a -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span>
</span><span id="line-4554"></span><span>
</span><span id="line-4555"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCurrentEpoch"><span class="hs-identifier hs-type">ErrCurrentEpoch</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4556"></span><span>    </span><span id="local-6989586621682480116"><span class="annot"><span class="annottext">toServerError :: ErrCurrentEpoch -&gt; ServerError
</span><a href="#local-6989586621682480116"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4557"></span><span>        </span><span class="annot"><span class="annottext">ErrCurrentEpoch
</span><a href="Cardano.Wallet.Api.Server.html#ErrUnableToDetermineCurrentEpoch"><span class="hs-identifier hs-var">ErrUnableToDetermineCurrentEpoch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4558"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#UnableToDetermineCurrentEpoch"><span class="hs-identifier hs-var">UnableToDetermineCurrentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4559"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I'm unable to determine the current epoch. &quot;</span></span><span>
</span><span id="line-4560"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please wait a while for the node to sync and try again.&quot;</span></span><span>
</span><span id="line-4561"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4562"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCurrentEpochPastHorizonException"><span class="hs-identifier hs-type">ErrCurrentEpochPastHorizonException</span></a></span><span> </span><span id="local-6989586621682480114"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480114"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480114"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4563"></span><span>
</span><span id="line-4564"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrUnexpectedPoolIdPlaceholder"><span class="hs-identifier hs-type">ErrUnexpectedPoolIdPlaceholder</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4565"></span><span>    </span><span id="local-6989586621682480112"><span class="annot"><span class="annottext">toServerError :: ErrUnexpectedPoolIdPlaceholder -&gt; ServerError
</span><a href="#local-6989586621682480112"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4566"></span><span>        </span><span class="annot"><span class="annottext">ErrUnexpectedPoolIdPlaceholder
</span><a href="Cardano.Wallet.Api.Server.html#ErrUnexpectedPoolIdPlaceholder"><span class="hs-identifier hs-var">ErrUnexpectedPoolIdPlaceholder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4567"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TextDecodingError -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TextDecodingError
</span><a href="#local-6989586621682480110"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4568"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-4569"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682480110"><span class="annot"><span class="annottext">TextDecodingError
</span><a href="#local-6989586621682480110"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either TextDecodingError PoolId
forall a. FromText a =&gt; Text -&gt; Either TextDecodingError a
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INVALID&quot;</span></span><span>
</span><span id="line-4570"></span><span>
</span><span id="line-4571"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4572"></span><span>    </span><span id="local-6989586621682480107"><span class="annot"><span class="annottext">toServerError :: ErrNoSuchWallet -&gt; ServerError
</span><a href="#local-6989586621682480107"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4573"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480106"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480106"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4574"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NoSuchWallet"><span class="hs-identifier hs-var">NoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4575"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't find a wallet with the given id: &quot;</span></span><span>
</span><span id="line-4576"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480106"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4577"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4578"></span><span>
</span><span id="line-4579"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-type">ErrWalletNotResponding</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4580"></span><span>    </span><span id="local-6989586621682480102"><span class="annot"><span class="annottext">toServerError :: ErrWalletNotResponding -&gt; ServerError
</span><a href="#local-6989586621682480102"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4581"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWalletNotResponding"><span class="hs-identifier hs-type">ErrWalletNotResponding</span></a></span><span> </span><span id="local-6989586621682480101"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480101"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4582"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#WalletNotResponding"><span class="hs-identifier hs-var">WalletNotResponding</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4583"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;That's embarrassing. My associated worker for&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480101"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4584"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;is no longer responding. This is not something that is supposed&quot;</span></span><span>
</span><span id="line-4585"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;to happen. The worker must have left a trace in the logs of&quot;</span></span><span>
</span><span id="line-4586"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;severity 'Error' when it died which might explain the cause.&quot;</span></span><span>
</span><span id="line-4587"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Said differently, this wallet won't be accessible until the&quot;</span></span><span>
</span><span id="line-4588"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server is restarted but there are good chances it'll recover&quot;</span></span><span>
</span><span id="line-4589"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;itself upon restart.&quot;</span></span><span>
</span><span id="line-4590"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4591"></span><span>
</span><span id="line-4592"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4593"></span><span>    </span><span id="local-6989586621682480097"><span class="annot"><span class="annottext">toServerError :: ErrWalletAlreadyExists -&gt; ServerError
</span><a href="#local-6989586621682480097"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4594"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrWalletAlreadyExists"><span class="hs-identifier hs-type">ErrWalletAlreadyExists</span></a></span><span> </span><span id="local-6989586621682480096"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480096"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4595"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err409</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#WalletAlreadyExists"><span class="hs-identifier hs-var">WalletAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4596"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;This operation would yield a wallet with the following id: &quot;</span></span><span>
</span><span id="line-4597"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480096"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4598"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; However, I already know of a wallet with this id.&quot;</span></span><span>
</span><span id="line-4599"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4600"></span><span>
</span><span id="line-4601"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCreateWallet"><span class="hs-identifier hs-type">ErrCreateWallet</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4602"></span><span>    </span><span id="local-6989586621682480093"><span class="annot"><span class="annottext">toServerError :: ErrCreateWallet -&gt; ServerError
</span><a href="#local-6989586621682480093"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4603"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrCreateWalletAlreadyExists"><span class="hs-identifier hs-type">ErrCreateWalletAlreadyExists</span></a></span><span> </span><span id="local-6989586621682480092"><span class="annot"><span class="annottext">ErrWalletAlreadyExists
</span><a href="#local-6989586621682480092"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWalletAlreadyExists -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWalletAlreadyExists
</span><a href="#local-6989586621682480092"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4604"></span><span>        </span><span class="annot"><span class="annottext">ErrCreateWallet
</span><a href="Cardano.Wallet.Api.Server.html#ErrCreateWalletFailedToCreateWorker"><span class="hs-identifier hs-var">ErrCreateWalletFailedToCreateWorker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4605"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4606"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;That's embarrassing. Your wallet looks good, but I couldn't &quot;</span></span><span>
</span><span id="line-4607"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;open a new database to store its data. This is unexpected &quot;</span></span><span>
</span><span id="line-4608"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;and likely not your fault. Perhaps, check your filesystem's &quot;</span></span><span>
</span><span id="line-4609"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;permissions or available space?&quot;</span></span><span>
</span><span id="line-4610"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4611"></span><span>
</span><span id="line-4612"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKey"><span class="hs-identifier hs-type">ErrWithRootKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4613"></span><span>    </span><span id="local-6989586621682480089"><span class="annot"><span class="annottext">toServerError :: ErrWithRootKey -&gt; ServerError
</span><a href="#local-6989586621682480089"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4614"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyNoRootKey"><span class="hs-identifier hs-type">ErrWithRootKeyNoRootKey</span></a></span><span> </span><span id="local-6989586621682480087"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480087"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4615"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NoRootKey"><span class="hs-identifier hs-var">NoRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4616"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't find a root private key for the given wallet: &quot;</span></span><span>
</span><span id="line-4617"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480087"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. However, this operation requires that I do &quot;</span></span><span>
</span><span id="line-4618"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;have such a key. Either there's no such wallet, or I don't &quot;</span></span><span>
</span><span id="line-4619"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;fully own it.&quot;</span></span><span>
</span><span id="line-4620"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4621"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongPassphrase"><span class="hs-identifier hs-type">ErrWithRootKeyWrongPassphrase</span></a></span><span> </span><span id="local-6989586621682480084"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480084"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="annot"><span class="annottext">ErrWrongPassphrase
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#ErrWrongPassphrase"><span class="hs-identifier hs-var">ErrWrongPassphrase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4622"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#WrongEncryptionPassphrase"><span class="hs-identifier hs-var">WrongEncryptionPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4623"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The given encryption passphrase doesn't match the one I use &quot;</span></span><span>
</span><span id="line-4624"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;to encrypt the root private key of the given wallet: &quot;</span></span><span>
</span><span id="line-4625"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480084"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4626"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4627"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongMnemonic"><span class="hs-identifier hs-type">ErrWithRootKeyWrongMnemonic</span></a></span><span> </span><span id="local-6989586621682480081"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480081"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4628"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#WrongMnemonic"><span class="hs-identifier hs-var">WrongMnemonic</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4629"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The given mnemonic doesn't match the one this wallet was created with &quot;</span></span><span>
</span><span id="line-4630"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span>
</span><span id="line-4631"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480081"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4632"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4633"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongPassphrase"><span class="hs-identifier hs-type">ErrWithRootKeyWrongPassphrase</span></a></span><span> </span><span id="local-6989586621682480079"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480079"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#ErrPassphraseSchemeUnsupported"><span class="hs-identifier hs-type">ErrPassphraseSchemeUnsupported</span></a></span><span> </span><span id="local-6989586621682480077"><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682480077"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4634"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err501</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#WrongEncryptionPassphrase"><span class="hs-identifier hs-var">WrongEncryptionPassphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4635"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;This build is not compiled with support for the &quot;</span></span><span>
</span><span id="line-4636"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassphraseScheme -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseScheme
</span><a href="#local-6989586621682480077"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; scheme used by the given wallet: &quot;</span></span><span>
</span><span id="line-4637"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480079"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4638"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4639"></span><span>
</span><span id="line-4640"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrListAssets"><span class="hs-identifier hs-type">ErrListAssets</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4641"></span><span>    </span><span id="local-6989586621682480075"><span class="annot"><span class="annottext">toServerError :: ErrListAssets -&gt; ServerError
</span><a href="#local-6989586621682480075"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4642"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrListAssetsNoSuchWallet"><span class="hs-identifier hs-type">ErrListAssetsNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480074"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480074"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480074"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4643"></span><span>
</span><span id="line-4644"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrGetAsset"><span class="hs-identifier hs-type">ErrGetAsset</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4645"></span><span>    </span><span id="local-6989586621682480072"><span class="annot"><span class="annottext">toServerError :: ErrGetAsset -&gt; ServerError
</span><a href="#local-6989586621682480072"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4646"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#ErrGetAssetNoSuchWallet"><span class="hs-identifier hs-type">ErrGetAssetNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480071"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480071"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480071"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4647"></span><span>        </span><span class="annot"><span class="annottext">ErrGetAsset
</span><a href="Cardano.Wallet.Api.Server.html#ErrGetAssetNotPresent"><span class="hs-identifier hs-var">ErrGetAssetNotPresent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4648"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#AssetNotPresent"><span class="hs-identifier hs-var">AssetNotPresent</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4649"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The requested asset is not associated with this wallet.&quot;</span></span><span>
</span><span id="line-4650"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4651"></span><span>
</span><span id="line-4652"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatistics"><span class="hs-identifier hs-type">ErrListUTxOStatistics</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4653"></span><span>    </span><span id="local-6989586621682480068"><span class="annot"><span class="annottext">toServerError :: ErrListUTxOStatistics -&gt; ServerError
</span><a href="#local-6989586621682480068"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4654"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrListUTxOStatisticsNoSuchWallet"><span class="hs-identifier hs-type">ErrListUTxOStatisticsNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480066"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480066"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480066"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4655"></span><span>
</span><span id="line-4656"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPayment"><span class="hs-identifier hs-type">ErrSignPayment</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4657"></span><span>    </span><span id="local-6989586621682480064"><span class="annot"><span class="annottext">toServerError :: ErrSignPayment -&gt; ServerError
</span><a href="#local-6989586621682480064"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4658"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentMkTx"><span class="hs-identifier hs-type">ErrSignPaymentMkTx</span></a></span><span> </span><span id="local-6989586621682480062"><span class="annot"><span class="annottext">ErrMkTransaction
</span><a href="#local-6989586621682480062"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction
</span><a href="#local-6989586621682480062"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4659"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentNoSuchWallet"><span class="hs-identifier hs-type">ErrSignPaymentNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480060"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480060"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480060"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4660"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span>
</span><span id="line-4661"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span>
</span><span id="line-4662"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4663"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentWithRootKey"><span class="hs-identifier hs-type">ErrSignPaymentWithRootKey</span></a></span><span> </span><span id="local-6989586621682480057"><span class="annot"><span class="annottext">e :: ErrWithRootKey
</span><a href="#local-6989586621682480057"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyNoRootKey"><span class="hs-identifier hs-type">ErrWithRootKeyNoRootKey</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682480057"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4664"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">403</span></span><span>
</span><span id="line-4665"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span>
</span><span id="line-4666"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4667"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentWithRootKey"><span class="hs-identifier hs-type">ErrSignPaymentWithRootKey</span></a></span><span> </span><span id="local-6989586621682480056"><span class="annot"><span class="annottext">e :: ErrWithRootKey
</span><a href="#local-6989586621682480056"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongPassphrase"><span class="hs-identifier hs-type">ErrWithRootKeyWrongPassphrase</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682480056"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4668"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentWithRootKey"><span class="hs-identifier hs-type">ErrSignPaymentWithRootKey</span></a></span><span> </span><span id="local-6989586621682480055"><span class="annot"><span class="annottext">e :: ErrWithRootKey
</span><a href="#local-6989586621682480055"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongMnemonic"><span class="hs-identifier hs-type">ErrWithRootKeyWrongMnemonic</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682480055"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4669"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignPaymentIncorrectTTL"><span class="hs-identifier hs-type">ErrSignPaymentIncorrectTTL</span></a></span><span> </span><span id="local-6989586621682480053"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480053"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480053"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4670"></span><span>
</span><span id="line-4671"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTx"><span class="hs-identifier hs-type">ErrWitnessTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4672"></span><span>    </span><span id="local-6989586621682480051"><span class="annot"><span class="annottext">toServerError :: ErrWitnessTx -&gt; ServerError
</span><a href="#local-6989586621682480051"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4673"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxSignTx"><span class="hs-identifier hs-type">ErrWitnessTxSignTx</span></a></span><span> </span><span id="local-6989586621682480049"><span class="annot"><span class="annottext">ErrSignTx
</span><a href="#local-6989586621682480049"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrSignTx -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSignTx
</span><a href="#local-6989586621682480049"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4674"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxNoSuchWallet"><span class="hs-identifier hs-type">ErrWitnessTxNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480048"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480048"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480048"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4675"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span>
</span><span id="line-4676"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span>
</span><span id="line-4677"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4678"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxWithRootKey"><span class="hs-identifier hs-type">ErrWitnessTxWithRootKey</span></a></span><span> </span><span id="local-6989586621682480047"><span class="annot"><span class="annottext">e :: ErrWithRootKey
</span><a href="#local-6989586621682480047"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyNoRootKey"><span class="hs-identifier hs-type">ErrWithRootKeyNoRootKey</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682480047"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4679"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">403</span></span><span>
</span><span id="line-4680"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span>
</span><span id="line-4681"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4682"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxWithRootKey"><span class="hs-identifier hs-type">ErrWitnessTxWithRootKey</span></a></span><span> </span><span id="local-6989586621682480046"><span class="annot"><span class="annottext">e :: ErrWithRootKey
</span><a href="#local-6989586621682480046"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongPassphrase"><span class="hs-identifier hs-type">ErrWithRootKeyWrongPassphrase</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682480046"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4683"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxWithRootKey"><span class="hs-identifier hs-type">ErrWitnessTxWithRootKey</span></a></span><span> </span><span id="local-6989586621682480045"><span class="annot"><span class="annottext">e :: ErrWithRootKey
</span><a href="#local-6989586621682480045"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.html#ErrWithRootKeyWrongMnemonic"><span class="hs-identifier hs-type">ErrWithRootKeyWrongMnemonic</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682480045"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4684"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWitnessTxIncorrectTTL"><span class="hs-identifier hs-type">ErrWitnessTxIncorrectTTL</span></a></span><span> </span><span id="local-6989586621682480043"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480043"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480043"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4685"></span><span>
</span><span id="line-4686"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrSignTx"><span class="hs-identifier hs-type">ErrSignTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4687"></span><span>    </span><span id="local-6989586621682480041"><span class="annot"><span class="annottext">toServerError :: ErrSignTx -&gt; ServerError
</span><a href="#local-6989586621682480041"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4688"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrSignTxAddressUnknown"><span class="hs-identifier hs-type">ErrSignTxAddressUnknown</span></a></span><span> </span><span id="local-6989586621682480039"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480039"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4689"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#KeyNotFoundForAddress"><span class="hs-identifier hs-var">KeyNotFoundForAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4690"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't sign the given transaction because I &quot;</span></span><span>
</span><span id="line-4691"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;could not resolve the address of a transaction input &quot;</span></span><span>
</span><span id="line-4692"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;that I should be tracking: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Cardano.Wallet.Api.Server.html#showT"><span class="hs-identifier hs-var">showT</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621682480039"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-4693"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4694"></span><span>        </span><span class="annot"><span class="annottext">ErrSignTx
</span><a href="Cardano.Wallet.Transaction.html#ErrSignTxUnimplemented"><span class="hs-identifier hs-var">ErrSignTxUnimplemented</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4695"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err501</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-4696"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;This feature is not yet implemented.&quot;</span></span><span>
</span><span id="line-4697"></span><span>
</span><span id="line-4698"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransaction"><span class="hs-identifier hs-type">ErrMkTransaction</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4699"></span><span>    </span><span id="local-6989586621682480034"><span class="annot"><span class="annottext">toServerError :: ErrMkTransaction -&gt; ServerError
</span><a href="#local-6989586621682480034"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4700"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransactionTxBodyError"><span class="hs-identifier hs-type">ErrMkTransactionTxBodyError</span></a></span><span> </span><span id="local-6989586621682480032"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682480032"><span class="hs-identifier hs-var">hint</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4701"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedInvalidTransaction"><span class="hs-identifier hs-var">CreatedInvalidTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682480032"><span class="hs-identifier hs-var">hint</span></a></span><span>
</span><span id="line-4702"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransactionInvalidEra"><span class="hs-identifier hs-type">ErrMkTransactionInvalidEra</span></a></span><span> </span><span id="local-6989586621682480029"><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682480029"><span class="hs-identifier hs-var">_era</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4703"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedInvalidTransaction"><span class="hs-identifier hs-var">CreatedInvalidTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4704"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Whoops, it seems like I just experienced a hard-fork in the &quot;</span></span><span>
</span><span id="line-4705"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;middle of other tasks. This is a pretty rare situation but &quot;</span></span><span>
</span><span id="line-4706"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;as a result, I must throw away what I was doing. Please &quot;</span></span><span>
</span><span id="line-4707"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;retry your request.&quot;</span></span><span>
</span><span id="line-4708"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4709"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransactionJoinStakePool"><span class="hs-identifier hs-type">ErrMkTransactionJoinStakePool</span></a></span><span> </span><span id="local-6989586621682480027"><span class="annot"><span class="annottext">ErrCannotJoin
</span><a href="#local-6989586621682480027"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotJoin
</span><a href="#local-6989586621682480027"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4710"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransactionQuitStakePool"><span class="hs-identifier hs-type">ErrMkTransactionQuitStakePool</span></a></span><span> </span><span id="local-6989586621682480025"><span class="annot"><span class="annottext">ErrCannotQuit
</span><a href="#local-6989586621682480025"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit
</span><a href="#local-6989586621682480025"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4711"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransactionNoSuchWallet"><span class="hs-identifier hs-type">ErrMkTransactionNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480023"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480023"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletId -&gt; ErrNoSuchWallet
</span><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-var">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682480023"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4712"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrMkTransactionIncorrectTTL"><span class="hs-identifier hs-type">ErrMkTransactionIncorrectTTL</span></a></span><span> </span><span id="local-6989586621682480021"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480021"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480021"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4713"></span><span>
</span><span id="line-4714"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTx"><span class="hs-identifier hs-type">ErrConstructTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4715"></span><span>    </span><span id="local-6989586621682480019"><span class="annot"><span class="annottext">toServerError :: ErrConstructTx -&gt; ServerError
</span><a href="#local-6989586621682480019"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4716"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongPayload"><span class="hs-identifier hs-var">ErrConstructTxWrongPayload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4717"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedInvalidTransaction"><span class="hs-identifier hs-var">CreatedInvalidTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4718"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like I've created an empty transaction &quot;</span></span><span>
</span><span id="line-4719"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;that does not have any payments, withdrawals, delegations, &quot;</span></span><span>
</span><span id="line-4720"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;metadata nor minting. Include at least one of them.&quot;</span></span><span>
</span><span id="line-4721"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4722"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxBody"><span class="hs-identifier hs-type">ErrConstructTxBody</span></a></span><span> </span><span id="local-6989586621682480017"><span class="annot"><span class="annottext">ErrMkTransaction
</span><a href="#local-6989586621682480017"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMkTransaction
</span><a href="#local-6989586621682480017"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4723"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxNoSuchWallet"><span class="hs-identifier hs-type">ErrConstructTxNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682480016"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480016"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682480016"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4724"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span>
</span><span id="line-4725"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span>
</span><span id="line-4726"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4727"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxReadRewardAccount"><span class="hs-identifier hs-type">ErrConstructTxReadRewardAccount</span></a></span><span> </span><span id="local-6989586621682480014"><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="#local-6989586621682480014"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="#local-6989586621682480014"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4728"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxIncorrectTTL"><span class="hs-identifier hs-type">ErrConstructTxIncorrectTTL</span></a></span><span> </span><span id="local-6989586621682480012"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480012"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682480012"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4729"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxMultidelegationNotSupported"><span class="hs-identifier hs-var">ErrConstructTxMultidelegationNotSupported</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4730"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedMultidelegationTransaction"><span class="hs-identifier hs-var">CreatedMultidelegationTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4731"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like I've created a transaction &quot;</span></span><span>
</span><span id="line-4732"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;with multiple delegations, which is not supported at this moment.&quot;</span></span><span>
</span><span id="line-4733"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please use at most one delegation action: join, quit or none.&quot;</span></span><span>
</span><span id="line-4734"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4735"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxMultiaccountNotSupported"><span class="hs-identifier hs-var">ErrConstructTxMultiaccountNotSupported</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4736"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedMultiaccountTransaction"><span class="hs-identifier hs-var">CreatedMultiaccountTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4737"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like I've created a transaction &quot;</span></span><span>
</span><span id="line-4738"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;with a delegation, which uses a stake key for the unsupported account.&quot;</span></span><span>
</span><span id="line-4739"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please use delegation action engaging '0H' account.&quot;</span></span><span>
</span><span id="line-4740"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4741"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongMintingBurningTemplate"><span class="hs-identifier hs-var">ErrConstructTxWrongMintingBurningTemplate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4742"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedWrongPolicyScriptTemplate"><span class="hs-identifier hs-var">CreatedWrongPolicyScriptTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4743"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like I've created a transaction with a minting/burning &quot;</span></span><span>
</span><span id="line-4744"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;policy script that either does not pass validation, contains &quot;</span></span><span>
</span><span id="line-4745"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;more than one cosigner, or has a cosigner that is different &quot;</span></span><span>
</span><span id="line-4746"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;from cosigner#0.&quot;</span></span><span>
</span><span id="line-4747"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4748"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxAssetNameTooLong"><span class="hs-identifier hs-var">ErrConstructTxAssetNameTooLong</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4749"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#AssetNameTooLong"><span class="hs-identifier hs-var">AssetNameTooLong</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4750"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Attempted to create a transaction with an asset name that is &quot;</span></span><span>
</span><span id="line-4751"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;too long. The maximum length is 32 bytes.&quot;</span></span><span>
</span><span id="line-4752"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4753"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxMintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier hs-var">ErrConstructTxMintOrBurnAssetQuantityOutOfBounds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4754"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#MintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier hs-var">MintOrBurnAssetQuantityOutOfBounds</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4755"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Attempted to mint or burn an asset quantity that is out of &quot;</span></span><span>
</span><span id="line-4756"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;bounds. The asset quantity must be greater than zero and must &quot;</span></span><span>
</span><span id="line-4757"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;not exceed 9223372036854775807 (2^63 - 1).&quot;</span></span><span>
</span><span id="line-4758"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4759"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxWrongValidityBounds"><span class="hs-identifier hs-var">ErrConstructTxWrongValidityBounds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4760"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InvalidValidityBounds"><span class="hs-identifier hs-var">InvalidValidityBounds</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4761"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Attempted to create a transaction with invalid validity bounds.&quot;</span></span><span>
</span><span id="line-4762"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please make sure that the 'invalid_before' bound precedes the&quot;</span></span><span>
</span><span id="line-4763"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'invalid_hereafter' bound, and that you have not used negative&quot;</span></span><span>
</span><span id="line-4764"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;time values.&quot;</span></span><span>
</span><span id="line-4765"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4766"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxValidityIntervalNotWithinScriptTimelock"><span class="hs-identifier hs-var">ErrConstructTxValidityIntervalNotWithinScriptTimelock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4767"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#ValidityIntervalNotInsideScriptTimelock"><span class="hs-identifier hs-var">ValidityIntervalNotInsideScriptTimelock</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4768"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Attempted to create a transaction with a validity interval&quot;</span></span><span>
</span><span id="line-4769"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;that is not a subinterval of an associated script's timelock&quot;</span></span><span>
</span><span id="line-4770"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;interval.&quot;</span></span><span>
</span><span id="line-4771"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4772"></span><span>        </span><span class="annot"><span class="annottext">ErrConstructTx
</span><a href="Cardano.Wallet.html#ErrConstructTxSharedWalletPending"><span class="hs-identifier hs-var">ErrConstructTxSharedWalletPending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4773"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletPending"><span class="hs-identifier hs-var">SharedWalletPending</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4774"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot construct transaction for a shared wallet that is in 'incomplete' &quot;</span></span><span>
</span><span id="line-4775"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;state. Please update your wallet accordingly with &quot;</span></span><span>
</span><span id="line-4776"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'PATCH /shared-wallets/{walletId}/payment-script-template' or &quot;</span></span><span>
</span><span id="line-4777"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'PATCH /shared-wallets/{walletId}/delegation-script-template' to make &quot;</span></span><span>
</span><span id="line-4778"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;it applicable for constructing transaction.&quot;</span></span><span>
</span><span id="line-4779"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4780"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructTxNotImplemented"><span class="hs-identifier hs-type">ErrConstructTxNotImplemented</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4781"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err501</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-4782"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;This feature is not yet implemented.&quot;</span></span><span>
</span><span id="line-4783"></span><span>
</span><span id="line-4784"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyId"><span class="hs-identifier hs-type">ErrGetPolicyId</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4785"></span><span>    </span><span id="local-6989586621682480002"><span class="annot"><span class="annottext">toServerError :: ErrGetPolicyId -&gt; ServerError
</span><a href="#local-6989586621682480002"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4786"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetPolicyIdReadPolicyPubliKey"><span class="hs-identifier hs-type">ErrGetPolicyIdReadPolicyPubliKey</span></a></span><span> </span><span id="local-6989586621682480000"><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
</span><a href="#local-6989586621682480000"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
</span><a href="#local-6989586621682480000"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4787"></span><span>        </span><span class="annot"><span class="annottext">ErrGetPolicyId
</span><a href="Cardano.Wallet.html#ErrGetPolicyIdWrongMintingBurningTemplate"><span class="hs-identifier hs-var">ErrGetPolicyIdWrongMintingBurningTemplate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4788"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedWrongPolicyScriptTemplate"><span class="hs-identifier hs-var">CreatedWrongPolicyScriptTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4789"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like policy id is requested for a &quot;</span></span><span>
</span><span id="line-4790"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;policy script that either does not pass validation, contains &quot;</span></span><span>
</span><span id="line-4791"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;more than one cosigner, or has a cosigner that is different &quot;</span></span><span>
</span><span id="line-4792"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;from cosigner#0.&quot;</span></span><span>
</span><span id="line-4793"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4794"></span><span>
</span><span id="line-4795"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTx"><span class="hs-identifier hs-type">ErrDecodeTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4796"></span><span>    </span><span id="local-6989586621682479998"><span class="annot"><span class="annottext">toServerError :: ErrDecodeTx -&gt; ServerError
</span><a href="#local-6989586621682479998"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4797"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrDecodeTxNoSuchWallet"><span class="hs-identifier hs-type">ErrDecodeTxNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479996"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479996"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479996"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4798"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span>
</span><span id="line-4799"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span>
</span><span id="line-4800"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4801"></span><span>
</span><span id="line-4802"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTx"><span class="hs-identifier hs-type">ErrBalanceTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4803"></span><span>    </span><span id="local-6989586621682479994"><span class="annot"><span class="annottext">toServerError :: ErrBalanceTx -&gt; ServerError
</span><a href="#local-6989586621682479994"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4804"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrByronTxNotSupported"><span class="hs-identifier hs-var">ErrByronTxNotSupported</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4805"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxByronNotSupported"><span class="hs-identifier hs-var">BalanceTxByronNotSupported</span></a></span><span>
</span><span id="line-4806"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Balancing Byron transactions is not supported.&quot;</span></span><span>
</span><span id="line-4807"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxUpdateError"><span class="hs-identifier hs-type">ErrBalanceTxUpdateError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrExistingKeyWitnesses"><span class="hs-identifier hs-type">ErrExistingKeyWitnesses</span></a></span><span> </span><span id="local-6989586621682479990"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479990"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4808"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxExistingKeyWitnesses"><span class="hs-identifier hs-var">BalanceTxExistingKeyWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4809"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction could not be balanced, because it contains &quot;</span></span><span>
</span><span id="line-4810"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479990"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-4811"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;existing key-witnesses which would be invalid after &quot;</span></span><span>
</span><span id="line-4812"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the transaction body is modified. &quot;</span></span><span>
</span><span id="line-4813"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please sign the transaction after it is balanced instead.&quot;</span></span><span>
</span><span id="line-4814"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4815"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxSelectAssets"><span class="hs-identifier hs-type">ErrBalanceTxSelectAssets</span></a></span><span> </span><span id="local-6989586621682479987"><span class="annot"><span class="annottext">ErrSelectAssets
</span><a href="#local-6989586621682479987"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrSelectAssets -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrSelectAssets
</span><a href="#local-6989586621682479987"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4816"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxAssignRedeemers"><span class="hs-identifier hs-type">ErrBalanceTxAssignRedeemers</span></a></span><span> </span><span id="local-6989586621682479985"><span class="annot"><span class="annottext">ErrAssignRedeemers
</span><a href="#local-6989586621682479985"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrAssignRedeemers -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAssignRedeemers
</span><a href="#local-6989586621682479985"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4817"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxConflictingNetworks"><span class="hs-identifier hs-var">ErrBalanceTxConflictingNetworks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4818"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxConflictingNetworks"><span class="hs-identifier hs-var">BalanceTxConflictingNetworks</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4819"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;There are withdrawals for multiple networks (e.g. both&quot;</span></span><span>
</span><span id="line-4820"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;mainnet and testnet) in the provided transaction. This&quot;</span></span><span>
</span><span id="line-4821"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;makes no sense, and I'm confused.&quot;</span></span><span>
</span><span id="line-4822"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4823"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxExistingCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingCollateral</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4824"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxExistingCollateral"><span class="hs-identifier hs-var">BalanceTxExistingCollateral</span></a></span><span>
</span><span id="line-4825"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot balance transactions with pre-defined collateral.&quot;</span></span><span>
</span><span id="line-4826"></span><span>
</span><span id="line-4827"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxExistingTotalCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingTotalCollateral</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4828"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxExistingTotalCollateral"><span class="hs-identifier hs-var">BalanceTxExistingTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4829"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot balance transactions&quot;</span></span><span>
</span><span id="line-4830"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;with pre-defined total collateral.&quot;</span></span><span>
</span><span id="line-4831"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4832"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxExistingReturnCollateral"><span class="hs-identifier hs-var">ErrBalanceTxExistingReturnCollateral</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4833"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxExistingReturnCollateral"><span class="hs-identifier hs-var">BalanceTxExistingReturnCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4834"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Balancing transactions with pre-defined&quot;</span></span><span>
</span><span id="line-4835"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;collateral return outputs is not yet supported.&quot;</span></span><span>
</span><span id="line-4836"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4837"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxZeroAdaOutput"><span class="hs-identifier hs-var">ErrBalanceTxZeroAdaOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4838"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err501</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxZeroAdaOutput"><span class="hs-identifier hs-var">BalanceTxZeroAdaOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4839"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I don't currently support balancing transactions containing&quot;</span></span><span>
</span><span id="line-4840"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;one or more zero-ada outputs. In the future I might be able&quot;</span></span><span>
</span><span id="line-4841"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;to increase the values to the minimum allowed ada value.&quot;</span></span><span>
</span><span id="line-4842"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4843"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-type">ErrBalanceTxInternalError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrFailedBalancing"><span class="hs-identifier hs-type">ErrFailedBalancing</span></a></span><span> </span><span id="local-6989586621682479972"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682479972"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4844"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxInternalError"><span class="hs-identifier hs-var">BalanceTxInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4845"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I have somehow failed to balance the transaction.&quot;</span></span><span>
</span><span id="line-4846"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The balance is&quot;</span></span><span>
</span><span id="line-4847"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682479972"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4848"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4849"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrBalanceTxInternalError"><span class="hs-identifier hs-type">ErrBalanceTxInternalError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrUnderestimatedFee"><span class="hs-identifier hs-type">ErrUnderestimatedFee</span></a></span><span> </span><span id="local-6989586621682479969"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682479969"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4850"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxUnderestimatedFee"><span class="hs-identifier hs-var">BalanceTxUnderestimatedFee</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4851"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I have somehow underestimated the fee of the transaction by&quot;</span></span><span>
</span><span id="line-4852"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682479969"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-4853"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;and cannot finish balancing.&quot;</span></span><span>
</span><span id="line-4854"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4855"></span><span>        </span><span class="annot"><span class="annottext">ErrBalanceTx
</span><a href="Cardano.Wallet.html#ErrBalanceTxMaxSizeLimitExceeded"><span class="hs-identifier hs-var">ErrBalanceTxMaxSizeLimitExceeded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4856"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BalanceTxMaxSizeLimitExceeded"><span class="hs-identifier hs-var">BalanceTxMaxSizeLimitExceeded</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-4857"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was not able to balance the transaction without exceeding&quot;</span></span><span>
</span><span id="line-4858"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the maximum transaction size.&quot;</span></span><span>
</span><span id="line-4859"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4860"></span><span>
</span><span id="line-4861"></span><span>
</span><span id="line-4862"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTx"><span class="hs-identifier hs-type">ErrRemoveTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4863"></span><span>    </span><span id="local-6989586621682479964"><span class="annot"><span class="annottext">toServerError :: ErrRemoveTx -&gt; ServerError
</span><a href="#local-6989586621682479964"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4864"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTxNoSuchWallet"><span class="hs-identifier hs-type">ErrRemoveTxNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479962"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479962"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479962"><span class="hs-identifier hs-var">wid</span></a></span><span>
</span><span id="line-4865"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTxNoSuchTransaction"><span class="hs-identifier hs-type">ErrRemoveTxNoSuchTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span> </span><span id="local-6989586621682479959"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682479959"><span class="hs-identifier hs-var">_wid</span></a></span></span><span> </span><span id="local-6989586621682479958"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682479958"><span class="hs-identifier hs-var">tid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4866"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NoSuchTransaction"><span class="hs-identifier hs-var">NoSuchTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4867"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't find a transaction with the given id: &quot;</span></span><span>
</span><span id="line-4868"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682479958"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-4869"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4870"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrRemoveTxAlreadyInLedger"><span class="hs-identifier hs-type">ErrRemoveTxAlreadyInLedger</span></a></span><span> </span><span id="local-6989586621682479955"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682479955"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4871"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#TransactionAlreadyInLedger"><span class="hs-identifier hs-var">TransactionAlreadyInLedger</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4872"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction with id: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682479955"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4873"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; cannot be forgotten as it is already in the ledger.&quot;</span></span><span>
</span><span id="line-4874"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4875"></span><span>
</span><span id="line-4876"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTx"><span class="hs-identifier hs-type">ErrPostTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4877"></span><span>    </span><span id="local-6989586621682479952"><span class="annot"><span class="annottext">toServerError :: ErrPostTx -&gt; ServerError
</span><a href="#local-6989586621682479952"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4878"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Network.html#ErrPostTxValidationError"><span class="hs-identifier hs-type">ErrPostTxValidationError</span></a></span><span> </span><span id="local-6989586621682479950"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479950"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4879"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedInvalidTransaction"><span class="hs-identifier hs-var">CreatedInvalidTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4880"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The submitted transaction was rejected by the local &quot;</span></span><span>
</span><span id="line-4881"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;node. Here's an error message that may help with &quot;</span></span><span>
</span><span id="line-4882"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;debugging:\n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479950"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4883"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4884"></span><span>
</span><span id="line-4885"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransaction"><span class="hs-identifier hs-type">ErrSubmitTransaction</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4886"></span><span>    </span><span id="local-6989586621682479948"><span class="annot"><span class="annottext">toServerError :: ErrSubmitTransaction -&gt; ServerError
</span><a href="#local-6989586621682479948"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4887"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransactionNoSuchWallet"><span class="hs-identifier hs-type">ErrSubmitTransactionNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479946"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479946"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479946"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4888"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span>
</span><span id="line-4889"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span>
</span><span id="line-4890"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4891"></span><span>        </span><span class="annot"><span class="annottext">ErrSubmitTransaction
</span><a href="Cardano.Wallet.html#ErrSubmitTransactionForeignWallet"><span class="hs-identifier hs-var">ErrSubmitTransactionForeignWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4892"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#ForeignTransaction"><span class="hs-identifier hs-var">ForeignTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4893"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction to be submitted is foreign to the current wallet &quot;</span></span><span>
</span><span id="line-4894"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;and cannot be sent. Submit a transaction that has either input &quot;</span></span><span>
</span><span id="line-4895"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;or withdrawal belonging to the wallet.&quot;</span></span><span>
</span><span id="line-4896"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4897"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTransactionPartiallySignedOrNoSignedTx"><span class="hs-identifier hs-type">ErrSubmitTransactionPartiallySignedOrNoSignedTx</span></a></span><span> </span><span id="local-6989586621682479944"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479944"><span class="hs-identifier hs-var">expectedWitsNo</span></a></span></span><span> </span><span id="local-6989586621682479943"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479943"><span class="hs-identifier hs-var">foundWitsNo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4898"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#MissingWitnessesInTransaction"><span class="hs-identifier hs-var">MissingWitnessesInTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4899"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction has &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479944"><span class="hs-identifier hs-var">expectedWitsNo</span></a></span><span>
</span><span id="line-4900"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; inputs and &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479943"><span class="hs-identifier hs-var">foundWitsNo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; witnesses included.&quot;</span></span><span>
</span><span id="line-4901"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Submit fully-signed transaction.&quot;</span></span><span>
</span><span id="line-4902"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4903"></span><span>        </span><span class="annot"><span class="annottext">ErrSubmitTransaction
</span><a href="Cardano.Wallet.html#ErrSubmitTransactionMultidelegationNotSupported"><span class="hs-identifier hs-var">ErrSubmitTransactionMultidelegationNotSupported</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4904"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CreatedMultidelegationTransaction"><span class="hs-identifier hs-var">CreatedMultidelegationTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4905"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like the transaction to be sent contains&quot;</span></span><span>
</span><span id="line-4906"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;multiple delegations, which is not supported at this moment.&quot;</span></span><span>
</span><span id="line-4907"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please use at most one delegation action in a submitted transaction: join, quit or none.&quot;</span></span><span>
</span><span id="line-4908"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4909"></span><span>
</span><span id="line-4910"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTx"><span class="hs-identifier hs-type">ErrSubmitTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4911"></span><span>    </span><span id="local-6989586621682479940"><span class="annot"><span class="annottext">toServerError :: ErrSubmitTx -&gt; ServerError
</span><a href="#local-6989586621682479940"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4912"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTxNetwork"><span class="hs-identifier hs-type">ErrSubmitTxNetwork</span></a></span><span> </span><span id="local-6989586621682479938"><span class="annot"><span class="annottext">ErrPostTx
</span><a href="#local-6989586621682479938"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrPostTx -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrPostTx
</span><a href="#local-6989586621682479938"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4913"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTxNoSuchWallet"><span class="hs-identifier hs-type">ErrSubmitTxNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479936"><span class="annot"><span class="annottext">e :: ErrNoSuchWallet
</span><a href="#local-6989586621682479936"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479936"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4914"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="#local-6989586621682480059"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span>
</span><span id="line-4915"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var">errReasonPhrase</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span>
</span><span id="line-4916"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-4917"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSubmitTxImpossible"><span class="hs-identifier hs-type">ErrSubmitTxImpossible</span></a></span><span> </span><span id="local-6989586621682479934"><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682479934"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682479934"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4918"></span><span>
</span><span id="line-4919"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphrase"><span class="hs-identifier hs-type">ErrUpdatePassphrase</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4920"></span><span>    </span><span id="local-6989586621682479932"><span class="annot"><span class="annottext">toServerError :: ErrUpdatePassphrase -&gt; ServerError
</span><a href="#local-6989586621682479932"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4921"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphraseNoSuchWallet"><span class="hs-identifier hs-type">ErrUpdatePassphraseNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479930"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479930"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479930"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4922"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrUpdatePassphraseWithRootKey"><span class="hs-identifier hs-type">ErrUpdatePassphraseWithRootKey</span></a></span><span> </span><span id="local-6989586621682479929"><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479929"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479929"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4923"></span><span>
</span><span id="line-4924"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactions"><span class="hs-identifier hs-type">ErrListTransactions</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4925"></span><span>    </span><span id="local-6989586621682479927"><span class="annot"><span class="annottext">toServerError :: ErrListTransactions -&gt; ServerError
</span><a href="#local-6989586621682479927"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4926"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsNoSuchWallet"><span class="hs-identifier hs-type">ErrListTransactionsNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479925"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479925"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479925"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4927"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsStartTimeLaterThanEndTime"><span class="hs-identifier hs-type">ErrListTransactionsStartTimeLaterThanEndTime</span></a></span><span> </span><span id="local-6989586621682479923"><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682479923"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682479923"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4928"></span><span>        </span><span class="annot"><span class="annottext">ErrListTransactions
</span><a href="Cardano.Wallet.html#ErrListTransactionsMinWithdrawalWrong"><span class="hs-identifier hs-var">ErrListTransactionsMinWithdrawalWrong</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4929"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#MinWithdrawalWrong"><span class="hs-identifier hs-var">MinWithdrawalWrong</span></a></span><span>
</span><span id="line-4930"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The minimum withdrawal value must be at least 1 Lovelace.&quot;</span></span><span>
</span><span id="line-4931"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrListTransactionsPastHorizonException"><span class="hs-identifier hs-type">ErrListTransactionsPastHorizonException</span></a></span><span> </span><span id="local-6989586621682479919"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682479919"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PastHorizonException -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621682479919"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4932"></span><span>
</span><span id="line-4933"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-type">ErrStartTimeLaterThanEndTime</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4934"></span><span>    </span><span id="local-6989586621682479917"><span class="annot"><span class="annottext">toServerError :: ErrStartTimeLaterThanEndTime -&gt; ServerError
</span><a href="#local-6989586621682479917"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span id="local-6989586621682479916"><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682479916"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#StartTimeLaterThanEndTime"><span class="hs-identifier hs-var">StartTimeLaterThanEndTime</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4935"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The specified start time '&quot;</span></span><span>
</span><span id="line-4936"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Iso8601Time -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">(Iso8601Time -&gt; Text) -&gt; Iso8601Time -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Iso8601Time
</span><a href="Cardano.Wallet.Api.Types.html#Iso8601Time"><span class="hs-identifier hs-var">Iso8601Time</span></a></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; Iso8601Time) -&gt; UTCTime -&gt; Iso8601Time
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime -&gt; UTCTime
</span><a href="Cardano.Wallet.html#%24sel%3AerrStartTime%3AErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var hs-var">errStartTime</span></a></span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682479916"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4937"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' is later than the specified end time '&quot;</span></span><span>
</span><span id="line-4938"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Iso8601Time -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">(Iso8601Time -&gt; Text) -&gt; Iso8601Time -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Iso8601Time
</span><a href="Cardano.Wallet.Api.Types.html#Iso8601Time"><span class="hs-identifier hs-var">Iso8601Time</span></a></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; Iso8601Time) -&gt; UTCTime -&gt; Iso8601Time
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime -&gt; UTCTime
</span><a href="Cardano.Wallet.html#%24sel%3AerrEndTime%3AErrStartTimeLaterThanEndTime"><span class="hs-identifier hs-var hs-var">errEndTime</span></a></span><span> </span><span class="annot"><span class="annottext">ErrStartTimeLaterThanEndTime
</span><a href="#local-6989586621682479916"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4939"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'.&quot;</span></span><span>
</span><span id="line-4940"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-4941"></span><span>
</span><span id="line-4942"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="../../../../ouroboros-consensus/html/src"><span class="hs-identifier hs-type">PastHorizonException</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4943"></span><span>    </span><span id="local-6989586621682479910"><span class="annot"><span class="annottext">toServerError :: PastHorizonException -&gt; ServerError
</span><a href="#local-6989586621682479910"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err503</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#PastHorizon"><span class="hs-identifier hs-var">PastHorizon</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4944"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Tried to convert something that is past the horizon&quot;</span></span><span>
</span><span id="line-4945"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (due to uncertainty about the next hard fork).&quot;</span></span><span>
</span><span id="line-4946"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Wait for the node to finish syncing to the hard fork.&quot;</span></span><span>
</span><span id="line-4947"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Depending on the blockchain, this process can take an&quot;</span></span><span>
</span><span id="line-4948"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; unknown amount of time.&quot;</span></span><span>
</span><span id="line-4949"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-4950"></span><span>
</span><span id="line-4951"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransaction"><span class="hs-identifier hs-type">ErrGetTransaction</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4952"></span><span>    </span><span id="local-6989586621682479907"><span class="annot"><span class="annottext">toServerError :: ErrGetTransaction -&gt; ServerError
</span><a href="#local-6989586621682479907"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4953"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransactionNoSuchWallet"><span class="hs-identifier hs-type">ErrGetTransactionNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479905"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479905"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479905"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4954"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrGetTransactionNoSuchTransaction"><span class="hs-identifier hs-type">ErrGetTransactionNoSuchTransaction</span></a></span><span> </span><span id="local-6989586621682479903"><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682479903"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchTransaction
</span><a href="#local-6989586621682479903"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4955"></span><span>
</span><span id="line-4956"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4957"></span><span>    </span><span id="local-6989586621682479901"><span class="annot"><span class="annottext">toServerError :: ErrNoSuchTransaction -&gt; ServerError
</span><a href="#local-6989586621682479901"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4958"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.DB.html#ErrNoSuchTransaction"><span class="hs-identifier hs-type">ErrNoSuchTransaction</span></a></span><span> </span><span id="local-6989586621682479900"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682479900"><span class="hs-identifier hs-var">_wid</span></a></span></span><span> </span><span id="local-6989586621682479899"><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682479899"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4959"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NoSuchTransaction"><span class="hs-identifier hs-var">NoSuchTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4960"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't find a transaction with the given id: &quot;</span></span><span>
</span><span id="line-4961"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
</span><a href="#local-6989586621682479899"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-4962"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4963"></span><span>
</span><span id="line-4964"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegation"><span class="hs-identifier hs-type">ErrStakePoolDelegation</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4965"></span><span>    </span><span id="local-6989586621682479897"><span class="annot"><span class="annottext">toServerError :: ErrStakePoolDelegation -&gt; ServerError
</span><a href="#local-6989586621682479897"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4966"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolDelegationNoSuchWallet"><span class="hs-identifier hs-type">ErrStakePoolDelegationNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479895"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479895"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479895"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4967"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolJoin"><span class="hs-identifier hs-type">ErrStakePoolJoin</span></a></span><span> </span><span id="local-6989586621682479893"><span class="annot"><span class="annottext">ErrCannotJoin
</span><a href="#local-6989586621682479893"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCannotJoin -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotJoin
</span><a href="#local-6989586621682479893"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4968"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrStakePoolQuit"><span class="hs-identifier hs-type">ErrStakePoolQuit</span></a></span><span> </span><span id="local-6989586621682479891"><span class="annot"><span class="annottext">ErrCannotQuit
</span><a href="#local-6989586621682479891"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCannotQuit
</span><a href="#local-6989586621682479891"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-4969"></span><span>
</span><span id="line-4970"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotJoin"><span class="hs-identifier hs-type">ErrCannotJoin</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4971"></span><span>    </span><span id="local-6989586621682479889"><span class="annot"><span class="annottext">toServerError :: ErrCannotJoin -&gt; ServerError
</span><a href="#local-6989586621682479889"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4972"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAlreadyDelegating"><span class="hs-identifier hs-type">ErrAlreadyDelegating</span></a></span><span> </span><span id="local-6989586621682479887"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682479887"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4973"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#PoolAlreadyJoined"><span class="hs-identifier hs-var">PoolAlreadyJoined</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4974"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't join a stake pool with the given id: &quot;</span></span><span>
</span><span id="line-4975"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682479887"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-4976"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. I have already joined this pool;&quot;</span></span><span>
</span><span id="line-4977"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; joining again would incur an unnecessary fee!&quot;</span></span><span>
</span><span id="line-4978"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4979"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrNoSuchPool"><span class="hs-identifier hs-type">ErrNoSuchPool</span></a></span><span> </span><span id="local-6989586621682479884"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682479884"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4980"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NoSuchPool"><span class="hs-identifier hs-var">NoSuchPool</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4981"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't find any stake pool with the given id: &quot;</span></span><span>
</span><span id="line-4982"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682479884"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-4983"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4984"></span><span>
</span><span id="line-4985"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrCannotQuit"><span class="hs-identifier hs-type">ErrCannotQuit</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4986"></span><span>    </span><span id="local-6989586621682479881"><span class="annot"><span class="annottext">toServerError :: ErrCannotQuit -&gt; ServerError
</span><a href="#local-6989586621682479881"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-4987"></span><span>        </span><span class="annot"><span class="annottext">ErrCannotQuit
</span><a href="Cardano.Wallet.Transaction.html#ErrNotDelegatingOrAboutTo"><span class="hs-identifier hs-var">ErrNotDelegatingOrAboutTo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4988"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotDelegatingTo"><span class="hs-identifier hs-var">NotDelegatingTo</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4989"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It seems that you're trying to retire from delegation &quot;</span></span><span>
</span><span id="line-4990"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;although you're not even delegating, nor won't be in an &quot;</span></span><span>
</span><span id="line-4991"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;immediate future.&quot;</span></span><span>
</span><span id="line-4992"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4993"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrNonNullRewards"><span class="hs-identifier hs-type">ErrNonNullRewards</span></a></span><span> </span><span id="local-6989586621682479877"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682479877"><span class="hs-identifier hs-var">rewards</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4994"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NonNullRewards"><span class="hs-identifier hs-var">NonNullRewards</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-4995"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It seems that you're trying to retire from delegation &quot;</span></span><span>
</span><span id="line-4996"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;although you've unspoiled rewards in your rewards &quot;</span></span><span>
</span><span id="line-4997"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;account! Make sure to withdraw your &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621682479877"><span class="hs-identifier hs-var">rewards</span></a></span><span>
</span><span id="line-4998"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; lovelace first.&quot;</span></span><span>
</span><span id="line-4999"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5000"></span><span>
</span><span id="line-5001"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewards"><span class="hs-identifier hs-type">ErrFetchRewards</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5002"></span><span>    </span><span id="local-6989586621682479874"><span class="annot"><span class="annottext">toServerError :: ErrFetchRewards -&gt; ServerError
</span><a href="#local-6989586621682479874"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5003"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrFetchRewardsReadRewardAccount"><span class="hs-identifier hs-type">ErrFetchRewardsReadRewardAccount</span></a></span><span> </span><span id="local-6989586621682479872"><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="#local-6989586621682479872"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="#local-6989586621682479872"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5004"></span><span>
</span><span id="line-5005"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccount"><span class="hs-identifier hs-type">ErrReadRewardAccount</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5006"></span><span>    </span><span id="local-6989586621682479870"><span class="annot"><span class="annottext">toServerError :: ErrReadRewardAccount -&gt; ServerError
</span><a href="#local-6989586621682479870"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5007"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadRewardAccountNoSuchWallet"><span class="hs-identifier hs-type">ErrReadRewardAccountNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479868"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479868"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479868"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5008"></span><span>        </span><span class="annot"><span class="annottext">ErrReadRewardAccount
</span><a href="Cardano.Wallet.html#ErrReadRewardAccountNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadRewardAccountNotAShelleyWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5009"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InvalidWalletType"><span class="hs-identifier hs-var">InvalidWalletType</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5010"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It is regrettable but you've just attempted an operation &quot;</span></span><span>
</span><span id="line-5011"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;that is invalid for this type of wallet. Only new 'Shelley' &quot;</span></span><span>
</span><span id="line-5012"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;wallets can do something with rewards and this one isn't.&quot;</span></span><span>
</span><span id="line-5013"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5014"></span><span>
</span><span id="line-5015"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKey"><span class="hs-identifier hs-type">ErrReadPolicyPublicKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5016"></span><span>    </span><span id="local-6989586621682479865"><span class="annot"><span class="annottext">toServerError :: ErrReadPolicyPublicKey -&gt; ServerError
</span><a href="#local-6989586621682479865"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5017"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-type">ErrReadPolicyPublicKeyNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479863"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479863"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479863"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5018"></span><span>        </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyNotAShelleyWallet"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyNotAShelleyWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5019"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InvalidWalletType"><span class="hs-identifier hs-var">InvalidWalletType</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5020"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;You have attempted an operation that is invalid for this &quot;</span></span><span>
</span><span id="line-5021"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type of wallet. Only wallets from the Shelley era onwards &quot;</span></span><span>
</span><span id="line-5022"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;can have rewards, but this wallet is from an era before &quot;</span></span><span>
</span><span id="line-5023"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Shelley.&quot;</span></span><span>
</span><span id="line-5024"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5025"></span><span>        </span><span class="annot"><span class="annottext">ErrReadPolicyPublicKey
</span><a href="Cardano.Wallet.html#ErrReadPolicyPublicKeyAbsent"><span class="hs-identifier hs-var">ErrReadPolicyPublicKeyAbsent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5026"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#MissingPolicyPublicKey"><span class="hs-identifier hs-var">MissingPolicyPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5027"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It seems the wallet lacks a policy public key. Therefore&quot;</span></span><span>
</span><span id="line-5028"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;it's not possible to create a minting/burning&quot;</span></span><span>
</span><span id="line-5029"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transaction or get a policy id. Please first POST to endpoint&quot;</span></span><span>
</span><span id="line-5030"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/wallets/{walletId}/policy-key to set a policy key.&quot;</span></span><span>
</span><span id="line-5031"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5032"></span><span>
</span><span id="line-5033"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKey"><span class="hs-identifier hs-type">ErrWritePolicyPublicKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5034"></span><span>    </span><span id="local-6989586621682479858"><span class="annot"><span class="annottext">toServerError :: ErrWritePolicyPublicKey -&gt; ServerError
</span><a href="#local-6989586621682479858"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5035"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyNoSuchWallet"><span class="hs-identifier hs-type">ErrWritePolicyPublicKeyNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479856"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479856"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479856"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5036"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrWritePolicyPublicKeyWithRootKey"><span class="hs-identifier hs-type">ErrWritePolicyPublicKeyWithRootKey</span></a></span><span>  </span><span id="local-6989586621682479854"><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479854"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479854"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5037"></span><span>
</span><span id="line-5038"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateRandomAddress"><span class="hs-identifier hs-type">ErrCreateRandomAddress</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5039"></span><span>    </span><span id="local-6989586621682479852"><span class="annot"><span class="annottext">toServerError :: ErrCreateRandomAddress -&gt; ServerError
</span><a href="#local-6989586621682479852"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5040"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateAddrNoSuchWallet"><span class="hs-identifier hs-type">ErrCreateAddrNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479850"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479850"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479850"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5041"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateAddrWithRootKey"><span class="hs-identifier hs-type">ErrCreateAddrWithRootKey</span></a></span><span>  </span><span id="local-6989586621682479848"><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479848"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479848"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5042"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrIndexAlreadyExists"><span class="hs-identifier hs-type">ErrIndexAlreadyExists</span></a></span><span> </span><span id="local-6989586621682479846"><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682479846"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5043"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err409</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#AddressAlreadyExists"><span class="hs-identifier hs-var">AddressAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5044"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot derive a new unused address #&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromEnum</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AddressK
</span><a href="#local-6989586621682479846"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5045"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; because I already know of such address.&quot;</span></span><span>
</span><span id="line-5046"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5047"></span><span>        </span><span class="annot"><span class="annottext">ErrCreateRandomAddress
</span><a href="Cardano.Wallet.html#ErrCreateAddressNotAByronWallet"><span class="hs-identifier hs-var">ErrCreateAddressNotAByronWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5048"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InvalidWalletType"><span class="hs-identifier hs-var">InvalidWalletType</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5049"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot derive new address for this wallet type.&quot;</span></span><span>
</span><span id="line-5050"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Make sure to use Byron random wallet id.&quot;</span></span><span>
</span><span id="line-5051"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5052"></span><span>
</span><span id="line-5053"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrImportRandomAddress"><span class="hs-identifier hs-type">ErrImportRandomAddress</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5054"></span><span>    </span><span id="local-6989586621682479841"><span class="annot"><span class="annottext">toServerError :: ErrImportRandomAddress -&gt; ServerError
</span><a href="#local-6989586621682479841"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5055"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrImportAddrNoSuchWallet"><span class="hs-identifier hs-type">ErrImportAddrNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479839"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479839"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479839"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5056"></span><span>        </span><span class="annot"><span class="annottext">ErrImportRandomAddress
</span><a href="Cardano.Wallet.html#ErrImportAddressNotAByronWallet"><span class="hs-identifier hs-var">ErrImportAddressNotAByronWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5057"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InvalidWalletType"><span class="hs-identifier hs-var">InvalidWalletType</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5058"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot derive new address for this wallet type.&quot;</span></span><span>
</span><span id="line-5059"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Make sure to use Byron random wallet id.&quot;</span></span><span>
</span><span id="line-5060"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5061"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrImportAddr"><span class="hs-identifier hs-type">ErrImportAddr</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Random.html#ErrAddrDoesNotBelong"><span class="hs-identifier hs-type">ErrAddrDoesNotBelong</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5062"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#KeyNotFoundForAddress"><span class="hs-identifier hs-var">KeyNotFoundForAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5063"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't identify this address as one of mine. It likely &quot;</span></span><span>
</span><span id="line-5064"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;belongs to another wallet and I will therefore not import it.&quot;</span></span><span>
</span><span id="line-5065"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5066"></span><span>
</span><span id="line-5067"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrNotASequentialWallet"><span class="hs-identifier hs-type">ErrNotASequentialWallet</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5068"></span><span>    </span><span id="local-6989586621682479834"><span class="annot"><span class="annottext">toServerError :: ErrNotASequentialWallet -&gt; ServerError
</span><a href="#local-6989586621682479834"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5069"></span><span>        </span><span class="annot"><span class="annottext">ErrNotASequentialWallet
</span><a href="Cardano.Wallet.html#ErrNotASequentialWallet"><span class="hs-identifier hs-var">ErrNotASequentialWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5070"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InvalidWalletType"><span class="hs-identifier hs-var">InvalidWalletType</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5071"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot derive new address for this wallet type. &quot;</span></span><span>
</span><span id="line-5072"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Make sure to use a sequential wallet style, like Icarus.&quot;</span></span><span>
</span><span id="line-5073"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5074"></span><span>
</span><span id="line-5075"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier hs-type">ErrWithdrawalNotWorth</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5076"></span><span>    </span><span id="local-6989586621682479831"><span class="annot"><span class="annottext">toServerError :: ErrWithdrawalNotWorth -&gt; ServerError
</span><a href="#local-6989586621682479831"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5077"></span><span>        </span><span class="annot"><span class="annottext">ErrWithdrawalNotWorth
</span><a href="Cardano.Wallet.html#ErrWithdrawalNotWorth"><span class="hs-identifier hs-var">ErrWithdrawalNotWorth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5078"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#WithdrawalNotWorth"><span class="hs-identifier hs-var">WithdrawalNotWorth</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5079"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I've noticed that you're requesting a withdrawal from an &quot;</span></span><span>
</span><span id="line-5080"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;account that is either empty or doesn't have a balance big &quot;</span></span><span>
</span><span id="line-5081"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;enough to deserve being withdrawn. I won't proceed with that &quot;</span></span><span>
</span><span id="line-5082"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request.&quot;</span></span><span>
</span><span id="line-5083"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5084"></span><span>
</span><span id="line-5085"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWith"><span class="hs-identifier hs-type">ErrSignMetadataWith</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5086"></span><span>    </span><span id="local-6989586621682479828"><span class="annot"><span class="annottext">toServerError :: ErrSignMetadataWith -&gt; ServerError
</span><a href="#local-6989586621682479828"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5087"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWithRootKey"><span class="hs-identifier hs-type">ErrSignMetadataWithRootKey</span></a></span><span> </span><span id="local-6989586621682479826"><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479826"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479826"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5088"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWithNoSuchWallet"><span class="hs-identifier hs-type">ErrSignMetadataWithNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479824"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479824"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479824"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5089"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSignMetadataWithInvalidIndex"><span class="hs-identifier hs-type">ErrSignMetadataWithInvalidIndex</span></a></span><span> </span><span id="local-6989586621682479822"><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK
</span><a href="#local-6989586621682479822"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK
</span><a href="#local-6989586621682479822"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5090"></span><span>
</span><span id="line-5091"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKey"><span class="hs-identifier hs-type">ErrReadAccountPublicKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5092"></span><span>    </span><span id="local-6989586621682479820"><span class="annot"><span class="annottext">toServerError :: ErrReadAccountPublicKey -&gt; ServerError
</span><a href="#local-6989586621682479820"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5093"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyRootKey"><span class="hs-identifier hs-type">ErrReadAccountPublicKeyRootKey</span></a></span><span> </span><span id="local-6989586621682479818"><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479818"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrWithRootKey
</span><a href="#local-6989586621682479818"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5094"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyNoSuchWallet"><span class="hs-identifier hs-type">ErrReadAccountPublicKeyNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479816"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479816"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479816"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5095"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyInvalidAccountIndex"><span class="hs-identifier hs-type">ErrReadAccountPublicKeyInvalidAccountIndex</span></a></span><span> </span><span id="local-6989586621682479814"><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
</span><a href="#local-6989586621682479814"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
</span><a href="#local-6989586621682479814"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5096"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrReadAccountPublicKeyInvalidPurposeIndex"><span class="hs-identifier hs-type">ErrReadAccountPublicKeyInvalidPurposeIndex</span></a></span><span> </span><span id="local-6989586621682479812"><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'PurposeK
</span><a href="#local-6989586621682479812"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'PurposeK -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'PurposeK
</span><a href="#local-6989586621682479812"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5097"></span><span>
</span><span id="line-5098"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKey"><span class="hs-identifier hs-type">ErrDerivePublicKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5099"></span><span>    </span><span id="local-6989586621682479810"><span class="annot"><span class="annottext">toServerError :: ErrDerivePublicKey -&gt; ServerError
</span><a href="#local-6989586621682479810"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5100"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKeyNoSuchWallet"><span class="hs-identifier hs-type">ErrDerivePublicKeyNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479808"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479808"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479808"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5101"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrDerivePublicKeyInvalidIndex"><span class="hs-identifier hs-type">ErrDerivePublicKeyInvalidIndex</span></a></span><span> </span><span id="local-6989586621682479806"><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK
</span><a href="#local-6989586621682479806"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Soft 'AddressK
</span><a href="#local-6989586621682479806"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5102"></span><span>
</span><span id="line-5103"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5104"></span><span>    </span><span id="local-6989586621682479804"><span class="annot"><span class="annottext">toServerError :: ErrAddCosignerKey -&gt; ServerError
</span><a href="#local-6989586621682479804"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5105"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKeyNoSuchWallet"><span class="hs-identifier hs-type">ErrAddCosignerKeyNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479802"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479802"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479802"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5106"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAddCosigner
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#WalletAlreadyActive"><span class="hs-identifier hs-var">WalletAlreadyActive</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5107"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletNotPending"><span class="hs-identifier hs-var">SharedWalletNotPending</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5108"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've tried to add a cosigner key for a &quot;</span></span><span>
</span><span id="line-5109"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;shared wallet that is active. This can be done only for &quot;</span></span><span>
</span><span id="line-5110"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pending shared wallet.&quot;</span></span><span>
</span><span id="line-5111"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5112"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAddCosigner
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#NoDelegationTemplate"><span class="hs-identifier hs-var">NoDelegationTemplate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5113"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletNoDelegationTemplate"><span class="hs-identifier hs-var">SharedWalletNoDelegationTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5114"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've tried to add a cosigner key to &quot;</span></span><span>
</span><span id="line-5115"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;a shared wallet's delegation template. This cannot be done &quot;</span></span><span>
</span><span id="line-5116"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;for the wallet that does not define any delegation template.&quot;</span></span><span>
</span><span id="line-5117"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5118"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#KeyAlreadyPresent"><span class="hs-identifier hs-type">KeyAlreadyPresent</span></a></span><span> </span><span id="local-6989586621682479795"><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479795"><span class="hs-identifier hs-var">cred</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5119"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletKeyAlreadyExists"><span class="hs-identifier hs-var">SharedWalletKeyAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5120"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've tried to add a cosigner key to a &quot;</span></span><span>
</span><span id="line-5121"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;shared wallet's &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CredentialType -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479795"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; template that is already &quot;</span></span><span>
</span><span id="line-5122"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ascribed to another cosigner. &quot;</span></span><span>
</span><span id="line-5123"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please make sure to assign a different key to each cosigner.&quot;</span></span><span>
</span><span id="line-5124"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5125"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#NoSuchCosigner"><span class="hs-identifier hs-type">NoSuchCosigner</span></a></span><span> </span><span id="local-6989586621682479792"><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479792"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">Cosigner</span></a></span><span> </span><span id="local-6989586621682479791"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682479791"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5126"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletNoSuchCosigner"><span class="hs-identifier hs-var">SharedWalletNoSuchCosigner</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5127"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've tried to add a cosigner key to a &quot;</span></span><span>
</span><span id="line-5128"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;shared wallet's &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CredentialType -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479792"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; template to a &quot;</span></span><span>
</span><span id="line-5129"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;non-existing cosigner index: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682479791"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-5130"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5131"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrAddCosignerKey"><span class="hs-identifier hs-type">ErrAddCosignerKey</span></a></span><span> </span><span class="annot"><span class="annottext">ErrAddCosigner
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#CannotUpdateSharedWalletKey"><span class="hs-identifier hs-var">CannotUpdateSharedWalletKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5132"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletCannotUpdateKey"><span class="hs-identifier hs-var">SharedWalletCannotUpdateKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5133"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've tried to update the key of a cosigner having &quot;</span></span><span>
</span><span id="line-5134"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the shared wallet's account key. Only other cosigner key(s) can be updated.&quot;</span></span><span>
</span><span id="line-5135"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5136"></span><span>
</span><span id="line-5137"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWallet"><span class="hs-identifier hs-type">ErrConstructSharedWallet</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5138"></span><span>    </span><span id="local-6989586621682479786"><span class="annot"><span class="annottext">toServerError :: ErrConstructSharedWallet -&gt; ServerError
</span><a href="#local-6989586621682479786"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5139"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWalletWrongScriptTemplate"><span class="hs-identifier hs-type">ErrConstructSharedWalletWrongScriptTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrScriptTemplateInvalid"><span class="hs-identifier hs-type">ErrScriptTemplateInvalid</span></a></span><span> </span><span id="local-6989586621682479784"><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479784"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621682479783"><span class="annot"><span class="annottext">ErrValidateScriptTemplate
</span><a href="#local-6989586621682479783"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5140"></span><span>            </span><span class="annot"><span class="annottext">CredentialType -&gt; Text -&gt; ServerError
forall a. ToText a =&gt; a -&gt; Text -&gt; ServerError
</span><a href="#local-6989586621682479782"><span class="hs-identifier hs-var">handleTemplateErr</span></a></span><span> </span><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479784"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrValidateScriptTemplate -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">ErrValidateScriptTemplate
</span><a href="#local-6989586621682479783"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5141"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWalletWrongScriptTemplate"><span class="hs-identifier hs-type">ErrConstructSharedWalletWrongScriptTemplate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.Shared.html#ErrScriptTemplateMissingKey"><span class="hs-identifier hs-type">ErrScriptTemplateMissingKey</span></a></span><span> </span><span id="local-6989586621682479780"><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479780"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621682479779"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479779"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5142"></span><span>            </span><span class="annot"><span class="annottext">CredentialType -&gt; Text -&gt; ServerError
forall a. ToText a =&gt; a -&gt; Text -&gt; ServerError
</span><a href="#local-6989586621682479782"><span class="hs-identifier hs-var">handleTemplateErr</span></a></span><span> </span><span class="annot"><span class="annottext">CredentialType
</span><a href="#local-6989586621682479780"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479779"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-5143"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrConstructSharedWalletInvalidIndex"><span class="hs-identifier hs-type">ErrConstructSharedWalletInvalidIndex</span></a></span><span> </span><span id="local-6989586621682479778"><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
</span><a href="#local-6989586621682479778"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInvalidDerivationIndex 'Hardened 'AccountK
</span><a href="#local-6989586621682479778"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5144"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-5145"></span><span>          </span><span id="local-6989586621682479782"><span class="annot"><span class="annottext">handleTemplateErr :: a -&gt; Text -&gt; ServerError
</span><a href="#local-6989586621682479782"><span class="hs-identifier hs-var hs-var">handleTemplateErr</span></a></span></span><span> </span><span id="local-6989586621682479777"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682479777"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621682479776"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479776"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5146"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SharedWalletScriptTemplateInvalid"><span class="hs-identifier hs-var">SharedWalletScriptTemplateInvalid</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5147"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've tried to create a shared wallet &quot;</span></span><span>
</span><span id="line-5148"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;with a template script for &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682479777"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; credential that does not &quot;</span></span><span>
</span><span id="line-5149"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pass validation. The problem is: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479776"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-5150"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5151"></span><span>
</span><span id="line-5152"></span><span id="local-6989586621682479774"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682479774"><span class="hs-identifier hs-type">level</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5153"></span><span>    </span><span id="local-6989586621682479772"><span class="annot"><span class="annottext">toServerError :: ErrInvalidDerivationIndex 'Soft level -&gt; ServerError
</span><a href="#local-6989586621682479772"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5154"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrIndexOutOfBound"><span class="hs-identifier hs-type">ErrIndexOutOfBound</span></a></span><span> </span><span id="local-6989586621682479770"><span class="annot"><span class="annottext">Index 'Soft level
</span><a href="#local-6989586621682479770"><span class="hs-identifier hs-var">minIx</span></a></span></span><span> </span><span id="local-6989586621682479769"><span class="annot"><span class="annottext">Index 'Soft level
</span><a href="#local-6989586621682479769"><span class="hs-identifier hs-var">maxIx</span></a></span></span><span> </span><span id="local-6989586621682479768"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682479768"><span class="hs-identifier hs-var">_ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5155"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#SoftDerivationRequired"><span class="hs-identifier hs-var">SoftDerivationRequired</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5156"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've provided a derivation index that is &quot;</span></span><span>
</span><span id="line-5157"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;out of bound. The index is well-formed, but I require &quot;</span></span><span>
</span><span id="line-5158"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;indexes valid for soft derivation only. That is, indexes &quot;</span></span><span>
</span><span id="line-5159"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;between &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index 'Soft level -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft level
</span><a href="#local-6989586621682479770"><span class="hs-identifier hs-var">minIx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; and &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index 'Soft level -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft level
</span><a href="#local-6989586621682479769"><span class="hs-identifier hs-var">maxIx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; without a suffix.&quot;</span></span><span>
</span><span id="line-5160"></span><span>                </span><span class="hs-special">]</span></span><span>
</span><span id="line-5161"></span><span>
</span><span id="line-5162"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputError"><span class="hs-identifier hs-type">SelectionOutputError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5163"></span><span>    </span><span id="local-6989586621682479765"><span class="annot"><span class="annottext">toServerError :: SelectionOutputError WalletSelectionContext -&gt; ServerError
</span><a href="#local-6989586621682479765"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5164"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputCoinInsufficient"><span class="hs-identifier hs-type">SelectionOutputCoinInsufficient</span></a></span><span> </span><span id="local-6989586621682479763"><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
</span><a href="#local-6989586621682479763"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5165"></span><span>            </span><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
</span><a href="#local-6989586621682479763"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5166"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputSizeExceedsLimit"><span class="hs-identifier hs-type">SelectionOutputSizeExceedsLimit</span></a></span><span> </span><span id="local-6989586621682479761"><span class="annot"><span class="annottext">SelectionOutputSizeExceedsLimitError WalletSelectionContext
</span><a href="#local-6989586621682479761"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5167"></span><span>            </span><span class="annot"><span class="annottext">SelectionOutputSizeExceedsLimitError WalletSelectionContext
-&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputSizeExceedsLimitError WalletSelectionContext
</span><a href="#local-6989586621682479761"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5168"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputTokenQuantityExceedsLimit"><span class="hs-identifier hs-type">SelectionOutputTokenQuantityExceedsLimit</span></a></span><span> </span><span id="local-6989586621682479759"><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479759"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5169"></span><span>            </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
-&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479759"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5170"></span><span>
</span><span id="line-5171"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span>
</span><span id="line-5172"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputCoinInsufficientError"><span class="hs-identifier hs-type">SelectionOutputCoinInsufficientError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5173"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-5174"></span><span>    </span><span id="local-6989586621682479757"><span class="annot"><span class="annottext">toServerError :: SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; ServerError
</span><a href="#local-6989586621682479757"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span id="local-6989586621682479756"><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
</span><a href="#local-6989586621682479756"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5175"></span><span>        </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#UtxoTooSmall"><span class="hs-identifier hs-var">UtxoTooSmall</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unlines</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479753"><span class="hs-identifier hs-var">preamble</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479752"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-5176"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-5177"></span><span>        </span><span id="local-6989586621682479753"><span class="annot"><span class="annottext">preamble :: Text
</span><a href="#local-6989586621682479753"><span class="hs-identifier hs-var hs-var">preamble</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5178"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;One of the outputs you've specified has an ada quantity that is&quot;</span></span><span>
</span><span id="line-5179"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;below the minimum required. Either increase the ada quantity to&quot;</span></span><span>
</span><span id="line-5180"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;at least the minimum, or specify an ada quantity of zero, in&quot;</span></span><span>
</span><span id="line-5181"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;which case the wallet will automatically assign the correct&quot;</span></span><span>
</span><span id="line-5182"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;minimum ada quantity to the output.&quot;</span></span><span>
</span><span id="line-5183"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5184"></span><span>        </span><span id="local-6989586621682479752"><span class="annot"><span class="annottext">details :: Text
</span><a href="#local-6989586621682479752"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unlines</span></a></span><span>
</span><span id="line-5185"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Destination address:&quot;</span></span><span>
</span><span id="line-5186"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Address -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Address, TokenBundle) -&gt; Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Address, TokenBundle) -&gt; Address)
-&gt; (Address, TokenBundle) -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(((Address, TokenBundle)
  -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
 -&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
 -&gt; Const
      (Address, TokenBundle)
      (SelectionOutputCoinInsufficientError WalletSelectionContext))
-&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; (Address, TokenBundle)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;output&quot;
  (((Address, TokenBundle)
    -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
   -&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
   -&gt; Const
        (Address, TokenBundle)
        (SelectionOutputCoinInsufficientError WalletSelectionContext))
((Address, TokenBundle)
 -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
-&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; Const
     (Address, TokenBundle)
     (SelectionOutputCoinInsufficientError WalletSelectionContext)
</span><a href="#local-6989586621682479751"><span class="hs-var">#output</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
</span><a href="#local-6989586621682479756"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5187"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Required minimum ada quantity:&quot;</span></span><span>
</span><span id="line-5188"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
 -&gt; Const
      Coin (SelectionOutputCoinInsufficientError WalletSelectionContext))
-&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;minimumExpectedCoin&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
   -&gt; Const
        Coin (SelectionOutputCoinInsufficientError WalletSelectionContext))
(Coin -&gt; Const Coin Coin)
-&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; Const
     Coin (SelectionOutputCoinInsufficientError WalletSelectionContext)
</span><a href="#local-6989586621682479750"><span class="hs-var">#minimumExpectedCoin</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
</span><a href="#local-6989586621682479756"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5189"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Specified ada quantity:&quot;</span></span><span>
</span><span id="line-5190"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenBundle -&gt; Coin
</span><a href="Cardano.Wallet.Primitive.Types.TokenBundle.html#getCoin"><span class="hs-identifier hs-var">TokenBundle.getCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Coin) -&gt; TokenBundle -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, TokenBundle) -&gt; TokenBundle
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Address, TokenBundle) -&gt; TokenBundle)
-&gt; (Address, TokenBundle) -&gt; TokenBundle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(((Address, TokenBundle)
  -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
 -&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
 -&gt; Const
      (Address, TokenBundle)
      (SelectionOutputCoinInsufficientError WalletSelectionContext))
-&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; (Address, TokenBundle)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;output&quot;
  (((Address, TokenBundle)
    -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
   -&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
   -&gt; Const
        (Address, TokenBundle)
        (SelectionOutputCoinInsufficientError WalletSelectionContext))
((Address, TokenBundle)
 -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
-&gt; SelectionOutputCoinInsufficientError WalletSelectionContext
-&gt; Const
     (Address, TokenBundle)
     (SelectionOutputCoinInsufficientError WalletSelectionContext)
</span><a href="#local-6989586621682479749"><span class="hs-var">#output</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputCoinInsufficientError WalletSelectionContext
</span><a href="#local-6989586621682479756"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5191"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5192"></span><span>
</span><span id="line-5193"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span>
</span><span id="line-5194"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputSizeExceedsLimitError"><span class="hs-identifier hs-type">SelectionOutputSizeExceedsLimitError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-5196"></span><span>    </span><span id="local-6989586621682479747"><span class="annot"><span class="annottext">toServerError :: SelectionOutputSizeExceedsLimitError WalletSelectionContext
-&gt; ServerError
</span><a href="#local-6989586621682479747"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span id="local-6989586621682479746"><span class="annot"><span class="annottext">SelectionOutputSizeExceedsLimitError WalletSelectionContext
</span><a href="#local-6989586621682479746"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#OutputTokenBundleSizeExceedsLimit"><span class="hs-identifier hs-var">OutputTokenBundleSizeExceedsLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-5197"></span><span>        </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5198"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;One of the outputs you've specified contains too many assets. &quot;</span></span><span>
</span><span id="line-5199"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Try splitting these assets across two or more outputs. &quot;</span></span><span>
</span><span id="line-5200"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Destination address: &quot;</span></span><span>
</span><span id="line-5201"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Address -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Address, TokenBundle) -&gt; Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, TokenBundle)
</span><a href="#local-6989586621682479744"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5202"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. Asset count: &quot;</span></span><span>
</span><span id="line-5203"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; Int
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#size"><span class="hs-identifier hs-var">TokenMap.size</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenMap -&gt; Int) -&gt; TokenMap -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, TokenBundle) -&gt; TokenBundle
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Address, TokenBundle)
</span><a href="#local-6989586621682479744"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokens&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; TokenBundle -&gt; Const TokenMap TokenBundle)
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; TokenBundle -&gt; Const TokenMap TokenBundle
</span><a href="#local-6989586621682479742"><span class="hs-var">#tokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5204"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-5205"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-5206"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-5207"></span><span>        </span><span id="local-6989586621682479744"><span class="annot"><span class="annottext">output :: (Address, TokenBundle)
</span><a href="#local-6989586621682479744"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((Address, TokenBundle)
  -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
 -&gt; SelectionOutputSizeExceedsLimitError WalletSelectionContext
 -&gt; Const
      (Address, TokenBundle)
      (SelectionOutputSizeExceedsLimitError WalletSelectionContext))
-&gt; SelectionOutputSizeExceedsLimitError WalletSelectionContext
-&gt; (Address, TokenBundle)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputThatExceedsLimit&quot;
  (((Address, TokenBundle)
    -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
   -&gt; SelectionOutputSizeExceedsLimitError WalletSelectionContext
   -&gt; Const
        (Address, TokenBundle)
        (SelectionOutputSizeExceedsLimitError WalletSelectionContext))
((Address, TokenBundle)
 -&gt; Const (Address, TokenBundle) (Address, TokenBundle))
-&gt; SelectionOutputSizeExceedsLimitError WalletSelectionContext
-&gt; Const
     (Address, TokenBundle)
     (SelectionOutputSizeExceedsLimitError WalletSelectionContext)
</span><a href="#local-6989586621682479741"><span class="hs-var">#outputThatExceedsLimit</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputSizeExceedsLimitError WalletSelectionContext
</span><a href="#local-6989586621682479746"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5208"></span><span>
</span><span id="line-5209"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span>
</span><span id="line-5210"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputTokenQuantityExceedsLimitError"><span class="hs-identifier hs-type">SelectionOutputTokenQuantityExceedsLimitError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5211"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-5212"></span><span>    </span><span id="local-6989586621682479739"><span class="annot"><span class="annottext">toServerError :: SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
-&gt; ServerError
</span><a href="#local-6989586621682479739"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span id="local-6989586621682479738"><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479738"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#OutputTokenQuantityExceedsLimit"><span class="hs-identifier hs-var">OutputTokenQuantityExceedsLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5213"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;One of the token quantities you've specified is greater than the &quot;</span></span><span>
</span><span id="line-5214"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;maximum quantity allowed in a single transaction output. Try &quot;</span></span><span>
</span><span id="line-5215"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;splitting this quantity across two or more outputs. &quot;</span></span><span>
</span><span id="line-5216"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Destination address: &quot;</span></span><span>
</span><span id="line-5217"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Address -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Address -&gt; Const Address Address)
 -&gt; SelectionOutputTokenQuantityExceedsLimitError
      WalletSelectionContext
 -&gt; Const
      Address
      (SelectionOutputTokenQuantityExceedsLimitError
         WalletSelectionContext))
-&gt; SelectionOutputTokenQuantityExceedsLimitError
     WalletSelectionContext
-&gt; Address
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;address&quot;
  ((Address -&gt; Const Address Address)
   -&gt; SelectionOutputTokenQuantityExceedsLimitError
        WalletSelectionContext
   -&gt; Const
        Address
        (SelectionOutputTokenQuantityExceedsLimitError
           WalletSelectionContext))
(Address -&gt; Const Address Address)
-&gt; SelectionOutputTokenQuantityExceedsLimitError
     WalletSelectionContext
-&gt; Const
     Address
     (SelectionOutputTokenQuantityExceedsLimitError
        WalletSelectionContext)
</span><a href="#local-6989586621682479736"><span class="hs-var">#address</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479738"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5218"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. Token policy identifier: &quot;</span></span><span>
</span><span id="line-5219"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenPolicyId -&gt; Const TokenPolicyId TokenPolicyId)
 -&gt; AssetId -&gt; Const TokenPolicyId AssetId)
-&gt; AssetId -&gt; TokenPolicyId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokenPolicyId&quot;
  ((TokenPolicyId -&gt; Const TokenPolicyId TokenPolicyId)
   -&gt; AssetId -&gt; Const TokenPolicyId AssetId)
(TokenPolicyId -&gt; Const TokenPolicyId TokenPolicyId)
-&gt; AssetId -&gt; Const TokenPolicyId AssetId
</span><a href="#local-6989586621682479735"><span class="hs-var">#tokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; TokenPolicyId) -&gt; AssetId -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
-&gt; AssetId
forall ctx.
SelectionOutputTokenQuantityExceedsLimitError ctx -&gt; AssetId
</span><a href="Cardano.Wallet.CoinSelection.Internal.html#%24sel%3Aasset%3ASelectionOutputTokenQuantityExceedsLimitError"><span class="hs-identifier hs-var hs-var">asset</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479738"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5220"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. Asset name: &quot;</span></span><span>
</span><span id="line-5221"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenName -&gt; Const TokenName TokenName)
 -&gt; AssetId -&gt; Const TokenName AssetId)
-&gt; AssetId -&gt; TokenName
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;tokenName&quot;
  ((TokenName -&gt; Const TokenName TokenName)
   -&gt; AssetId -&gt; Const TokenName AssetId)
(TokenName -&gt; Const TokenName TokenName)
-&gt; AssetId -&gt; Const TokenName AssetId
</span><a href="#local-6989586621682479733"><span class="hs-var">#tokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; TokenName) -&gt; AssetId -&gt; TokenName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
-&gt; AssetId
forall ctx.
SelectionOutputTokenQuantityExceedsLimitError ctx -&gt; AssetId
</span><a href="Cardano.Wallet.CoinSelection.Internal.html#%24sel%3Aasset%3ASelectionOutputTokenQuantityExceedsLimitError"><span class="hs-identifier hs-var hs-var">asset</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479738"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5222"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. Token quantity specified: &quot;</span></span><span>
</span><span id="line-5223"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenQuantity -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenQuantity -&gt; Const TokenQuantity TokenQuantity)
 -&gt; SelectionOutputTokenQuantityExceedsLimitError
      WalletSelectionContext
 -&gt; Const
      TokenQuantity
      (SelectionOutputTokenQuantityExceedsLimitError
         WalletSelectionContext))
-&gt; SelectionOutputTokenQuantityExceedsLimitError
     WalletSelectionContext
-&gt; TokenQuantity
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;quantity&quot;
  ((TokenQuantity -&gt; Const TokenQuantity TokenQuantity)
   -&gt; SelectionOutputTokenQuantityExceedsLimitError
        WalletSelectionContext
   -&gt; Const
        TokenQuantity
        (SelectionOutputTokenQuantityExceedsLimitError
           WalletSelectionContext))
(TokenQuantity -&gt; Const TokenQuantity TokenQuantity)
-&gt; SelectionOutputTokenQuantityExceedsLimitError
     WalletSelectionContext
-&gt; Const
     TokenQuantity
     (SelectionOutputTokenQuantityExceedsLimitError
        WalletSelectionContext)
</span><a href="#local-6989586621682479732"><span class="hs-var">#quantity</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479738"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5224"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. Maximum allowable token quantity: &quot;</span></span><span>
</span><span id="line-5225"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenQuantity -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TokenQuantity -&gt; Const TokenQuantity TokenQuantity)
 -&gt; SelectionOutputTokenQuantityExceedsLimitError
      WalletSelectionContext
 -&gt; Const
      TokenQuantity
      (SelectionOutputTokenQuantityExceedsLimitError
         WalletSelectionContext))
-&gt; SelectionOutputTokenQuantityExceedsLimitError
     WalletSelectionContext
-&gt; TokenQuantity
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;quantityMaxBound&quot;
  ((TokenQuantity -&gt; Const TokenQuantity TokenQuantity)
   -&gt; SelectionOutputTokenQuantityExceedsLimitError
        WalletSelectionContext
   -&gt; Const
        TokenQuantity
        (SelectionOutputTokenQuantityExceedsLimitError
           WalletSelectionContext))
(TokenQuantity -&gt; Const TokenQuantity TokenQuantity)
-&gt; SelectionOutputTokenQuantityExceedsLimitError
     WalletSelectionContext
-&gt; Const
     TokenQuantity
     (SelectionOutputTokenQuantityExceedsLimitError
        WalletSelectionContext)
</span><a href="#local-6989586621682479731"><span class="hs-var">#quantityMaxBound</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputTokenQuantityExceedsLimitError
  WalletSelectionContext
</span><a href="#local-6989586621682479738"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5226"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-5227"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-5228"></span><span>
</span><span id="line-5229"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlan"><span class="hs-identifier hs-type">ErrCreateMigrationPlan</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5230"></span><span>    </span><span id="local-6989586621682479729"><span class="annot"><span class="annottext">toServerError :: ErrCreateMigrationPlan -&gt; ServerError
</span><a href="#local-6989586621682479729"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5231"></span><span>        </span><span class="annot"><span class="annottext">ErrCreateMigrationPlan
</span><a href="Cardano.Wallet.html#ErrCreateMigrationPlanEmpty"><span class="hs-identifier hs-var">ErrCreateMigrationPlanEmpty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5232"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NothingToMigrate"><span class="hs-identifier hs-var">NothingToMigrate</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5233"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I wasn't able to construct a migration plan. This could be &quot;</span></span><span>
</span><span id="line-5234"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;because your wallet is empty, or it could be because the &quot;</span></span><span>
</span><span id="line-5235"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;amount of ada in your wallet is insufficient to pay for &quot;</span></span><span>
</span><span id="line-5236"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;any of the funds to be migrated. Try adding some ada to &quot;</span></span><span>
</span><span id="line-5237"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;your wallet before trying again.&quot;</span></span><span>
</span><span id="line-5238"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5239"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrCreateMigrationPlanNoSuchWallet"><span class="hs-identifier hs-type">ErrCreateMigrationPlanNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479727"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479727"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479727"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5240"></span><span>
</span><span id="line-5241"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssets"><span class="hs-identifier hs-type">ErrSelectAssets</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5242"></span><span>    </span><span id="local-6989586621682479725"><span class="annot"><span class="annottext">toServerError :: ErrSelectAssets -&gt; ServerError
</span><a href="#local-6989586621682479725"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5243"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsPrepareOutputsError"><span class="hs-identifier hs-type">ErrSelectAssetsPrepareOutputsError</span></a></span><span> </span><span id="local-6989586621682479723"><span class="annot"><span class="annottext">SelectionOutputError WalletSelectionContext
</span><a href="#local-6989586621682479723"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SelectionOutputError WalletSelectionContext -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputError WalletSelectionContext
</span><a href="#local-6989586621682479723"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5244"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsNoSuchWallet"><span class="hs-identifier hs-type">ErrSelectAssetsNoSuchWallet</span></a></span><span> </span><span id="local-6989586621682479722"><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479722"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet
</span><a href="#local-6989586621682479722"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5245"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsAlreadyWithdrawing"><span class="hs-identifier hs-type">ErrSelectAssetsAlreadyWithdrawing</span></a></span><span> </span><span id="local-6989586621682479720"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682479720"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5246"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#AlreadyWithdrawing"><span class="hs-identifier hs-var">AlreadyWithdrawing</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5247"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I already know of a pending transaction with withdrawals: &quot;</span></span><span>
</span><span id="line-5248"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621682479720"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
    -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
-&gt; Hash &quot;Tx&quot;
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txId&quot;
  ((Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
   -&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx)
(Hash &quot;Tx&quot; -&gt; Const (Hash &quot;Tx&quot;) (Hash &quot;Tx&quot;))
-&gt; Tx -&gt; Const (Hash &quot;Tx&quot;) Tx
</span><a href="#local-6989586621682479718"><span class="hs-var">#txId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5249"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. Note that when I withdraw rewards, I &quot;</span></span><span>
</span><span id="line-5250"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;need to withdraw them fully for the Ledger to accept it. &quot;</span></span><span>
</span><span id="line-5251"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;There's therefore no point creating another conflicting &quot;</span></span><span>
</span><span id="line-5252"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transaction; if, for some reason, you really want a new &quot;</span></span><span>
</span><span id="line-5253"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transaction, then cancel the previous one first.&quot;</span></span><span>
</span><span id="line-5254"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5255"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-type">ErrSelectAssetsSelectionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionBalanceErrorOf"><span class="hs-identifier hs-type">SelectionBalanceErrorOf</span></a></span><span> </span><span id="local-6989586621682479715"><span class="annot"><span class="annottext">SelectionBalanceError WalletSelectionContext
</span><a href="#local-6989586621682479715"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5256"></span><span>            </span><span class="annot"><span class="annottext">SelectionBalanceError WalletSelectionContext -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionBalanceError WalletSelectionContext
</span><a href="#local-6989586621682479715"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5257"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-type">ErrSelectAssetsSelectionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionCollateralErrorOf"><span class="hs-identifier hs-type">SelectionCollateralErrorOf</span></a></span><span> </span><span id="local-6989586621682479713"><span class="annot"><span class="annottext">SelectionCollateralError WalletSelectionContext
</span><a href="#local-6989586621682479713"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5258"></span><span>            </span><span class="annot"><span class="annottext">SelectionCollateralError WalletSelectionContext -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionCollateralError WalletSelectionContext
</span><a href="#local-6989586621682479713"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5259"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrSelectAssetsSelectionError"><span class="hs-identifier hs-type">ErrSelectAssetsSelectionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionOutputErrorOf"><span class="hs-identifier hs-type">SelectionOutputErrorOf</span></a></span><span> </span><span id="local-6989586621682479711"><span class="annot"><span class="annottext">SelectionOutputError WalletSelectionContext
</span><a href="#local-6989586621682479711"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5260"></span><span>            </span><span class="annot"><span class="annottext">SelectionOutputError WalletSelectionContext -&gt; ServerError
forall e. IsServerError e =&gt; e -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#toServerError"><span class="hs-identifier hs-var">toServerError</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionOutputError WalletSelectionContext
</span><a href="#local-6989586621682479711"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5261"></span><span>
</span><span id="line-5262"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionBalanceError"><span class="hs-identifier hs-type">SelectionBalanceError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5263"></span><span>    </span><span id="local-6989586621682479709"><span class="annot"><span class="annottext">toServerError :: SelectionBalanceError WalletSelectionContext -&gt; ServerError
</span><a href="#local-6989586621682479709"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5264"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#BalanceInsufficient"><span class="hs-identifier hs-type">BalanceInsufficient</span></a></span><span> </span><span id="local-6989586621682479707"><span class="annot"><span class="annottext">BalanceInsufficientError
</span><a href="#local-6989586621682479707"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5265"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotEnoughMoney"><span class="hs-identifier hs-var">NotEnoughMoney</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5266"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I can't process this payment as there are not &quot;</span></span><span>
</span><span id="line-5267"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;enough funds available in the wallet. I am &quot;</span></span><span>
</span><span id="line-5268"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;missing: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Flat TokenBundle -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Flat TokenBundle -&gt; Text)
-&gt; (TokenBundle -&gt; Flat TokenBundle) -&gt; TokenBundle -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TokenBundle -&gt; Flat TokenBundle
forall a. a -&gt; Flat a
</span><a href="Cardano.Wallet.Primitive.Types.TokenMap.html#Flat"><span class="hs-identifier hs-var">Flat</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenBundle -&gt; Text) -&gt; TokenBundle -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BalanceInsufficientError -&gt; TokenBundle
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#balanceMissing"><span class="hs-identifier hs-var">balanceMissing</span></a></span><span> </span><span class="annot"><span class="annottext">BalanceInsufficientError
</span><a href="#local-6989586621682479707"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5269"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5270"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#SelectionLimitReached"><span class="hs-identifier hs-type">SelectionLimitReached</span></a></span><span> </span><span id="local-6989586621682479703"><span class="annot"><span class="annottext">SelectionLimitReachedError WalletSelectionContext
</span><a href="#local-6989586621682479703"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5271"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#TransactionIsTooBig"><span class="hs-identifier hs-var">TransactionIsTooBig</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5272"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I am not able to finalize the transaction &quot;</span></span><span>
</span><span id="line-5273"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;because I need to select additional inputs and &quot;</span></span><span>
</span><span id="line-5274"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;doing so will make the transaction too big. Try &quot;</span></span><span>
</span><span id="line-5275"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sending a smaller amount. I had already selected &quot;</span></span><span>
</span><span id="line-5276"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Cardano.Wallet.Api.Server.html#showT"><span class="hs-identifier hs-var">showT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(WalletUTxO, TokenBundle)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([(WalletUTxO, TokenBundle)] -&gt; Int)
-&gt; [(WalletUTxO, TokenBundle)] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([(WalletUTxO, TokenBundle)]
  -&gt; Const [(WalletUTxO, TokenBundle)] [(WalletUTxO, TokenBundle)])
 -&gt; SelectionLimitReachedError WalletSelectionContext
 -&gt; Const
      [(WalletUTxO, TokenBundle)]
      (SelectionLimitReachedError WalletSelectionContext))
-&gt; SelectionLimitReachedError WalletSelectionContext
-&gt; [(WalletUTxO, TokenBundle)]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputsSelected&quot;
  (([(WalletUTxO, TokenBundle)]
    -&gt; Const [(WalletUTxO, TokenBundle)] [(WalletUTxO, TokenBundle)])
   -&gt; SelectionLimitReachedError WalletSelectionContext
   -&gt; Const
        [(WalletUTxO, TokenBundle)]
        (SelectionLimitReachedError WalletSelectionContext))
([(WalletUTxO, TokenBundle)]
 -&gt; Const [(WalletUTxO, TokenBundle)] [(WalletUTxO, TokenBundle)])
-&gt; SelectionLimitReachedError WalletSelectionContext
-&gt; Const
     [(WalletUTxO, TokenBundle)]
     (SelectionLimitReachedError WalletSelectionContext)
</span><a href="#local-6989586621682479701"><span class="hs-var">#inputsSelected</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionLimitReachedError WalletSelectionContext
</span><a href="#local-6989586621682479703"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; inputs.&quot;</span></span><span>
</span><span id="line-5277"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5278"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#UnableToConstructChange"><span class="hs-identifier hs-type">UnableToConstructChange</span></a></span><span> </span><span id="local-6989586621682479699"><span class="annot"><span class="annottext">UnableToConstructChangeError
</span><a href="#local-6989586621682479699"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5279"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#CannotCoverFee"><span class="hs-identifier hs-var">CannotCoverFee</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5280"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I am unable to finalize the transaction, as there&quot;</span></span><span>
</span><span id="line-5281"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;is not enough ada available to pay for the fee and&quot;</span></span><span>
</span><span id="line-5282"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;also pay for the minimum ada quantities of all&quot;</span></span><span>
</span><span id="line-5283"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;change outputs. I need approximately&quot;</span></span><span>
</span><span id="line-5284"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnableToConstructChangeError -&gt; Coin
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#%24sel%3Ashortfall%3AUnableToConstructChangeError"><span class="hs-identifier hs-var hs-var">shortfall</span></a></span><span> </span><span class="annot"><span class="annottext">UnableToConstructChangeError
</span><a href="#local-6989586621682479699"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5285"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ada to proceed. Try increasing your wallet balance&quot;</span></span><span>
</span><span id="line-5286"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;or sending a smaller amount.&quot;</span></span><span>
</span><span id="line-5287"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5288"></span><span>        </span><span class="annot"><span class="annottext">SelectionBalanceError WalletSelectionContext
</span><a href="Cardano.Wallet.CoinSelection.Internal.Balance.html#EmptyUTxO"><span class="hs-identifier hs-var">EmptyUTxO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5289"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotEnoughMoney"><span class="hs-identifier hs-var">NotEnoughMoney</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5290"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cannot create a transaction because the wallet&quot;</span></span><span>
</span><span id="line-5291"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;has no UTxO entries. At least one UTxO entry is&quot;</span></span><span>
</span><span id="line-5292"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;required in order to create a transaction.&quot;</span></span><span>
</span><span id="line-5293"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5294"></span><span>
</span><span id="line-5295"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.CoinSelection.Internal.html#SelectionCollateralError"><span class="hs-identifier hs-type">SelectionCollateralError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.CoinSelection.html#WalletSelectionContext"><span class="hs-identifier hs-type">WalletSelectionContext</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5296"></span><span>    </span><span id="local-6989586621682479695"><span class="annot"><span class="annottext">toServerError :: SelectionCollateralError WalletSelectionContext -&gt; ServerError
</span><a href="#local-6989586621682479695"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span id="local-6989586621682479694"><span class="annot"><span class="annottext">SelectionCollateralError WalletSelectionContext
</span><a href="#local-6989586621682479694"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5297"></span><span>        </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#InsufficientCollateral"><span class="hs-identifier hs-var">InsufficientCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5298"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I'm unable to create this transaction because the balance&quot;</span></span><span>
</span><span id="line-5299"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;of pure ada UTxOs in your wallet is insufficient to cover&quot;</span></span><span>
</span><span id="line-5300"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the minimum amount of collateral required.&quot;</span></span><span>
</span><span id="line-5301"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I need an ada amount of at least:&quot;</span></span><span>
</span><span id="line-5302"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Coin -&gt; Const Coin Coin)
 -&gt; SelectionCollateralError WalletSelectionContext
 -&gt; Const Coin (SelectionCollateralError WalletSelectionContext))
-&gt; SelectionCollateralError WalletSelectionContext -&gt; Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;minimumSelectionAmount&quot;
  ((Coin -&gt; Const Coin Coin)
   -&gt; SelectionCollateralError WalletSelectionContext
   -&gt; Const Coin (SelectionCollateralError WalletSelectionContext))
(Coin -&gt; Const Coin Coin)
-&gt; SelectionCollateralError WalletSelectionContext
-&gt; Const Coin (SelectionCollateralError WalletSelectionContext)
</span><a href="#local-6989586621682479692"><span class="hs-var">#minimumSelectionAmount</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionCollateralError WalletSelectionContext
</span><a href="#local-6989586621682479694"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5303"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The largest combination of pure ada UTxOs I could find is:&quot;</span></span><span>
</span><span id="line-5304"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Text) -&gt; Builder -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Builder
forall (f :: * -&gt; *) a. (Foldable f, Buildable a) =&gt; f a -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">listF</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; Builder) -&gt; [Coin] -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; [Coin]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">L.sort</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; [Coin]) -&gt; [Coin] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletUTxO Coin -&gt; [Coin]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">F.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map WalletUTxO Coin -&gt; [Coin]) -&gt; Map WalletUTxO Coin -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-5305"></span><span>                </span><span class="annot"><span class="annottext">((Map WalletUTxO Coin
  -&gt; Const (Map WalletUTxO Coin) (Map WalletUTxO Coin))
 -&gt; SelectionCollateralError WalletSelectionContext
 -&gt; Const
      (Map WalletUTxO Coin)
      (SelectionCollateralError WalletSelectionContext))
-&gt; SelectionCollateralError WalletSelectionContext
-&gt; Map WalletUTxO Coin
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;largestCombinationAvailable&quot;
  ((Map WalletUTxO Coin
    -&gt; Const (Map WalletUTxO Coin) (Map WalletUTxO Coin))
   -&gt; SelectionCollateralError WalletSelectionContext
   -&gt; Const
        (Map WalletUTxO Coin)
        (SelectionCollateralError WalletSelectionContext))
(Map WalletUTxO Coin
 -&gt; Const (Map WalletUTxO Coin) (Map WalletUTxO Coin))
-&gt; SelectionCollateralError WalletSelectionContext
-&gt; Const
     (Map WalletUTxO Coin)
     (SelectionCollateralError WalletSelectionContext)
</span><a href="#local-6989586621682479690"><span class="hs-var">#largestCombinationAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionCollateralError WalletSelectionContext
</span><a href="#local-6989586621682479694"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5306"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;To fix this, you'll need to add one or more pure ada UTxOs&quot;</span></span><span>
</span><span id="line-5307"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;to your wallet that can cover the minimum amount required.&quot;</span></span><span>
</span><span id="line-5308"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5309"></span><span>
</span><span id="line-5310"></span><span id="local-6989586621682479689"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.html#ErrInvalidDerivationIndex"><span class="hs-identifier hs-type">ErrInvalidDerivationIndex</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Hardened"><span class="hs-identifier hs-type">Hardened</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682479689"><span class="hs-identifier hs-type">level</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5311"></span><span>    </span><span id="local-6989586621682479687"><span class="annot"><span class="annottext">toServerError :: ErrInvalidDerivationIndex 'Hardened level -&gt; ServerError
</span><a href="#local-6989586621682479687"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5312"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.html#ErrIndexOutOfBound"><span class="hs-identifier hs-type">ErrIndexOutOfBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682479686"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682479686"><span class="hs-identifier hs-var">minIx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621682479685"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682479685"><span class="hs-identifier hs-var">maxIx</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682479684"><span class="annot"><span class="annottext">DerivationIndex
</span><a href="#local-6989586621682479684"><span class="hs-identifier hs-var">_ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5313"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err403</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#HardenedDerivationRequired"><span class="hs-identifier hs-var">HardenedDerivationRequired</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5314"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you've provided a derivation index that is &quot;</span></span><span>
</span><span id="line-5315"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;out of bound. The index is well-formed, but I require &quot;</span></span><span>
</span><span id="line-5316"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;indexes valid for hardened derivation only. That is, indexes &quot;</span></span><span>
</span><span id="line-5317"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;between 0H and &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Index Any Any -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Index Any Any
forall (derivationType :: DerivationType) (level :: Depth).
Word32 -&gt; Index derivationType level
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Index Any Any) -&gt; Word32 -&gt; Index Any Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682479685"><span class="hs-identifier hs-var">maxIx</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682479686"><span class="hs-identifier hs-var">minIx</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;H.&quot;</span></span><span>
</span><span id="line-5318"></span><span>                </span><span class="hs-special">]</span></span><span>
</span><span id="line-5319"></span><span>
</span><span id="line-5320"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrUpdateSealedTx"><span class="hs-identifier hs-type">ErrUpdateSealedTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5321"></span><span>    </span><span id="local-6989586621682479681"><span class="annot"><span class="annottext">toServerError :: ErrUpdateSealedTx -&gt; ServerError
</span><a href="#local-6989586621682479681"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5322"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrExistingKeyWitnesses"><span class="hs-identifier hs-type">ErrExistingKeyWitnesses</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5323"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#ExistingKeyWitnesses"><span class="hs-identifier hs-var">ExistingKeyWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5324"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I cannot proceed with the request because there are key&quot;</span></span><span>
</span><span id="line-5325"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;witnesses defined in the input transaction and, adjusting&quot;</span></span><span>
</span><span id="line-5326"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the transaction body will render witnesses invalid!&quot;</span></span><span>
</span><span id="line-5327"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please make sure to remove all key witnesses from the request.&quot;</span></span><span>
</span><span id="line-5328"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5329"></span><span>
</span><span id="line-5330"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemers"><span class="hs-identifier hs-type">ErrAssignRedeemers</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5331"></span><span>    </span><span id="local-6989586621682479678"><span class="annot"><span class="annottext">toServerError :: ErrAssignRedeemers -&gt; ServerError
</span><a href="#local-6989586621682479678"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5332"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemersScriptFailure"><span class="hs-identifier hs-type">ErrAssignRedeemersScriptFailure</span></a></span><span> </span><span id="local-6989586621682479676"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621682479676"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682479675"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682479675"><span class="hs-identifier hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5333"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#RedeemerScriptFailure"><span class="hs-identifier hs-var">RedeemerScriptFailure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5334"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to assign execution units to one of your&quot;</span></span><span>
</span><span id="line-5335"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;redeemers:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621682479676"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-5336"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Its execution is failing with the following error:&quot;</span></span><span>
</span><span id="line-5337"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682479675"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-5338"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5339"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemersTargetNotFound"><span class="hs-identifier hs-type">ErrAssignRedeemersTargetNotFound</span></a></span><span> </span><span id="local-6989586621682479672"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621682479672"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5340"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#RedeemerTargetNotFound"><span class="hs-identifier hs-var">RedeemerTargetNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5341"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to resolve one of your redeemers to the location&quot;</span></span><span>
</span><span id="line-5342"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;indicated in the request payload:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621682479672"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-5343"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please double-check both your serialised transaction and&quot;</span></span><span>
</span><span id="line-5344"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the provided redeemers.&quot;</span></span><span>
</span><span id="line-5345"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5346"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemersInvalidData"><span class="hs-identifier hs-type">ErrAssignRedeemersInvalidData</span></a></span><span> </span><span id="local-6989586621682479669"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621682479669"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5347"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#RedeemerInvalidData"><span class="hs-identifier hs-var">RedeemerInvalidData</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5348"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like you have provided an invalid 'data' payload&quot;</span></span><span>
</span><span id="line-5349"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;for one of your redeemers since I am unable to decode it&quot;</span></span><span>
</span><span id="line-5350"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;into a valid Plutus data:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Text
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621682479669"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-5351"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5352"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemersTranslationError"><span class="hs-identifier hs-type">ErrAssignRedeemersTranslationError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier hs-type">TranslationLogicMissingInput</span></a></span><span> </span><span id="local-6989586621682479666"><span class="annot"><span class="annottext">TxIn StandardCrypto
</span><a href="#local-6989586621682479666"><span class="hs-identifier hs-var">inp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5353"></span><span>             </span><span class="hs-comment">-- Note that although this error is thrown from</span><span>
</span><span id="line-5354"></span><span>             </span><span class="hs-comment">-- '_assignScriptRedeemers', it's more related to balanceTransaction</span><span>
</span><span id="line-5355"></span><span>             </span><span class="hs-comment">-- in general than to assigning redeemers. Hence we don't mention</span><span>
</span><span id="line-5356"></span><span>             </span><span class="hs-comment">-- redeemers in the message.</span><span>
</span><span id="line-5357"></span><span>             </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#UnresolvedInputs"><span class="hs-identifier hs-var">UnresolvedInputs</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5358"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction I was given contains inputs I don't know&quot;</span></span><span>
</span><span id="line-5359"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;about. Please ensure all foreign inputs are specified as &quot;</span></span><span>
</span><span id="line-5360"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;part of the API request. The unknown input is:\n\n&quot;</span></span><span>
</span><span id="line-5361"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto
</span><a href="#local-6989586621682479666"><span class="hs-identifier hs-var">inp</span></a></span><span>
</span><span id="line-5362"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-5363"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemersTranslationError"><span class="hs-identifier hs-type">ErrAssignRedeemersTranslationError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier hs-type">TimeTranslationPastHorizon</span></a></span><span> </span><span id="local-6989586621682479664"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479664"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5364"></span><span>            </span><span class="hs-comment">-- We differentiate this from @TranslationError@ for partial API</span><span>
</span><span id="line-5365"></span><span>            </span><span class="hs-comment">-- backwards compatibility.</span><span>
</span><span id="line-5366"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#PastHorizon"><span class="hs-identifier hs-var">PastHorizon</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5367"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction's validity interval is past the horizon&quot;</span></span><span>
</span><span id="line-5368"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;of safe slot-to-time conversions.&quot;</span></span><span>
</span><span id="line-5369"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;This may happen when I know about a future era&quot;</span></span><span>
</span><span id="line-5370"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;which has not yet been confirmed on-chain. Try setting the&quot;</span></span><span>
</span><span id="line-5371"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;bounds of the validity interval to be earlier.\n\n&quot;</span></span><span>
</span><span id="line-5372"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Here are the full details: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479664"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-5373"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5374"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Transaction.html#ErrAssignRedeemersTranslationError"><span class="hs-identifier hs-type">ErrAssignRedeemersTranslationError</span></a></span><span> </span><span id="local-6989586621682479663"><span class="annot"><span class="annottext">TranslationError StandardCrypto
</span><a href="#local-6989586621682479663"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5375"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#TranslationError"><span class="hs-identifier hs-var">TranslationError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.unwords</span></a></span><span>
</span><span id="line-5376"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The transaction I was given contains bits that cannot be&quot;</span></span><span>
</span><span id="line-5377"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;translated in the current era. The following is wrong:\n\n&quot;</span></span><span>
</span><span id="line-5378"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TranslationError StandardCrypto -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Cardano.Wallet.Api.Server.html#showT"><span class="hs-identifier hs-var">showT</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError StandardCrypto
</span><a href="#local-6989586621682479663"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-5379"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5380"></span><span>
</span><span id="line-5381"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#IsServerError"><span class="hs-identifier hs-type">IsServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5382"></span><span>    </span><span id="local-6989586621682479660"><span class="annot"><span class="annottext">toServerError :: (Request, ServerError) -&gt; ServerError
</span><a href="#local-6989586621682479660"><span class="hs-identifier hs-var hs-var hs-var hs-var">toServerError</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682479659"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479659"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479658"><span class="annot"><span class="annottext">err :: ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span> </span><span id="local-6989586621682479656"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479656"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682479655"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479655"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-5383"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="#local-6989586621682479654"><span class="hs-identifier hs-var">isJSON</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479655"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479656"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-5384"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Failed reading&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
</span><a href="../../../../bytestring/html/src"><span class="hs-operator hs-var">`BS.isInfixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BL.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479655"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5385"></span><span>            </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5386"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't understand the content of your message. If your &quot;</span></span><span>
</span><span id="line-5387"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;message is intended to be in JSON format, please check that &quot;</span></span><span>
</span><span id="line-5388"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the JSON is valid.&quot;</span></span><span>
</span><span id="line-5389"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5390"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="#local-6989586621682479651"><span class="hs-identifier hs-var">utf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479655"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5391"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5392"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I couldn't find the requested endpoint. If the endpoint &quot;</span></span><span>
</span><span id="line-5393"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;contains path parameters, please ensure they are well-formed, &quot;</span></span><span>
</span><span id="line-5394"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;otherwise I won't be able to route them correctly.&quot;</span></span><span>
</span><span id="line-5395"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5396"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">405</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#MethodNotAllowed"><span class="hs-identifier hs-var">MethodNotAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5397"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;You've reached a known endpoint but I don't know how to handle &quot;</span></span><span>
</span><span id="line-5398"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;the HTTP method specified. Please double-check both the &quot;</span></span><span>
</span><span id="line-5399"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;endpoint and the method: one of them is likely to be incorrect &quot;</span></span><span>
</span><span id="line-5400"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(for example: POST instead of PUT, or GET instead of POST...).&quot;</span></span><span>
</span><span id="line-5401"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5402"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">406</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5403"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479648"><span class="annot"><span class="annottext">cType :: Text
</span><a href="#local-6989586621682479648"><span class="hs-identifier hs-var hs-var">cType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5404"></span><span>                    </span><span class="hs-comment">-- FIXME: Ugly and not really scalable nor maintainable.</span><span>
</span><span id="line-5405"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;wallets&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`isPrefixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">pathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479659"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-5406"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;signatures&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`isInfixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">pathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479659"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-5407"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;application/octet-stream&quot;</span></span><span>
</span><span id="line-5408"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;application/json&quot;</span></span><span>
</span><span id="line-5409"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotAcceptable"><span class="hs-identifier hs-var">NotAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5410"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It seems as though you don't accept '&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479648"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;', but &quot;</span></span><span>
</span><span id="line-5411"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unfortunately I only speak '&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479648"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'! Please &quot;</span></span><span>
</span><span id="line-5412"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;double-check your 'Accept' request header and make sure it's &quot;</span></span><span>
</span><span id="line-5413"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;set to '&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479648"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'.&quot;</span></span><span>
</span><span id="line-5414"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5415"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">415</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-5416"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479646"><span class="annot"><span class="annottext">cType :: Text
</span><a href="#local-6989586621682479646"><span class="hs-identifier hs-var hs-var">cType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5417"></span><span>                    </span><span class="hs-comment">-- FIXME: Ugly and not really scalable nor maintainable.</span><span>
</span><span id="line-5418"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;proxy&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transactions&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`isSubsequenceOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">pathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479659"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-5419"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;application/octet-stream&quot;</span></span><span>
</span><span id="line-5420"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;application/json&quot;</span></span><span>
</span><span id="line-5421"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#UnsupportedMediaType"><span class="hs-identifier hs-var">UnsupportedMediaType</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5422"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I'm really sorry but I only understand '&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479646"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'. I need you &quot;</span></span><span>
</span><span id="line-5423"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;to tell me what language you're speaking in order for me to &quot;</span></span><span>
</span><span id="line-5424"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;understand your message. Please double-check your 'Content-Type' &quot;</span></span><span>
</span><span id="line-5425"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request header and make sure it's set to '&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479646"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'.&quot;</span></span><span>
</span><span id="line-5426"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5427"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">501</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-5428"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I'm really sorry but this endpoint is not implemented yet.&quot;</span></span><span>
</span><span id="line-5429"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ApiErrorCode -&gt; Text -&gt; ServerError
</span><a href="Cardano.Wallet.Api.Server.html#apiError"><span class="hs-identifier hs-var">apiError</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ApiErrorCode
</span><a href="Cardano.Wallet.Api.Types.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ServerError) -&gt; Text -&gt; ServerError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-5430"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;It looks like something unexpected went wrong. Unfortunately I &quot;</span></span><span>
</span><span id="line-5431"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;don't yet know how to handle this type of situation. Here's &quot;</span></span><span>
</span><span id="line-5432"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;some information about what happened: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="#local-6989586621682479651"><span class="hs-identifier hs-var">utf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479655"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-5433"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-5434"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621682479658"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-5435"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-5436"></span><span>        </span><span id="local-6989586621682479651"><span class="annot"><span class="annottext">utf8 :: ByteString -&gt; Text
</span><a href="#local-6989586621682479651"><span class="hs-identifier hs-var hs-var">utf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.replace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BL.toStrict</span></a></span><span>
</span><span id="line-5437"></span><span>        </span><span id="local-6989586621682479654"><span class="annot"><span class="annottext">isJSON :: ByteString -&gt; Bool
</span><a href="#local-6989586621682479654"><span class="hs-identifier hs-var hs-var">isJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Value -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; Bool)
-&gt; (ByteString -&gt; Maybe Value) -&gt; ByteString -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FromJSON Value =&gt; ByteString -&gt; Maybe Value
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.decode</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">Aeson.Value</span></a></span><span>
</span><span id="line-5438"></span><span>
</span><span id="line-5439"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                               Logging
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-5442"></span><span>
</span><span id="line-5443"></span><span class="hs-comment">-- | The type of log messages coming from the server 'ApiLayer', which may or</span><span>
</span><span id="line-5444"></span><span class="hs-comment">-- may not be associated with a particular worker thread.</span><span>
</span><span id="line-5445"></span><span class="hs-keyword">data</span><span> </span><span id="WalletEngineLog"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#WalletEngineLog"><span class="hs-identifier hs-var">WalletEngineLog</span></a></span></span><span>
</span><span id="line-5446"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="MsgWalletWorker"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgWalletWorker"><span class="hs-identifier hs-var">MsgWalletWorker</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Registry.html#WorkerLog"><span class="hs-identifier hs-type">WorkerLog</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#WalletWorkerLog"><span class="hs-identifier hs-type">W.WalletWorkerLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5447"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MsgSubmitSealedTx"><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgSubmitSealedTx"><span class="hs-identifier hs-var">MsgSubmitSealedTx</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.html#TxSubmitLog"><span class="hs-identifier hs-type">TxSubmitLog</span></a></span><span>
</span><span id="line-5448"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682479637"><span id="local-6989586621682479639"><span id="local-6989586621682479641"><span class="annot"><span class="annottext">Int -&gt; WalletEngineLog -&gt; ShowS
[WalletEngineLog] -&gt; ShowS
WalletEngineLog -&gt; String
(Int -&gt; WalletEngineLog -&gt; ShowS)
-&gt; (WalletEngineLog -&gt; String)
-&gt; ([WalletEngineLog] -&gt; ShowS)
-&gt; Show WalletEngineLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WalletEngineLog] -&gt; ShowS
$cshowList :: [WalletEngineLog] -&gt; ShowS
show :: WalletEngineLog -&gt; String
$cshow :: WalletEngineLog -&gt; String
showsPrec :: Int -&gt; WalletEngineLog -&gt; ShowS
$cshowsPrec :: Int -&gt; WalletEngineLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479633"><span id="local-6989586621682479635"><span class="annot"><span class="annottext">WalletEngineLog -&gt; WalletEngineLog -&gt; Bool
(WalletEngineLog -&gt; WalletEngineLog -&gt; Bool)
-&gt; (WalletEngineLog -&gt; WalletEngineLog -&gt; Bool)
-&gt; Eq WalletEngineLog
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: WalletEngineLog -&gt; WalletEngineLog -&gt; Bool
$c/= :: WalletEngineLog -&gt; WalletEngineLog -&gt; Bool
== :: WalletEngineLog -&gt; WalletEngineLog -&gt; Bool
$c== :: WalletEngineLog -&gt; WalletEngineLog -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-5449"></span><span>
</span><span id="line-5450"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#WalletEngineLog"><span class="hs-identifier hs-type">WalletEngineLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5451"></span><span>    </span><span id="local-6989586621682479630"><span class="annot"><span class="annottext">toText :: WalletEngineLog -&gt; Text
</span><a href="#local-6989586621682479630"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5452"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgWalletWorker"><span class="hs-identifier hs-type">MsgWalletWorker</span></a></span><span> </span><span id="local-6989586621682479629"><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog
</span><a href="#local-6989586621682479629"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog
</span><a href="#local-6989586621682479629"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-5453"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgSubmitSealedTx"><span class="hs-identifier hs-type">MsgSubmitSealedTx</span></a></span><span> </span><span id="local-6989586621682479628"><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682479628"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682479628"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-5454"></span><span>
</span><span id="line-5455"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#WalletEngineLog"><span class="hs-identifier hs-type">WalletEngineLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5456"></span><span>    </span><span id="local-6989586621682479625"><span class="annot"><span class="annottext">getPrivacyAnnotation :: WalletEngineLog -&gt; PrivacyAnnotation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivacyAnnotation</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5457"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgWalletWorker"><span class="hs-identifier hs-type">MsgWalletWorker</span></a></span><span> </span><span id="local-6989586621682479623"><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog
</span><a href="#local-6989586621682479623"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog -&gt; PrivacyAnnotation
forall a. HasPrivacyAnnotation a =&gt; a -&gt; PrivacyAnnotation
</span><span class="hs-identifier hs-var">getPrivacyAnnotation</span></span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog
</span><a href="#local-6989586621682479623"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-5458"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgSubmitSealedTx"><span class="hs-identifier hs-type">MsgSubmitSealedTx</span></a></span><span> </span><span id="local-6989586621682479622"><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682479622"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; PrivacyAnnotation
forall a. HasPrivacyAnnotation a =&gt; a -&gt; PrivacyAnnotation
</span><span class="hs-identifier hs-var">getPrivacyAnnotation</span></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682479622"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-5459"></span><span>
</span><span id="line-5460"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#WalletEngineLog"><span class="hs-identifier hs-type">WalletEngineLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5461"></span><span>    </span><span id="local-6989586621682479619"><span class="annot"><span class="annottext">getSeverityAnnotation :: WalletEngineLog -&gt; Severity
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-5462"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgWalletWorker"><span class="hs-identifier hs-type">MsgWalletWorker</span></a></span><span> </span><span id="local-6989586621682479617"><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog
</span><a href="#local-6989586621682479617"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">WorkerLog WalletId WalletWorkerLog
</span><a href="#local-6989586621682479617"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-5463"></span><span>        </span><span class="annot"><a href="Cardano.Wallet.Api.Server.html#MsgSubmitSealedTx"><span class="hs-identifier hs-type">MsgSubmitSealedTx</span></a></span><span> </span><span id="local-6989586621682479616"><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682479616"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSubmitLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">TxSubmitLog
</span><a href="#local-6989586621682479616"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-5464"></span></pre></body></html>