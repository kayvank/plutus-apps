<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- The following is justified by the usage of the 'requestBody' field</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- accessor on the 'Request' object from the Network.Wai.Internal module.</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- The deprecation is about not using the function to get the requestBody from</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- a request since it only returns chunks, but we do use it</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-deprecations #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Wai.Middleware.Logging</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Middleware</span></span><span>
</span><span id="line-15"></span><span>      </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#withApiLogger"><span class="hs-identifier">withApiLogger</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Settings</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#newApiLoggerSettings"><span class="hs-identifier">newApiLoggerSettings</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier">ApiLoggerSettings</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#obfuscateKeys"><span class="hs-identifier">obfuscateKeys</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier">HandlerLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier">ApiLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#RequestId"><span class="hs-identifier">RequestId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Data.LogItem</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">PrivacyAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Data.Severity</span></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Severity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Data.Tracer</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">HasPrivacyAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HasSeverityAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Tracing</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ToObject</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Arrow</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">second</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">Control.Tracer</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">Tracer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">contramap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier">traceWith</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">FromJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Builder</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Builder</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">IORef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">atomicModifyIORef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">modifyIORef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">newIORef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">readIORef</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">Data.Text.Class</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">ToText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">NominalDiffTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">diffUTCTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier">getCurrentTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">Network.HTTP.Types.Status</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">Status</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Network.Wai</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Middleware</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Request</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">rawPathInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">rawQueryString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">requestMethod</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Network.Wai.Internal</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">getRequestBodyChunk</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.MVar</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">modifyMVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">newMVar</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson.Key</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson.KeyMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Builder</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../unordered-containers/html/src"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Installs a request &amp; response logger on a Wai application.</span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- The logger logs requests' and responses' bodies along with a few other</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- useful piece of information.</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#withApiLogger"><span class="hs-identifier hs-type">withApiLogger</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-type">ApiLoggerSettings</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Middleware</span></a></span><span>
</span><span id="line-85"></span><span id="withApiLogger"><span class="annot"><span class="annottext">withApiLogger :: Tracer IO ApiLog -&gt; ApiLoggerSettings -&gt; Middleware
</span><a href="Network.Wai.Middleware.Logging.html#withApiLogger"><span class="hs-identifier hs-var hs-var">withApiLogger</span></a></span></span><span> </span><span id="local-6989586621682479393"><span class="annot"><span class="annottext">Tracer IO ApiLog
</span><a href="#local-6989586621682479393"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span id="local-6989586621682479392"><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479392"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span id="local-6989586621682479391"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621682479391"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621682479390"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479390"><span class="hs-identifier hs-var">req0</span></a></span></span><span> </span><span id="local-6989586621682479389"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621682479389"><span class="hs-identifier hs-var">sendResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621682479388"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621682479388"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ApiLoggerSettings -&gt; IO RequestId
</span><a href="Network.Wai.Middleware.Logging.html#nextRequestId"><span class="hs-identifier hs-var">nextRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479392"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479386"><span class="annot"><span class="annottext">t :: Tracer IO HandlerLog
</span><a href="#local-6989586621682479386"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HandlerLog -&gt; ApiLog) -&gt; Tracer IO ApiLog -&gt; Tracer IO HandlerLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestId -&gt; HandlerLog -&gt; ApiLog
</span><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-var">ApiLog</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621682479388"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer IO ApiLog
</span><a href="#local-6989586621682479393"><span class="hs-identifier hs-var">t0</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">Tracer IO HandlerLog -&gt; HandlerLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479386"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestStart"><span class="hs-identifier hs-var">LogRequestStart</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621682479383"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682479383"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../../../../time/html/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682479382"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479382"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479381"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479381"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO (Request, ByteString)
</span><a href="Network.Wai.Middleware.Logging.html#getRequestBody"><span class="hs-identifier hs-var">getRequestBody</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479390"><span class="hs-identifier hs-var">req0</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">Tracer IO HandlerLog -&gt; HandlerLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479386"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequest"><span class="hs-identifier hs-var">LogRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479382"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Tracer IO HandlerLog -&gt; HandlerLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479386"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; ByteString -&gt; HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestBody"><span class="hs-identifier hs-var">LogRequestBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiLoggerSettings -&gt; Request -&gt; [Text]
</span><a href="Network.Wai.Middleware.Logging.html#_obfuscateKeys"><span class="hs-identifier hs-var hs-var">_obfuscateKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479392"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479382"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479381"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621682479391"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479382"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">((Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived)
-&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682479376"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621682479376"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>        </span><span id="local-6989586621682479375"><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
</span><a href="#local-6989586621682479375"><span class="hs-identifier hs-var">builderIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe Status, Builder) -&gt; IO (IORef (Maybe Status, Builder))
forall a. a -&gt; IO (IORef a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Status
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>        </span><span id="local-6989586621682479374"><span class="annot"><span class="annottext">ResponseReceived
</span><a href="#local-6989586621682479374"><span class="hs-identifier hs-var">rcvd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder) -&gt; Response -&gt; IO Response
</span><a href="Network.Wai.Middleware.Logging.html#recordChunks"><span class="hs-identifier hs-var">recordChunks</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
</span><a href="#local-6989586621682479375"><span class="hs-identifier hs-var">builderIO</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621682479376"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">IO Response
-&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621682479389"><span class="hs-identifier hs-var">sendResponse</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span id="local-6989586621682479372"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479372"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; UTCTime -&gt; NominalDiffTime)
-&gt; UTCTime -&gt; UTCTime -&gt; NominalDiffTime
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; NominalDiffTime
</span><a href="../../../../time/html/src"><span class="hs-identifier hs-var">diffUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621682479383"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; NominalDiffTime) -&gt; IO UTCTime -&gt; IO NominalDiffTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../../../../time/html/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder) -&gt; IO (Maybe Status, Builder)
forall a. IORef a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
</span><a href="#local-6989586621682479375"><span class="hs-identifier hs-var">builderIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe Status, Builder)
-&gt; ((Maybe Status, Builder) -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span>
</span><span id="line-98"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479369"><span class="annot"><span class="annottext">fromBuilder :: (d, Builder) -&gt; (d, ByteString)
</span><a href="#local-6989586621682479369"><span class="hs-identifier hs-var hs-var">fromBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; ByteString) -&gt; (d, Builder) -&gt; (d, ByteString)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BL.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (Builder -&gt; ByteString) -&gt; Builder -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">B.toLazyByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Maybe Status -&gt; ByteString -&gt; IO ())
-&gt; (Maybe Status, ByteString) -&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracer IO HandlerLog
-&gt; NominalDiffTime
-&gt; Request
-&gt; Maybe Status
-&gt; ByteString
-&gt; IO ()
</span><a href="#local-6989586621682479364"><span class="hs-identifier hs-var">logResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479386"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479372"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479382"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Maybe Status, ByteString) -&gt; IO ())
-&gt; ((Maybe Status, Builder) -&gt; (Maybe Status, ByteString))
-&gt; (Maybe Status, Builder)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Status, Builder) -&gt; (Maybe Status, ByteString)
forall d. (d, Builder) -&gt; (d, ByteString)
</span><a href="#local-6989586621682479369"><span class="hs-identifier hs-var">fromBuilder</span></a></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">Tracer IO HandlerLog -&gt; HandlerLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479386"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestFinish"><span class="hs-identifier hs-var">LogRequestFinish</span></a></span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">ResponseReceived -&gt; IO ResponseReceived
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseReceived
</span><a href="#local-6989586621682479374"><span class="hs-identifier hs-var">rcvd</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><a href="#local-6989586621682479364"><span class="hs-identifier hs-type">logResponse</span></a></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-type">HandlerLog</span></a></span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span>
</span><span id="line-106"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier hs-type">Status</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621682479364"><span class="annot"><span class="annottext">logResponse :: Tracer IO HandlerLog
-&gt; NominalDiffTime
-&gt; Request
-&gt; Maybe Status
-&gt; ByteString
-&gt; IO ()
</span><a href="#local-6989586621682479364"><span class="hs-identifier hs-var hs-var">logResponse</span></a></span></span><span> </span><span id="local-6989586621682479362"><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479362"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682479361"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479361"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span id="local-6989586621682479360"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479360"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621682479359"><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479359"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span id="local-6989586621682479358"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479358"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">Tracer IO HandlerLog -&gt; HandlerLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479362"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Request -&gt; Maybe Status -&gt; HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogResponse"><span class="hs-identifier hs-var">LogResponse</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479361"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479360"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479359"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">Tracer IO HandlerLog -&gt; HandlerLog -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="../../../../contra-tracer/html/src"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO HandlerLog
</span><a href="#local-6989586621682479362"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogResponseBody"><span class="hs-identifier hs-var">LogResponseBody</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479358"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | API logger settings</span><span>
</span><span id="line-115"></span><span class="hs-keyword">data</span><span> </span><span id="ApiLoggerSettings"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-var">ApiLoggerSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ApiLoggerSettings"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-var">ApiLoggerSettings</span></a></span></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_obfuscateKeys"><span class="annot"><span class="annottext">ApiLoggerSettings -&gt; Request -&gt; [Text]
</span><a href="Network.Wai.Middleware.Logging.html#_obfuscateKeys"><span class="hs-identifier hs-var hs-var">_obfuscateKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-comment">-- ^ For a given 'Request', obfuscate the values associated with the</span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-comment">-- given keys from a JSON object payload.</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_requestCounter"><span class="annot"><span class="annottext">ApiLoggerSettings -&gt; MVar Integer
</span><a href="Network.Wai.Middleware.Logging.html#_requestCounter"><span class="hs-identifier hs-var hs-var">_requestCounter</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-comment">-- ^ A function to get a unique identifier from a 'Request'</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | Just a wrapper for readability</span><span>
</span><span id="line-125"></span><span id="local-6989586621682479352"><span id="local-6989586621682479353"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="RequestId"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#RequestId"><span class="hs-identifier hs-var">RequestId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RequestId"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#RequestId"><span class="hs-identifier hs-var">RequestId</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. RequestId -&gt; Rep RequestId x)
-&gt; (forall x. Rep RequestId x -&gt; RequestId) -&gt; Generic RequestId
forall x. Rep RequestId x -&gt; RequestId
forall x. RequestId -&gt; Rep RequestId x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep RequestId x -&gt; RequestId
$cfrom :: forall x. RequestId -&gt; Rep RequestId x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479342"><span id="local-6989586621682479344"><span id="local-6989586621682479346"><span class="annot"><span class="annottext">Int -&gt; RequestId -&gt; ShowS
[RequestId] -&gt; ShowS
RequestId -&gt; String
(Int -&gt; RequestId -&gt; ShowS)
-&gt; (RequestId -&gt; String)
-&gt; ([RequestId] -&gt; ShowS)
-&gt; Show RequestId
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RequestId] -&gt; ShowS
$cshowList :: [RequestId] -&gt; ShowS
show :: RequestId -&gt; String
$cshow :: RequestId -&gt; String
showsPrec :: Int -&gt; RequestId -&gt; ShowS
$cshowsPrec :: Int -&gt; RequestId -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479337"><span id="local-6989586621682479339"><span class="annot"><span class="annottext">RequestId -&gt; RequestId -&gt; Bool
(RequestId -&gt; RequestId -&gt; Bool)
-&gt; (RequestId -&gt; RequestId -&gt; Bool) -&gt; Eq RequestId
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: RequestId -&gt; RequestId -&gt; Bool
$c/= :: RequestId -&gt; RequestId -&gt; Bool
== :: RequestId -&gt; RequestId -&gt; Bool
$c== :: RequestId -&gt; RequestId -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479328"><span id="local-6989586621682479330"><span id="local-6989586621682479332"><span id="local-6989586621682479334"><span class="annot"><span class="annottext">[RequestId] -&gt; Encoding
[RequestId] -&gt; Value
RequestId -&gt; Encoding
RequestId -&gt; Value
(RequestId -&gt; Value)
-&gt; (RequestId -&gt; Encoding)
-&gt; ([RequestId] -&gt; Value)
-&gt; ([RequestId] -&gt; Encoding)
-&gt; ToJSON RequestId
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [RequestId] -&gt; Encoding
$ctoEncodingList :: [RequestId] -&gt; Encoding
toJSONList :: [RequestId] -&gt; Value
$ctoJSONList :: [RequestId] -&gt; Value
toEncoding :: RequestId -&gt; Encoding
$ctoEncoding :: RequestId -&gt; Encoding
toJSON :: RequestId -&gt; Value
$ctoJSON :: RequestId -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Create a new opaque 'ApiLoggerSettings'</span><span>
</span><span id="line-129"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#newApiLoggerSettings"><span class="hs-identifier hs-type">newApiLoggerSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-type">ApiLoggerSettings</span></a></span><span>
</span><span id="line-130"></span><span id="newApiLoggerSettings"><span class="annot"><span class="annottext">newApiLoggerSettings :: IO ApiLoggerSettings
</span><a href="Network.Wai.Middleware.Logging.html#newApiLoggerSettings"><span class="hs-identifier hs-var hs-var">newApiLoggerSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621682479326"><span class="annot"><span class="annottext">MVar Integer
</span><a href="#local-6989586621682479326"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; IO (MVar Integer)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (MVar a)
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">newMVar</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">ApiLoggerSettings -&gt; IO ApiLoggerSettings
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLoggerSettings :: (Request -&gt; [Text]) -&gt; MVar Integer -&gt; ApiLoggerSettings
</span><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-type">ApiLoggerSettings</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_obfuscateKeys :: Request -&gt; [Text]
</span><a href="Network.Wai.Middleware.Logging.html#_obfuscateKeys"><span class="hs-identifier hs-var">_obfuscateKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Request -&gt; [Text]
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_requestCounter :: MVar Integer
</span><a href="Network.Wai.Middleware.Logging.html#_requestCounter"><span class="hs-identifier hs-var">_requestCounter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar Integer
</span><a href="#local-6989586621682479326"><span class="hs-identifier hs-var">counter</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Define a set of top-level object keys that should be obfuscated for a given</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- request in a JSON format.</span><span>
</span><span id="line-139"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#obfuscateKeys"><span class="hs-identifier hs-type">obfuscateKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-type">ApiLoggerSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-type">ApiLoggerSettings</span></a></span><span>
</span><span id="line-140"></span><span id="obfuscateKeys"><span class="annot"><span class="annottext">obfuscateKeys :: (Request -&gt; [Text]) -&gt; ApiLoggerSettings -&gt; ApiLoggerSettings
</span><a href="Network.Wai.Middleware.Logging.html#obfuscateKeys"><span class="hs-identifier hs-var hs-var">obfuscateKeys</span></a></span></span><span> </span><span id="local-6989586621682479324"><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><a href="#local-6989586621682479324"><span class="hs-identifier hs-var">getKeys</span></a></span></span><span> </span><span id="local-6989586621682479323"><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479323"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479323"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_obfuscateKeys :: Request -&gt; [Text]
</span><a href="Network.Wai.Middleware.Logging.html#_obfuscateKeys"><span class="hs-identifier hs-var">_obfuscateKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><a href="#local-6989586621682479324"><span class="hs-identifier hs-var">getKeys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Get the next request id, incrementing the request counter.</span><span>
</span><span id="line-144"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#nextRequestId"><span class="hs-identifier hs-type">nextRequestId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLoggerSettings"><span class="hs-identifier hs-type">ApiLoggerSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#RequestId"><span class="hs-identifier hs-type">RequestId</span></a></span><span>
</span><span id="line-145"></span><span id="nextRequestId"><span class="annot"><span class="annottext">nextRequestId :: ApiLoggerSettings -&gt; IO RequestId
</span><a href="Network.Wai.Middleware.Logging.html#nextRequestId"><span class="hs-identifier hs-var hs-var">nextRequestId</span></a></span></span><span> </span><span id="local-6989586621682479322"><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479322"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">MVar Integer
-&gt; (Integer -&gt; IO (Integer, RequestId)) -&gt; IO RequestId
forall (m :: * -&gt; *) a b.
MonadUnliftIO m =&gt;
MVar a -&gt; (a -&gt; m (a, b)) -&gt; m b
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">modifyMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiLoggerSettings -&gt; MVar Integer
</span><a href="Network.Wai.Middleware.Logging.html#_requestCounter"><span class="hs-identifier hs-var hs-var">_requestCounter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiLoggerSettings
</span><a href="#local-6989586621682479322"><span class="hs-identifier hs-var">settings</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682479321"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682479321"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Integer, RequestId) -&gt; IO (Integer, RequestId)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682479321"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; RequestId
</span><a href="Network.Wai.Middleware.Logging.html#RequestId"><span class="hs-identifier hs-var">RequestId</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682479321"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Internals

  We can't actually read the content of a request twice, which has several
  issues.

  First of all, the 'setLogger' method from the 'warp' package isn't really
  helpful as we get a `Request` object in argument, but can't extract its body
  since it has already been consumed by the time it reaches our logger. As a
  consequence, we can merely do logging on superficial request information
  (e.g. headers, status, path etc.).

  See: https://hackage.haskell.org/package/warp-3.2.27/docs/Network-Wai-Handler-Warp.html#v:setLogger

  Then, there exists packages like `wai-extra` with ways to construct detailed
  loggers from a 'Request' object and its body parsed via some ad-hoc helpers
  (see below). However, this package requires a few undesirable dependencies
  (like data-default, or wai-logger) but more importantly, it doesn't make it
  possible to use a custom trace or logger object but instead, forces log outputs
  and behaviors to what's supported by the package.

  See: http://hackage.haskell.org/package/wai-extra-3.0.26/docs/Network-Wai-Middleware-RequestLogger.html

  So, in order to implement our own Request/Response logging middleware, I've
  extracted some relevant bits from the `wai-extra` package in order to:

  - Read the request body, and put it back. There's a small performance cost in
    doing so of course, but that's rather fine for the wallet API which isn't
    meant to serve concurrent client and be under heavy load.

  - Extract the body from a response and make it available in an IORef.

  Source code from the original functions below can be found in 'wai-extra'

  See: http://hackage.haskell.org/package/wai-extra-3.0.26/docs/src/Network.Wai.Middleware.RequestLogger.html

  (Note that functions have been slightly adjust for code-style and, to return
  an extra response status when available instead of only the request body).

-------------------------------------------------------------------------------}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#getRequestBody"><span class="hs-identifier hs-type">getRequestBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span id="getRequestBody"><span class="annot"><span class="annottext">getRequestBody :: Request -&gt; IO (Request, ByteString)
</span><a href="Network.Wai.Middleware.Logging.html#getRequestBody"><span class="hs-identifier hs-var hs-var">getRequestBody</span></a></span></span><span> </span><span id="local-6989586621682479319"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479319"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621682479318"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682479318"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString]) -&gt; IO [ByteString]
forall c. ([ByteString] -&gt; c) -&gt; IO c
</span><a href="#local-6989586621682479317"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString]
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621682479315"><span class="annot"><span class="annottext">IORef [ByteString]
</span><a href="#local-6989586621682479315"><span class="hs-identifier hs-var">ichunks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; IO (IORef [ByteString])
forall a. a -&gt; IO (IORef a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682479318"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479314"><span class="annot"><span class="annottext">rbody :: IO ByteString
</span><a href="#local-6989586621682479314"><span class="hs-identifier hs-var hs-var">rbody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [ByteString]
-&gt; ([ByteString] -&gt; ([ByteString], ByteString)) -&gt; IO ByteString
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomicModifyIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [ByteString]
</span><a href="#local-6989586621682479315"><span class="hs-identifier hs-var">ichunks</span></a></span><span> </span><span class="annot"><span class="annottext">(([ByteString] -&gt; ([ByteString], ByteString)) -&gt; IO ByteString)
-&gt; ([ByteString] -&gt; ([ByteString], ByteString)) -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-194"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>           </span><span id="local-6989586621682479313"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479313"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621682479312"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682479312"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682479312"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">(Request, ByteString) -&gt; IO (Request, ByteString)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479319"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">requestBody :: IO ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var">requestBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621682479314"><span class="hs-identifier hs-var">rbody</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682479318"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621682479317"><span class="annot"><span class="annottext">loop :: ([ByteString] -&gt; c) -&gt; IO c
</span><a href="#local-6989586621682479317"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621682479310"><span class="annot"><span class="annottext">[ByteString] -&gt; c
</span><a href="#local-6989586621682479310"><span class="hs-identifier hs-var">front</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>        </span><span id="local-6989586621682479309"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479309"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var">getRequestBodyChunk</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479319"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.null</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479309"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-201"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">c -&gt; IO c
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(c -&gt; IO c) -&gt; c -&gt; IO c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; c
</span><a href="#local-6989586621682479310"><span class="hs-identifier hs-var">front</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; c) -&gt; IO c
</span><a href="#local-6989586621682479317"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(([ByteString] -&gt; c) -&gt; IO c) -&gt; ([ByteString] -&gt; c) -&gt; IO c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; c
</span><a href="#local-6989586621682479310"><span class="hs-identifier hs-var">front</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; c)
-&gt; ([ByteString] -&gt; [ByteString]) -&gt; [ByteString] -&gt; c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479309"><span class="hs-identifier hs-var">bs</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#recordChunks"><span class="hs-identifier hs-type">recordChunks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier hs-type">Status</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">Builder</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-205"></span><span id="recordChunks"><span class="annot"><span class="annottext">recordChunks :: IORef (Maybe Status, Builder) -&gt; Response -&gt; IO Response
</span><a href="Network.Wai.Middleware.Logging.html#recordChunks"><span class="hs-identifier hs-var hs-var">recordChunks</span></a></span></span><span> </span><span id="local-6989586621682479307"><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
</span><a href="#local-6989586621682479307"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">ResponseStream</span></a></span><span> </span><span id="local-6989586621682479305"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621682479305"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682479304"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621682479304"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682479303"><span class="annot"><span class="annottext">StreamingBody
</span><a href="#local-6989586621682479303"><span class="hs-identifier hs-var">sb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO Response
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; IO Response)
-&gt; (StreamingBody -&gt; Response) -&gt; StreamingBody -&gt; IO Response
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; StreamingBody -&gt; Response
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var">ResponseStream</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621682479305"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621682479304"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">(StreamingBody -&gt; IO Response) -&gt; StreamingBody -&gt; IO Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479302"><span class="annot"><span class="annottext">capture :: b -&gt; (Maybe Status, b) -&gt; (Maybe Status, b)
</span><a href="#local-6989586621682479302"><span class="hs-identifier hs-var hs-var">capture</span></a></span></span><span> </span><span id="local-6989586621682479301"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682479301"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682479300"><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479300"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479299"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682479299"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479300"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Status -&gt; Maybe Status -&gt; Maybe Status
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Status -&gt; Maybe Status
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621682479305"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682479299"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682479301"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682479298"><span class="annot"><span class="annottext">Builder -&gt; IO ()
</span><a href="#local-6989586621682479298"><span class="hs-identifier hs-var">send</span></a></span></span><span> </span><span id="local-6989586621682479297"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682479297"><span class="hs-identifier hs-var">flush</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StreamingBody
</span><a href="#local-6989586621682479303"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682479296"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479296"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
-&gt; ((Maybe Status, Builder) -&gt; (Maybe Status, Builder)) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">modifyIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
</span><a href="#local-6989586621682479307"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; (Maybe Status, Builder) -&gt; (Maybe Status, Builder)
forall b.
Semigroup b =&gt;
b -&gt; (Maybe Status, b) -&gt; (Maybe Status, b)
</span><a href="#local-6989586621682479302"><span class="hs-identifier hs-var">capture</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479296"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; IO ()
</span><a href="#local-6989586621682479298"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479296"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682479297"><span class="hs-identifier hs-var">flush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">ResponseBuilder</span></a></span><span> </span><span id="local-6989586621682479294"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621682479294"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682479293"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621682479293"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682479292"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479292"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682479291"><span class="annot"><span class="annottext">capture :: (Maybe Status, Builder) -&gt; (Maybe Status, Builder)
</span><a href="#local-6989586621682479291"><span class="hs-identifier hs-var hs-var">capture</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682479290"><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479290"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479289"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479289"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479290"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Status -&gt; Maybe Status -&gt; Maybe Status
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Status -&gt; Maybe Status
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621682479294"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479289"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479292"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
-&gt; ((Maybe Status, Builder) -&gt; (Maybe Status, Builder)) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">modifyIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Status, Builder)
</span><a href="#local-6989586621682479307"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Status, Builder) -&gt; (Maybe Status, Builder)
</span><a href="#local-6989586621682479291"><span class="hs-identifier hs-var">capture</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Response -&gt; IO Response
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO Response
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; Builder -&gt; Response
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var">ResponseBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621682479294"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621682479293"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621682479292"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621682479288"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621682479288"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="annottext">Response -&gt; IO Response
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621682479288"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                    Logging
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | API handler trace events are associated with a unique request ID.</span><span>
</span><span id="line-220"></span><span id="local-6989586621682479286"><span id="local-6989586621682479287"></span></span><span class="hs-keyword">data</span><span> </span><span id="ApiLog"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-var">ApiLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ApiLog"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-var">ApiLog</span></a></span></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="requestId"><span class="annot"><span class="annottext">ApiLog -&gt; RequestId
</span><a href="Network.Wai.Middleware.Logging.html#requestId"><span class="hs-identifier hs-var hs-var">requestId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#RequestId"><span class="hs-identifier hs-type">RequestId</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-comment">-- ^ Unique integer associated with the request, for the purpose of tracing.</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="logMsg"><span class="annot"><span class="annottext">ApiLog -&gt; HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#logMsg"><span class="hs-identifier hs-var hs-var">logMsg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-type">HandlerLog</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">-- ^ Event trace for the handler.</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. ApiLog -&gt; Rep ApiLog x)
-&gt; (forall x. Rep ApiLog x -&gt; ApiLog) -&gt; Generic ApiLog
forall x. Rep ApiLog x -&gt; ApiLog
forall x. ApiLog -&gt; Rep ApiLog x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ApiLog x -&gt; ApiLog
$cfrom :: forall x. ApiLog -&gt; Rep ApiLog x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479276"><span id="local-6989586621682479278"><span id="local-6989586621682479280"><span class="annot"><span class="annottext">Int -&gt; ApiLog -&gt; ShowS
[ApiLog] -&gt; ShowS
ApiLog -&gt; String
(Int -&gt; ApiLog -&gt; ShowS)
-&gt; (ApiLog -&gt; String) -&gt; ([ApiLog] -&gt; ShowS) -&gt; Show ApiLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ApiLog] -&gt; ShowS
$cshowList :: [ApiLog] -&gt; ShowS
show :: ApiLog -&gt; String
$cshow :: ApiLog -&gt; String
showsPrec :: Int -&gt; ApiLog -&gt; ShowS
$cshowsPrec :: Int -&gt; ApiLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479268"><span id="local-6989586621682479270"><span id="local-6989586621682479272"><span id="local-6989586621682479274"><span class="annot"><span class="annottext">[ApiLog] -&gt; Encoding
[ApiLog] -&gt; Value
ApiLog -&gt; Encoding
ApiLog -&gt; Value
(ApiLog -&gt; Value)
-&gt; (ApiLog -&gt; Encoding)
-&gt; ([ApiLog] -&gt; Value)
-&gt; ([ApiLog] -&gt; Encoding)
-&gt; ToJSON ApiLog
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ApiLog] -&gt; Encoding
$ctoEncodingList :: [ApiLog] -&gt; Encoding
toJSONList :: [ApiLog] -&gt; Value
$ctoJSONList :: [ApiLog] -&gt; Value
toEncoding :: ApiLog -&gt; Encoding
$ctoEncoding :: ApiLog -&gt; Encoding
toJSON :: ApiLog -&gt; Value
$ctoJSON :: ApiLog -&gt; Value
</span><a href="#local-6989586621682479268"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621682479265"><span class="annot"><span class="annottext">getPrivacyAnnotation :: ApiLog -&gt; PrivacyAnnotation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivacyAnnotation</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682479263"><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479263"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandlerLog -&gt; PrivacyAnnotation
forall a. HasPrivacyAnnotation a =&gt; a -&gt; PrivacyAnnotation
</span><span class="hs-identifier hs-var">getPrivacyAnnotation</span></span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479263"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621682479260"><span class="annot"><span class="annottext">getSeverityAnnotation :: ApiLog -&gt; Severity
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682479258"><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479258"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandlerLog -&gt; Severity
forall a. HasSeverityAnnotation a =&gt; a -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverityAnnotation</span></span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479258"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621682479255"><span class="annot"><span class="annottext">toText :: ApiLog -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span><span> </span><span id="local-6989586621682479253"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621682479253"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span id="local-6989586621682479252"><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479252"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621682479253"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;] &quot;</span></span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479252"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-comment">-- These instance are required by iohk-monitoring</span><span>
</span><span id="line-239"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682479246"><span id="local-6989586621682479248"><span class="annot"><span class="hs-identifier hs-type">ToObject</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span></span></span><span>
</span><span id="line-240"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682479242"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#ApiLog"><span class="hs-identifier hs-type">ApiLog</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621682479240"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser ApiLog
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser ApiLog
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FromJSON ApiLog stub&quot;</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | Tracer events related to the handling of a single request.</span><span>
</span><span id="line-244"></span><span id="local-6989586621682479237"><span id="local-6989586621682479238"></span></span><span class="hs-keyword">data</span><span> </span><span id="HandlerLog"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-var">HandlerLog</span></a></span></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="LogRequestStart"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestStart"><span class="hs-identifier hs-var">LogRequestStart</span></a></span></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LogRequest"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequest"><span class="hs-identifier hs-var">LogRequest</span></a></span></span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LogRequestBody"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestBody"><span class="hs-identifier hs-var">LogRequestBody</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-comment">-- ^ Request content, with list of sensitive json keys.</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LogResponse"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponse"><span class="hs-identifier hs-var">LogResponse</span></a></span></span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier hs-type">Status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LogResponseBody"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponseBody"><span class="hs-identifier hs-var">LogResponseBody</span></a></span></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LogRequestFinish"><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestFinish"><span class="hs-identifier hs-var">LogRequestFinish</span></a></span></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. HandlerLog -&gt; Rep HandlerLog x)
-&gt; (forall x. Rep HandlerLog x -&gt; HandlerLog) -&gt; Generic HandlerLog
forall x. Rep HandlerLog x -&gt; HandlerLog
forall x. HandlerLog -&gt; Rep HandlerLog x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep HandlerLog x -&gt; HandlerLog
$cfrom :: forall x. HandlerLog -&gt; Rep HandlerLog x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682479229"><span id="local-6989586621682479231"><span id="local-6989586621682479233"><span class="annot"><span class="annottext">Int -&gt; HandlerLog -&gt; ShowS
[HandlerLog] -&gt; ShowS
HandlerLog -&gt; String
(Int -&gt; HandlerLog -&gt; ShowS)
-&gt; (HandlerLog -&gt; String)
-&gt; ([HandlerLog] -&gt; ShowS)
-&gt; Show HandlerLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [HandlerLog] -&gt; ShowS
$cshowList :: [HandlerLog] -&gt; ShowS
show :: HandlerLog -&gt; String
$cshow :: HandlerLog -&gt; String
showsPrec :: Int -&gt; HandlerLog -&gt; ShowS
$cshowsPrec :: Int -&gt; HandlerLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier hs-type">ToText</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-type">HandlerLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621682479227"><span class="annot"><span class="annottext">toText :: HandlerLog -&gt; Text
</span><a href="#local-6989586621682479227"><span class="hs-identifier hs-var hs-var hs-var hs-var">toText</span></a></span></span><span> </span><span id="local-6989586621682479226"><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479226"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479226"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestStart"><span class="hs-identifier hs-var">LogRequestStart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Received API request&quot;</span></span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequest"><span class="hs-identifier hs-type">LogRequest</span></a></span><span> </span><span id="local-6989586621682479225"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479225"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;[&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479224"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;] &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479223"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479222"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>            </span><span id="local-6989586621682479224"><span class="annot"><span class="annottext">method :: Text
</span><a href="#local-6989586621682479224"><span class="hs-identifier hs-var hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">requestMethod</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479225"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-260"></span><span>            </span><span id="local-6989586621682479223"><span class="annot"><span class="annottext">path :: Text
</span><a href="#local-6989586621682479223"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">rawPathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479225"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-261"></span><span>            </span><span id="local-6989586621682479222"><span class="annot"><span class="annottext">query :: Text
</span><a href="#local-6989586621682479222"><span class="hs-identifier hs-var hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">rawQueryString</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479225"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestBody"><span class="hs-identifier hs-type">LogRequestBody</span></a></span><span> </span><span id="local-6989586621682479220"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682479220"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span id="local-6989586621682479219"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479219"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; ByteString -&gt; Text
</span><a href="Network.Wai.Middleware.Logging.html#sanitize"><span class="hs-identifier hs-var">sanitize</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682479220"><span class="hs-identifier hs-var">ks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479219"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponse"><span class="hs-identifier hs-type">LogResponse</span></a></span><span> </span><span id="local-6989586621682479217"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479217"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span id="local-6989586621682479216"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479216"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621682479215"><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479215"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>            </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479214"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479213"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479212"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479211"><span class="hs-identifier hs-var">text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; in &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682479210"><span class="hs-identifier hs-var">tsec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-265"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-266"></span><span>            </span><span id="local-6989586621682479214"><span class="annot"><span class="annottext">method :: Text
</span><a href="#local-6989586621682479214"><span class="hs-identifier hs-var hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">requestMethod</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479216"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-267"></span><span>            </span><span id="local-6989586621682479213"><span class="annot"><span class="annottext">path :: Text
</span><a href="#local-6989586621682479213"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../wai/html/src"><span class="hs-identifier hs-var hs-var">rawPathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621682479216"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-268"></span><span>            </span><span id="local-6989586621682479212"><span class="annot"><span class="annottext">code :: Text
</span><a href="#local-6989586621682479212"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Status -&gt; Text) -&gt; Maybe Status -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;???&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Text) -&gt; (Status -&gt; Int) -&gt; Status -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Status -&gt; Int
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var hs-var">statusCode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479215"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-269"></span><span>            </span><span id="local-6989586621682479211"><span class="annot"><span class="annottext">text :: Text
</span><a href="#local-6989586621682479211"><span class="hs-identifier hs-var hs-var">text</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Status -&gt; Text) -&gt; Maybe Status -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Status Unknown&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; (Status -&gt; ByteString) -&gt; Status -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ByteString
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var hs-var">statusMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479215"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span id="local-6989586621682479210"><span class="annot"><span class="annottext">tsec :: Text
</span><a href="#local-6989586621682479210"><span class="hs-identifier hs-var hs-var">tsec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479217"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponseBody"><span class="hs-identifier hs-type">LogResponseBody</span></a></span><span> </span><span id="local-6989586621682479206"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479206"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479206"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestFinish"><span class="hs-identifier hs-var">LogRequestFinish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Completed response to API request&quot;</span></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682479199"><span id="local-6989586621682479201"><span id="local-6989586621682479203"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-type">HandlerLog</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>    </span><span id="local-6989586621682479198"><span class="annot"><span class="annottext">toJSON :: HandlerLog -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (HandlerLog -&gt; Text) -&gt; HandlerLog -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerLog -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">-- | Removes sensitive details from valid request payloads and completely</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- obfuscate invalid payloads.</span><span>
</span><span id="line-279"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#sanitize"><span class="hs-identifier hs-type">sanitize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-280"></span><span id="sanitize"><span class="annot"><span class="annottext">sanitize :: [Text] -&gt; ByteString -&gt; Text
</span><a href="Network.Wai.Middleware.Logging.html#sanitize"><span class="hs-identifier hs-var hs-var">sanitize</span></a></span></span><span> </span><span id="local-6989586621682479195"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682479195"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621682479194"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479194"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text
</span><a href="#local-6989586621682479193"><span class="hs-identifier hs-var">encode'</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Text) -&gt; Value -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
</span><a href="#local-6989586621682479192"><span class="hs-identifier hs-var">decode'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682479194"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621682479190"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621682479190"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Object</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">(Object -&gt; Value) -&gt; Object -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Key Value -&gt; Object
forall v. HashMap Key v -&gt; KeyMap v
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.fromHashMap</span></a></span><span>
</span><span id="line-284"></span><span>            </span><span class="annot"><span class="annottext">(HashMap Key Value -&gt; Object) -&gt; HashMap Key Value -&gt; Object
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; HashMap Key Value -&gt; HashMap Key Value)
-&gt; HashMap Key Value -&gt; [Text] -&gt; HashMap Key Value
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span>
</span><span id="line-285"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Key -&gt; HashMap Key Value -&gt; HashMap Key Value
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v) -&gt; k -&gt; HashMap k v -&gt; HashMap k v
</span><a href="../../../../unordered-containers/html/src"><span class="hs-identifier hs-var">HM.adjust</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
forall p. p -&gt; Value
</span><a href="#local-6989586621682479186"><span class="hs-identifier hs-var">obfuscate</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; HashMap Key Value -&gt; HashMap Key Value)
-&gt; (Text -&gt; Key) -&gt; Text -&gt; HashMap Key Value -&gt; HashMap Key Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Key
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.fromText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; HashMap Key Value
forall v. KeyMap v -&gt; HashMap Key v
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.toHashMap</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621682479190"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682479195"><span class="hs-identifier hs-var">keys</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682479183"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682479183"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682479183"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Invalid payload: not JSON&quot;</span></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621682479193"><span class="annot"><span class="annottext">encode' :: Value -&gt; Text
</span><a href="#local-6989586621682479193"><span class="hs-identifier hs-var hs-var">encode'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; (Value -&gt; ByteString) -&gt; Value -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BL.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.encode</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621682479192"><span class="annot"><span class="annottext">decode' :: ByteString -&gt; Maybe Value
</span><a href="#local-6989586621682479192"><span class="hs-identifier hs-var hs-var">decode'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.decode</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe Value)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; Maybe Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BL.fromStrict</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621682479186"><span class="annot"><span class="annottext">obfuscate :: p -&gt; Value
</span><a href="#local-6989586621682479186"><span class="hs-identifier hs-var hs-var">obfuscate</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*****&quot;</span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasPrivacyAnnotation</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-type">HandlerLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621682479178"><span class="annot"><span class="annottext">getPrivacyAnnotation :: HandlerLog -&gt; PrivacyAnnotation
</span><a href="#local-6989586621682479178"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPrivacyAnnotation</span></a></span></span><span> </span><span id="local-6989586621682479177"><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479177"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479177"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestStart"><span class="hs-identifier hs-type">LogRequestStart</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrivacyAnnotation
</span><span class="hs-identifier hs-var">Public</span></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequest"><span class="hs-identifier hs-type">LogRequest</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrivacyAnnotation
</span><span class="hs-identifier hs-var">Public</span></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestBody"><span class="hs-identifier hs-type">LogRequestBody</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrivacyAnnotation
</span><span class="hs-identifier hs-var">Confidential</span></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponse"><span class="hs-identifier hs-type">LogResponse</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrivacyAnnotation
</span><span class="hs-identifier hs-var">Public</span></span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponseBody"><span class="hs-identifier hs-type">LogResponseBody</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrivacyAnnotation
</span><span class="hs-identifier hs-var">Confidential</span></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestFinish"><span class="hs-identifier hs-type">LogRequestFinish</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrivacyAnnotation
</span><span class="hs-identifier hs-var">Public</span></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasSeverityAnnotation</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#HandlerLog"><span class="hs-identifier hs-type">HandlerLog</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621682479173"><span class="annot"><span class="annottext">getSeverityAnnotation :: HandlerLog -&gt; Severity
</span><a href="#local-6989586621682479173"><span class="hs-identifier hs-var hs-var hs-var hs-var">getSeverityAnnotation</span></a></span></span><span> </span><span id="local-6989586621682479172"><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479172"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="#local-6989586621682479172"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestStart"><span class="hs-identifier hs-var">LogRequestStart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequest"><span class="hs-identifier hs-type">LogRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogRequestBody"><span class="hs-identifier hs-type">LogRequestBody</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponse"><span class="hs-identifier hs-type">LogResponse</span></a></span><span> </span><span id="local-6989586621682479169"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479169"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682479168"><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479168"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity -&gt; Severity -&gt; Severity
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">max</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Severity
</span><a href="Network.Wai.Middleware.Logging.html#severityFromRequestTime"><span class="hs-identifier hs-var">severityFromRequestTime</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479169"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Severity -&gt; Severity) -&gt; Severity -&gt; Severity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status -&gt; Int
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var hs-var">statusCode</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; Int) -&gt; Maybe Status -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Status
</span><a href="#local-6989586621682479168"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-313"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682479165"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479165"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479165"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">503</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682479163"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479163"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682479163"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#LogResponseBody"><span class="hs-identifier hs-type">LogResponseBody</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="annottext">HandlerLog
</span><a href="Network.Wai.Middleware.Logging.html#LogRequestFinish"><span class="hs-identifier hs-var">LogRequestFinish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="annot"><a href="Network.Wai.Middleware.Logging.html#severityFromRequestTime"><span class="hs-identifier hs-type">severityFromRequestTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../time/html/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Severity</span></span><span>
</span><span id="line-320"></span><span id="severityFromRequestTime"><span class="annot"><span class="annottext">severityFromRequestTime :: NominalDiffTime -&gt; Severity
</span><a href="Network.Wai.Middleware.Logging.html#severityFromRequestTime"><span class="hs-identifier hs-var hs-var">severityFromRequestTime</span></a></span></span><span> </span><span id="local-6989586621682479161"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479161"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479161"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">5</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479161"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">1</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621682479161"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0.5</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Notice</span></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-325"></span></pre></body></html>