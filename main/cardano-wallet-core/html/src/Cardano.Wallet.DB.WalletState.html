<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Copyright: &#169; 2022 IOHK</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Pure data type which represents the entire wallet state,</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- including all checkpoints.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- FIXME during ADP-1043: Actually include everything,</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- e.g. TxHistory, Pending transactions, &#8230;</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.DB.WalletState</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Wallet state</span></span><span>
</span><span id="line-19"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier">WalletState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#fromGenesis"><span class="hs-identifier">fromGenesis</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier">getLatest</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#findNearestPoint"><span class="hs-identifier">findNearestPoint</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><span class="hs-comment">-- * WalletCheckpoint (internal use mostly)</span></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier">WalletCheckpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#toWallet"><span class="hs-identifier">toWallet</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#fromWallet"><span class="hs-identifier">fromWallet</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getBlockHeight"><span class="hs-identifier">getBlockHeight</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getSlot"><span class="hs-identifier">getSlot</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Delta types</span></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier">DeltaWalletState1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState"><span class="hs-identifier">DeltaWalletState</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Multiple wallets</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">DeltaMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier">adjustNoSuchWallet</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html"><span class="hs-identifier">Cardano.Wallet.Address.Book</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier">AddressBookIso</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Discoveries"><span class="hs-identifier">Discoveries</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Prologue"><span class="hs-identifier">Prologue</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html"><span class="hs-identifier">Cardano.Wallet.Checkpoints</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#Checkpoints"><span class="hs-identifier">Checkpoints</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier">BlockHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier">WalletId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.UTxO</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxO"><span class="hs-identifier">UTxO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.Delta</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Delta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">Data.DeltaMap</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier">DeltaMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">withIso</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL.Lens</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">over</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word32</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">pretty</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html"><span class="hs-identifier">Cardano.Wallet.Checkpoints</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CPS</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Model</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Wallet Checkpoint
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | Data stored in a single checkpoint.</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- Only includes the 'UTxO' and the 'Discoveries', but not the 'Prologue'.</span><span>
</span><span id="line-78"></span><span id="local-6989586621682459826"><span id="local-6989586621682459827"></span></span><span class="hs-keyword">data</span><span> </span><span id="WalletCheckpoint"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-var">WalletCheckpoint</span></a></span></span><span> </span><span id="local-6989586621682459904"><span class="annot"><a href="#local-6989586621682459904"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WalletCheckpoint"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-var">WalletCheckpoint</span></a></span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="currentTip"><span class="annot"><span class="annottext">WalletCheckpoint s -&gt; BlockHeader
</span><a href="Cardano.Wallet.DB.WalletState.html#currentTip"><span class="hs-identifier hs-var hs-var">currentTip</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#BlockHeader"><span class="hs-identifier hs-type">BlockHeader</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="utxo"><span class="annot"><span class="annottext">WalletCheckpoint s -&gt; UTxO
</span><a href="Cardano.Wallet.DB.WalletState.html#utxo"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="discoveries"><span class="annot"><span class="annottext">WalletCheckpoint s -&gt; Discoveries s
</span><a href="Cardano.Wallet.DB.WalletState.html#discoveries"><span class="hs-identifier hs-var hs-var">discoveries</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Discoveries"><span class="hs-identifier hs-type">Discoveries</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459904"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. WalletCheckpoint s -&gt; Rep (WalletCheckpoint s) x)
-&gt; (forall x. Rep (WalletCheckpoint s) x -&gt; WalletCheckpoint s)
-&gt; Generic (WalletCheckpoint s)
forall x. Rep (WalletCheckpoint s) x -&gt; WalletCheckpoint s
forall x. WalletCheckpoint s -&gt; Rep (WalletCheckpoint s) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall s x. Rep (WalletCheckpoint s) x -&gt; WalletCheckpoint s
forall s x. WalletCheckpoint s -&gt; Rep (WalletCheckpoint s) x
$cto :: forall s x. Rep (WalletCheckpoint s) x -&gt; WalletCheckpoint s
$cfrom :: forall s x. WalletCheckpoint s -&gt; Rep (WalletCheckpoint s) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="local-6989586621682459814"><span id="local-6989586621682459816"><span id="local-6989586621682459818"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459818"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459818"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Helper function: Get the block height of a wallet checkpoint.</span><span>
</span><span id="line-87"></span><span id="local-6989586621682459812"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getBlockHeight"><span class="hs-identifier hs-type">getBlockHeight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459812"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span></span><span>
</span><span id="line-88"></span><span id="getBlockHeight"><span class="annot"><span class="annottext">getBlockHeight :: WalletCheckpoint s -&gt; Word32
</span><a href="Cardano.Wallet.DB.WalletState.html#getBlockHeight"><span class="hs-identifier hs-var hs-var">getBlockHeight</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span id="local-6989586621682459811"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459811"><span class="hs-identifier hs-var">currentTip</span></a></span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Discoveries s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459811"><span class="hs-identifier hs-var">currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
-&gt; ((Word32 -&gt; Const Word32 Word32)
    -&gt; BlockHeader -&gt; Const Word32 BlockHeader)
-&gt; Word32
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;blockHeight&quot;
  ((Quantity &quot;block&quot; Word32
    -&gt; Const Word32 (Quantity &quot;block&quot; Word32))
   -&gt; BlockHeader -&gt; Const Word32 BlockHeader)
(Quantity &quot;block&quot; Word32 -&gt; Const Word32 (Quantity &quot;block&quot; Word32))
-&gt; BlockHeader -&gt; Const Word32 BlockHeader
</span><a href="#local-6989586621682459810"><span class="hs-var">#blockHeight</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;block&quot; Word32
  -&gt; Const Word32 (Quantity &quot;block&quot; Word32))
 -&gt; BlockHeader -&gt; Const Word32 BlockHeader)
-&gt; ((Word32 -&gt; Const Word32 Word32)
    -&gt; Quantity &quot;block&quot; Word32
    -&gt; Const Word32 (Quantity &quot;block&quot; Word32))
-&gt; (Word32 -&gt; Const Word32 Word32)
-&gt; BlockHeader
-&gt; Const Word32 BlockHeader
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Word32 -&gt; Const Word32 Word32)
   -&gt; Quantity &quot;block&quot; Word32
   -&gt; Const Word32 (Quantity &quot;block&quot; Word32))
(Word32 -&gt; Const Word32 Word32)
-&gt; Quantity &quot;block&quot; Word32
-&gt; Const Word32 (Quantity &quot;block&quot; Word32)
</span><a href="#local-6989586621682459808"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Helper function: Get the 'Slot' of a wallet checkpoint.</span><span>
</span><span id="line-92"></span><span id="local-6989586621682459807"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getSlot"><span class="hs-identifier hs-type">getSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459807"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier hs-type">W.Slot</span></a></span></span><span>
</span><span id="line-93"></span><span id="getSlot"><span class="annot"><span class="annottext">getSlot :: WalletCheckpoint s -&gt; Slot
</span><a href="Cardano.Wallet.DB.WalletState.html#getSlot"><span class="hs-identifier hs-var hs-var">getSlot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span id="local-6989586621682459806"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459806"><span class="hs-identifier hs-var">currentTip</span></a></span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Discoveries s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">ChainPoint -&gt; Slot
</span><a href="Cardano.Wallet.Primitive.Types.html#toSlot"><span class="hs-identifier hs-var">W.toSlot</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; Slot)
-&gt; (BlockHeader -&gt; ChainPoint) -&gt; BlockHeader -&gt; Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; ChainPoint
</span><a href="Cardano.Wallet.Primitive.Types.html#chainPointFromBlockHeader"><span class="hs-identifier hs-var">W.chainPointFromBlockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockHeader -&gt; Slot) -&gt; BlockHeader -&gt; Slot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459806"><span class="hs-identifier hs-var">currentTip</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | Convert a stored 'WalletCheckpoint' to the legacy 'W.Wallet' state.</span><span>
</span><span id="line-97"></span><span id="local-6989586621682459888"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#toWallet"><span class="hs-identifier hs-type">toWallet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459888"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Prologue"><span class="hs-identifier hs-type">Prologue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459888"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459888"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">W.Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459888"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-98"></span><span id="toWallet"><span class="annot"><span class="annottext">toWallet :: Prologue s -&gt; WalletCheckpoint s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#toWallet"><span class="hs-identifier hs-var hs-var">toWallet</span></a></span></span><span> </span><span id="local-6989586621682459803"><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459803"><span class="hs-identifier hs-var">pro</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span id="local-6989586621682459802"><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459802"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621682459801"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682459801"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621682459800"><span class="annot"><span class="annottext">Discoveries s
</span><a href="#local-6989586621682459800"><span class="hs-identifier hs-var">dis</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">UTxO -&gt; BlockHeader -&gt; s -&gt; Wallet s
forall s. UTxO -&gt; BlockHeader -&gt; s -&gt; Wallet s
</span><a href="Cardano.Wallet.Primitive.Model.html#unsafeInitWallet"><span class="hs-identifier hs-var">W.unsafeInitWallet</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621682459801"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459802"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">(s -&gt; Wallet s) -&gt; s -&gt; Wallet s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Iso s s (Prologue s, Discoveries s) (Prologue s, Discoveries s)
-&gt; ((s -&gt; (Prologue s, Discoveries s))
    -&gt; ((Prologue s, Discoveries s) -&gt; s) -&gt; s)
-&gt; s
forall s t a b r. Iso s t a b -&gt; ((s -&gt; a) -&gt; (b -&gt; t) -&gt; r) -&gt; r
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">withIso</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. AddressBookIso s =&gt; Iso' s (Prologue s, Discoveries s)
Iso s s (Prologue s, Discoveries s) (Prologue s, Discoveries s)
</span><a href="Cardano.Wallet.Address.Book.html#addressIso"><span class="hs-identifier hs-var">addressIso</span></a></span><span> </span><span class="annot"><span class="annottext">(((s -&gt; (Prologue s, Discoveries s))
  -&gt; ((Prologue s, Discoveries s) -&gt; s) -&gt; s)
 -&gt; s)
-&gt; ((s -&gt; (Prologue s, Discoveries s))
    -&gt; ((Prologue s, Discoveries s) -&gt; s) -&gt; s)
-&gt; s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">s -&gt; (Prologue s, Discoveries s)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682459797"><span class="annot"><span class="annottext">(Prologue s, Discoveries s) -&gt; s
</span><a href="#local-6989586621682459797"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Prologue s, Discoveries s) -&gt; s
</span><a href="#local-6989586621682459797"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459803"><span class="hs-identifier hs-var">pro</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Discoveries s
</span><a href="#local-6989586621682459800"><span class="hs-identifier hs-var">dis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Convert a legacy 'W.Wallet' state to a 'Prologue' and a 'WalletCheckpoint'</span><span>
</span><span id="line-102"></span><span id="local-6989586621682459890"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#fromWallet"><span class="hs-identifier hs-type">fromWallet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459890"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">W.Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459890"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Prologue"><span class="hs-identifier hs-type">Prologue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459890"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459890"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-103"></span><span id="fromWallet"><span class="annot"><span class="annottext">fromWallet :: Wallet s -&gt; (Prologue s, WalletCheckpoint s)
</span><a href="Cardano.Wallet.DB.WalletState.html#fromWallet"><span class="hs-identifier hs-var hs-var">fromWallet</span></a></span></span><span> </span><span id="local-6989586621682459796"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459796"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459795"><span class="hs-identifier hs-var">pro</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; UTxO -&gt; Discoveries s -&gt; WalletCheckpoint s
forall s.
BlockHeader -&gt; UTxO -&gt; Discoveries s -&gt; WalletCheckpoint s
</span><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-var">WalletCheckpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; BlockHeader
forall s. Wallet s -&gt; BlockHeader
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3AcurrentTip%3AWallet"><span class="hs-identifier hs-var hs-var">W.currentTip</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459796"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s -&gt; UTxO
forall s. Wallet s -&gt; UTxO
</span><a href="Cardano.Wallet.Primitive.Model.html#%24sel%3Autxo%3AWallet"><span class="hs-identifier hs-var hs-var">W.utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459796"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Discoveries s
</span><a href="#local-6989586621682459792"><span class="hs-identifier hs-var">dis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682459795"><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459795"><span class="hs-identifier hs-var">pro</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682459792"><span class="annot"><span class="annottext">Discoveries s
</span><a href="#local-6989586621682459792"><span class="hs-identifier hs-var">dis</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Iso s s (Prologue s, Discoveries s) (Prologue s, Discoveries s)
-&gt; ((s -&gt; (Prologue s, Discoveries s))
    -&gt; ((Prologue s, Discoveries s) -&gt; s)
    -&gt; (Prologue s, Discoveries s))
-&gt; (Prologue s, Discoveries s)
forall s t a b r. Iso s t a b -&gt; ((s -&gt; a) -&gt; (b -&gt; t) -&gt; r) -&gt; r
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">withIso</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. AddressBookIso s =&gt; Iso' s (Prologue s, Discoveries s)
Iso s s (Prologue s, Discoveries s) (Prologue s, Discoveries s)
</span><a href="Cardano.Wallet.Address.Book.html#addressIso"><span class="hs-identifier hs-var">addressIso</span></a></span><span> </span><span class="annot"><span class="annottext">(((s -&gt; (Prologue s, Discoveries s))
  -&gt; ((Prologue s, Discoveries s) -&gt; s)
  -&gt; (Prologue s, Discoveries s))
 -&gt; (Prologue s, Discoveries s))
-&gt; ((s -&gt; (Prologue s, Discoveries s))
    -&gt; ((Prologue s, Discoveries s) -&gt; s)
    -&gt; (Prologue s, Discoveries s))
-&gt; (Prologue s, Discoveries s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682459791"><span class="annot"><span class="annottext">s -&gt; (Prologue s, Discoveries s)
</span><a href="#local-6989586621682459791"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Prologue s, Discoveries s) -&gt; s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">s -&gt; (Prologue s, Discoveries s)
</span><a href="#local-6989586621682459791"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459796"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
-&gt; ((s -&gt; Const s s) -&gt; Wallet s -&gt; Const s (Wallet s)) -&gt; s
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getState&quot; ((s -&gt; Const s s) -&gt; Wallet s -&gt; Const s (Wallet s))
(s -&gt; Const s s) -&gt; Wallet s -&gt; Const s (Wallet s)
</span><a href="#local-6989586621682459790"><span class="hs-var">#getState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Wallet State
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Wallet state. Currently includes:</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- * Prologue of the address discovery state</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- * Checkpoints of UTxO and of discoveries of the address discovery state.</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- FIXME during ADP-1043: Include also TxHistory, pending transactions, &#8230;,</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- everything.</span><span>
</span><span id="line-117"></span><span id="local-6989586621682459788"><span id="local-6989586621682459789"></span></span><span class="hs-keyword">data</span><span> </span><span id="WalletState"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-var">WalletState</span></a></span></span><span> </span><span id="local-6989586621682459892"><span class="annot"><a href="#local-6989586621682459892"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WalletState"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-var">WalletState</span></a></span></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="prologue"><span class="annot"><span class="annottext">WalletState s -&gt; Prologue s
</span><a href="Cardano.Wallet.DB.WalletState.html#prologue"><span class="hs-identifier hs-var hs-var">prologue</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Prologue"><span class="hs-identifier hs-type">Prologue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459892"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="checkpoints"><span class="annot"><span class="annottext">WalletState s -&gt; Checkpoints (WalletCheckpoint s)
</span><a href="Cardano.Wallet.DB.WalletState.html#checkpoints"><span class="hs-identifier hs-var hs-var">checkpoints</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#Checkpoints"><span class="hs-identifier hs-type">Checkpoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459892"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. WalletState s -&gt; Rep (WalletState s) x)
-&gt; (forall x. Rep (WalletState s) x -&gt; WalletState s)
-&gt; Generic (WalletState s)
forall x. Rep (WalletState s) x -&gt; WalletState s
forall x. WalletState s -&gt; Rep (WalletState s) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall s x. Rep (WalletState s) x -&gt; WalletState s
forall s x. WalletState s -&gt; Rep (WalletState s) x
$cto :: forall s x. Rep (WalletState s) x -&gt; WalletState s
$cfrom :: forall s x. WalletState s -&gt; Rep (WalletState s) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span id="local-6989586621682459778"><span id="local-6989586621682459780"><span id="local-6989586621682459782"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459782"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-type">WalletState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459782"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | Create a wallet from the genesis block.</span><span>
</span><span id="line-125"></span><span id="local-6989586621682459777"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#fromGenesis"><span class="hs-identifier hs-type">fromGenesis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459777"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">W.Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459777"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-type">WalletState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459777"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-126"></span><span id="fromGenesis"><span class="annot"><span class="annottext">fromGenesis :: Wallet s -&gt; Maybe (WalletState s)
</span><a href="Cardano.Wallet.DB.WalletState.html#fromGenesis"><span class="hs-identifier hs-var hs-var">fromGenesis</span></a></span></span><span> </span><span id="local-6989586621682459776"><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459776"><span class="hs-identifier hs-var">cp</span></a></span></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">BlockHeader -&gt; Bool
</span><a href="Cardano.Wallet.Primitive.Types.html#isGenesisBlockHeader"><span class="hs-identifier hs-var">W.isGenesisBlockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">BlockHeader
</span><a href="#local-6989586621682459774"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletState s -&gt; Maybe (WalletState s)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletState s -&gt; Maybe (WalletState s))
-&gt; WalletState s -&gt; Maybe (WalletState s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">WalletState :: forall s.
Prologue s -&gt; Checkpoints (WalletCheckpoint s) -&gt; WalletState s
</span><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-type">WalletState</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Prologue s
prologue :: Prologue s
prologue :: Prologue s
</span><a href="#local-6989586621682459773"><span class="hs-identifier hs-var hs-var">prologue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">checkpoints :: Checkpoints (WalletCheckpoint s)
</span><a href="Cardano.Wallet.DB.WalletState.html#checkpoints"><span class="hs-identifier hs-var">checkpoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletCheckpoint s -&gt; Checkpoints (WalletCheckpoint s)
forall a. a -&gt; Checkpoints a
</span><a href="Cardano.Wallet.Checkpoints.html#fromGenesis"><span class="hs-identifier hs-var">CPS.fromGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">WalletCheckpoint s
</span><a href="#local-6989586621682459771"><span class="hs-identifier hs-var">checkpoint</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (WalletState s)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621682459774"><span class="annot"><span class="annottext">header :: BlockHeader
</span><a href="#local-6989586621682459774"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459776"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
-&gt; ((BlockHeader -&gt; Const BlockHeader BlockHeader)
    -&gt; Wallet s -&gt; Const BlockHeader (Wallet s))
-&gt; BlockHeader
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;currentTip&quot;
  ((BlockHeader -&gt; Const BlockHeader BlockHeader)
   -&gt; Wallet s -&gt; Const BlockHeader (Wallet s))
(BlockHeader -&gt; Const BlockHeader BlockHeader)
-&gt; Wallet s -&gt; Const BlockHeader (Wallet s)
</span><a href="#local-6989586621682459770"><span class="hs-var">#currentTip</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682459773"><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459773"><span class="hs-identifier hs-var">prologue</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682459771"><span class="annot"><span class="annottext">WalletCheckpoint s
</span><a href="#local-6989586621682459771"><span class="hs-identifier hs-var">checkpoint</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wallet s -&gt; (Prologue s, WalletCheckpoint s)
forall s.
AddressBookIso s =&gt;
Wallet s -&gt; (Prologue s, WalletCheckpoint s)
</span><a href="Cardano.Wallet.DB.WalletState.html#fromWallet"><span class="hs-identifier hs-var">fromWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet s
</span><a href="#local-6989586621682459776"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | Get the wallet checkpoint with the largest slot number</span><span>
</span><span id="line-135"></span><span id="local-6989586621682459769"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier hs-type">getLatest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#AddressBookIso"><span class="hs-identifier hs-type">AddressBookIso</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459769"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-type">WalletState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459769"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Model.html#Wallet"><span class="hs-identifier hs-type">W.Wallet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459769"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-136"></span><span id="getLatest"><span class="annot"><span class="annottext">getLatest :: WalletState s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#getLatest"><span class="hs-identifier hs-var hs-var">getLatest</span></a></span></span><span> </span><span id="local-6989586621682459768"><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682459768"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">Prologue s -&gt; WalletCheckpoint s -&gt; Wallet s
forall s.
AddressBookIso s =&gt;
Prologue s -&gt; WalletCheckpoint s -&gt; Wallet s
</span><a href="Cardano.Wallet.DB.WalletState.html#toWallet"><span class="hs-identifier hs-var">toWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682459768"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s
-&gt; ((Prologue s -&gt; Const (Prologue s) (Prologue s))
    -&gt; WalletState s -&gt; Const (Prologue s) (WalletState s))
-&gt; Prologue s
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;prologue&quot;
  ((Prologue s -&gt; Const (Prologue s) (Prologue s))
   -&gt; WalletState s -&gt; Const (Prologue s) (WalletState s))
(Prologue s -&gt; Const (Prologue s) (Prologue s))
-&gt; WalletState s -&gt; Const (Prologue s) (WalletState s)
</span><a href="#local-6989586621682459767"><span class="hs-var">#prologue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(WalletCheckpoint s -&gt; Wallet s)
-&gt; ((Slot, WalletCheckpoint s) -&gt; WalletCheckpoint s)
-&gt; (Slot, WalletCheckpoint s)
-&gt; Wallet s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot, WalletCheckpoint s) -&gt; WalletCheckpoint s
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Slot, WalletCheckpoint s) -&gt; Wallet s)
-&gt; (Slot, WalletCheckpoint s) -&gt; Wallet s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Checkpoints (WalletCheckpoint s) -&gt; (Slot, WalletCheckpoint s)
forall a. Checkpoints a -&gt; (Slot, a)
</span><a href="Cardano.Wallet.Checkpoints.html#getLatest"><span class="hs-identifier hs-var">CPS.getLatest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WalletState s
</span><a href="#local-6989586621682459768"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">WalletState s
-&gt; ((Checkpoints (WalletCheckpoint s)
     -&gt; Const
          (Checkpoints (WalletCheckpoint s))
          (Checkpoints (WalletCheckpoint s)))
    -&gt; WalletState s
    -&gt; Const (Checkpoints (WalletCheckpoint s)) (WalletState s))
-&gt; Checkpoints (WalletCheckpoint s)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;checkpoints&quot;
  ((Checkpoints (WalletCheckpoint s)
    -&gt; Const
         (Checkpoints (WalletCheckpoint s))
         (Checkpoints (WalletCheckpoint s)))
   -&gt; WalletState s
   -&gt; Const (Checkpoints (WalletCheckpoint s)) (WalletState s))
(Checkpoints (WalletCheckpoint s)
 -&gt; Const
      (Checkpoints (WalletCheckpoint s))
      (Checkpoints (WalletCheckpoint s)))
-&gt; WalletState s
-&gt; Const (Checkpoints (WalletCheckpoint s)) (WalletState s)
</span><a href="#local-6989586621682459765"><span class="hs-var">#checkpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- | Find the nearest 'Checkpoint' that is either at the given point or before.</span><span>
</span><span id="line-140"></span><span id="local-6989586621682459764"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#findNearestPoint"><span class="hs-identifier hs-type">findNearestPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-type">WalletState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459764"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier hs-type">W.Slot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#Slot"><span class="hs-identifier hs-type">W.Slot</span></a></span></span><span>
</span><span id="line-141"></span><span id="findNearestPoint"><span class="annot"><span class="annottext">findNearestPoint :: WalletState s -&gt; Slot -&gt; Maybe Slot
</span><a href="Cardano.Wallet.DB.WalletState.html#findNearestPoint"><span class="hs-identifier hs-var hs-var">findNearestPoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Checkpoints (WalletCheckpoint s) -&gt; Slot -&gt; Maybe Slot
forall a. Checkpoints a -&gt; Slot -&gt; Maybe Slot
</span><a href="Cardano.Wallet.Checkpoints.html#findNearestPoint"><span class="hs-identifier hs-var">CPS.findNearestPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(Checkpoints (WalletCheckpoint s) -&gt; Slot -&gt; Maybe Slot)
-&gt; (WalletState s -&gt; Checkpoints (WalletCheckpoint s))
-&gt; WalletState s
-&gt; Slot
-&gt; Maybe Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Checkpoints (WalletCheckpoint s)
  -&gt; Const
       (Checkpoints (WalletCheckpoint s))
       (Checkpoints (WalletCheckpoint s)))
 -&gt; WalletState s
 -&gt; Const (Checkpoints (WalletCheckpoint s)) (WalletState s))
-&gt; WalletState s -&gt; Checkpoints (WalletCheckpoint s)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;checkpoints&quot;
  ((Checkpoints (WalletCheckpoint s)
    -&gt; Const
         (Checkpoints (WalletCheckpoint s))
         (Checkpoints (WalletCheckpoint s)))
   -&gt; WalletState s
   -&gt; Const (Checkpoints (WalletCheckpoint s)) (WalletState s))
(Checkpoints (WalletCheckpoint s)
 -&gt; Const
      (Checkpoints (WalletCheckpoint s))
      (Checkpoints (WalletCheckpoint s)))
-&gt; WalletState s
-&gt; Const (Checkpoints (WalletCheckpoint s)) (WalletState s)
</span><a href="#local-6989586621682459762"><span class="hs-var">#checkpoints</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Delta type for the wallet state
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-146"></span><span class="hs-keyword">type</span><span> </span><span id="DeltaWalletState"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState"><span class="hs-identifier hs-var">DeltaWalletState</span></a></span></span><span> </span><span id="local-6989586621682459761"><span class="annot"><a href="#local-6989586621682459761"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier hs-type">DeltaWalletState1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459761"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">data</span><span> </span><span id="DeltaWalletState1"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier hs-var">DeltaWalletState1</span></a></span></span><span> </span><span id="local-6989586621682459760"><span class="annot"><a href="#local-6989586621682459760"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ReplacePrologue"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-var">ReplacePrologue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Address.Book.html#Prologue"><span class="hs-identifier hs-type">Prologue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459760"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- ^ Replace the prologue of the address discovery state</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UpdateCheckpoints"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#UpdateCheckpoints"><span class="hs-identifier hs-var">UpdateCheckpoints</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Checkpoints.html#DeltasCheckpoints"><span class="hs-identifier hs-type">CPS.DeltasCheckpoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletCheckpoint"><span class="hs-identifier hs-type">WalletCheckpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459760"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- ^ Update the wallet checkpoints.</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span id="local-6989586621682459757"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier hs-type">DeltaWalletState1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459757"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Base"><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Base</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier hs-type">DeltaWalletState1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459757"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#WalletState"><span class="hs-identifier hs-type">WalletState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459757"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621682459754"><span class="annot"><span class="annottext">apply :: DeltaWalletState1 s
-&gt; Base (DeltaWalletState1 s) -&gt; Base (DeltaWalletState1 s)
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">apply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-type">ReplacePrologue</span></a></span><span> </span><span id="local-6989586621682459752"><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459752"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Prologue s -&gt; Identity (Prologue s))
 -&gt; WalletState s -&gt; Identity (WalletState s))
-&gt; (Prologue s -&gt; Prologue s) -&gt; WalletState s -&gt; WalletState s
forall a b s t.
((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;prologue&quot;
  ((Prologue s -&gt; Identity (Prologue s))
   -&gt; WalletState s -&gt; Identity (WalletState s))
(Prologue s -&gt; Identity (Prologue s))
-&gt; WalletState s -&gt; Identity (WalletState s)
</span><a href="#local-6989586621682459751"><span class="hs-var">#prologue</span></a></span><span> </span><span class="annot"><span class="annottext">((Prologue s -&gt; Prologue s) -&gt; WalletState s -&gt; WalletState s)
-&gt; (Prologue s -&gt; Prologue s) -&gt; WalletState s -&gt; WalletState s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Prologue s -&gt; Prologue s -&gt; Prologue s
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Prologue s
</span><a href="#local-6989586621682459752"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#UpdateCheckpoints"><span class="hs-identifier hs-type">UpdateCheckpoints</span></a></span><span> </span><span id="local-6989586621682459749"><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s)
</span><a href="#local-6989586621682459749"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Checkpoints (WalletCheckpoint s)
  -&gt; Identity (Checkpoints (WalletCheckpoint s)))
 -&gt; WalletState s -&gt; Identity (WalletState s))
-&gt; (Checkpoints (WalletCheckpoint s)
    -&gt; Checkpoints (WalletCheckpoint s))
-&gt; WalletState s
-&gt; WalletState s
forall a b s t.
((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;checkpoints&quot;
  ((Checkpoints (WalletCheckpoint s)
    -&gt; Identity (Checkpoints (WalletCheckpoint s)))
   -&gt; WalletState s -&gt; Identity (WalletState s))
(Checkpoints (WalletCheckpoint s)
 -&gt; Identity (Checkpoints (WalletCheckpoint s)))
-&gt; WalletState s -&gt; Identity (WalletState s)
</span><a href="#local-6989586621682459748"><span class="hs-var">#checkpoints</span></a></span><span> </span><span class="annot"><span class="annottext">((Checkpoints (WalletCheckpoint s)
  -&gt; Checkpoints (WalletCheckpoint s))
 -&gt; WalletState s -&gt; WalletState s)
-&gt; (Checkpoints (WalletCheckpoint s)
    -&gt; Checkpoints (WalletCheckpoint s))
-&gt; WalletState s
-&gt; WalletState s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s)
-&gt; Base (DeltasCheckpoints (WalletCheckpoint s))
-&gt; Base (DeltasCheckpoints (WalletCheckpoint s))
forall delta. Delta delta =&gt; delta -&gt; Base delta -&gt; Base delta
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s)
</span><a href="#local-6989586621682459749"><span class="hs-identifier hs-var">d</span></a></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621682459747"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier hs-type">DeltaWalletState1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459747"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621682459744"><span class="annot"><span class="annottext">build :: DeltaWalletState1 s -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">build</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ReplacePrologue"><span class="hs-identifier hs-type">ReplacePrologue</span></a></span><span> </span><span class="annot"><span class="annottext">Prologue s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;ReplacePrologue &#8230;&quot;</span></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#UpdateCheckpoints"><span class="hs-identifier hs-type">UpdateCheckpoints</span></a></span><span> </span><span id="local-6989586621682459742"><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s)
</span><a href="#local-6989586621682459742"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;UpdateCheckpoints (&quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s) -&gt; Builder
forall p. Buildable p =&gt; p -&gt; Builder
</span><a href="../../../../formatting/html/src"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">DeltasCheckpoints (WalletCheckpoint s)
</span><a href="#local-6989586621682459742"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;)&quot;</span></span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span id="local-6989586621682459741"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682459736"><span id="local-6989586621682459739"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#DeltaWalletState1"><span class="hs-identifier hs-type">DeltaWalletState1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459741"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621682459734"><span class="annot"><span class="annottext">show :: DeltaWalletState1 s -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeltaWalletState1 s -&gt; String
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Multiple wallets.
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- | Adjust a specific wallet if it exists or return 'ErrNoSuchWallet'.</span><span>
</span><span id="line-170"></span><span id="local-6989586621682459729"><span id="local-6989586621682459730"><span id="local-6989586621682459731"><span id="local-6989586621682459732"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-type">adjustNoSuchWallet</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-type">ErrNoSuchWallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682459732"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682459731"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459732"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682459730"><span class="hs-identifier hs-type">dw</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682459729"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459731"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-type">DeltaMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459730"><span class="hs-identifier hs-type">dw</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459732"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682459729"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-175"></span><span id="adjustNoSuchWallet"><span class="annot"><span class="annottext">adjustNoSuchWallet :: WalletId
-&gt; (ErrNoSuchWallet -&gt; e)
-&gt; (w -&gt; Either e (dw, b))
-&gt; Map WalletId w
-&gt; (Maybe (DeltaMap WalletId dw), Either e b)
</span><a href="Cardano.Wallet.DB.WalletState.html#adjustNoSuchWallet"><span class="hs-identifier hs-var hs-var">adjustNoSuchWallet</span></a></span></span><span> </span><span id="local-6989586621682459728"><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682459728"><span class="hs-identifier hs-var">wid</span></a></span></span><span> </span><span id="local-6989586621682459727"><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; e
</span><a href="#local-6989586621682459727"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621682459726"><span class="annot"><span class="annottext">w -&gt; Either e (dw, b)
</span><a href="#local-6989586621682459726"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span id="local-6989586621682459725"><span class="annot"><span class="annottext">Map WalletId w
</span><a href="#local-6989586621682459725"><span class="hs-identifier hs-var">wallets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Map WalletId w -&gt; Maybe w
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682459728"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Map WalletId w
</span><a href="#local-6989586621682459725"><span class="hs-identifier hs-var">wallets</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">Maybe w
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (DeltaMap WalletId dw)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">e -&gt; Either e b
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(e -&gt; Either e b) -&gt; e -&gt; Either e b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; e
</span><a href="#local-6989586621682459727"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrNoSuchWallet -&gt; e) -&gt; ErrNoSuchWallet -&gt; e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; ErrNoSuchWallet
</span><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-var">ErrNoSuchWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682459728"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682459722"><span class="annot"><span class="annottext">w
</span><a href="#local-6989586621682459722"><span class="hs-identifier hs-var">wal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">w -&gt; Either e (dw, b)
</span><a href="#local-6989586621682459726"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">w
</span><a href="#local-6989586621682459722"><span class="hs-identifier hs-var">wal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682459721"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682459721"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (DeltaMap WalletId dw)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">e -&gt; Either e b
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621682459721"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682459720"><span class="annot"><span class="annottext">dw
</span><a href="#local-6989586621682459720"><span class="hs-identifier hs-var">dw</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682459719"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682459719"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeltaMap WalletId dw -&gt; Maybe (DeltaMap WalletId dw)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaMap WalletId dw -&gt; Maybe (DeltaMap WalletId dw))
-&gt; DeltaMap WalletId dw -&gt; Maybe (DeltaMap WalletId dw)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; dw -&gt; DeltaMap WalletId dw
forall key da. key -&gt; da -&gt; DeltaMap key da
</span><a href="../../../../dbvar/html/src"><span class="hs-identifier hs-var">Adjust</span></a></span><span> </span><span class="annot"><span class="annottext">WalletId
</span><a href="#local-6989586621682459728"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">dw
</span><a href="#local-6989586621682459720"><span class="hs-identifier hs-var">dw</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either e b
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682459719"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Errors
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- | Can't perform given operation because there's no wallet</span><span>
</span><span id="line-185"></span><span class="hs-keyword">newtype</span><span> </span><span id="ErrNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-var">ErrNoSuchWallet</span></a></span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ErrNoSuchWallet"><span class="annot"><a href="Cardano.Wallet.DB.WalletState.html#ErrNoSuchWallet"><span class="hs-identifier hs-var">ErrNoSuchWallet</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.html#WalletId"><span class="hs-identifier hs-type">WalletId</span></a></span><span> </span><span class="hs-comment">-- Wallet is gone or doesn't exist yet</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682459714"><span id="local-6989586621682459716"><span class="annot"><span class="annottext">ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool
(ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool)
-&gt; (ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool)
-&gt; Eq ErrNoSuchWallet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool
$c/= :: ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool
== :: ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool
$c== :: ErrNoSuchWallet -&gt; ErrNoSuchWallet -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682459708"><span id="local-6989586621682459710"><span id="local-6989586621682459712"><span class="annot"><span class="annottext">Int -&gt; ErrNoSuchWallet -&gt; ShowS
[ErrNoSuchWallet] -&gt; ShowS
ErrNoSuchWallet -&gt; String
(Int -&gt; ErrNoSuchWallet -&gt; ShowS)
-&gt; (ErrNoSuchWallet -&gt; String)
-&gt; ([ErrNoSuchWallet] -&gt; ShowS)
-&gt; Show ErrNoSuchWallet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ErrNoSuchWallet] -&gt; ShowS
$cshowList :: [ErrNoSuchWallet] -&gt; ShowS
show :: ErrNoSuchWallet -&gt; String
$cshow :: ErrNoSuchWallet -&gt; String
showsPrec :: Int -&gt; ErrNoSuchWallet -&gt; ShowS
$cshowsPrec :: Int -&gt; ErrNoSuchWallet -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span></pre></body></html>