<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RoleAnnotations #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Copyright: &#169; 2018-2021 IOHK</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- License: Apache-2.0</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Implementation of address derivation for 'Shared' Keys.</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Shared</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-23"></span><span>      </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier">SharedKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Generation and derivation</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#generateKeyFromSeed"><span class="hs-identifier">generateKeyFromSeed</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#purposeCIP1854"><span class="hs-identifier">purposeCIP1854</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Derivation</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">xpubPublicKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">Cardano.Crypto.Wallet</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">XPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">XPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">toXPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">unXPrv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">unXPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">xprv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier">xpub</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">SomeMnemonic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier">BoundedAddressLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Depth"><span class="hs-identifier">Depth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#DerivationType"><span class="hs-identifier">DerivationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier">HardDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier">KeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier">MkKeyFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier">NetworkDiscriminant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPrivateKey"><span class="hs-identifier">PersistPrivateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPublicKey"><span class="hs-identifier">PersistPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier">SoftDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier">WalletKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier">fromHex</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier">hex</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.SharedKey</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier">SharedKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#purposeCIP1854"><span class="hs-identifier">purposeCIP1854</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Shelley</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAccountPrivateKeyShelley"><span class="hs-identifier">deriveAccountPrivateKeyShelley</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAddressPrivateKeyShelley"><span class="hs-identifier">deriveAddressPrivateKeyShelley</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAddressPublicKeyShelley"><span class="hs-identifier">deriveAddressPublicKeyShelley</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#unsafeGenerateKeyFromSeedShelley"><span class="hs-identifier">unsafeGenerateKeyFromSeedShelley</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier">GetPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier">Passphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier">PassphraseHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.html#changePassphraseXPrv"><span class="hs-identifier">changePassphraseXPrv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Address</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;=&lt;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">hash</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash.Algorithms</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Blake2b_224</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.Hash.IO</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">HashAlgorithm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">hashDigestSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.Hash.Utils.html"><span class="hs-identifier">Crypto.Hash.Utils</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Crypto.Hash.Utils.html#blake2b224"><span class="hs-identifier">blake2b224</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                            Sequential Derivation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Generate a root key from a corresponding seed.</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- The seed should be at least 16 bytes.</span><span>
</span><span id="line-92"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#generateKeyFromSeed"><span class="hs-identifier hs-type">generateKeyFromSeed</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>       </span><span class="hs-comment">-- ^ The actual seed and its recovery / generation passphrase</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span><span>
</span><span id="line-97"></span><span id="generateKeyFromSeed"><span class="annot"><span class="annottext">generateKeyFromSeed :: (SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; SharedKey 'RootK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#generateKeyFromSeed"><span class="hs-identifier hs-var hs-var">generateKeyFromSeed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; SharedKey 'RootK XPrv
forall (depth :: Depth).
(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; SharedKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-var">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Generate a new key from seed. Note that the @depth@ is left open so that</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- the caller gets to decide what type of key this is. This is mostly for</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- testing, in practice, seeds are used to represent root keys, and one should</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- use 'generateKeyFromSeed'.</span><span>
</span><span id="line-103"></span><span id="local-6989586621682446798"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-type">unsafeGenerateKeyFromSeed</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">SomeMnemonic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-comment">-- ^ The actual seed and its recovery / generation passphrase</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#Passphrase"><span class="hs-identifier hs-type">Passphrase</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;encryption&quot;</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682446798"><span class="hs-identifier hs-type">depth</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPrv</span></a></span></span><span>
</span><span id="line-108"></span><span id="unsafeGenerateKeyFromSeed"><span class="annot"><span class="annottext">unsafeGenerateKeyFromSeed :: (SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; SharedKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#unsafeGenerateKeyFromSeed"><span class="hs-identifier hs-var hs-var">unsafeGenerateKeyFromSeed</span></a></span></span><span> </span><span id="local-6989586621682446663"><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
</span><a href="#local-6989586621682446663"><span class="hs-identifier hs-var">mnemonics</span></a></span></span><span> </span><span id="local-6989586621682446662"><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682446662"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">XPrv -&gt; SharedKey depth XPrv
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; SharedKey depth XPrv) -&gt; XPrv -&gt; SharedKey depth XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#unsafeGenerateKeyFromSeedShelley"><span class="hs-identifier hs-var">unsafeGenerateKeyFromSeedShelley</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
</span><a href="#local-6989586621682446663"><span class="hs-identifier hs-var">mnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682446662"><span class="hs-identifier hs-var">pwd</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#HardDerivation"><span class="hs-identifier hs-type">HardDerivation</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="AddressIndexDerivationType"><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressIndexDerivationType"><span class="hs-identifier hs-var">AddressIndexDerivationType</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#Soft"><span class="hs-identifier hs-type">Soft</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621682446657"><span class="annot"><span class="annottext">deriveAccountPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; SharedKey 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; SharedKey 'AccountK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAccountPrivateKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAccountPrivateKey</span></a></span></span><span> </span><span id="local-6989586621682446655"><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682446655"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span id="local-6989586621682446654"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446654"><span class="hs-identifier hs-var">rootXPrv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682446653"><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682446653"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">XPrv -&gt; SharedKey 'AccountK XPrv
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; SharedKey 'AccountK XPrv)
-&gt; XPrv -&gt; SharedKey 'AccountK XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; Passphrase &quot;encryption&quot;
-&gt; XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAccountPrivateKeyShelley"><span class="hs-identifier hs-var">deriveAccountPrivateKeyShelley</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#purposeCIP1854"><span class="hs-identifier hs-var">purposeCIP1854</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682446655"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446654"><span class="hs-identifier hs-var">rootXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
</span><a href="#local-6989586621682446653"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621682446652"><span class="annot"><span class="annottext">deriveAddressPrivateKey :: Passphrase &quot;encryption&quot;
-&gt; SharedKey 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType SharedKey) 'AddressK
-&gt; SharedKey 'AddressK XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPrivateKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAddressPrivateKey</span></a></span></span><span> </span><span id="local-6989586621682446650"><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682446650"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span id="local-6989586621682446649"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446649"><span class="hs-identifier hs-var">accXPrv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682446648"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682446648"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682446647"><span class="annot"><span class="annottext">Index (AddressIndexDerivationType SharedKey) 'AddressK
</span><a href="#local-6989586621682446647"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">XPrv -&gt; SharedKey 'AddressK XPrv
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; SharedKey 'AddressK XPrv)
-&gt; XPrv -&gt; SharedKey 'AddressK XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; XPrv -&gt; Role -&gt; Index 'Soft 'AddressK -&gt; XPrv
forall a (derivationType :: DerivationType) (level :: Depth).
Enum a =&gt;
Passphrase &quot;encryption&quot;
-&gt; XPrv -&gt; a -&gt; Index derivationType level -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAddressPrivateKeyShelley"><span class="hs-identifier hs-var">deriveAddressPrivateKeyShelley</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
</span><a href="#local-6989586621682446650"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446649"><span class="hs-identifier hs-var">accXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682446648"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Index (AddressIndexDerivationType SharedKey) 'AddressK
Index 'Soft 'AddressK
</span><a href="#local-6989586621682446647"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#SoftDerivation"><span class="hs-identifier hs-type">SoftDerivation</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621682446643"><span class="annot"><span class="annottext">deriveAddressPublicKey :: SharedKey 'AccountK XPub
-&gt; Role -&gt; Index 'Soft 'AddressK -&gt; SharedKey 'AddressK XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#deriveAddressPublicKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">deriveAddressPublicKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span id="local-6989586621682446641"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682446641"><span class="hs-identifier hs-var">accXPub</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682446640"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682446640"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682446639"><span class="annot"><span class="annottext">Index 'Soft 'AddressK
</span><a href="#local-6989586621682446639"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">XPub -&gt; SharedKey 'AddressK XPub
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; SharedKey 'AddressK XPub)
-&gt; XPub -&gt; SharedKey 'AddressK XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; Role -&gt; Index 'Soft 'AddressK -&gt; XPub
forall a (derivationType :: DerivationType) (level :: Depth).
Enum a =&gt;
XPub -&gt; a -&gt; Index derivationType level -&gt; XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shelley.html#deriveAddressPublicKeyShelley"><span class="hs-identifier hs-var">deriveAddressPublicKeyShelley</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682446641"><span class="hs-identifier hs-var">accXPub</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682446640"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Soft 'AddressK
</span><a href="#local-6989586621682446639"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                            WalletKey implementation
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#WalletKey"><span class="hs-identifier hs-type">WalletKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621682446631"><span class="annot"><span class="annottext">changePassphrase :: (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; SharedKey depth XPrv
-&gt; SharedKey depth XPrv
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#changePassphrase"><span class="hs-identifier hs-var hs-var hs-var hs-var">changePassphrase</span></a></span></span><span> </span><span id="local-6989586621682446629"><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682446629"><span class="hs-identifier hs-var">oldPwd</span></a></span></span><span> </span><span id="local-6989586621682446628"><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682446628"><span class="hs-identifier hs-var">newPwd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span id="local-6989586621682446627"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446627"><span class="hs-identifier hs-var">prv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">XPrv -&gt; SharedKey depth XPrv
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; SharedKey depth XPrv) -&gt; XPrv -&gt; SharedKey depth XPrv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
-&gt; (PassphraseScheme, Passphrase &quot;user&quot;) -&gt; XPrv -&gt; XPrv
</span><a href="Cardano.Wallet.Primitive.Passphrase.html#changePassphraseXPrv"><span class="hs-identifier hs-var">changePassphraseXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682446629"><span class="hs-identifier hs-var">oldPwd</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseScheme, Passphrase &quot;user&quot;)
</span><a href="#local-6989586621682446628"><span class="hs-identifier hs-var">newPwd</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446627"><span class="hs-identifier hs-var">prv</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621682446626"><span class="annot"><span class="annottext">publicKey :: SharedKey depth XPrv -&gt; SharedKey depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#publicKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">publicKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span id="local-6989586621682446624"><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446624"><span class="hs-identifier hs-var">prv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">XPub -&gt; SharedKey depth XPub
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; XPrv -&gt; XPub
XPrv -&gt; XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">toXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv
</span><a href="#local-6989586621682446624"><span class="hs-identifier hs-var">prv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621682446623"><span class="annot"><span class="annottext">digest :: SharedKey depth XPub -&gt; Digest a
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#digest"><span class="hs-identifier hs-var hs-var hs-var hs-var">digest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span id="local-6989586621682446621"><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682446621"><span class="hs-identifier hs-var">pub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; Digest a
forall ba a.
(ByteArrayAccess ba, HashAlgorithm a) =&gt;
ba -&gt; Digest a
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPub</span></a></span><span> </span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682446621"><span class="hs-identifier hs-var">pub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621682446620"><span class="annot"><span class="annottext">getRawKey :: SharedKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#getRawKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">getRawKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">SharedKey depth raw -&gt; raw
forall (depth :: Depth) raw. SharedKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621682446617"><span class="annot"><span class="annottext">liftRawKey :: raw -&gt; SharedKey depth raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#liftRawKey"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftRawKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">raw -&gt; SharedKey depth raw
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621682446615"><span class="annot"><span class="annottext">keyTypeDescriptor :: Proxy SharedKey -&gt; String
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#keyTypeDescriptor"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyTypeDescriptor</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy SharedKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sha&quot;</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                         Relationship Key / Address
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#GetPurpose"><span class="hs-identifier hs-type">GetPurpose</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621682446611"><span class="annot"><span class="annottext">getPurpose :: Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDiscovery.html#getPurpose"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPurpose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#purposeCIP1854"><span class="hs-identifier hs-var">purposeCIP1854</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                          Storing and retrieving keys
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPrivateKey"><span class="hs-identifier hs-type">PersistPrivateKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#RootK"><span class="hs-identifier hs-type">RootK</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621682446606"><span class="annot"><span class="annottext">serializeXPrv :: (SharedKey 'RootK XPrv, PassphraseHash) -&gt; (ByteString, ByteString)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#serializeXPrv"><span class="hs-identifier hs-var hs-var hs-var hs-var">serializeXPrv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682446604"><span class="annot"><span class="annottext">SharedKey 'RootK XPrv
</span><a href="#local-6989586621682446604"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682446603"><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682446603"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (SharedKey 'RootK XPrv -&gt; ByteString)
-&gt; SharedKey 'RootK XPrv
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPrv</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; ByteString)
-&gt; (SharedKey 'RootK XPrv -&gt; XPrv)
-&gt; SharedKey 'RootK XPrv
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SharedKey 'RootK XPrv -&gt; XPrv
forall (depth :: Depth) raw. SharedKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">(SharedKey 'RootK XPrv -&gt; ByteString)
-&gt; SharedKey 'RootK XPrv -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SharedKey 'RootK XPrv
</span><a href="#local-6989586621682446604"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; ByteString)
-&gt; (PassphraseHash -&gt; ScrubbedBytes)
-&gt; PassphraseHash
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash -&gt; ScrubbedBytes
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#getPassphraseHash"><span class="hs-identifier hs-var hs-var">getPassphraseHash</span></a></span><span> </span><span class="annot"><span class="annottext">(PassphraseHash -&gt; ByteString) -&gt; PassphraseHash -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PassphraseHash
</span><a href="#local-6989586621682446603"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621682446600"><span class="annot"><span class="annottext">unsafeDeserializeXPrv :: (ByteString, ByteString) -&gt; (SharedKey 'RootK XPrv, PassphraseHash)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#unsafeDeserializeXPrv"><span class="hs-identifier hs-var hs-var hs-var hs-var">unsafeDeserializeXPrv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682446598"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682446598"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682446597"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682446597"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; (SharedKey 'RootK XPrv, PassphraseHash))
-&gt; ((SharedKey 'RootK XPrv, PassphraseHash)
    -&gt; (SharedKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (SharedKey 'RootK XPrv, PassphraseHash)
-&gt; (SharedKey 'RootK XPrv, PassphraseHash)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; (SharedKey 'RootK XPrv, PassphraseHash)
forall p a. p -&gt; a
</span><a href="#local-6989586621682446595"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(SharedKey 'RootK XPrv, PassphraseHash)
-&gt; (SharedKey 'RootK XPrv, PassphraseHash)
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String (SharedKey 'RootK XPrv, PassphraseHash)
 -&gt; (SharedKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (SharedKey 'RootK XPrv, PassphraseHash)
-&gt; (SharedKey 'RootK XPrv, PassphraseHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="annottext">(SharedKey 'RootK XPrv
 -&gt; PassphraseHash -&gt; (SharedKey 'RootK XPrv, PassphraseHash))
-&gt; Either String (SharedKey 'RootK XPrv)
-&gt; Either
     String (PassphraseHash -&gt; (SharedKey 'RootK XPrv, PassphraseHash))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; SharedKey 'RootK XPrv)
-&gt; Either String XPrv -&gt; Either String (SharedKey 'RootK XPrv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; SharedKey 'RootK XPrv
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPrv
</span><a href="#local-6989586621682446592"><span class="hs-identifier hs-var">xprvFromText</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682446598"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">Either
  String (PassphraseHash -&gt; (SharedKey 'RootK XPrv, PassphraseHash))
-&gt; Either String PassphraseHash
-&gt; Either String (SharedKey 'RootK XPrv, PassphraseHash)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; PassphraseHash)
-&gt; Either String ScrubbedBytes -&gt; Either String PassphraseHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; PassphraseHash
</span><a href="Cardano.Wallet.Primitive.Passphrase.Types.html#PassphraseHash"><span class="hs-identifier hs-var">PassphraseHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either String ScrubbedBytes
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682446597"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>        </span><span id="local-6989586621682446592"><span class="annot"><span class="annottext">xprvFromText :: ByteString -&gt; Either String XPrv
</span><a href="#local-6989586621682446592"><span class="hs-identifier hs-var hs-var">xprvFromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPrv
forall bin. ByteArrayAccess bin =&gt; bin -&gt; Either String XPrv
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">xprv</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String XPrv)
-&gt; (ByteString -&gt; Either String ByteString)
-&gt; ByteString
-&gt; Either String XPrv
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray ByteString =&gt; ByteString -&gt; Either String ByteString
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621682446595"><span class="annot"><span class="annottext">err :: p -&gt; a
</span><a href="#local-6989586621682446595"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeDeserializeXPrv: unable to deserialize SharedKey&quot;</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span id="local-6989586621682446589"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#PersistPublicKey"><span class="hs-identifier hs-type">PersistPublicKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682446589"><span class="hs-identifier hs-type">depth</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621682446585"><span class="annot"><span class="annottext">serializeXPub :: SharedKey depth XPub -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#serializeXPub"><span class="hs-identifier hs-var hs-var hs-var hs-var">serializeXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#hex"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (SharedKey depth XPub -&gt; ByteString)
-&gt; SharedKey depth XPub
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">unXPub</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ByteString)
-&gt; (SharedKey depth XPub -&gt; XPub)
-&gt; SharedKey depth XPub
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SharedKey depth XPub -&gt; XPub
forall (depth :: Depth) raw. SharedKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621682446583"><span class="annot"><span class="annottext">unsafeDeserializeXPub :: ByteString -&gt; SharedKey depth XPub
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#unsafeDeserializeXPub"><span class="hs-identifier hs-var hs-var hs-var hs-var">unsafeDeserializeXPub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; SharedKey depth XPub)
-&gt; (XPub -&gt; SharedKey depth XPub)
-&gt; Either String XPub
-&gt; SharedKey depth XPub
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SharedKey depth XPub
forall p a. p -&gt; a
</span><a href="#local-6989586621682446581"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; SharedKey depth XPub
forall (depth :: Depth) key. key -&gt; SharedKey depth key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-var">SharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String XPub -&gt; SharedKey depth XPub)
-&gt; (ByteString -&gt; Either String XPub)
-&gt; ByteString
-&gt; SharedKey depth XPub
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either String XPub
</span><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-var">xpub</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String XPub)
-&gt; (ByteString -&gt; Either String ByteString)
-&gt; ByteString
-&gt; Either String XPub
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray ByteString =&gt; ByteString -&gt; Either String ByteString
forall bout. ByteArray bout =&gt; ByteString -&gt; Either String bout
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#fromHex"><span class="hs-identifier hs-var">fromHex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621682446581"><span class="annot"><span class="annottext">err :: p -&gt; a
</span><a href="#local-6989586621682446581"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeDeserializeXPub: unable to deserialize SharedKey&quot;</span></span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621682446577"><span class="annot"><span class="annottext">paymentKeyFingerprint :: Address
-&gt; Either
     (ErrMkKeyFingerprint SharedKey Address)
     (KeyFingerprint &quot;payment&quot; SharedKey)
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#paymentKeyFingerprint"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentKeyFingerprint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span id="local-6989586621682446574"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682446574"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; SharedKey
-&gt; Either
     (ErrMkKeyFingerprint SharedKey Address)
     (KeyFingerprint &quot;payment&quot; SharedKey)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyFingerprint &quot;payment&quot; SharedKey
 -&gt; Either
      (ErrMkKeyFingerprint SharedKey Address)
      (KeyFingerprint &quot;payment&quot; SharedKey))
-&gt; KeyFingerprint &quot;payment&quot; SharedKey
-&gt; Either
     (ErrMkKeyFingerprint SharedKey Address)
     (KeyFingerprint &quot;payment&quot; SharedKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; KeyFingerprint &quot;payment&quot; SharedKey
forall k (s :: Symbol) (key :: k).
ByteString -&gt; KeyFingerprint s key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-var">KeyFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; KeyFingerprint &quot;payment&quot; SharedKey)
-&gt; ByteString -&gt; KeyFingerprint &quot;payment&quot; SharedKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#hashSize"><span class="hs-identifier hs-var">hashSize</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682446574"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621682446569"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#MkKeyFingerprint"><span class="hs-identifier hs-type">MkKeyFingerprint</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682446569"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#NetworkDiscriminant"><span class="hs-identifier hs-type">NetworkDiscriminant</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#AddressK"><span class="hs-identifier hs-type">AddressK</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-crypto/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621682446566"><span class="annot"><span class="annottext">paymentKeyFingerprint :: (Proxy n, SharedKey 'AddressK XPub)
-&gt; Either
     (ErrMkKeyFingerprint SharedKey (Proxy n, SharedKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; SharedKey)
</span><a href="#local-6989586621682446566"><span class="hs-identifier hs-var hs-var hs-var hs-var">paymentKeyFingerprint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682446565"><span class="annot"><span class="annottext">SharedKey 'AddressK XPub
</span><a href="#local-6989586621682446565"><span class="hs-identifier hs-var">paymentK</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><span class="annottext">KeyFingerprint &quot;payment&quot; SharedKey
-&gt; Either
     (ErrMkKeyFingerprint SharedKey (Proxy n, SharedKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; SharedKey)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyFingerprint &quot;payment&quot; SharedKey
 -&gt; Either
      (ErrMkKeyFingerprint SharedKey (Proxy n, SharedKey 'AddressK XPub))
      (KeyFingerprint &quot;payment&quot; SharedKey))
-&gt; KeyFingerprint &quot;payment&quot; SharedKey
-&gt; Either
     (ErrMkKeyFingerprint SharedKey (Proxy n, SharedKey 'AddressK XPub))
     (KeyFingerprint &quot;payment&quot; SharedKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; KeyFingerprint &quot;payment&quot; SharedKey
forall k (s :: Symbol) (key :: k).
ByteString -&gt; KeyFingerprint s key
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#KeyFingerprint"><span class="hs-identifier hs-var">KeyFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; KeyFingerprint &quot;payment&quot; SharedKey)
-&gt; ByteString -&gt; KeyFingerprint &quot;payment&quot; SharedKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall bin. ByteArrayAccess bin =&gt; bin -&gt; ByteString
</span><a href="Crypto.Hash.Utils.html#blake2b224"><span class="hs-identifier hs-var">blake2b224</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; ByteString
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">xpubPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; ByteString) -&gt; XPub -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SharedKey 'AddressK XPub -&gt; XPub
forall (depth :: Depth) raw. SharedKey depth raw -&gt; raw
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#getKey"><span class="hs-identifier hs-var hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">SharedKey 'AddressK XPub
</span><a href="#local-6989586621682446565"><span class="hs-identifier hs-var">paymentK</span></a></span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.html#BoundedAddressLength"><span class="hs-identifier hs-type">BoundedAddressLength</span></a></span><span> </span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.SharedKey.html#SharedKey"><span class="hs-identifier hs-type">SharedKey</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621682446562"><span class="annot"><span class="annottext">maxLengthAddressFor :: Proxy SharedKey -&gt; Address
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.html#maxLengthAddressFor"><span class="hs-identifier hs-var hs-var hs-var hs-var">maxLengthAddressFor</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy SharedKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Address
</span><a href="Cardano.Wallet.Primitive.Types.Address.html#Address"><span class="hs-identifier hs-var">Address</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Address) -&gt; ByteString -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8 -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS.replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">57</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">{-------------------------------------------------------------------------------
                                 Internals
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#hashSize"><span class="hs-identifier hs-type">hashSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-196"></span><span id="hashSize"><span class="annot"><span class="annottext">hashSize :: Int
</span><a href="Cardano.Wallet.Primitive.AddressDerivation.Shared.html#hashSize"><span class="hs-identifier hs-var hs-var">hashSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blake2b_224 -&gt; Int
forall a. HashAlgorithm a =&gt; a -&gt; Int
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">hashDigestSize</span></a></span><span> </span><span class="annot"><span class="annottext">Blake2b_224
</span><a href="../../../../cryptonite/html/src"><span class="hs-identifier hs-var">Blake2b_224</span></a></span><span>
</span><span id="line-197"></span></pre></body></html>