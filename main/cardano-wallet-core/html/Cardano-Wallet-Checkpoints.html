<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Cardano.Wallet.Checkpoints</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">cardano-wallet-core-2022.7.1: The Wallet Backend for a Cardano node.</span><ul class="links" id="page-menu"><li><a href="src/Cardano.Wallet.Checkpoints.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>&#169; 2021 IOHK</td></tr><tr><th>License</th><td>Apache-2.0</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Wallet.Checkpoints</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Checkpoints</a></li><li><a href="#g:2">Delta types</a></li><li><a href="#g:3">Checkpoint hygiene</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Data type that represents a collection of checkpoints.
 Each checkpoints is associated with a <code>Slot</code>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Checkpoints">Checkpoints</a> a</li><li class="src short"><a href="#v:checkpoints">checkpoints</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Map" title="Distribution.Compat.Prelude.Internal">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> a</li><li class="src short"><a href="#v:loadCheckpoints">loadCheckpoints</a> :: [(<a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a>, a)] -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a</li><li class="src short"><a href="#v:fromGenesis">fromGenesis</a> :: a -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a</li><li class="src short"><a href="#v:getLatest">getLatest</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; (<a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a>, a)</li><li class="src short"><a href="#v:findNearestPoint">findNearestPoint</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Maybe" title="Distribution.Compat.Prelude.Internal">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:DeltaCheckpoints">DeltaCheckpoints</a> a<ul class="subs"><li>= <a href="#v:PutCheckpoint">PutCheckpoint</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> a</li><li>| <a href="#v:RollbackTo">RollbackTo</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a></li><li>| <a href="#v:RestrictTo">RestrictTo</a> [<a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a>]</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:DeltasCheckpoints">DeltasCheckpoints</a> a = [<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a]</li><li class="src short"><span class="keyword">data</span> <a href="#t:SparseCheckpointsConfig">SparseCheckpointsConfig</a> = <a href="#v:SparseCheckpointsConfig">SparseCheckpointsConfig</a> {<ul class="subs"><li><a href="#v:edgeSize">edgeSize</a> :: <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word8" title="Distribution.Compat.Prelude.Internal">Word8</a></li><li><a href="#v:epochStability">epochStability</a> :: <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a></li></ul>}</li><li class="src short"><a href="#v:defaultSparseCheckpointsConfig">defaultSparseCheckpointsConfig</a> :: <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a> -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a></li><li class="src short"><a href="#v:sparseCheckpoints">sparseCheckpoints</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a> -&gt; <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a> -&gt; [<a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a>]</li><li class="src short"><a href="#v:gapSize">gapSize</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a> -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Checkpoints</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Checkpoints" class="def">Checkpoints</a> a <a href="src/Cardano.Wallet.Checkpoints.html#Checkpoints" class="link">Source</a> <a href="#t:Checkpoints" class="selflink">#</a></p><div class="doc"><p>Collection of checkpoints indexed by <code>Slot</code>.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Checkpoints">Instances</h4><details id="i:Checkpoints" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Checkpoints:Eq:1"></span> <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Eq" title="Distribution.Compat.Prelude.Internal">Eq</a> a =&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Eq" title="Distribution.Compat.Prelude.Internal">Eq</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-97" class="link">Source</a> <a href="#t:Checkpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Checkpoints:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Bool" title="Distribution.Compat.Prelude.Internal">Bool</a> <a href="../../ghc/html/libraries/ghc-prim-0.6.1/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Bool" title="Distribution.Compat.Prelude.Internal">Bool</a> <a href="../../ghc/html/libraries/ghc-prim-0.6.1/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Checkpoints:Show:2"></span> <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Show" title="Distribution.Compat.Prelude.Internal">Show</a> a =&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Show" title="Distribution.Compat.Prelude.Internal">Show</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-97" class="link">Source</a> <a href="#t:Checkpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Checkpoints:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Int" title="Distribution.Compat.Prelude.Internal">Int</a> -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:ShowS" title="Distribution.Compat.Prelude.Internal">ShowS</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:String" title="Distribution.Compat.Prelude.Internal">String</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a] -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:ShowS" title="Distribution.Compat.Prelude.Internal">ShowS</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Checkpoints:Generic:3"></span> <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Generic" title="Distribution.Compat.Prelude.Internal">Generic</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-97" class="link">Source</a> <a href="#t:Checkpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Checkpoints:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a) :: <a href="../../ghc/html/libraries/base-4.14.3.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a) x <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a) x -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Checkpoints:Rep:4"></span> <span class="keyword">type</span> <a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-97" class="link">Source</a> <a href="#t:Checkpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Checkpoints:Rep:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="src"><span class="keyword">type</span> <a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> (<a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a) = <a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> ('<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;Checkpoints&quot; &quot;Cardano.Wallet.Checkpoints&quot; &quot;cardano-wallet-core-2022.7.1-KAKkMGOljPka4gkPnYOdj&quot; '<a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#v:True" title="Distribution.Compat.Prelude.Internal">True</a>) (<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> ('<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;Checkpoints&quot; '<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> '<a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#v:True" title="Distribution.Compat.Prelude.Internal">True</a>) (<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#v:Just" title="Distribution.Compat.Prelude.Internal">Just</a> &quot;checkpoints&quot;) '<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> '<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../../ghc/html/libraries/base-4.14.3.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> (<a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Map" title="Distribution.Compat.Prelude.Internal">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> a))))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:checkpoints" class="def">checkpoints</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Map" title="Distribution.Compat.Prelude.Internal">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> a <a href="src/Cardano.Wallet.Checkpoints.html#checkpoints" class="link">Source</a> <a href="#v:checkpoints" class="selflink">#</a></p><div class="doc"><p>Map of checkpoints. Always contains the genesis checkpoint.</p></div></div><div class="top"><p class="src"><a id="v:loadCheckpoints" class="def">loadCheckpoints</a> :: [(<a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a>, a)] -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a <a href="src/Cardano.Wallet.Checkpoints.html#loadCheckpoints" class="link">Source</a> <a href="#v:loadCheckpoints" class="selflink">#</a></p><div class="doc"><p>Turn the list of checkpoints into a map of checkpoints.</p><p>FIXME LATER during ADP-1043:
   The database actually does not store the checkpoint at genesis,
   but the checkpoint after that.
   Hence, this function does not check whether the genesis checkpoint
   is in the list of checkpoints.</p></div></div><div class="top"><p class="src"><a id="v:fromGenesis" class="def">fromGenesis</a> :: a -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a <a href="src/Cardano.Wallet.Checkpoints.html#fromGenesis" class="link">Source</a> <a href="#v:fromGenesis" class="selflink">#</a></p><div class="doc"><p>Begin with the genesis checkpoint.</p></div></div><div class="top"><p class="src"><a id="v:getLatest" class="def">getLatest</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; (<a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a>, a) <a href="src/Cardano.Wallet.Checkpoints.html#getLatest" class="link">Source</a> <a href="#v:getLatest" class="selflink">#</a></p><div class="doc"><p>Get the checkpoint with the largest <code>SlotNo</code>.</p></div></div><div class="top"><p class="src"><a id="v:findNearestPoint" class="def">findNearestPoint</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a -&gt; <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Maybe" title="Distribution.Compat.Prelude.Internal">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> <a href="src/Cardano.Wallet.Checkpoints.html#findNearestPoint" class="link">Source</a> <a href="#v:findNearestPoint" class="selflink">#</a></p><div class="doc"><p>Find the nearest <code>Checkpoint</code> that is either at the given point or before.</p></div></div><a href="#g:2" id="g:2"><h1>Delta types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DeltaCheckpoints" class="def">DeltaCheckpoints</a> a <a href="src/Cardano.Wallet.Checkpoints.html#DeltaCheckpoints" class="link">Source</a> <a href="#t:DeltaCheckpoints" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:PutCheckpoint" class="def">PutCheckpoint</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:RollbackTo" class="def">RollbackTo</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:RestrictTo" class="def">RestrictTo</a> [<a href="Cardano-Wallet-Primitive-Types.html#t:Slot" title="Cardano.Wallet.Primitive.Types">Slot</a>]</td><td class="doc"><p>Restrict to the intersection of this list with
 the checkpoints that are already present.
 The genesis checkpoint will always be present.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:DeltaCheckpoints">Instances</h4><details id="i:DeltaCheckpoints" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DeltaCheckpoints:Buildable:1"></span> <a href="../../fmt/html/Fmt.html#t:Buildable" title="Fmt">Buildable</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-147" class="link">Source</a> <a href="#t:DeltaCheckpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DeltaCheckpoints:Buildable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:build">build</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a -&gt; <a href="../../fmt/html/Fmt.html#t:Builder" title="Fmt">Builder</a> <a href="../../formatting/html/src" class="link">Source</a> <a href="#v:build" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DeltaCheckpoints:Delta:2"></span> <a href="../../dbvar/html/Data-Delta.html#t:Delta" title="Data.Delta">Delta</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-139" class="link">Source</a> <a href="#t:DeltaCheckpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DeltaCheckpoints:Delta:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../../dbvar/html/Data-Delta.html#t:Base" title="Data.Delta">Base</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a) <a href="../../dbvar/html/src" class="link">Source</a> <a href="#t:Base" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:apply">apply</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a -&gt; <a href="../../dbvar/html/Data-Delta.html#t:Base" title="Data.Delta">Base</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a) -&gt; <a href="../../dbvar/html/Data-Delta.html#t:Base" title="Data.Delta">Base</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a) <a href="../../dbvar/html/src" class="link">Source</a> <a href="#v:apply" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DeltaCheckpoints:Base:3"></span> <span class="keyword">type</span> <a href="../../dbvar/html/Data-Delta.html#t:Base" title="Data.Delta">Base</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a)</span> <a href="src/Cardano.Wallet.Checkpoints.html#line-140" class="link">Source</a> <a href="#t:DeltaCheckpoints" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DeltaCheckpoints:Base:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="src"><span class="keyword">type</span> <a href="../../dbvar/html/Data-Delta.html#t:Base" title="Data.Delta">Base</a> (<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a) = <a href="Cardano-Wallet-Checkpoints.html#t:Checkpoints" title="Cardano.Wallet.Checkpoints">Checkpoints</a> a</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:DeltasCheckpoints" class="def">DeltasCheckpoints</a> a = [<a href="Cardano-Wallet-Checkpoints.html#t:DeltaCheckpoints" title="Cardano.Wallet.Checkpoints">DeltaCheckpoints</a> a] <a href="src/Cardano.Wallet.Checkpoints.html#DeltasCheckpoints" class="link">Source</a> <a href="#t:DeltasCheckpoints" class="selflink">#</a></p></div><a href="#g:3" id="g:3"><h1>Checkpoint hygiene</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SparseCheckpointsConfig" class="def">SparseCheckpointsConfig</a> <a href="src/Cardano.Wallet.Checkpoints.html#SparseCheckpointsConfig" class="link">Source</a> <a href="#t:SparseCheckpointsConfig" class="selflink">#</a></p><div class="doc"><p>Captures the configuration for the <code><a href="Cardano-Wallet-Checkpoints.html#v:sparseCheckpoints" title="Cardano.Wallet.Checkpoints">sparseCheckpoints</a></code> function.</p><p>NOTE: large values of <code><a href="Cardano-Wallet-Checkpoints.html#v:edgeSize" title="Cardano.Wallet.Checkpoints">edgeSize</a></code> aren't recommended as they would mean
 storing many unnecessary checkpoints. In Ouroboros Praos, there's a
 reasonable probability for small forks each a few blocks deep so it makes sense to
 maintain a small part that is denser near the edge.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SparseCheckpointsConfig" class="def">SparseCheckpointsConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:edgeSize" class="def">edgeSize</a> :: <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word8" title="Distribution.Compat.Prelude.Internal">Word8</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:epochStability" class="def">epochStability</a> :: <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SparseCheckpointsConfig">Instances</h4><details id="i:SparseCheckpointsConfig" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SparseCheckpointsConfig:Show:1"></span> <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Show" title="Distribution.Compat.Prelude.Internal">Show</a> <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a></span> <a href="src/Cardano.Wallet.Checkpoints.html#line-239" class="link">Source</a> <a href="#t:SparseCheckpointsConfig" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SparseCheckpointsConfig:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Checkpoints.html">Cardano.Wallet.Checkpoints</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Int" title="Distribution.Compat.Prelude.Internal">Int</a> -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a> -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:ShowS" title="Distribution.Compat.Prelude.Internal">ShowS</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a> -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:String" title="Distribution.Compat.Prelude.Internal">String</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a>] -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:ShowS" title="Distribution.Compat.Prelude.Internal">ShowS</a> <a href="../../ghc/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:defaultSparseCheckpointsConfig" class="def">defaultSparseCheckpointsConfig</a> :: <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a> -&gt; <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a> <a href="src/Cardano.Wallet.Checkpoints.html#defaultSparseCheckpointsConfig" class="link">Source</a> <a href="#v:defaultSparseCheckpointsConfig" class="selflink">#</a></p><div class="doc"><p>A sensible default to use in production. See also <code><a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a></code></p></div></div><div class="top"><p class="src"><a id="v:sparseCheckpoints" class="def">sparseCheckpoints</a> <a href="src/Cardano.Wallet.Checkpoints.html#sparseCheckpoints" class="link">Source</a> <a href="#v:sparseCheckpoints" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a></td><td class="doc"><p>Parameters for the function.</p></td></tr><tr><td class="src">-&gt; <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a></td><td class="doc"><p>A given block height</p></td></tr><tr><td class="src">-&gt; [<a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a>]</td><td class="doc"><p>The list of checkpoint heights that should be kept in DB.</p></td></tr></table></div><div class="doc"><p>Storing EVERY checkpoints in the database is quite expensive and useless.
 We make the following assumptions:</p><ul><li>We can't rollback for more than `k=epochStability` blocks in the past</li><li>It is pretty fast to re-sync a few hundred blocks</li><li>Small rollbacks may occur more often than deep ones</li></ul><p>So, as we insert checkpoints, we make sure to:</p><ul><li>Prune any checkpoint that more than <code>k</code> blocks in the past</li><li>Keep only one checkpoint every 100 blocks</li><li>But still keep ~10 most recent checkpoints to cope with small rollbacks</li></ul><p><strong>Example 1</strong>: Inserting <code>cp153</code></p><p>&#8505;: <code>cp142</code> is discarded and <code>cp153</code> inserted.</p><pre> Currently in DB:
&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;  &#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
&#9474;cp000 &#9474;cp100 &#9474;cp142 &#9474;..    ..&#9474;cp152 &#9474;
&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;  &#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
 Want in DB:
&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;  &#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
&#9474;cp000 &#9474;cp100 &#9474;cp143 &#9474;..    ..&#9474;cp153 &#9474;
&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;  &#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
 </pre><p><strong>Example 2</strong>: Inserting <code>cp111</code></p><p>&#8505;: <code>cp100</code> is kept and <code>cp111</code> inserted.</p><pre> Currently in DB:
&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;  &#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
&#9474;cp000 &#9474;cp100 &#9474;cp101 &#9474;..    ..&#9474;cp110 &#9474;
&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;  &#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
 Want in DB:
&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;  &#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
&#9474;cp000 &#9474;cp100 &#9474;cp101 &#9474;..    ..&#9474;cp111 &#9474;
&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;  &#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
 </pre><p>NOTE: There might be cases where the chain following &quot;fails&quot; (because, for
 example, the node has switched to a different chain, different by more than k),
 and in such cases, we have no choice but rolling back from genesis.
 Therefore, we need to keep the very first checkpoint in the database, no
 matter what.</p></div></div><div class="top"><p class="src"><a id="v:gapSize" class="def">gapSize</a> :: <a href="Cardano-Wallet-Checkpoints.html#t:SparseCheckpointsConfig" title="Cardano.Wallet.Checkpoints">SparseCheckpointsConfig</a> -&gt; <a href="../../Cabal/html/Distribution-Compat-Prelude-Internal.html#t:Word32" title="Distribution.Compat.Prelude.Internal">Word32</a> <a href="src/Cardano.Wallet.Checkpoints.html#gapSize" class="link">Source</a> <a href="#v:gapSize" class="selflink">#</a></p><div class="doc"><p>A reasonable gap size used internally in <code><a href="Cardano-Wallet-Checkpoints.html#v:sparseCheckpoints" title="Cardano.Wallet.Checkpoints">sparseCheckpoints</a></code>.</p><p><code>Reasonable</code> means that it's not _too frequent_ and it's not too large. A
 value that is too small in front of k would require generating much more
 checkpoints than necessary.</p><p>A value that is larger than <code>k</code> may have dramatic consequences in case of
 deep rollbacks.</p><p>As a middle ground, we current choose `k / 3`, which is justified by:</p><ul><li>The current speed of the network layer (several thousands blocks per seconds)</li><li>The current value of k = 2160</li></ul><p>So, `k / 3` = 720, which should remain around a second of time needed to catch
 up in case of large rollbacks.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>