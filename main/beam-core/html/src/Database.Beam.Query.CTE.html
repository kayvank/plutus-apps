<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Beam.Query.CTE</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Beam.Backend.SQL.html"><span class="hs-identifier">Database.Beam.Backend.SQL</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html"><span class="hs-identifier">Database.Beam.Query.Internal</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Beam.Query.Types.html"><span class="hs-identifier">Database.Beam.Query.Types</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../free/html/src"><span class="hs-identifier">Control.Monad.Free.Church</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Writer</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.State.Strict</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.String</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">data</span><span> </span><span id="Recursiveness"><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursiveness"><span class="hs-identifier hs-var">Recursiveness</span></a></span></span><span> </span><span id="local-6989586621679470514"><span class="annot"><a href="#local-6989586621679470514"><span class="hs-identifier hs-type">be</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>    </span><span id="local-6989586621679470513"><span id="Nonrecursive"><span class="annot"><a href="Database.Beam.Query.CTE.html#Nonrecursive"><span class="hs-identifier hs-var">Nonrecursive</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursiveness"><span class="hs-identifier hs-type">Recursiveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470513"><span class="hs-identifier hs-type">be</span></a></span></span><span>
</span><span id="line-22"></span><span>    </span><span id="local-6989586621679470678"><span id="Recursive"><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Beam.Backend.SQL.SQL99.html#IsSql99RecursiveCommonTableExpressionSelectSyntax"><span class="hs-identifier hs-type">IsSql99RecursiveCommonTableExpressionSelectSyntax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Backend.SQL.html#BeamSqlBackendSelectSyntax"><span class="hs-identifier hs-type">BeamSqlBackendSelectSyntax</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470678"><span class="hs-identifier hs-type">be</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursiveness"><span class="hs-identifier hs-type">Recursiveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470678"><span class="hs-identifier hs-type">be</span></a></span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span id="local-6989586621679470510"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679470505"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursiveness"><span class="hs-identifier hs-type">Recursiveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470510"><span class="hs-identifier hs-type">be</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>    </span><span id="local-6989586621679470503"><span class="annot"><span class="annottext">mempty :: Recursiveness be
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Recursiveness be
forall be. Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Nonrecursive"><span class="hs-identifier hs-var">Nonrecursive</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span id="local-6989586621679470502"><span class="annot"><span class="annottext">mappend :: Recursiveness be -&gt; Recursiveness be -&gt; Recursiveness be
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Recursiveness be -&gt; Recursiveness be -&gt; Recursiveness be
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span id="local-6989586621679470501"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679470496"><span id="local-6989586621679470498"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursiveness"><span class="hs-identifier hs-type">Recursiveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470501"><span class="hs-identifier hs-type">be</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="annottext">Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span> </span><span id="local-6989586621679470494"><span class="annot"><span class="annottext">&lt;&gt; :: Recursiveness be -&gt; Recursiveness be -&gt; Recursiveness be
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="annot"><span class="annottext">Recursiveness be
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Recursiveness be
forall be.
IsSql99RecursiveCommonTableExpressionSelectSyntax
  (BeamSqlBackendSelectSyntax be) =&gt;
Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="annottext">Recursiveness be
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Recursiveness be
forall be.
IsSql99RecursiveCommonTableExpressionSelectSyntax
  (BeamSqlBackendSelectSyntax be) =&gt;
Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><span class="annottext">Recursiveness be
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Recursiveness be
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Recursiveness be
forall be. Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Nonrecursive"><span class="hs-identifier hs-var">Nonrecursive</span></a></span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | Monad in which @SELECT@ statements can be made (via 'selecting')</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- and bound to result names for re-use later. This has the advantage</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- of only computing each result once. In SQL, this is translated to a</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- common table expression.</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- Once introduced, results can be re-used in future queries with 'reuse'.</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- 'With' is also a member of 'MonadFix' for backends that support</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- recursive CTEs. In this case, you can use @mdo@ or @rec@ notation</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- (with @RecursiveDo@ enabled) to bind result values (again, using</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- 'reuse') even /before/ they're introduced.</span><span>
</span><span id="line-45"></span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- See further documentation &lt;https://haskell-beam.github.io/beam/user-guide/queries/common-table-expressions/ here&gt;.</span><span>
</span><span id="line-47"></span><span class="hs-keyword">newtype</span><span> </span><span id="With"><span class="annot"><a href="Database.Beam.Query.CTE.html#With"><span class="hs-identifier hs-var">With</span></a></span></span><span> </span><span id="local-6989586621679470616"><span class="annot"><a href="#local-6989586621679470616"><span class="hs-identifier hs-type">be</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679470614"><span class="annot"><a href="#local-6989586621679470614"><span class="hs-identifier hs-type">db</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679470615"><span class="annot"><a href="#local-6989586621679470615"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="With"><span class="annot"><a href="Database.Beam.Query.CTE.html#With"><span class="hs-identifier hs-var">With</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="runWith"><span class="annot"><span class="annottext">With be db a
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
</span><a href="Database.Beam.Query.CTE.html#runWith"><span class="hs-identifier hs-var hs-var">runWith</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">WriterT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.CTE.html#Recursiveness"><span class="hs-identifier hs-type">Recursiveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470616"><span class="hs-identifier hs-type">be</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Database.Beam.Backend.SQL.html#BeamSql99BackendCTESyntax"><span class="hs-identifier hs-type">BeamSql99BackendCTESyntax</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470616"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679470615"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679470485"><span id="local-6989586621679470487"><span id="local-6989586621679470489"><span class="annot"><span class="annottext">Applicative (With be db)
a -&gt; With be db a
Applicative (With be db)
-&gt; (forall a b.
    With be db a -&gt; (a -&gt; With be db b) -&gt; With be db b)
-&gt; (forall a b. With be db a -&gt; With be db b -&gt; With be db b)
-&gt; (forall a. a -&gt; With be db a)
-&gt; Monad (With be db)
With be db a -&gt; (a -&gt; With be db b) -&gt; With be db b
With be db a -&gt; With be db b -&gt; With be db b
forall a. a -&gt; With be db a
forall a b. With be db a -&gt; With be db b -&gt; With be db b
forall a b. With be db a -&gt; (a -&gt; With be db b) -&gt; With be db b
forall be (db :: (* -&gt; *) -&gt; *). Applicative (With be db)
forall be (db :: (* -&gt; *) -&gt; *) a. a -&gt; With be db a
forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; With be db b -&gt; With be db b
forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; (a -&gt; With be db b) -&gt; With be db b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; With be db a
$creturn :: forall be (db :: (* -&gt; *) -&gt; *) a. a -&gt; With be db a
&gt;&gt; :: With be db a -&gt; With be db b -&gt; With be db b
$c&gt;&gt; :: forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; With be db b -&gt; With be db b
&gt;&gt;= :: With be db a -&gt; (a -&gt; With be db b) -&gt; With be db b
$c&gt;&gt;= :: forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; (a -&gt; With be db b) -&gt; With be db b
$cp1Monad :: forall be (db :: (* -&gt; *) -&gt; *). Applicative (With be db)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679470473"><span id="local-6989586621679470475"><span id="local-6989586621679470477"><span id="local-6989586621679470479"><span id="local-6989586621679470481"><span class="annot"><span class="annottext">Functor (With be db)
a -&gt; With be db a
Functor (With be db)
-&gt; (forall a. a -&gt; With be db a)
-&gt; (forall a b.
    With be db (a -&gt; b) -&gt; With be db a -&gt; With be db b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; With be db a -&gt; With be db b -&gt; With be db c)
-&gt; (forall a b. With be db a -&gt; With be db b -&gt; With be db b)
-&gt; (forall a b. With be db a -&gt; With be db b -&gt; With be db a)
-&gt; Applicative (With be db)
With be db a -&gt; With be db b -&gt; With be db b
With be db a -&gt; With be db b -&gt; With be db a
With be db (a -&gt; b) -&gt; With be db a -&gt; With be db b
(a -&gt; b -&gt; c) -&gt; With be db a -&gt; With be db b -&gt; With be db c
forall a. a -&gt; With be db a
forall a b. With be db a -&gt; With be db b -&gt; With be db a
forall a b. With be db a -&gt; With be db b -&gt; With be db b
forall a b. With be db (a -&gt; b) -&gt; With be db a -&gt; With be db b
forall a b c.
(a -&gt; b -&gt; c) -&gt; With be db a -&gt; With be db b -&gt; With be db c
forall be (db :: (* -&gt; *) -&gt; *). Functor (With be db)
forall be (db :: (* -&gt; *) -&gt; *) a. a -&gt; With be db a
forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; With be db b -&gt; With be db a
forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; With be db b -&gt; With be db b
forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db (a -&gt; b) -&gt; With be db a -&gt; With be db b
forall be (db :: (* -&gt; *) -&gt; *) a b c.
(a -&gt; b -&gt; c) -&gt; With be db a -&gt; With be db b -&gt; With be db c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: With be db a -&gt; With be db b -&gt; With be db a
$c&lt;* :: forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; With be db b -&gt; With be db a
*&gt; :: With be db a -&gt; With be db b -&gt; With be db b
$c*&gt; :: forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db a -&gt; With be db b -&gt; With be db b
liftA2 :: (a -&gt; b -&gt; c) -&gt; With be db a -&gt; With be db b -&gt; With be db c
$cliftA2 :: forall be (db :: (* -&gt; *) -&gt; *) a b c.
(a -&gt; b -&gt; c) -&gt; With be db a -&gt; With be db b -&gt; With be db c
&lt;*&gt; :: With be db (a -&gt; b) -&gt; With be db a -&gt; With be db b
$c&lt;*&gt; :: forall be (db :: (* -&gt; *) -&gt; *) a b.
With be db (a -&gt; b) -&gt; With be db a -&gt; With be db b
pure :: a -&gt; With be db a
$cpure :: forall be (db :: (* -&gt; *) -&gt; *) a. a -&gt; With be db a
$cp1Applicative :: forall be (db :: (* -&gt; *) -&gt; *). Functor (With be db)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679470468"><span id="local-6989586621679470470"><span class="annot"><span class="annottext">a -&gt; With be db b -&gt; With be db a
(a -&gt; b) -&gt; With be db a -&gt; With be db b
(forall a b. (a -&gt; b) -&gt; With be db a -&gt; With be db b)
-&gt; (forall a b. a -&gt; With be db b -&gt; With be db a)
-&gt; Functor (With be db)
forall a b. a -&gt; With be db b -&gt; With be db a
forall a b. (a -&gt; b) -&gt; With be db a -&gt; With be db b
forall be (db :: (* -&gt; *) -&gt; *) a b.
a -&gt; With be db b -&gt; With be db a
forall be (db :: (* -&gt; *) -&gt; *) a b.
(a -&gt; b) -&gt; With be db a -&gt; With be db b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; With be db b -&gt; With be db a
$c&lt;$ :: forall be (db :: (* -&gt; *) -&gt; *) a b.
a -&gt; With be db b -&gt; With be db a
fmap :: (a -&gt; b) -&gt; With be db a -&gt; With be db b
$cfmap :: forall be (db :: (* -&gt; *) -&gt; *) a b.
(a -&gt; b) -&gt; With be db a -&gt; With be db b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621679470465"><span id="local-6989586621679470466"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Database.Beam.Backend.SQL.SQL99.html#IsSql99RecursiveCommonTableExpressionSelectSyntax"><span class="hs-identifier hs-type">IsSql99RecursiveCommonTableExpressionSelectSyntax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Backend.SQL.html#BeamSqlBackendSelectSyntax"><span class="hs-identifier hs-type">BeamSqlBackendSelectSyntax</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470466"><span class="hs-identifier hs-type">be</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadFix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.CTE.html#With"><span class="hs-identifier hs-type">With</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470466"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470465"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621679470461"><span class="annot"><span class="annottext">mfix :: (a -&gt; With be db a) -&gt; With be db a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mfix</span></a></span></span><span> </span><span id="local-6989586621679470460"><span class="annot"><span class="annottext">a -&gt; With be db a
</span><a href="#local-6989586621679470460"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriterT
  (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
-&gt; With be db a
forall be (db :: (* -&gt; *) -&gt; *) a.
WriterT
  (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
-&gt; With be db a
</span><a href="Database.Beam.Query.CTE.html#With"><span class="hs-identifier hs-var">With</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Recursiveness be, [BeamSql99BackendCTESyntax be])
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Recursiveness be
forall be.
IsSql99RecursiveCommonTableExpressionSelectSyntax
  (BeamSqlBackendSelectSyntax be) =&gt;
Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BeamSql99BackendCTESyntax be]
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WriterT
  (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) ()
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(a
 -&gt; WriterT
      (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a)
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
forall (m :: * -&gt; *) a. MonadFix m =&gt; (a -&gt; m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mfix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">With be db a
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
forall be (db :: (* -&gt; *) -&gt; *) a.
With be db a
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
</span><a href="Database.Beam.Query.CTE.html#runWith"><span class="hs-identifier hs-var hs-var">runWith</span></a></span><span> </span><span class="annot"><span class="annottext">(With be db a
 -&gt; WriterT
      (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a)
-&gt; (a -&gt; With be db a)
-&gt; a
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; With be db a
</span><a href="#local-6989586621679470460"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">data</span><span> </span><span id="QAnyScope"><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-var">QAnyScope</span></a></span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Query results that have been introduced into a common table</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- expression via 'selecting' that can be used in future queries with</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- 'reuse'.</span><span>
</span><span id="line-61"></span><span class="hs-keyword">data</span><span> </span><span id="ReusableQ"><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-var">ReusableQ</span></a></span></span><span> </span><span id="local-6989586621679470457"><span class="annot"><a href="#local-6989586621679470457"><span class="hs-identifier hs-type">be</span></a></span></span><span> </span><span id="local-6989586621679470456"><span class="annot"><a href="#local-6989586621679470456"><span class="hs-identifier hs-type">db</span></a></span></span><span> </span><span id="local-6989586621679470455"><span class="annot"><a href="#local-6989586621679470455"><span class="hs-identifier hs-type">res</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621679470595"><span id="local-6989586621679470596"><span id="local-6989586621679470597"><span id="ReusableQ"><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-var">ReusableQ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470597"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679470601"><span class="annot"><a href="#local-6989586621679470601"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470601"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470596"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470595"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470601"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.Internal.html#WithRewrittenThread"><span class="hs-identifier hs-type">WithRewrittenThread</span></a></span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-type">QAnyScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470601"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470597"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-type">ReusableQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470596"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470595"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470597"><span class="hs-identifier hs-type">res</span></a></span></span></span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="annot"><a href="Database.Beam.Query.CTE.html#reusableForCTE"><span class="hs-identifier hs-type">reusableForCTE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679470521"><span class="annot"><a href="#local-6989586621679470521"><span class="hs-identifier hs-type">be</span></a></span></span><span> </span><span id="local-6989586621679470522"><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span></span><span> </span><span id="local-6989586621679470520"><span class="annot"><a href="#local-6989586621679470520"><span class="hs-identifier hs-type">db</span></a></span></span><span>
</span><span id="line-65"></span><span>                </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#ThreadRewritable"><span class="hs-identifier hs-type">ThreadRewritable</span></a></span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-type">QAnyScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-66"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#Projectible"><span class="hs-identifier hs-type">Projectible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470521"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-67"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Beam.Backend.SQL.html#BeamSqlBackend"><span class="hs-identifier hs-type">BeamSqlBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470521"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-type">ReusableQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470521"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470520"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-69"></span><span id="reusableForCTE"><span class="annot"><span class="annottext">reusableForCTE :: Text -&gt; ReusableQ be db res
</span><a href="Database.Beam.Query.CTE.html#reusableForCTE"><span class="hs-identifier hs-var hs-var">reusableForCTE</span></a></span></span><span> </span><span id="local-6989586621679470452"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470452"><span class="hs-identifier hs-var">tblNm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">Proxy res
-&gt; (forall s.
    Proxy s -&gt; Q be db s (WithRewrittenThread QAnyScope s res))
-&gt; ReusableQ be db res
forall res be (db :: (* -&gt; *) -&gt; *).
Proxy res
-&gt; (forall s.
    Proxy s -&gt; Q be db s (WithRewrittenThread QAnyScope s res))
-&gt; ReusableQ be db res
</span><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-var">ReusableQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy res
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679470451"><span class="annot"><span class="annottext">Proxy s
</span><a href="#local-6989586621679470451"><span class="hs-identifier hs-var">proxyS</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>                 </span><span class="annot"><span class="annottext">QM be db s (WithRewrittenThread QAnyScope s res)
-&gt; Q be db s (WithRewrittenThread QAnyScope s res)
forall be (db :: (* -&gt; *) -&gt; *) s a. QM be db s a -&gt; Q be db s a
</span><a href="Database.Beam.Query.Internal.html#Q"><span class="hs-identifier hs-var">Q</span></a></span><span> </span><span class="annot"><span class="annottext">(QM be db s (WithRewrittenThread QAnyScope s res)
 -&gt; Q be db s (WithRewrittenThread QAnyScope s res))
-&gt; QM be db s (WithRewrittenThread QAnyScope s res)
-&gt; Q be db s (WithRewrittenThread QAnyScope s res)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">QF be db s (WithRewrittenThread QAnyScope s res)
-&gt; QM be db s (WithRewrittenThread QAnyScope s res)
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Functor f, MonadFree f m) =&gt;
f a -&gt; m a
</span><a href="../../../../free/html/src"><span class="hs-identifier hs-var">liftF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text -&gt; BeamSqlBackendFromSyntax be)
-&gt; (Text -&gt; res)
-&gt; (res
    -&gt; Maybe (WithExprContext (BeamSqlBackendExpressionSyntax be)))
-&gt; ((Text, res) -&gt; WithRewrittenThread QAnyScope s res)
-&gt; QF be db s (WithRewrittenThread QAnyScope s res)
forall be r next (db :: (* -&gt; *) -&gt; *) s.
Projectible be r =&gt;
(Text -&gt; Text -&gt; BeamSqlBackendFromSyntax be)
-&gt; (Text -&gt; r)
-&gt; (r
    -&gt; Maybe (WithExprContext (BeamSqlBackendExpressionSyntax be)))
-&gt; ((Text, r) -&gt; next)
-&gt; QF be db s next
</span><a href="Database.Beam.Query.Internal.html#QAll"><span class="hs-identifier hs-var">QAll</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sql92FromTableSourceSyntax (BeamSqlBackendFromSyntax be)
-&gt; Maybe (Text, Maybe [Text]) -&gt; BeamSqlBackendFromSyntax be
forall from.
IsSql92FromSyntax from =&gt;
Sql92FromTableSourceSyntax from
-&gt; Maybe (Text, Maybe [Text]) -&gt; from
</span><a href="Database.Beam.Backend.SQL.SQL92.html#fromTable"><span class="hs-identifier hs-var">fromTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sql92TableSourceTableNameSyntax
  (Sql92FromTableSourceSyntax (BeamSqlBackendFromSyntax be))
-&gt; Sql92FromTableSourceSyntax (BeamSqlBackendFromSyntax be)
forall tblSource.
IsSql92TableSourceSyntax tblSource =&gt;
Sql92TableSourceTableNameSyntax tblSource -&gt; tblSource
</span><a href="Database.Beam.Backend.SQL.SQL92.html#tableNamed"><span class="hs-identifier hs-var">tableNamed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text
-&gt; Text
-&gt; Sql92TableSourceTableNameSyntax
     (Sql92FromTableSourceSyntax (BeamSqlBackendFromSyntax be))
forall tblName.
IsSql92TableNameSyntax tblName =&gt;
Maybe Text -&gt; Text -&gt; tblName
</span><a href="Database.Beam.Backend.SQL.SQL92.html#tableName"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470452"><span class="hs-identifier hs-var">tblNm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Text, Maybe [Text]) -&gt; BeamSqlBackendFromSyntax be)
-&gt; (Text -&gt; Maybe (Text, Maybe [Text]))
-&gt; Text
-&gt; BeamSqlBackendFromSyntax be
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Text, Maybe [Text]) -&gt; Maybe (Text, Maybe [Text])
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Text, Maybe [Text]) -&gt; Maybe (Text, Maybe [Text]))
-&gt; (Text -&gt; (Text, Maybe [Text]))
-&gt; Text
-&gt; Maybe (Text, Maybe [Text])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>                                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679470444"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470444"><span class="hs-identifier hs-var">tblNm'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(res, [Text]) -&gt; res
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((res, [Text]) -&gt; res) -&gt; (res, [Text]) -&gt; res
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; BeamSqlBackendFieldNameSyntax be) -&gt; (res, [Text])
forall be res.
(BeamSqlBackend be, Projectible be res) =&gt;
(Text -&gt; BeamSqlBackendFieldNameSyntax be) -&gt; (res, [Text])
</span><a href="Database.Beam.Query.Internal.html#mkFieldNames"><span class="hs-identifier hs-var">mkFieldNames</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679470521"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
-&gt; Text
-&gt; Sql92ExpressionFieldNameSyntax
     (Sql92InsertValuesExpressionSyntax
        (Sql92InsertValuesSyntax
           (Sql92InsertSyntax (BeamSqlBackendSyntax be))))
forall fn. IsSql92FieldNameSyntax fn =&gt; Text -&gt; Text -&gt; fn
</span><a href="Database.Beam.Backend.SQL.SQL92.html#qualifiedField"><span class="hs-identifier hs-var">qualifiedField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470444"><span class="hs-identifier hs-var">tblNm'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>                                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">res
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (WithExprContext (BeamSqlBackendExpressionSyntax be))
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy s -&gt; res -&gt; WithRewrittenThread QAnyScope s res
forall s a s'.
ThreadRewritable s a =&gt;
Proxy s' -&gt; a -&gt; WithRewrittenThread s s' a
</span><a href="Database.Beam.Query.Internal.html#rewriteThread"><span class="hs-identifier hs-var">rewriteThread</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-type">QAnyScope</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679470522"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy s
</span><a href="#local-6989586621679470451"><span class="hs-identifier hs-var">proxyS</span></a></span><span> </span><span class="annot"><span class="annottext">(res -&gt; WithRewrittenThread QAnyScope s res)
-&gt; ((Text, res) -&gt; res)
-&gt; (Text, res)
-&gt; WithRewrittenThread QAnyScope s res
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Text, res) -&gt; res
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Introduce the result of a query as a result in a common table</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- expression. The returned value can be used in future queries by</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- applying 'reuse'.</span><span>
</span><span id="line-80"></span><span class="annot"><a href="Database.Beam.Query.CTE.html#selecting"><span class="hs-identifier hs-type">selecting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679470439"><span class="annot"><a href="#local-6989586621679470439"><span class="hs-identifier hs-type">res</span></a></span></span><span> </span><span id="local-6989586621679470438"><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span></span><span> </span><span id="local-6989586621679470437"><span class="annot"><a href="#local-6989586621679470437"><span class="hs-identifier hs-type">db</span></a></span></span><span>
</span><span id="line-81"></span><span>           </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Beam.Backend.SQL.html#BeamSql99CommonTableExpressionBackend"><span class="hs-identifier hs-type">BeamSql99CommonTableExpressionBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Beam.Query.Types.html#HasQBuilder"><span class="hs-identifier hs-type">HasQBuilder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span>
</span><span id="line-82"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#Projectible"><span class="hs-identifier hs-type">Projectible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470439"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-83"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#ThreadRewritable"><span class="hs-identifier hs-type">ThreadRewritable</span></a></span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-type">QAnyScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470439"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470437"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-type">QAnyScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470439"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#With"><span class="hs-identifier hs-type">With</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470437"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-type">ReusableQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470437"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470439"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="selecting"><span class="annot"><span class="annottext">selecting :: Q be db QAnyScope res -&gt; With be db (ReusableQ be db res)
</span><a href="Database.Beam.Query.CTE.html#selecting"><span class="hs-identifier hs-var hs-var">selecting</span></a></span></span><span> </span><span id="local-6989586621679470435"><span class="annot"><span class="annottext">Q be db QAnyScope res
</span><a href="#local-6989586621679470435"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">WriterT
  (Recursiveness be, [BeamSql99BackendCTESyntax be])
  (State Int)
  (ReusableQ be db res)
-&gt; With be db (ReusableQ be db res)
forall be (db :: (* -&gt; *) -&gt; *) a.
WriterT
  (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) a
-&gt; With be db a
</span><a href="Database.Beam.Query.CTE.html#With"><span class="hs-identifier hs-var">With</span></a></span><span> </span><span class="annot"><span class="annottext">(WriterT
   (Recursiveness be, [BeamSql99BackendCTESyntax be])
   (State Int)
   (ReusableQ be db res)
 -&gt; With be db (ReusableQ be db res))
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be])
     (State Int)
     (ReusableQ be db res)
-&gt; With be db (ReusableQ be db res)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679470434"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679470434"><span class="hs-identifier hs-var">cteId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WriterT
  (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) Int
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679470434"><span class="hs-identifier hs-var">cteId</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679470430"><span class="annot"><span class="annottext">tblNm :: Text
</span><a href="#local-6989586621679470430"><span class="hs-identifier hs-var hs-var">tblNm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
forall a. IsString a =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cte&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679470434"><span class="hs-identifier hs-var">cteId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">res
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679470439"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679470428"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679470428"><span class="hs-identifier hs-var">fieldNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; BeamSqlBackendFieldNameSyntax be) -&gt; (res, [Text])
forall be res.
(BeamSqlBackend be, Projectible be res) =&gt;
(Text -&gt; BeamSqlBackendFieldNameSyntax be) -&gt; (res, [Text])
</span><a href="Database.Beam.Query.Internal.html#mkFieldNames"><span class="hs-identifier hs-var">mkFieldNames</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679470438"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
-&gt; Text
-&gt; Sql92ExpressionFieldNameSyntax
     (Sql92InsertValuesExpressionSyntax
        (Sql92InsertValuesSyntax
           (Sql92InsertSyntax (BeamSqlBackendSyntax be))))
forall fn. IsSql92FieldNameSyntax fn =&gt; Text -&gt; Text -&gt; fn
</span><a href="Database.Beam.Backend.SQL.SQL92.html#qualifiedField"><span class="hs-identifier hs-var">qualifiedField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470430"><span class="hs-identifier hs-var">tblNm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">(Recursiveness be, [BeamSql99BackendCTESyntax be])
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be]) (State Int) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Recursiveness be
forall be. Recursiveness be
</span><a href="Database.Beam.Query.CTE.html#Nonrecursive"><span class="hs-identifier hs-var">Nonrecursive</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; [Text]
-&gt; Sql99CTESelectSyntax (BeamSql99BackendCTESyntax be)
-&gt; BeamSql99BackendCTESyntax be
forall syntax.
IsSql99CommonTableExpressionSyntax syntax =&gt;
Text -&gt; [Text] -&gt; Sql99CTESelectSyntax syntax -&gt; syntax
</span><a href="Database.Beam.Backend.SQL.SQL99.html#cteSubquerySyntax"><span class="hs-identifier hs-var">cteSubquerySyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470430"><span class="hs-identifier hs-var">tblNm</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679470428"><span class="hs-identifier hs-var">fieldNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Q be db QAnyScope res -&gt; BeamSqlBackendSelectSyntax be
forall be a (db :: (* -&gt; *) -&gt; *) s.
(HasQBuilder be, Projectible be a) =&gt;
Text -&gt; Q be db s a -&gt; BeamSqlBackendSelectSyntax be
</span><a href="Database.Beam.Query.Types.html#buildSqlQuery"><span class="hs-identifier hs-var">buildSqlQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470430"><span class="hs-identifier hs-var">tblNm</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Q be db QAnyScope res
</span><a href="#local-6989586621679470435"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">ReusableQ be db res
-&gt; WriterT
     (Recursiveness be, [BeamSql99BackendCTESyntax be])
     (State Int)
     (ReusableQ be db res)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ReusableQ be db res
forall be res (db :: (* -&gt; *) -&gt; *).
(ThreadRewritable QAnyScope res, Projectible be res,
 BeamSqlBackend be) =&gt;
Text -&gt; ReusableQ be db res
</span><a href="Database.Beam.Query.CTE.html#reusableForCTE"><span class="hs-identifier hs-var">reusableForCTE</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679470430"><span class="hs-identifier hs-var">tblNm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | Introduces the result of a previous 'selecting' (a CTE) into a new query</span><span>
</span><span id="line-98"></span><span class="annot"><a href="Database.Beam.Query.CTE.html#reuse"><span class="hs-identifier hs-type">reuse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679470424"><span class="annot"><a href="#local-6989586621679470424"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679470423"><span class="annot"><a href="#local-6989586621679470423"><span class="hs-identifier hs-type">be</span></a></span></span><span> </span><span id="local-6989586621679470422"><span class="annot"><a href="#local-6989586621679470422"><span class="hs-identifier hs-type">db</span></a></span></span><span> </span><span id="local-6989586621679470421"><span class="annot"><a href="#local-6989586621679470421"><span class="hs-identifier hs-type">res</span></a></span></span><span>
</span><span id="line-99"></span><span>       </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-type">ReusableQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470423"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470422"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470421"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Beam.Query.Internal.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470423"><span class="hs-identifier hs-type">be</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470422"><span class="hs-identifier hs-type">db</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470424"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.Internal.html#WithRewrittenThread"><span class="hs-identifier hs-type">WithRewrittenThread</span></a></span><span> </span><span class="annot"><a href="Database.Beam.Query.CTE.html#QAnyScope"><span class="hs-identifier hs-type">QAnyScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470424"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679470421"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span id="reuse"><span class="annot"><span class="annottext">reuse :: ReusableQ be db res
-&gt; Q be db s (WithRewrittenThread QAnyScope s res)
</span><a href="Database.Beam.Query.CTE.html#reuse"><span class="hs-identifier hs-var hs-var">reuse</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Beam.Query.CTE.html#ReusableQ"><span class="hs-identifier hs-type">ReusableQ</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy res
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679470420"><span class="annot"><span class="annottext">forall s.
Proxy s -&gt; Q be db s (WithRewrittenThread QAnyScope s res)
</span><a href="#local-6989586621679470420"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy s -&gt; Q be db s (WithRewrittenThread QAnyScope s res)
forall s.
Proxy s -&gt; Q be db s (WithRewrittenThread QAnyScope s res)
</span><a href="#local-6989586621679470420"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy s
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679470424"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span></pre></body></html>