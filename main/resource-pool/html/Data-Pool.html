<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Data.Pool</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">resource-pool-0.3.1.0: A high-performance striped resource pooling implementation</span><ul class="links" id="page-menu"><li><a href="src/Data.Pool.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Pool</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Pool</a></li><li><a href="#g:2">Resource management</a></li><li><a href="#g:3">Compatibility with 0.2</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A high-performance pooling abstraction for managing flexibly-sized
 collections of resources such as database connections.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:PoolConfig">PoolConfig</a> a = <a href="#v:PoolConfig">PoolConfig</a> {<ul class="subs"><li><a href="#v:createResource">createResource</a> :: !(<a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</li><li><a href="#v:freeResource">freeResource</a> :: !(a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</li><li><a href="#v:poolCacheTTL">poolCacheTTL</a> :: !<a href="../../ghc/html/libraries/base-4.14.3.0/Prelude.html#t:Double" title="Prelude">Double</a></li><li><a href="#v:poolMaxResources">poolMaxResources</a> :: !<a href="../../ghc/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Pool">Pool</a> a</li><li class="src short"><span class="keyword">data</span> <a href="#t:LocalPool">LocalPool</a> a</li><li class="src short"><a href="#v:newPool">newPool</a> :: <a href="Data-Pool.html#t:PoolConfig" title="Data.Pool">PoolConfig</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a)</li><li class="src short"><a href="#v:withResource">withResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> r</li><li class="src short"><a href="#v:takeResource">takeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a)</li><li class="src short"><a href="#v:tryWithResource">tryWithResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../../ghc/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> r)</li><li class="src short"><a href="#v:tryTakeResource">tryTakeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../../ghc/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a))</li><li class="src short"><a href="#v:putResource">putResource</a> :: <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:destroyResource">destroyResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:destroyAllResources">destroyAllResources</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:createPool">createPool</a> :: <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; (a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../../time/html/Data-Time-Clock.html#t:NominalDiffTime" title="Data.Time.Clock">NominalDiffTime</a> -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a)</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Pool</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:PoolConfig" class="def">PoolConfig</a> a <a href="src/Data.Pool.Internal.html#PoolConfig" class="link">Source</a> <a href="#t:PoolConfig" class="selflink">#</a></p><div class="doc"><p>Configuration of a <code><a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:PoolConfig" class="def">PoolConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:createResource" class="def">createResource</a> :: !(<a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</dfn><div class="doc"><p>The action that creates a new resource.</p></div></li><li><dfn class="src"><a id="v:freeResource" class="def">freeResource</a> :: !(a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</dfn><div class="doc"><p>The action that destroys an existing resource.</p></div></li><li><dfn class="src"><a id="v:poolCacheTTL" class="def">poolCacheTTL</a> :: !<a href="../../ghc/html/libraries/base-4.14.3.0/Prelude.html#t:Double" title="Prelude">Double</a></dfn><div class="doc"><p>The amount of seconds for which an unused resource is kept around. The
 smallest acceptable value is <code>0.5</code>.</p><p><em>Note:</em> the elapsed time before destroying a resource may be a little
 longer than requested, as the collector thread wakes at 1-second intervals.</p></div></li><li><dfn class="src"><a id="v:poolMaxResources" class="def">poolMaxResources</a> :: !<a href="../../ghc/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>The maximum number of resources to keep open across all stripes. The
 smallest acceptable value is <code>1</code>.</p><p><em>Note:</em> for each stripe the number of resources is divided by the number of
 capabilities and rounded up. Therefore the pool might end up creating up to
 <code>N - 1</code> resources more in total than specified, where <code>N</code> is the number of
 capabilities.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Pool" class="def">Pool</a> a <a href="src/Data.Pool.Internal.html#Pool" class="link">Source</a> <a href="#t:Pool" class="selflink">#</a></p><div class="doc"><p>Striped resource pool based on <a href="../../ghc/html/libraries/base-4.14.3.0/Control-Concurrent-QSem.html">Control.Concurrent.QSem</a>.</p><p>The number of stripes is arranged to be equal to the number of capabilities
 so that they never compete over access to the same stripe. This results in a
 very good performance in a multi-threaded environment.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LocalPool" class="def">LocalPool</a> a <a href="src/Data.Pool.Internal.html#LocalPool" class="link">Source</a> <a href="#t:LocalPool" class="selflink">#</a></p><div class="doc"><p>A single, capability-local pool.</p></div></div><div class="top"><p class="src"><a id="v:newPool" class="def">newPool</a> :: <a href="Data-Pool.html#t:PoolConfig" title="Data.Pool">PoolConfig</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a) <a href="src/Data.Pool.Internal.html#newPool" class="link">Source</a> <a href="#v:newPool" class="selflink">#</a></p><div class="doc"><p>Create a new striped resource pool.</p><p>The number of stripes is equal to the number of capabilities.</p><p><em>Note:</em> although the runtime system will destroy all idle resources when the
 pool is garbage collected, it's recommended to manually call
 <code><a href="Data-Pool.html#v:destroyAllResources" title="Data.Pool">destroyAllResources</a></code> when you're done with the pool so that the resources
 are freed up as soon as possible.</p></div></div><a href="#g:2" id="g:2"><h1>Resource management</h1></a><div class="top"><p class="src"><a id="v:withResource" class="def">withResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> r <a href="src/Data.Pool.html#withResource" class="link">Source</a> <a href="#v:withResource" class="selflink">#</a></p><div class="doc"><p>Take a resource from the pool, perform an action with it and return it to
 the pool afterwards.</p><ul><li>If the pool has an idle resource available, it is used immediately.</li><li>Otherwise, if the maximum number of resources has not yet been reached, a
   new resource is created and used.</li><li>If the maximum number of resources has been reached, this function blocks
   until a resource becomes available.</li></ul><p>If the action throws an exception of any type, the resource is destroyed and
 not returned to the pool.</p><p>It probably goes without saying that you should never manually destroy a
 pooled resource, as doing so will almost certainly cause a subsequent user
 (who expects the resource to be valid) to throw an exception.</p></div></div><div class="top"><p class="src"><a id="v:takeResource" class="def">takeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a) <a href="src/Data.Pool.html#takeResource" class="link">Source</a> <a href="#v:takeResource" class="selflink">#</a></p><div class="doc"><p>Take a resource from the pool, following the same results as
 <code><a href="Data-Pool.html#v:withResource" title="Data.Pool">withResource</a></code>.</p><p><em>Note:</em> this function returns both a resource and the <code><a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a></code> it came
 from so that it may either be destroyed (via <code><a href="Data-Pool.html#v:destroyResource" title="Data.Pool">destroyResource</a></code>) or returned
 to the pool (via <code><a href="Data-Pool.html#v:putResource" title="Data.Pool">putResource</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:tryWithResource" class="def">tryWithResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../../ghc/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> r) <a href="src/Data.Pool.html#tryWithResource" class="link">Source</a> <a href="#v:tryWithResource" class="selflink">#</a></p><div class="doc"><p>A variant of <code><a href="Data-Pool.html#v:withResource" title="Data.Pool">withResource</a></code> that doesn't execute the action and returns
 <code><a href="../../ghc/html/libraries/base-4.14.3.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> instead of blocking if the capability-local pool is exhausted.</p></div></div><div class="top"><p class="src"><a id="v:tryTakeResource" class="def">tryTakeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../../ghc/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a)) <a href="src/Data.Pool.html#tryTakeResource" class="link">Source</a> <a href="#v:tryTakeResource" class="selflink">#</a></p><div class="doc"><p>A variant of <code><a href="Data-Pool.html#v:takeResource" title="Data.Pool">takeResource</a></code> that returns <code><a href="../../ghc/html/libraries/base-4.14.3.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> instead of blocking if
 the capability-local pool is exhausted.</p></div></div><div class="top"><p class="src"><a id="v:putResource" class="def">putResource</a> :: <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#putResource" class="link">Source</a> <a href="#v:putResource" class="selflink">#</a></p><div class="doc"><p>Return a resource to the given <code><a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:destroyResource" class="def">destroyResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#destroyResource" class="link">Source</a> <a href="#v:destroyResource" class="selflink">#</a></p><div class="doc"><p>Destroy a resource.</p><p>Note that this will ignore any exceptions in the destroy function.</p></div></div><div class="top"><p class="src"><a id="v:destroyAllResources" class="def">destroyAllResources</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#destroyAllResources" class="link">Source</a> <a href="#v:destroyAllResources" class="selflink">#</a></p><div class="doc"><p>Destroy all resources in all stripes in the pool.</p><p>Note that this will ignore any exceptions in the destroy function.</p><p>This function is useful when you detect that all resources in the pool are
 broken. For example after a database has been restarted all connections
 opened before the restart will be broken. In that case it's better to close
 those connections so that <code>takeResource</code> won't take a broken connection from
 the pool but will open a new connection instead.</p><p>Another use-case for this function is that when you know you are done with
 the pool you can destroy all idle resources immediately instead of waiting on
 the garbage collector to destroy them, thus freeing up those resources
 sooner.</p></div></div><a href="#g:3" id="g:3"><h1>Compatibility with 0.2</h1></a><div class="top"><p class="src"><a id="v:createPool" class="def">createPool</a> :: <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; (a -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../../time/html/Data-Time-Clock.html#t:NominalDiffTime" title="Data.Time.Clock">NominalDiffTime</a> -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../../ghc/html/libraries/base-4.14.3.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a) <a href="src/Data.Pool.html#createPool" class="link">Source</a> <a href="#v:createPool" class="selflink">#</a></p><div class="doc"><div class="warning"><p>Deprecated: Use newPool instead</p></div><p>Provided for compatibility with <code>resource-pool &lt; 0.3</code>.</p><p>Use <code><a href="Data-Pool.html#v:newPool" title="Data.Pool">newPool</a></code> instead.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>