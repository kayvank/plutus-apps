<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_KqPokwE6iyk1bwbstow6xx"></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes   #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric         #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs                 #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase            #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns        #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings     #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE PackageImports        #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms       #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes           #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell       #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances  #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Module for indexing the Utxos in the Cardano blockchain</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- + This module will create the SQL tables:</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- + table: unspent_transactions</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-23"></span><span class="hs-comment">--      |---------+------+-------+-----------+-------+-------+------------------+--------------+------|</span><span>
</span><span id="line-24"></span><span class="hs-comment">--      | Address | TxId | TxIx  | DatumHash | Datum | Value | InlineScriptHash | InlineScript | Slot |</span><span>
</span><span id="line-25"></span><span class="hs-comment">--      |---------+------+-------+-----------+-------+-------+------------------+--------------+------|</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-27"></span><span class="hs-comment">--</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- + table: spent</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-30"></span><span class="hs-comment">--      |------+------|--------+-----------|</span><span>
</span><span id="line-31"></span><span class="hs-comment">--      | txId | txIx | slotNo | blockHash |</span><span>
</span><span id="line-32"></span><span class="hs-comment">--      |------+------|--------+-----------|</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- To create these tables, we extract all transactions outputs from each transactions fetched with</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- the chain-sync protocol of the local node.</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Marconi.ChainIndex.Indexers.Utxo</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier">Control.Concurrent.Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../async/html/src"><span class="hs-identifier">concurrently_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">bracket_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens.Combinators</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../indexed-traversable/html/src"><span class="hs-identifier">imap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens.Operators</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-operator">(^.)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens.TH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">makeLenses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">when</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">FromJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">parseJSON</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">toJSON</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Object</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">object</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-operator">(.:)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromRight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fold</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">foldl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;&amp;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">groupBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">sort</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SQL</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple.FromRow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">FromRow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">fromRow</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple.ToField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">ToField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">toField</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple.ToRow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">ToRow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">toRow</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mwc-random/html/src"><span class="hs-identifier">System.Random.MWC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mwc-random/html/src"><span class="hs-identifier">createSystemRandom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../mwc-random/html/src"><span class="hs-identifier">uniformR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../raw-strings-qq/html/src"><span class="hs-identifier">Text.RawString.QQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../raw-strings-qq/html/src"><span class="hs-identifier">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api.Shelley</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Ord</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Down</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Down</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">getDown</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Orphans.html"><span class="hs-identifier">Marconi.ChainIndex.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html"><span class="hs-identifier">Marconi.ChainIndex.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier">TargetAddresses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TxOut"><span class="hs-identifier">TxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#CurrentEra"><span class="hs-identifier">CurrentEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier">NamedParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-operator">(:=)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">Marconi.Core.Storable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">Buffered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">getStoredEvents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">persistToStorage</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">HasPoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>                              </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">QueryInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">QEverything</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">QInterval</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">Queryable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">queryStorage</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>                              </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">Resumable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">resumeFromStorage</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">Rewindable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">rewindStorage</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">StorableEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">StorableMonad</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>                              </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">StorablePoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">StorableQuery</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">StorableResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">emptyState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier">Marconi.Core.Storable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Storable</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">{- Note [Last sync chainpoint]
 -
 - The 'LastSyncPoint' query doesn't return the last indexed chainpoint, but the one before.
 - The reason is that we want to use this query to find a sync point that is common to all the indexers
 - that are under the same coordinator.
 - Unfortunately, while the coordinator ensures that all the indexer move at the same speed, it can't
 - monitor if the last submitted block was indexed by all the indexers or not.
 -
 - As a consequence, if the last chainpoint of the utxo indexer can, at most, be ahead of one block compared to other
 - indexers. Taking the chainpoint before ensure that we have consistent infomation across all the indexers.
 -}</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">type</span><span> </span><span id="UtxoIndexer"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoIndexer"><span class="hs-identifier hs-var">UtxoIndexer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">Storable.State</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">data</span><span> </span><span id="UtxoHandle"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-var">UtxoHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UtxoHandle"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-var">UtxoHandle</span></a></span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="hdlConnection"><span class="annot"><span class="annottext">UtxoHandle -&gt; Connection
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#hdlConnection"><span class="hs-identifier hs-var hs-var">hdlConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.Connection</span></a></span><span>  </span><span class="hs-comment">-- ^ SQLite connection</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="hdlDpeth"><span class="annot"><span class="annottext">UtxoHandle -&gt; Int
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#hdlDpeth"><span class="hs-identifier hs-var hs-var">hdlDpeth</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>             </span><span class="hs-comment">-- ^ depth before flushing to disk storage</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="toVacuume"><span class="annot"><span class="annottext">UtxoHandle -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#toVacuume"><span class="hs-identifier hs-var hs-var">toVacuume</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>            </span><span class="hs-comment">-- ^ weather to perform SQLite vacuum to release space</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StorableQuery"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">StorableQuery</span></a></span></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="UtxoByAddress"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoByAddress"><span class="hs-identifier hs-var">UtxoByAddress</span></a></span></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LastSyncPoint"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#LastSyncPoint"><span class="hs-identifier hs-var">LastSyncPoint</span></a></span></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481888"><span id="local-6989586621679481890"><span id="local-6989586621679481892"><span class="annot"><span class="annottext">Int -&gt; StorableQuery UtxoHandle -&gt; ShowS
[StorableQuery UtxoHandle] -&gt; ShowS
StorableQuery UtxoHandle -&gt; String
(Int -&gt; StorableQuery UtxoHandle -&gt; ShowS)
-&gt; (StorableQuery UtxoHandle -&gt; String)
-&gt; ([StorableQuery UtxoHandle] -&gt; ShowS)
-&gt; Show (StorableQuery UtxoHandle)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StorableQuery UtxoHandle] -&gt; ShowS
$cshowList :: [StorableQuery UtxoHandle] -&gt; ShowS
show :: StorableQuery UtxoHandle -&gt; String
$cshow :: StorableQuery UtxoHandle -&gt; String
showsPrec :: Int -&gt; StorableQuery UtxoHandle -&gt; ShowS
$cshowsPrec :: Int -&gt; StorableQuery UtxoHandle -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481883"><span id="local-6989586621679481885"><span class="annot"><span class="annottext">StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
(StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool)
-&gt; (StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool)
-&gt; Eq (StorableQuery UtxoHandle)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
$c/= :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
== :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
$c== :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481867"><span id="local-6989586621679481869"><span id="local-6989586621679481871"><span id="local-6989586621679481873"><span id="local-6989586621679481875"><span id="local-6989586621679481877"><span id="local-6989586621679481879"><span class="annot"><span class="annottext">Eq (StorableQuery UtxoHandle)
Eq (StorableQuery UtxoHandle)
-&gt; (StorableQuery UtxoHandle
    -&gt; StorableQuery UtxoHandle -&gt; Ordering)
-&gt; (StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool)
-&gt; (StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool)
-&gt; (StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool)
-&gt; (StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool)
-&gt; (StorableQuery UtxoHandle
    -&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle)
-&gt; (StorableQuery UtxoHandle
    -&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle)
-&gt; Ord (StorableQuery UtxoHandle)
StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Ordering
StorableQuery UtxoHandle
-&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: StorableQuery UtxoHandle
-&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle
$cmin :: StorableQuery UtxoHandle
-&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle
max :: StorableQuery UtxoHandle
-&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle
$cmax :: StorableQuery UtxoHandle
-&gt; StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle
&gt;= :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
$c&gt;= :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
&gt; :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
$c&gt; :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
&lt;= :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
$c&lt;= :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
&lt; :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
$c&lt; :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Bool
compare :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Ordering
$ccompare :: StorableQuery UtxoHandle -&gt; StorableQuery UtxoHandle -&gt; Ordering
$cp1Ord :: Eq (StorableQuery UtxoHandle)
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">type</span><span> </span><span id="QueryableAddresses"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#QueryableAddresses"><span class="hs-identifier hs-var">QueryableAddresses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableQuery</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StorableMonad"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">StorableMonad</span></a></span></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StorablePoint"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">StorablePoint</span></a></span></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">newtype</span><span> </span><span id="Depth"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Depth"><span class="hs-identifier hs-var">Depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Depth"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Depth"><span class="hs-identifier hs-var">Depth</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span id="local-6989586621679481863"><span id="local-6989586621679481864"></span></span><span class="hs-keyword">data</span><span> </span><span id="Utxo"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-var">Utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Utxo"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-var">Utxo</span></a></span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_address"><span class="annot"><span class="annottext">Utxo -&gt; AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_address"><span class="hs-identifier hs-var hs-var">_address</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_txId"><span class="annot"><span class="annottext">Utxo -&gt; TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_txId"><span class="hs-identifier hs-var hs-var">_txId</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxId</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_txIx"><span class="annot"><span class="annottext">Utxo -&gt; TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_txIx"><span class="hs-identifier hs-var hs-var">_txIx</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIx</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_datum"><span class="annot"><span class="annottext">Utxo -&gt; Maybe ScriptData
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_datum"><span class="hs-identifier hs-var hs-var">_datum</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_datumHash"><span class="annot"><span class="annottext">Utxo -&gt; Maybe (Hash ScriptData)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_datumHash"><span class="hs-identifier hs-var hs-var">_datumHash</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Hash</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_value"><span class="annot"><span class="annottext">Utxo -&gt; Value
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_value"><span class="hs-identifier hs-var hs-var">_value</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Value</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_inlineScript"><span class="annot"><span class="annottext">Utxo -&gt; Maybe ScriptInAnyLang
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_inlineScript"><span class="hs-identifier hs-var hs-var">_inlineScript</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_inlineScriptHash"><span class="annot"><span class="annottext">Utxo -&gt; Maybe ScriptHash
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_inlineScriptHash"><span class="hs-identifier hs-var hs-var">_inlineScriptHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481848"><span id="local-6989586621679481850"><span id="local-6989586621679481852"><span class="annot"><span class="annottext">Int -&gt; Utxo -&gt; ShowS
[Utxo] -&gt; ShowS
Utxo -&gt; String
(Int -&gt; Utxo -&gt; ShowS)
-&gt; (Utxo -&gt; String) -&gt; ([Utxo] -&gt; ShowS) -&gt; Show Utxo
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Utxo] -&gt; ShowS
$cshowList :: [Utxo] -&gt; ShowS
show :: Utxo -&gt; String
$cshow :: Utxo -&gt; String
showsPrec :: Int -&gt; Utxo -&gt; ShowS
$cshowsPrec :: Int -&gt; Utxo -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481844"><span id="local-6989586621679481846"><span class="annot"><span class="annottext">Utxo -&gt; Utxo -&gt; Bool
(Utxo -&gt; Utxo -&gt; Bool) -&gt; (Utxo -&gt; Utxo -&gt; Bool) -&gt; Eq Utxo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Utxo -&gt; Utxo -&gt; Bool
$c/= :: Utxo -&gt; Utxo -&gt; Bool
== :: Utxo -&gt; Utxo -&gt; Bool
$c== :: Utxo -&gt; Utxo -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. Utxo -&gt; Rep Utxo x)
-&gt; (forall x. Rep Utxo x -&gt; Utxo) -&gt; Generic Utxo
forall x. Rep Utxo x -&gt; Utxo
forall x. Utxo -&gt; Rep Utxo x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep Utxo x -&gt; Utxo
$cfrom :: forall x. Utxo -&gt; Rep Utxo x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-special">$(</span><span id="value"><span id="txIx"><span id="txId"><span id="inlineScriptHash"><span id="inlineScript"><span id="datumHash"><span id="datum"><span id="address"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Utxo</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481819"><span id="local-6989586621679481821"><span id="local-6989586621679481823"><span id="local-6989586621679481825"><span id="local-6989586621679481827"><span id="local-6989586621679481829"><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621679481818"><span class="annot"><span class="annottext">compare :: Utxo -&gt; Utxo -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span id="local-6989586621679481816"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481816"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481815"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481815"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621679481814"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481814"><span class="hs-identifier hs-var">txix</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span id="local-6989586621679481813"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481813"><span class="hs-identifier hs-var">addr'</span></a></span></span><span> </span><span id="local-6989586621679481812"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481812"><span class="hs-identifier hs-var">txid'</span></a></span></span><span> </span><span id="local-6989586621679481811"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481811"><span class="hs-identifier hs-var">txix'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>     </span><span class="annot"><span class="annottext">(AddressAny, TxIn) -&gt; (AddressAny, TxIn) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">compare</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481816"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481815"><span class="hs-identifier hs-var">txid</span></a></span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481814"><span class="hs-identifier hs-var">txix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481813"><span class="hs-identifier hs-var">addr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481812"><span class="hs-identifier hs-var">txid'</span></a></span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481811"><span class="hs-identifier hs-var">txix'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481807"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679481805"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser Utxo
</span><a href="#local-6989586621679481805"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679481804"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">AddressAny
-&gt; TxId
-&gt; TxIx
-&gt; Maybe ScriptData
-&gt; Maybe (Hash ScriptData)
-&gt; Value
-&gt; Maybe ScriptInAnyLang
-&gt; Maybe ScriptHash
-&gt; Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-var">Utxo</span></a></span><span>
</span><span id="line-132"></span><span>            </span><span class="annot"><span class="annottext">(AddressAny
 -&gt; TxId
 -&gt; TxIx
 -&gt; Maybe ScriptData
 -&gt; Maybe (Hash ScriptData)
 -&gt; Value
 -&gt; Maybe ScriptInAnyLang
 -&gt; Maybe ScriptHash
 -&gt; Utxo)
-&gt; Parser AddressAny
-&gt; Parser
     (TxId
      -&gt; TxIx
      -&gt; Maybe ScriptData
      -&gt; Maybe (Hash ScriptData)
      -&gt; Value
      -&gt; Maybe ScriptInAnyLang
      -&gt; Maybe ScriptHash
      -&gt; Utxo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser AddressAny
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;address&quot;</span></span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><span class="annottext">Parser
  (TxId
   -&gt; TxIx
   -&gt; Maybe ScriptData
   -&gt; Maybe (Hash ScriptData)
   -&gt; Value
   -&gt; Maybe ScriptInAnyLang
   -&gt; Maybe ScriptHash
   -&gt; Utxo)
-&gt; Parser TxId
-&gt; Parser
     (TxIx
      -&gt; Maybe ScriptData
      -&gt; Maybe (Hash ScriptData)
      -&gt; Value
      -&gt; Maybe ScriptInAnyLang
      -&gt; Maybe ScriptHash
      -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser TxId
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;txId&quot;</span></span><span>
</span><span id="line-134"></span><span>            </span><span class="annot"><span class="annottext">Parser
  (TxIx
   -&gt; Maybe ScriptData
   -&gt; Maybe (Hash ScriptData)
   -&gt; Value
   -&gt; Maybe ScriptInAnyLang
   -&gt; Maybe ScriptHash
   -&gt; Utxo)
-&gt; Parser TxIx
-&gt; Parser
     (Maybe ScriptData
      -&gt; Maybe (Hash ScriptData)
      -&gt; Value
      -&gt; Maybe ScriptInAnyLang
      -&gt; Maybe ScriptHash
      -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser TxIx
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;txIx&quot;</span></span><span>
</span><span id="line-135"></span><span>            </span><span class="annot"><span class="annottext">Parser
  (Maybe ScriptData
   -&gt; Maybe (Hash ScriptData)
   -&gt; Value
   -&gt; Maybe ScriptInAnyLang
   -&gt; Maybe ScriptHash
   -&gt; Utxo)
-&gt; Parser (Maybe ScriptData)
-&gt; Parser
     (Maybe (Hash ScriptData)
      -&gt; Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe ScriptData)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;datum&quot;</span></span><span>
</span><span id="line-136"></span><span>            </span><span class="annot"><span class="annottext">Parser
  (Maybe (Hash ScriptData)
   -&gt; Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
-&gt; Parser (Maybe (Hash ScriptData))
-&gt; Parser
     (Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe (Hash ScriptData))
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;datumHash&quot;</span></span><span>
</span><span id="line-137"></span><span>            </span><span class="annot"><span class="annottext">Parser (Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
-&gt; Parser Value
-&gt; Parser (Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Value
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;value&quot;</span></span><span>
</span><span id="line-138"></span><span>            </span><span class="annot"><span class="annottext">Parser (Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
-&gt; Parser (Maybe ScriptInAnyLang)
-&gt; Parser (Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe ScriptInAnyLang)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;inlineScript&quot;</span></span><span>
</span><span id="line-139"></span><span>            </span><span class="annot"><span class="annottext">Parser (Maybe ScriptHash -&gt; Utxo)
-&gt; Parser (Maybe ScriptHash) -&gt; Parser Utxo
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe ScriptHash)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;inlineScriptHash&quot;</span></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">parseJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Utxo
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481796"><span id="local-6989586621679481798"><span id="local-6989586621679481800"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621679481794"><span class="annot"><span class="annottext">toJSON :: Utxo -&gt; Value
</span><a href="#local-6989586621679481794"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span id="local-6989586621679481793"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481793"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481792"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481792"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621679481791"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481791"><span class="hs-identifier hs-var">txix</span></a></span></span><span> </span><span id="local-6989586621679481790"><span class="annot"><span class="annottext">Maybe ScriptData
</span><a href="#local-6989586621679481790"><span class="hs-identifier hs-var">dtum</span></a></span></span><span> </span><span id="local-6989586621679481789"><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><a href="#local-6989586621679481789"><span class="hs-identifier hs-var">dtumHash</span></a></span></span><span> </span><span id="local-6989586621679481788"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679481788"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621679481787"><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><a href="#local-6989586621679481787"><span class="hs-identifier hs-var">scrpt</span></a></span></span><span> </span><span id="local-6989586621679481786"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679481786"><span class="hs-identifier hs-var">scrptHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">object</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;address&quot;</span></span><span>           </span><span class="annot"><span class="annottext">Key -&gt; AddressAny -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481793"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;txId&quot;</span></span><span>              </span><span class="annot"><span class="annottext">Key -&gt; TxId -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481792"><span class="hs-identifier hs-var">txid</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;txIx&quot;</span></span><span>              </span><span class="annot"><span class="annottext">Key -&gt; TxIx -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481791"><span class="hs-identifier hs-var">txix</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;datum&quot;</span></span><span>             </span><span class="annot"><span class="annottext">Key -&gt; Maybe ScriptData -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
</span><a href="#local-6989586621679481790"><span class="hs-identifier hs-var">dtum</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;datumHash&quot;</span></span><span>         </span><span class="annot"><span class="annottext">Key -&gt; Maybe (Hash ScriptData) -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><a href="#local-6989586621679481789"><span class="hs-identifier hs-var">dtumHash</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;value&quot;</span></span><span>             </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679481788"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- Uses ToJSON instance of cardano-api which serialises using the 'C.HasTextEnvelope' typeclass.</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;inlineScript&quot;</span></span><span>      </span><span class="annot"><span class="annottext">Key -&gt; Maybe ScriptInAnyLang -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><a href="#local-6989586621679481787"><span class="hs-identifier hs-var">scrpt</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;inlineScriptHash&quot;</span></span><span>  </span><span class="annot"><span class="annottext">Key -&gt; Maybe ScriptHash -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679481786"><span class="hs-identifier hs-var">scrptHash</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span id="local-6989586621679481784"><span id="local-6989586621679481785"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="ChainPointRow"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-var">ChainPointRow</span></a></span></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ChainPointRow"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-var">ChainPointRow</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getChainPoint"><span class="annot"><span class="annottext">ChainPointRow -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getChainPoint"><span class="hs-identifier hs-var hs-var">getChainPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481776"><span id="local-6989586621679481778"><span id="local-6989586621679481780"><span class="annot"><span class="annottext">Int -&gt; ChainPointRow -&gt; ShowS
[ChainPointRow] -&gt; ShowS
ChainPointRow -&gt; String
(Int -&gt; ChainPointRow -&gt; ShowS)
-&gt; (ChainPointRow -&gt; String)
-&gt; ([ChainPointRow] -&gt; ShowS)
-&gt; Show ChainPointRow
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ChainPointRow] -&gt; ShowS
$cshowList :: [ChainPointRow] -&gt; ShowS
show :: ChainPointRow -&gt; String
$cshow :: ChainPointRow -&gt; String
showsPrec :: Int -&gt; ChainPointRow -&gt; ShowS
$cshowsPrec :: Int -&gt; ChainPointRow -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481772"><span id="local-6989586621679481774"><span class="annot"><span class="annottext">ChainPointRow -&gt; ChainPointRow -&gt; Bool
(ChainPointRow -&gt; ChainPointRow -&gt; Bool)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; Bool) -&gt; Eq ChainPointRow
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
$c/= :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
== :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
$c== :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481757"><span id="local-6989586621679481759"><span id="local-6989586621679481761"><span id="local-6989586621679481763"><span id="local-6989586621679481765"><span id="local-6989586621679481767"><span id="local-6989586621679481769"><span class="annot"><span class="annottext">Eq ChainPointRow
Eq ChainPointRow
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; Ordering)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; Bool)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; Bool)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; Bool)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; Bool)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow)
-&gt; (ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow)
-&gt; Ord ChainPointRow
ChainPointRow -&gt; ChainPointRow -&gt; Bool
ChainPointRow -&gt; ChainPointRow -&gt; Ordering
ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow
$cmin :: ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow
max :: ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow
$cmax :: ChainPointRow -&gt; ChainPointRow -&gt; ChainPointRow
&gt;= :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
$c&gt;= :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
&gt; :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
$c&gt; :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
&lt;= :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
$c&lt;= :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
&lt; :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
$c&lt; :: ChainPointRow -&gt; ChainPointRow -&gt; Bool
compare :: ChainPointRow -&gt; ChainPointRow -&gt; Ordering
$ccompare :: ChainPointRow -&gt; ChainPointRow -&gt; Ordering
$cp1Ord :: Eq ChainPointRow
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ChainPointRow -&gt; Rep ChainPointRow x)
-&gt; (forall x. Rep ChainPointRow x -&gt; ChainPointRow)
-&gt; Generic ChainPointRow
forall x. Rep ChainPointRow x -&gt; ChainPointRow
forall x. ChainPointRow -&gt; Rep ChainPointRow x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ChainPointRow x -&gt; ChainPointRow
$cfrom :: forall x. ChainPointRow -&gt; Rep ChainPointRow x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-special">$(</span><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ChainPointRow</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="local-6989586621679481753"><span id="local-6989586621679481754"></span></span><span class="hs-keyword">data</span><span> </span><span id="UtxoRow"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-var">UtxoRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UtxoRow"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-var">UtxoRow</span></a></span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_urUtxo"><span class="annot"><span class="annottext">UtxoRow -&gt; Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_urUtxo"><span class="hs-identifier hs-var hs-var">_urUtxo</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_urSlotNo"><span class="annot"><span class="annottext">UtxoRow -&gt; SlotNo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_urSlotNo"><span class="hs-identifier hs-var hs-var">_urSlotNo</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_urBlockHash"><span class="annot"><span class="annottext">UtxoRow -&gt; Hash BlockHeader
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_urBlockHash"><span class="hs-identifier hs-var hs-var">_urBlockHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Hash</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.BlockHeader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481743"><span id="local-6989586621679481745"><span id="local-6989586621679481747"><span class="annot"><span class="annottext">Int -&gt; UtxoRow -&gt; ShowS
[UtxoRow] -&gt; ShowS
UtxoRow -&gt; String
(Int -&gt; UtxoRow -&gt; ShowS)
-&gt; (UtxoRow -&gt; String) -&gt; ([UtxoRow] -&gt; ShowS) -&gt; Show UtxoRow
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [UtxoRow] -&gt; ShowS
$cshowList :: [UtxoRow] -&gt; ShowS
show :: UtxoRow -&gt; String
$cshow :: UtxoRow -&gt; String
showsPrec :: Int -&gt; UtxoRow -&gt; ShowS
$cshowsPrec :: Int -&gt; UtxoRow -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481739"><span id="local-6989586621679481741"><span class="annot"><span class="annottext">UtxoRow -&gt; UtxoRow -&gt; Bool
(UtxoRow -&gt; UtxoRow -&gt; Bool)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; Bool) -&gt; Eq UtxoRow
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: UtxoRow -&gt; UtxoRow -&gt; Bool
$c/= :: UtxoRow -&gt; UtxoRow -&gt; Bool
== :: UtxoRow -&gt; UtxoRow -&gt; Bool
$c== :: UtxoRow -&gt; UtxoRow -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481724"><span id="local-6989586621679481726"><span id="local-6989586621679481728"><span id="local-6989586621679481730"><span id="local-6989586621679481732"><span id="local-6989586621679481734"><span id="local-6989586621679481736"><span class="annot"><span class="annottext">Eq UtxoRow
Eq UtxoRow
-&gt; (UtxoRow -&gt; UtxoRow -&gt; Ordering)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; Bool)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; Bool)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; Bool)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; Bool)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; UtxoRow)
-&gt; (UtxoRow -&gt; UtxoRow -&gt; UtxoRow)
-&gt; Ord UtxoRow
UtxoRow -&gt; UtxoRow -&gt; Bool
UtxoRow -&gt; UtxoRow -&gt; Ordering
UtxoRow -&gt; UtxoRow -&gt; UtxoRow
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: UtxoRow -&gt; UtxoRow -&gt; UtxoRow
$cmin :: UtxoRow -&gt; UtxoRow -&gt; UtxoRow
max :: UtxoRow -&gt; UtxoRow -&gt; UtxoRow
$cmax :: UtxoRow -&gt; UtxoRow -&gt; UtxoRow
&gt;= :: UtxoRow -&gt; UtxoRow -&gt; Bool
$c&gt;= :: UtxoRow -&gt; UtxoRow -&gt; Bool
&gt; :: UtxoRow -&gt; UtxoRow -&gt; Bool
$c&gt; :: UtxoRow -&gt; UtxoRow -&gt; Bool
&lt;= :: UtxoRow -&gt; UtxoRow -&gt; Bool
$c&lt;= :: UtxoRow -&gt; UtxoRow -&gt; Bool
&lt; :: UtxoRow -&gt; UtxoRow -&gt; Bool
$c&lt; :: UtxoRow -&gt; UtxoRow -&gt; Bool
compare :: UtxoRow -&gt; UtxoRow -&gt; Ordering
$ccompare :: UtxoRow -&gt; UtxoRow -&gt; Ordering
$cp1Ord :: Eq UtxoRow
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. UtxoRow -&gt; Rep UtxoRow x)
-&gt; (forall x. Rep UtxoRow x -&gt; UtxoRow) -&gt; Generic UtxoRow
forall x. Rep UtxoRow x -&gt; UtxoRow
forall x. UtxoRow -&gt; Rep UtxoRow x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep UtxoRow x -&gt; UtxoRow
$cfrom :: forall x. UtxoRow -&gt; Rep UtxoRow x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-special">$(</span><span id="urUtxo"><span id="urSlotNo"><span id="urBlockHash"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">UtxoRow</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481716"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679481715"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser UtxoRow
</span><a href="#local-6989586621679481715"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679481714"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481714"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><span class="annottext">Utxo -&gt; SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-var">UtxoRow</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span class="annot"><span class="annottext">(Utxo -&gt; SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow)
-&gt; Parser Utxo -&gt; Parser (SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481714"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Utxo
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;utxo&quot;</span></span><span>
</span><span id="line-173"></span><span>            </span><span class="annot"><span class="annottext">Parser (SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow)
-&gt; Parser SlotNo -&gt; Parser (Hash BlockHeader -&gt; UtxoRow)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481714"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser SlotNo
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slotNo&quot;</span></span><span>
</span><span id="line-174"></span><span>            </span><span class="annot"><span class="annottext">Parser (Hash BlockHeader -&gt; UtxoRow)
-&gt; Parser (Hash BlockHeader) -&gt; Parser UtxoRow
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481714"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Hash BlockHeader)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;blockHeaderHash&quot;</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">parseJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser UtxoRow
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481707"><span id="local-6989586621679481709"><span id="local-6989586621679481711"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679481706"><span class="annot"><span class="annottext">toJSON :: UtxoRow -&gt; Value
</span><a href="#local-6989586621679481706"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span> </span><span id="local-6989586621679481705"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481705"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679481704"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481704"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679481703"><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481703"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">object</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;utxo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Utxo -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481705"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slotNo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SlotNo -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481704"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;blockHeaderHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Hash BlockHeader -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481703"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481700"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-type">ChainPointRow</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679481699"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser ChainPointRow
</span><a href="#local-6989586621679481699"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679481698"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481698"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; ChainPointRow)
-&gt; Parser ChainPoint -&gt; Parser ChainPointRow
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; ChainPointRow
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-var">ChainPointRow</span></a></span><span> </span><span class="annot"><span class="annottext">(Parser ChainPoint -&gt; Parser ChainPointRow)
-&gt; Parser ChainPoint -&gt; Parser ChainPointRow
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPoint</span></a></span><span>
</span><span id="line-187"></span><span>            </span><span class="annot"><span class="annottext">(SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint)
-&gt; Parser SlotNo -&gt; Parser (Hash BlockHeader -&gt; ChainPoint)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481698"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser SlotNo
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slotNo&quot;</span></span><span>
</span><span id="line-188"></span><span>            </span><span class="annot"><span class="annottext">Parser (Hash BlockHeader -&gt; ChainPoint)
-&gt; Parser (Hash BlockHeader) -&gt; Parser ChainPoint
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679481698"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Hash BlockHeader)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;blockHeaderHash&quot;</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">parseJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainPointRow -&gt; Parser ChainPointRow
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPointRow -&gt; Parser ChainPointRow)
-&gt; ChainPointRow -&gt; Parser ChainPointRow
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; ChainPointRow
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-var">ChainPointRow</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">parseJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ChainPointRow
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481689"><span id="local-6989586621679481691"><span id="local-6989586621679481693"><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-type">ChainPointRow</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679481688"><span class="annot"><span class="annottext">toJSON :: ChainPointRow -&gt; Value
</span><a href="#local-6989586621679481688"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-type">ChainPointRow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481687"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481687"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679481686"><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481686"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">object</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slotNo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SlotNo -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481687"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;blockHeaderHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Hash BlockHeader -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481686"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-type">ChainPointRow</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StorableResult"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">StorableResult</span></a></span></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="UtxoResult"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoResult"><span class="hs-identifier hs-var">UtxoResult</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getUtxoResult"><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxoResult"><span class="hs-identifier hs-var hs-var">getUtxoResult</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="LastSyncPointResult"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#LastSyncPointResult"><span class="hs-identifier hs-var">LastSyncPointResult</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getLastSyncPoint"><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getLastSyncPoint"><span class="hs-identifier hs-var hs-var">getLastSyncPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481678"><span id="local-6989586621679481680"><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool
(StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool)
-&gt; (StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool)
-&gt; Eq (StorableResult UtxoHandle)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool
$c/= :: StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool
== :: StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool
$c== :: StorableResult UtxoHandle -&gt; StorableResult UtxoHandle -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481672"><span id="local-6989586621679481674"><span id="local-6989586621679481676"><span class="annot"><span class="annottext">Int -&gt; StorableResult UtxoHandle -&gt; ShowS
[StorableResult UtxoHandle] -&gt; ShowS
StorableResult UtxoHandle -&gt; String
(Int -&gt; StorableResult UtxoHandle -&gt; ShowS)
-&gt; (StorableResult UtxoHandle -&gt; String)
-&gt; ([StorableResult UtxoHandle] -&gt; ShowS)
-&gt; Show (StorableResult UtxoHandle)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StorableResult UtxoHandle] -&gt; ShowS
$cshowList :: [StorableResult UtxoHandle] -&gt; ShowS
show :: StorableResult UtxoHandle -&gt; String
$cshow :: StorableResult UtxoHandle -&gt; String
showsPrec :: Int -&gt; StorableResult UtxoHandle -&gt; ShowS
$cshowsPrec :: Int -&gt; StorableResult UtxoHandle -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StorableEvent"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">StorableEvent</span></a></span></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UtxoEvent"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="ueUtxos"><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; Set Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueUtxos"><span class="hs-identifier hs-var hs-var">ueUtxos</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="ueInputs"><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueInputs"><span class="hs-identifier hs-var hs-var">ueInputs</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="ueChainPoint"><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueChainPoint"><span class="hs-identifier hs-var hs-var">ueChainPoint</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481662"><span id="local-6989586621679481664"><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
(StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; (StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; Eq (StorableEvent UtxoHandle)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
$c/= :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
== :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
$c== :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481647"><span id="local-6989586621679481649"><span id="local-6989586621679481651"><span id="local-6989586621679481653"><span id="local-6989586621679481655"><span id="local-6989586621679481657"><span id="local-6989586621679481659"><span class="annot"><span class="annottext">Eq (StorableEvent UtxoHandle)
Eq (StorableEvent UtxoHandle)
-&gt; (StorableEvent UtxoHandle
    -&gt; StorableEvent UtxoHandle -&gt; Ordering)
-&gt; (StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; (StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; (StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; (StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; (StorableEvent UtxoHandle
    -&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle)
-&gt; (StorableEvent UtxoHandle
    -&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle)
-&gt; Ord (StorableEvent UtxoHandle)
StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Ordering
StorableEvent UtxoHandle
-&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: StorableEvent UtxoHandle
-&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle
$cmin :: StorableEvent UtxoHandle
-&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle
max :: StorableEvent UtxoHandle
-&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle
$cmax :: StorableEvent UtxoHandle
-&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle
&gt;= :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
$c&gt;= :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
&gt; :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
$c&gt; :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
&lt;= :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
$c&lt;= :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
&lt; :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
$c&lt; :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool
compare :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Ordering
$ccompare :: StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Ordering
$cp1Ord :: Eq (StorableEvent UtxoHandle)
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481641"><span id="local-6989586621679481643"><span id="local-6989586621679481645"><span class="annot"><span class="annottext">Int -&gt; StorableEvent UtxoHandle -&gt; ShowS
[StorableEvent UtxoHandle] -&gt; ShowS
StorableEvent UtxoHandle -&gt; String
(Int -&gt; StorableEvent UtxoHandle -&gt; ShowS)
-&gt; (StorableEvent UtxoHandle -&gt; String)
-&gt; ([StorableEvent UtxoHandle] -&gt; ShowS)
-&gt; Show (StorableEvent UtxoHandle)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StorableEvent UtxoHandle] -&gt; ShowS
$cshowList :: [StorableEvent UtxoHandle] -&gt; ShowS
show :: StorableEvent UtxoHandle -&gt; String
$cshow :: StorableEvent UtxoHandle -&gt; String
showsPrec :: Int -&gt; StorableEvent UtxoHandle -&gt; ShowS
$cshowsPrec :: Int -&gt; StorableEvent UtxoHandle -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x.
 StorableEvent UtxoHandle -&gt; Rep (StorableEvent UtxoHandle) x)
-&gt; (forall x.
    Rep (StorableEvent UtxoHandle) x -&gt; StorableEvent UtxoHandle)
-&gt; Generic (StorableEvent UtxoHandle)
forall x.
Rep (StorableEvent UtxoHandle) x -&gt; StorableEvent UtxoHandle
forall x.
StorableEvent UtxoHandle -&gt; Rep (StorableEvent UtxoHandle) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x.
Rep (StorableEvent UtxoHandle) x -&gt; StorableEvent UtxoHandle
$cfrom :: forall x.
StorableEvent UtxoHandle -&gt; Rep (StorableEvent UtxoHandle) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventIsBefore"><span class="hs-identifier hs-type">eventIsBefore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-214"></span><span id="eventIsBefore"><span class="annot"><span class="annottext">eventIsBefore :: ChainPoint -&gt; StorableEvent UtxoHandle -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventIsBefore"><span class="hs-identifier hs-var hs-var">eventIsBefore</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481637"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481637"><span class="hs-identifier hs-var">slot'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481636"><span class="annot"><a href="#local-6989586621679481636"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481636"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481637"><span class="hs-identifier hs-var">slot'</span></a></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventIsBefore"><span class="hs-identifier hs-var">eventIsBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><span class="hs-identifier">_</span></span><span>                                                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | mappend, combine Unspent utxoEvents:</span><span>
</span><span id="line-218"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481630"><span id="local-6989586621679481632"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span id="local-6989586621679481628"><span class="annot"><a href="#local-6989586621679481628"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621679481627"><span class="annot"><a href="#local-6989586621679481627"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span id="local-6989586621679481626"><span class="annot"><a href="#local-6989586621679481626"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481625"><span class="annot"><span class="annottext">&lt;&gt; :: StorableEvent UtxoHandle
-&gt; StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span id="local-6989586621679481624"><span class="annot"><a href="#local-6989586621679481624"><span class="hs-identifier hs-var">us'</span></a></span></span><span> </span><span id="local-6989586621679481623"><span class="annot"><a href="#local-6989586621679481623"><span class="hs-identifier hs-var">is'</span></a></span></span><span> </span><span id="local-6989586621679481622"><span class="annot"><a href="#local-6989586621679481622"><span class="hs-identifier hs-var">cp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481621"><span class="hs-identifier hs-var">utxos</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481620"><span class="hs-identifier hs-var">txins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainPoint -&gt; ChainPoint -&gt; ChainPoint
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">max</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481626"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481622"><span class="hs-identifier hs-var">cp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><a href="#local-6989586621679481618"><span class="hs-identifier hs-type">toTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621679481618"><span class="annot"><span class="annottext">toTxIn :: Utxo -&gt; TxIn
</span><a href="#local-6989586621679481618"><span class="hs-identifier hs-var hs-var">toTxIn</span></a></span></span><span> </span><span id="local-6989586621679481617"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481617"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481617"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; Getting TxId Utxo TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting TxId Utxo TxId
Lens' Utxo TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txId"><span class="hs-identifier hs-var">txId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481617"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; Getting TxIx Utxo TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Utxo TxIx
Lens' Utxo TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txIx"><span class="hs-identifier hs-var">txIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>      </span><span id="local-6989586621679481620"><span class="annot"><span class="annottext">txins :: Set TxIn
</span><a href="#local-6989586621679481620"><span class="hs-identifier hs-var hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481627"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481623"><span class="hs-identifier hs-var">is'</span></a></span><span>
</span><span id="line-225"></span><span>      </span><span id="local-6989586621679481621"><span class="annot"><span class="annottext">utxos :: Set Utxo
</span><a href="#local-6989586621679481621"><span class="hs-identifier hs-var hs-var">utxos</span></a></span></span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set Utxo -&gt; Utxo -&gt; Set Utxo) -&gt; Set Utxo -&gt; Set Utxo -&gt; Set Utxo
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481615"><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481615"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679481614"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481614"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; TxIn
</span><a href="#local-6989586621679481618"><span class="hs-identifier hs-var">toTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481614"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Set TxIn -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.notMember`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481620"><span class="hs-identifier hs-var">txins</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; Set Utxo -&gt; Set Utxo
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481614"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481615"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481615"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Utxo
forall a. Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">(Set Utxo -&gt; Set Utxo) -&gt; Set Utxo -&gt; Set Utxo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set Utxo -&gt; Set Utxo
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481628"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481624"><span class="hs-identifier hs-var">us'</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481605"><span id="local-6989586621679481607"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621679481603"><span class="annot"><span class="annottext">mempty :: StorableEvent UtxoHandle
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- | The effect of a transaction (or a number of them) on the tx output set.</span><span>
</span><span id="line-233"></span><span id="local-6989586621679481601"><span id="local-6989586621679481602"></span></span><span class="hs-keyword">data</span><span> </span><span id="TxOutBalance"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-var">TxOutBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>  </span><span id="TxOutBalance"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-var">TxOutBalance</span></a></span></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_tobUnspent"><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobUnspent"><span class="hs-identifier hs-var hs-var">_tobUnspent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- ^ Outputs newly added by the transaction(s)</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_tobSpent"><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobSpent"><span class="hs-identifier hs-var hs-var">_tobSpent</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- ^ Outputs spent by the transaction(s)</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481594"><span id="local-6989586621679481596"><span class="annot"><span class="annottext">TxOutBalance -&gt; TxOutBalance -&gt; Bool
(TxOutBalance -&gt; TxOutBalance -&gt; Bool)
-&gt; (TxOutBalance -&gt; TxOutBalance -&gt; Bool) -&gt; Eq TxOutBalance
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TxOutBalance -&gt; TxOutBalance -&gt; Bool
$c/= :: TxOutBalance -&gt; TxOutBalance -&gt; Bool
== :: TxOutBalance -&gt; TxOutBalance -&gt; Bool
$c== :: TxOutBalance -&gt; TxOutBalance -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481588"><span id="local-6989586621679481590"><span id="local-6989586621679481592"><span class="annot"><span class="annottext">Int -&gt; TxOutBalance -&gt; ShowS
[TxOutBalance] -&gt; ShowS
TxOutBalance -&gt; String
(Int -&gt; TxOutBalance -&gt; ShowS)
-&gt; (TxOutBalance -&gt; String)
-&gt; ([TxOutBalance] -&gt; ShowS)
-&gt; Show TxOutBalance
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TxOutBalance] -&gt; ShowS
$cshowList :: [TxOutBalance] -&gt; ShowS
show :: TxOutBalance -&gt; String
$cshow :: TxOutBalance -&gt; String
showsPrec :: Int -&gt; TxOutBalance -&gt; ShowS
$cshowsPrec :: Int -&gt; TxOutBalance -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TxOutBalance -&gt; Rep TxOutBalance x)
-&gt; (forall x. Rep TxOutBalance x -&gt; TxOutBalance)
-&gt; Generic TxOutBalance
forall x. Rep TxOutBalance x -&gt; TxOutBalance
forall x. TxOutBalance -&gt; Rep TxOutBalance x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TxOutBalance x -&gt; TxOutBalance
$cfrom :: forall x. TxOutBalance -&gt; Rep TxOutBalance x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481581"><span id="local-6989586621679481583"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-type">TxOutBalance</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679481580"><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481580"><span class="hs-identifier hs-var">tobL</span></a></span></span><span> </span><span id="local-6989586621679481579"><span class="annot"><span class="annottext">&lt;&gt; :: TxOutBalance -&gt; TxOutBalance -&gt; TxOutBalance
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621679481578"><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481578"><span class="hs-identifier hs-var">tobR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">TxOutBalance :: Set TxIn -&gt; Set TxIn -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-type">TxOutBalance</span></a></span><span>
</span><span id="line-245"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_tobUnspent :: Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobUnspent"><span class="hs-identifier hs-var">_tobUnspent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobUnspent"><span class="hs-identifier hs-var hs-var">_tobUnspent</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481578"><span class="hs-identifier hs-var">tobR</span></a></span><span>
</span><span id="line-246"></span><span>                            </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobUnspent"><span class="hs-identifier hs-var hs-var">_tobUnspent</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481580"><span class="hs-identifier hs-var">tobL</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobSpent"><span class="hs-identifier hs-var hs-var">_tobSpent</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481578"><span class="hs-identifier hs-var">tobR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_tobSpent :: Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobSpent"><span class="hs-identifier hs-var">_tobSpent</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobSpent"><span class="hs-identifier hs-var hs-var">_tobSpent</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481580"><span class="hs-identifier hs-var">tobL</span></a></span><span>
</span><span id="line-248"></span><span>                            </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobSpent"><span class="hs-identifier hs-var hs-var">_tobSpent</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481578"><span class="hs-identifier hs-var">tobR</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_tobUnspent"><span class="hs-identifier hs-var hs-var">_tobUnspent</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutBalance
</span><a href="#local-6989586621679481580"><span class="hs-identifier hs-var">tobL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481572"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-type">TxOutBalance</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679481571"><span class="annot"><span class="annottext">mappend :: TxOutBalance -&gt; TxOutBalance -&gt; TxOutBalance
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutBalance -&gt; TxOutBalance -&gt; TxOutBalance
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679481570"><span class="annot"><span class="annottext">mempty :: TxOutBalance
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-var">TxOutBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-keyword">data</span><span> </span><span id="Spent"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-var">Spent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Spent"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-var">Spent</span></a></span></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_sTxId"><span class="annot"><span class="annottext">Spent -&gt; TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_sTxId"><span class="hs-identifier hs-var hs-var">_sTxId</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxId</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_sTxIx"><span class="annot"><span class="annottext">Spent -&gt; TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_sTxIx"><span class="hs-identifier hs-var hs-var">_sTxIx</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIx</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_sSlotNo"><span class="annot"><span class="annottext">Spent -&gt; SlotNo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_sSlotNo"><span class="hs-identifier hs-var hs-var">_sSlotNo</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_sBlockHash"><span class="annot"><span class="annottext">Spent -&gt; Hash BlockHeader
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_sBlockHash"><span class="hs-identifier hs-var hs-var">_sBlockHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Hash</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.BlockHeader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481559"><span id="local-6989586621679481561"><span id="local-6989586621679481563"><span class="annot"><span class="annottext">Int -&gt; Spent -&gt; ShowS
[Spent] -&gt; ShowS
Spent -&gt; String
(Int -&gt; Spent -&gt; ShowS)
-&gt; (Spent -&gt; String) -&gt; ([Spent] -&gt; ShowS) -&gt; Show Spent
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Spent] -&gt; ShowS
$cshowList :: [Spent] -&gt; ShowS
show :: Spent -&gt; String
$cshow :: Spent -&gt; String
showsPrec :: Int -&gt; Spent -&gt; ShowS
$cshowsPrec :: Int -&gt; Spent -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481555"><span id="local-6989586621679481557"><span class="annot"><span class="annottext">Spent -&gt; Spent -&gt; Bool
(Spent -&gt; Spent -&gt; Bool) -&gt; (Spent -&gt; Spent -&gt; Bool) -&gt; Eq Spent
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Spent -&gt; Spent -&gt; Bool
$c/= :: Spent -&gt; Spent -&gt; Bool
== :: Spent -&gt; Spent -&gt; Bool
$c== :: Spent -&gt; Spent -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-special">$(</span><span id="sTxIx"><span id="sTxId"><span id="sSlotNo"><span id="sBlockHash"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Spent</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481537"><span id="local-6989586621679481539"><span id="local-6989586621679481541"><span id="local-6989586621679481543"><span id="local-6989586621679481545"><span id="local-6989586621679481547"><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-type">Spent</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679481536"><span class="annot"><span class="annottext">compare :: Spent -&gt; Spent -&gt; Ordering
</span><a href="#local-6989586621679481536"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span id="local-6989586621679481535"><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481535"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679481534"><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481534"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxId, TxIx) -&gt; (TxId, TxIx) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">compare</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481535"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting TxId Spent TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxId Spent TxId
Lens' Spent TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sTxId"><span class="hs-identifier hs-var">sTxId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481535"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting TxIx Spent TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Spent TxIx
Lens' Spent TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sTxIx"><span class="hs-identifier hs-var">sTxIx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481534"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting TxId Spent TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxId Spent TxId
Lens' Spent TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sTxId"><span class="hs-identifier hs-var">sTxId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481534"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting TxIx Spent TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Spent TxIx
Lens' Spent TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sTxIx"><span class="hs-identifier hs-var">sTxIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">HasPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621679481531"><span class="annot"><span class="annottext">getPoint :: StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPoint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481529"><span class="annot"><a href="#local-6989586621679481529"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481529"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- sql mappings --</span><span>
</span><span id="line-274"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">ToRow</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621679481526"><span class="annot"><span class="annottext">toRow :: UtxoRow -&gt; [SQLData]
</span><a href="#local-6989586621679481526"><span class="hs-identifier hs-var hs-var hs-var hs-var">toRow</span></a></span></span><span> </span><span id="local-6989586621679481525"><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SQLData, SQLData, SQLData, SQLData, SQLData, SQLData, SQLData,
 SQLData, SQLData, SQLData)
-&gt; [SQLData]
forall a. ToRow a =&gt; a -&gt; [SQLData]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toRow</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AddressAny -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting AddressAny UtxoRow AddressAny -&gt; AddressAny
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const AddressAny Utxo)
-&gt; UtxoRow -&gt; Const AddressAny UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const AddressAny Utxo)
 -&gt; UtxoRow -&gt; Const AddressAny UtxoRow)
-&gt; ((AddressAny -&gt; Const AddressAny AddressAny)
    -&gt; Utxo -&gt; Const AddressAny Utxo)
-&gt; Getting AddressAny UtxoRow AddressAny
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAny -&gt; Const AddressAny AddressAny)
-&gt; Utxo -&gt; Const AddressAny Utxo
Lens' Utxo AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#address"><span class="hs-identifier hs-var">address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting TxId UtxoRow TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const TxId Utxo) -&gt; UtxoRow -&gt; Const TxId UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const TxId Utxo) -&gt; UtxoRow -&gt; Const TxId UtxoRow)
-&gt; Getting TxId Utxo TxId -&gt; Getting TxId UtxoRow TxId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxId Utxo TxId
Lens' Utxo TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txId"><span class="hs-identifier hs-var">txId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIx -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting TxIx UtxoRow TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const TxIx Utxo) -&gt; UtxoRow -&gt; Const TxIx UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const TxIx Utxo) -&gt; UtxoRow -&gt; Const TxIx UtxoRow)
-&gt; Getting TxIx Utxo TxIx -&gt; Getting TxIx UtxoRow TxIx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Utxo TxIx
Lens' Utxo TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txIx"><span class="hs-identifier hs-var">txIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
-&gt; Getting (Maybe ScriptData) UtxoRow (Maybe ScriptData)
-&gt; Maybe ScriptData
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const (Maybe ScriptData) Utxo)
-&gt; UtxoRow -&gt; Const (Maybe ScriptData) UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const (Maybe ScriptData) Utxo)
 -&gt; UtxoRow -&gt; Const (Maybe ScriptData) UtxoRow)
-&gt; ((Maybe ScriptData
     -&gt; Const (Maybe ScriptData) (Maybe ScriptData))
    -&gt; Utxo -&gt; Const (Maybe ScriptData) Utxo)
-&gt; Getting (Maybe ScriptData) UtxoRow (Maybe ScriptData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ScriptData -&gt; Const (Maybe ScriptData) (Maybe ScriptData))
-&gt; Utxo -&gt; Const (Maybe ScriptData) Utxo
Lens' Utxo (Maybe ScriptData)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#datum"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData) -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
-&gt; Getting
     (Maybe (Hash ScriptData)) UtxoRow (Maybe (Hash ScriptData))
-&gt; Maybe (Hash ScriptData)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const (Maybe (Hash ScriptData)) Utxo)
-&gt; UtxoRow -&gt; Const (Maybe (Hash ScriptData)) UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const (Maybe (Hash ScriptData)) Utxo)
 -&gt; UtxoRow -&gt; Const (Maybe (Hash ScriptData)) UtxoRow)
-&gt; ((Maybe (Hash ScriptData)
     -&gt; Const (Maybe (Hash ScriptData)) (Maybe (Hash ScriptData)))
    -&gt; Utxo -&gt; Const (Maybe (Hash ScriptData)) Utxo)
-&gt; Getting
     (Maybe (Hash ScriptData)) UtxoRow (Maybe (Hash ScriptData))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Hash ScriptData)
 -&gt; Const (Maybe (Hash ScriptData)) (Maybe (Hash ScriptData)))
-&gt; Utxo -&gt; Const (Maybe (Hash ScriptData)) Utxo
Lens' Utxo (Maybe (Hash ScriptData))
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#datumHash"><span class="hs-identifier hs-var">datumHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting Value UtxoRow Value -&gt; Value
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const Value Utxo) -&gt; UtxoRow -&gt; Const Value UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const Value Utxo) -&gt; UtxoRow -&gt; Const Value UtxoRow)
-&gt; ((Value -&gt; Const Value Value) -&gt; Utxo -&gt; Const Value Utxo)
-&gt; Getting Value UtxoRow Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Const Value Value) -&gt; Utxo -&gt; Const Value Utxo
Lens' Utxo Value
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#value"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
-&gt; Getting (Maybe ScriptInAnyLang) UtxoRow (Maybe ScriptInAnyLang)
-&gt; Maybe ScriptInAnyLang
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const (Maybe ScriptInAnyLang) Utxo)
-&gt; UtxoRow -&gt; Const (Maybe ScriptInAnyLang) UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const (Maybe ScriptInAnyLang) Utxo)
 -&gt; UtxoRow -&gt; Const (Maybe ScriptInAnyLang) UtxoRow)
-&gt; ((Maybe ScriptInAnyLang
     -&gt; Const (Maybe ScriptInAnyLang) (Maybe ScriptInAnyLang))
    -&gt; Utxo -&gt; Const (Maybe ScriptInAnyLang) Utxo)
-&gt; Getting (Maybe ScriptInAnyLang) UtxoRow (Maybe ScriptInAnyLang)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ScriptInAnyLang
 -&gt; Const (Maybe ScriptInAnyLang) (Maybe ScriptInAnyLang))
-&gt; Utxo -&gt; Const (Maybe ScriptInAnyLang) Utxo
Lens' Utxo (Maybe ScriptInAnyLang)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#inlineScript"><span class="hs-identifier hs-var">inlineScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
-&gt; Getting (Maybe ScriptHash) UtxoRow (Maybe ScriptHash)
-&gt; Maybe ScriptHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const (Maybe ScriptHash) Utxo)
-&gt; UtxoRow -&gt; Const (Maybe ScriptHash) UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const (Maybe ScriptHash) Utxo)
 -&gt; UtxoRow -&gt; Const (Maybe ScriptHash) UtxoRow)
-&gt; ((Maybe ScriptHash
     -&gt; Const (Maybe ScriptHash) (Maybe ScriptHash))
    -&gt; Utxo -&gt; Const (Maybe ScriptHash) Utxo)
-&gt; Getting (Maybe ScriptHash) UtxoRow (Maybe ScriptHash)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ScriptHash -&gt; Const (Maybe ScriptHash) (Maybe ScriptHash))
-&gt; Utxo -&gt; Const (Maybe ScriptHash) Utxo
Lens' Utxo (Maybe ScriptHash)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#inlineScriptHash"><span class="hs-identifier hs-var">inlineScriptHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting SlotNo UtxoRow SlotNo -&gt; SlotNo
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting SlotNo UtxoRow SlotNo
Lens' UtxoRow SlotNo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urSlotNo"><span class="hs-identifier hs-var">urSlotNo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481525"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
-&gt; Getting (Hash BlockHeader) UtxoRow (Hash BlockHeader)
-&gt; Hash BlockHeader
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Hash BlockHeader) UtxoRow (Hash BlockHeader)
Lens' UtxoRow (Hash BlockHeader)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urBlockHash"><span class="hs-identifier hs-var">urBlockHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">FromRow</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>  </span><span id="local-6989586621679481521"><span class="annot"><span class="annottext">fromRow :: RowParser UtxoRow
</span><a href="#local-6989586621679481521"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-var">UtxoRow</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">(Utxo -&gt; SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow)
-&gt; RowParser Utxo
-&gt; RowParser (SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAny
-&gt; TxId
-&gt; TxIx
-&gt; Maybe ScriptData
-&gt; Maybe (Hash ScriptData)
-&gt; Value
-&gt; Maybe ScriptInAnyLang
-&gt; Maybe ScriptHash
-&gt; Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-var">Utxo</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAny
 -&gt; TxId
 -&gt; TxIx
 -&gt; Maybe ScriptData
 -&gt; Maybe (Hash ScriptData)
 -&gt; Value
 -&gt; Maybe ScriptInAnyLang
 -&gt; Maybe ScriptHash
 -&gt; Utxo)
-&gt; RowParser AddressAny
-&gt; RowParser
     (TxId
      -&gt; TxIx
      -&gt; Maybe ScriptData
      -&gt; Maybe (Hash ScriptData)
      -&gt; Value
      -&gt; Maybe ScriptInAnyLang
      -&gt; Maybe ScriptHash
      -&gt; Utxo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser AddressAny
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-293"></span><span>           </span><span class="annot"><span class="annottext">RowParser
  (TxId
   -&gt; TxIx
   -&gt; Maybe ScriptData
   -&gt; Maybe (Hash ScriptData)
   -&gt; Value
   -&gt; Maybe ScriptInAnyLang
   -&gt; Maybe ScriptHash
   -&gt; Utxo)
-&gt; RowParser TxId
-&gt; RowParser
     (TxIx
      -&gt; Maybe ScriptData
      -&gt; Maybe (Hash ScriptData)
      -&gt; Value
      -&gt; Maybe ScriptInAnyLang
      -&gt; Maybe ScriptHash
      -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser TxId
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser
  (TxIx
   -&gt; Maybe ScriptData
   -&gt; Maybe (Hash ScriptData)
   -&gt; Value
   -&gt; Maybe ScriptInAnyLang
   -&gt; Maybe ScriptHash
   -&gt; Utxo)
-&gt; RowParser TxIx
-&gt; RowParser
     (Maybe ScriptData
      -&gt; Maybe (Hash ScriptData)
      -&gt; Value
      -&gt; Maybe ScriptInAnyLang
      -&gt; Maybe ScriptHash
      -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser TxIx
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-294"></span><span>           </span><span class="annot"><span class="annottext">RowParser
  (Maybe ScriptData
   -&gt; Maybe (Hash ScriptData)
   -&gt; Value
   -&gt; Maybe ScriptInAnyLang
   -&gt; Maybe ScriptHash
   -&gt; Utxo)
-&gt; RowParser (Maybe ScriptData)
-&gt; RowParser
     (Maybe (Hash ScriptData)
      -&gt; Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe ScriptData)
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser
  (Maybe (Hash ScriptData)
   -&gt; Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
-&gt; RowParser (Maybe (Hash ScriptData))
-&gt; RowParser
     (Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe (Hash ScriptData))
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser
  (Value -&gt; Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
-&gt; RowParser Value
-&gt; RowParser (Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser Value
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe ScriptInAnyLang -&gt; Maybe ScriptHash -&gt; Utxo)
-&gt; RowParser (Maybe ScriptInAnyLang)
-&gt; RowParser (Maybe ScriptHash -&gt; Utxo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe ScriptInAnyLang)
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe ScriptHash -&gt; Utxo)
-&gt; RowParser (Maybe ScriptHash) -&gt; RowParser Utxo
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe ScriptHash)
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><span class="annottext">RowParser (SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow)
-&gt; RowParser SlotNo -&gt; RowParser (Hash BlockHeader -&gt; UtxoRow)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser SlotNo
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Hash BlockHeader -&gt; UtxoRow)
-&gt; RowParser (Hash BlockHeader) -&gt; RowParser UtxoRow
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Hash BlockHeader)
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">FromRow</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-type">Spent</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621679481519"><span class="annot"><span class="annottext">fromRow :: RowParser Spent
</span><a href="#local-6989586621679481519"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; SlotNo -&gt; Hash BlockHeader -&gt; Spent
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-var">Spent</span></a></span><span> </span><span class="annot"><span class="annottext">(TxId -&gt; TxIx -&gt; SlotNo -&gt; Hash BlockHeader -&gt; Spent)
-&gt; RowParser TxId
-&gt; RowParser (TxIx -&gt; SlotNo -&gt; Hash BlockHeader -&gt; Spent)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser TxId
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (TxIx -&gt; SlotNo -&gt; Hash BlockHeader -&gt; Spent)
-&gt; RowParser TxIx
-&gt; RowParser (SlotNo -&gt; Hash BlockHeader -&gt; Spent)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser TxIx
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (SlotNo -&gt; Hash BlockHeader -&gt; Spent)
-&gt; RowParser SlotNo -&gt; RowParser (Hash BlockHeader -&gt; Spent)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser SlotNo
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Hash BlockHeader -&gt; Spent)
-&gt; RowParser (Hash BlockHeader) -&gt; RowParser Spent
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Hash BlockHeader)
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">FromRow</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-type">ChainPointRow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621679481517"><span class="annot"><span class="annottext">fromRow :: RowParser ChainPointRow
</span><a href="#local-6989586621679481517"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; ChainPointRow)
-&gt; RowParser ChainPoint -&gt; RowParser ChainPointRow
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; ChainPointRow
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ChainPointRow"><span class="hs-identifier hs-var">ChainPointRow</span></a></span><span> </span><span class="annot"><span class="annottext">(RowParser ChainPoint -&gt; RowParser ChainPointRow)
-&gt; RowParser ChainPoint -&gt; RowParser ChainPointRow
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint)
-&gt; RowParser SlotNo -&gt; RowParser (Hash BlockHeader -&gt; ChainPoint)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser SlotNo
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Hash BlockHeader -&gt; ChainPoint)
-&gt; RowParser (Hash BlockHeader) -&gt; RowParser ChainPoint
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RowParser (Hash BlockHeader)
forall a. FromField a =&gt; RowParser a
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">ToRow</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-type">Spent</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621679481515"><span class="annot"><span class="annottext">toRow :: Spent -&gt; [SQLData]
</span><a href="#local-6989586621679481515"><span class="hs-identifier hs-var hs-var hs-var hs-var">toRow</span></a></span></span><span> </span><span id="local-6989586621679481514"><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481514"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481514"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting TxId Spent TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxId Spent TxId
Lens' Spent TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sTxId"><span class="hs-identifier hs-var">sTxId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIx -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481514"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting TxIx Spent TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Spent TxIx
Lens' Spent TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sTxIx"><span class="hs-identifier hs-var">sTxIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481514"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Spent -&gt; Getting SlotNo Spent SlotNo -&gt; SlotNo
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting SlotNo Spent SlotNo
Lens' Spent SlotNo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sSlotNo"><span class="hs-identifier hs-var">sSlotNo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">toField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spent
</span><a href="#local-6989586621679481514"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Spent
-&gt; Getting (Hash BlockHeader) Spent (Hash BlockHeader)
-&gt; Hash BlockHeader
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Hash BlockHeader) Spent (Hash BlockHeader)
Lens' Spent (Hash BlockHeader)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#sBlockHash"><span class="hs-identifier hs-var">sBlockHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- | Open a connection to DB, and create resources</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- The parameter ((k + 1) * 2) specifies the amount of events that are buffered.</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- The larger the number, the more RAM the indexer uses. However, we get improved SQL</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- queries due to batching more events together.</span><span>
</span><span id="line-315"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#open"><span class="hs-identifier hs-type">open</span></a></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span>   </span><span class="hs-comment">-- ^ sqlite file path</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Depth"><span class="hs-identifier hs-type">Depth</span></a></span><span>      </span><span class="hs-comment">-- ^ The Depth parameter k, the larger K, the more RAM the indexer uses</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>       </span><span class="hs-comment">-- ^ whether to perform vacuum</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoIndexer"><span class="hs-identifier hs-type">UtxoIndexer</span></a></span><span>
</span><span id="line-320"></span><span id="open"><span class="annot"><span class="annottext">open :: String -&gt; Depth -&gt; Bool -&gt; IO UtxoIndexer
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#open"><span class="hs-identifier hs-var hs-var">open</span></a></span></span><span> </span><span id="local-6989586621679481511"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679481511"><span class="hs-identifier hs-var">dbPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Depth"><span class="hs-identifier hs-type">Depth</span></a></span><span> </span><span id="local-6989586621679481510"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481510"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481509"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679481509"><span class="hs-identifier hs-var">isToVacuume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>  </span><span id="local-6989586621679481508"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Connection
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.open</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679481511"><span class="hs-identifier hs-var">dbPath</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;PRAGMA journal_mode=WAL&quot;</span></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="">[r|CREATE TABLE IF NOT EXISTS unspent_transactions
                      ( address TEXT NOT NULL
                      , txId TEXT NOT NULL
                      , txIx INT NOT NULL
                      , datum BLOB
                      , datumHash BLOB
                      , value BLOB
                      , inlineScript BLOB
                      , inlineScriptHash BLOB
                      , slotNo INT NOT NULL
                      , blockHash BLOB NOT NULL
                      , UNIQUE (txId, txIx))|]</span></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="">[r|CREATE TABLE IF NOT EXISTS spent
                      ( txId TEXT NOT NULL
                      , txIx INT NOT NULL
                      , slotNo INT NOT NULL
                      , blockHash BLOB NOT NULL
                      , UNIQUE (txId, txIx))|]</span></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="">[r|CREATE INDEX IF NOT EXISTS
                      spent_slotNo ON spent (slotNo)|]</span></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="">[r|CREATE INDEX IF NOT EXISTS
                      unspent_transaction_address ON unspent_transactions (address)|]</span></span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; UtxoHandle -&gt; StorableMonad UtxoHandle UtxoIndexer
forall h.
PrimMonad (StorableMonad h) =&gt;
Int -&gt; h -&gt; StorableMonad h (State h)
</span><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">emptyState</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481510"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Int -&gt; Bool -&gt; UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-var">UtxoHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481510"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679481509"><span class="hs-identifier hs-var">isToVacuume</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getSpentFrom"><span class="hs-identifier hs-type">getSpentFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-type">Spent</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-353"></span><span id="getSpentFrom"><span class="annot"><span class="annottext">getSpentFrom :: StorableEvent UtxoHandle -&gt; [Spent]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getSpentFrom"><span class="hs-identifier hs-var hs-var">getSpentFrom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481504"><span class="annot"><a href="#local-6989586621679481504"><span class="hs-identifier hs-var">txIns</span></a></span></span><span> </span><span id="local-6989586621679481503"><span class="annot"><a href="#local-6989586621679481503"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481503"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- There are no Spent in the Genesis block</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481502"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481502"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span id="local-6989586621679481501"><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481501"><span class="hs-identifier hs-var">bh</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(TxIn -&gt; Spent) -&gt; [TxIn] -&gt; [Spent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span id="local-6989586621679481500"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481500"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621679481499"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481499"><span class="hs-identifier hs-var">txix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; SlotNo -&gt; Hash BlockHeader -&gt; Spent
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#Spent"><span class="hs-identifier hs-var">Spent</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481500"><span class="hs-identifier hs-var">txid</span></a></span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481499"><span class="hs-identifier hs-var">txix</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481502"><span class="hs-identifier hs-var">sn</span></a></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481501"><span class="hs-identifier hs-var">bh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; [Spent]) -&gt; (Set TxIn -&gt; [TxIn]) -&gt; Set TxIn -&gt; [Spent]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; [TxIn]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TxIn -&gt; [Spent]) -&gt; Set TxIn -&gt; [Spent]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481504"><span class="hs-identifier hs-var">txIns</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | Store UtxoEvents</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- Events are stored in memory and flushed to SQL, disk, when memory buffer has reached capacity</span><span>
</span><span id="line-359"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">Buffered</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-360"></span><span>  </span><span id="local-6989586621679481494"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">persistToStorage</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481494"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481494"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ ues to store</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-comment">-- ^ handler for storing events</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableMonad</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span></span><span>
</span><span id="line-365"></span><span>  </span><span id="local-6989586621679481493"><span class="annot"><span class="annottext">persistToStorage :: f (StorableEvent UtxoHandle)
-&gt; UtxoHandle -&gt; StorableMonad UtxoHandle UtxoHandle
</span><a href="#local-6989586621679481493"><span class="hs-identifier hs-var hs-var hs-var hs-var">persistToStorage</span></a></span></span><span> </span><span id="local-6989586621679481492"><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481492"><span class="hs-identifier hs-var">events</span></a></span></span><span> </span><span id="local-6989586621679481491"><span class="annot"><span class="annottext">UtxoHandle
</span><a href="#local-6989586621679481491"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679481490"><span class="annot"><span class="annottext">rows :: [UtxoRow]
</span><a href="#local-6989586621679481490"><span class="hs-identifier hs-var hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; [UtxoRow])
-&gt; f (StorableEvent UtxoHandle) -&gt; [UtxoRow]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventToRows"><span class="hs-identifier hs-var">eventToRows</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481492"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span id="local-6989586621679481487"><span class="annot"><span class="annottext">spents :: [Spent]
</span><a href="#local-6989586621679481487"><span class="hs-identifier hs-var hs-var">spents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; [Spent])
-&gt; f (StorableEvent UtxoHandle) -&gt; [Spent]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; [Spent]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getSpentFrom"><span class="hs-identifier hs-var">getSpentFrom</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481492"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span id="local-6989586621679481486"><span class="annot"><span class="annottext">c :: Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UtxoHandle -&gt; Connection
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#hdlConnection"><span class="hs-identifier hs-var hs-var">hdlConnection</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoHandle
</span><a href="#local-6989586621679481491"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO () -&gt; IO ()
forall a b c. IO a -&gt; IO b -&gt; IO c -&gt; IO c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">bracket_</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;BEGIN&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;COMMIT&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO ()
</span><a href="../../../../async/html/src"><span class="hs-identifier hs-var">concurrently_</span></a></span><span>
</span><span id="line-373"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span>
</span><span id="line-374"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UtxoRow] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481490"><span class="hs-identifier hs-var">rows</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [UtxoRow] -&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; [q] -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeMany</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><span class="">[r|INSERT
               OR REPLACE INTO unspent_transactions (
                 address,
                 txId,
                 txIx,
                 datum,
                 datumHash,
                 value,
                 inlineScript,
                 inlineScriptHash,
                 slotNo,
                 blockHash
              ) VALUES
              (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)|]</span></span><span> </span><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481490"><span class="hs-identifier hs-var">rows</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span>
</span><span id="line-391"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Spent] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Spent]
</span><a href="#local-6989586621679481487"><span class="hs-identifier hs-var">spents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [Spent] -&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; [q] -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeMany</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-393"></span><span>           </span><span class="annot"><span class="">[r|INSERT
              OR REPLACE INTO spent (
                txId,
                txIx, slotNo, blockHash
              ) VALUES
              (?, ?, ?, ?)|]</span></span><span> </span><span class="annot"><span class="annottext">[Spent]
</span><a href="#local-6989586621679481487"><span class="hs-identifier hs-var">spents</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-comment">-- We want to perform vacuum about once every 100</span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoHandle -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#toVacuume"><span class="hs-identifier hs-var hs-var">toVacuume</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoHandle
</span><a href="#local-6989586621679481491"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>      </span><span id="local-6989586621679481483"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481483"><span class="hs-identifier hs-var">rndCheck</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Gen RealWorld)
IO GenIO
</span><a href="../../../../mwc-random/html/src"><span class="hs-identifier hs-var">createSystemRandom</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Gen RealWorld) -&gt; (Gen RealWorld -&gt; IO Int) -&gt; IO Int
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; GenIO -&gt; IO Int
forall a (m :: * -&gt; *).
(Variate a, PrimMonad m) =&gt;
(a, a) -&gt; Gen (PrimState m) -&gt; m a
</span><a href="../../../../mwc-random/html/src"><span class="hs-identifier hs-var">uniformR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481483"><span class="hs-identifier hs-var">rndCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="">[r|DELETE FROM
                            unspent_transactions
                          WHERE
                            unspent_transactions.rowid IN (
                              SELECT
                                unspent_transactions.rowid
                              FROM
                                unspent_transactions
                                JOIN spent ON unspent_transactions.txId = spent.txId
                                AND unspent_transactions.txIx = spent.txIx
                            )|]</span></span><span>
</span><span id="line-414"></span><span>        </span><span class="hs-comment">-- remove Spent and release space, see https://www.sqlite.org/lang_vacuum.html</span><span>
</span><span id="line-415"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481486"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;VACUUM&quot;</span></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><span class="annottext">UtxoHandle -&gt; IO UtxoHandle
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoHandle
</span><a href="#local-6989586621679481491"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">getStoredEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableMonad</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621679481482"><span class="annot"><span class="annottext">getStoredEvents :: UtxoHandle -&gt; StorableMonad UtxoHandle [StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481482"><span class="hs-identifier hs-var hs-var hs-var hs-var">getStoredEvents</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span id="local-6989586621679481481"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481481"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679481480"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481480"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621679481479"><span class="annot"><span class="annottext">[[Integer]]
</span><a href="#local-6989586621679481479"><span class="hs-identifier hs-var">sns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only Int -&gt; IO [[Integer]]
forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.query</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481481"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="">[r|SELECT
              slotNo
           FROM
              unspent_transactions
           GROUP BY
              slotNo
           ORDER BY
              slotNo DESC
           LIMIT ?|]</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Only Int
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481480"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- Take the slot number of the sz'th slot</span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679481476"><span class="annot"><span class="annottext">sn :: Integer
</span><a href="#local-6989586621679481476"><span class="hs-identifier hs-var hs-var">sn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[[Integer]] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[[Integer]]
</span><a href="#local-6989586621679481479"><span class="hs-identifier hs-var">sns</span></a></span><span>
</span><span id="line-433"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-434"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Integer] -&gt; Integer
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([Integer] -&gt; Integer)
-&gt; ([[Integer]] -&gt; [Integer]) -&gt; [[Integer]] -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[[Integer]] -&gt; [Integer]
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">([[Integer]] -&gt; Integer) -&gt; [[Integer]] -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [[Integer]] -&gt; [[Integer]]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481480"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">[[Integer]]
</span><a href="#local-6989586621679481479"><span class="hs-identifier hs-var">sns</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621679481472"><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481472"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only Integer -&gt; IO [UtxoRow]
forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.query</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481481"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><span class="">[r|SELECT
              u.address,
              u.txId,
              u.txIx,
              u.datum,
              u.datumHash,
              u.value,
              u.inlineScript,
              u.inlineScriptHash,
              u.slotNo,
              u.blockHash
           FROM
              unspent_transactions u
           WHERE
              u.slotNo &gt;= ?
           GROUP by
              u.slotNo
           ORDER BY
              u.slotNo ASC|]</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Only Integer
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679481476"><span class="hs-identifier hs-var">sn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>    </span><span class="annot"><span class="annottext">(SlotNo -&gt; IO (Set TxIn))
-&gt; [UtxoRow] -&gt; IO [StorableEvent UtxoHandle]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#rowsToEvents"><span class="hs-identifier hs-var">rowsToEvents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; SlotNo -&gt; IO (Set TxIn)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getTxIns"><span class="hs-identifier hs-var">getTxIns</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481481"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481472"><span class="hs-identifier hs-var">rows</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="hs-comment">-- | Retrieve TxIns at a slotNo</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- This function is used to reconstruct the original UtxoEvent</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getTxIns"><span class="hs-identifier hs-type">getTxIns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span id="getTxIns"><span class="annot"><span class="annottext">getTxIns :: Connection -&gt; SlotNo -&gt; IO (Set TxIn)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getTxIns"><span class="hs-identifier hs-var hs-var">getTxIns</span></a></span></span><span> </span><span id="local-6989586621679481469"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481469"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679481468"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481468"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only SlotNo -&gt; IO [TxIn]
forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.query</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481469"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT txInTxId, txInTxIx FROM spent WHERE slotNo =?&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Only SlotNo
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481468"><span class="hs-identifier hs-var">sn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><span class="annottext">IO [TxIn] -&gt; ([TxIn] -&gt; Set TxIn) -&gt; IO (Set TxIn)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; Set TxIn
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-comment">-- | Convert UtxoRows to UtxoEvents</span><span>
</span><span id="line-467"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#rowsToEvents"><span class="hs-identifier hs-type">rowsToEvents</span></a></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ function to fetch TxIn</span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span>                      </span><span class="hs-comment">-- ^ rows to convert back to event</span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ utxo events</span><span>
</span><span id="line-471"></span><span id="rowsToEvents"><span class="annot"><span class="annottext">rowsToEvents :: (SlotNo -&gt; IO (Set TxIn))
-&gt; [UtxoRow] -&gt; IO [StorableEvent UtxoHandle]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#rowsToEvents"><span class="hs-identifier hs-var hs-var">rowsToEvents</span></a></span></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; IO (Set TxIn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle] -&gt; IO [StorableEvent UtxoHandle]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-472"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#rowsToEvents"><span class="hs-identifier hs-var">rowsToEvents</span></a></span><span>  </span><span id="local-6989586621679481466"><span class="annot"><span class="annottext">SlotNo -&gt; IO (Set TxIn)
</span><a href="#local-6989586621679481466"><span class="hs-identifier hs-var">fetchTxIn</span></a></span></span><span> </span><span id="local-6989586621679481465"><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481465"><span class="hs-identifier hs-var">rows</span></a></span></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ChainPoint, [StorableEvent UtxoHandle])
 -&gt; IO (StorableEvent UtxoHandle))
-&gt; [(ChainPoint, [StorableEvent UtxoHandle])]
-&gt; IO [StorableEvent UtxoHandle]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint, [StorableEvent UtxoHandle])
-&gt; IO (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481463"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">[(ChainPoint, [StorableEvent UtxoHandle])]
</span><a href="#local-6989586621679481462"><span class="hs-identifier hs-var">eventsMap</span></a></span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="annottext">IO [StorableEvent UtxoHandle]
-&gt; ([StorableEvent UtxoHandle] -&gt; [StorableEvent UtxoHandle])
-&gt; IO [StorableEvent UtxoHandle]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Ordering)
-&gt; [StorableEvent UtxoHandle] -&gt; [StorableEvent UtxoHandle]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481461"><span class="annot"><a href="#local-6989586621679481461"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481460"><span class="annot"><a href="#local-6989586621679481460"><span class="hs-identifier hs-var">cp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; ChainPoint -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">compare</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481460"><span class="hs-identifier hs-var">cp'</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481461"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><a href="#local-6989586621679481459"><span class="hs-identifier hs-type">mkEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span id="local-6989586621679481459"><span class="annot"><span class="annottext">mkEvent :: UtxoRow -&gt; StorableEvent UtxoHandle
</span><a href="#local-6989586621679481459"><span class="hs-identifier hs-var hs-var">mkEvent</span></a></span></span><span> </span><span id="local-6989586621679481458"><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481458"><span class="hs-identifier hs-var">row</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span><span>
</span><span id="line-478"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utxo -&gt; Set Utxo
forall a. a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Set Utxo) -&gt; Utxo -&gt; Set Utxo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481458"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting Utxo UtxoRow Utxo -&gt; Utxo
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Utxo UtxoRow Utxo
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>       </span><span class="annot"><span class="annottext">Set TxIn
forall a. Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span>
</span><span id="line-480"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481458"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting SlotNo UtxoRow SlotNo -&gt; SlotNo
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting SlotNo UtxoRow SlotNo
Lens' UtxoRow SlotNo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urSlotNo"><span class="hs-identifier hs-var">urSlotNo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481458"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow
-&gt; Getting (Hash BlockHeader) UtxoRow (Hash BlockHeader)
-&gt; Hash BlockHeader
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Hash BlockHeader) UtxoRow (Hash BlockHeader)
Lens' UtxoRow (Hash BlockHeader)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urBlockHash"><span class="hs-identifier hs-var">urBlockHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="#local-6989586621679481456"><span class="hs-identifier hs-type">newEventWithSpentOnly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621679481456"><span class="annot"><span class="annottext">newEventWithSpentOnly :: Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="#local-6989586621679481456"><span class="hs-identifier hs-var hs-var">newEventWithSpentOnly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
forall a. Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="#local-6989586621679481463"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>    </span><span id="local-6989586621679481463"><span class="annot"><span class="annottext">reduce :: (ChainPoint, [StorableEvent UtxoHandle])
-&gt; IO (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481463"><span class="hs-identifier hs-var hs-var">reduce</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; IO (StorableEvent UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; IO (StorableEvent UtxoHandle))
-&gt; StorableEvent UtxoHandle -&gt; IO (StorableEvent UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
forall a. Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
forall a. Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="#local-6989586621679481463"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481455"><span class="annot"><span class="annottext">cp :: ChainPoint
</span><a href="#local-6989586621679481455"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481454"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481454"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481453"><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481453"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>                     </span><span id="local-6989586621679481452"><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481452"><span class="hs-identifier hs-var">tins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; IO (Set TxIn)
</span><a href="#local-6989586621679481466"><span class="hs-identifier hs-var">fetchTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481454"><span class="hs-identifier hs-var">sn</span></a></span><span>
</span><span id="line-489"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679481451"><span class="annot"><span class="annottext">newE :: StorableEvent UtxoHandle
</span><a href="#local-6989586621679481451"><span class="hs-identifier hs-var hs-var">newE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="#local-6989586621679481456"><span class="hs-identifier hs-var">newEventWithSpentOnly</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481452"><span class="hs-identifier hs-var">tins</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481455"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-490"></span><span>                     </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; IO (StorableEvent UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; IO (StorableEvent UtxoHandle))
-&gt; ([StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
-&gt; IO (StorableEvent UtxoHandle)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; IO (StorableEvent UtxoHandle))
-&gt; [StorableEvent UtxoHandle] -&gt; IO (StorableEvent UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481451"><span class="hs-identifier hs-var">newE</span></a></span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
-&gt; [StorableEvent UtxoHandle] -&gt; [StorableEvent UtxoHandle]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481453"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="#local-6989586621679481462"><span class="hs-identifier hs-type">eventsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621679481462"><span class="annot"><span class="annottext">eventsMap :: [(ChainPoint, [StorableEvent UtxoHandle])]
</span><a href="#local-6989586621679481462"><span class="hs-identifier hs-var hs-var">eventsMap</span></a></span></span><span>
</span><span id="line-494"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle]
 -&gt; (ChainPoint, [StorableEvent UtxoHandle]))
-&gt; [[StorableEvent UtxoHandle]]
-&gt; [(ChainPoint, [StorableEvent UtxoHandle])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481450"><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481450"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueChainPoint"><span class="hs-identifier hs-var hs-var">ueChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; ChainPoint)
-&gt; ([StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
-&gt; ChainPoint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; ChainPoint)
-&gt; [StorableEvent UtxoHandle] -&gt; ChainPoint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481450"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481450"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>            </span><span class="annot"><span class="annottext">([[StorableEvent UtxoHandle]]
 -&gt; [(ChainPoint, [StorableEvent UtxoHandle])])
-&gt; ([UtxoRow] -&gt; [[StorableEvent UtxoHandle]])
-&gt; [UtxoRow]
-&gt; [(ChainPoint, [StorableEvent UtxoHandle])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; [StorableEvent UtxoHandle] -&gt; [[StorableEvent UtxoHandle]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">groupBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481449"><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481449"><span class="hs-identifier hs-var">el</span></a></span></span><span> </span><span id="local-6989586621679481448"><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481448"><span class="hs-identifier hs-var">er</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueChainPoint"><span class="hs-identifier hs-var hs-var">ueChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481449"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; ChainPoint -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueChainPoint"><span class="hs-identifier hs-var hs-var">ueChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481448"><span class="hs-identifier hs-var">er</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>            </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; [[StorableEvent UtxoHandle]])
-&gt; ([UtxoRow] -&gt; [StorableEvent UtxoHandle])
-&gt; [UtxoRow]
-&gt; [[StorableEvent UtxoHandle]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoRow -&gt; StorableEvent UtxoHandle)
-&gt; [UtxoRow] -&gt; [StorableEvent UtxoHandle]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; StorableEvent UtxoHandle
</span><a href="#local-6989586621679481459"><span class="hs-identifier hs-var">mkEvent</span></a></span><span>
</span><span id="line-497"></span><span>            </span><span class="annot"><span class="annottext">([UtxoRow] -&gt; [(ChainPoint, [StorableEvent UtxoHandle])])
-&gt; [UtxoRow] -&gt; [(ChainPoint, [StorableEvent UtxoHandle])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481465"><span class="hs-identifier hs-var">rows</span></a></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span class="hs-comment">-- | merge in-memory events with SQL retreived UtxoRows</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- Notes, a peroperty of this merge is to remove all spent utxos from the resulting [UtxoRow]</span><span>
</span><span id="line-501"></span><span id="local-6989586621679482081"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#mergeInMemoryAndSql"><span class="hs-identifier hs-type">mergeInMemoryAndSql</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482081"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679482081"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-506"></span><span id="mergeInMemoryAndSql"><span class="annot"><span class="annottext">mergeInMemoryAndSql :: f (StorableEvent UtxoHandle) -&gt; [UtxoRow] -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#mergeInMemoryAndSql"><span class="hs-identifier hs-var hs-var">mergeInMemoryAndSql</span></a></span></span><span> </span><span id="local-6989586621679481446"><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481446"><span class="hs-identifier hs-var">events</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UtxoRow -&gt; Bool) -&gt; [UtxoRow] -&gt; [UtxoRow]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481445"><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481445"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481445"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting TxId UtxoRow TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const TxId Utxo) -&gt; UtxoRow -&gt; Const TxId UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const TxId Utxo) -&gt; UtxoRow -&gt; Const TxId UtxoRow)
-&gt; Getting TxId Utxo TxId -&gt; Getting TxId UtxoRow TxId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxId Utxo TxId
Lens' Utxo TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txId"><span class="hs-identifier hs-var">txId</span></a></span><span class="hs-special">)</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoRow
</span><a href="#local-6989586621679481445"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoRow -&gt; Getting TxIx UtxoRow TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Const TxIx Utxo) -&gt; UtxoRow -&gt; Const TxIx UtxoRow
Lens' UtxoRow Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#urUtxo"><span class="hs-identifier hs-var">urUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">((Utxo -&gt; Const TxIx Utxo) -&gt; UtxoRow -&gt; Const TxIx UtxoRow)
-&gt; Getting TxIx Utxo TxIx -&gt; Getting TxIx UtxoRow TxIx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Utxo TxIx
Lens' Utxo TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txIx"><span class="hs-identifier hs-var">txIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Set TxIn -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`notElem`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481443"><span class="hs-identifier hs-var">txins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><a href="#local-6989586621679481443"><span class="hs-identifier hs-type">txins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621679481443"><span class="annot"><span class="annottext">txins :: Set TxIn
</span><a href="#local-6989586621679481443"><span class="hs-identifier hs-var hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set TxIn -&gt; StorableEvent UtxoHandle -&gt; Set TxIn)
-&gt; Set TxIn -&gt; f (StorableEvent UtxoHandle) -&gt; Set TxIn
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481442"><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481442"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679481441"><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481441"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueInputs"><span class="hs-identifier hs-var hs-var">ueInputs</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481441"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481442"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set TxIn
forall a. Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481446"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">-- | convert utxoEvent to utxoRow</span><span>
</span><span id="line-512"></span><span class="hs-comment">-- Note: No `unspent` computeation is performed</span><span>
</span><span id="line-513"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventToRows"><span class="hs-identifier hs-type">eventToRows</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span id="eventToRows"><span class="annot"><span class="annottext">eventToRows :: StorableEvent UtxoHandle -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventToRows"><span class="hs-identifier hs-var hs-var">eventToRows</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPointAtGenesis</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- we dont save anyting at genesis.  TODO verify</span><span>
</span><span id="line-515"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventToRows"><span class="hs-identifier hs-var">eventToRows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-type">UtxoEvent</span></a></span><span> </span><span id="local-6989586621679481440"><span class="annot"><a href="#local-6989586621679481440"><span class="hs-identifier hs-var">utxos</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481439"><span class="annot"><a href="#local-6989586621679481439"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span id="local-6989586621679481438"><span class="annot"><a href="#local-6989586621679481438"><span class="hs-identifier hs-var">bhsh</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-516"></span><span>  </span><span class="annot"><span class="annottext">(Utxo -&gt; UtxoRow) -&gt; [Utxo] -&gt; [UtxoRow]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481437"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481437"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UtxoRow :: Utxo -&gt; SlotNo -&gt; Hash BlockHeader -&gt; UtxoRow
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span>
</span><span id="line-517"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_urUtxo :: Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_urUtxo"><span class="hs-identifier hs-var">_urUtxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481437"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-518"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_urSlotNo :: SlotNo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_urSlotNo"><span class="hs-identifier hs-var">_urSlotNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481439"><span class="hs-identifier hs-var">sn</span></a></span><span>
</span><span id="line-519"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_urBlockHash :: Hash BlockHeader
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_urBlockHash"><span class="hs-identifier hs-var">_urBlockHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481438"><span class="hs-identifier hs-var">bhsh</span></a></span><span>
</span><span id="line-520"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-521"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Utxo] -&gt; [UtxoRow])
-&gt; (Set Utxo -&gt; [Utxo]) -&gt; Set Utxo -&gt; [UtxoRow]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo -&gt; [Utxo]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Utxo -&gt; [UtxoRow]) -&gt; Set Utxo -&gt; [UtxoRow]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481440"><span class="hs-identifier hs-var">utxos</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="hs-comment">-- | Filter for events at the given address</span><span>
</span><span id="line-524"></span><span id="local-6989586621679482087"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventsAtAddress"><span class="hs-identifier hs-type">eventsAtAddress</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482087"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span><span> </span><span class="hs-comment">-- ^ Address query</span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span> </span><span class="hs-comment">-- ^ Latest included chainpoint</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679482087"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Utxo event</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Utxo event at thegiven address</span></span><span>
</span><span id="line-530"></span><span id="eventsAtAddress"><span class="annot"><span class="annottext">eventsAtAddress :: AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventsAtAddress"><span class="hs-identifier hs-var hs-var">eventsAtAddress</span></a></span></span><span> </span><span id="local-6989586621679481435"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481435"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481434"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481434"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><a href="#local-6989586621679481433"><span class="hs-identifier hs-type">splitEventAtAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621679481433"><span class="annot"><span class="annottext">splitEventAtAddress :: StorableEvent UtxoHandle -&gt; [StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481433"><span class="hs-identifier hs-var hs-var">splitEventAtAddress</span></a></span></span><span> </span><span id="local-6989586621679481432"><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481432"><span class="hs-identifier hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>        </span><span class="annot"><a href="#local-6989586621679481431"><span class="hs-identifier hs-type">isBeforeSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-537"></span><span>        </span><span id="local-6989586621679481431"><span class="annot"><span class="annottext">isBeforeSlot :: SlotNo -&gt; ChainPoint -&gt; Bool
</span><a href="#local-6989586621679481431"><span class="hs-identifier hs-var hs-var">isBeforeSlot</span></a></span></span><span> </span><span id="local-6989586621679481430"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481430"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-538"></span><span>            </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-539"></span><span>            </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481429"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481429"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481429"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481430"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>        </span><span class="annot"><a href="#local-6989586621679481428"><span class="hs-identifier hs-type">pointFilter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-542"></span><span>        </span><span id="local-6989586621679481428"><span class="annot"><span class="annottext">pointFilter :: Maybe SlotNo -&gt; StorableEvent UtxoHandle -&gt; Bool
</span><a href="#local-6989586621679481428"><span class="hs-identifier hs-var hs-var">pointFilter</span></a></span></span><span> </span><span id="local-6989586621679481427"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481427"><span class="hs-identifier hs-var">ms</span></a></span></span><span>
</span><span id="line-543"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; Bool)
-&gt; (SlotNo -&gt; StorableEvent UtxoHandle -&gt; Bool)
-&gt; Maybe SlotNo
-&gt; StorableEvent UtxoHandle
-&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span>
</span><span id="line-544"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; StorableEvent UtxoHandle -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481424"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481424"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; ChainPoint -&gt; Bool
</span><a href="#local-6989586621679481431"><span class="hs-identifier hs-var">isBeforeSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481424"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; Bool)
-&gt; (StorableEvent UtxoHandle -&gt; ChainPoint)
-&gt; StorableEvent UtxoHandle
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueChainPoint"><span class="hs-identifier hs-var hs-var">ueChainPoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>                </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481427"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><a href="#local-6989586621679481423"><span class="hs-identifier hs-type">addressFilter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-549"></span><span>        </span><span id="local-6989586621679481423"><span class="annot"><span class="annottext">addressFilter :: Utxo -&gt; Bool
</span><a href="#local-6989586621679481423"><span class="hs-identifier hs-var hs-var">addressFilter</span></a></span></span><span> </span><span id="local-6989586621679481422"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481422"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481422"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo
-&gt; ((AddressAny -&gt; Const AddressAny AddressAny)
    -&gt; Utxo -&gt; Const AddressAny Utxo)
-&gt; AddressAny
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAny -&gt; Const AddressAny AddressAny)
-&gt; Utxo -&gt; Const AddressAny Utxo
Lens' Utxo AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#address"><span class="hs-identifier hs-var">address</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AddressAny -&gt; AddressAny -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481435"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><a href="#local-6989586621679481421"><span class="hs-identifier hs-type">utxosAtAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-552"></span><span>        </span><span id="local-6989586621679481421"><span class="annot"><span class="annottext">utxosAtAddress :: Set Utxo
</span><a href="#local-6989586621679481421"><span class="hs-identifier hs-var hs-var">utxosAtAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Bool) -&gt; Set Utxo -&gt; Set Utxo
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.filter</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; Bool
</span><a href="#local-6989586621679481423"><span class="hs-identifier hs-var">addressFilter</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Utxo -&gt; Set Utxo) -&gt; Set Utxo -&gt; Set Utxo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; Set Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueUtxos"><span class="hs-identifier hs-var hs-var">ueUtxos</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481432"><span class="hs-identifier hs-var">event</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
R:StorableEventUtxoHandle
</span><a href="#local-6989586621679481432"><span class="hs-identifier hs-var">event</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ueUtxos :: Set Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueUtxos"><span class="hs-identifier hs-var">ueUtxos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481421"><span class="hs-identifier hs-var">utxosAtAddress</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Utxo -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481421"><span class="hs-identifier hs-var">utxosAtAddress</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo -&gt; StorableEvent UtxoHandle -&gt; Bool
</span><a href="#local-6989586621679481428"><span class="hs-identifier hs-var">pointFilter</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481434"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481432"><span class="hs-identifier hs-var">event</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; [StorableEvent UtxoHandle])
-&gt; f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; [StorableEvent UtxoHandle]
</span><a href="#local-6989586621679481433"><span class="hs-identifier hs-var">splitEventAtAddress</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | only store rows in the address list.</span><span>
</span><span id="line-559"></span><span id="local-6989586621679481417"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#addressFilteredRows"><span class="hs-identifier hs-type">addressFilteredRows</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481417"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span><span>                   </span><span class="hs-comment">-- ^ query</span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span>                 </span><span class="hs-comment">-- ^ latest included chainpoint</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481417"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ Utxo Event</span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span>                      </span><span class="hs-comment">-- ^ Rows at the query</span></span><span>
</span><span id="line-565"></span><span id="addressFilteredRows"><span class="annot"><span class="annottext">addressFilteredRows :: AddressAny
-&gt; Maybe SlotNo -&gt; f (StorableEvent UtxoHandle) -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#addressFilteredRows"><span class="hs-identifier hs-var hs-var">addressFilteredRows</span></a></span></span><span> </span><span id="local-6989586621679481415"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481415"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481414"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481414"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; [UtxoRow])
-&gt; [StorableEvent UtxoHandle] -&gt; [UtxoRow]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventToRows"><span class="hs-identifier hs-var">eventToRows</span></a></span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; [UtxoRow])
-&gt; (f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle])
-&gt; f (StorableEvent UtxoHandle)
-&gt; [UtxoRow]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
-&gt; Maybe SlotNo
-&gt; [StorableEvent UtxoHandle]
-&gt; [StorableEvent UtxoHandle]
forall (f :: * -&gt; *).
Foldable f =&gt;
AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventsAtAddress"><span class="hs-identifier hs-var">eventsAtAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481415"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481414"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; [StorableEvent UtxoHandle])
-&gt; (f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle])
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span id="local-6989586621679482069"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#utxoAtAddressQuery"><span class="hs-identifier hs-type">utxoAtAddressQuery</span></a></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482069"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.Connection</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679482069"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.Query</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ the filter part of the query</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-type">NamedParam</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableResult</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-576"></span><span id="utxoAtAddressQuery"><span class="annot"><span class="annottext">utxoAtAddressQuery :: Connection
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
-&gt; [Query]
-&gt; [NamedParam]
-&gt; IO (StorableResult UtxoHandle)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#utxoAtAddressQuery"><span class="hs-identifier hs-var hs-var">utxoAtAddressQuery</span></a></span></span><span> </span><span id="local-6989586621679481412"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481412"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679481411"><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481411"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621679481410"><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481410"><span class="hs-identifier hs-var">eventAtQuery</span></a></span></span><span> </span><span id="local-6989586621679481409"><span class="annot"><span class="annottext">[Query]
</span><a href="#local-6989586621679481409"><span class="hs-identifier hs-var">filters</span></a></span></span><span> </span><span id="local-6989586621679481408"><span class="annot"><span class="annottext">[NamedParam]
</span><a href="#local-6989586621679481408"><span class="hs-identifier hs-var">params</span></a></span></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679481407"><span class="annot"><span class="annottext">builtQuery :: Query
</span><a href="#local-6989586621679481407"><span class="hs-identifier hs-var hs-var">builtQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-579"></span><span>            </span><span class="annot"><span class="">[r|SELECT
                u.address,
                u.txId,
                u.txIx,
                u.datum,
                u.datumHash,
                u.value,
                u.inlineScript,
                u.inlineScriptHash,
                u.slotNo,
                u.blockHash
               FROM
                unspent_transactions u
                LEFT JOIN spent s ON u.txId = s.txId
                AND u.txIx = s.txIx
               WHERE s.txId IS NULL
                AND s.txIx IS NULL
                AND |]</span></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Query
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">Text.intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; AND &quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Text
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var hs-var">SQL.fromQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(Query -&gt; Text) -&gt; [Query] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Query]
</span><a href="#local-6989586621679481409"><span class="hs-identifier hs-var">filters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-597"></span><span>            </span><span class="annot"><span class="">[r| ORDER BY
                u.slotNo ASC |]</span></span><span>
</span><span id="line-599"></span><span>    </span><span id="local-6989586621679481403"><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481403"><span class="hs-identifier hs-var">persistedUtxoRows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoRow"><span class="hs-identifier hs-type">UtxoRow</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [UtxoRow]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.queryNamed</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481412"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679481407"><span class="hs-identifier hs-var">builtQuery</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedParam]
</span><a href="#local-6989586621679481408"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-600"></span><span>    </span><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><span class="annottext">(StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle))
-&gt; StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UtxoRow] -&gt; StorableResult UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoResult"><span class="hs-identifier hs-var">UtxoResult</span></a></span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><span class="annottext">([UtxoRow] -&gt; StorableResult UtxoHandle)
-&gt; [UtxoRow] -&gt; StorableResult UtxoHandle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle) -&gt; [UtxoRow] -&gt; [UtxoRow]
forall (f :: * -&gt; *).
Foldable f =&gt;
f (StorableEvent UtxoHandle) -&gt; [UtxoRow] -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#mergeInMemoryAndSql"><span class="hs-identifier hs-var">mergeInMemoryAndSql</span></a></span><span>
</span><span id="line-603"></span><span>          </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481411"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-604"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UtxoRow]
</span><a href="#local-6989586621679481403"><span class="hs-identifier hs-var">persistedUtxoRows</span></a></span><span> </span><span class="annot"><span class="annottext">[UtxoRow] -&gt; [UtxoRow] -&gt; [UtxoRow]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; [UtxoRow]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventToRows"><span class="hs-identifier hs-var">eventToRows</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481410"><span class="hs-identifier hs-var">eventAtQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="hs-comment">-- | Query the data stored in the indexer</span><span>
</span><span id="line-607"></span><span class="hs-comment">-- Quries SQL + buffered data, where buffered data is the data that will be batched to SQL</span><span>
</span><span id="line-608"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">Queryable</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-609"></span><span>  </span><span id="local-6989586621679481399"><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">queryStorage</span></a></span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">QueryInterval</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-comment">-- ^ It's a legacy parameter, it has no effect on the code and will be removed</span><span>
</span><span id="line-612"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableQuery</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableResult</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-616"></span><span>  </span><span id="local-6989586621679481398"><span class="annot"><span class="annottext">queryStorage :: QueryInterval ChainPoint
-&gt; f (StorableEvent UtxoHandle)
-&gt; UtxoHandle
-&gt; StorableQuery UtxoHandle
-&gt; IO (StorableResult UtxoHandle)
</span><a href="#local-6989586621679481398"><span class="hs-identifier hs-var hs-var hs-var hs-var">queryStorage</span></a></span></span><span> </span><span id="local-6989586621679481397"><span class="annot"><span class="annottext">QueryInterval ChainPoint
</span><a href="#local-6989586621679481397"><span class="hs-identifier hs-var">qi</span></a></span></span><span> </span><span id="local-6989586621679481396"><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481396"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span id="local-6989586621679481395"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481395"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoByAddress"><span class="hs-identifier hs-type">UtxoByAddress</span></a></span><span> </span><span id="local-6989586621679481394"><span class="annot"><a href="#local-6989586621679481394"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481393"><span class="annot"><a href="#local-6989586621679481393"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span>    </span><span id="local-6989586621679481392"><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481392"><span class="hs-identifier hs-var">eventAtQuery</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QueryInterval ChainPoint
-&gt; AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
forall (f :: * -&gt; *).
Foldable f =&gt;
QueryInterval ChainPoint
-&gt; AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#queryBuffer"><span class="hs-identifier hs-var">queryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">QueryInterval ChainPoint
</span><a href="#local-6989586621679481397"><span class="hs-identifier hs-var">qi</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481394"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481393"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481396"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- query in-memory and conver to row</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>    </span><span id="local-6989586621679481390"><span class="annot"><span class="annottext">filters :: ([Query], [NamedParam])
</span><a href="#local-6989586621679481390"><span class="hs-identifier hs-var hs-var">filters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;u.address = :address&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:address&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; AddressAny -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481394"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>           </span><span class="annot"><span class="annottext">([Query], [NamedParam])
-&gt; ([Query], [NamedParam]) -&gt; ([Query], [NamedParam])
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">([Query], [NamedParam])
-&gt; (SlotNo -&gt; ([Query], [NamedParam]))
-&gt; Maybe SlotNo
-&gt; ([Query], [NamedParam])
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">([Query], [NamedParam])
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481389"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481389"><span class="hs-identifier hs-var">sno</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;u.slotNo &lt;= :slotNo&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:slotNo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SlotNo -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481389"><span class="hs-identifier hs-var">sno</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481393"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([Query] -&gt; [NamedParam] -&gt; IO (StorableResult UtxoHandle))
-&gt; ([Query], [NamedParam]) -&gt; IO (StorableResult UtxoHandle)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
-&gt; [Query]
-&gt; [NamedParam]
-&gt; IO (StorableResult UtxoHandle)
forall (f :: * -&gt; *).
Foldable f =&gt;
Connection
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
-&gt; [Query]
-&gt; [NamedParam]
-&gt; IO (StorableResult UtxoHandle)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#utxoAtAddressQuery"><span class="hs-identifier hs-var">utxoAtAddressQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481395"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481396"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><a href="#local-6989586621679481392"><span class="hs-identifier hs-var">eventAtQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Query], [NamedParam])
</span><a href="#local-6989586621679481390"><span class="hs-identifier hs-var">filters</span></a></span><span>
</span><span id="line-624"></span><span>  </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">queryStorage</span></a></span><span> </span><span class="annot"><span class="annottext">QueryInterval ChainPoint
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481387"><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481387"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span id="local-6989586621679481386"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481386"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StorableQuery UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#LastSyncPoint"><span class="hs-identifier hs-var">LastSyncPoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-625"></span><span>      </span><span id="local-6989586621679481385"><span class="annot"><span class="annottext">queryLastSlot :: Query
</span><a href="#local-6989586621679481385"><span class="hs-identifier hs-var hs-var">queryLastSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[r|SELECT u.slotNo, u.blockHash
                     FROM unspent_transactions u
                     GROUP BY u.slotNo
                     ORDER BY u.slotNo DESC
                     LIMIT ? |]</span></span><span>
</span><span id="line-630"></span><span>      </span><span class="hs-comment">-- We don't send the last event but the one before, to ensure that every indexers reached this point</span><span>
</span><span id="line-631"></span><span>      </span><span class="hs-comment">-- It's a hack, which should be removed once we have a proper handling of synchronisation events.</span><span>
</span><span id="line-632"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-633"></span><span>      </span><span class="hs-comment">-- See Note [Last sync chainpoint]</span><span>
</span><span id="line-634"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481387"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-635"></span><span>          </span><span class="hs-comment">-- 2+ elements in memory</span><span>
</span><span id="line-636"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle))
-&gt; (ChainPoint -&gt; StorableResult UtxoHandle)
-&gt; ChainPoint
-&gt; IO (StorableResult UtxoHandle)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; StorableResult UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#LastSyncPointResult"><span class="hs-identifier hs-var">LastSyncPointResult</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; IO (StorableResult UtxoHandle))
-&gt; ChainPoint -&gt; IO (StorableResult UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-637"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Down ChainPoint -&gt; ChainPoint)
-&gt; [Down ChainPoint] -&gt; [ChainPoint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Down ChainPoint -&gt; ChainPoint
forall a. Down a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">getDown</span></a></span><span> </span><span class="annot"><span class="annottext">([Down ChainPoint] -&gt; [ChainPoint])
-&gt; [Down ChainPoint] -&gt; [ChainPoint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Down ChainPoint] -&gt; [Down ChainPoint]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">([Down ChainPoint] -&gt; [Down ChainPoint])
-&gt; [Down ChainPoint] -&gt; [Down ChainPoint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; Down ChainPoint
forall a. a -&gt; Down a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Down</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; Down ChainPoint)
-&gt; (StorableEvent UtxoHandle -&gt; ChainPoint)
-&gt; StorableEvent UtxoHandle
-&gt; Down ChainPoint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">StorableEvent UtxoHandle -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#ueChainPoint"><span class="hs-identifier hs-var hs-var">ueChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; Down ChainPoint)
-&gt; [StorableEvent UtxoHandle] -&gt; [Down ChainPoint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">f (StorableEvent UtxoHandle)
</span><a href="#local-6989586621679481387"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-638"></span><span>                  </span><span class="annot"><span class="annottext">ChainPoint
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679481384"><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481384"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679481383"><span class="annot"><span class="annottext">[ChainPoint]
</span><a href="#local-6989586621679481383"><span class="hs-identifier hs-var">_xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481384"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-639"></span><span>                  </span><span id="local-6989586621679481382"><span class="annot"><span class="annottext">[ChainPoint]
</span><a href="#local-6989586621679481382"><span class="hs-identifier hs-var">_other</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span>
</span><span id="line-640"></span><span>          </span><span class="hs-comment">-- 1 element in memory</span><span>
</span><span id="line-641"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StorableEvent UtxoHandle
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-642"></span><span>              </span><span id="local-6989586621679481381"><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481381"><span class="hs-identifier hs-var">persisted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only Integer -&gt; IO [ChainPointRow]
forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.query</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481386"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679481385"><span class="hs-identifier hs-var">queryLastSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Only Integer
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>              </span><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle))
-&gt; (ChainPoint -&gt; StorableResult UtxoHandle)
-&gt; ChainPoint
-&gt; IO (StorableResult UtxoHandle)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; StorableResult UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#LastSyncPointResult"><span class="hs-identifier hs-var">LastSyncPointResult</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; IO (StorableResult UtxoHandle))
-&gt; ChainPoint -&gt; IO (StorableResult UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481381"><span class="hs-identifier hs-var">persisted</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-644"></span><span>                  </span><span id="local-6989586621679481380"><span class="annot"><span class="annottext">ChainPointRow
</span><a href="#local-6989586621679481380"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ChainPointRow]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPointRow -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getChainPoint"><span class="hs-identifier hs-var hs-var">getChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPointRow
</span><a href="#local-6989586621679481380"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-645"></span><span>                  </span><span id="local-6989586621679481379"><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481379"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span>
</span><span id="line-646"></span><span>          </span><span class="hs-comment">-- 0 element in memory</span><span>
</span><span id="line-647"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-648"></span><span>              </span><span id="local-6989586621679481378"><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481378"><span class="hs-identifier hs-var">persisted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only Integer -&gt; IO [ChainPointRow]
forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.query</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481386"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679481385"><span class="hs-identifier hs-var">queryLastSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Only Integer
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>              </span><span class="annot"><span class="annottext">StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableResult UtxoHandle -&gt; IO (StorableResult UtxoHandle))
-&gt; (ChainPoint -&gt; StorableResult UtxoHandle)
-&gt; ChainPoint
-&gt; IO (StorableResult UtxoHandle)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint -&gt; StorableResult UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#LastSyncPointResult"><span class="hs-identifier hs-var">LastSyncPointResult</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainPoint -&gt; IO (StorableResult UtxoHandle))
-&gt; ChainPoint -&gt; IO (StorableResult UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481378"><span class="hs-identifier hs-var">persisted</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-650"></span><span>                  </span><span class="annot"><span class="annottext">ChainPointRow
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679481377"><span class="annot"><span class="annottext">ChainPointRow
</span><a href="#local-6989586621679481377"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679481376"><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481376"><span class="hs-identifier hs-var">_xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPointRow -&gt; ChainPoint
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getChainPoint"><span class="hs-identifier hs-var hs-var">getChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPointRow
</span><a href="#local-6989586621679481377"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-651"></span><span>                  </span><span id="local-6989586621679481375"><span class="annot"><span class="annottext">[ChainPointRow]
</span><a href="#local-6989586621679481375"><span class="hs-identifier hs-var">_other</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-comment">-- | Query memory buffer</span><span>
</span><span id="line-655"></span><span id="local-6989586621679482074"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#queryBuffer"><span class="hs-identifier hs-type">queryBuffer</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482074"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">QueryInterval</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span><span> </span><span class="hs-comment">-- ^ Query</span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">C.SlotNo</span></a></span><span> </span><span class="hs-comment">-- ^ Latest included point</span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679482074"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Utxo events</span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span></span><span>
</span><span id="line-662"></span><span id="queryBuffer"><span class="annot"><span class="annottext">queryBuffer :: QueryInterval ChainPoint
-&gt; AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#queryBuffer"><span class="hs-identifier hs-var hs-var">queryBuffer</span></a></span></span><span> </span><span class="annot"><span class="annottext">QueryInterval ChainPoint
</span><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">QEverything</span></a></span><span> </span><span id="local-6989586621679481374"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481374"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481373"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481373"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle)
-&gt; (f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle])
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
forall (f :: * -&gt; *).
Foldable f =&gt;
AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventsAtAddress"><span class="hs-identifier hs-var">eventsAtAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481374"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481373"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-663"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#queryBuffer"><span class="hs-identifier hs-var">queryBuffer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">QInterval</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481372"><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481372"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481371"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481371"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481370"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481370"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; StorableEvent UtxoHandle)
-&gt; (f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle])
-&gt; f (StorableEvent UtxoHandle)
-&gt; StorableEvent UtxoHandle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StorableEvent UtxoHandle -&gt; Bool)
-&gt; [StorableEvent UtxoHandle] -&gt; [StorableEvent UtxoHandle]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainPoint -&gt; StorableEvent UtxoHandle -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventIsBefore"><span class="hs-identifier hs-var">eventIsBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481372"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([StorableEvent UtxoHandle] -&gt; [StorableEvent UtxoHandle])
-&gt; (f (StorableEvent UtxoHandle) -&gt; [StorableEvent UtxoHandle])
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
forall (f :: * -&gt; *).
Foldable f =&gt;
AddressAny
-&gt; Maybe SlotNo
-&gt; f (StorableEvent UtxoHandle)
-&gt; [StorableEvent UtxoHandle]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#eventsAtAddress"><span class="hs-identifier hs-var">eventsAtAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481371"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679481370"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">Rewindable</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-666"></span><span>  </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">rewindStorage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>  </span><span id="local-6989586621679481367"><span class="annot"><span class="annottext">rewindStorage :: ChainPoint -&gt; UtxoHandle -&gt; IO (Maybe UtxoHandle)
</span><a href="#local-6989586621679481367"><span class="hs-identifier hs-var hs-var hs-var hs-var">rewindStorage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span> </span><span id="local-6989586621679481366"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481366"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481365"><span class="annot"><span class="annottext">h :: UtxoHandle
</span><a href="#local-6989586621679481365"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span id="local-6989586621679481364"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481364"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only SlotNo -&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481364"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;DELETE FROM unspent_transactions WHERE slotNo &gt; ?&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Only SlotNo
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481366"><span class="hs-identifier hs-var">sn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; Only SlotNo -&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481364"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;DELETE FROM spent WHERE slotNo &gt; ?&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Only SlotNo
forall a. a -&gt; Only a
</span><a href="../../../../Only/html/src"><span class="hs-identifier hs-var">SQL.Only</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481366"><span class="hs-identifier hs-var">sn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><span class="annottext">Maybe UtxoHandle -&gt; IO (Maybe UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe UtxoHandle -&gt; IO (Maybe UtxoHandle))
-&gt; Maybe UtxoHandle -&gt; IO (Maybe UtxoHandle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoHandle -&gt; Maybe UtxoHandle
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoHandle
</span><a href="#local-6989586621679481365"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-var">rewindStorage</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoHandle
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UtxoHandle -&gt; IO (Maybe UtxoHandle)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UtxoHandle
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-comment">-- For resuming we need to provide a list of points where we can resume from.</span><span>
</span><span id="line-674"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">Resumable</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-675"></span><span>  </span><span id="local-6989586621679481360"><span class="annot"><span class="annottext">resumeFromStorage :: UtxoHandle -&gt; StorableMonad UtxoHandle [StorablePoint UtxoHandle]
</span><a href="#local-6989586621679481360"><span class="hs-identifier hs-var hs-var hs-var hs-var">resumeFromStorage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span id="local-6989586621679481359"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481359"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621679481358"><span class="annot"><span class="annottext">[ChainPoint]
</span><a href="#local-6989586621679481358"><span class="hs-identifier hs-var">chainPoints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((SlotNo, Hash BlockHeader) -&gt; ChainPoint)
-&gt; [(SlotNo, Hash BlockHeader)] -&gt; [ChainPoint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint)
-&gt; (SlotNo, Hash BlockHeader) -&gt; ChainPoint
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(SlotNo, Hash BlockHeader)] -&gt; [ChainPoint])
-&gt; IO [(SlotNo, Hash BlockHeader)] -&gt; IO [ChainPoint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-677"></span><span>            </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; () -&gt; IO [(SlotNo, Hash BlockHeader)]
forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><a href="../../../../sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.query</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679481359"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-678"></span><span>                </span><span class="annot"><span class="">[r|SELECT slotNo, blockHash
                   FROM unspent_transactions
                   ORDER BY slotNo DESC|]</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>    </span><span class="hs-comment">-- The ordering here matters. The node will try to find the first point in the</span><span>
</span><span id="line-682"></span><span>    </span><span class="hs-comment">-- ledger, then move to the next and so on, so we will send the latest point</span><span>
</span><span id="line-683"></span><span>    </span><span class="hs-comment">-- first.</span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><span class="annottext">[ChainPoint] -&gt; IO [ChainPoint]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([ChainPoint] -&gt; IO [ChainPoint])
-&gt; [ChainPoint] -&gt; IO [ChainPoint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainPoint]
</span><a href="#local-6989586621679481358"><span class="hs-identifier hs-var">chainPoints</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainPoint] -&gt; [ChainPoint] -&gt; [ChainPoint]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPointAtGenesis</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="hs-comment">-- | Convert from 'AddressInEra' of the 'CurrentEra' to 'AddressAny'.</span><span>
</span><span id="line-687"></span><span id="local-6989586621679481992"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#toAddr"><span class="hs-identifier hs-type">toAddr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481992"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span></span><span>
</span><span id="line-688"></span><span id="toAddr"><span class="annot"><span class="annottext">toAddr :: AddressInEra era -&gt; AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#toAddr"><span class="hs-identifier hs-var hs-var">toAddr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressInEra</span></a></span><span> </span><span class="annot"><span class="annottext">AddressTypeInEra addrtype era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ByronAddressInAnyEra</span></a></span><span> </span><span id="local-6989586621679481354"><span class="annot"><span class="annottext">Address addrtype
</span><a href="#local-6989586621679481354"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address ByronAddr -&gt; AddressAny
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.AddressByron</span></a></span><span> </span><span class="annot"><span class="annottext">Address addrtype
Address ByronAddr
</span><a href="#local-6989586621679481354"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-689"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#toAddr"><span class="hs-identifier hs-var">toAddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressInEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ShelleyAddressInEra</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481351"><span class="annot"><span class="annottext">Address addrtype
</span><a href="#local-6989586621679481351"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address ShelleyAddr -&gt; AddressAny
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.AddressShelley</span></a></span><span> </span><span class="annot"><span class="annottext">Address addrtype
Address ShelleyAddr
</span><a href="#local-6989586621679481351"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span class="hs-comment">-- | Extract UtxoEvents from Cardano Block</span><span>
</span><span id="line-692"></span><span id="local-6989586621679481349"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxoEventsFromBlock"><span class="hs-identifier hs-type">getUtxoEventsFromBlock</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.IsCardanoEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481349"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier hs-type">TargetAddresses</span></a></span><span>    </span><span class="hs-comment">-- ^ target addresses to filter for</span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481349"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-comment">-- ^ UtxoEvents are stored in storage after conversion to UtxoRow</span></span><span>
</span><span id="line-697"></span><span id="getUtxoEventsFromBlock"><span class="annot"><span class="annottext">getUtxoEventsFromBlock :: Maybe TargetAddresses -&gt; Block era -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxoEventsFromBlock"><span class="hs-identifier hs-var hs-var">getUtxoEventsFromBlock</span></a></span></span><span> </span><span id="local-6989586621679481347"><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="#local-6989586621679481347"><span class="hs-identifier hs-var">maybeTargetAddresses</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.BlockHeader</span></a></span><span> </span><span id="local-6989586621679481344"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481344"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span id="local-6989586621679481343"><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481343"><span class="hs-identifier hs-var">hsh</span></a></span></span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481342"><span class="annot"><span class="annottext">[Tx era]
</span><a href="#local-6989586621679481342"><span class="hs-identifier hs-var">txs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><span class="annottext">Maybe TargetAddresses
-&gt; [Tx era] -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
forall era.
IsCardanoEra era =&gt;
Maybe TargetAddresses
-&gt; [Tx era] -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxoEvents"><span class="hs-identifier hs-var">getUtxoEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="#local-6989586621679481347"><span class="hs-identifier hs-var">maybeTargetAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">[Tx era]
</span><a href="#local-6989586621679481342"><span class="hs-identifier hs-var">txs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Hash BlockHeader -&gt; ChainPoint
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ChainPoint</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679481344"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><a href="#local-6989586621679481343"><span class="hs-identifier hs-var">hsh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-comment">-- | Extract UtxoEvents from Cardano Transactions</span><span>
</span><span id="line-701"></span><span id="local-6989586621679482043"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxoEvents"><span class="hs-identifier hs-type">getUtxoEvents</span></a></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.IsCardanoEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482043"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier hs-type">TargetAddresses</span></a></span><span>    </span><span class="hs-comment">-- ^ target addresses to filter for</span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482043"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ChainPoint</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../marconi-core/html/src"><span class="hs-identifier hs-type">StorableEvent</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoHandle"><span class="hs-identifier hs-type">UtxoHandle</span></a></span><span> </span><span class="hs-comment">-- ^ UtxoEvents are stored in storage after conversion to UtxoRow</span></span><span>
</span><span id="line-707"></span><span id="getUtxoEvents"><span class="annot"><span class="annottext">getUtxoEvents :: Maybe TargetAddresses
-&gt; [Tx era] -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxoEvents"><span class="hs-identifier hs-var hs-var">getUtxoEvents</span></a></span></span><span> </span><span id="local-6989586621679481340"><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="#local-6989586621679481340"><span class="hs-identifier hs-var">maybeTargetAddresses</span></a></span></span><span> </span><span id="local-6989586621679481339"><span class="annot"><span class="annottext">[Tx era]
</span><a href="#local-6989586621679481339"><span class="hs-identifier hs-var">txs</span></a></span></span><span> </span><span id="local-6989586621679481338"><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481338"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679481337"><span class="hs-identifier hs-type">utxoMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-709"></span><span>      </span><span id="local-6989586621679481337"><span class="annot"><span class="annottext">utxoMap :: Map TxIn Utxo
</span><a href="#local-6989586621679481337"><span class="hs-identifier hs-var hs-var">utxoMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; Map TxIn Utxo) -&gt; [Tx era] -&gt; Map TxIn Utxo
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TargetAddresses -&gt; Tx era -&gt; Map TxIn Utxo
forall era.
IsCardanoEra era =&gt;
Maybe TargetAddresses -&gt; Tx era -&gt; Map TxIn Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxos"><span class="hs-identifier hs-var">getUtxos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="#local-6989586621679481340"><span class="hs-identifier hs-var">maybeTargetAddresses</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Tx era]
</span><a href="#local-6989586621679481339"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-710"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-type">TxOutBalance</span></a></span><span> </span><span id="local-6989586621679481334"><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481334"><span class="hs-identifier hs-var">utxos</span></a></span></span><span> </span><span id="local-6989586621679481333"><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481333"><span class="hs-identifier hs-var">spentTxOuts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; TxOutBalance) -&gt; [Tx era] -&gt; TxOutBalance
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; TxOutBalance
forall era. Tx era -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txOutBalanceFromTx"><span class="hs-identifier hs-var">txOutBalanceFromTx</span></a></span><span> </span><span class="annot"><span class="annottext">[Tx era]
</span><a href="#local-6989586621679481339"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-711"></span><span>      </span><span class="annot"><a href="#local-6989586621679481331"><span class="hs-identifier hs-type">resolvedUtxos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span id="local-6989586621679481331"><span class="annot"><span class="annottext">resolvedUtxos :: Set Utxo
</span><a href="#local-6989586621679481331"><span class="hs-identifier hs-var hs-var">resolvedUtxos</span></a></span></span><span>
</span><span id="line-713"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Utxo] -&gt; Set Utxo
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span>
</span><span id="line-714"></span><span>        </span><span class="annot"><span class="annottext">([Utxo] -&gt; Set Utxo) -&gt; [Utxo] -&gt; Set Utxo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; Maybe Utxo) -&gt; [TxIn] -&gt; [Utxo]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; Map TxIn Utxo -&gt; Maybe Utxo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Data.Map.lookup`</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn Utxo
</span><a href="#local-6989586621679481337"><span class="hs-identifier hs-var">utxoMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><span class="annottext">([TxIn] -&gt; [Utxo]) -&gt; [TxIn] -&gt; [Utxo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; [TxIn]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481334"><span class="hs-identifier hs-var">utxos</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><span class="annottext">Set Utxo -&gt; Set TxIn -&gt; ChainPoint -&gt; StorableEvent UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoEvent"><span class="hs-identifier hs-var">UtxoEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Set Utxo
</span><a href="#local-6989586621679481331"><span class="hs-identifier hs-var">resolvedUtxos</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481333"><span class="hs-identifier hs-var">spentTxOuts</span></a></span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621679481338"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="hs-comment">-- | does the transaction contain a targetAddress</span><span>
</span><span id="line-720"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#isAddressInTarget"><span class="hs-identifier hs-type">isAddressInTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier hs-type">TargetAddresses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressAny</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-721"></span><span id="isAddressInTarget"><span class="annot"><span class="annottext">isAddressInTarget :: Maybe TargetAddresses -&gt; AddressAny -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#isAddressInTarget"><span class="hs-identifier hs-var hs-var">isAddressInTarget</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-comment">-- all addresses are target addresses</span><span>
</span><span id="line-722"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#isAddressInTarget"><span class="hs-identifier hs-var">isAddressInTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679481328"><span class="annot"><span class="annottext">TargetAddresses
</span><a href="#local-6989586621679481328"><span class="hs-identifier hs-var">targetAddresses</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481327"><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481327"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-723"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481327"><span class="hs-identifier hs-var">addr</span></a></span><span>  </span><span class="hs-keyword">of</span><span>
</span><span id="line-724"></span><span>      </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressByron</span></a></span><span> </span><span class="annot"><span class="annottext">Address ByronAddr
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-725"></span><span>      </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressShelley</span></a></span><span> </span><span id="local-6989586621679481326"><span class="annot"><span class="annottext">Address ShelleyAddr
</span><a href="#local-6989586621679481326"><span class="hs-identifier hs-var">addr'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Address ShelleyAddr
</span><a href="#local-6989586621679481326"><span class="hs-identifier hs-var">addr'</span></a></span><span> </span><span class="annot"><span class="annottext">Address ShelleyAddr -&gt; TargetAddresses -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">TargetAddresses
</span><a href="#local-6989586621679481328"><span class="hs-identifier hs-var">targetAddresses</span></a></span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span id="local-6989586621679482037"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxos"><span class="hs-identifier hs-type">getUtxos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.IsCardanoEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482037"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier hs-type">TargetAddresses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482037"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span></span><span>
</span><span id="line-728"></span><span id="getUtxos"><span class="annot"><span class="annottext">getUtxos :: Maybe TargetAddresses -&gt; Tx era -&gt; Map TxIn Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getUtxos"><span class="hs-identifier hs-var hs-var">getUtxos</span></a></span></span><span> </span><span id="local-6989586621679481324"><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="#local-6989586621679481324"><span class="hs-identifier hs-var">maybeTargetAddresses</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span id="local-6989586621679481322"><span class="annot"><span class="annottext">txBody :: TxBody era
</span><a href="#local-6989586621679481322"><span class="hs-identifier hs-var">txBody</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxBody</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxBodyContent</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679481319"><span class="annot"><span class="annottext">[TxOut CtxTx era]
txOuts :: forall build era. TxBodyContent build era -&gt; [TxOut CtxTx era]
txOuts :: [TxOut CtxTx era]
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">C.txOuts</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-729"></span><span>  </span><span class="annot"><span class="annottext">Map TxIn Utxo
-&gt; Either EraCastError (Map TxIn Utxo) -&gt; Map TxIn Utxo
forall b a. b -&gt; Either a b -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromRight</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn Utxo
forall k a. Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Data.Map.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxOut CtxTx era] -&gt; Either EraCastError (Map TxIn Utxo)
forall era.
IsCardanoEra era =&gt;
[TxOut CtxTx era] -&gt; Either EraCastError (Map TxIn Utxo)
</span><a href="#local-6989586621679481316"><span class="hs-identifier hs-var">getUtxos'</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx era]
</span><a href="#local-6989586621679481319"><span class="hs-identifier hs-var">txOuts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-731"></span><span>    </span><span id="local-6989586621679482016"><span class="annot"><a href="#local-6989586621679481316"><span class="hs-identifier hs-type">getUtxos'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.IsCardanoEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482016"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOut</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482016"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.EraCastError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-732"></span><span>    </span><span id="local-6989586621679481316"><span class="annot"><span class="annottext">getUtxos' :: [TxOut CtxTx era] -&gt; Either EraCastError (Map TxIn Utxo)
</span><a href="#local-6989586621679481316"><span class="hs-identifier hs-var hs-var">getUtxos'</span></a></span></span><span>
</span><span id="line-733"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; Map TxIn Utxo)
-&gt; Either EraCastError [TxOut]
-&gt; Either EraCastError (Map TxIn Utxo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TxIn, Utxo)] -&gt; Map TxIn Utxo
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Data.Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, Utxo)] -&gt; Map TxIn Utxo)
-&gt; ([TxOut] -&gt; [(TxIn, Utxo)]) -&gt; [TxOut] -&gt; Map TxIn Utxo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxIn Utxo -&gt; [(TxIn, Utxo)])
-&gt; [Map TxIn Utxo] -&gt; [(TxIn, Utxo)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn Utxo -&gt; [(TxIn, Utxo)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Data.Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">([Map TxIn Utxo] -&gt; [(TxIn, Utxo)])
-&gt; ([TxOut] -&gt; [Map TxIn Utxo]) -&gt; [TxOut] -&gt; [(TxIn, Utxo)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TxOut -&gt; Map TxIn Utxo) -&gt; [TxOut] -&gt; [Map TxIn Utxo]
forall i (f :: * -&gt; *) a b.
FunctorWithIndex i f =&gt;
(i -&gt; a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../indexed-traversable/html/src"><span class="hs-identifier hs-var">imap</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TxOut -&gt; Map TxIn Utxo
</span><a href="#local-6989586621679481313"><span class="hs-identifier hs-var">txoutToUtxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>      </span><span class="annot"><span class="annottext">(Either EraCastError [TxOut]
 -&gt; Either EraCastError (Map TxIn Utxo))
-&gt; ([TxOut CtxTx era] -&gt; Either EraCastError [TxOut])
-&gt; [TxOut CtxTx era]
-&gt; Either EraCastError (Map TxIn Utxo)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx era -&gt; Either EraCastError TxOut)
-&gt; [TxOut CtxTx era] -&gt; Either EraCastError [TxOut]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoEra CurrentEra
-&gt; TxOut CtxTx era -&gt; Either EraCastError TxOut
forall (f :: * -&gt; *) fromEra toEra.
(EraCast f, IsCardanoEra fromEra, IsCardanoEra toEra) =&gt;
CardanoEra toEra -&gt; f fromEra -&gt; Either EraCastError (f toEra)
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.eraCast</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra CurrentEra
</span><a href="Marconi.ChainIndex.Types.html#CurrentEra"><span class="hs-identifier hs-var">CurrentEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>    </span><span class="annot"><a href="#local-6989586621679481313"><span class="hs-identifier hs-type">txoutToUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-737"></span><span>    </span><span id="local-6989586621679481313"><span class="annot"><span class="annottext">txoutToUtxo :: Int -&gt; TxOut -&gt; Map TxIn Utxo
</span><a href="#local-6989586621679481313"><span class="hs-identifier hs-var hs-var">txoutToUtxo</span></a></span></span><span> </span><span id="local-6989586621679481311"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481311"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOut</span></a></span><span> </span><span id="local-6989586621679481309"><span class="annot"><span class="annottext">AddressInEra CurrentEra
</span><a href="#local-6989586621679481309"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679481308"><span class="annot"><span class="annottext">TxOutValue CurrentEra
</span><a href="#local-6989586621679481308"><span class="hs-identifier hs-var">value'</span></a></span></span><span> </span><span id="local-6989586621679481307"><span class="annot"><span class="annottext">TxOutDatum CtxTx CurrentEra
</span><a href="#local-6989586621679481307"><span class="hs-identifier hs-var">datum'</span></a></span></span><span> </span><span id="local-6989586621679481306"><span class="annot"><span class="annottext">ReferenceScript CurrentEra
</span><a href="#local-6989586621679481306"><span class="hs-identifier hs-var">refScript</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-738"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe TargetAddresses -&gt; AddressAny -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#isAddressInTarget"><span class="hs-identifier hs-var">isAddressInTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TargetAddresses
</span><a href="#local-6989586621679481324"><span class="hs-identifier hs-var">maybeTargetAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481305"><span class="hs-identifier hs-var">addrAny</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-739"></span><span>        </span><span class="annot"><span class="annottext">TxIn -&gt; Utxo -&gt; Map TxIn Utxo
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Data.Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679481303"><span class="hs-identifier hs-var">txin</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo :: AddressAny
-&gt; TxId
-&gt; TxIx
-&gt; Maybe ScriptData
-&gt; Maybe (Hash ScriptData)
-&gt; Value
-&gt; Maybe ScriptInAnyLang
-&gt; Maybe ScriptHash
-&gt; Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-740"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_txId :: TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_txId"><span class="hs-identifier hs-var">_txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481302"><span class="hs-identifier hs-var">txid</span></a></span><span>
</span><span id="line-741"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_txIx :: TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_txIx"><span class="hs-identifier hs-var">_txIx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481301"><span class="hs-identifier hs-var">txix</span></a></span><span>
</span><span id="line-742"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_address :: AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_address"><span class="hs-identifier hs-var">_address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressAny
</span><a href="#local-6989586621679481305"><span class="hs-identifier hs-var">addrAny</span></a></span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_value :: Value
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_value"><span class="hs-identifier hs-var">_value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutValue CurrentEra -&gt; Value
forall era. TxOutValue era -&gt; Value
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.txOutValueToValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue CurrentEra
</span><a href="#local-6989586621679481308"><span class="hs-identifier hs-var">value'</span></a></span><span>
</span><span id="line-744"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_datum :: Maybe ScriptData
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_datum"><span class="hs-identifier hs-var">_datum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
</span><a href="#local-6989586621679481299"><span class="hs-identifier hs-var">__datum</span></a></span><span>
</span><span id="line-745"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_datumHash :: Maybe (Hash ScriptData)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_datumHash"><span class="hs-identifier hs-var">_datumHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><a href="#local-6989586621679481298"><span class="hs-identifier hs-var">__datumHash</span></a></span><span>
</span><span id="line-746"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inlineScript :: Maybe ScriptInAnyLang
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_inlineScript"><span class="hs-identifier hs-var">_inlineScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><a href="#local-6989586621679481297"><span class="hs-identifier hs-var">__inlineScript</span></a></span><span>
</span><span id="line-747"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inlineScriptHash :: Maybe ScriptHash
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_inlineScriptHash"><span class="hs-identifier hs-var">_inlineScriptHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679481296"><span class="hs-identifier hs-var">__inlineScriptHash</span></a></span><span>
</span><span id="line-748"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-749"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-750"></span><span>        </span><span class="annot"><span class="annottext">Map TxIn Utxo
forall k a. Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Data.Map.empty</span></a></span><span>
</span><span id="line-751"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-752"></span><span>        </span><span id="local-6989586621679481305"><span class="annot"><span class="annottext">addrAny :: AddressAny
</span><a href="#local-6989586621679481305"><span class="hs-identifier hs-var hs-var">addrAny</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressInEra CurrentEra -&gt; AddressAny
forall era. AddressInEra era -&gt; AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#toAddr"><span class="hs-identifier hs-var">toAddr</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra CurrentEra
</span><a href="#local-6989586621679481309"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-753"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679481299"><span class="annot"><span class="annottext">Maybe ScriptData
</span><a href="#local-6989586621679481299"><span class="hs-identifier hs-var">__datum</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481298"><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><a href="#local-6989586621679481298"><span class="hs-identifier hs-var">__datumHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx CurrentEra
-&gt; (Maybe ScriptData, Maybe (Hash ScriptData))
forall era.
TxOutDatum CtxTx era -&gt; (Maybe ScriptData, Maybe (Hash ScriptData))
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getScriptDataAndHash"><span class="hs-identifier hs-var">getScriptDataAndHash</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx CurrentEra
</span><a href="#local-6989586621679481307"><span class="hs-identifier hs-var">datum'</span></a></span><span>
</span><span id="line-754"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679481297"><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><a href="#local-6989586621679481297"><span class="hs-identifier hs-var">__inlineScript</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481296"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679481296"><span class="hs-identifier hs-var">__inlineScriptHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReferenceScript CurrentEra
-&gt; (Maybe ScriptInAnyLang, Maybe ScriptHash)
forall era.
ReferenceScript era -&gt; (Maybe ScriptInAnyLang, Maybe ScriptHash)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getRefScriptAndHash"><span class="hs-identifier hs-var">getRefScriptAndHash</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript CurrentEra
</span><a href="#local-6989586621679481306"><span class="hs-identifier hs-var">refScript</span></a></span><span>
</span><span id="line-755"></span><span>        </span><span id="local-6989586621679481303"><span class="annot"><span class="annottext">txin :: TxIn
</span><a href="#local-6989586621679481303"><span class="hs-identifier hs-var">txin</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span id="local-6989586621679481302"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481302"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621679481301"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481301"><span class="hs-identifier hs-var">txix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; TxId
forall era. TxBody era -&gt; TxId
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.getTxId</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679481322"><span class="hs-identifier hs-var">txBody</span></a></span><span class="hs-special">)</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; TxIx
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIx</span></a></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; TxIx) -&gt; Word -&gt; TxIx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481311"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="hs-comment">-- | get the inlineScript and inlineScriptHash</span><span>
</span><span id="line-758"></span><span class="hs-comment">--</span><span>
</span><span id="line-759"></span><span id="local-6989586621679481990"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getRefScriptAndHash"><span class="hs-identifier hs-type">getRefScriptAndHash</span></a></span><span>
</span><span id="line-760"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ReferenceScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481990"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptHash</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-762"></span><span id="getRefScriptAndHash"><span class="annot"><span class="annottext">getRefScriptAndHash :: ReferenceScript era -&gt; (Maybe ScriptInAnyLang, Maybe ScriptHash)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getRefScriptAndHash"><span class="hs-identifier hs-var hs-var">getRefScriptAndHash</span></a></span></span><span> </span><span id="local-6989586621679481291"><span class="annot"><span class="annottext">ReferenceScript era
</span><a href="#local-6989586621679481291"><span class="hs-identifier hs-var">refScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><a href="#local-6989586621679481291"><span class="hs-identifier hs-var">refScript</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-763"></span><span>  </span><span class="annot"><span class="annottext">ReferenceScript era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ReferenceScriptNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>  </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481288"><span class="annot"><span class="annottext">s :: ScriptInAnyLang
</span><a href="#local-6989586621679481288"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.SimpleScriptLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleScriptVersion lang
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.SimpleScriptV1</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481284"><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481284"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-765"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang -&gt; Maybe ScriptInAnyLang
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span>  </span><span class="annot"><span class="annottext">ScriptInAnyLang
</span><a href="#local-6989586621679481288"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-766"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Maybe ScriptHash)
-&gt; (Script lang -&gt; ScriptHash) -&gt; Script lang -&gt; Maybe ScriptHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang -&gt; ScriptHash
forall lang. Script lang -&gt; ScriptHash
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScript</span></a></span><span> </span><span class="annot"><span class="annottext">(Script lang -&gt; Maybe ScriptHash)
-&gt; Script lang -&gt; Maybe ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481284"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>  </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481282"><span class="annot"><span class="annottext">s :: ScriptInAnyLang
</span><a href="#local-6989586621679481282"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.SimpleScriptLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleScriptVersion lang
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.SimpleScriptV2</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481280"><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481280"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang -&gt; Maybe ScriptInAnyLang
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang
</span><a href="#local-6989586621679481282"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Maybe ScriptHash)
-&gt; (Script lang -&gt; ScriptHash) -&gt; Script lang -&gt; Maybe ScriptHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang -&gt; ScriptHash
forall lang. Script lang -&gt; ScriptHash
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScript</span></a></span><span> </span><span class="annot"><span class="annottext">(Script lang -&gt; Maybe ScriptHash)
-&gt; Script lang -&gt; Maybe ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481280"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>  </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481279"><span class="annot"><span class="annottext">s :: ScriptInAnyLang
</span><a href="#local-6989586621679481279"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.PlutusScriptLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.PlutusScriptV1</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481276"><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481276"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-771"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang -&gt; Maybe ScriptInAnyLang
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang
</span><a href="#local-6989586621679481279"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Maybe ScriptHash)
-&gt; (Script lang -&gt; ScriptHash) -&gt; Script lang -&gt; Maybe ScriptHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang -&gt; ScriptHash
forall lang. Script lang -&gt; ScriptHash
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScript</span></a></span><span> </span><span class="annot"><span class="annottext">(Script lang -&gt; Maybe ScriptHash)
-&gt; Script lang -&gt; Maybe ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481276"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>  </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481275"><span class="annot"><span class="annottext">s :: ScriptInAnyLang
</span><a href="#local-6989586621679481275"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.PlutusScriptLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.PlutusScriptV2</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481273"><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481273"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang -&gt; Maybe ScriptInAnyLang
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang
</span><a href="#local-6989586621679481275"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-775"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Maybe ScriptHash)
-&gt; (Script lang -&gt; ScriptHash) -&gt; Script lang -&gt; Maybe ScriptHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang -&gt; ScriptHash
forall lang. Script lang -&gt; ScriptHash
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScript</span></a></span><span> </span><span class="annot"><span class="annottext">(Script lang -&gt; Maybe ScriptHash)
-&gt; Script lang -&gt; Maybe ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481273"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="hs-comment">-- | Get the datum hash and datum or a transaction output.</span><span>
</span><span id="line-778"></span><span id="local-6989586621679481991"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getScriptDataAndHash"><span class="hs-identifier hs-type">getScriptDataAndHash</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatum</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481991"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptData</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Hash</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-781"></span><span id="getScriptDataAndHash"><span class="annot"><span class="annottext">getScriptDataAndHash :: TxOutDatum CtxTx era -&gt; (Maybe ScriptData, Maybe (Hash ScriptData))
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getScriptDataAndHash"><span class="hs-identifier hs-var hs-var">getScriptDataAndHash</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxOutDatumNone</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ScriptData
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getScriptDataAndHash"><span class="hs-identifier hs-var">getScriptDataAndHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatumHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDataSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481270"><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621679481270"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ScriptData
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621679481270"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getScriptDataAndHash"><span class="hs-identifier hs-var">getScriptDataAndHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDataSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481268"><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481268"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptData -&gt; Maybe ScriptData
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481268"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash ScriptData -&gt; Maybe (Hash ScriptData))
-&gt; (ScriptData -&gt; Hash ScriptData)
-&gt; ScriptData
-&gt; Maybe (Hash ScriptData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Hash ScriptData
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScriptData</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481268"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getScriptDataAndHash"><span class="hs-identifier hs-var">getScriptDataAndHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatumInline</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481265"><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481265"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptData -&gt; Maybe ScriptData
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481265"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash ScriptData -&gt; Maybe (Hash ScriptData))
-&gt; (ScriptData -&gt; Hash ScriptData)
-&gt; ScriptData
-&gt; Maybe (Hash ScriptData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Hash ScriptData
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScriptData</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481265"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="hs-comment">-- | remove spent transactions</span><span>
</span><span id="line-787"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#rmSpent"><span class="hs-identifier hs-type">rmSpent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-788"></span><span id="rmSpent"><span class="annot"><span class="annottext">rmSpent :: Set TxIn -&gt; [Utxo] -&gt; [Utxo]
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#rmSpent"><span class="hs-identifier hs-var hs-var">rmSpent</span></a></span></span><span> </span><span id="local-6989586621679481263"><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481263"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Utxo -&gt; Bool) -&gt; [Utxo] -&gt; [Utxo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Utxo -&gt; Bool) -&gt; Utxo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Utxo -&gt; Bool
</span><a href="#local-6989586621679481262"><span class="hs-identifier hs-var">isUtxoSpent</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481263"><span class="hs-identifier hs-var">txins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-790"></span><span>    </span><span class="annot"><a href="#local-6989586621679481262"><span class="hs-identifier hs-type">isUtxoSpent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-791"></span><span>    </span><span id="local-6989586621679481262"><span class="annot"><span class="annottext">isUtxoSpent :: Set TxIn -&gt; Utxo -&gt; Bool
</span><a href="#local-6989586621679481262"><span class="hs-identifier hs-var hs-var">isUtxoSpent</span></a></span></span><span> </span><span id="local-6989586621679481261"><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481261"><span class="hs-identifier hs-var">txIns</span></a></span></span><span> </span><span id="local-6989586621679481260"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481260"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481260"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; Getting TxId Utxo TxId -&gt; TxId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxId Utxo TxId
Lens' Utxo TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txId"><span class="hs-identifier hs-var">txId</span></a></span><span class="hs-special">)</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481260"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo -&gt; Getting TxIx Utxo TxIx -&gt; TxIx
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxIx Utxo TxIx
Lens' Utxo TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txIx"><span class="hs-identifier hs-var">txIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Set TxIn -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481261"><span class="hs-identifier hs-var">txIns</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span id="local-6989586621679481258"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#getInputs"><span class="hs-identifier hs-type">getInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481258"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIn</span></a></span></span><span>
</span><span id="line-795"></span><span id="getInputs"><span class="annot"><span class="annottext">getInputs :: Tx era -&gt; Set TxIn
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#getInputs"><span class="hs-identifier hs-var hs-var">getInputs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxBody</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxBodyContent</span></a></span><span>
</span><span id="line-796"></span><span>                 </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679481256"><span class="annot"><span class="annottext">TxIns ViewTx era
txIns :: forall build era. TxBodyContent build era -&gt; TxIns build era
txIns :: TxIns ViewTx era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">C.txIns</span></a></span></span><span>
</span><span id="line-797"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481254"><span class="annot"><span class="annottext">TxScriptValidity era
txScriptValidity :: forall build era. TxBodyContent build era -&gt; TxScriptValidity era
txScriptValidity :: TxScriptValidity era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">C.txScriptValidity</span></a></span></span><span>
</span><span id="line-798"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481252"><span class="annot"><span class="annottext">TxInsCollateral era
txInsCollateral :: forall build era. TxBodyContent build era -&gt; TxInsCollateral era
txInsCollateral :: TxInsCollateral era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">C.txInsCollateral</span></a></span></span><span>
</span><span id="line-799"></span><span>                 </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-801"></span><span>    </span><span id="local-6989586621679481250"><span class="annot"><span class="annottext">inputs :: [TxIn]
</span><a href="#local-6989586621679481250"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era -&gt; ScriptValidity
forall era. TxScriptValidity era -&gt; ScriptValidity
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txScriptValidityToScriptValidity"><span class="hs-identifier hs-var">txScriptValidityToScriptValidity</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
</span><a href="#local-6989586621679481254"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-802"></span><span>      </span><span class="annot"><span class="annottext">ScriptValidity
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ScriptValid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn era)) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn era)) -&gt; TxIn)
-&gt; TxIns ViewTx era -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns ViewTx era
</span><a href="#local-6989586621679481256"><span class="hs-identifier hs-var">txIns</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span class="annot"><span class="annottext">ScriptValidity
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ScriptInvalid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="#local-6989586621679481252"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-804"></span><span>        </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxInsCollateralNone</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-805"></span><span>        </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481244"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679481244"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679481244"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-807"></span><span>    </span><span class="annot"><span class="annottext">[TxIn] -&gt; Set TxIn
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679481250"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span class="hs-comment">-- | Duplicated from cardano-api (not exposed in cardano-api)</span><span>
</span><span id="line-810"></span><span class="hs-comment">-- This function should be removed when marconi will depend on a cardano-api version that has accepted this PR:</span><span>
</span><span id="line-811"></span><span class="hs-comment">-- https://github.com/input-output-hk/cardano-node/pull/4569</span><span>
</span><span id="line-812"></span><span id="local-6989586621679481962"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#txScriptValidityToScriptValidity"><span class="hs-identifier hs-type">txScriptValidityToScriptValidity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxScriptValidity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481962"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptValidity</span></a></span></span><span>
</span><span id="line-813"></span><span id="txScriptValidityToScriptValidity"><span class="annot"><span class="annottext">txScriptValidityToScriptValidity :: TxScriptValidity era -&gt; ScriptValidity
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txScriptValidityToScriptValidity"><span class="hs-identifier hs-var hs-var">txScriptValidityToScriptValidity</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxScriptValidityNone</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptValidity
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ScriptValid</span></a></span><span>
</span><span id="line-814"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#txScriptValidityToScriptValidity"><span class="hs-identifier hs-var">txScriptValidityToScriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxScriptValidity</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValiditySupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481241"><span class="annot"><span class="annottext">ScriptValidity
</span><a href="#local-6989586621679481241"><span class="hs-identifier hs-var">scriptValidity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptValidity
</span><a href="#local-6989586621679481241"><span class="hs-identifier hs-var">scriptValidity</span></a></span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span class="hs-comment">-- | does the transaction contain a targetAddress</span><span>
</span><span id="line-817"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#isAddressInTarget%27"><span class="hs-identifier hs-type">isAddressInTarget'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier hs-type">TargetAddresses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-818"></span><span id="isAddressInTarget%27"><span class="annot"><span class="annottext">isAddressInTarget' :: TargetAddresses -&gt; Utxo -&gt; Bool
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#isAddressInTarget%27"><span class="hs-identifier hs-var hs-var">isAddressInTarget'</span></a></span></span><span> </span><span id="local-6989586621679481239"><span class="annot"><span class="annottext">TargetAddresses
</span><a href="#local-6989586621679481239"><span class="hs-identifier hs-var">targetAddresses</span></a></span></span><span> </span><span id="local-6989586621679481238"><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481238"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-819"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Utxo
</span><a href="#local-6989586621679481238"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Utxo
-&gt; ((AddressAny -&gt; Const AddressAny AddressAny)
    -&gt; Utxo -&gt; Const AddressAny Utxo)
-&gt; AddressAny
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAny -&gt; Const AddressAny AddressAny)
-&gt; Utxo -&gt; Const AddressAny Utxo
Lens' Utxo AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#address"><span class="hs-identifier hs-var">address</span></a></span><span>  </span><span class="hs-keyword">of</span><span>
</span><span id="line-820"></span><span>      </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressByron</span></a></span><span> </span><span class="annot"><span class="annottext">Address ByronAddr
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressShelley</span></a></span><span> </span><span id="local-6989586621679481237"><span class="annot"><span class="annottext">Address ShelleyAddr
</span><a href="#local-6989586621679481237"><span class="hs-identifier hs-var">addr'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Address ShelleyAddr
</span><a href="#local-6989586621679481237"><span class="hs-identifier hs-var">addr'</span></a></span><span> </span><span class="annot"><span class="annottext">Address ShelleyAddr -&gt; TargetAddresses -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">TargetAddresses
</span><a href="#local-6989586621679481239"><span class="hs-identifier hs-var">targetAddresses</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#mkQueryableAddresses"><span class="hs-identifier hs-type">mkQueryableAddresses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Types.html#TargetAddresses"><span class="hs-identifier hs-type">TargetAddresses</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#QueryableAddresses"><span class="hs-identifier hs-type">QueryableAddresses</span></a></span><span>
</span><span id="line-824"></span><span id="mkQueryableAddresses"><span class="annot"><span class="annottext">mkQueryableAddresses :: TargetAddresses -&gt; QueryableAddresses
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#mkQueryableAddresses"><span class="hs-identifier hs-var hs-var">mkQueryableAddresses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Address ShelleyAddr -&gt; StorableQuery UtxoHandle)
-&gt; TargetAddresses -&gt; QueryableAddresses
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AddressAny -&gt; Maybe SlotNo -&gt; StorableQuery UtxoHandle)
-&gt; Maybe SlotNo -&gt; AddressAny -&gt; StorableQuery UtxoHandle
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAny -&gt; Maybe SlotNo -&gt; StorableQuery UtxoHandle
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#UtxoByAddress"><span class="hs-identifier hs-var">UtxoByAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAny -&gt; StorableQuery UtxoHandle)
-&gt; (Address ShelleyAddr -&gt; AddressAny)
-&gt; Address ShelleyAddr
-&gt; StorableQuery UtxoHandle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Address ShelleyAddr -&gt; AddressAny
forall addr. Address addr -&gt; AddressAny
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.toAddressAny</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span id="local-6989586621679481233"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#txOutBalanceFromTxs"><span class="hs-identifier hs-type">txOutBalanceFromTxs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481233"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-type">TxOutBalance</span></a></span></span><span>
</span><span id="line-827"></span><span id="txOutBalanceFromTxs"><span class="annot"><span class="annottext">txOutBalanceFromTxs :: [Tx era] -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txOutBalanceFromTxs"><span class="hs-identifier hs-var hs-var">txOutBalanceFromTxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; TxOutBalance) -&gt; [Tx era] -&gt; TxOutBalance
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; TxOutBalance
forall era. Tx era -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txOutBalanceFromTx"><span class="hs-identifier hs-var">txOutBalanceFromTx</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span id="local-6989586621679482036"><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#txOutBalanceFromTx"><span class="hs-identifier hs-type">txOutBalanceFromTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482036"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-type">TxOutBalance</span></a></span></span><span>
</span><span id="line-830"></span><span id="txOutBalanceFromTx"><span class="annot"><span class="annottext">txOutBalanceFromTx :: Tx era -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#txOutBalanceFromTx"><span class="hs-identifier hs-var hs-var">txOutBalanceFromTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.Tx</span></a></span><span> </span><span id="local-6989586621679481231"><span class="annot"><span class="annottext">txBody :: TxBody era
</span><a href="#local-6989586621679481231"><span class="hs-identifier hs-var">txBody</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxBody</span></a></span><span> </span><span id="local-6989586621679481230"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621679481230"><span class="hs-identifier hs-var">txBodyContent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-831"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-832"></span><span>        </span><span id="local-6989586621679481229"><span class="annot"><span class="annottext">txInputs :: Set TxIn
</span><a href="#local-6989586621679481229"><span class="hs-identifier hs-var hs-var">txInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; Set TxIn
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; Set TxIn) -&gt; [TxIn] -&gt; Set TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn era)) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn era)) -&gt; TxIn)
-&gt; [(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn era))] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
-&gt; [(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn era))]
forall build era. TxBodyContent build era -&gt; TxIns build era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">C.txIns</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621679481230"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-833"></span><span>        </span><span id="local-6989586621679481228"><span class="annot"><span class="annottext">utxoRefs :: Set TxIn
</span><a href="#local-6989586621679481228"><span class="hs-identifier hs-var hs-var">utxoRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; Set TxIn
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span>
</span><span id="line-834"></span><span>                 </span><span class="annot"><span class="annottext">([TxIn] -&gt; Set TxIn) -&gt; [TxIn] -&gt; Set TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx era) -&gt; TxIn)
-&gt; [(Word, TxOut CtxTx era)] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679481227"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679481227"><span class="hs-identifier hs-var">txix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; TxId
forall era. TxBody era -&gt; TxId
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.getTxId</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679481231"><span class="hs-identifier hs-var">txBody</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; TxIx
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxIx</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679481227"><span class="hs-identifier hs-var">txix</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>                 </span><span class="annot"><span class="annottext">([(Word, TxOut CtxTx era)] -&gt; [TxIn])
-&gt; [(Word, TxOut CtxTx era)] -&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; [TxOut CtxTx era] -&gt; [(Word, TxOut CtxTx era)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-836"></span><span>                 </span><span class="annot"><span class="annottext">([TxOut CtxTx era] -&gt; [(Word, TxOut CtxTx era)])
-&gt; [TxOut CtxTx era] -&gt; [(Word, TxOut CtxTx era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; [TxOut CtxTx era]
forall build era. TxBodyContent build era -&gt; [TxOut CtxTx era]
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">C.txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621679481230"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-837"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; Set TxIn -&gt; TxOutBalance
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#TxOutBalance"><span class="hs-identifier hs-var">TxOutBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481228"><span class="hs-identifier hs-var">utxoRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679481229"><span class="hs-identifier hs-var">txInputs</span></a></span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#convertTxOutToUtxo"><span class="hs-identifier hs-type">convertTxOutToUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxIx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOut</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.CtxTx</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.BabbageEra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-840"></span><span id="convertTxOutToUtxo"><span class="annot"><span class="annottext">convertTxOutToUtxo :: TxId -&gt; TxIx -&gt; TxOut -&gt; Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#convertTxOutToUtxo"><span class="hs-identifier hs-var hs-var">convertTxOutToUtxo</span></a></span></span><span> </span><span id="local-6989586621679481224"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481224"><span class="hs-identifier hs-var">txid</span></a></span></span><span> </span><span id="local-6989586621679481223"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481223"><span class="hs-identifier hs-var">txix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.AddressInEra</span></a></span><span> </span><span class="annot"><span class="annottext">AddressTypeInEra addrtype CurrentEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481222"><span class="annot"><span class="annottext">Address addrtype
</span><a href="#local-6989586621679481222"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679481221"><span class="annot"><span class="annottext">TxOutValue CurrentEra
</span><a href="#local-6989586621679481221"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621679481220"><span class="annot"><span class="annottext">TxOutDatum CtxTx CurrentEra
</span><a href="#local-6989586621679481220"><span class="hs-identifier hs-var">txOutDatum</span></a></span></span><span> </span><span id="local-6989586621679481219"><span class="annot"><span class="annottext">ReferenceScript CurrentEra
</span><a href="#local-6989586621679481219"><span class="hs-identifier hs-var">refScript</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-841"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481218"><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><a href="#local-6989586621679481218"><span class="hs-identifier hs-var">scriptDataHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481217"><span class="annot"><span class="annottext">Maybe ScriptData
</span><a href="#local-6989586621679481217"><span class="hs-identifier hs-var">scriptData</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-842"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx CurrentEra
</span><a href="#local-6989586621679481220"><span class="hs-identifier hs-var">txOutDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-843"></span><span>              </span><span class="annot"><span class="annottext">TxOutDatum CtxTx CurrentEra
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.TxOutDatumNone</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>              </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatumHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDataSupportedInEra CurrentEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481216"><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621679481216"><span class="hs-identifier hs-var">dh</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621679481216"><span class="hs-identifier hs-var">dh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>              </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDataSupportedInEra CurrentEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481215"><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481215"><span class="hs-identifier hs-var">d</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash ScriptData -&gt; Maybe (Hash ScriptData))
-&gt; Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Hash ScriptData
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScriptData</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481215"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Maybe ScriptData
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481215"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>              </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.TxOutDatumInline</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra CurrentEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481214"><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481214"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash ScriptData -&gt; Maybe (Hash ScriptData))
-&gt; Hash ScriptData -&gt; Maybe (Hash ScriptData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Hash ScriptData
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScriptData</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481214"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Maybe ScriptData
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptData
</span><a href="#local-6989586621679481214"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679481213"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679481213"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481212"><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><a href="#local-6989586621679481212"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-848"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReferenceScript CurrentEra
</span><a href="#local-6989586621679481219"><span class="hs-identifier hs-var">refScript</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-849"></span><span>              </span><span class="annot"><span class="annottext">ReferenceScript CurrentEra
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.ReferenceScriptNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ScriptHash
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>              </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra CurrentEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481211"><span class="annot"><span class="annottext">scriptInAnyLang :: ScriptInAnyLang
</span><a href="#local-6989586621679481211"><span class="hs-identifier hs-var">scriptInAnyLang</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">C.ScriptInAnyLang</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLanguage lang
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481210"><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481210"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Maybe ScriptHash) -&gt; ScriptHash -&gt; Maybe ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang -&gt; ScriptHash
forall lang. Script lang -&gt; ScriptHash
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.hashScript</span></a></span><span> </span><span class="annot"><span class="annottext">Script lang
</span><a href="#local-6989586621679481210"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang -&gt; Maybe ScriptInAnyLang
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptInAnyLang
</span><a href="#local-6989586621679481211"><span class="hs-identifier hs-var">scriptInAnyLang</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Utxo :: AddressAny
-&gt; TxId
-&gt; TxIx
-&gt; Maybe ScriptData
-&gt; Maybe (Hash ScriptData)
-&gt; Value
-&gt; Maybe ScriptInAnyLang
-&gt; Maybe ScriptHash
-&gt; Utxo
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a></span><span>
</span><span id="line-853"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_address :: AddressAny
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_address"><span class="hs-identifier hs-var">_address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address addrtype -&gt; AddressAny
forall addr. Address addr -&gt; AddressAny
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.toAddressAny</span></a></span><span> </span><span class="annot"><span class="annottext">Address addrtype
</span><a href="#local-6989586621679481222"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-854"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_txId :: TxId
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_txId"><span class="hs-identifier hs-var">_txId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679481224"><span class="hs-identifier hs-var">txid</span></a></span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_txIx :: TxIx
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_txIx"><span class="hs-identifier hs-var">_txIx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679481223"><span class="hs-identifier hs-var">txix</span></a></span><span>
</span><span id="line-856"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_datum :: Maybe ScriptData
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_datum"><span class="hs-identifier hs-var">_datum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptData
</span><a href="#local-6989586621679481217"><span class="hs-identifier hs-var">scriptData</span></a></span><span>
</span><span id="line-857"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_datumHash :: Maybe (Hash ScriptData)
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_datumHash"><span class="hs-identifier hs-var">_datumHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Hash ScriptData)
</span><a href="#local-6989586621679481218"><span class="hs-identifier hs-var">scriptDataHash</span></a></span><span>
</span><span id="line-858"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_value :: Value
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_value"><span class="hs-identifier hs-var">_value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutValue CurrentEra -&gt; Value
forall era. TxOutValue era -&gt; Value
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">C.txOutValueToValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue CurrentEra
</span><a href="#local-6989586621679481221"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-859"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inlineScript :: Maybe ScriptInAnyLang
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_inlineScript"><span class="hs-identifier hs-var">_inlineScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptInAnyLang
</span><a href="#local-6989586621679481212"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-860"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_inlineScriptHash :: Maybe ScriptHash
</span><a href="Marconi.ChainIndex.Indexers.Utxo.html#_inlineScriptHash"><span class="hs-identifier hs-var">_inlineScriptHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679481213"><span class="hs-identifier hs-var">scriptHash</span></a></span><span>
</span><span id="line-861"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-862"></span></pre></body></html>