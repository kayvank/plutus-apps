<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Alonzo.PlutusScriptApi</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- Figure 8</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getSpendingTxIn"><span class="hs-identifier">getSpendingTxIn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getDatumAlonzo"><span class="hs-identifier">getDatumAlonzo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#evalScripts"><span class="hs-identifier">evalScripts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-comment">-- Figure 12</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeeded"><span class="hs-identifier">scriptsNeeded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeededFromBody"><span class="hs-identifier">scriptsNeededFromBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#language"><span class="hs-identifier">language</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#CollectError"><span class="hs-identifier">CollectError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#collectTwoPhaseScriptInputs"><span class="hs-identifier">collectTwoPhaseScriptInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#knownToNotBe1Phase"><span class="hs-identifier">knownToNotBe1Phase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">Cardano.Binary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">FromCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">ToCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Data.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Data.html#getPlutusData"><span class="hs-identifier">getPlutusData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Language</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html#Language"><span class="hs-identifier">Language</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#CostModel"><span class="hs-identifier">CostModel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#CostModels"><span class="hs-identifier">CostModels</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#ExUnits"><span class="hs-identifier">ExUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Scripts</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AlonzoScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#Script"><span class="hs-identifier">Script</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Tx</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Data.html#Data"><span class="hs-identifier">Data</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">DataHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#indexedRdmrs"><span class="hs-identifier">indexedRdmrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html#txdats%27"><span class="hs-identifier">txdats'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxInfo</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#ExtendedUTxO"><span class="hs-identifier">ExtendedUTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#ScriptResult"><span class="hs-identifier">ScriptResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#TranslationError"><span class="hs-identifier">TranslationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#runPLCScript"><span class="hs-identifier">runPLCScript</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#valContext"><span class="hs-identifier">valContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxWitness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html#TxWitness"><span class="hs-identifier">TxWitness</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html#unTxDats"><span class="hs-identifier">unTxDats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">ProtVer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">ScriptHashObj</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Crypto</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley-ma/html/src"><span class="hs-identifier">Cardano.Ledger.Mary.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley-ma/html/src"><span class="hs-identifier">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Cardano.Ledger.Shelley.Delegation.Certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">DCert</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Cardano.Ledger.Shelley.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Cardano.Ledger.Shelley.TxBody</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">DelegCert</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Delegation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Wdrl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">getRwdCred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Cardano.Ledger.Shelley.UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">getScriptHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">scriptCred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley-ma/html/src"><span class="hs-identifier">Cardano.Ledger.ShelleyMA.TxBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley-ma/html/src"><span class="hs-identifier">ValidityInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">Cardano.Slotting.EpochInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">EpochInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">Cardano.Slotting.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">SystemStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ShortByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">Data.Coders</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">foldl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">intercalate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier">StrictSeq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Debug.Trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">traceEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Records</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">HasField</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- ===============================================================</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- From the specification, Figure 8 &quot;Scripts and their Arguments&quot;</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- ===============================================================</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Only the Spending ScriptPurpose contains TxIn</span><span>
</span><span id="line-87"></span><span id="local-6989586621679394091"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getSpendingTxIn"><span class="hs-identifier hs-type">getSpendingTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679394091"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679394091"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-88"></span><span id="getSpendingTxIn"><span class="annot"><span class="annottext">getSpendingTxIn :: ScriptPurpose crypto -&gt; Maybe (TxIn crypto)
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getSpendingTxIn"><span class="hs-identifier hs-var hs-var">getSpendingTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#Spending"><span class="hs-identifier hs-type">Spending</span></a></span><span> </span><span id="local-6989586621679393883"><span class="annot"><span class="annottext">TxIn crypto
</span><a href="#local-6989586621679393883"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn crypto -&gt; Maybe (TxIn crypto)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn crypto
</span><a href="#local-6989586621679393883"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#Minting"><span class="hs-identifier hs-type">Minting</span></a></span><span> </span><span id="local-6989586621679393881"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679393881"><span class="hs-identifier hs-var">_policyid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn crypto)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#Rewarding"><span class="hs-identifier hs-type">Rewarding</span></a></span><span> </span><span id="local-6989586621679393879"><span class="annot"><span class="annottext">RewardAcnt crypto
</span><a href="#local-6989586621679393879"><span class="hs-identifier hs-var">_rewaccnt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn crypto)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#Certifying"><span class="hs-identifier hs-type">Certifying</span></a></span><span> </span><span id="local-6989586621679393877"><span class="annot"><span class="annottext">DCert crypto
</span><a href="#local-6989586621679393877"><span class="hs-identifier hs-var">_dcert</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn crypto)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Get the Data associated with a ScriptPurpose. Only the Spending</span><span>
</span><span id="line-95"></span><span class="hs-comment">--   ScriptPurpose contains Data. The null list is returned for the other kinds.</span><span>
</span><span id="line-96"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getDatumAlonzo"><span class="hs-identifier hs-type">getDatumAlonzo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679393876"><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621679393875"><span class="annot"><a href="#local-6989586621679393875"><span class="hs-identifier hs-type">tx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;datahash&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">DataHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wits&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679393875"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html#TxWitness"><span class="hs-identifier hs-type">TxWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="#local-6989586621679393875"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393876"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span id="getDatumAlonzo"><span class="annot"><span class="annottext">getDatumAlonzo :: tx -&gt; UTxO era -&gt; ScriptPurpose (Crypto era) -&gt; Maybe (Data era)
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getDatumAlonzo"><span class="hs-identifier hs-var hs-var">getDatumAlonzo</span></a></span></span><span> </span><span id="local-6989586621679393874"><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393874"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span id="local-6989586621679393872"><span class="annot"><span class="annottext">Map (TxIn (Crypto era)) (TxOut era)
</span><a href="#local-6989586621679393872"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393871"><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393871"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679393870"><span class="annot"><span class="annottext">TxIn (Crypto era)
</span><a href="#local-6989586621679393870"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era) -&gt; Maybe (TxIn (Crypto era))
forall crypto. ScriptPurpose crypto -&gt; Maybe (TxIn crypto)
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#getSpendingTxIn"><span class="hs-identifier hs-var">getSpendingTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393871"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621679393869"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679393869"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIn (Crypto era)
-&gt; Map (TxIn (Crypto era)) (TxOut era) -&gt; Maybe (TxOut era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (Crypto era)
</span><a href="#local-6989586621679393870"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">Map (TxIn (Crypto era)) (TxOut era)
</span><a href="#local-6989586621679393872"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679393866"><span class="annot"><span class="annottext">DataHash (Crypto era)
</span><a href="#local-6989586621679393866"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (DataHash (Crypto era))
-&gt; Maybe (StrictMaybe (DataHash (Crypto era)))
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (DataHash (Crypto era))
 -&gt; Maybe (StrictMaybe (DataHash (Crypto era))))
-&gt; StrictMaybe (DataHash (Crypto era))
-&gt; Maybe (StrictMaybe (DataHash (Crypto era)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; StrictMaybe (DataHash (Crypto era))
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;datahash&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679393869"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="annottext">DataHash (Crypto era)
-&gt; Map (DataHash (Crypto era)) (Data era) -&gt; Maybe (Data era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">DataHash (Crypto era)
</span><a href="#local-6989586621679393866"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxDats era -&gt; Map (DataHash (Crypto era)) (Data era)
forall era. TxDats era -&gt; Map (DataHash (Crypto era)) (Data era)
</span><a href="Cardano.Ledger.Alonzo.TxWitness.html#unTxDats"><span class="hs-identifier hs-var">unTxDats</span></a></span><span> </span><span class="annot"><span class="annottext">(TxDats era -&gt; Map (DataHash (Crypto era)) (Data era))
-&gt; TxDats era -&gt; Map (DataHash (Crypto era)) (Data era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxWitness era -&gt; TxDats era
forall era. TxWitness era -&gt; TxDats era
</span><a href="Cardano.Ledger.Alonzo.TxWitness.html#txdats%27"><span class="hs-identifier hs-var">txdats'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tx -&gt; TxWitness era
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;wits&quot;</span></span><span> </span><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393874"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- ========================================================================</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | When collecting inputs for twophase scripts, 3 things can go wrong.</span><span>
</span><span id="line-114"></span><span id="local-6989586621679393863"><span id="local-6989586621679393864"></span></span><span class="hs-keyword">data</span><span> </span><span id="CollectError"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#CollectError"><span class="hs-identifier hs-var">CollectError</span></a></span></span><span> </span><span id="local-6989586621679394043"><span class="annot"><a href="#local-6989586621679394043"><span class="hs-identifier hs-type">crypto</span></a></span></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoRedeemer"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoRedeemer"><span class="hs-identifier hs-var">NoRedeemer</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679394043"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoWitness"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoWitness"><span class="hs-identifier hs-var">NoWitness</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679394043"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoCostModel"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoCostModel"><span class="hs-identifier hs-var">NoCostModel</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html#Language"><span class="hs-identifier hs-type">Language</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BadTranslation"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#BadTranslation"><span class="hs-identifier hs-var">BadTranslation</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#TranslationError"><span class="hs-identifier hs-type">TranslationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679394043"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393855"><span id="local-6989586621679393857"><span class="annot"><span class="annottext">CollectError crypto -&gt; CollectError crypto -&gt; Bool
(CollectError crypto -&gt; CollectError crypto -&gt; Bool)
-&gt; (CollectError crypto -&gt; CollectError crypto -&gt; Bool)
-&gt; Eq (CollectError crypto)
forall crypto. CollectError crypto -&gt; CollectError crypto -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CollectError crypto -&gt; CollectError crypto -&gt; Bool
$c/= :: forall crypto. CollectError crypto -&gt; CollectError crypto -&gt; Bool
== :: CollectError crypto -&gt; CollectError crypto -&gt; Bool
$c== :: forall crypto. CollectError crypto -&gt; CollectError crypto -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393848"><span id="local-6989586621679393850"><span id="local-6989586621679393852"><span class="annot"><span class="annottext">Int -&gt; CollectError crypto -&gt; ShowS
[CollectError crypto] -&gt; ShowS
CollectError crypto -&gt; String
(Int -&gt; CollectError crypto -&gt; ShowS)
-&gt; (CollectError crypto -&gt; String)
-&gt; ([CollectError crypto] -&gt; ShowS)
-&gt; Show (CollectError crypto)
forall crypto. Int -&gt; CollectError crypto -&gt; ShowS
forall crypto. [CollectError crypto] -&gt; ShowS
forall crypto. CollectError crypto -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CollectError crypto] -&gt; ShowS
$cshowList :: forall crypto. [CollectError crypto] -&gt; ShowS
show :: CollectError crypto -&gt; String
$cshow :: forall crypto. CollectError crypto -&gt; String
showsPrec :: Int -&gt; CollectError crypto -&gt; ShowS
$cshowsPrec :: forall crypto. Int -&gt; CollectError crypto -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. CollectError crypto -&gt; Rep (CollectError crypto) x)
-&gt; (forall x. Rep (CollectError crypto) x -&gt; CollectError crypto)
-&gt; Generic (CollectError crypto)
forall x. Rep (CollectError crypto) x -&gt; CollectError crypto
forall x. CollectError crypto -&gt; Rep (CollectError crypto) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall crypto x. Rep (CollectError crypto) x -&gt; CollectError crypto
forall crypto x. CollectError crypto -&gt; Rep (CollectError crypto) x
$cto :: forall crypto x. Rep (CollectError crypto) x -&gt; CollectError crypto
$cfrom :: forall crypto x. CollectError crypto -&gt; Rep (CollectError crypto) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393838"><span id="local-6989586621679393840"><span id="local-6989586621679393842"><span class="annot"><span class="annottext">Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo)
Proxy (CollectError crypto) -&gt; String
(Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (CollectError crypto) -&gt; String)
-&gt; NoThunks (CollectError crypto)
forall crypto.
Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo)
forall crypto. Proxy (CollectError crypto) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (CollectError crypto) -&gt; String
$cshowTypeOf :: forall crypto. Proxy (CollectError crypto) -&gt; String
wNoThunks :: Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall crypto.
Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: forall crypto.
Context -&gt; CollectError crypto -&gt; IO (Maybe ThunkInfo)
</span><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span id="local-6989586621679393836"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679393830"><span id="local-6989586621679393832"><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393836"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">ToCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#CollectError"><span class="hs-identifier hs-type">CollectError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393836"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621679393828"><span class="annot"><span class="annottext">toCBOR :: CollectError crypto -&gt; Encoding
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toCBOR</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoRedeemer"><span class="hs-identifier hs-type">NoRedeemer</span></a></span><span> </span><span id="local-6989586621679393826"><span class="annot"><span class="annottext">ScriptPurpose crypto
</span><a href="#local-6989586621679393826"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encode 'Open (CollectError crypto) -&gt; Encoding
forall (w :: Wrapped) t. Encode w t -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encode 'Open (CollectError crypto) -&gt; Encoding)
-&gt; Encode 'Open (CollectError crypto) -&gt; Encoding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptPurpose crypto -&gt; CollectError crypto)
-&gt; Word
-&gt; Encode 'Open (ScriptPurpose crypto -&gt; CollectError crypto)
forall t. t -&gt; Word -&gt; Encode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose crypto -&gt; CollectError crypto
forall crypto. ScriptPurpose crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoRedeemer"><span class="hs-identifier hs-var">NoRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Encode 'Open (ScriptPurpose crypto -&gt; CollectError crypto)
-&gt; Encode ('Closed 'Dense) (ScriptPurpose crypto)
-&gt; Encode 'Open (CollectError crypto)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose crypto
-&gt; Encode ('Closed 'Dense) (ScriptPurpose crypto)
forall t. ToCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose crypto
</span><a href="#local-6989586621679393826"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoWitness"><span class="hs-identifier hs-type">NoWitness</span></a></span><span> </span><span id="local-6989586621679393821"><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393821"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encode 'Open (CollectError crypto) -&gt; Encoding
forall (w :: Wrapped) t. Encode w t -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encode 'Open (CollectError crypto) -&gt; Encoding)
-&gt; Encode 'Open (CollectError crypto) -&gt; Encoding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash crypto -&gt; CollectError crypto)
-&gt; Word -&gt; Encode 'Open (ScriptHash crypto -&gt; CollectError crypto)
forall t. t -&gt; Word -&gt; Encode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto -&gt; CollectError crypto
forall crypto. ScriptHash crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoWitness"><span class="hs-identifier hs-var">NoWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Encode 'Open (ScriptHash crypto -&gt; CollectError crypto)
-&gt; Encode ('Closed 'Dense) (ScriptHash crypto)
-&gt; Encode 'Open (CollectError crypto)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto -&gt; Encode ('Closed 'Dense) (ScriptHash crypto)
forall t. ToCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393821"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoCostModel"><span class="hs-identifier hs-type">NoCostModel</span></a></span><span> </span><span id="local-6989586621679393820"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393820"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encode 'Open (CollectError Any) -&gt; Encoding
forall (w :: Wrapped) t. Encode w t -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encode 'Open (CollectError Any) -&gt; Encoding)
-&gt; Encode 'Open (CollectError Any) -&gt; Encoding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Language -&gt; CollectError Any)
-&gt; Word -&gt; Encode 'Open (Language -&gt; CollectError Any)
forall t. t -&gt; Word -&gt; Encode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">Language -&gt; CollectError Any
forall crypto. Language -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoCostModel"><span class="hs-identifier hs-var">NoCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Encode 'Open (Language -&gt; CollectError Any)
-&gt; Encode ('Closed 'Dense) Language
-&gt; Encode 'Open (CollectError Any)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Language -&gt; Encode ('Closed 'Dense) Language
forall t. ToCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393820"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#BadTranslation"><span class="hs-identifier hs-type">BadTranslation</span></a></span><span> </span><span id="local-6989586621679393819"><span class="annot"><span class="annottext">TranslationError crypto
</span><a href="#local-6989586621679393819"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encode 'Open (CollectError crypto) -&gt; Encoding
forall (w :: Wrapped) t. Encode w t -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encode 'Open (CollectError crypto) -&gt; Encoding)
-&gt; Encode 'Open (CollectError crypto) -&gt; Encoding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TranslationError crypto -&gt; CollectError crypto)
-&gt; Word
-&gt; Encode 'Open (TranslationError crypto -&gt; CollectError crypto)
forall t. t -&gt; Word -&gt; Encode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError crypto -&gt; CollectError crypto
forall crypto. TranslationError crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#BadTranslation"><span class="hs-identifier hs-var">BadTranslation</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Encode 'Open (TranslationError crypto -&gt; CollectError crypto)
-&gt; Encode ('Closed 'Dense) (TranslationError crypto)
-&gt; Encode 'Open (CollectError crypto)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError crypto
-&gt; Encode ('Closed 'Dense) (TranslationError crypto)
forall t. ToCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError crypto
</span><a href="#local-6989586621679393819"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span id="local-6989586621679393818"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679393814"><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393818"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">FromCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#CollectError"><span class="hs-identifier hs-type">CollectError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393818"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621679393812"><span class="annot"><span class="annottext">fromCBOR :: Decoder s (CollectError crypto)
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decode ('Closed 'Dense) (CollectError crypto)
-&gt; Decoder s (CollectError crypto)
forall (w :: Wrapped) t s. Decode w t -&gt; Decoder s t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; (Word -&gt; Decode 'Open (CollectError crypto))
-&gt; Decode ('Closed 'Dense) (CollectError crypto)
forall t.
String -&gt; (Word -&gt; Decode 'Open t) -&gt; Decode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Summands</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CollectError&quot;</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Decode 'Open (CollectError crypto)
forall crypto.
Crypto crypto =&gt;
Word -&gt; Decode 'Open (CollectError crypto)
</span><a href="#local-6989586621679393808"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>      </span><span id="local-6989586621679393808"><span class="annot"><span class="annottext">dec :: Word -&gt; Decode 'Open (CollectError crypto)
</span><a href="#local-6989586621679393808"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScriptPurpose crypto -&gt; CollectError crypto)
-&gt; Decode 'Open (ScriptPurpose crypto -&gt; CollectError crypto)
forall t. t -&gt; Decode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">SumD</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose crypto -&gt; CollectError crypto
forall crypto. ScriptPurpose crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoRedeemer"><span class="hs-identifier hs-var">NoRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">Decode 'Open (ScriptPurpose crypto -&gt; CollectError crypto)
-&gt; Decode ('Closed Any) (ScriptPurpose crypto)
-&gt; Decode 'Open (CollectError crypto)
forall (w1 :: Wrapped) a t (w :: Density).
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">Decode ('Closed Any) (ScriptPurpose crypto)
forall t (w :: Wrapped). FromCBOR t =&gt; Decode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">From</span></a></span><span>
</span><span id="line-131"></span><span>      </span><span class="annot"><a href="#local-6989586621679393808"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScriptHash crypto -&gt; CollectError crypto)
-&gt; Decode 'Open (ScriptHash crypto -&gt; CollectError crypto)
forall t. t -&gt; Decode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">SumD</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto -&gt; CollectError crypto
forall crypto. ScriptHash crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoWitness"><span class="hs-identifier hs-var">NoWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Decode 'Open (ScriptHash crypto -&gt; CollectError crypto)
-&gt; Decode ('Closed Any) (ScriptHash crypto)
-&gt; Decode 'Open (CollectError crypto)
forall (w1 :: Wrapped) a t (w :: Density).
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">Decode ('Closed Any) (ScriptHash crypto)
forall t (w :: Wrapped). FromCBOR t =&gt; Decode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">From</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><a href="#local-6989586621679393808"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Language -&gt; CollectError crypto)
-&gt; Decode 'Open (Language -&gt; CollectError crypto)
forall t. t -&gt; Decode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">SumD</span></a></span><span> </span><span class="annot"><span class="annottext">Language -&gt; CollectError crypto
forall crypto. Language -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoCostModel"><span class="hs-identifier hs-var">NoCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">Decode 'Open (Language -&gt; CollectError crypto)
-&gt; Decode ('Closed Any) Language
-&gt; Decode 'Open (CollectError crypto)
forall (w1 :: Wrapped) a t (w :: Density).
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">Decode ('Closed Any) Language
forall t (w :: Wrapped). FromCBOR t =&gt; Decode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">From</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="#local-6989586621679393808"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TranslationError crypto -&gt; CollectError crypto)
-&gt; Decode 'Open (TranslationError crypto -&gt; CollectError crypto)
forall t. t -&gt; Decode 'Open t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">SumD</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError crypto -&gt; CollectError crypto
forall crypto. TranslationError crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#BadTranslation"><span class="hs-identifier hs-var">BadTranslation</span></a></span><span> </span><span class="annot"><span class="annottext">Decode 'Open (TranslationError crypto -&gt; CollectError crypto)
-&gt; Decode ('Closed Any) (TranslationError crypto)
-&gt; Decode 'Open (CollectError crypto)
forall (w1 :: Wrapped) a t (w :: Density).
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">Decode ('Closed Any) (TranslationError crypto)
forall t (w :: Wrapped). FromCBOR t =&gt; Decode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">From</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><a href="#local-6989586621679393808"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span id="local-6989586621679393804"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679393804"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Decode 'Open (CollectError crypto)
forall (w :: Wrapped) t. Word -&gt; Decode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Invalid</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679393804"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- Given a script purpose and a script hash, determine if it is *not*</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- a simple 1-phase script by looking up the script hash in a mapping</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- of script hashes to labeled scripts.</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- If the script is determined to not be a 1-phase script, we return</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- a triple: the script purpose, the language, and the script bytes.</span><span>
</span><span id="line-141"></span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- The formal spec achieves the same filtering as knownToNotBe1Phase</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- by use of the (partial) language function, which is not defined on 1-phase scripts.</span><span>
</span><span id="line-144"></span><span id="local-6989586621679393980"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#knownToNotBe1Phase"><span class="hs-identifier hs-type">knownToNotBe1Phase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393980"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#Script"><span class="hs-identifier hs-type">AlonzoScript.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393980"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393980"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393980"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393980"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html#Language"><span class="hs-identifier hs-type">Language</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-148"></span><span id="knownToNotBe1Phase"><span class="annot"><span class="annottext">knownToNotBe1Phase :: Map (ScriptHash (Crypto era)) (Script era)
-&gt; (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
-&gt; Maybe (ScriptPurpose (Crypto era), Language, ShortByteString)
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#knownToNotBe1Phase"><span class="hs-identifier hs-var hs-var">knownToNotBe1Phase</span></a></span></span><span> </span><span id="local-6989586621679393802"><span class="annot"><span class="annottext">Map (ScriptHash (Crypto era)) (Script era)
</span><a href="#local-6989586621679393802"><span class="hs-identifier hs-var">scriptsAvailable</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393801"><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393801"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393800"><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393800"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#PlutusScript"><span class="hs-identifier hs-type">AlonzoScript.PlutusScript</span></a></span><span> </span><span id="local-6989586621679393798"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393798"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span id="local-6989586621679393797"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679393797"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393800"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash (Crypto era)
-&gt; Map (ScriptHash (Crypto era)) (Script era) -&gt; Maybe (Script era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Map.lookup`</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash (Crypto era)) (Script era)
</span><a href="#local-6989586621679393802"><span class="hs-identifier hs-var">scriptsAvailable</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">(ScriptPurpose (Crypto era), Language, ShortByteString)
-&gt; Maybe (ScriptPurpose (Crypto era), Language, ShortByteString)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393801"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393798"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679393797"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- | Collect the inputs for twophase scripts. If any script can't find ist data return</span><span>
</span><span id="line-153"></span><span class="hs-comment">--     a list of CollectError, if all goes well return a list of quadruples with the inputs.</span><span>
</span><span id="line-154"></span><span class="hs-comment">--     Previous PredicateFailure tests should ensure we find Data for every script, BUT</span><span>
</span><span id="line-155"></span><span class="hs-comment">--     the consequences of not finding Data means scripts can get dropped, so things</span><span>
</span><span id="line-156"></span><span class="hs-comment">--     might validate that shouldn't. So we double check that every Script has its Data, and</span><span>
</span><span id="line-157"></span><span class="hs-comment">--     if that is not the case, a PredicateFailure is raised in the Utxos rule.</span><span>
</span><span id="line-158"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#collectTwoPhaseScriptInputs"><span class="hs-identifier hs-type">collectTwoPhaseScriptInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679393796"><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#ExtendedUTxO"><span class="hs-identifier hs-type">ExtendedUTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#Script"><span class="hs-identifier hs-type">AlonzoScript.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;_costmdls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#CostModels"><span class="hs-identifier hs-type">CostModels</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wdrls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">Wdrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DCert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wits&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html#TxWitness"><span class="hs-identifier hs-type">TxWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">EpochInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SystemStart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#CollectError"><span class="hs-identifier hs-type">CollectError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html#Language"><span class="hs-identifier hs-type">Language</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393796"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#ExUnits"><span class="hs-identifier hs-type">ExUnits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span id="collectTwoPhaseScriptInputs"><span class="annot"><span class="annottext">collectTwoPhaseScriptInputs :: EpochInfo (Either Text)
-&gt; SystemStart
-&gt; PParams era
-&gt; Tx era
-&gt; UTxO era
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#collectTwoPhaseScriptInputs"><span class="hs-identifier hs-var hs-var">collectTwoPhaseScriptInputs</span></a></span></span><span> </span><span id="local-6989586621679393795"><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621679393795"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621679393794"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679393794"><span class="hs-identifier hs-var">sysS</span></a></span></span><span> </span><span id="local-6989586621679393793"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679393793"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621679393792"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679393792"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621679393791"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393791"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679393790"><span class="annot"><span class="annottext">usedLanguages :: Set Language
</span><a href="#local-6989586621679393790"><span class="hs-identifier hs-var hs-var">usedLanguages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Language] -&gt; Set Language
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393788"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393788"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393788"><span class="hs-identifier hs-var">lang</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), Language, ShortByteString)]
</span><a href="#local-6989586621679393787"><span class="hs-identifier hs-var">neededAndConfirmedToBePlutus</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>      </span><span id="local-6989586621679393786"><span class="annot"><span class="annottext">costModels :: Map Language CostModel
</span><a href="#local-6989586621679393786"><span class="hs-identifier hs-var hs-var">costModels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CostModels -&gt; Map Language CostModel
</span><a href="Cardano.Ledger.Alonzo.Scripts.html#unCostModels"><span class="hs-identifier hs-var hs-var">unCostModels</span></a></span><span> </span><span class="annot"><span class="annottext">(CostModels -&gt; Map Language CostModel)
-&gt; CostModels -&gt; Map Language CostModel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; CostModels
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_costmdls&quot;</span></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679393793"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span id="local-6989586621679393784"><span class="annot"><span class="annottext">missingCMs :: Set Language
</span><a href="#local-6989586621679393784"><span class="hs-identifier hs-var hs-var">missingCMs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Language -&gt; Bool) -&gt; Set Language -&gt; Set Language
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Language -&gt; Map Language CostModel -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Map.notMember`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Language CostModel
</span><a href="#local-6989586621679393786"><span class="hs-identifier hs-var">costModels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Language
</span><a href="#local-6989586621679393790"><span class="hs-identifier hs-var">usedLanguages</span></a></span><span>
</span><span id="line-179"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Language -&gt; Maybe Language
forall a. Set a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.lookupMin</span></a></span><span> </span><span class="annot"><span class="annottext">Set Language
</span><a href="#local-6989586621679393784"><span class="hs-identifier hs-var">missingCMs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679393780"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393780"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CollectError (Crypto era)]
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Language -&gt; CollectError (Crypto era)
forall crypto. Language -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoCostModel"><span class="hs-identifier hs-var">NoCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393780"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><span class="annottext">Maybe Language
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>          </span><span class="annot"><span class="annottext">((Language, ScriptPurpose (Crypto era), Data era, ExUnits)
 -&gt; ShortByteString
 -&gt; Either
      (CollectError (Crypto era))
      (ShortByteString, Language, [Data era], ExUnits, CostModel))
-&gt; [Either
      (CollectError (Crypto era))
      (Language, ScriptPurpose (Crypto era), Data era, ExUnits)]
-&gt; [ShortByteString]
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
forall t1 t2 a1 a2.
(t1 -&gt; t2 -&gt; Either a2 a1)
-&gt; [Either a2 t1] -&gt; [t2] -&gt; Either [a2] [a1] -&gt; Either [a2] [a1]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Language CostModel
-&gt; (Language, ScriptPurpose (Crypto era), Data era, ExUnits)
-&gt; ShortByteString
-&gt; Either
     (CollectError (Crypto era))
     (ShortByteString, Language, [Data era], ExUnits, CostModel)
</span><a href="#local-6989586621679393778"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">Map Language CostModel
</span><a href="#local-6989586621679393786"><span class="hs-identifier hs-var">costModels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ScriptPurpose (Crypto era), Language, ShortByteString)
 -&gt; Either
      (CollectError (Crypto era))
      (Language, ScriptPurpose (Crypto era), Data era, ExUnits))
-&gt; [(ScriptPurpose (Crypto era), Language, ShortByteString)]
-&gt; [Either
      (CollectError (Crypto era))
      (Language, ScriptPurpose (Crypto era), Data era, ExUnits)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptPurpose (Crypto era), Language, ShortByteString)
-&gt; Either
     (CollectError (Crypto era))
     (Language, ScriptPurpose (Crypto era), Data era, ExUnits)
</span><a href="#local-6989586621679393777"><span class="hs-identifier hs-var">redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), Language, ShortByteString)]
</span><a href="#local-6989586621679393787"><span class="hs-identifier hs-var">neededAndConfirmedToBePlutus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ScriptPurpose (Crypto era), Language, ShortByteString)
 -&gt; ShortByteString)
-&gt; [(ScriptPurpose (Crypto era), Language, ShortByteString)]
-&gt; [ShortByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptPurpose (Crypto era), Language, ShortByteString)
-&gt; ShortByteString
forall a b c. (a, b, c) -&gt; c
</span><a href="#local-6989586621679393776"><span class="hs-identifier hs-var">getscript</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), Language, ShortByteString)]
</span><a href="#local-6989586621679393787"><span class="hs-identifier hs-var">neededAndConfirmedToBePlutus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679393775"><span class="annot"><span class="annottext">scriptsAvailable :: Map (ScriptHash (Crypto era)) (Script era)
</span><a href="#local-6989586621679393775"><span class="hs-identifier hs-var hs-var">scriptsAvailable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Tx era -&gt; Map (ScriptHash (Crypto era)) (Script era)
forall era.
ExtendedUTxO era =&gt;
UTxO era -&gt; Tx era -&gt; Map (ScriptHash (Crypto era)) (Script era)
</span><a href="Cardano.Ledger.Alonzo.TxInfo.html#txscripts"><span class="hs-identifier hs-var">txscripts</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393791"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679393792"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679393773"><span class="annot"><span class="annottext">txinfo :: Language -&gt; Either (TranslationError (Crypto era)) VersionedTxInfo
</span><a href="#local-6989586621679393773"><span class="hs-identifier hs-var hs-var">txinfo</span></a></span></span><span> </span><span id="local-6989586621679393772"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393772"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era
-&gt; Language
-&gt; EpochInfo (Either Text)
-&gt; SystemStart
-&gt; UTxO era
-&gt; Tx era
-&gt; Either (TranslationError (Crypto era)) VersionedTxInfo
forall era.
ExtendedUTxO era =&gt;
PParams era
-&gt; Language
-&gt; EpochInfo (Either Text)
-&gt; SystemStart
-&gt; UTxO era
-&gt; Tx era
-&gt; Either (TranslationError (Crypto era)) VersionedTxInfo
</span><a href="Cardano.Ledger.Alonzo.TxInfo.html#txInfo"><span class="hs-identifier hs-var">txInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679393793"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393772"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621679393795"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679393794"><span class="hs-identifier hs-var">sysS</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393791"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679393792"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621679393787"><span class="annot"><span class="annottext">neededAndConfirmedToBePlutus :: [(ScriptPurpose (Crypto era), Language, ShortByteString)]
</span><a href="#local-6989586621679393787"><span class="hs-identifier hs-var hs-var">neededAndConfirmedToBePlutus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="annottext">((ScriptPurpose (Crypto era), ScriptHash (Crypto era))
 -&gt; Maybe (ScriptPurpose (Crypto era), Language, ShortByteString))
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), Language, ShortByteString)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (ScriptHash (Crypto era)) (Script era)
-&gt; (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
-&gt; Maybe (ScriptPurpose (Crypto era), Language, ShortByteString)
forall era.
Map (ScriptHash (Crypto era)) (Script era)
-&gt; (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
-&gt; Maybe (ScriptPurpose (Crypto era), Language, ShortByteString)
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#knownToNotBe1Phase"><span class="hs-identifier hs-var">knownToNotBe1Phase</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash (Crypto era)) (Script era)
Map (ScriptHash (Crypto era)) (Script era)
</span><a href="#local-6989586621679393775"><span class="hs-identifier hs-var">scriptsAvailable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
 -&gt; [(ScriptPurpose (Crypto era), Language, ShortByteString)])
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), Language, ShortByteString)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
-&gt; Tx era
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall era tx.
(Era era, HasField &quot;inputs&quot; (TxBody era) (Set (TxIn (Crypto era))),
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl (Crypto era)),
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert (Crypto era))),
 HasField &quot;body&quot; tx (TxBody era)) =&gt;
UTxO era
-&gt; tx -&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeeded"><span class="hs-identifier hs-var">scriptsNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393791"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679393792"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679393777"><span class="annot"><span class="annottext">redeemer :: (ScriptPurpose (Crypto era), Language, ShortByteString)
-&gt; Either
     (CollectError (Crypto era))
     (Language, ScriptPurpose (Crypto era), Data era, ExUnits)
</span><a href="#local-6989586621679393777"><span class="hs-identifier hs-var hs-var">redeemer</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393770"><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393770"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393769"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393769"><span class="hs-identifier hs-var">lang</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ScriptPurpose (Crypto era) -&gt; Maybe (Data era, ExUnits)
forall era tx.
(Era era, HasField &quot;inputs&quot; (TxBody era) (Set (TxIn (Crypto era))),
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl (Crypto era)),
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert (Crypto era))),
 HasField &quot;wits&quot; tx (TxWitness era),
 HasField &quot;body&quot; tx (TxBody era)) =&gt;
tx -&gt; ScriptPurpose (Crypto era) -&gt; Maybe (Data era, ExUnits)
</span><a href="Cardano.Ledger.Alonzo.Tx.html#indexedRdmrs"><span class="hs-identifier hs-var">indexedRdmrs</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679393792"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393770"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393768"><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621679393768"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393767"><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621679393767"><span class="hs-identifier hs-var">eu</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Language, ScriptPurpose (Crypto era), Data era, ExUnits)
-&gt; Either
     (CollectError (Crypto era))
     (Language, ScriptPurpose (Crypto era), Data era, ExUnits)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393769"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393770"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621679393768"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621679393767"><span class="hs-identifier hs-var">eu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Data era, ExUnits)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CollectError (Crypto era)
-&gt; Either
     (CollectError (Crypto era))
     (Language, ScriptPurpose (Crypto era), Data era, ExUnits)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era) -&gt; CollectError (Crypto era)
forall crypto. ScriptPurpose crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#NoRedeemer"><span class="hs-identifier hs-var">NoRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393770"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679393776"><span class="annot"><span class="annottext">getscript :: (a, b, c) -&gt; c
</span><a href="#local-6989586621679393776"><span class="hs-identifier hs-var hs-var">getscript</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393766"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679393766"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679393766"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679393778"><span class="annot"><span class="annottext">apply :: Map Language CostModel
-&gt; (Language, ScriptPurpose (Crypto era), Data era, ExUnits)
-&gt; ShortByteString
-&gt; Either
     (CollectError (Crypto era))
     (ShortByteString, Language, [Data era], ExUnits, CostModel)
</span><a href="#local-6989586621679393778"><span class="hs-identifier hs-var hs-var">apply</span></a></span></span><span> </span><span id="local-6989586621679393765"><span class="annot"><span class="annottext">Map Language CostModel
</span><a href="#local-6989586621679393765"><span class="hs-identifier hs-var">costs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393764"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393764"><span class="hs-identifier hs-var">lang</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393763"><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393763"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393762"><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621679393762"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393761"><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621679393761"><span class="hs-identifier hs-var">eu</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393760"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679393760"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Language -&gt; Either (TranslationError (Crypto era)) VersionedTxInfo
</span><a href="#local-6989586621679393773"><span class="hs-identifier hs-var">txinfo</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393764"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679393759"><span class="annot"><span class="annottext">VersionedTxInfo
</span><a href="#local-6989586621679393759"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679393758"><span class="annot"><span class="annottext">datums :: [Data era]
</span><a href="#local-6989586621679393758"><span class="hs-identifier hs-var hs-var">datums</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Data era] -&gt; [Data era])
-&gt; (Data era -&gt; [Data era] -&gt; [Data era])
-&gt; Maybe (Data era)
-&gt; [Data era]
-&gt; [Data era]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Data era] -&gt; [Data era]
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
-&gt; UTxO era -&gt; ScriptPurpose (Crypto era) -&gt; Maybe (Data era)
forall era.
ExtendedUTxO era =&gt;
Tx era
-&gt; UTxO era -&gt; ScriptPurpose (Crypto era) -&gt; Maybe (Data era)
</span><a href="Cardano.Ledger.Alonzo.TxInfo.html#getDatum"><span class="hs-identifier hs-var">getDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679393792"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393791"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393763"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621679393762"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VersionedTxInfo -&gt; ScriptPurpose (Crypto era) -&gt; Data era
forall era.
VersionedTxInfo -&gt; ScriptPurpose (Crypto era) -&gt; Data era
</span><a href="Cardano.Ledger.Alonzo.TxInfo.html#valContext"><span class="hs-identifier hs-var">valContext</span></a></span><span> </span><span class="annot"><span class="annottext">VersionedTxInfo
</span><a href="#local-6989586621679393759"><span class="hs-identifier hs-var">inf</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose (Crypto era)
</span><a href="#local-6989586621679393763"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-201"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ShortByteString, Language, [Data era], ExUnits, CostModel)
-&gt; Either
     (CollectError (Crypto era))
     (ShortByteString, Language, [Data era], ExUnits, CostModel)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679393760"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393764"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Data era]
</span><a href="#local-6989586621679393758"><span class="hs-identifier hs-var">datums</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621679393761"><span class="hs-identifier hs-var">eu</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Language CostModel
</span><a href="#local-6989586621679393765"><span class="hs-identifier hs-var">costs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Language CostModel -&gt; Language -&gt; CostModel
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">Map.!</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393764"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679393753"><span class="annot"><span class="annottext">TranslationError (Crypto era)
</span><a href="#local-6989586621679393753"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CollectError (Crypto era)
-&gt; Either
     (CollectError (Crypto era))
     (ShortByteString, Language, [Data era], ExUnits, CostModel)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectError (Crypto era)
 -&gt; Either
      (CollectError (Crypto era))
      (ShortByteString, Language, [Data era], ExUnits, CostModel))
-&gt; CollectError (Crypto era)
-&gt; Either
     (CollectError (Crypto era))
     (ShortByteString, Language, [Data era], ExUnits, CostModel)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError (Crypto era) -&gt; CollectError (Crypto era)
forall crypto. TranslationError crypto -&gt; CollectError crypto
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#BadTranslation"><span class="hs-identifier hs-var">BadTranslation</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError (Crypto era)
</span><a href="#local-6989586621679393753"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Merge two lists (the first of which may have failures, i.e. (Left _)), collect all the failures</span><span>
</span><span id="line-205"></span><span class="hs-comment">--   but if there are none, use 'f' to construct a success.</span><span>
</span><span id="line-206"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679393995"><span class="annot"><a href="#local-6989586621679393995"><span class="hs-identifier hs-type">t1</span></a></span></span><span> </span><span id="local-6989586621679393994"><span class="annot"><a href="#local-6989586621679393994"><span class="hs-identifier hs-type">t2</span></a></span></span><span> </span><span id="local-6989586621679393992"><span class="annot"><a href="#local-6989586621679393992"><span class="hs-identifier hs-type">a1</span></a></span></span><span> </span><span id="local-6989586621679393993"><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679393995"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679393994"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393992"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393995"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393994"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393992"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393992"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span id="merge"><span class="annot"><span class="annottext">merge :: (t1 -&gt; t2 -&gt; Either a2 a1)
-&gt; [Either a2 t1] -&gt; [t2] -&gt; Either [a2] [a1] -&gt; Either [a2] [a1]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621679393752"><span class="annot"><span class="annottext">t1 -&gt; t2 -&gt; Either a2 a1
</span><a href="#local-6989586621679393752"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679393751"><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393751"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393751"><span class="hs-identifier hs-var">answer</span></a></span><span>
</span><span id="line-208"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span id="local-6989586621679393750"><span class="annot"><span class="annottext">t1 -&gt; t2 -&gt; Either a2 a1
</span><a href="#local-6989586621679393750"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[t2]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393749"><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393749"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393749"><span class="hs-identifier hs-var">answer</span></a></span><span>
</span><span id="line-209"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span id="local-6989586621679393748"><span class="annot"><span class="annottext">t1 -&gt; t2 -&gt; Either a2 a1
</span><a href="#local-6989586621679393748"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either a2 t1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Either a2 t1]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679393747"><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393747"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393747"><span class="hs-identifier hs-var">answer</span></a></span><span>
</span><span id="line-210"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span id="local-6989586621679393746"><span class="annot"><span class="annottext">t1 -&gt; t2 -&gt; Either a2 a1
</span><a href="#local-6989586621679393746"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393745"><span class="annot"><span class="annottext">Either a2 t1
</span><a href="#local-6989586621679393745"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679393744"><span class="annot"><span class="annottext">[Either a2 t1]
</span><a href="#local-6989586621679393744"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679393743"><span class="annot"><span class="annottext">t2
</span><a href="#local-6989586621679393743"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679393742"><span class="annot"><span class="annottext">[t2]
</span><a href="#local-6989586621679393742"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393741"><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393741"><span class="hs-identifier hs-var">zs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(t1 -&gt; t2 -&gt; Either a2 a1)
-&gt; [Either a2 t1] -&gt; [t2] -&gt; Either [a2] [a1] -&gt; Either [a2] [a1]
forall t1 t2 a1 a2.
(t1 -&gt; t2 -&gt; Either a2 a1)
-&gt; [Either a2 t1] -&gt; [t2] -&gt; Either [a2] [a1] -&gt; Either [a2] [a1]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">t1 -&gt; t2 -&gt; Either a2 a1
</span><a href="#local-6989586621679393746"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Either a2 t1]
</span><a href="#local-6989586621679393744"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[t2]
</span><a href="#local-6989586621679393742"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either a2 t1 -&gt; t2 -&gt; Either [a2] [a1] -&gt; Either [a2] [a1]
</span><a href="#local-6989586621679393740"><span class="hs-identifier hs-var">gg</span></a></span><span> </span><span class="annot"><span class="annottext">Either a2 t1
</span><a href="#local-6989586621679393745"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t2
</span><a href="#local-6989586621679393743"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Either [a2] [a1]
</span><a href="#local-6989586621679393741"><span class="hs-identifier hs-var">zs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="#local-6989586621679393740"><span class="hs-identifier hs-type">gg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393995"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679393994"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393992"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393993"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679393992"><span class="hs-identifier hs-type">a1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679393740"><span class="annot"><span class="annottext">gg :: Either a2 t1 -&gt; t2 -&gt; Either [a2] [a1] -&gt; Either [a2] [a1]
</span><a href="#local-6989586621679393740"><span class="hs-identifier hs-var hs-var">gg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679393739"><span class="annot"><span class="annottext">t1
</span><a href="#local-6989586621679393739"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393738"><span class="annot"><span class="annottext">t2
</span><a href="#local-6989586621679393738"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679393737"><span class="annot"><span class="annottext">[a1]
</span><a href="#local-6989586621679393737"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">t1 -&gt; t2 -&gt; Either a2 a1
</span><a href="#local-6989586621679393746"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t1
</span><a href="#local-6989586621679393739"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">t2
</span><a href="#local-6989586621679393738"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679393736"><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621679393736"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a1] -&gt; Either [a2] [a1]
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">([a1] -&gt; Either [a2] [a1]) -&gt; [a1] -&gt; Either [a2] [a1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621679393736"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">a1 -&gt; [a1] -&gt; [a1]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[a1]
</span><a href="#local-6989586621679393737"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679393735"><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621679393735"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a2] -&gt; Either [a2] [a1]
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621679393735"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="#local-6989586621679393740"><span class="hs-identifier hs-var">gg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679393734"><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621679393734"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">[a1]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a2] -&gt; Either [a2] [a1]
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621679393734"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="#local-6989586621679393740"><span class="hs-identifier hs-var">gg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">t1
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679393733"><span class="annot"><span class="annottext">[a2]
</span><a href="#local-6989586621679393733"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a2] -&gt; Either [a2] [a1]
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[a2]
</span><a href="#local-6989586621679393733"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><a href="#local-6989586621679393740"><span class="hs-identifier hs-var">gg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679393732"><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621679393732"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679393731"><span class="annot"><span class="annottext">[a2]
</span><a href="#local-6989586621679393731"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a2] -&gt; Either [a2] [a1]
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a2
</span><a href="#local-6989586621679393732"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a2 -&gt; [a2] -&gt; [a2]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[a2]
</span><a href="#local-6989586621679393731"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span id="local-6989586621679393730"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#language"><span class="hs-identifier hs-type">language</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#Script"><span class="hs-identifier hs-type">AlonzoScript.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393730"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html#Language"><span class="hs-identifier hs-type">Language</span></a></span></span><span>
</span><span id="line-222"></span><span id="language"><span class="annot"><span class="annottext">language :: Script era -&gt; Maybe Language
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#language"><span class="hs-identifier hs-var hs-var">language</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#PlutusScript"><span class="hs-identifier hs-type">AlonzoScript.PlutusScript</span></a></span><span> </span><span id="local-6989586621679393729"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393729"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Language -&gt; Maybe Language
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393729"><span class="hs-identifier hs-var">lang</span></a></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#language"><span class="hs-identifier hs-var">language</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#TimelockScript"><span class="hs-identifier hs-type">AlonzoScript.TimelockScript</span></a></span><span> </span><span class="annot"><span class="annottext">Timelock (Crypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Language
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | evaluate a list of scripts, All scripts in the list must be True.</span><span>
</span><span id="line-226"></span><span class="hs-comment">--   There are two kinds of scripts, evaluate each kind using the</span><span>
</span><span id="line-227"></span><span class="hs-comment">--   appropriate mechanism.</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#evalScripts"><span class="hs-identifier hs-type">evalScripts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679393946"><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621679393945"><span class="annot"><a href="#local-6989586621679393945"><span class="hs-identifier hs-type">tx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#Script"><span class="hs-identifier hs-type">AlonzoScript.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679393945"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wits&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679393945"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxWitness.html#TxWitness"><span class="hs-identifier hs-type">TxWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;vldt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley-ma/html/src"><span class="hs-identifier hs-type">ValidityInterval</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="#local-6989586621679393945"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Language.html#Language"><span class="hs-identifier hs-type">Language</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#ExUnits"><span class="hs-identifier hs-type">ExUnits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Alonzo.Scripts.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Alonzo.TxInfo.html#ScriptResult"><span class="hs-identifier hs-type">ScriptResult</span></a></span><span>
</span><span id="line-240"></span><span id="evalScripts"><span class="annot"><span class="annottext">evalScripts :: ProtVer
-&gt; tx
-&gt; [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; ScriptResult
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#evalScripts"><span class="hs-identifier hs-var hs-var">evalScripts</span></a></span></span><span> </span><span id="local-6989586621679393727"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679393727"><span class="hs-identifier hs-var">_pv</span></a></span></span><span> </span><span id="local-6989586621679393726"><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393726"><span class="hs-identifier hs-var">_tx</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptResult
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-241"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#evalScripts"><span class="hs-identifier hs-var">evalScripts</span></a></span><span> </span><span id="local-6989586621679393725"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679393725"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621679393724"><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393724"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679393723"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679393723"><span class="hs-identifier hs-var">pscript</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393722"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393722"><span class="hs-identifier hs-var">lang</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393721"><span class="annot"><span class="annottext">[Data era]
</span><a href="#local-6989586621679393721"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393720"><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621679393720"><span class="hs-identifier hs-var">units</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679393719"><span class="annot"><span class="annottext">CostModel
</span><a href="#local-6989586621679393719"><span class="hs-identifier hs-var">cost</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679393718"><span class="annot"><span class="annottext">[(ShortByteString, Language, [Data era], ExUnits, CostModel)]
</span><a href="#local-6989586621679393718"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679393717"><span class="annot"><span class="annottext">beginMsg :: String
</span><a href="#local-6989586621679393717"><span class="hs-identifier hs-var hs-var">beginMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Context -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">intercalate</span></a></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[LEDGER][PLUTUS_SCRIPT]&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BEGIN&quot;</span></span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679393716"><span class="annot"><span class="annottext">res :: ScriptResult
</span><a href="#local-6989586621679393716"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ScriptResult -&gt; ScriptResult
forall a. String -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traceEvent</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679393717"><span class="hs-identifier hs-var">beginMsg</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptResult -&gt; ScriptResult) -&gt; ScriptResult -&gt; ScriptResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy era
-&gt; ProtVer
-&gt; Language
-&gt; CostModel
-&gt; ShortByteString
-&gt; ExUnits
-&gt; [Data]
-&gt; ScriptResult
forall era.
Show (Script era) =&gt;
Proxy era
-&gt; ProtVer
-&gt; Language
-&gt; CostModel
-&gt; ShortByteString
-&gt; ExUnits
-&gt; [Data]
-&gt; ScriptResult
</span><a href="Cardano.Ledger.Alonzo.TxInfo.html#runPLCScript"><span class="hs-identifier hs-var">runPLCScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy era
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679393946"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679393725"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679393722"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel
</span><a href="#local-6989586621679393719"><span class="hs-identifier hs-var">cost</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679393723"><span class="hs-identifier hs-var">pscript</span></a></span><span> </span><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621679393720"><span class="hs-identifier hs-var">units</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Data era -&gt; Data) -&gt; [Data era] -&gt; [Data]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Data era -&gt; Data
forall era. Data era -&gt; Data
</span><a href="Cardano.Ledger.Alonzo.Data.html#getPlutusData"><span class="hs-identifier hs-var">getPlutusData</span></a></span><span> </span><span class="annot"><span class="annottext">[Data era]
</span><a href="#local-6989586621679393721"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621679393714"><span class="annot"><span class="annottext">endMsg :: String
</span><a href="#local-6989586621679393714"><span class="hs-identifier hs-var hs-var">endMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Context -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">intercalate</span></a></span><span>
</span><span id="line-251"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-252"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[LEDGER][PLUTUS_SCRIPT]&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;END&quot;</span></span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String -&gt; ScriptResult -&gt; ScriptResult
forall a. String -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traceEvent</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679393714"><span class="hs-identifier hs-var">endMsg</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptResult
</span><a href="#local-6989586621679393716"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptResult -&gt; ScriptResult -&gt; ScriptResult
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
-&gt; tx
-&gt; [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; ScriptResult
forall era tx.
(Era era, Show (Script era), HasField &quot;body&quot; tx (TxBody era),
 HasField &quot;wits&quot; tx (TxWitness era),
 HasField &quot;vldt&quot; (TxBody era) ValidityInterval) =&gt;
ProtVer
-&gt; tx
-&gt; [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; ScriptResult
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#evalScripts"><span class="hs-identifier hs-var">evalScripts</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679393725"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393724"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortByteString, Language, [Data era], ExUnits, CostModel)]
</span><a href="#local-6989586621679393718"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- Collect information (purpose and ScriptHash) about all the</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- Credentials that refer to scripts, that might be run in a Tx.</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- THE SPEC CALLS FOR A SET, BUT THAT NEEDS A BUNCH OF ORD INSTANCES (DCert)</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- See additional comments about 'scriptsNeededFromBody' below.</span><span>
</span><span id="line-261"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeeded"><span class="hs-identifier hs-type">scriptsNeeded</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679393979"><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621679393974"><span class="annot"><a href="#local-6989586621679393974"><span class="hs-identifier hs-type">tx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wdrls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">Wdrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DCert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679393974"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><a href="#local-6989586621679393974"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393979"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span id="scriptsNeeded"><span class="annot"><span class="annottext">scriptsNeeded :: UTxO era
-&gt; tx -&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeeded"><span class="hs-identifier hs-var hs-var">scriptsNeeded</span></a></span></span><span> </span><span id="local-6989586621679393713"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393713"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679393712"><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393712"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO era
-&gt; TxBody era
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall era.
(Era era, HasField &quot;inputs&quot; (TxBody era) (Set (TxIn (Crypto era))),
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl (Crypto era)),
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert (Crypto era)))) =&gt;
UTxO era
-&gt; TxBody era
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeededFromBody"><span class="hs-identifier hs-var">scriptsNeededFromBody</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679393713"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tx -&gt; TxBody era
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">tx
</span><a href="#local-6989586621679393712"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">-- We only find certificate witnesses in Delegating and Deregistration DCerts</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- that have ScriptHashObj credentials.</span><span>
</span><span id="line-276"></span><span id="local-6989586621679393908"><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#addOnlyCwitness"><span class="hs-identifier hs-type">addOnlyCwitness</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393908"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393908"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393908"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393908"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393908"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-280"></span><span id="addOnlyCwitness"><span class="annot"><span class="annottext">addOnlyCwitness :: [(ScriptPurpose crypto, ScriptHash crypto)]
-&gt; DCert crypto -&gt; [(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#addOnlyCwitness"><span class="hs-identifier hs-var hs-var">addOnlyCwitness</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679393710"><span class="annot"><span class="annottext">[(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="#local-6989586621679393710"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DCertDeleg</span></a></span><span> </span><span id="local-6989586621679393708"><span class="annot"><span class="annottext">c :: DelegCert crypto
</span><a href="#local-6989586621679393708"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DeRegKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHashObj</span></a></span><span> </span><span id="local-6989586621679393706"><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393706"><span class="hs-identifier hs-var">hk</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DCert crypto -&gt; ScriptPurpose crypto
forall crypto. DCert crypto -&gt; ScriptPurpose crypto
</span><a href="Cardano.Ledger.Alonzo.Tx.html#Certifying"><span class="hs-identifier hs-var">Certifying</span></a></span><span> </span><span class="annot"><span class="annottext">(DCert crypto -&gt; ScriptPurpose crypto)
-&gt; DCert crypto -&gt; ScriptPurpose crypto
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DelegCert crypto -&gt; DCert crypto
forall crypto. DelegCert crypto -&gt; DCert crypto
</span><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-var">DCertDeleg</span></a></span><span> </span><span class="annot"><span class="annottext">DelegCert crypto
</span><a href="#local-6989586621679393708"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393706"><span class="hs-identifier hs-var">hk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScriptPurpose crypto, ScriptHash crypto)
-&gt; [(ScriptPurpose crypto, ScriptHash crypto)]
-&gt; [(ScriptPurpose crypto, ScriptHash crypto)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="#local-6989586621679393710"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#addOnlyCwitness"><span class="hs-identifier hs-var">addOnlyCwitness</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679393705"><span class="annot"><span class="annottext">[(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="#local-6989586621679393705"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DCertDeleg</span></a></span><span> </span><span id="local-6989586621679393704"><span class="annot"><span class="annottext">c :: DelegCert crypto
</span><a href="#local-6989586621679393704"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">Delegate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">Delegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHashObj</span></a></span><span> </span><span id="local-6989586621679393701"><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393701"><span class="hs-identifier hs-var">hk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393700"><span class="annot"><span class="annottext">KeyHash 'StakePool crypto
</span><a href="#local-6989586621679393700"><span class="hs-identifier hs-var">_dpool</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DCert crypto -&gt; ScriptPurpose crypto
forall crypto. DCert crypto -&gt; ScriptPurpose crypto
</span><a href="Cardano.Ledger.Alonzo.Tx.html#Certifying"><span class="hs-identifier hs-var">Certifying</span></a></span><span> </span><span class="annot"><span class="annottext">(DCert crypto -&gt; ScriptPurpose crypto)
-&gt; DCert crypto -&gt; ScriptPurpose crypto
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DelegCert crypto -&gt; DCert crypto
forall crypto. DelegCert crypto -&gt; DCert crypto
</span><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-var">DCertDeleg</span></a></span><span> </span><span class="annot"><span class="annottext">DelegCert crypto
</span><a href="#local-6989586621679393704"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393701"><span class="hs-identifier hs-var">hk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ScriptPurpose crypto, ScriptHash crypto)
-&gt; [(ScriptPurpose crypto, ScriptHash crypto)]
-&gt; [(ScriptPurpose crypto, ScriptHash crypto)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="#local-6989586621679393705"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#addOnlyCwitness"><span class="hs-identifier hs-var">addOnlyCwitness</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679393699"><span class="annot"><span class="annottext">[(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="#local-6989586621679393699"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span class="annot"><span class="annottext">DCert crypto
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="#local-6989586621679393699"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- Uses of inputs in &#8216;txscripts&#8217; and &#8216;neededScripts&#8217;</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- There are currently 3 sets of inputs (spending, collateral, reference). A particular TxInput</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- can appear in more than one of the sets. Even in all three at the same, but that may not be</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- a really useful case. Inputs are where you find scripts with the 'Spending' purpose.</span><span>
</span><span id="line-291"></span><span class="hs-comment">--</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- 1) Collateral inputs are only spent if phase two fails. Their corresponding TxOut can only have</span><span>
</span><span id="line-293"></span><span class="hs-comment">--    Key (not Script) Pay credentials, so &#8216;neededScripts&#8217; does not look there.</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- 2) Reference inputs are not spent in the current Tx, unless that same input also appears in one</span><span>
</span><span id="line-295"></span><span class="hs-comment">--    of the other sets. If that is not the case, their credentials are never needed, so anyone can</span><span>
</span><span id="line-296"></span><span class="hs-comment">--    access the inline datums and scripts in their corresponding TxOut, without needing any</span><span>
</span><span id="line-297"></span><span class="hs-comment">--    authorizing credentials. So &#8216;neededScripts&#8217; does not look there.</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- 3) Spending inputs are always spent. So their Pay credentials are always needed.</span><span>
</span><span id="line-299"></span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- Collect information (purpose and ScriptHash) about all the Credentials that refer to scripts</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- that will be needed to run in a TxBody in the Utxow rule. Note there may be credentials that</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- cannot be run, so are not collected. In Babbage, reference inputs, fit that description.</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- Purposes include</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- 1) Spending (payment script credentials, but NOT staking scripts) in the Addr of a TxOut, pointed</span><span>
</span><span id="line-305"></span><span class="hs-comment">--    to by some input that needs authorization. Be sure (getField @&quot;inputs&quot; txb) gets all such inputs.</span><span>
</span><span id="line-306"></span><span class="hs-comment">--    In some Eras there may be multiple sets of inputs, which ones should be included? Currently that</span><span>
</span><span id="line-307"></span><span class="hs-comment">--    is only the spending inputs. Because collateral inputs can only have key-locked credentials,</span><span>
</span><span id="line-308"></span><span class="hs-comment">--    and reference inputs are never authorized. That might not always be the case.</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- 2) Rewarding (Withdrawals),</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- 3) Minting (minted field), and</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- 4) Certifying (Delegating) scripts.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- 'scriptsNeeded' is an aggregation of the needed Credentials referring to Scripts used in Utxow rule.</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- The flip side of 'scriptsNeeded' (which collects script hashes) is 'txscripts' which finds the</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- actual scripts. We maintain an invariant that every script credential refers to some actual script.</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- This is tested in the test function 'validateMissingScripts' in the Utxow rule.</span><span>
</span><span id="line-317"></span><span class="annot"><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeededFromBody"><span class="hs-identifier hs-type">scriptsNeededFromBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679393941"><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wdrls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">Wdrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../strict-containers/html/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">DCert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span id="scriptsNeededFromBody"><span class="annot"><span class="annottext">scriptsNeededFromBody :: UTxO era
-&gt; TxBody era
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#scriptsNeededFromBody"><span class="hs-identifier hs-var hs-var">scriptsNeededFromBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span id="local-6989586621679393698"><span class="annot"><span class="annottext">Map (TxIn (Crypto era)) (TxOut era)
</span><a href="#local-6989586621679393698"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679393697"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679393697"><span class="hs-identifier hs-var">txb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393696"><span class="hs-identifier hs-var">spend</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393695"><span class="hs-identifier hs-var">reward</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393694"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393693"><span class="hs-identifier hs-var">minted</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="#local-6989586621679393692"><span class="hs-identifier hs-type">collect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Alonzo.Tx.html#ScriptPurpose"><span class="hs-identifier hs-type">ScriptPurpose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679393941"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621679393692"><span class="annot"><span class="annottext">collect :: TxIn (Crypto era)
-&gt; Maybe (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
</span><a href="#local-6989586621679393692"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679393691"><span class="annot"><span class="annottext">TxIn (Crypto era)
</span><a href="#local-6989586621679393691"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>      </span><span id="local-6989586621679393690"><span class="annot"><span class="annottext">Addr (Crypto era)
</span><a href="#local-6989586621679393690"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; Addr (Crypto era)
forall e. Era e =&gt; TxOut e -&gt; Addr (Crypto e)
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">getTxOutAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut era -&gt; Addr (Crypto era))
-&gt; Maybe (TxOut era) -&gt; Maybe (Addr (Crypto era))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (Crypto era)
-&gt; Map (TxIn (Crypto era)) (TxOut era) -&gt; Maybe (TxOut era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (Crypto era)
</span><a href="#local-6989586621679393691"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map (TxIn (Crypto era)) (TxOut era)
</span><a href="#local-6989586621679393698"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span id="local-6989586621679393687"><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393687"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Addr (Crypto era) -&gt; Maybe (ScriptHash (Crypto era))
forall crypto. Addr crypto -&gt; Maybe (ScriptHash crypto)
</span><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-var">getScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Addr (Crypto era)
</span><a href="#local-6989586621679393690"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">(ScriptPurpose (Crypto era), ScriptHash (Crypto era))
-&gt; Maybe (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn (Crypto era) -&gt; ScriptPurpose (Crypto era)
forall crypto. TxIn crypto -&gt; ScriptPurpose crypto
</span><a href="Cardano.Ledger.Alonzo.Tx.html#Spending"><span class="hs-identifier hs-var">Spending</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (Crypto era)
</span><a href="#local-6989586621679393691"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393687"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679393696"><span class="annot"><span class="annottext">spend :: [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393696"><span class="hs-identifier hs-var hs-var">spend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn (Crypto era)
 -&gt; Maybe (ScriptPurpose (Crypto era), ScriptHash (Crypto era)))
-&gt; [TxIn (Crypto era)]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (Crypto era)
-&gt; Maybe (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
</span><a href="#local-6989586621679393692"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (TxIn (Crypto era)) -&gt; [TxIn (Crypto era)]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (TxIn (Crypto era)) -&gt; [TxIn (Crypto era)])
-&gt; Set (TxIn (Crypto era)) -&gt; [TxIn (Crypto era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; Set (TxIn (Crypto era))
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679393697"><span class="hs-identifier hs-var">txb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679393695"><span class="annot"><span class="annottext">reward :: [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393695"><span class="hs-identifier hs-var hs-var">reward</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RewardAcnt (Crypto era)
 -&gt; Maybe (ScriptPurpose (Crypto era), ScriptHash (Crypto era)))
-&gt; [RewardAcnt (Crypto era)]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAcnt (Crypto era)
-&gt; Maybe (ScriptPurpose (Crypto era), ScriptHash (Crypto era))
forall crypto.
RewardAcnt crypto
-&gt; Maybe (ScriptPurpose crypto, ScriptHash crypto)
</span><a href="#local-6989586621679393685"><span class="hs-identifier hs-var">fromRwd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (RewardAcnt (Crypto era)) Coin -&gt; [RewardAcnt (Crypto era)]
forall k a. Map k a -&gt; [k]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map (RewardAcnt (Crypto era)) Coin
</span><a href="#local-6989586621679393683"><span class="hs-identifier hs-var">withdrawals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>        </span><span id="local-6989586621679393683"><span class="annot"><span class="annottext">withdrawals :: Map (RewardAcnt (Crypto era)) Coin
</span><a href="#local-6989586621679393683"><span class="hs-identifier hs-var hs-var">withdrawals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wdrl (Crypto era) -&gt; Map (RewardAcnt (Crypto era)) Coin
forall crypto. Wdrl crypto -&gt; Map (RewardAcnt crypto) Coin
</span><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-var hs-var">unWdrl</span></a></span><span> </span><span class="annot"><span class="annottext">(Wdrl (Crypto era) -&gt; Map (RewardAcnt (Crypto era)) Coin)
-&gt; Wdrl (Crypto era) -&gt; Map (RewardAcnt (Crypto era)) Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; Wdrl (Crypto era)
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;wdrls&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679393697"><span class="hs-identifier hs-var">txb</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span id="local-6989586621679393685"><span class="annot"><span class="annottext">fromRwd :: RewardAcnt crypto
-&gt; Maybe (ScriptPurpose crypto, ScriptHash crypto)
</span><a href="#local-6989586621679393685"><span class="hs-identifier hs-var hs-var">fromRwd</span></a></span></span><span> </span><span id="local-6989586621679393681"><span class="annot"><span class="annottext">RewardAcnt crypto
</span><a href="#local-6989586621679393681"><span class="hs-identifier hs-var">accnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>          </span><span id="local-6989586621679393680"><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393680"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking crypto -&gt; Maybe (ScriptHash crypto)
forall (kr :: KeyRole) crypto.
Credential kr crypto -&gt; Maybe (ScriptHash crypto)
</span><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier hs-var">scriptCred</span></a></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking crypto -&gt; Maybe (ScriptHash crypto))
-&gt; Credential 'Staking crypto -&gt; Maybe (ScriptHash crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAcnt crypto -&gt; Credential 'Staking crypto
forall crypto. RewardAcnt crypto -&gt; Credential 'Staking crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var">getRwdCred</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAcnt crypto
</span><a href="#local-6989586621679393681"><span class="hs-identifier hs-var">accnt</span></a></span><span>
</span><span id="line-342"></span><span>          </span><span class="annot"><span class="annottext">(ScriptPurpose crypto, ScriptHash crypto)
-&gt; Maybe (ScriptPurpose crypto, ScriptHash crypto)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAcnt crypto -&gt; ScriptPurpose crypto
forall crypto. RewardAcnt crypto -&gt; ScriptPurpose crypto
</span><a href="Cardano.Ledger.Alonzo.Tx.html#Rewarding"><span class="hs-identifier hs-var">Rewarding</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAcnt crypto
</span><a href="#local-6989586621679393681"><span class="hs-identifier hs-var">accnt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679393680"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679393694"><span class="annot"><span class="annottext">cert :: [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393694"><span class="hs-identifier hs-var hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
 -&gt; DCert (Crypto era)
 -&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))])
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; StrictSeq (DCert (Crypto era))
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
-&gt; DCert (Crypto era)
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall crypto.
[(ScriptPurpose crypto, ScriptHash crypto)]
-&gt; DCert crypto -&gt; [(ScriptPurpose crypto, ScriptHash crypto)]
</span><a href="Cardano.Ledger.Alonzo.PlutusScriptApi.html#addOnlyCwitness"><span class="hs-identifier hs-var">addOnlyCwitness</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; StrictSeq (DCert (Crypto era))
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;certs&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679393697"><span class="hs-identifier hs-var">txb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679393693"><span class="annot"><span class="annottext">minted :: [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
</span><a href="#local-6989586621679393693"><span class="hs-identifier hs-var hs-var">minted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScriptHash (Crypto era)
 -&gt; (ScriptPurpose (Crypto era), ScriptHash (Crypto era)))
-&gt; [ScriptHash (Crypto era)]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679393679"><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393679"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID (Crypto era) -&gt; ScriptPurpose (Crypto era)
forall crypto. PolicyID crypto -&gt; ScriptPurpose crypto
</span><a href="Cardano.Ledger.Alonzo.Tx.html#Minting"><span class="hs-identifier hs-var">Minting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash (Crypto era) -&gt; PolicyID (Crypto era)
forall crypto. ScriptHash crypto -&gt; PolicyID crypto
</span><a href="../../../../cardano-ledger-shelley-ma/html/src"><span class="hs-identifier hs-var">PolicyID</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393679"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash (Crypto era)
</span><a href="#local-6989586621679393679"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ScriptHash (Crypto era)]
 -&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))])
-&gt; [ScriptHash (Crypto era)]
-&gt; [(ScriptPurpose (Crypto era), ScriptHash (Crypto era))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set (ScriptHash (Crypto era)) -&gt; [ScriptHash (Crypto era)]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (ScriptHash (Crypto era)) -&gt; [ScriptHash (Crypto era)])
-&gt; Set (ScriptHash (Crypto era)) -&gt; [ScriptHash (Crypto era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; Set (ScriptHash (Crypto era))
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;minted&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679393697"><span class="hs-identifier hs-var">txb</span></a></span><span>
</span><span id="line-347"></span></pre></body></html>