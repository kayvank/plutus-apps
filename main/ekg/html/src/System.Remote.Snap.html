<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Remote.Snap</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="System.Remote.Snap.html#startServer"><span class="hs-identifier">startServer</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;$&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S8</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">on</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../unordered-containers/html/src"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">Network.Socket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">NameInfoFlag</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">NI_NUMERICHOST</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">addrAddress</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">getAddrInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>                       </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">getNameInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Paths_ekg.html"><span class="hs-identifier">Paths_ekg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Paths_ekg.html#getDataDir"><span class="hs-identifier">getDataDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">read</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Snap.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">MonadSnap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Snap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">finishWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">getHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">getRequest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>                  </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">getResponse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Method</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">GET</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">modifyResponse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">pass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>                  </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">rqPathInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">setContentType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">setResponseStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                  </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">writeLBS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">Snap.Http.Server</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">httpServe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../snap-server/html/src"><span class="hs-identifier">Snap.Http.Server.Config</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Config</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">Snap.Util.FileServe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier">serveDirectory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../filepath/html/src"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../filepath/html/src"><span class="hs-operator">(&lt;/&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier">System.Metrics</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Remote.Json.html"><span class="hs-identifier">System.Remote.Json</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- | Convert a host name (e.g. \&quot;localhost\&quot; or \&quot;127.0.0.1\&quot;) to a</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- numeric host address (e.g. \&quot;127.0.0.1\&quot;).</span><span>
</span><span id="line-37"></span><span class="annot"><a href="System.Remote.Snap.html#getNumericHostAddress"><span class="hs-identifier hs-type">getNumericHostAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-38"></span><span id="getNumericHostAddress"><span class="annot"><span class="annottext">getNumericHostAddress :: ByteString -&gt; IO ByteString
</span><a href="System.Remote.Snap.html#getNumericHostAddress"><span class="hs-identifier hs-var hs-var">getNumericHostAddress</span></a></span></span><span> </span><span id="local-6989586621679083145"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083145"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-39"></span><span>    </span><span id="local-6989586621679083144"><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679083144"><span class="hs-identifier hs-var">ais</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe AddrInfo -&gt; Maybe HostName -&gt; Maybe HostName -&gt; IO [AddrInfo]
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">getAddrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AddrInfo
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostName -&gt; Maybe HostName
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; HostName
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S8.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083145"><span class="hs-identifier hs-var">host</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe HostName
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679083144"><span class="hs-identifier hs-var">ais</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-41"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ByteString
forall a. IO a
</span><a href="#local-6989586621679083142"><span class="hs-identifier hs-var">unsupportedAddressError</span></a></span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679083141"><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679083141"><span class="hs-identifier hs-var">ai</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[AddrInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-43"></span><span>            </span><span id="local-6989586621679083140"><span class="annot"><span class="annottext">(Maybe HostName, Maybe HostName)
</span><a href="#local-6989586621679083140"><span class="hs-identifier hs-var">ni</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[NameInfoFlag]
-&gt; Bool -&gt; Bool -&gt; SockAddr -&gt; IO (Maybe HostName, Maybe HostName)
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">getNameInfo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">NameInfoFlag
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">NI_NUMERICHOST</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; SockAddr
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var hs-var">addrAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679083141"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Maybe HostName, Maybe HostName)
</span><a href="#local-6989586621679083140"><span class="hs-identifier hs-var">ni</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-45"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679083139"><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679083139"><span class="hs-identifier hs-var">numericHost</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe HostName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">HostName -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S8.pack</span></a></span><span> </span><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679083139"><span class="hs-identifier hs-var">numericHost</span></a></span><span>
</span><span id="line-46"></span><span>                </span><span class="annot"><span class="annottext">(Maybe HostName, Maybe HostName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ByteString
forall a. IO a
</span><a href="#local-6989586621679083142"><span class="hs-identifier hs-var">unsupportedAddressError</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621679083142"><span class="annot"><span class="annottext">unsupportedAddressError :: IO a
</span><a href="#local-6989586621679083142"><span class="hs-identifier hs-var hs-var">unsupportedAddressError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IOError -&gt; IO a) -&gt; IOError -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">HostName -&gt; IOError
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">userError</span></a></span><span> </span><span class="annot"><span class="annottext">(HostName -&gt; IOError) -&gt; HostName -&gt; IOError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HostName
</span><span class="hs-string">&quot;unsupported address: &quot;</span></span><span> </span><span class="annot"><span class="annottext">HostName -&gt; HostName -&gt; HostName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HostName
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S8.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083145"><span class="hs-identifier hs-var">host</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><a href="System.Remote.Snap.html#startServer"><span class="hs-identifier hs-type">startServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span>
</span><span id="line-52"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>  </span><span class="hs-comment">-- ^ Host to listen on (e.g. \&quot;localhost\&quot;)</span><span>
</span><span id="line-53"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>           </span><span class="hs-comment">-- ^ Port to listen on (e.g. 8000)</span><span>
</span><span id="line-54"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span id="startServer"><span class="annot"><span class="annottext">startServer :: Store -&gt; ByteString -&gt; Int -&gt; IO ()
</span><a href="System.Remote.Snap.html#startServer"><span class="hs-identifier hs-var hs-var">startServer</span></a></span></span><span> </span><span id="local-6989586621679083135"><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083135"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679083134"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083134"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span id="local-6989586621679083133"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083133"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- Snap doesn't allow for non-numeric host names in</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-comment">-- 'Snap.setBind'. We work around that limitation by converting a</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- possible non-numeric host name to a numeric address.</span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621679083132"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083132"><span class="hs-identifier hs-var">numericHost</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
</span><a href="System.Remote.Snap.html#getNumericHostAddress"><span class="hs-identifier hs-var">getNumericHostAddress</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083134"><span class="hs-identifier hs-var">host</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083131"><span class="annot"><span class="annottext">conf :: Config Snap a
</span><a href="#local-6989586621679083131"><span class="hs-identifier hs-var hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. Bool -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.setVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-61"></span><span>               </span><span class="annot"><span class="annottext">ConfigLog -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ConfigLog -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.setErrorLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigLog
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.ConfigNoLog</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-62"></span><span>               </span><span class="annot"><span class="annottext">ConfigLog -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ConfigLog -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.setAccessLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConfigLog
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.ConfigNoLog</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-63"></span><span>               </span><span class="annot"><span class="annottext">Int -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. Int -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.setPort</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083133"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-64"></span><span>               </span><span class="annot"><span class="annottext">ByteString -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ByteString -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.setHostname</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083134"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-65"></span><span>               </span><span class="annot"><span class="annottext">ByteString -&gt; Config Snap a -&gt; Config Snap a
forall (m :: * -&gt; *) a. ByteString -&gt; Config m a -&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.setBind</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083132"><span class="hs-identifier hs-var">numericHost</span></a></span><span> </span><span class="annot"><span class="annottext">(Config Snap a -&gt; Config Snap a) -&gt; Config Snap a -&gt; Config Snap a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-66"></span><span>               </span><span class="annot"><span class="annottext">Config Snap a
forall (m :: * -&gt; *) a. MonadSnap m =&gt; Config m a
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">Config.defaultConfig</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="annottext">Config Snap Any -&gt; Snap () -&gt; IO ()
forall a. Config Snap a -&gt; Snap () -&gt; IO ()
</span><a href="../../../../snap-server/html/src"><span class="hs-identifier hs-var">httpServe</span></a></span><span> </span><span class="annot"><span class="annottext">Config Snap Any
forall a. Config Snap a
</span><a href="#local-6989586621679083131"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Store -&gt; Snap ()
</span><a href="System.Remote.Snap.html#monitor"><span class="hs-identifier hs-var">monitor</span></a></span><span> </span><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083135"><span class="hs-identifier hs-var">store</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | A handler that can be installed into an existing Snap application.</span><span>
</span><span id="line-70"></span><span class="annot"><a href="System.Remote.Snap.html#monitor"><span class="hs-identifier hs-type">monitor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">Snap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span id="monitor"><span class="annot"><span class="annottext">monitor :: Store -&gt; Snap ()
</span><a href="System.Remote.Snap.html#monitor"><span class="hs-identifier hs-var hs-var">monitor</span></a></span></span><span> </span><span id="local-6989586621679083121"><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083121"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679083120"><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679083120"><span class="hs-identifier hs-var">dataDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HostName -&gt; Snap HostName
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO HostName
</span><a href="Paths_ekg.html#getDataDir"><span class="hs-identifier hs-var">getDataDir</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Snap () -&gt; Snap ()
forall a. Snap a -&gt; Snap a
</span><a href="#local-6989586621679083119"><span class="hs-identifier hs-var">jsonHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Snap () -&gt; Snap ()) -&gt; Snap () -&gt; Snap ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Store -&gt; Snap ()
forall (m :: * -&gt; *). MonadSnap m =&gt; Store -&gt; m ()
</span><a href="System.Remote.Snap.html#serve"><span class="hs-identifier hs-var">serve</span></a></span><span> </span><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083121"><span class="hs-identifier hs-var">store</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">Snap () -&gt; Snap () -&gt; Snap ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HostName -&gt; Snap ()
forall (m :: * -&gt; *). MonadSnap m =&gt; HostName -&gt; m ()
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">serveDirectory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679083120"><span class="hs-identifier hs-var">dataDir</span></a></span><span> </span><span class="annot"><span class="annottext">HostName -&gt; HostName -&gt; HostName
</span><a href="../../../../filepath/html/src"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HostName
</span><span class="hs-string">&quot;assets&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679083119"><span class="annot"><span class="annottext">jsonHandler :: Snap a -&gt; Snap a
</span><a href="#local-6989586621679083119"><span class="hs-identifier hs-var hs-var">jsonHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Snap a -&gt; Snap a
forall (m :: * -&gt; *) a. MonadSnap m =&gt; ByteString -&gt; m a -&gt; m a
</span><a href="#local-6989586621679083117"><span class="hs-identifier hs-var">wrapHandler</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;application/json&quot;</span></span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621679083117"><span class="annot"><span class="annottext">wrapHandler :: ByteString -&gt; m a -&gt; m a
</span><a href="#local-6989586621679083117"><span class="hs-identifier hs-var hs-var">wrapHandler</span></a></span></span><span> </span><span id="local-6989586621679083116"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083116"><span class="hs-identifier hs-var">fmt</span></a></span></span><span> </span><span id="local-6989586621679083115"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679083115"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a. MonadSnap m =&gt; Method -&gt; m a -&gt; m a
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">GET</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a. MonadSnap m =&gt; ByteString -&gt; m a -&gt; m a
</span><a href="System.Remote.Snap.html#format"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083116"><span class="hs-identifier hs-var">fmt</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679083115"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | The Accept header of the request.</span><span>
</span><span id="line-80"></span><span class="annot"><a href="System.Remote.Snap.html#acceptHeader"><span class="hs-identifier hs-type">acceptHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-81"></span><span id="acceptHeader"><span class="annot"><span class="annottext">acceptHeader :: Request -&gt; Maybe ByteString
</span><a href="System.Remote.Snap.html#acceptHeader"><span class="hs-identifier hs-var hs-var">acceptHeader</span></a></span></span><span> </span><span id="local-6989586621679083112"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083112"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; Request -&gt; Maybe ByteString
forall a. HasHeaders a =&gt; CI ByteString -&gt; a -&gt; Maybe ByteString
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">getHeader</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Accept&quot;</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083112"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Runs a Snap monad action only if the request's Accept header</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- matches the given MIME type.</span><span>
</span><span id="line-85"></span><span id="local-6989586621679083110"><span id="local-6989586621679083111"><span class="annot"><a href="System.Remote.Snap.html#format"><span class="hs-identifier hs-type">format</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083110"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083110"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-86"></span><span id="format"><span class="annot"><span class="annottext">format :: ByteString -&gt; m a -&gt; m a
</span><a href="System.Remote.Snap.html#format"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679083109"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083109"><span class="hs-identifier hs-var">fmt</span></a></span></span><span> </span><span id="local-6989586621679083108"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679083108"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679083107"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083107"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Request
forall (m :: * -&gt; *). MonadSnap m =&gt; m Request
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">getRequest</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083106"><span class="annot"><span class="annottext">acceptHdr :: Maybe ByteString
</span><a href="#local-6989586621679083106"><span class="hs-identifier hs-var hs-var">acceptHdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.head</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="System.Remote.Snap.html#parseHttpAccept"><span class="hs-identifier hs-var">parseHttpAccept</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; Maybe ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe ByteString
</span><a href="System.Remote.Snap.html#acceptHeader"><span class="hs-identifier hs-var">acceptHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083107"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679083106"><span class="hs-identifier hs-var">acceptHdr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679083102"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083102"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083102"><span class="hs-identifier hs-var">hdr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083109"><span class="hs-identifier hs-var">fmt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679083108"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m a
forall (m :: * -&gt; *) a. MonadSnap m =&gt; m a
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">pass</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Serve all counter, gauges and labels, built-in or not, as a</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- nested JSON object.</span><span>
</span><span id="line-95"></span><span id="local-6989586621679083235"><span class="annot"><a href="System.Remote.Snap.html#serve"><span class="hs-identifier hs-type">serve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083235"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083235"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-96"></span><span id="serve"><span class="annot"><span class="annottext">serve :: Store -&gt; m ()
</span><a href="System.Remote.Snap.html#serve"><span class="hs-identifier hs-var hs-var">serve</span></a></span></span><span> </span><span id="local-6989586621679083101"><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083101"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679083100"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083100"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Request
forall (m :: * -&gt; *). MonadSnap m =&gt; m Request
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">getRequest</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">(Response -&gt; Response) -&gt; m ()
forall (m :: * -&gt; *). MonadSnap m =&gt; (Response -&gt; Response) -&gt; m ()
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">modifyResponse</span></a></span><span> </span><span class="annot"><span class="annottext">((Response -&gt; Response) -&gt; m ()) -&gt; (Response -&gt; Response) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Response -&gt; Response
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">setContentType</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;application/json&quot;</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var hs-var">rqPathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083100"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679083098"><span class="hs-identifier hs-var">serveAll</span></a></span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ()
forall (m :: * -&gt; *). MonadSnap m =&gt; ByteString -&gt; m ()
</span><a href="#local-6989586621679083097"><span class="hs-identifier hs-var">serveOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var hs-var">rqPathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679083100"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679083098"><span class="annot"><span class="annottext">serveAll :: m ()
</span><a href="#local-6989586621679083098"><span class="hs-identifier hs-var hs-var">serveAll</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>        </span><span id="local-6989586621679083096"><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679083096"><span class="hs-identifier hs-var">metrics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Sample -&gt; m Sample
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Sample -&gt; m Sample) -&gt; IO Sample -&gt; m Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Store -&gt; IO Sample
</span><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-var">sampleAll</span></a></span><span> </span><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083101"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; m ()
forall (m :: * -&gt; *). MonadSnap m =&gt; ByteString -&gt; m ()
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">writeLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; m ()) -&gt; ByteString -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Sample -&gt; ByteString
</span><a href="System.Remote.Json.html#encodeAll"><span class="hs-identifier hs-var">encodeAll</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679083096"><span class="hs-identifier hs-var">metrics</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621679083097"><span class="annot"><span class="annottext">serveOne :: ByteString -&gt; m ()
</span><a href="#local-6989586621679083097"><span class="hs-identifier hs-var hs-var">serveOne</span></a></span></span><span> </span><span id="local-6989586621679083093"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083093"><span class="hs-identifier hs-var">pathInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083092"><span class="annot"><span class="annottext">segments :: [ByteString]
</span><a href="#local-6989586621679083092"><span class="hs-identifier hs-var hs-var">segments</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; ByteString -&gt; [ByteString]
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S8.split</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083093"><span class="hs-identifier hs-var">pathInfo</span></a></span><span>
</span><span id="line-108"></span><span>            </span><span id="local-6989586621679083090"><span class="annot"><span class="annottext">nameBytes :: ByteString
</span><a href="#local-6989586621679083090"><span class="hs-identifier hs-var hs-var">nameBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S8.intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679083092"><span class="hs-identifier hs-var">segments</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either UnicodeException Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083090"><span class="hs-identifier hs-var">nameBytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-110"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">UnicodeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>                </span><span class="annot"><span class="annottext">(Response -&gt; Response) -&gt; m ()
forall (m :: * -&gt; *). MonadSnap m =&gt; (Response -&gt; Response) -&gt; m ()
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">modifyResponse</span></a></span><span> </span><span class="annot"><span class="annottext">((Response -&gt; Response) -&gt; m ()) -&gt; (Response -&gt; Response) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; Response -&gt; Response
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">setResponseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Bad Request&quot;</span></span><span>
</span><span id="line-112"></span><span>                </span><span id="local-6989586621679083087"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679083087"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Response
forall (m :: * -&gt; *). MonadSnap m =&gt; m Response
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">getResponse</span></a></span><span>
</span><span id="line-113"></span><span>                </span><span class="annot"><span class="annottext">Response -&gt; m ()
forall (m :: * -&gt; *) a. MonadSnap m =&gt; Response -&gt; m a
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">finishWith</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679083087"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679083086"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679083086"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>                </span><span id="local-6989586621679083085"><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679083085"><span class="hs-identifier hs-var">metrics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Sample -&gt; m Sample
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Sample -&gt; m Sample) -&gt; IO Sample -&gt; m Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Store -&gt; IO Sample
</span><a href="../../../../ekg-core/html/src"><span class="hs-identifier hs-var">sampleAll</span></a></span><span> </span><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679083101"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Sample -&gt; Maybe Value
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="../../../../unordered-containers/html/src"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679083086"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621679083085"><span class="hs-identifier hs-var">metrics</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *) a. MonadSnap m =&gt; m a
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">pass</span></a></span><span>
</span><span id="line-118"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679083083"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679083083"><span class="hs-identifier hs-var">metric</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ()
forall (m :: * -&gt; *). MonadSnap m =&gt; ByteString -&gt; m ()
</span><a href="../../../../snap-core/html/src"><span class="hs-identifier hs-var">writeLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; m ()) -&gt; ByteString -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
</span><a href="System.Remote.Json.html#encodeOne"><span class="hs-identifier hs-var">encodeOne</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679083083"><span class="hs-identifier hs-var">metric</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Utilities for working with accept headers</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | Parse the HTTP accept string to determine supported content types.</span><span>
</span><span id="line-124"></span><span class="annot"><a href="System.Remote.Snap.html#parseHttpAccept"><span class="hs-identifier hs-type">parseHttpAccept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span id="parseHttpAccept"><span class="annot"><span class="annottext">parseHttpAccept :: ByteString -&gt; [ByteString]
</span><a href="System.Remote.Snap.html#parseHttpAccept"><span class="hs-identifier hs-var hs-var">parseHttpAccept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ByteString, Double) -&gt; ByteString)
-&gt; [(ByteString, Double)] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.map</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Double) -&gt; ByteString
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span>
</span><span id="line-126"></span><span>                </span><span class="annot"><span class="annottext">([(ByteString, Double)] -&gt; [ByteString])
-&gt; (ByteString -&gt; [(ByteString, Double)])
-&gt; ByteString
-&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString, Double) -&gt; (ByteString, Double) -&gt; Ordering)
-&gt; [(ByteString, Double)] -&gt; [(ByteString, Double)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Ordering
</span><a href="#local-6989586621679083080"><span class="hs-identifier hs-var">rcompare</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Ordering)
-&gt; ((ByteString, Double) -&gt; Double)
-&gt; (ByteString, Double)
-&gt; (ByteString, Double)
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Double) -&gt; Double
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>                </span><span class="annot"><span class="annottext">([(ByteString, Double)] -&gt; [(ByteString, Double)])
-&gt; (ByteString -&gt; [(ByteString, Double)])
-&gt; ByteString
-&gt; [(ByteString, Double)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; (ByteString, Double))
-&gt; [ByteString] -&gt; [(ByteString, Double)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.map</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (ByteString, Double)
forall b. (Read b, Fractional b) =&gt; ByteString -&gt; (ByteString, b)
</span><a href="#local-6989586621679083079"><span class="hs-identifier hs-var">grabQ</span></a></span><span>
</span><span id="line-128"></span><span>                </span><span class="annot"><span class="annottext">([ByteString] -&gt; [(ByteString, Double)])
-&gt; (ByteString -&gt; [ByteString])
-&gt; ByteString
-&gt; [(ByteString, Double)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; [ByteString]
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.split</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">44</span></span><span> </span><span class="hs-comment">-- comma</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><a href="#local-6989586621679083080"><span class="hs-identifier hs-type">rcompare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ordering</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679083080"><span class="annot"><span class="annottext">rcompare :: Double -&gt; Double -&gt; Ordering
</span><a href="#local-6989586621679083080"><span class="hs-identifier hs-var hs-var">rcompare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Ordering) -&gt; Double -&gt; Double -&gt; Ordering
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">compare</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679083079"><span class="annot"><span class="annottext">grabQ :: ByteString -&gt; (ByteString, b)
</span><a href="#local-6989586621679083079"><span class="hs-identifier hs-var hs-var">grabQ</span></a></span></span><span> </span><span id="local-6989586621679083075"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083075"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083074"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083074"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083073"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083073"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; (ByteString, ByteString)
</span><a href="System.Remote.Snap.html#breakDiscard"><span class="hs-identifier hs-var">breakDiscard</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">59</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083075"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-comment">-- semicolon</span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083071"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083071"><span class="hs-identifier hs-var">q'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; (ByteString, ByteString)
</span><a href="System.Remote.Snap.html#breakDiscard"><span class="hs-identifier hs-var">breakDiscard</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">61</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083073"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-comment">-- equals sign</span><span>
</span><span id="line-135"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679083070"><span class="hs-identifier hs-var">trimWhite</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083074"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; b
forall p. (Read p, Fractional p) =&gt; ByteString -&gt; p
</span><a href="#local-6989586621679083069"><span class="hs-identifier hs-var">readQ</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; b) -&gt; ByteString -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679083070"><span class="hs-identifier hs-var">trimWhite</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083071"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679083069"><span class="annot"><span class="annottext">readQ :: ByteString -&gt; p
</span><a href="#local-6989586621679083069"><span class="hs-identifier hs-var hs-var">readQ</span></a></span></span><span> </span><span id="local-6989586621679083068"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083068"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReadS p
forall a. Read a =&gt; ReadS a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">reads</span></a></span><span> </span><span class="annot"><span class="annottext">ReadS p -&gt; ReadS p
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HostName
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S8.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083068"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679083066"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679083066"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HostName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(p, HostName)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679083066"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-138"></span><span>                </span><span class="annot"><span class="annottext">[(p, HostName)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-number">1.0</span></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679083070"><span class="annot"><span class="annottext">trimWhite :: ByteString -&gt; ByteString
</span><a href="#local-6989586621679083070"><span class="hs-identifier hs-var hs-var">trimWhite</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.dropWhile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- space</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="System.Remote.Snap.html#breakDiscard"><span class="hs-identifier hs-type">breakDiscard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span id="breakDiscard"><span class="annot"><span class="annottext">breakDiscard :: Word8 -&gt; ByteString -&gt; (ByteString, ByteString)
</span><a href="System.Remote.Snap.html#breakDiscard"><span class="hs-identifier hs-var hs-var">breakDiscard</span></a></span></span><span> </span><span id="local-6989586621679083064"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083064"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679083063"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083063"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083062"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083062"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083061"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083061"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; ByteString -&gt; (ByteString, ByteString)
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.break</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679083064"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083063"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083062"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679083061"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span></pre></body></html>