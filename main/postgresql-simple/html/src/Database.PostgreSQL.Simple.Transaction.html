<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24maxtag_KXB4BlM24iJKlOrMiYz5Od"><span id="%24tag2con_KXB4BlM24iJKlOrMiYz5Od"><span id="%24con2tag_KXB4BlM24iJKlOrMiYz5Od"><span id="%24maxtag_DGqnthiXJSSJjNeP5G6Mih"><span id="%24tag2con_DGqnthiXJSSJjNeP5G6Mih"><span id="%24con2tag_DGqnthiXJSSJjNeP5G6Mih"></span></span></span></span></span></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards, ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module:      Database.PostgreSQL.Simple.Transaction</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright:   (c) 2011-2013 Leon P Smith</span><span>
</span><span id="line-7"></span><span class="hs-comment">--              (c) 2013 Joey Adams</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- License:     BSD3</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Maintainer:  Leon P Smith &lt;leon@melding-monads.com&gt;</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.PostgreSQL.Simple.Transaction</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Transaction handling</span></span><span>
</span><span id="line-16"></span><span>      </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransaction"><span class="hs-identifier">withTransaction</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionLevel"><span class="hs-identifier">withTransactionLevel</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionMode"><span class="hs-identifier">withTransactionMode</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry"><span class="hs-identifier">withTransactionModeRetry</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry%27"><span class="hs-identifier">withTransactionModeRetry'</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionSerializable"><span class="hs-identifier">withTransactionSerializable</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier">TransactionMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#IsolationLevel"><span class="hs-identifier">IsolationLevel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWriteMode"><span class="hs-identifier">ReadWriteMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier">defaultTransactionMode</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#defaultIsolationLevel"><span class="hs-identifier">defaultIsolationLevel</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#defaultReadWriteMode"><span class="hs-identifier">defaultReadWriteMode</span></a></span><span>
</span><span id="line-28"></span><span class="hs-comment">--    , Base.autocommit</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#begin"><span class="hs-identifier">begin</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#beginLevel"><span class="hs-identifier">beginLevel</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier">beginMode</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#commit"><span class="hs-identifier">commit</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollback"><span class="hs-identifier">rollback</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Savepoint</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withSavepoint"><span class="hs-identifier">withSavepoint</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier">Savepoint</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#newSavepoint"><span class="hs-identifier">newSavepoint</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#releaseSavepoint"><span class="hs-identifier">releaseSavepoint</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToSavepoint"><span class="hs-identifier">rollbackToSavepoint</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToAndReleaseSavepoint"><span class="hs-identifier">rollbackToAndReleaseSavepoint</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Error predicates</span></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Errors.html#isSerializationError"><span class="hs-identifier">isSerializationError</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Errors.html#isNoActiveTransactionError"><span class="hs-identifier">isNoActiveTransactionError</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Errors.html#isFailedTransactionError"><span class="hs-identifier">isFailedTransactionError</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html"><span class="hs-identifier">Database.PostgreSQL.Simple.Internal</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html"><span class="hs-identifier">Database.PostgreSQL.Simple.Types</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Errors.html"><span class="hs-identifier">Database.PostgreSQL.Simple.Errors</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Compat.html"><span class="hs-identifier">Database.PostgreSQL.Simple.Compat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.PostgreSQL.Simple.Compat.html#mask"><span class="hs-identifier">mask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Of the four isolation levels defined by the SQL standard,</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- these are the three levels distinguished by PostgreSQL as of version 9.0.</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- See &lt;https://www.postgresql.org/docs/9.5/static/transaction-iso.html&gt;</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- for more information.   Note that prior to PostgreSQL 9.0, 'RepeatableRead'</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- was equivalent to 'Serializable'.</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">data</span><span> </span><span id="IsolationLevel"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#IsolationLevel"><span class="hs-identifier hs-var">IsolationLevel</span></a></span></span><span>
</span><span id="line-64"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="DefaultIsolationLevel"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#DefaultIsolationLevel"><span class="hs-identifier hs-var">DefaultIsolationLevel</span></a></span></span><span>  </span><span class="hs-comment">-- ^ the isolation level will be taken from</span><span>
</span><span id="line-65"></span><span>                            </span><span class="hs-comment">--   PostgreSQL's per-connection</span><span>
</span><span id="line-66"></span><span>                            </span><span class="hs-comment">--   @default_transaction_isolation@ variable,</span><span>
</span><span id="line-67"></span><span>                            </span><span class="hs-comment">--   which is initialized according to the</span><span>
</span><span id="line-68"></span><span>                            </span><span class="hs-comment">--   server's config.  The default configuration</span><span>
</span><span id="line-69"></span><span>                            </span><span class="hs-comment">--   is 'ReadCommitted'.</span><span>
</span><span id="line-70"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="ReadCommitted"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadCommitted"><span class="hs-identifier hs-var">ReadCommitted</span></a></span></span><span>
</span><span id="line-71"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="RepeatableRead"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#RepeatableRead"><span class="hs-identifier hs-var">RepeatableRead</span></a></span></span><span>
</span><span id="line-72"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="Serializable"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#Serializable"><span class="hs-identifier hs-var">Serializable</span></a></span></span><span>
</span><span id="line-73"></span><span>     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131267"><span id="local-6989586621679131269"><span id="local-6989586621679131271"><span class="annot"><span class="annottext">Int -&gt; IsolationLevel -&gt; ShowS
[IsolationLevel] -&gt; ShowS
IsolationLevel -&gt; String
(Int -&gt; IsolationLevel -&gt; ShowS)
-&gt; (IsolationLevel -&gt; String)
-&gt; ([IsolationLevel] -&gt; ShowS)
-&gt; Show IsolationLevel
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [IsolationLevel] -&gt; ShowS
$cshowList :: [IsolationLevel] -&gt; ShowS
show :: IsolationLevel -&gt; String
$cshow :: IsolationLevel -&gt; String
showsPrec :: Int -&gt; IsolationLevel -&gt; ShowS
$cshowsPrec :: Int -&gt; IsolationLevel -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131262"><span id="local-6989586621679131264"><span class="annot"><span class="annottext">IsolationLevel -&gt; IsolationLevel -&gt; Bool
(IsolationLevel -&gt; IsolationLevel -&gt; Bool)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; Bool) -&gt; Eq IsolationLevel
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
$c/= :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
== :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
$c== :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131246"><span id="local-6989586621679131248"><span id="local-6989586621679131250"><span id="local-6989586621679131252"><span id="local-6989586621679131254"><span id="local-6989586621679131256"><span id="local-6989586621679131258"><span class="annot"><span class="annottext">Eq IsolationLevel
Eq IsolationLevel
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; Ordering)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; Bool)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; Bool)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; Bool)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; Bool)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel)
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel)
-&gt; Ord IsolationLevel
IsolationLevel -&gt; IsolationLevel -&gt; Bool
IsolationLevel -&gt; IsolationLevel -&gt; Ordering
IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel
$cmin :: IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel
max :: IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel
$cmax :: IsolationLevel -&gt; IsolationLevel -&gt; IsolationLevel
&gt;= :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
$c&gt;= :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
&gt; :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
$c&gt; :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
&lt;= :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
$c&lt;= :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
&lt; :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
$c&lt; :: IsolationLevel -&gt; IsolationLevel -&gt; Bool
compare :: IsolationLevel -&gt; IsolationLevel -&gt; Ordering
$ccompare :: IsolationLevel -&gt; IsolationLevel -&gt; Ordering
$cp1Ord :: Eq IsolationLevel
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131229"><span id="local-6989586621679131231"><span id="local-6989586621679131233"><span id="local-6989586621679131235"><span id="local-6989586621679131237"><span id="local-6989586621679131239"><span id="local-6989586621679131241"><span id="local-6989586621679131243"><span class="annot"><span class="annottext">Int -&gt; IsolationLevel
IsolationLevel -&gt; Int
IsolationLevel -&gt; [IsolationLevel]
IsolationLevel -&gt; IsolationLevel
IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
IsolationLevel
-&gt; IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
(IsolationLevel -&gt; IsolationLevel)
-&gt; (IsolationLevel -&gt; IsolationLevel)
-&gt; (Int -&gt; IsolationLevel)
-&gt; (IsolationLevel -&gt; Int)
-&gt; (IsolationLevel -&gt; [IsolationLevel])
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel])
-&gt; (IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel])
-&gt; (IsolationLevel
    -&gt; IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel])
-&gt; Enum IsolationLevel
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
enumFromThenTo :: IsolationLevel
-&gt; IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
$cenumFromThenTo :: IsolationLevel
-&gt; IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
enumFromTo :: IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
$cenumFromTo :: IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
enumFromThen :: IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
$cenumFromThen :: IsolationLevel -&gt; IsolationLevel -&gt; [IsolationLevel]
enumFrom :: IsolationLevel -&gt; [IsolationLevel]
$cenumFrom :: IsolationLevel -&gt; [IsolationLevel]
fromEnum :: IsolationLevel -&gt; Int
$cfromEnum :: IsolationLevel -&gt; Int
toEnum :: Int -&gt; IsolationLevel
$ctoEnum :: Int -&gt; IsolationLevel
pred :: IsolationLevel -&gt; IsolationLevel
$cpred :: IsolationLevel -&gt; IsolationLevel
succ :: IsolationLevel -&gt; IsolationLevel
$csucc :: IsolationLevel -&gt; IsolationLevel
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131224"><span id="local-6989586621679131226"><span class="annot"><span class="annottext">IsolationLevel
IsolationLevel -&gt; IsolationLevel -&gt; Bounded IsolationLevel
forall a. a -&gt; a -&gt; Bounded a
maxBound :: IsolationLevel
$cmaxBound :: IsolationLevel
minBound :: IsolationLevel
$cminBound :: IsolationLevel
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Bounded</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">data</span><span> </span><span id="ReadWriteMode"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWriteMode"><span class="hs-identifier hs-var">ReadWriteMode</span></a></span></span><span>
</span><span id="line-76"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="DefaultReadWriteMode"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#DefaultReadWriteMode"><span class="hs-identifier hs-var">DefaultReadWriteMode</span></a></span></span><span>   </span><span class="hs-comment">-- ^ the read-write mode will be taken from</span><span>
</span><span id="line-77"></span><span>                            </span><span class="hs-comment">--   PostgreSQL's per-connection</span><span>
</span><span id="line-78"></span><span>                            </span><span class="hs-comment">--   @default_transaction_read_only@ variable,</span><span>
</span><span id="line-79"></span><span>                            </span><span class="hs-comment">--   which is initialized according to the</span><span>
</span><span id="line-80"></span><span>                            </span><span class="hs-comment">--   server's config.  The default configuration</span><span>
</span><span id="line-81"></span><span>                            </span><span class="hs-comment">--   is 'ReadWrite'.</span><span>
</span><span id="line-82"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="ReadWrite"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWrite"><span class="hs-identifier hs-var">ReadWrite</span></a></span></span><span>
</span><span id="line-83"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="ReadOnly"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadOnly"><span class="hs-identifier hs-var">ReadOnly</span></a></span></span><span>
</span><span id="line-84"></span><span>     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131214"><span id="local-6989586621679131216"><span id="local-6989586621679131218"><span class="annot"><span class="annottext">Int -&gt; ReadWriteMode -&gt; ShowS
[ReadWriteMode] -&gt; ShowS
ReadWriteMode -&gt; String
(Int -&gt; ReadWriteMode -&gt; ShowS)
-&gt; (ReadWriteMode -&gt; String)
-&gt; ([ReadWriteMode] -&gt; ShowS)
-&gt; Show ReadWriteMode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ReadWriteMode] -&gt; ShowS
$cshowList :: [ReadWriteMode] -&gt; ShowS
show :: ReadWriteMode -&gt; String
$cshow :: ReadWriteMode -&gt; String
showsPrec :: Int -&gt; ReadWriteMode -&gt; ShowS
$cshowsPrec :: Int -&gt; ReadWriteMode -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131210"><span id="local-6989586621679131212"><span class="annot"><span class="annottext">ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
(ReadWriteMode -&gt; ReadWriteMode -&gt; Bool)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; Bool) -&gt; Eq ReadWriteMode
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
$c/= :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
== :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
$c== :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131195"><span id="local-6989586621679131197"><span id="local-6989586621679131199"><span id="local-6989586621679131201"><span id="local-6989586621679131203"><span id="local-6989586621679131205"><span id="local-6989586621679131207"><span class="annot"><span class="annottext">Eq ReadWriteMode
Eq ReadWriteMode
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; Ordering)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; Bool)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; Bool)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; Bool)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; Bool)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode)
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode)
-&gt; Ord ReadWriteMode
ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
ReadWriteMode -&gt; ReadWriteMode -&gt; Ordering
ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode
$cmin :: ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode
max :: ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode
$cmax :: ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode
&gt;= :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
$c&gt;= :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
&gt; :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
$c&gt; :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
&lt;= :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
$c&lt;= :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
&lt; :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
$c&lt; :: ReadWriteMode -&gt; ReadWriteMode -&gt; Bool
compare :: ReadWriteMode -&gt; ReadWriteMode -&gt; Ordering
$ccompare :: ReadWriteMode -&gt; ReadWriteMode -&gt; Ordering
$cp1Ord :: Eq ReadWriteMode
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131179"><span id="local-6989586621679131181"><span id="local-6989586621679131183"><span id="local-6989586621679131185"><span id="local-6989586621679131187"><span id="local-6989586621679131189"><span id="local-6989586621679131191"><span id="local-6989586621679131193"><span class="annot"><span class="annottext">Int -&gt; ReadWriteMode
ReadWriteMode -&gt; Int
ReadWriteMode -&gt; [ReadWriteMode]
ReadWriteMode -&gt; ReadWriteMode
ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
(ReadWriteMode -&gt; ReadWriteMode)
-&gt; (ReadWriteMode -&gt; ReadWriteMode)
-&gt; (Int -&gt; ReadWriteMode)
-&gt; (ReadWriteMode -&gt; Int)
-&gt; (ReadWriteMode -&gt; [ReadWriteMode])
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode])
-&gt; (ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode])
-&gt; (ReadWriteMode
    -&gt; ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode])
-&gt; Enum ReadWriteMode
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
enumFromThenTo :: ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
$cenumFromThenTo :: ReadWriteMode -&gt; ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
enumFromTo :: ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
$cenumFromTo :: ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
enumFromThen :: ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
$cenumFromThen :: ReadWriteMode -&gt; ReadWriteMode -&gt; [ReadWriteMode]
enumFrom :: ReadWriteMode -&gt; [ReadWriteMode]
$cenumFrom :: ReadWriteMode -&gt; [ReadWriteMode]
fromEnum :: ReadWriteMode -&gt; Int
$cfromEnum :: ReadWriteMode -&gt; Int
toEnum :: Int -&gt; ReadWriteMode
$ctoEnum :: Int -&gt; ReadWriteMode
pred :: ReadWriteMode -&gt; ReadWriteMode
$cpred :: ReadWriteMode -&gt; ReadWriteMode
succ :: ReadWriteMode -&gt; ReadWriteMode
$csucc :: ReadWriteMode -&gt; ReadWriteMode
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131175"><span id="local-6989586621679131177"><span class="annot"><span class="annottext">ReadWriteMode
ReadWriteMode -&gt; ReadWriteMode -&gt; Bounded ReadWriteMode
forall a. a -&gt; a -&gt; Bounded a
maxBound :: ReadWriteMode
$cmaxBound :: ReadWriteMode
minBound :: ReadWriteMode
$cminBound :: ReadWriteMode
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Bounded</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">data</span><span> </span><span id="TransactionMode"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-var">TransactionMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransactionMode"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-var">TransactionMode</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-87"></span><span>       </span><span id="isolationLevel"><span class="annot"><span class="annottext">TransactionMode -&gt; IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#isolationLevel"><span class="hs-identifier hs-var hs-var">isolationLevel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#IsolationLevel"><span class="hs-identifier hs-type">IsolationLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>       </span><span id="readWriteMode"><span class="annot"><span class="annottext">TransactionMode -&gt; ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#readWriteMode"><span class="hs-identifier hs-var hs-var">readWriteMode</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWriteMode"><span class="hs-identifier hs-type">ReadWriteMode</span></a></span><span>
</span><span id="line-89"></span><span>     </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131166"><span id="local-6989586621679131168"><span id="local-6989586621679131170"><span class="annot"><span class="annottext">Int -&gt; TransactionMode -&gt; ShowS
[TransactionMode] -&gt; ShowS
TransactionMode -&gt; String
(Int -&gt; TransactionMode -&gt; ShowS)
-&gt; (TransactionMode -&gt; String)
-&gt; ([TransactionMode] -&gt; ShowS)
-&gt; Show TransactionMode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TransactionMode] -&gt; ShowS
$cshowList :: [TransactionMode] -&gt; ShowS
show :: TransactionMode -&gt; String
$cshow :: TransactionMode -&gt; String
showsPrec :: Int -&gt; TransactionMode -&gt; ShowS
$cshowsPrec :: Int -&gt; TransactionMode -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131162"><span id="local-6989586621679131164"><span class="annot"><span class="annottext">TransactionMode -&gt; TransactionMode -&gt; Bool
(TransactionMode -&gt; TransactionMode -&gt; Bool)
-&gt; (TransactionMode -&gt; TransactionMode -&gt; Bool)
-&gt; Eq TransactionMode
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TransactionMode -&gt; TransactionMode -&gt; Bool
$c/= :: TransactionMode -&gt; TransactionMode -&gt; Bool
== :: TransactionMode -&gt; TransactionMode -&gt; Bool
$c== :: TransactionMode -&gt; TransactionMode -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier hs-type">defaultTransactionMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-type">TransactionMode</span></a></span><span>
</span><span id="line-92"></span><span id="defaultTransactionMode"><span class="annot"><span class="annottext">defaultTransactionMode :: TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier hs-var hs-var">defaultTransactionMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">IsolationLevel -&gt; ReadWriteMode -&gt; TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-var">TransactionMode</span></a></span><span>
</span><span id="line-93"></span><span>                            </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultIsolationLevel"><span class="hs-identifier hs-var">defaultIsolationLevel</span></a></span><span>
</span><span id="line-94"></span><span>                            </span><span class="annot"><span class="annottext">ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultReadWriteMode"><span class="hs-identifier hs-var">defaultReadWriteMode</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#defaultIsolationLevel"><span class="hs-identifier hs-type">defaultIsolationLevel</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#IsolationLevel"><span class="hs-identifier hs-type">IsolationLevel</span></a></span><span>
</span><span id="line-97"></span><span id="defaultIsolationLevel"><span class="annot"><span class="annottext">defaultIsolationLevel :: IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultIsolationLevel"><span class="hs-identifier hs-var hs-var">defaultIsolationLevel</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#DefaultIsolationLevel"><span class="hs-identifier hs-var">DefaultIsolationLevel</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#defaultReadWriteMode"><span class="hs-identifier hs-type">defaultReadWriteMode</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWriteMode"><span class="hs-identifier hs-type">ReadWriteMode</span></a></span><span>
</span><span id="line-100"></span><span id="defaultReadWriteMode"><span class="annot"><span class="annottext">defaultReadWriteMode :: ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultReadWriteMode"><span class="hs-identifier hs-var hs-var">defaultReadWriteMode</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#DefaultReadWriteMode"><span class="hs-identifier hs-var">DefaultReadWriteMode</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Execute an action inside a SQL transaction.</span><span>
</span><span id="line-103"></span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- This function initiates a transaction with a \&quot;@begin</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- transaction@\&quot; statement, then executes the supplied action.  If</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- the action succeeds, the transaction will be completed with</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- 'Base.commit' before this function returns.</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- If the action throws /any/ kind of exception (not just a</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- PostgreSQL-related exception), the transaction will be rolled back using</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- 'rollback', then the exception will be rethrown.</span><span>
</span><span id="line-112"></span><span class="hs-comment">--</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- For nesting transactions, see 'withSavepoint'.</span><span>
</span><span id="line-114"></span><span id="local-6989586621679131161"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransaction"><span class="hs-identifier hs-type">withTransaction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131161"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131161"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-115"></span><span id="withTransaction"><span class="annot"><span class="annottext">withTransaction :: Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransaction"><span class="hs-identifier hs-var hs-var">withTransaction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; Connection -&gt; IO a -&gt; IO a
forall a. TransactionMode -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionMode"><span class="hs-identifier hs-var">withTransactionMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier hs-var">defaultTransactionMode</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- | Execute an action inside of a 'Serializable' transaction.  If a</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- serialization failure occurs, roll back the transaction and try again.</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- Be warned that this may execute the IO action multiple times.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- A 'Serializable' transaction creates the illusion that your program has</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- exclusive access to the database.  This means that, even in a concurrent</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- setting, you can perform queries in sequence without having to worry about</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- what might happen between one statement and the next.</span><span>
</span><span id="line-125"></span><span class="hs-comment">--</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- Think of it as STM, but without @retry@.</span><span>
</span><span id="line-127"></span><span id="local-6989586621679131160"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionSerializable"><span class="hs-identifier hs-type">withTransactionSerializable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131160"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131160"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-128"></span><span id="withTransactionSerializable"><span class="annot"><span class="annottext">withTransactionSerializable :: Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionSerializable"><span class="hs-identifier hs-var hs-var">withTransactionSerializable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">TransactionMode -&gt; (SqlError -&gt; Bool) -&gt; Connection -&gt; IO a -&gt; IO a
forall a.
TransactionMode -&gt; (SqlError -&gt; Bool) -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry"><span class="hs-identifier hs-var">withTransactionModeRetry</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">TransactionMode :: IsolationLevel -&gt; ReadWriteMode -&gt; TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-type">TransactionMode</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">isolationLevel :: IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#isolationLevel"><span class="hs-identifier hs-var">isolationLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#Serializable"><span class="hs-identifier hs-var">Serializable</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">readWriteMode :: ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#readWriteMode"><span class="hs-identifier hs-var">readWriteMode</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWrite"><span class="hs-identifier hs-var">ReadWrite</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">SqlError -&gt; Bool
</span><a href="Database.PostgreSQL.Simple.Errors.html#isSerializationError"><span class="hs-identifier hs-var">isSerializationError</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Execute an action inside a SQL transaction with a given isolation level.</span><span>
</span><span id="line-137"></span><span id="local-6989586621679131159"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionLevel"><span class="hs-identifier hs-type">withTransactionLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#IsolationLevel"><span class="hs-identifier hs-type">IsolationLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131159"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131159"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-138"></span><span id="withTransactionLevel"><span class="annot"><span class="annottext">withTransactionLevel :: IsolationLevel -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionLevel"><span class="hs-identifier hs-var hs-var">withTransactionLevel</span></a></span></span><span> </span><span id="local-6989586621679131158"><span class="annot"><span class="annottext">IsolationLevel
</span><a href="#local-6989586621679131158"><span class="hs-identifier hs-var">lvl</span></a></span></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; Connection -&gt; IO a -&gt; IO a
forall a. TransactionMode -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionMode"><span class="hs-identifier hs-var">withTransactionMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier hs-var">defaultTransactionMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">isolationLevel :: IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#isolationLevel"><span class="hs-identifier hs-var">isolationLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="#local-6989586621679131158"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Execute an action inside a SQL transaction with a given transaction mode.</span><span>
</span><span id="line-142"></span><span id="local-6989586621679131340"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionMode"><span class="hs-identifier hs-type">withTransactionMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-type">TransactionMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131340"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131340"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-143"></span><span id="withTransactionMode"><span class="annot"><span class="annottext">withTransactionMode :: TransactionMode -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionMode"><span class="hs-identifier hs-var hs-var">withTransactionMode</span></a></span></span><span> </span><span id="local-6989586621679131157"><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131157"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679131156"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131156"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679131155"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679131155"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="annottext">((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. ((IO a -&gt; IO a) -&gt; IO b) -&gt; IO b
</span><a href="Database.PostgreSQL.Simple.Compat.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">(((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a)
-&gt; ((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679131154"><span class="annot"><span class="annottext">IO a -&gt; IO a
</span><a href="#local-6989586621679131154"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">TransactionMode -&gt; Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier hs-var">beginMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131157"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131156"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679131153"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131153"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
</span><a href="#local-6989586621679131154"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679131155"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`E.onException`</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollback_"><span class="hs-identifier hs-var">rollback_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131156"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#commit"><span class="hs-identifier hs-var">commit</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131156"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131153"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | 'withTransactionModeRetry'' but with the exception type pinned to 'SqlError'.</span><span>
</span><span id="line-151"></span><span id="local-6989586621679131337"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry"><span class="hs-identifier hs-type">withTransactionModeRetry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-type">TransactionMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#SqlError"><span class="hs-identifier hs-type">SqlError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131337"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131337"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-152"></span><span id="withTransactionModeRetry"><span class="annot"><span class="annottext">withTransactionModeRetry :: TransactionMode -&gt; (SqlError -&gt; Bool) -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry"><span class="hs-identifier hs-var hs-var">withTransactionModeRetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; (SqlError -&gt; Bool) -&gt; Connection -&gt; IO a -&gt; IO a
forall a e.
Exception e =&gt;
TransactionMode -&gt; (e -&gt; Bool) -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry%27"><span class="hs-identifier hs-var">withTransactionModeRetry'</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Like 'withTransactionMode', but also takes a custom callback to</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- determine if a transaction should be retried if an exception occurs.</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- If the callback returns 'True', then the transaction will be retried.</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- If the callback returns 'False', or an exception other than an @e@</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- occurs then the transaction will be rolled back and the exception rethrown.</span><span>
</span><span id="line-159"></span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- This is used to implement 'withTransactionSerializable'.</span><span>
</span><span id="line-161"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry%27"><span class="hs-identifier hs-type">withTransactionModeRetry'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679131322"><span class="annot"><a href="#local-6989586621679131322"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679131324"><span class="annot"><a href="#local-6989586621679131324"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">E.Exception</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131324"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-type">TransactionMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679131324"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131322"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131322"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-162"></span><span id="withTransactionModeRetry%27"><span class="annot"><span class="annottext">withTransactionModeRetry' :: TransactionMode -&gt; (e -&gt; Bool) -&gt; Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withTransactionModeRetry%27"><span class="hs-identifier hs-var hs-var">withTransactionModeRetry'</span></a></span></span><span> </span><span id="local-6989586621679131150"><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131150"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679131149"><span class="annot"><span class="annottext">e -&gt; Bool
</span><a href="#local-6989586621679131149"><span class="hs-identifier hs-var">shouldRetry</span></a></span></span><span> </span><span id="local-6989586621679131148"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131148"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679131147"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679131147"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. ((IO a -&gt; IO a) -&gt; IO b) -&gt; IO b
</span><a href="Database.PostgreSQL.Simple.Compat.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">(((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a)
-&gt; ((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679131146"><span class="annot"><span class="annottext">IO a -&gt; IO a
</span><a href="#local-6989586621679131146"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">IO (Either e a) -&gt; IO a
</span><a href="#local-6989586621679131145"><span class="hs-identifier hs-var">retryLoop</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either e a) -&gt; IO a) -&gt; IO (Either e a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either e a)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">E.try</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Either e a)) -&gt; IO a -&gt; IO (Either e a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>            </span><span id="local-6989586621679131143"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131143"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
</span><a href="#local-6989586621679131146"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679131147"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`E.onException`</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollback_"><span class="hs-identifier hs-var">rollback_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131148"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-166"></span><span>            </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#commit"><span class="hs-identifier hs-var">commit</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131148"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131143"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><a href="#local-6989586621679131145"><span class="hs-identifier hs-type">retryLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131324"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131322"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131322"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679131145"><span class="annot"><span class="annottext">retryLoop :: IO (Either e a) -&gt; IO a
</span><a href="#local-6989586621679131145"><span class="hs-identifier hs-var hs-var">retryLoop</span></a></span></span><span> </span><span id="local-6989586621679131142"><span class="annot"><span class="annottext">IO (Either e a)
</span><a href="#local-6989586621679131142"><span class="hs-identifier hs-var">act'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><span class="annottext">TransactionMode -&gt; Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier hs-var">beginMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131150"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131148"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621679131141"><span class="annot"><span class="annottext">Either e a
</span><a href="#local-6989586621679131141"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either e a)
</span><a href="#local-6989586621679131142"><span class="hs-identifier hs-var">act'</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either e a
</span><a href="#local-6989586621679131141"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-174"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679131140"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679131140"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">e -&gt; Bool
</span><a href="#local-6989586621679131149"><span class="hs-identifier hs-var">shouldRetry</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679131140"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-176"></span><span>                  </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either e a) -&gt; IO a
</span><a href="#local-6989586621679131145"><span class="hs-identifier hs-var">retryLoop</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either e a)
</span><a href="#local-6989586621679131142"><span class="hs-identifier hs-var">act'</span></a></span><span>
</span><span id="line-177"></span><span>                  </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">e -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">E.throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679131140"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679131138"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131138"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>                </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131138"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Rollback a transaction.</span><span>
</span><span id="line-182"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollback"><span class="hs-identifier hs-type">rollback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span id="rollback"><span class="annot"><span class="annottext">rollback :: Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollback"><span class="hs-identifier hs-var hs-var">rollback</span></a></span></span><span> </span><span id="local-6989586621679131137"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131137"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131137"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;ROLLBACK&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO Int64 -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | Rollback a transaction, ignoring any @IOErrors@</span><span>
</span><span id="line-186"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollback_"><span class="hs-identifier hs-type">rollback_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span id="rollback_"><span class="annot"><span class="annottext">rollback_ :: Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollback_"><span class="hs-identifier hs-var hs-var">rollback_</span></a></span></span><span> </span><span id="local-6989586621679131135"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131135"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollback"><span class="hs-identifier hs-var">rollback</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131135"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (IOError -&gt; IO ()) -&gt; IO ()
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`E.catch`</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOError
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">IOError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Commit a transaction.</span><span>
</span><span id="line-190"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#commit"><span class="hs-identifier hs-type">commit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span id="commit"><span class="annot"><span class="annottext">commit :: Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#commit"><span class="hs-identifier hs-var hs-var">commit</span></a></span></span><span> </span><span id="local-6989586621679131133"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131133"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131133"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;COMMIT&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO Int64 -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">-- | Begin a transaction.</span><span>
</span><span id="line-194"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#begin"><span class="hs-identifier hs-type">begin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span id="begin"><span class="annot"><span class="annottext">begin :: Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#begin"><span class="hs-identifier hs-var hs-var">begin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier hs-var">beginMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier hs-var">defaultTransactionMode</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- | Begin a transaction with a given isolation level</span><span>
</span><span id="line-198"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#beginLevel"><span class="hs-identifier hs-type">beginLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#IsolationLevel"><span class="hs-identifier hs-type">IsolationLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span id="beginLevel"><span class="annot"><span class="annottext">beginLevel :: IsolationLevel -&gt; Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#beginLevel"><span class="hs-identifier hs-var hs-var">beginLevel</span></a></span></span><span> </span><span id="local-6989586621679131132"><span class="annot"><span class="annottext">IsolationLevel
</span><a href="#local-6989586621679131132"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier hs-var">beginMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#defaultTransactionMode"><span class="hs-identifier hs-var">defaultTransactionMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">isolationLevel :: IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#isolationLevel"><span class="hs-identifier hs-var">isolationLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="#local-6989586621679131132"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- | Begin a transaction with a given transaction mode</span><span>
</span><span id="line-202"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier hs-type">beginMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#TransactionMode"><span class="hs-identifier hs-type">TransactionMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span id="beginMode"><span class="annot"><span class="annottext">beginMode :: TransactionMode -&gt; Connection -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#beginMode"><span class="hs-identifier hs-var hs-var">beginMode</span></a></span></span><span> </span><span id="local-6989586621679131131"><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131131"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679131130"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131130"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131130"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">(Query -&gt; IO Int64) -&gt; Query -&gt; IO Int64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Query
</span><a href="Database.PostgreSQL.Simple.Types.html#Query"><span class="hs-identifier hs-var">Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">B.concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;BEGIN&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679131126"><span class="hs-identifier hs-var">isolevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679131125"><span class="hs-identifier hs-var">readmode</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621679131126"><span class="annot"><span class="annottext">isolevel :: ByteString
</span><a href="#local-6989586621679131126"><span class="hs-identifier hs-var hs-var">isolevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#isolationLevel"><span class="hs-identifier hs-var hs-var">isolationLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131131"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-208"></span><span>                 </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#DefaultIsolationLevel"><span class="hs-identifier hs-var">DefaultIsolationLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-209"></span><span>                 </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#ReadCommitted"><span class="hs-identifier hs-var">ReadCommitted</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot; ISOLATION LEVEL READ COMMITTED&quot;</span></span><span>
</span><span id="line-210"></span><span>                 </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#RepeatableRead"><span class="hs-identifier hs-var">RepeatableRead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot; ISOLATION LEVEL REPEATABLE READ&quot;</span></span><span>
</span><span id="line-211"></span><span>                 </span><span class="annot"><span class="annottext">IsolationLevel
</span><a href="Database.PostgreSQL.Simple.Transaction.html#Serializable"><span class="hs-identifier hs-var">Serializable</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot; ISOLATION LEVEL SERIALIZABLE&quot;</span></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679131125"><span class="annot"><span class="annottext">readmode :: ByteString
</span><a href="#local-6989586621679131125"><span class="hs-identifier hs-var hs-var">readmode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransactionMode -&gt; ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#readWriteMode"><span class="hs-identifier hs-var hs-var">readWriteMode</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionMode
</span><a href="#local-6989586621679131131"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>                 </span><span class="annot"><span class="annottext">ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#DefaultReadWriteMode"><span class="hs-identifier hs-var">DefaultReadWriteMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-214"></span><span>                 </span><span class="annot"><span class="annottext">ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#ReadWrite"><span class="hs-identifier hs-var">ReadWrite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot; READ WRITE&quot;</span></span><span>
</span><span id="line-215"></span><span>                 </span><span class="annot"><span class="annottext">ReadWriteMode
</span><a href="Database.PostgreSQL.Simple.Transaction.html#ReadOnly"><span class="hs-identifier hs-var">ReadOnly</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot; READ ONLY&quot;</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- Savepoint</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Create a savepoint, and roll back to it if an error occurs.  This may only</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- be used inside of a transaction, and provides a sort of</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- \&quot;nested transaction\&quot;.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- See &lt;https://www.postgresql.org/docs/9.5/static/sql-savepoint.html&gt;</span><span>
</span><span id="line-225"></span><span id="local-6989586621679131124"><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#withSavepoint"><span class="hs-identifier hs-type">withSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131124"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679131124"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-226"></span><span id="withSavepoint"><span class="annot"><span class="annottext">withSavepoint :: Connection -&gt; IO a -&gt; IO a
</span><a href="Database.PostgreSQL.Simple.Transaction.html#withSavepoint"><span class="hs-identifier hs-var hs-var">withSavepoint</span></a></span></span><span> </span><span id="local-6989586621679131123"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679131122"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679131122"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="annottext">((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. ((IO a -&gt; IO a) -&gt; IO b) -&gt; IO b
</span><a href="Database.PostgreSQL.Simple.Compat.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">(((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a)
-&gt; ((IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679131121"><span class="annot"><span class="annottext">IO a -&gt; IO a
</span><a href="#local-6989586621679131121"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679131120"><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679131120"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO Savepoint
</span><a href="Database.PostgreSQL.Simple.Transaction.html#newSavepoint"><span class="hs-identifier hs-var">newSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679131119"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131119"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
</span><a href="#local-6989586621679131121"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679131122"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`E.onException`</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Savepoint -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToAndReleaseSavepoint"><span class="hs-identifier hs-var">rollbackToAndReleaseSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679131120"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Savepoint -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#releaseSavepoint"><span class="hs-identifier hs-var">releaseSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679131120"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (SqlError -&gt; IO ()) -&gt; IO ()
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`E.catch`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679131118"><span class="annot"><span class="annottext">SqlError
</span><a href="#local-6989586621679131118"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SqlError -&gt; Bool
</span><a href="Database.PostgreSQL.Simple.Errors.html#isFailedTransactionError"><span class="hs-identifier hs-var">isFailedTransactionError</span></a></span><span> </span><span class="annot"><span class="annottext">SqlError
</span><a href="#local-6989586621679131118"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Savepoint -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToAndReleaseSavepoint"><span class="hs-identifier hs-var">rollbackToAndReleaseSavepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Savepoint
</span><a href="#local-6989586621679131120"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-233"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SqlError -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">E.throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">SqlError
</span><a href="#local-6989586621679131118"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131119"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Create a new savepoint.  This may only be used inside of a transaction.</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#newSavepoint"><span class="hs-identifier hs-type">newSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span>
</span><span id="line-238"></span><span id="newSavepoint"><span class="annot"><span class="annottext">newSavepoint :: Connection -&gt; IO Savepoint
</span><a href="Database.PostgreSQL.Simple.Transaction.html#newSavepoint"><span class="hs-identifier hs-var hs-var">newSavepoint</span></a></span></span><span> </span><span id="local-6989586621679131117"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131117"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621679131116"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131116"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO Query
</span><a href="Database.PostgreSQL.Simple.Internal.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131117"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131117"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SAVEPOINT &quot;</span></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131116"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">Savepoint -&gt; IO Savepoint
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Query -&gt; Savepoint
</span><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-var">Savepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131116"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | Destroy a savepoint, but retain its effects.</span><span>
</span><span id="line-244"></span><span class="hs-comment">--</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- Warning: this will throw a 'SqlError' matching 'isFailedTransactionError' if</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- the transaction is aborted due to an error.  'commit' would merely warn and</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- roll back.</span><span>
</span><span id="line-248"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#releaseSavepoint"><span class="hs-identifier hs-type">releaseSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span id="releaseSavepoint"><span class="annot"><span class="annottext">releaseSavepoint :: Connection -&gt; Savepoint -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#releaseSavepoint"><span class="hs-identifier hs-var hs-var">releaseSavepoint</span></a></span></span><span> </span><span id="local-6989586621679131113"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131113"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span id="local-6989586621679131112"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131112"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131113"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;RELEASE SAVEPOINT &quot;</span></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131112"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO Int64 -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | Roll back to a savepoint.  This will not release the savepoint.</span><span>
</span><span id="line-253"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToSavepoint"><span class="hs-identifier hs-type">rollbackToSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span id="rollbackToSavepoint"><span class="annot"><span class="annottext">rollbackToSavepoint :: Connection -&gt; Savepoint -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToSavepoint"><span class="hs-identifier hs-var hs-var">rollbackToSavepoint</span></a></span></span><span> </span><span id="local-6989586621679131111"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131111"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span id="local-6989586621679131110"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131110"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131111"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;ROLLBACK TO SAVEPOINT &quot;</span></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131110"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO Int64 -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | Roll back to a savepoint and release it.  This is like calling</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- 'rollbackToSavepoint' followed by 'releaseSavepoint', but avoids a</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- round trip to the database server.</span><span>
</span><span id="line-260"></span><span class="annot"><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToAndReleaseSavepoint"><span class="hs-identifier hs-type">rollbackToAndReleaseSavepoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Internal.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span id="rollbackToAndReleaseSavepoint"><span class="annot"><span class="annottext">rollbackToAndReleaseSavepoint :: Connection -&gt; Savepoint -&gt; IO ()
</span><a href="Database.PostgreSQL.Simple.Transaction.html#rollbackToAndReleaseSavepoint"><span class="hs-identifier hs-var hs-var">rollbackToAndReleaseSavepoint</span></a></span></span><span> </span><span id="local-6989586621679131109"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131109"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.PostgreSQL.Simple.Types.html#Savepoint"><span class="hs-identifier hs-type">Savepoint</span></a></span><span> </span><span id="local-6989586621679131108"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131108"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO Int64
</span><a href="Database.PostgreSQL.Simple.Internal.html#execute_"><span class="hs-identifier hs-var">execute_</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679131109"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131107"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="annot"><span class="annottext">IO Int64 -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679131107"><span class="annot"><span class="annottext">sql :: Query
</span><a href="#local-6989586621679131107"><span class="hs-identifier hs-var hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;ROLLBACK TO SAVEPOINT &quot;</span></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131108"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;; RELEASE SAVEPOINT &quot;</span></span><span> </span><span class="annot"><span class="annottext">Query -&gt; Query -&gt; Query
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679131108"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-265"></span></pre></body></html>