<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Demo.Database</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier">Conduit</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">ResourceT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Alternative</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadPlus</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">Control.Monad.Class.MonadSTM</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadSTM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">Control.Monad.Class.MonadThrow</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">ExitCase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadCatch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadEvaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadMask</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier">MonadThrow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier">Control.Monad.Logger</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier">NoLoggingT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Chain.html"><span class="hs-identifier">Data.Chain</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Chain.html#DeltaChain"><span class="hs-identifier">DeltaChain</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Chain.html#Edge"><span class="hs-identifier">Edge</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Chain.html#chainIntoTable"><span class="hs-identifier">chainIntoTable</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Iso'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">iso</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">withIso</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Table.html"><span class="hs-identifier">Data.Table</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Table.html#DeltaDB"><span class="hs-identifier">DeltaDB</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Table.html#Pile"><span class="hs-identifier">Pile</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Table.html#tableIntoDatabase"><span class="hs-identifier">tableIntoDatabase</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word32</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.Delta.html"><span class="hs-identifier">Database.Persist.Delta</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Persist.Delta.html#newEntityStore"><span class="hs-identifier">newEntityStore</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Delta.html#newSqlStore"><span class="hs-identifier">newSqlStore</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">Database.Persist.Sql</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">SqlPersistM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">Database.Persist.TH</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">mkMigrate</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">mkPersist</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">mpsPrefixFields</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">persistLowerCase</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">share</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier">sqlSettings</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Schema.html"><span class="hs-identifier">Database.Schema</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator">(:.)</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier">Col</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Schema.html#Primary"><span class="hs-identifier">Primary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Schema.html#Table"><span class="hs-identifier">Table</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../say/html/src"><span class="hs-identifier">Say</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../say/html/src"><span class="hs-identifier">sayShow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../stm/html/src"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../exceptions/html/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ResourceT</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../stm/html/src"><span class="hs-identifier">Control.Monad.STM</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.Chain.html"><span class="hs-identifier">Data.Chain</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Chain</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../persistent-sqlite/html/src"><span class="hs-identifier">Database.Persist.Sqlite</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Persist</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Database.Schema.html"><span class="hs-identifier">Database.Schema</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sql</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.DBVar.html"><span class="hs-identifier">Data.DBVar</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Delta.html"><span class="hs-identifier">Data.Delta</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    (Mock) address type
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-91"></span><span class="hs-keyword">type</span><span> </span><span id="Address"><span class="annot"><a href="Demo.Database.html#Address"><span class="hs-identifier hs-var">Address</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">type</span><span> </span><span id="Node"><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-var">Node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">data</span><span> </span><span id="AddressInPool"><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-var">AddressInPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AddressInPool"><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-var">AddressInPool</span></a></span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="address"><span class="annot"><span class="annottext">AddressInPool -&gt; Address
</span><a href="Demo.Database.html#address"><span class="hs-identifier hs-var hs-var">address</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Demo.Database.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="index"><span class="annot"><span class="annottext">AddressInPool -&gt; Word32
</span><a href="Demo.Database.html#index"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211805"><span id="local-6989586621679211807"><span class="annot"><span class="annottext">AddressInPool -&gt; AddressInPool -&gt; Bool
(AddressInPool -&gt; AddressInPool -&gt; Bool)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; Bool) -&gt; Eq AddressInPool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AddressInPool -&gt; AddressInPool -&gt; Bool
$c/= :: AddressInPool -&gt; AddressInPool -&gt; Bool
== :: AddressInPool -&gt; AddressInPool -&gt; Bool
$c== :: AddressInPool -&gt; AddressInPool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211789"><span id="local-6989586621679211791"><span id="local-6989586621679211793"><span id="local-6989586621679211795"><span id="local-6989586621679211797"><span id="local-6989586621679211799"><span id="local-6989586621679211801"><span class="annot"><span class="annottext">Eq AddressInPool
Eq AddressInPool
-&gt; (AddressInPool -&gt; AddressInPool -&gt; Ordering)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; Bool)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; Bool)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; Bool)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; Bool)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; AddressInPool)
-&gt; (AddressInPool -&gt; AddressInPool -&gt; AddressInPool)
-&gt; Ord AddressInPool
AddressInPool -&gt; AddressInPool -&gt; Bool
AddressInPool -&gt; AddressInPool -&gt; Ordering
AddressInPool -&gt; AddressInPool -&gt; AddressInPool
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: AddressInPool -&gt; AddressInPool -&gt; AddressInPool
$cmin :: AddressInPool -&gt; AddressInPool -&gt; AddressInPool
max :: AddressInPool -&gt; AddressInPool -&gt; AddressInPool
$cmax :: AddressInPool -&gt; AddressInPool -&gt; AddressInPool
&gt;= :: AddressInPool -&gt; AddressInPool -&gt; Bool
$c&gt;= :: AddressInPool -&gt; AddressInPool -&gt; Bool
&gt; :: AddressInPool -&gt; AddressInPool -&gt; Bool
$c&gt; :: AddressInPool -&gt; AddressInPool -&gt; Bool
&lt;= :: AddressInPool -&gt; AddressInPool -&gt; Bool
$c&lt;= :: AddressInPool -&gt; AddressInPool -&gt; Bool
&lt; :: AddressInPool -&gt; AddressInPool -&gt; Bool
$c&lt; :: AddressInPool -&gt; AddressInPool -&gt; Bool
compare :: AddressInPool -&gt; AddressInPool -&gt; Ordering
$ccompare :: AddressInPool -&gt; AddressInPool -&gt; Ordering
$cp1Ord :: Eq AddressInPool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211782"><span id="local-6989586621679211784"><span id="local-6989586621679211786"><span class="annot"><span class="annottext">Int -&gt; AddressInPool -&gt; ShowS
[AddressInPool] -&gt; ShowS
AddressInPool -&gt; String
(Int -&gt; AddressInPool -&gt; ShowS)
-&gt; (AddressInPool -&gt; String)
-&gt; ([AddressInPool] -&gt; ShowS)
-&gt; Show AddressInPool
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AddressInPool] -&gt; ShowS
$cshowList :: [AddressInPool] -&gt; ShowS
show :: AddressInPool -&gt; String
$cshow :: AddressInPool -&gt; String
showsPrec :: Int -&gt; AddressInPool -&gt; ShowS
$cshowsPrec :: Int -&gt; AddressInPool -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Construnct an 'Embedding' of delta encodings from an isomorphism.</span><span>
</span><span id="line-100"></span><span id="local-6989586621679212143"><span id="local-6989586621679212144"><span class="annot"><a href="Demo.Database.html#embedIso"><span class="hs-identifier hs-type">embedIso</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Iso'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212144"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212143"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Delta.html#Embedding"><span class="hs-identifier hs-type">Embedding</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Table.html#DeltaDB"><span class="hs-identifier hs-type">DeltaDB</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212144"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Table.html#DeltaDB"><span class="hs-identifier hs-type">DeltaDB</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212143"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-101"></span><span id="embedIso"><span class="annot"><span class="annottext">embedIso :: Iso' a b -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b]
</span><a href="Demo.Database.html#embedIso"><span class="hs-identifier hs-var hs-var">embedIso</span></a></span></span><span> </span><span id="local-6989586621679211779"><span class="annot"><span class="annottext">Iso' a b
</span><a href="#local-6989586621679211779"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Iso' a b
-&gt; ((a -&gt; b)
    -&gt; (b -&gt; a) -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b])
-&gt; Embedding [DeltaDB Int a] [DeltaDB Int b]
forall s t a b r. Iso s t a b -&gt; ((s -&gt; a) -&gt; (b -&gt; t) -&gt; r) -&gt; r
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">withIso</span></a></span><span> </span><span class="annot"><span class="annottext">Iso' a b
</span><a href="#local-6989586621679211779"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(((a -&gt; b)
  -&gt; (b -&gt; a) -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b])
 -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b])
-&gt; ((a -&gt; b)
    -&gt; (b -&gt; a) -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b])
-&gt; Embedding [DeltaDB Int a] [DeltaDB Int b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679211778"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211778"><span class="hs-identifier hs-var">ab</span></a></span></span><span> </span><span id="local-6989586621679211777"><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621679211777"><span class="hs-identifier hs-var">ba</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Embedding' [DeltaDB Int a] [DeltaDB Int b]
-&gt; Embedding [DeltaDB Int a] [DeltaDB Int b]
forall da db. Embedding' da db -&gt; Embedding da db
</span><a href="Data.Delta.html#mkEmbedding"><span class="hs-identifier hs-var">mkEmbedding</span></a></span><span> </span><span class="annot"><span class="annottext">Embedding' :: forall da db a b.
(Delta da, Delta db, a ~ Base da, b ~ Base db) =&gt;
(b -&gt; Either SomeException a)
-&gt; (a -&gt; b) -&gt; (a -&gt; b -&gt; da -&gt; db) -&gt; Embedding' da db
</span><a href="Data.Delta.html#Embedding%27"><span class="hs-identifier hs-type">Embedding'</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">load :: Table b -&gt; Either SomeException (Table a)
</span><a href="Data.Delta.html#load"><span class="hs-identifier hs-var">load</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Table a -&gt; Either SomeException (Table a)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Table a -&gt; Either SomeException (Table a))
-&gt; (Table b -&gt; Table a)
-&gt; Table b
-&gt; Either SomeException (Table a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; a) -&gt; Table b -&gt; Table a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621679211777"><span class="hs-identifier hs-var">ba</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">write :: Table a -&gt; Table b
</span><a href="Data.Delta.html#write"><span class="hs-identifier hs-var">write</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Table a -&gt; Table b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211778"><span class="hs-identifier hs-var">ab</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">update :: Table a -&gt; Table b -&gt; [DeltaDB Int a] -&gt; [DeltaDB Int b]
</span><a href="Data.Delta.html#update"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Table a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Table b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DeltaDB Int a -&gt; DeltaDB Int b)
-&gt; [DeltaDB Int a] -&gt; [DeltaDB Int b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; DeltaDB Int a -&gt; DeltaDB Int b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211778"><span class="hs-identifier hs-var">ab</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">type</span><span> </span><span id="StoreAddress"><span class="annot"><a href="Demo.Database.html#StoreAddress"><span class="hs-identifier hs-var">StoreAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.DBVar.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier hs-type">SqlPersistM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Chain.html#DeltaChain"><span class="hs-identifier hs-type">DeltaChain</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Store using Persistent entities
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-112"></span><span id="migrateAll"><span id="entityDefListFormigrateAll"><span id="SeqStateAddressIndex"><span id="SeqStateAddressAddress"><span id="SeqStateAddressWalletId"><span id="SeqStateAddressTo"><span id="SeqStateAddressFrom"><span id="SeqStateAddressId"><span id="unSeqStateAddressKey"><span id="SeqStateAddressKey"><span id="seqStateAddressIndex"><span id="seqStateAddressAddress"><span id="seqStateAddressWalletId"><span id="seqStateAddressTo"><span id="seqStateAddressFrom"><span id="SeqStateAddress"><span id="SeqStateAddressId"><span id="local-6989586621679211635"><span id="local-6989586621679211637"><span id="local-6989586621679211639"><span id="local-6989586621679211642"><span id="local-6989586621679211644"><span id="local-6989586621679211649"><span id="local-6989586621679211652"><span id="local-6989586621679211655"><span id="local-6989586621679211657"><span id="local-6989586621679211659"><span id="local-6989586621679211661"><span id="local-6989586621679211663"><span id="local-6989586621679211665"><span id="local-6989586621679211667"><span id="local-6989586621679211669"><span id="local-6989586621679211671"><span id="local-6989586621679211673"><span id="local-6989586621679211675"><span id="local-6989586621679211677"><span id="local-6989586621679211679"><span id="local-6989586621679211681"><span id="local-6989586621679211683"><span id="local-6989586621679211685"><span id="local-6989586621679211687"><span id="local-6989586621679211689"><span id="local-6989586621679211700"><span id="local-6989586621679211702"><span id="local-6989586621679211704"><span id="local-6989586621679211706"><span id="local-6989586621679211708"><span id="local-6989586621679211710"><span id="local-6989586621679211712"><span id="local-6989586621679211715"><span id="local-6989586621679211717"><span id="local-6989586621679211719"><span id="local-6989586621679211721"><span id="local-6989586621679211723"><span id="local-6989586621679211725"><span id="local-6989586621679211727"><span id="local-6989586621679211729"><span id="local-6989586621679211731"><span id="local-6989586621679211733"><span id="local-6989586621679211735"><span id="local-6989586621679211737"><span id="local-6989586621679211739"><span id="local-6989586621679211741"><span id="local-6989586621679211743"><span id="local-6989586621679211745"><span id="local-6989586621679211747"><span id="local-6989586621679211749"><span id="local-6989586621679211752"><span id="local-6989586621679211754"><span id="local-6989586621679211756"><span id="local-6989586621679211758"><span id="local-6989586621679211760"><span id="local-6989586621679211762"><span id="local-6989586621679211764"><span id="local-6989586621679211766"><span id="local-6989586621679211768"><span id="local-6989586621679211770"><span id="Unique"><span id="EntityField"><span id="PersistEntityBackend"><span id="Key"><span id="SeqStateAddress"><span id="local-6989586621679211582"><span id="local-6989586621679211583"></span></span><span class="hs-identifier">share</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">mkPersist</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sqlSettings</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mpsPrefixFields</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkMigrate</span><span> </span><span class="hs-string">&quot;migrateAll&quot;</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>    </span><span class="">[persistLowerCase|
SeqStateAddress
    seqStateAddressFrom             Node               sql=from
    seqStateAddressTo               Node               sql=to
    seqStateAddressWalletId         Word32             sql=wallet_id
    seqStateAddressAddress          Address            sql=address
    seqStateAddressIndex            Word32             sql=address_ix
    deriving Generic
|]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679211577"><span id="local-6989586621679211580"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#SeqStateAddress"><span class="hs-identifier hs-type">SeqStateAddress</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621679211576"><span class="annot"><span class="annottext">show :: SeqStateAddress -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span id="local-6989586621679211574"><span class="annot"><span class="annottext">SeqStateAddress
</span><a href="#local-6989586621679211574"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SeqStateAddress -&gt; Word32
</span><a href="Demo.Database.html#seqStateAddressTo"><span class="hs-identifier hs-var hs-var">seqStateAddressTo</span></a></span><span> </span><span class="annot"><span class="annottext">SeqStateAddress
</span><a href="#local-6989586621679211574"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &lt;--&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SeqStateAddress -&gt; Address
</span><a href="Demo.Database.html#seqStateAddressAddress"><span class="hs-identifier hs-var hs-var">seqStateAddressAddress</span></a></span><span> </span><span class="annot"><span class="annottext">SeqStateAddress
</span><a href="#local-6989586621679211574"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-- &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SeqStateAddress -&gt; Word32
</span><a href="Demo.Database.html#seqStateAddressFrom"><span class="hs-identifier hs-var hs-var">seqStateAddressFrom</span></a></span><span> </span><span class="annot"><span class="annottext">SeqStateAddress
</span><a href="#local-6989586621679211574"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Demo.Database.html#addressDBIso"><span class="hs-identifier hs-type">addressDBIso</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Iso'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Demo.Database.html#SeqStateAddress"><span class="hs-identifier hs-type">SeqStateAddress</span></a></span><span>
</span><span id="line-133"></span><span id="addressDBIso"><span class="annot"><span class="annottext">addressDBIso :: p SeqStateAddress (f SeqStateAddress)
-&gt; p (Edge Word32 AddressInPool) (f (Edge Word32 AddressInPool))
</span><a href="Demo.Database.html#addressDBIso"><span class="hs-identifier hs-var hs-var">addressDBIso</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Edge Word32 AddressInPool -&gt; SeqStateAddress)
-&gt; (SeqStateAddress -&gt; Edge Word32 AddressInPool)
-&gt; Iso
     (Edge Word32 AddressInPool)
     (Edge Word32 AddressInPool)
     SeqStateAddress
     SeqStateAddress
forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">iso</span></a></span><span> </span><span class="annot"><span class="annottext">Edge Word32 AddressInPool -&gt; SeqStateAddress
</span><a href="#local-6989586621679211572"><span class="hs-identifier hs-var">ab</span></a></span><span> </span><span class="annot"><span class="annottext">SeqStateAddress -&gt; Edge Word32 AddressInPool
</span><a href="#local-6989586621679211571"><span class="hs-identifier hs-var">ba</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679211572"><span class="annot"><span class="annottext">ab :: Edge Word32 AddressInPool -&gt; SeqStateAddress
</span><a href="#local-6989586621679211572"><span class="hs-identifier hs-var hs-var">ab</span></a></span></span><span> </span><span class="annot"><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span class="hs-special">{</span><span id="local-6989586621679211569"><span class="annot"><span class="annottext">Word32
from :: forall node edge. Edge node edge -&gt; node
from :: Word32
</span><a href="Data.Chain.html#from"><span class="hs-identifier hs-var hs-var">from</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679211567"><span class="annot"><span class="annottext">Word32
to :: forall node edge. Edge node edge -&gt; node
to :: Word32
</span><a href="Data.Chain.html#to"><span class="hs-identifier hs-var hs-var">to</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">via :: forall node edge. Edge node edge -&gt; edge
</span><a href="Data.Chain.html#via"><span class="hs-keyword hs-var">via</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">{</span><span id="local-6989586621679211564"><span class="annot"><span class="annottext">Address
address :: Address
address :: AddressInPool -&gt; Address
</span><a href="#local-6989586621679211564"><span class="hs-identifier hs-var hs-var">address</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679211563"><span class="annot"><span class="annottext">Word32
index :: Word32
index :: AddressInPool -&gt; Word32
</span><a href="#local-6989586621679211563"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32 -&gt; Address -&gt; Word32 -&gt; SeqStateAddress
</span><a href="Demo.Database.html#SeqStateAddress"><span class="hs-identifier hs-var">SeqStateAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211569"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211567"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679211564"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211563"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679211571"><span class="annot"><span class="annottext">ba :: SeqStateAddress -&gt; Edge Word32 AddressInPool
</span><a href="#local-6989586621679211571"><span class="hs-identifier hs-var hs-var">ba</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Demo.Database.html#SeqStateAddress"><span class="hs-identifier hs-type">SeqStateAddress</span></a></span><span> </span><span id="local-6989586621679211562"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211562"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679211561"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211561"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679211560"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679211560"><span class="hs-identifier hs-var">address</span></a></span></span><span> </span><span id="local-6989586621679211559"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211559"><span class="hs-identifier hs-var">index</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="annottext">Edge :: forall node edge. node -&gt; node -&gt; edge -&gt; Edge node edge
</span><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Word32
from :: Word32
from :: Word32
</span><a href="#local-6989586621679211562"><span class="hs-identifier hs-var hs-var">from</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word32
to :: Word32
to :: Word32
</span><a href="#local-6989586621679211561"><span class="hs-identifier hs-var hs-var">to</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">via :: AddressInPool
</span><a href="Data.Chain.html#via"><span class="hs-keyword hs-var">via</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">AddressInPool :: Address -&gt; Word32 -&gt; AddressInPool
</span><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Address
address :: Address
address :: Address
</span><a href="#local-6989586621679211560"><span class="hs-identifier hs-var hs-var">address</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word32
index :: Word32
index :: Word32
</span><a href="#local-6989586621679211559"><span class="hs-identifier hs-var hs-var">index</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><a href="Demo.Database.html#addressChainIntoTable"><span class="hs-identifier hs-type">addressChainIntoTable</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Delta.html#Embedding"><span class="hs-identifier hs-type">Embedding</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Data.Chain.html#DeltaChain"><span class="hs-identifier hs-type">DeltaChain</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="Data.Table.html#DeltaDB"><span class="hs-identifier hs-type">DeltaDB</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#SeqStateAddress"><span class="hs-identifier hs-type">SeqStateAddress</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-144"></span><span id="addressChainIntoTable"><span class="annot"><span class="annottext">addressChainIntoTable :: Embedding
  (DeltaChain Word32 [AddressInPool]) [DeltaDB Int SeqStateAddress]
</span><a href="Demo.Database.html#addressChainIntoTable"><span class="hs-identifier hs-var hs-var">addressChainIntoTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">Iso
  (Edge Word32 AddressInPool)
  (Edge Word32 AddressInPool)
  SeqStateAddress
  SeqStateAddress
-&gt; Embedding
     [DeltaDB Int (Edge Word32 AddressInPool)]
     [DeltaDB Int SeqStateAddress]
forall a b. Iso' a b -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b]
</span><a href="Demo.Database.html#embedIso"><span class="hs-identifier hs-var">embedIso</span></a></span><span> </span><span class="annot"><span class="annottext">Iso
  (Edge Word32 AddressInPool)
  (Edge Word32 AddressInPool)
  SeqStateAddress
  SeqStateAddress
</span><a href="Demo.Database.html#addressDBIso"><span class="hs-identifier hs-var">addressDBIso</span></a></span><span> </span><span class="annot"><span class="annottext">Embedding
  [DeltaDB Int (Edge Word32 AddressInPool)]
  [DeltaDB Int SeqStateAddress]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaDB Int (Edge Word32 AddressInPool)]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool]) [DeltaDB Int SeqStateAddress]
forall k (c :: k -&gt; k -&gt; *) (j :: k) (k1 :: k) (i :: k).
Semigroupoid c =&gt;
c j k1 -&gt; c i j -&gt; c i k1
</span><a href="../../../../semigroupoids/html/src"><span class="hs-operator hs-var">`o`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Embedding
  [DeltaTable (Edge Word32 AddressInPool)]
  [DeltaDB Int (Edge Word32 AddressInPool)]
forall row. Embedding [DeltaTable row] [DeltaDB Int row]
</span><a href="Data.Table.html#tableIntoDatabase"><span class="hs-identifier hs-var">tableIntoDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">Embedding
  [DeltaTable (Edge Word32 AddressInPool)]
  [DeltaDB Int (Edge Word32 AddressInPool)]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaTable (Edge Word32 AddressInPool)]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaDB Int (Edge Word32 AddressInPool)]
forall k (c :: k -&gt; k -&gt; *) (j :: k) (k1 :: k) (i :: k).
Semigroupoid c =&gt;
c j k1 -&gt; c i j -&gt; c i k1
</span><a href="../../../../semigroupoids/html/src"><span class="hs-operator hs-var">`o`</span></a></span><span> </span><span class="annot"><span class="annottext">([AddressInPool] -&gt; Pile AddressInPool)
-&gt; (Pile AddressInPool -&gt; [AddressInPool])
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaTable (Edge Word32 AddressInPool)]
forall node edge e.
(Ord node, Semigroup edge) =&gt;
(edge -&gt; Pile e)
-&gt; (Pile e -&gt; edge)
-&gt; Embedding (DeltaChain node edge) [DeltaTable (Edge node e)]
</span><a href="Data.Chain.html#chainIntoTable"><span class="hs-identifier hs-var">chainIntoTable</span></a></span><span> </span><span class="annot"><span class="annottext">[AddressInPool] -&gt; Pile AddressInPool
forall a. [a] -&gt; Pile a
</span><a href="Data.Table.html#Pile"><span class="hs-identifier hs-var">Pile</span></a></span><span> </span><span class="annot"><span class="annottext">Pile AddressInPool -&gt; [AddressInPool]
forall a. Pile a -&gt; [a]
</span><a href="Data.Table.html#getPile"><span class="hs-identifier hs-var hs-var">getPile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><a href="Demo.Database.html#newStoreAddress"><span class="hs-identifier hs-type">newStoreAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier hs-type">SqlPersistM</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#StoreAddress"><span class="hs-identifier hs-type">StoreAddress</span></a></span><span>
</span><span id="line-148"></span><span id="newStoreAddress"><span class="annot"><span class="annottext">newStoreAddress :: SqlPersistM StoreAddress
</span><a href="Demo.Database.html#newStoreAddress"><span class="hs-identifier hs-var hs-var">newStoreAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Embedding
  (DeltaChain Word32 [AddressInPool]) [DeltaDB Int SeqStateAddress]
-&gt; Store SqlPersistM [DeltaDB Int SeqStateAddress]
-&gt; SqlPersistM StoreAddress
forall (m :: * -&gt; *) da db.
(MonadSTM m, MonadMask m, Delta da) =&gt;
Embedding da db -&gt; Store m db -&gt; m (Store m da)
</span><a href="Data.DBVar.html#embedStore"><span class="hs-identifier hs-var">embedStore</span></a></span><span> </span><span class="annot"><span class="annottext">Embedding
  (DeltaChain Word32 [AddressInPool]) [DeltaDB Int SeqStateAddress]
</span><a href="Demo.Database.html#addressChainIntoTable"><span class="hs-identifier hs-var">addressChainIntoTable</span></a></span><span> </span><span class="annot"><span class="annottext">(Store SqlPersistM [DeltaDB Int SeqStateAddress]
 -&gt; SqlPersistM StoreAddress)
-&gt; SqlPersistM (Store SqlPersistM [DeltaDB Int SeqStateAddress])
-&gt; SqlPersistM StoreAddress
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">SqlPersistM (Store SqlPersistM [DeltaDB Int SeqStateAddress])
forall row (m :: * -&gt; *).
(PersistRecordBackend row SqlBackend, ToBackendKey SqlBackend row,
 Show row, MonadIO m) =&gt;
m (Store SqlPersistM [DeltaDB Int row])
</span><a href="Database.Persist.Delta.html#newEntityStore"><span class="hs-identifier hs-var">newEntityStore</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Store using SQL row types
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | 'MonadSTM' instance for the 'SqlPersistM' monad.</span><span>
</span><span id="line-155"></span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- NB. This is missing most of the STM methods except for a handful of TVar</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- ones!</span><span>
</span><span id="line-158"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679211495"><span id="local-6989586621679211497"><span id="local-6989586621679211499"><span id="local-6989586621679211501"><span id="local-6989586621679211503"><span id="local-6989586621679211505"><span id="local-6989586621679211534"><span id="local-6989586621679211536"><span id="local-6989586621679211538"><span id="local-6989586621679211541"><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="STM"><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">STM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-type">WrapSTM</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="TVar"><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">TVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">TVar</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679211493"><span class="annot"><span class="annottext">atomically :: STM (NoLoggingT (ResourceT IO)) a -&gt; NoLoggingT (ResourceT IO) a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">atomically</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; NoLoggingT (ResourceT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; NoLoggingT (ResourceT IO) a)
-&gt; (WrapSTM a -&gt; IO a) -&gt; WrapSTM a -&gt; NoLoggingT (ResourceT IO) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">STM a -&gt; IO a
forall a. STM a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM a -&gt; IO a) -&gt; (WrapSTM a -&gt; STM a) -&gt; WrapSTM a -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WrapSTM a -&gt; STM a
forall a. WrapSTM a -&gt; STM a
</span><a href="Demo.Database.html#unWrapSTM"><span class="hs-identifier hs-var hs-var">unWrapSTM</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679211488"><span class="annot"><span class="annottext">newTVar :: a
-&gt; STM
     (NoLoggingT (ResourceT IO)) (TVar (NoLoggingT (ResourceT IO)) a)
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (TVar a) -&gt; WrapSTM (TVar a)
forall a. STM a -&gt; WrapSTM a
</span><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-var">WrapSTM</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (TVar a) -&gt; WrapSTM (TVar a))
-&gt; (a -&gt; STM (TVar a)) -&gt; a -&gt; WrapSTM (TVar a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; STM (TVar a)
forall a. a -&gt; STM (TVar a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.newTVar</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679211484"><span class="annot"><span class="annottext">readTVar :: TVar (NoLoggingT (ResourceT IO)) a
-&gt; STM (NoLoggingT (ResourceT IO)) a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">readTVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM a -&gt; WrapSTM a
forall a. STM a -&gt; WrapSTM a
</span><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-var">WrapSTM</span></a></span><span> </span><span class="annot"><span class="annottext">(STM a -&gt; WrapSTM a) -&gt; (TVar a -&gt; STM a) -&gt; TVar a -&gt; WrapSTM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TVar a -&gt; STM a
forall a. TVar a -&gt; STM a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.readTVar</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621679211481"><span class="annot"><span class="annottext">writeTVar :: TVar (NoLoggingT (ResourceT IO)) a
-&gt; a -&gt; STM (NoLoggingT (ResourceT IO)) ()
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">writeTVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679211479"><span class="annot"><span class="annottext">TVar (NoLoggingT (ResourceT IO)) a
</span><a href="#local-6989586621679211479"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; WrapSTM ()
forall a. STM a -&gt; WrapSTM a
</span><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-var">WrapSTM</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; WrapSTM ()) -&gt; (a -&gt; STM ()) -&gt; a -&gt; WrapSTM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TVar a -&gt; a -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.writeTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar a
TVar (NoLoggingT (ResourceT IO)) a
</span><a href="#local-6989586621679211479"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621679211477"><span class="annot"><span class="annottext">modifyTVar' :: TVar (NoLoggingT (ResourceT IO)) a
-&gt; (a -&gt; a) -&gt; STM (NoLoggingT (ResourceT IO)) ()
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">modifyTVar'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679211475"><span class="annot"><span class="annottext">TVar (NoLoggingT (ResourceT IO)) a
</span><a href="#local-6989586621679211475"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; WrapSTM ()
forall a. STM a -&gt; WrapSTM a
</span><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-var">WrapSTM</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; WrapSTM ())
-&gt; ((a -&gt; a) -&gt; STM ()) -&gt; (a -&gt; a) -&gt; WrapSTM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TVar a -&gt; (a -&gt; a) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="../../../../stm/html/src"><span class="hs-identifier hs-var">STM.modifyTVar'</span></a></span><span> </span><span class="annot"><span class="annottext">TVar a
TVar (NoLoggingT (ResourceT IO)) a
</span><a href="#local-6989586621679211475"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Helper type for the above instance.</span><span>
</span><span id="line-168"></span><span class="hs-keyword">newtype</span><span> </span><span id="WrapSTM"><span class="annot"><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-var">WrapSTM</span></a></span></span><span> </span><span id="local-6989586621679212049"><span class="annot"><a href="#local-6989586621679212049"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WrapSTM"><span class="annot"><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-var">WrapSTM</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unWrapSTM"><span class="annot"><span class="annottext">WrapSTM a -&gt; STM a
</span><a href="Demo.Database.html#unWrapSTM"><span class="hs-identifier hs-var hs-var">unWrapSTM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM.STM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212049"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211463"><span id="local-6989586621679211465"><span id="local-6989586621679211467"><span id="local-6989586621679211469"><span id="local-6989586621679211471"><span class="annot"><span class="annottext">Functor WrapSTM
a -&gt; WrapSTM a
Functor WrapSTM
-&gt; (forall a. a -&gt; WrapSTM a)
-&gt; (forall a b. WrapSTM (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM c)
-&gt; (forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b)
-&gt; (forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM a)
-&gt; Applicative WrapSTM
WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM a
WrapSTM (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
(a -&gt; b -&gt; c) -&gt; WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM c
forall a. a -&gt; WrapSTM a
forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM a
forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
forall a b. WrapSTM (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
forall a b c. (a -&gt; b -&gt; c) -&gt; WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM a
$c&lt;* :: forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM a
*&gt; :: WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
$c*&gt; :: forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
liftA2 :: (a -&gt; b -&gt; c) -&gt; WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM c
&lt;*&gt; :: WrapSTM (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
$c&lt;*&gt; :: forall a b. WrapSTM (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
pure :: a -&gt; WrapSTM a
$cpure :: forall a. a -&gt; WrapSTM a
$cp1Applicative :: Functor WrapSTM
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211458"><span id="local-6989586621679211460"><span class="annot"><span class="annottext">a -&gt; WrapSTM b -&gt; WrapSTM a
(a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
(forall a b. (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b)
-&gt; (forall a b. a -&gt; WrapSTM b -&gt; WrapSTM a) -&gt; Functor WrapSTM
forall a b. a -&gt; WrapSTM b -&gt; WrapSTM a
forall a b. (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; WrapSTM b -&gt; WrapSTM a
$c&lt;$ :: forall a b. a -&gt; WrapSTM b -&gt; WrapSTM a
fmap :: (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
$cfmap :: forall a b. (a -&gt; b) -&gt; WrapSTM a -&gt; WrapSTM b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211450"><span id="local-6989586621679211452"><span id="local-6989586621679211454"><span class="annot"><span class="annottext">Applicative WrapSTM
a -&gt; WrapSTM a
Applicative WrapSTM
-&gt; (forall a b. WrapSTM a -&gt; (a -&gt; WrapSTM b) -&gt; WrapSTM b)
-&gt; (forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b)
-&gt; (forall a. a -&gt; WrapSTM a)
-&gt; Monad WrapSTM
WrapSTM a -&gt; (a -&gt; WrapSTM b) -&gt; WrapSTM b
WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
forall a. a -&gt; WrapSTM a
forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
forall a b. WrapSTM a -&gt; (a -&gt; WrapSTM b) -&gt; WrapSTM b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; WrapSTM a
$creturn :: forall a. a -&gt; WrapSTM a
&gt;&gt; :: WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
$c&gt;&gt; :: forall a b. WrapSTM a -&gt; WrapSTM b -&gt; WrapSTM b
&gt;&gt;= :: WrapSTM a -&gt; (a -&gt; WrapSTM b) -&gt; WrapSTM b
$c&gt;&gt;= :: forall a b. WrapSTM a -&gt; (a -&gt; WrapSTM b) -&gt; WrapSTM b
$cp1Monad :: Applicative WrapSTM
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span id="local-6989586621679211443"><span id="local-6989586621679211445"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadPlus</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-type">WrapSTM</span></a></span></span></span><span>
</span><span id="line-172"></span><span id="local-6989586621679211433"><span id="local-6989586621679211435"><span id="local-6989586621679211437"><span id="local-6989586621679211439"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Alternative</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#WrapSTM"><span class="hs-identifier hs-type">WrapSTM</span></a></span></span></span></span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- &quot;Exceptional monads&quot; instances for the 'SqlPersistM' monad.</span><span>
</span><span id="line-175"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadEvaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621679211428"><span class="annot"><span class="annottext">evaluate :: a -&gt; NoLoggingT (ResourceT IO) a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">evaluate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; NoLoggingT (ResourceT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; NoLoggingT (ResourceT IO) a)
-&gt; (a -&gt; IO a) -&gt; a -&gt; NoLoggingT (ResourceT IO) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. MonadEvaluate m =&gt; a -&gt; m a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">evaluate</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679211419"><span id="local-6989586621679211421"><span id="local-6989586621679211423"><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621679211417"><span class="annot"><span class="annottext">throwIO :: e -&gt; NoLoggingT (ResourceT IO) a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">throwIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; NoLoggingT (ResourceT IO) a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">ResourceT.throwM</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679211399"><span id="local-6989586621679211401"><span id="local-6989586621679211403"><span id="local-6989586621679211405"><span id="local-6989586621679211407"><span id="local-6989586621679211409"><span id="local-6989586621679211411"><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadCatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679211396"><span class="annot"><span class="annottext">catch :: NoLoggingT (ResourceT IO) a
-&gt; (e -&gt; NoLoggingT (ResourceT IO) a)
-&gt; NoLoggingT (ResourceT IO) a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">catch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoLoggingT (ResourceT IO) a
-&gt; (e -&gt; NoLoggingT (ResourceT IO) a)
-&gt; NoLoggingT (ResourceT IO) a
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">ResourceT.catch</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679211393"><span class="annot"><span class="annottext">generalBracket :: NoLoggingT (ResourceT IO) a
-&gt; (a -&gt; ExitCase b -&gt; NoLoggingT (ResourceT IO) c)
-&gt; (a -&gt; NoLoggingT (ResourceT IO) b)
-&gt; NoLoggingT (ResourceT IO) (b, c)
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">generalBracket</span></a></span></span><span> </span><span id="local-6989586621679211391"><span class="annot"><span class="annottext">NoLoggingT (ResourceT IO) a
</span><a href="#local-6989586621679211391"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679211390"><span class="annot"><span class="annottext">a -&gt; ExitCase b -&gt; NoLoggingT (ResourceT IO) c
</span><a href="#local-6989586621679211390"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span id="local-6989586621679211389"><span class="annot"><span class="annottext">a -&gt; NoLoggingT (ResourceT IO) b
</span><a href="#local-6989586621679211389"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">NoLoggingT (ResourceT IO) a
-&gt; (a -&gt; ExitCase b -&gt; NoLoggingT (ResourceT IO) c)
-&gt; (a -&gt; NoLoggingT (ResourceT IO) b)
-&gt; NoLoggingT (ResourceT IO) (b, c)
forall (m :: * -&gt; *) a b c.
MonadMask m =&gt;
m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c)
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">ResourceT.generalBracket</span></a></span><span> </span><span class="annot"><span class="annottext">NoLoggingT (ResourceT IO) a
</span><a href="#local-6989586621679211391"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679211387"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211387"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; ExitCase b -&gt; NoLoggingT (ResourceT IO) c
</span><a href="#local-6989586621679211390"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211387"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(ExitCase b -&gt; NoLoggingT (ResourceT IO) c)
-&gt; (ExitCase b -&gt; ExitCase b)
-&gt; ExitCase b
-&gt; NoLoggingT (ResourceT IO) c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCase b -&gt; ExitCase b
forall a. ExitCase a -&gt; ExitCase a
</span><a href="#local-6989586621679211386"><span class="hs-identifier hs-var">contra</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; NoLoggingT (ResourceT IO) b
</span><a href="#local-6989586621679211389"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-186"></span><span>        </span><span id="local-6989586621679211386"><span class="annot"><span class="annottext">contra :: ExitCase a -&gt; ExitCase a
</span><a href="#local-6989586621679211386"><span class="hs-identifier hs-var hs-var">contra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-type">ResourceT.ExitCaseSuccess</span></a></span><span> </span><span id="local-6989586621679211384"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211384"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ExitCase a
forall a. a -&gt; ExitCase a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">ExitCaseSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211384"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><a href="#local-6989586621679211386"><span class="hs-identifier hs-var">contra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-type">ResourceT.ExitCaseException</span></a></span><span> </span><span id="local-6989586621679211381"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679211381"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; ExitCase a
forall a. SomeException -&gt; ExitCase a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">ExitCaseException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679211381"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="annot"><a href="#local-6989586621679211386"><span class="hs-identifier hs-var">contra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCase a
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">ResourceT.ExitCaseAbort</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExitCase a
forall a. ExitCase a
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var">ExitCaseAbort</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679211371"><span id="local-6989586621679211373"><span class="annot"><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-type">MonadMask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-logger/html/src"><span class="hs-identifier hs-type">NoLoggingT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621679211369"><span class="annot"><span class="annottext">mask :: ((forall a.
  NoLoggingT (ResourceT IO) a -&gt; NoLoggingT (ResourceT IO) a)
 -&gt; NoLoggingT (ResourceT IO) b)
-&gt; NoLoggingT (ResourceT IO) b
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((forall a.
  NoLoggingT (ResourceT IO) a -&gt; NoLoggingT (ResourceT IO) a)
 -&gt; NoLoggingT (ResourceT IO) b)
-&gt; NoLoggingT (ResourceT IO) b
forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">ResourceT.mask</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679211366"><span class="annot"><span class="annottext">uninterruptibleMask :: ((forall a.
  NoLoggingT (ResourceT IO) a -&gt; NoLoggingT (ResourceT IO) a)
 -&gt; NoLoggingT (ResourceT IO) b)
-&gt; NoLoggingT (ResourceT IO) b
</span><a href="../../../../io-classes/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">uninterruptibleMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((forall a.
  NoLoggingT (ResourceT IO) a -&gt; NoLoggingT (ResourceT IO) a)
 -&gt; NoLoggingT (ResourceT IO) b)
-&gt; NoLoggingT (ResourceT IO) b
forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">ResourceT.uninterruptibleMask</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Demo.Database.html#newStoreAddressSql"><span class="hs-identifier hs-type">newStoreAddressSql</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../persistent/html/src"><span class="hs-identifier hs-type">SqlPersistM</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#StoreAddress"><span class="hs-identifier hs-type">StoreAddress</span></a></span><span>
</span><span id="line-196"></span><span id="newStoreAddressSql"><span class="annot"><span class="annottext">newStoreAddressSql :: SqlPersistM StoreAddress
</span><a href="Demo.Database.html#newStoreAddressSql"><span class="hs-identifier hs-var hs-var">newStoreAddressSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">Query () -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall (m :: * -&gt; *). MonadIO m =&gt; Query () -&gt; SqlPersistT m ()
</span><a href="Database.Schema.html#runSql"><span class="hs-identifier hs-var">Sql.runSql</span></a></span><span> </span><span class="annot"><span class="annottext">(Query () -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; Query () -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy (AddressRow :. Col &quot;id&quot; Primary) -&gt; Query ()
forall row. IsRow row =&gt; Proxy row -&gt; Query ()
</span><a href="Database.Schema.html#createTable"><span class="hs-identifier hs-var">Sql.createTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (AddressRow :. Col &quot;id&quot; Primary)
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Demo.Database.html#AddressRow"><span class="hs-identifier hs-type">AddressRow</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="annot"><a href="Database.Schema.html#Primary"><span class="hs-identifier hs-type">Primary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Embedding
  (DeltaChain Word32 [AddressInPool]) [DeltaDB Int AddressRow]
-&gt; Store SqlPersistM [DeltaDB Int AddressRow]
-&gt; SqlPersistM StoreAddress
forall (m :: * -&gt; *) da db.
(MonadSTM m, MonadMask m, Delta da) =&gt;
Embedding da db -&gt; Store m db -&gt; m (Store m da)
</span><a href="Data.DBVar.html#embedStore"><span class="hs-identifier hs-var">embedStore</span></a></span><span> </span><span class="annot"><span class="annottext">Embedding
  (DeltaChain Word32 [AddressInPool]) [DeltaDB Int AddressRow]
</span><a href="#local-6989586621679211359"><span class="hs-identifier hs-var">embed</span></a></span><span> </span><span class="annot"><span class="annottext">(Store SqlPersistM [DeltaDB Int AddressRow]
 -&gt; SqlPersistM StoreAddress)
-&gt; SqlPersistM (Store SqlPersistM [DeltaDB Int AddressRow])
-&gt; SqlPersistM StoreAddress
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">SqlPersistM (Store SqlPersistM [DeltaDB Int AddressRow])
forall (m :: * -&gt; *) row.
(MonadIO m, IsRow row, IsRow (row :. Col &quot;id&quot; Primary),
 Show row) =&gt;
m (Store SqlPersistM [DeltaDB Int row])
</span><a href="Database.Persist.Delta.html#newSqlStore"><span class="hs-identifier hs-var">newSqlStore</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679211359"><span class="annot"><span class="annottext">embed :: Embedding
  (DeltaChain Word32 [AddressInPool]) [DeltaDB Int AddressRow]
</span><a href="#local-6989586621679211359"><span class="hs-identifier hs-var hs-var">embed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Iso' (Edge Word32 AddressInPool) AddressRow
-&gt; Embedding
     [DeltaDB Int (Edge Word32 AddressInPool)] [DeltaDB Int AddressRow]
forall a b. Iso' a b -&gt; Embedding [DeltaDB Int a] [DeltaDB Int b]
</span><a href="Demo.Database.html#embedIso"><span class="hs-identifier hs-var">embedIso</span></a></span><span> </span><span class="annot"><span class="annottext">Iso' (Edge Word32 AddressInPool) AddressRow
</span><a href="Demo.Database.html#addressSqlIso"><span class="hs-identifier hs-var">addressSqlIso</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Embedding
  [DeltaDB Int (Edge Word32 AddressInPool)] [DeltaDB Int AddressRow]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaDB Int (Edge Word32 AddressInPool)]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool]) [DeltaDB Int AddressRow]
forall k (c :: k -&gt; k -&gt; *) (j :: k) (k1 :: k) (i :: k).
Semigroupoid c =&gt;
c j k1 -&gt; c i j -&gt; c i k1
</span><a href="../../../../semigroupoids/html/src"><span class="hs-operator hs-var">`o`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Embedding
  [DeltaTable (Edge Word32 AddressInPool)]
  [DeltaDB Int (Edge Word32 AddressInPool)]
forall row. Embedding [DeltaTable row] [DeltaDB Int row]
</span><a href="Data.Table.html#tableIntoDatabase"><span class="hs-identifier hs-var">tableIntoDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">Embedding
  [DeltaTable (Edge Word32 AddressInPool)]
  [DeltaDB Int (Edge Word32 AddressInPool)]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaTable (Edge Word32 AddressInPool)]
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaDB Int (Edge Word32 AddressInPool)]
forall k (c :: k -&gt; k -&gt; *) (j :: k) (k1 :: k) (i :: k).
Semigroupoid c =&gt;
c j k1 -&gt; c i j -&gt; c i k1
</span><a href="../../../../semigroupoids/html/src"><span class="hs-operator hs-var">`o`</span></a></span><span> </span><span class="annot"><span class="annottext">([AddressInPool] -&gt; Pile AddressInPool)
-&gt; (Pile AddressInPool -&gt; [AddressInPool])
-&gt; Embedding
     (DeltaChain Word32 [AddressInPool])
     [DeltaTable (Edge Word32 AddressInPool)]
forall node edge e.
(Ord node, Semigroup edge) =&gt;
(edge -&gt; Pile e)
-&gt; (Pile e -&gt; edge)
-&gt; Embedding (DeltaChain node edge) [DeltaTable (Edge node e)]
</span><a href="Data.Chain.html#chainIntoTable"><span class="hs-identifier hs-var">chainIntoTable</span></a></span><span> </span><span class="annot"><span class="annottext">[AddressInPool] -&gt; Pile AddressInPool
forall a. [a] -&gt; Pile a
</span><a href="Data.Table.html#Pile"><span class="hs-identifier hs-var">Pile</span></a></span><span> </span><span class="annot"><span class="annottext">Pile AddressInPool -&gt; [AddressInPool]
forall a. Pile a -&gt; [a]
</span><a href="Data.Table.html#getPile"><span class="hs-identifier hs-var hs-var">getPile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="annot"><a href="Demo.Database.html#addressSqlIso"><span class="hs-identifier hs-type">addressSqlIso</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-type">Iso'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Demo.Database.html#AddressRow"><span class="hs-identifier hs-type">AddressRow</span></a></span><span>
</span><span id="line-204"></span><span id="addressSqlIso"><span class="annot"><span class="annottext">addressSqlIso :: p AddressRow (f AddressRow)
-&gt; p (Edge Word32 AddressInPool) (f (Edge Word32 AddressInPool))
</span><a href="Demo.Database.html#addressSqlIso"><span class="hs-identifier hs-var hs-var">addressSqlIso</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Edge Word32 AddressInPool -&gt; AddressRow)
-&gt; (AddressRow -&gt; Edge Word32 AddressInPool)
-&gt; Iso' (Edge Word32 AddressInPool) AddressRow
forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">iso</span></a></span><span> </span><span class="annot"><span class="annottext">Edge Word32 AddressInPool -&gt; AddressRow
forall a a (name :: Symbol) (name :: Symbol) (name :: Symbol)
       (name :: Symbol) (name :: Symbol) (name :: Symbol).
Num a =&gt;
Edge a AddressInPool
-&gt; ((((Table name :. Col name a) :. Col name a) :. Col name a)
    :. Col name Address)
   :. Col name Word32
</span><a href="#local-6989586621679211357"><span class="hs-identifier hs-var">ab</span></a></span><span> </span><span class="annot"><span class="annottext">AddressRow -&gt; Edge Word32 AddressInPool
forall (name :: Symbol) (name :: Symbol) node (name :: Symbol)
       (name :: Symbol) a (name :: Symbol) (name :: Symbol).
(((((Table name :. Col name node) :. Col name node) :. Col name a)
  :. Col name Address)
 :. Col name Word32)
-&gt; Edge node AddressInPool
</span><a href="#local-6989586621679211356"><span class="hs-identifier hs-var">ba</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679211357"><span class="annot"><span class="annottext">ab :: Edge a AddressInPool
-&gt; ((((Table name :. Col name a) :. Col name a) :. Col name a)
    :. Col name Address)
   :. Col name Word32
</span><a href="#local-6989586621679211357"><span class="hs-identifier hs-var hs-var">ab</span></a></span></span><span> </span><span class="annot"><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span class="hs-special">{</span><span id="local-6989586621679211355"><span class="annot"><span class="annottext">a
from :: a
from :: forall node edge. Edge node edge -&gt; node
</span><a href="#local-6989586621679211355"><span class="hs-identifier hs-var hs-var">from</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679211354"><span class="annot"><span class="annottext">a
to :: a
to :: forall node edge. Edge node edge -&gt; node
</span><a href="#local-6989586621679211354"><span class="hs-identifier hs-var hs-var">to</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">via :: forall node edge. Edge node edge -&gt; edge
</span><a href="Data.Chain.html#via"><span class="hs-keyword hs-var">via</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">{</span><span id="local-6989586621679211353"><span class="annot"><span class="annottext">Address
address :: Address
address :: AddressInPool -&gt; Address
</span><a href="#local-6989586621679211353"><span class="hs-identifier hs-var hs-var">address</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679211352"><span class="annot"><span class="annottext">Word32
index :: Word32
index :: AddressInPool -&gt; Word32
</span><a href="#local-6989586621679211352"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">Table name
forall (name :: Symbol). Table name
</span><a href="Database.Schema.html#Table"><span class="hs-identifier hs-var">Table</span></a></span><span> </span><span class="annot"><span class="annottext">Table name -&gt; Col name a -&gt; Table name :. Col name a
forall a b. a -&gt; b -&gt; a :. b
</span><a href="Database.Schema.html#%3A."><span class="hs-operator hs-var">:.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Col name a
forall (name :: Symbol) a. a -&gt; Col name a
</span><a href="Database.Schema.html#Col"><span class="hs-identifier hs-var">Col</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211355"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">(Table name :. Col name a)
-&gt; Col name a -&gt; (Table name :. Col name a) :. Col name a
forall a b. a -&gt; b -&gt; a :. b
</span><a href="Database.Schema.html#%3A."><span class="hs-operator hs-var">:.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Col name a
forall (name :: Symbol) a. a -&gt; Col name a
</span><a href="Database.Schema.html#Col"><span class="hs-identifier hs-var">Col</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211354"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">((Table name :. Col name a) :. Col name a)
-&gt; Col name a
-&gt; ((Table name :. Col name a) :. Col name a) :. Col name a
forall a b. a -&gt; b -&gt; a :. b
</span><a href="Database.Schema.html#%3A."><span class="hs-operator hs-var">:.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Col name a
forall (name :: Symbol) a. a -&gt; Col name a
</span><a href="Database.Schema.html#Col"><span class="hs-identifier hs-var">Col</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(((Table name :. Col name a) :. Col name a) :. Col name a)
-&gt; Col name Address
-&gt; (((Table name :. Col name a) :. Col name a) :. Col name a)
   :. Col name Address
forall a b. a -&gt; b -&gt; a :. b
</span><a href="Database.Schema.html#%3A."><span class="hs-operator hs-var">:.</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Col name Address
forall (name :: Symbol) a. a -&gt; Col name a
</span><a href="Database.Schema.html#Col"><span class="hs-identifier hs-var">Col</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679211353"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="annot"><span class="annottext">((((Table name :. Col name a) :. Col name a) :. Col name a)
 :. Col name Address)
-&gt; Col name Word32
-&gt; ((((Table name :. Col name a) :. Col name a) :. Col name a)
    :. Col name Address)
   :. Col name Word32
forall a b. a -&gt; b -&gt; a :. b
</span><a href="Database.Schema.html#%3A."><span class="hs-operator hs-var">:.</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Col name Word32
forall (name :: Symbol) a. a -&gt; Col name a
</span><a href="Database.Schema.html#Col"><span class="hs-identifier hs-var">Col</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211352"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679211356"><span class="annot"><span class="annottext">ba :: (((((Table name :. Col name node) :. Col name node) :. Col name a)
  :. Col name Address)
 :. Col name Word32)
-&gt; Edge node AddressInPool
</span><a href="#local-6989586621679211356"><span class="hs-identifier hs-var hs-var">ba</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Table name
</span><a href="Database.Schema.html#Table"><span class="hs-identifier hs-var">Table</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span id="local-6989586621679211348"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621679211348"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span id="local-6989586621679211347"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621679211347"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span id="local-6989586621679211346"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679211346"><span class="hs-identifier hs-var">address</span></a></span></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span id="local-6989586621679211345"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679211345"><span class="hs-identifier hs-var">index</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="annottext">Edge :: forall node edge. node -&gt; node -&gt; edge -&gt; Edge node edge
</span><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">node
from :: node
from :: node
</span><a href="#local-6989586621679211348"><span class="hs-identifier hs-var hs-var">from</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">node
to :: node
to :: node
</span><a href="#local-6989586621679211347"><span class="hs-identifier hs-var hs-var">to</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">via :: AddressInPool
</span><a href="Data.Chain.html#via"><span class="hs-keyword hs-var">via</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">AddressInPool :: Address -&gt; Word32 -&gt; AddressInPool
</span><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-type">AddressInPool</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Address
address :: Address
address :: Address
</span><a href="#local-6989586621679211346"><span class="hs-identifier hs-var hs-var">address</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word32
index :: Word32
index :: Word32
</span><a href="#local-6989586621679211345"><span class="hs-identifier hs-var hs-var">index</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-keyword">type</span><span> </span><span id="AddressRow"><span class="annot"><a href="Demo.Database.html#AddressRow"><span class="hs-identifier hs-var">AddressRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Database.Schema.html#Table"><span class="hs-identifier hs-type">Table</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;addresses&quot;</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;from&quot;</span></span><span> </span><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;to&quot;</span></span><span> </span><span class="annot"><a href="Demo.Database.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wallet_id&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;address&quot;</span></span><span> </span><span class="annot"><a href="Demo.Database.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#%3A."><span class="hs-operator hs-type">:.</span></a></span><span> </span><span class="annot"><a href="Database.Schema.html#Col"><span class="hs-identifier hs-type">Col</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;address_ix&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">{-------------------------------------------------------------------------------
    Database connection
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-219"></span><span class="annot"><a href="Demo.Database.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span id="main"><span class="annot"><span class="annottext">main :: IO ()
</span><a href="Demo.Database.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) () -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Address -&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a -&gt; m a
</span><a href="../../../../persistent-sqlite/html/src"><span class="hs-identifier hs-var">Persist.runSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><span class="hs-string">&quot;:memory:&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SqlPersistT (NoLoggingT (ResourceT IO)) () -&gt; IO ())
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">Migration -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Migration -&gt; ReaderT SqlBackend m ()
</span><a href="../../../../persistent/html/src"><span class="hs-identifier hs-var">Persist.runMigration</span></a></span><span> </span><span class="annot"><span class="annottext">Migration
</span><a href="Demo.Database.html#migrateAll"><span class="hs-identifier hs-var">migrateAll</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679211341"><span class="annot"><span class="annottext">StoreAddress
</span><a href="#local-6989586621679211341"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SqlPersistM StoreAddress
</span><a href="Demo.Database.html#newStoreAddressSql"><span class="hs-identifier hs-var">newStoreAddressSql</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679211340"><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
</span><a href="#local-6989586621679211340"><span class="hs-identifier hs-var">db</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StoreAddress
-&gt; Chain Word32 [AddressInPool]
-&gt; SqlPersistM
     (DBVar SqlPersistM (DeltaChain Word32 [AddressInPool]))
forall (m :: * -&gt; *) da a.
(MonadSTM m, MonadThrow m, MonadEvaluate m, MonadMask m, Delta da,
 a ~ Base da) =&gt;
Store m da -&gt; a -&gt; m (DBVar m da)
</span><a href="Data.DBVar.html#initDBVar"><span class="hs-identifier hs-var">initDBVar</span></a></span><span> </span><span class="annot"><span class="annottext">StoreAddress
</span><a href="#local-6989586621679211341"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="annottext">(Chain Word32 [AddressInPool]
 -&gt; SqlPersistM
      (DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])))
-&gt; Chain Word32 [AddressInPool]
-&gt; SqlPersistM
     (DBVar SqlPersistM (DeltaChain Word32 [AddressInPool]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Edge Word32 [AddressInPool] -&gt; Chain Word32 [AddressInPool]
forall node edge. Ord node =&gt; Edge node edge -&gt; Chain node edge
</span><a href="Data.Chain.html#fromEdge"><span class="hs-identifier hs-var">Chain.fromEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Edge :: forall node edge. node -&gt; node -&gt; edge -&gt; Edge node edge
</span><a href="Data.Chain.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">from :: Word32
</span><a href="Data.Chain.html#from"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">to :: Word32
</span><a href="Data.Chain.html#to"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">via :: [AddressInPool]
</span><a href="Data.Chain.html#via"><span class="hs-keyword hs-var">via</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Address -&gt; Word32 -&gt; AddressInPool
</span><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-var">AddressInPool</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><span class="hs-string">&quot;a&quot;</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">31</span></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall da (m :: * -&gt; *).
(Delta da, Monad m) =&gt;
DBVar m da -&gt; da -&gt; m ()
</span><a href="Data.DBVar.html#updateDBVar"><span class="hs-identifier hs-var">updateDBVar</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
</span><a href="#local-6989586621679211340"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaChain Word32 [AddressInPool]
 -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; [AddressInPool] -&gt; DeltaChain Word32 [AddressInPool]
forall node edge. node -&gt; edge -&gt; DeltaChain node edge
</span><a href="Data.Chain.html#AppendTip"><span class="hs-identifier hs-var">Chain.AppendTip</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Address -&gt; Word32 -&gt; AddressInPool
</span><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-var">AddressInPool</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><span class="hs-string">&quot;b&quot;</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">32</span></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall da (m :: * -&gt; *).
(Delta da, Monad m) =&gt;
DBVar m da -&gt; da -&gt; m ()
</span><a href="Data.DBVar.html#updateDBVar"><span class="hs-identifier hs-var">updateDBVar</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
</span><a href="#local-6989586621679211340"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaChain Word32 [AddressInPool]
 -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; [AddressInPool] -&gt; DeltaChain Word32 [AddressInPool]
forall node edge. node -&gt; edge -&gt; DeltaChain node edge
</span><a href="Data.Chain.html#AppendTip"><span class="hs-identifier hs-var">Chain.AppendTip</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Address -&gt; Word32 -&gt; AddressInPool
</span><a href="Demo.Database.html#AddressInPool"><span class="hs-identifier hs-var">AddressInPool</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><span class="hs-string">&quot;c&quot;</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">33</span></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall da (m :: * -&gt; *).
(Delta da, Monad m) =&gt;
DBVar m da -&gt; da -&gt; m ()
</span><a href="Data.DBVar.html#updateDBVar"><span class="hs-identifier hs-var">updateDBVar</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
</span><a href="#local-6989586621679211340"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaChain Word32 [AddressInPool]
 -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DeltaChain Word32 [AddressInPool]
forall node edge. node -&gt; DeltaChain node edge
</span><a href="Data.Chain.html#CollapseNode"><span class="hs-identifier hs-var">Chain.CollapseNode</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall da (m :: * -&gt; *).
(Delta da, Monad m) =&gt;
DBVar m da -&gt; da -&gt; m ()
</span><a href="Data.DBVar.html#updateDBVar"><span class="hs-identifier hs-var">updateDBVar</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
</span><a href="#local-6989586621679211340"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">(DeltaChain Word32 [AddressInPool]
 -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; DeltaChain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; DeltaChain Word32 [AddressInPool]
forall node edge. node -&gt; DeltaChain node edge
</span><a href="Data.Chain.html#CollapseNode"><span class="hs-identifier hs-var">Chain.CollapseNode</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">Chain Word32 [AddressInPool]
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall (m :: * -&gt; *) a. (MonadIO m, Show a) =&gt; a -&gt; m ()
</span><a href="../../../../say/html/src"><span class="hs-identifier hs-var">sayShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Chain Word32 [AddressInPool]
 -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; SqlPersistM (Chain Word32 [AddressInPool])
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
-&gt; SqlPersistM (Chain Word32 [AddressInPool])
forall da a (m :: * -&gt; *).
(Delta da, a ~ Base da) =&gt;
DBVar m da -&gt; m a
</span><a href="Data.DBVar.html#readDBVar"><span class="hs-identifier hs-var">readDBVar</span></a></span><span> </span><span class="annot"><span class="annottext">DBVar SqlPersistM (DeltaChain Word32 [AddressInPool])
</span><a href="#local-6989586621679211340"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="annottext">Either SomeException (Chain Word32 [AddressInPool])
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall (m :: * -&gt; *) a. (MonadIO m, Show a) =&gt; a -&gt; m ()
</span><a href="../../../../say/html/src"><span class="hs-identifier hs-var">sayShow</span></a></span><span> </span><span class="annot"><span class="annottext">(Either SomeException (Chain Word32 [AddressInPool])
 -&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ())
-&gt; SqlPersistM
     (Either SomeException (Chain Word32 [AddressInPool]))
-&gt; SqlPersistT (NoLoggingT (ResourceT IO)) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">StoreAddress
-&gt; SqlPersistM
     (Either SomeException (Base (DeltaChain Word32 [AddressInPool])))
forall (m :: * -&gt; *) da.
Store m da -&gt; m (Either SomeException (Base da))
</span><a href="Data.DBVar.html#loadS"><span class="hs-identifier hs-var hs-var">loadS</span></a></span><span> </span><span class="annot"><span class="annottext">StoreAddress
</span><a href="#local-6989586621679211341"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-234"></span></pre></body></html>