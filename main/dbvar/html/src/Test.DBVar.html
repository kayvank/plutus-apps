<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.DBVar</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.DBVar.html#genUpdates"><span class="hs-identifier">genUpdates</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.DBVar.html#prop_StoreUpdates"><span class="hs-identifier">prop_StoreUpdates</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.DBVar.html#GenDelta"><span class="hs-identifier">GenDelta</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier">Updates</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../safe-exceptions/html/src"><span class="hs-identifier">Control.Exception.Safe</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../safe-exceptions/html/src"><span class="hs-identifier">impureThrow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM_</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.DBVar.html"><span class="hs-identifier">Data.DBVar</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.DBVar.html#Store"><span class="hs-identifier">Store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.DBVar.html#loadS"><span class="hs-identifier">loadS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.DBVar.html#updateS"><span class="hs-identifier">updateS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.DBVar.html#writeS"><span class="hs-identifier">writeS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Delta.html"><span class="hs-identifier">Data.Delta</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Delta.html#Delta"><span class="hs-identifier">Delta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">Fmt</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier">Buildable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">listF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../fmt/html/src"><span class="hs-identifier">pretty</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">Test.QuickCheck</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">Blind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">Blind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">Gen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">counterexample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">sized</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">Test.QuickCheck.Monadic</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">PropertyM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">assert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">monitor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier">pick</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">-- | Given a value, generate a random delta starting from this value.</span><span>
</span><span id="line-29"></span><span class="hs-keyword">type</span><span> </span><span id="GenDelta"><span class="annot"><a href="Test.DBVar.html#GenDelta"><span class="hs-identifier hs-var">GenDelta</span></a></span></span><span> </span><span id="local-6989586621679212308"><span class="annot"><a href="#local-6989586621679212308"><span class="hs-identifier hs-type">da</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Delta.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212308"><span class="hs-identifier hs-type">da</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">Gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212308"><span class="hs-identifier hs-type">da</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | A sequence of updates and values after updating.</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- The update that is applied *last* appears in the list *first*.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">newtype</span><span> </span><span id="Updates"><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-var">Updates</span></a></span></span><span> </span><span id="local-6989586621679212372"><span class="annot"><a href="#local-6989586621679212372"><span class="hs-identifier hs-type">da</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Updates"><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-var">Updates</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Data.Delta.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212372"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679212372"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span id="local-6989586621679212306"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679212301"><span id="local-6989586621679212304"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212306"><span class="hs-identifier hs-type">da</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-type">Updates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212306"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>    </span><span id="local-6989586621679212299"><span class="annot"><span class="annottext">show :: Updates da -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-type">Updates</span></a></span><span> </span><span id="local-6989586621679212297"><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212297"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[da] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">([da] -&gt; String)
-&gt; ([(Base da, da)] -&gt; [da]) -&gt; [(Base da, da)] -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Base da, da) -&gt; da) -&gt; [(Base da, da)] -&gt; [da]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Base da, da) -&gt; da
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(Base da, da)] -&gt; String) -&gt; [(Base da, da)] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212297"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | Randomly generate a sequence of updates</span><span>
</span><span id="line-39"></span><span id="local-6989586621679212356"><span class="annot"><a href="Test.DBVar.html#genUpdates"><span class="hs-identifier hs-type">genUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Delta.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212356"><span class="hs-identifier hs-type">da</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">Gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Delta.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212356"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.DBVar.html#GenDelta"><span class="hs-identifier hs-type">GenDelta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212356"><span class="hs-identifier hs-type">da</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">Gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-type">Updates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212356"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-40"></span><span id="genUpdates"><span class="annot"><span class="annottext">genUpdates :: Gen (Base da) -&gt; GenDelta da -&gt; Gen (Updates da)
</span><a href="Test.DBVar.html#genUpdates"><span class="hs-identifier hs-var hs-var">genUpdates</span></a></span></span><span> </span><span id="local-6989586621679212295"><span class="annot"><span class="annottext">Gen (Base da)
</span><a href="#local-6989586621679212295"><span class="hs-identifier hs-var">gen0</span></a></span></span><span> </span><span id="local-6989586621679212294"><span class="annot"><span class="annottext">GenDelta da
</span><a href="#local-6989586621679212294"><span class="hs-identifier hs-var">more</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Gen (Updates da)) -&gt; Gen (Updates da)
forall a. (Int -&gt; Gen a) -&gt; Gen a
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">sized</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Gen (Updates da)) -&gt; Gen (Updates da))
-&gt; (Int -&gt; Gen (Updates da)) -&gt; Gen (Updates da)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679212293"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679212293"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Base da, da)] -&gt; Base da -&gt; Gen (Updates da)
forall t.
(Eq t, Num t) =&gt;
t -&gt; [(Base da, da)] -&gt; Base da -&gt; Gen (Updates da)
</span><a href="#local-6989586621679212292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679212293"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Base da -&gt; Gen (Updates da)) -&gt; Gen (Base da) -&gt; Gen (Updates da)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (Base da)
</span><a href="#local-6989586621679212295"><span class="hs-identifier hs-var">gen0</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>    </span><span id="local-6989586621679212292"><span class="annot"><span class="annottext">go :: t -&gt; [(Base da, da)] -&gt; Base da -&gt; Gen (Updates da)
</span><a href="#local-6989586621679212292"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621679212290"><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212290"><span class="hs-identifier hs-var">das</span></a></span></span><span> </span><span class="annot"><span class="annottext">Base da
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Updates da -&gt; Gen (Updates da)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Updates da -&gt; Gen (Updates da)) -&gt; Updates da -&gt; Gen (Updates da)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Base da, da)] -&gt; Updates da
forall da. [(Base da, da)] -&gt; Updates da
</span><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-var">Updates</span></a></span><span> </span><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212290"><span class="hs-identifier hs-var">das</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="#local-6989586621679212292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679212289"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679212289"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679212288"><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212288"><span class="hs-identifier hs-var">das</span></a></span></span><span> </span><span id="local-6989586621679212287"><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212287"><span class="hs-identifier hs-var">a0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-44"></span><span>        </span><span id="local-6989586621679212286"><span class="annot"><span class="annottext">da
</span><a href="#local-6989586621679212286"><span class="hs-identifier hs-var">da</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenDelta da
</span><a href="#local-6989586621679212294"><span class="hs-identifier hs-var">more</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212287"><span class="hs-identifier hs-var">a0</span></a></span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679212285"><span class="annot"><span class="annottext">a1 :: Base da
</span><a href="#local-6989586621679212285"><span class="hs-identifier hs-var hs-var">a1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">da -&gt; Base da -&gt; Base da
forall delta. Delta delta =&gt; delta -&gt; Base delta -&gt; Base delta
</span><a href="Data.Delta.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">da
</span><a href="#local-6989586621679212286"><span class="hs-identifier hs-var">da</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212287"><span class="hs-identifier hs-var">a0</span></a></span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><span class="annottext">t -&gt; [(Base da, da)] -&gt; Base da -&gt; Gen (Updates da)
</span><a href="#local-6989586621679212292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679212289"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212285"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">da
</span><a href="#local-6989586621679212286"><span class="hs-identifier hs-var">da</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Base da, da) -&gt; [(Base da, da)] -&gt; [(Base da, da)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212288"><span class="hs-identifier hs-var">das</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212285"><span class="hs-identifier hs-var">a1</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | Test whether 'updateS' and 'loadS' behave as expected.</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- TODO: Shrinking of the update sequence.</span><span>
</span><span id="line-51"></span><span id="local-6989586621679212282"><span id="local-6989586621679212283"><span class="annot"><a href="Test.DBVar.html#prop_StoreUpdates"><span class="hs-identifier hs-type">prop_StoreUpdates</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212283"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Delta.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Delta.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../formatting/html/src"><span class="hs-identifier hs-type">Buildable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Delta.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679212367"><span class="annot"><a href="#local-6989586621679212367"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679212283"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212367"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">PropertyM</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212367"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">-- ^ Function to embed the monad in 'IO'</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.DBVar.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212283"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- ^ Store that is to be tested.</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">Gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Delta.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- ^ Generator for the initial value.</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.DBVar.html#GenDelta"><span class="hs-identifier hs-type">GenDelta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679212282"><span class="hs-identifier hs-type">da</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-comment">-- ^ Generator for deltas.</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">PropertyM</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-62"></span><span id="prop_StoreUpdates"><span class="annot"><span class="annottext">prop_StoreUpdates :: (forall b. m b -&gt; PropertyM IO b)
-&gt; Store m da -&gt; Gen (Base da) -&gt; GenDelta da -&gt; PropertyM IO ()
</span><a href="Test.DBVar.html#prop_StoreUpdates"><span class="hs-identifier hs-var hs-var">prop_StoreUpdates</span></a></span></span><span> </span><span id="local-6989586621679212281"><span class="annot"><span class="annottext">forall b. m b -&gt; PropertyM IO b
</span><a href="#local-6989586621679212281"><span class="hs-identifier hs-var">toPropertyM</span></a></span></span><span> </span><span id="local-6989586621679212280"><span class="annot"><span class="annottext">Store m da
</span><a href="#local-6989586621679212280"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679212279"><span class="annot"><span class="annottext">Gen (Base da)
</span><a href="#local-6989586621679212279"><span class="hs-identifier hs-var">gen0</span></a></span></span><span> </span><span id="local-6989586621679212278"><span class="annot"><span class="annottext">GenDelta da
</span><a href="#local-6989586621679212278"><span class="hs-identifier hs-var">more</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">-- randomly generate a sequence of updates</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">Blind</span></a></span><span> </span><span id="local-6989586621679212277"><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212277"><span class="hs-identifier hs-var">a0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen (Blind (Base da)) -&gt; PropertyM IO (Blind (Base da))
forall (m :: * -&gt; *) a. (Monad m, Show a) =&gt; Gen a -&gt; PropertyM m a
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">(Gen (Blind (Base da)) -&gt; PropertyM IO (Blind (Base da)))
-&gt; Gen (Blind (Base da)) -&gt; PropertyM IO (Blind (Base da))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Base da -&gt; Blind (Base da)
forall a. a -&gt; Blind a
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">Blind</span></a></span><span> </span><span class="annot"><span class="annottext">(Base da -&gt; Blind (Base da))
-&gt; Gen (Base da) -&gt; Gen (Blind (Base da))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (Base da)
</span><a href="#local-6989586621679212279"><span class="hs-identifier hs-var">gen0</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-type">Blind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.DBVar.html#Updates"><span class="hs-identifier hs-type">Updates</span></a></span><span> </span><span id="local-6989586621679212275"><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212275"><span class="hs-identifier hs-var">adas</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen (Blind (Updates da)) -&gt; PropertyM IO (Blind (Updates da))
forall (m :: * -&gt; *) a. (Monad m, Show a) =&gt; Gen a -&gt; PropertyM m a
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">(Gen (Blind (Updates da)) -&gt; PropertyM IO (Blind (Updates da)))
-&gt; Gen (Blind (Updates da)) -&gt; PropertyM IO (Blind (Updates da))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Updates da -&gt; Blind (Updates da)
forall a. a -&gt; Blind a
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">Blind</span></a></span><span> </span><span class="annot"><span class="annottext">(Updates da -&gt; Blind (Updates da))
-&gt; Gen (Updates da) -&gt; Gen (Blind (Updates da))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (Base da) -&gt; GenDelta da -&gt; Gen (Updates da)
forall da.
Delta da =&gt;
Gen (Base da) -&gt; GenDelta da -&gt; Gen (Updates da)
</span><a href="Test.DBVar.html#genUpdates"><span class="hs-identifier hs-var">genUpdates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Base da -&gt; Gen (Base da)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212277"><span class="hs-identifier hs-var">a0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenDelta da
</span><a href="#local-6989586621679212278"><span class="hs-identifier hs-var">more</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679212274"><span class="annot"><span class="annottext">as :: [Base da]
</span><a href="#local-6989586621679212274"><span class="hs-keyword hs-var hs-var">as</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Base da, da) -&gt; Base da) -&gt; [(Base da, da)] -&gt; [Base da]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Base da, da) -&gt; Base da
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212275"><span class="hs-identifier hs-var">adas</span></a></span><span> </span><span class="annot"><span class="annottext">[Base da] -&gt; [Base da] -&gt; [Base da]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212277"><span class="hs-identifier hs-var">a0</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>        </span><span id="local-6989586621679212273"><span class="annot"><span class="annottext">das :: [da]
</span><a href="#local-6989586621679212273"><span class="hs-identifier hs-var hs-var">das</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Base da, da) -&gt; da) -&gt; [(Base da, da)] -&gt; [da]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Base da, da) -&gt; da
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Base da, da)]
</span><a href="#local-6989586621679212275"><span class="hs-identifier hs-var">adas</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">(Property -&gt; Property) -&gt; PropertyM IO ()
forall (m :: * -&gt; *).
Monad m =&gt;
(Property -&gt; Property) -&gt; PropertyM m ()
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">monitor</span></a></span><span> </span><span class="annot"><span class="annottext">((Property -&gt; Property) -&gt; PropertyM IO ())
-&gt; (Property -&gt; Property) -&gt; PropertyM IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">counterexample</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Property -&gt; Property) -&gt; String -&gt; Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nUpdates applied:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; String
forall a b. (Buildable a, FromBuilder b) =&gt; a -&gt; b
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[da] -&gt; Builder
forall (f :: * -&gt; *) a. (Foldable f, Buildable a) =&gt; f a -&gt; Builder
</span><a href="../../../../fmt/html/src"><span class="hs-identifier hs-var">listF</span></a></span><span> </span><span class="annot"><span class="annottext">[da]
</span><a href="#local-6989586621679212273"><span class="hs-identifier hs-var">das</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">-- apply those updates</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679212272"><span class="annot"><span class="annottext">Either SomeException (Base da)
</span><a href="#local-6989586621679212272"><span class="hs-identifier hs-var">ea</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either SomeException (Base da))
-&gt; PropertyM IO (Either SomeException (Base da))
forall b. m b -&gt; PropertyM IO b
</span><a href="#local-6989586621679212281"><span class="hs-identifier hs-var">toPropertyM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either SomeException (Base da))
 -&gt; PropertyM IO (Either SomeException (Base da)))
-&gt; m (Either SomeException (Base da))
-&gt; PropertyM IO (Either SomeException (Base da))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">Store m da -&gt; Base da -&gt; m ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; m ()
</span><a href="Data.DBVar.html#writeS"><span class="hs-identifier hs-var hs-var">writeS</span></a></span><span> </span><span class="annot"><span class="annottext">Store m da
</span><a href="#local-6989586621679212280"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212277"><span class="hs-identifier hs-var">a0</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-comment">-- first update is applied last!</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679212271"><span class="annot"><span class="annottext">updates :: [(da, Base da)]
</span><a href="#local-6989586621679212271"><span class="hs-identifier hs-var hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(da, Base da)] -&gt; [(da, Base da)]
forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([(da, Base da)] -&gt; [(da, Base da)])
-&gt; [(da, Base da)] -&gt; [(da, Base da)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[da] -&gt; [Base da] -&gt; [(da, Base da)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[da]
</span><a href="#local-6989586621679212273"><span class="hs-identifier hs-var">das</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Base da] -&gt; [Base da]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Base da]
</span><a href="#local-6989586621679212274"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">[(da, Base da)] -&gt; ((da, Base da) -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(da, Base da)]
</span><a href="#local-6989586621679212271"><span class="hs-identifier hs-var">updates</span></a></span><span> </span><span class="annot"><span class="annottext">(((da, Base da) -&gt; m ()) -&gt; m ())
-&gt; ((da, Base da) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679212268"><span class="annot"><span class="annottext">da
</span><a href="#local-6989586621679212268"><span class="hs-identifier hs-var">da</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679212267"><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212267"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Store m da -&gt; Base da -&gt; da -&gt; m ()
forall (m :: * -&gt; *) da. Store m da -&gt; Base da -&gt; da -&gt; m ()
</span><a href="Data.DBVar.html#updateS"><span class="hs-identifier hs-var hs-var">updateS</span></a></span><span> </span><span class="annot"><span class="annottext">Store m da
</span><a href="#local-6989586621679212280"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212267"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">da
</span><a href="#local-6989586621679212268"><span class="hs-identifier hs-var">da</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="annottext">Store m da -&gt; m (Either SomeException (Base da))
forall (m :: * -&gt; *) da.
Store m da -&gt; m (Either SomeException (Base da))
</span><a href="Data.DBVar.html#loadS"><span class="hs-identifier hs-var hs-var">loadS</span></a></span><span> </span><span class="annot"><span class="annottext">Store m da
</span><a href="#local-6989586621679212280"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- check whether the last value is correct</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException (Base da)
</span><a href="#local-6989586621679212272"><span class="hs-identifier hs-var">ea</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679212266"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679212266"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; PropertyM IO ()
forall e a. Exception e =&gt; e -&gt; a
</span><a href="../../../../safe-exceptions/html/src"><span class="hs-identifier hs-var">impureThrow</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679212266"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679212265"><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212265"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>            </span><span class="annot"><span class="annottext">(Property -&gt; Property) -&gt; PropertyM IO ()
forall (m :: * -&gt; *).
Monad m =&gt;
(Property -&gt; Property) -&gt; PropertyM m ()
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">monitor</span></a></span><span> </span><span class="annot"><span class="annottext">((Property -&gt; Property) -&gt; PropertyM IO ())
-&gt; (Property -&gt; Property) -&gt; PropertyM IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">counterexample</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Property -&gt; Property) -&gt; String -&gt; Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nExpected:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Base da -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Base da] -&gt; Base da
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Base da]
</span><a href="#local-6989586621679212274"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><span class="annottext">(Property -&gt; Property) -&gt; PropertyM IO ()
forall (m :: * -&gt; *).
Monad m =&gt;
(Property -&gt; Property) -&gt; PropertyM m ()
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">monitor</span></a></span><span> </span><span class="annot"><span class="annottext">((Property -&gt; Property) -&gt; PropertyM IO ())
-&gt; (Property -&gt; Property) -&gt; PropertyM IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">counterexample</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Property -&gt; Property) -&gt; String -&gt; Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nGot:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Base da -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212265"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-87"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; PropertyM IO ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; PropertyM m ()
</span><a href="../../../../QuickCheck/html/src"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; PropertyM IO ()) -&gt; Bool -&gt; PropertyM IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Base da
</span><a href="#local-6989586621679212265"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Base da -&gt; Base da -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[Base da] -&gt; Base da
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Base da]
</span><a href="#local-6989586621679212274"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-88"></span></pre></body></html>