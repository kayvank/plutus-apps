<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE PatternGuards #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- | HTTP over TLS support for Warp via the TLS package.</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">--   If HTTP\/2 is negotiated by ALPN, HTTP\/2 over TLS is used.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--   Otherwise HTTP\/1.1 over TLS is used.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">--   Support for SSL is now obsoleted.</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Wai.Handler.WarpTLS</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Runner</span></span><span>
</span><span id="line-17"></span><span>      </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLS"><span class="hs-identifier">runTLS</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier">runTLSSocket</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Settings</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier">TLSSettings</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier">defaultTlsSettings</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Smart constructors</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From files</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettings"><span class="hs-identifier">tlsSettings</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChain"><span class="hs-identifier">tlsSettingsChain</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From memory</span></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsMemory"><span class="hs-identifier">tlsSettingsMemory</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainMemory"><span class="hs-identifier">tlsSettingsChainMemory</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From references</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsRef"><span class="hs-identifier">tlsSettingsRef</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainRef"><span class="hs-identifier">tlsSettingsChainRef</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertSettings"><span class="hs-identifier">CertSettings</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Accessors</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-identifier">tlsCredentials</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsLogging"><span class="hs-identifier">tlsLogging</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsAllowedVersions"><span class="hs-identifier">tlsAllowedVersions</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCiphers"><span class="hs-identifier">tlsCiphers</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsWantClientCert"><span class="hs-identifier">tlsWantClientCert</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerHooks"><span class="hs-identifier">tlsServerHooks</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerDHEParams"><span class="hs-identifier">tlsServerDHEParams</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManagerConfig"><span class="hs-identifier">tlsSessionManagerConfig</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManager"><span class="hs-identifier">tlsSessionManager</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#onInsecure"><span class="hs-identifier">onInsecure</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#OnInsecure"><span class="hs-identifier">OnInsecure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exception</span></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#WarpTLSException"><span class="hs-identifier">WarpTLSException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-comment">-- * DH parameters (re-exports)</span></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-comment">-- | This custom DH parameters are not necessary anymore because</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-comment">--   pre-defined DH parameters are supported in the TLS package.</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">DH.Params</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">DH.generateParams</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">bracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">finally</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">handleAny</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">try</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">IOException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">onException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">handleJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">guard</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../data-default-class/html/src"><span class="hs-identifier">Data.Default.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../data-default-class/html/src"><span class="hs-identifier">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.IORef</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">Data.Streaming.Network</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">bindPortTCP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../streaming-commons/html/src"><span class="hs-identifier">safeRecv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.IO.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">IOErrorType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">Network.Socket</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">SockAddr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">Socket</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">close</span></a></span><span class="hs-special">,</span><span class="hs-cpp">
#if MIN_VERSION_network(3,1,1)
</span><span>    </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">gracefulClose</span></a></span><span class="hs-special">,</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">withSocketsDo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../recv/html/src"><span class="hs-identifier">Network.Socket.BufferPool</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">Network.Socket.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier">sendAll</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier">Network.TLS</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TLS</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cryptonite/html/src"><span class="hs-identifier">Crypto.PubKey.DH</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DH</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier">Network.TLS.Extra</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TLSExtra</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../tls-session-manager/html/src"><span class="hs-identifier">Network.TLS.SessionManager</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SM</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Network.Wai</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier">Application</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier">Network.Wai.Handler.Warp</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier">Network.Wai.Handler.Warp.Internal</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html"><span class="hs-identifier">Network.Wai.Handler.WarpTLS.Internal</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertSettings"><span class="hs-identifier">CertSettings</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier">TLSSettings</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#OnInsecure"><span class="hs-identifier">OnInsecure</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">System.IO.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">ioeGetErrorType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isEOFError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">handle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | The default 'CertSettings'.</span><span>
</span><span id="line-89"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#defaultCertSettings"><span class="hs-identifier hs-type">defaultCertSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertSettings"><span class="hs-identifier hs-type">CertSettings</span></a></span><span>
</span><span id="line-90"></span><span id="defaultCertSettings"><span class="annot"><span class="annottext">defaultCertSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultCertSettings"><span class="hs-identifier hs-var hs-var">defaultCertSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; FilePath -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-var">CertFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;certificate.pem&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;key.pem&quot;</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Default 'TLSSettings'. Use this to create 'TLSSettings' with the field record name (aka accessors).</span><span>
</span><span id="line-95"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-type">defaultTlsSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-96"></span><span id="defaultTlsSettings"><span class="annot"><span class="annottext">defaultTlsSettings :: TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var hs-var">defaultTlsSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings :: CertSettings
-&gt; OnInsecure
-&gt; Logging
-&gt; [Version]
-&gt; [Cipher]
-&gt; Bool
-&gt; ServerHooks
-&gt; Maybe Params
-&gt; Maybe Config
-&gt; Maybe Credentials
-&gt; Maybe SessionManager
-&gt; [HashAndSignatureAlgorithm]
-&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultCertSettings"><span class="hs-identifier hs-var">defaultCertSettings</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">onInsecure :: OnInsecure
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#onInsecure"><span class="hs-identifier hs-var">onInsecure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; OnInsecure
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#DenyInsecure"><span class="hs-identifier hs-var">DenyInsecure</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;This server only accepts secure HTTPS connections.&quot;</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsLogging :: Logging
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsLogging"><span class="hs-identifier hs-var">tlsLogging</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logging
forall a. Default a =&gt; a
</span><a href="../../../../data-default-class/html/src"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-cpp">
#if MIN_VERSION_tls(1,5,0)
</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsAllowedVersions :: [Version]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsAllowedVersions"><span class="hs-identifier hs-var">tlsAllowedVersions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS13</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS12</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS11</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS10</span></a></span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tlsAllowedVersions</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TLS.TLS12</span><span class="hs-special">,</span><span class="hs-identifier">TLS.TLS11</span><span class="hs-special">,</span><span class="hs-identifier">TLS.TLS10</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsCiphers :: [Cipher]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCiphers"><span class="hs-identifier hs-var">tlsCiphers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><a href="Network.Wai.Handler.WarpTLS.html#ciphers"><span class="hs-identifier hs-var">ciphers</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsWantClientCert :: Bool
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsWantClientCert"><span class="hs-identifier hs-var">tlsWantClientCert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsServerHooks :: ServerHooks
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerHooks"><span class="hs-identifier hs-var">tlsServerHooks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerHooks
forall a. Default a =&gt; a
</span><a href="../../../../data-default-class/html/src"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsServerDHEParams :: Maybe Params
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerDHEParams"><span class="hs-identifier hs-var">tlsServerDHEParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Params
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsSessionManagerConfig :: Maybe Config
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManagerConfig"><span class="hs-identifier hs-var">tlsSessionManagerConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Config
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsCredentials :: Maybe Credentials
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-identifier hs-var">tlsCredentials</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Credentials
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsSessionManager :: Maybe SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManager"><span class="hs-identifier hs-var">tlsSessionManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SessionManager
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSupportedHashSignatures"><span class="hs-identifier hs-var">tlsSupportedHashSignatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Supported -&gt; [HashAndSignatureAlgorithm]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var hs-var">TLS.supportedHashSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">Supported
forall a. Default a =&gt; a
</span><a href="../../../../data-default-class/html/src"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- taken from stunnel example in tls-extra</span><span>
</span><span id="line-116"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#ciphers"><span class="hs-identifier hs-type">ciphers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.Cipher</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span id="ciphers"><span class="annot"><span class="annottext">ciphers :: [Cipher]
</span><a href="Network.Wai.Handler.WarpTLS.html#ciphers"><span class="hs-identifier hs-var hs-var">ciphers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLSExtra.ciphersuite_strong</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings' based on 'defaultTlsSettings'.</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettings"><span class="hs-identifier hs-type">tlsSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ Certificate file</span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ Key file</span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-125"></span><span id="tlsSettings"><span class="annot"><span class="annottext">tlsSettings :: FilePath -&gt; FilePath -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettings"><span class="hs-identifier hs-var hs-var">tlsSettings</span></a></span></span><span> </span><span id="local-6989586621679085169"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085169"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085168"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085168"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; FilePath -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-var">CertFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085169"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085168"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings' that allows specifying</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- chain certificates based on 'defaultTlsSettings'.</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- Since 3.0.3</span><span>
</span><span id="line-133"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChain"><span class="hs-identifier hs-type">tlsSettingsChain</span></a></span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ Certificate file</span><span>
</span><span id="line-135"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Chain certificate files</span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ Key file</span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-138"></span><span id="tlsSettingsChain"><span class="annot"><span class="annottext">tlsSettingsChain :: FilePath -&gt; [FilePath] -&gt; FilePath -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChain"><span class="hs-identifier hs-var hs-var">tlsSettingsChain</span></a></span></span><span> </span><span id="local-6989586621679085167"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085167"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085166"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679085166"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span id="local-6989586621679085165"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085165"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; FilePath -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-var">CertFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085167"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679085166"><span class="hs-identifier hs-var">chainCerts</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085165"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses in-memory representations</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- Since 3.0.1</span><span>
</span><span id="line-146"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsMemory"><span class="hs-identifier hs-type">tlsSettingsMemory</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Certificate bytes</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Key bytes</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-150"></span><span id="tlsSettingsMemory"><span class="annot"><span class="annottext">tlsSettingsMemory :: ByteString -&gt; ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsMemory"><span class="hs-identifier hs-var hs-var">tlsSettingsMemory</span></a></span></span><span> </span><span id="local-6989586621679085164"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085164"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085163"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085163"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromMemory"><span class="hs-identifier hs-var">CertFromMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085164"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085163"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses in-memory representations</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-156"></span><span class="hs-comment">--</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- Since 3.0.3</span><span>
</span><span id="line-158"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainMemory"><span class="hs-identifier hs-type">tlsSettingsChainMemory</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Certificate bytes</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Chain certificate bytes</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Key bytes</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-163"></span><span id="tlsSettingsChainMemory"><span class="annot"><span class="annottext">tlsSettingsChainMemory :: ByteString -&gt; [ByteString] -&gt; ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainMemory"><span class="hs-identifier hs-var hs-var">tlsSettingsChainMemory</span></a></span></span><span> </span><span id="local-6989586621679085161"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085161"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085160"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085160"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span id="local-6989586621679085159"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085159"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromMemory"><span class="hs-identifier hs-var">CertFromMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085161"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085160"><span class="hs-identifier hs-var">chainCerts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085159"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses references to in-memory</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- representations of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- @since 3.3.0</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsRef"><span class="hs-identifier hs-type">tlsSettingsRef</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Reference to certificate bytes</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Reference to key bytes</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-175"></span><span id="tlsSettingsRef"><span class="annot"><span class="annottext">tlsSettingsRef :: IORef ByteString -&gt; IORef ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsRef"><span class="hs-identifier hs-var hs-var">tlsSettingsRef</span></a></span></span><span> </span><span id="local-6989586621679085158"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085158"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085157"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085157"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef ByteString
-&gt; [IORef ByteString] -&gt; IORef ByteString -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromRef"><span class="hs-identifier hs-var">CertFromRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085158"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085157"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses references to in-memory</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- representations of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- @since 3.3.0</span><span>
</span><span id="line-183"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainRef"><span class="hs-identifier hs-type">tlsSettingsChainRef</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Reference to certificate bytes</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Reference to chain certificate bytes</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ Reference to key bytes</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-188"></span><span id="tlsSettingsChainRef"><span class="annot"><span class="annottext">tlsSettingsChainRef :: IORef ByteString
-&gt; [IORef ByteString] -&gt; IORef ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainRef"><span class="hs-identifier hs-var hs-var">tlsSettingsChainRef</span></a></span></span><span> </span><span id="local-6989586621679085155"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085155"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085154"><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679085154"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span id="local-6989586621679085153"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085153"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">certSettings :: CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef ByteString
-&gt; [IORef ByteString] -&gt; IORef ByteString -&gt; CertSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromRef"><span class="hs-identifier hs-var">CertFromRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085155"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679085154"><span class="hs-identifier hs-var">chainCerts</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085153"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | Running 'Application' with 'TLSSettings' and 'Settings'.</span><span>
</span><span id="line-195"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLS"><span class="hs-identifier hs-type">runTLS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span id="runTLS"><span class="annot"><span class="annottext">runTLS :: TLSSettings -&gt; Settings -&gt; Application -&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLS"><span class="hs-identifier hs-var hs-var">runTLS</span></a></span></span><span> </span><span id="local-6989586621679085152"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085152"><span class="hs-identifier hs-var">tset</span></a></span></span><span> </span><span id="local-6989586621679085151"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085151"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679085150"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679085150"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">withSocketsDo</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">IO Socket -&gt; (Socket -&gt; IO ()) -&gt; (Socket -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b c.
MonadUnliftIO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">bracket</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HostPreference -&gt; IO Socket
</span><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-var">bindPortTCP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; Int
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">getPort</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085151"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; HostPreference
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">getHost</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085151"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">close</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679085147"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085147"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; Settings -&gt; Socket -&gt; Application -&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier hs-var">runTLSSocket</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085152"><span class="hs-identifier hs-var">tset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085151"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085147"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679085150"><span class="hs-identifier hs-var">app</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-type">loadCredentials</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.Credentials</span></a></span><span>
</span><span id="line-205"></span><span id="loadCredentials"><span class="annot"><span class="annottext">loadCredentials :: TLSSettings -&gt; IO Credentials
</span><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-var hs-var">loadCredentials</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-identifier hs-var">tlsCredentials</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679085145"><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679085145"><span class="hs-identifier hs-var">creds</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679085145"><span class="hs-identifier hs-var">creds</span></a></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-var">loadCredentials</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679085133"><span id="local-6989586621679085134"><span id="local-6989586621679085135"><span id="local-6989586621679085136"><span id="local-6989586621679085137"><span id="local-6989586621679085138"><span id="local-6989586621679085139"><span id="local-6989586621679085140"><span id="local-6989586621679085141"><span id="local-6989586621679085142"><span id="local-6989586621679085143"><span id="local-6989586621679085144"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Params
Maybe Credentials
Maybe SessionManager
Maybe Config
ServerHooks
Logging
OnInsecure
CertSettings
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
tlsSessionManager :: Maybe SessionManager
tlsCredentials :: Maybe Credentials
tlsSessionManagerConfig :: Maybe Config
tlsServerDHEParams :: Maybe Params
tlsServerHooks :: ServerHooks
tlsWantClientCert :: Bool
tlsCiphers :: [Cipher]
tlsAllowedVersions :: [Version]
tlsLogging :: Logging
onInsecure :: OnInsecure
certSettings :: CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: TLSSettings -&gt; CertSettings
onInsecure :: TLSSettings -&gt; OnInsecure
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsServerDHEParams :: TLSSettings -&gt; Maybe Params
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsLogging :: TLSSettings -&gt; Logging
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="#local-6989586621679085133"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CertSettings
</span><a href="#local-6989586621679085144"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-type">CertFromFile</span></a></span><span> </span><span id="local-6989586621679085132"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085132"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679085131"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679085131"><span class="hs-identifier hs-var">chainFiles</span></a></span></span><span> </span><span id="local-6989586621679085130"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085130"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679085129"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679085129"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Credential)
-&gt; (Credential -&gt; Credential)
-&gt; Either FilePath Credential
-&gt; Credential
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Credential
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">Credential -&gt; Credential
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FilePath Credential -&gt; Credential)
-&gt; IO (Either FilePath Credential) -&gt; IO Credential
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; [FilePath] -&gt; FilePath -&gt; IO (Either FilePath Credential)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.credentialLoadX509Chain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085132"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679085131"><span class="hs-identifier hs-var">chainFiles</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679085130"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Credentials -&gt; IO Credentials) -&gt; Credentials -&gt; IO Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.Credentials</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679085129"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromRef"><span class="hs-identifier hs-type">CertFromRef</span></a></span><span> </span><span id="local-6989586621679085122"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085122"><span class="hs-identifier hs-var">certRef</span></a></span></span><span> </span><span id="local-6989586621679085121"><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679085121"><span class="hs-identifier hs-var">chainCertsRef</span></a></span></span><span> </span><span id="local-6989586621679085120"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085120"><span class="hs-identifier hs-var">keyRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679085119"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085119"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085122"><span class="hs-identifier hs-var">certRef</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679085117"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085117"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(IORef ByteString -&gt; IO ByteString)
-&gt; [IORef ByteString] -&gt; IO [ByteString]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679085121"><span class="hs-identifier hs-var">chainCertsRef</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679085115"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085115"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679085120"><span class="hs-identifier hs-var">keyRef</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679085114"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679085114"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Credential)
-&gt; (Credential -&gt; IO Credential)
-&gt; Either FilePath Credential
-&gt; IO Credential
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Credential
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">Credential -&gt; IO Credential
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FilePath Credential -&gt; IO Credential)
-&gt; Either FilePath Credential -&gt; IO Credential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; [ByteString] -&gt; ByteString -&gt; Either FilePath Credential
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.credentialLoadX509ChainFromMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085119"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085117"><span class="hs-identifier hs-var">chainCerts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085115"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Credentials -&gt; IO Credentials) -&gt; Credentials -&gt; IO Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.Credentials</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679085114"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromMemory"><span class="hs-identifier hs-type">CertFromMemory</span></a></span><span> </span><span id="local-6989586621679085112"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085112"><span class="hs-identifier hs-var">certMemory</span></a></span></span><span> </span><span id="local-6989586621679085111"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085111"><span class="hs-identifier hs-var">chainCertsMemory</span></a></span></span><span> </span><span id="local-6989586621679085110"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085110"><span class="hs-identifier hs-var">keyMemory</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679085109"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679085109"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Credential)
-&gt; (Credential -&gt; IO Credential)
-&gt; Either FilePath Credential
-&gt; IO Credential
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Credential
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">Credential -&gt; IO Credential
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FilePath Credential -&gt; IO Credential)
-&gt; Either FilePath Credential -&gt; IO Credential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; [ByteString] -&gt; ByteString -&gt; Either FilePath Credential
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.credentialLoadX509ChainFromMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085112"><span class="hs-identifier hs-var">certMemory</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085111"><span class="hs-identifier hs-var">chainCertsMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085110"><span class="hs-identifier hs-var">keyMemory</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Credentials -&gt; IO Credentials) -&gt; Credentials -&gt; IO Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.Credentials</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679085109"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-type">getSessionManager</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.SessionManager</span></a></span><span>
</span><span id="line-221"></span><span id="getSessionManager"><span class="annot"><span class="annottext">getSessionManager :: TLSSettings -&gt; IO SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-var hs-var">getSessionManager</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManager"><span class="hs-identifier hs-var">tlsSessionManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679085107"><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679085107"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SessionManager -&gt; IO SessionManager
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679085107"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-var">getSessionManager</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679085095"><span id="local-6989586621679085096"><span id="local-6989586621679085097"><span id="local-6989586621679085098"><span id="local-6989586621679085099"><span id="local-6989586621679085100"><span id="local-6989586621679085101"><span id="local-6989586621679085102"><span id="local-6989586621679085103"><span id="local-6989586621679085104"><span id="local-6989586621679085105"><span id="local-6989586621679085106"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Params
Maybe Credentials
Maybe SessionManager
Maybe Config
ServerHooks
Logging
OnInsecure
CertSettings
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
tlsSessionManager :: Maybe SessionManager
tlsCredentials :: Maybe Credentials
tlsSessionManagerConfig :: Maybe Config
tlsServerDHEParams :: Maybe Params
tlsServerHooks :: ServerHooks
tlsWantClientCert :: Bool
tlsCiphers :: [Cipher]
tlsAllowedVersions :: [Version]
tlsLogging :: Logging
onInsecure :: OnInsecure
certSettings :: CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: TLSSettings -&gt; CertSettings
onInsecure :: TLSSettings -&gt; OnInsecure
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsServerDHEParams :: TLSSettings -&gt; Maybe Params
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsLogging :: TLSSettings -&gt; Logging
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="#local-6989586621679085095"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Config
</span><a href="#local-6989586621679085098"><span class="hs-identifier hs-var">tlsSessionManagerConfig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-223"></span><span>      </span><span class="annot"><span class="annottext">Maybe Config
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SessionManager -&gt; IO SessionManager
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.noSessionManager</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679085093"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679085093"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config -&gt; IO SessionManager
</span><a href="../../../../tls-session-manager/html/src"><span class="hs-identifier hs-var">SM.newSessionManager</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679085093"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- | Running 'Application' with 'TLSSettings' and 'Settings' using</span><span>
</span><span id="line-227"></span><span class="hs-comment">--   specified 'Socket'.</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier hs-type">runTLSSocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span id="runTLSSocket"><span class="annot"><span class="annottext">runTLSSocket :: TLSSettings -&gt; Settings -&gt; Socket -&gt; Application -&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier hs-var hs-var">runTLSSocket</span></a></span></span><span> </span><span id="local-6989586621679085091"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085091"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span> </span><span id="local-6989586621679085090"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085090"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679085089"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085089"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679085088"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679085088"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621679085087"><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679085087"><span class="hs-identifier hs-var">credentials</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; IO Credentials
</span><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-var">loadCredentials</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085091"><span class="hs-identifier hs-var">tlsset</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621679085086"><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679085086"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; IO SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-var">getSessionManager</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085091"><span class="hs-identifier hs-var">tlsset</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings
-&gt; Credentials
-&gt; SessionManager
-&gt; Socket
-&gt; Application
-&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket%27"><span class="hs-identifier hs-var">runTLSSocket'</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085091"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085090"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679085087"><span class="hs-identifier hs-var">credentials</span></a></span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679085086"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085089"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679085088"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket%27"><span class="hs-identifier hs-type">runTLSSocket'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.Credentials</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.SessionManager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../wai/html/src"><span class="hs-identifier hs-type">Application</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span id="runTLSSocket%27"><span class="annot"><span class="annottext">runTLSSocket' :: TLSSettings
-&gt; Settings
-&gt; Credentials
-&gt; SessionManager
-&gt; Socket
-&gt; Application
-&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket%27"><span class="hs-identifier hs-var hs-var">runTLSSocket'</span></a></span></span><span> </span><span id="local-6989586621679085084"><span class="annot"><span class="annottext">tlsset :: TLSSettings
</span><a href="#local-6989586621679085084"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679085072"><span id="local-6989586621679085073"><span id="local-6989586621679085074"><span id="local-6989586621679085075"><span id="local-6989586621679085076"><span id="local-6989586621679085077"><span id="local-6989586621679085078"><span id="local-6989586621679085079"><span id="local-6989586621679085080"><span id="local-6989586621679085081"><span id="local-6989586621679085082"><span id="local-6989586621679085083"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Params
Maybe Credentials
Maybe SessionManager
Maybe Config
ServerHooks
Logging
OnInsecure
CertSettings
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
tlsSessionManager :: Maybe SessionManager
tlsCredentials :: Maybe Credentials
tlsSessionManagerConfig :: Maybe Config
tlsServerDHEParams :: Maybe Params
tlsServerHooks :: ServerHooks
tlsWantClientCert :: Bool
tlsCiphers :: [Cipher]
tlsAllowedVersions :: [Version]
tlsLogging :: Logging
onInsecure :: OnInsecure
certSettings :: CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: TLSSettings -&gt; CertSettings
onInsecure :: TLSSettings -&gt; OnInsecure
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsServerDHEParams :: TLSSettings -&gt; Maybe Params
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsLogging :: TLSSettings -&gt; Logging
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="#local-6989586621679085072"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679085071"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085071"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679085070"><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679085070"><span class="hs-identifier hs-var">credentials</span></a></span></span><span> </span><span id="local-6989586621679085069"><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679085069"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span id="local-6989586621679085068"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085068"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">Settings
-&gt; IO (IO (Connection, Transport), SockAddr)
-&gt; Application
-&gt; IO ()
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">runSettingsConnectionMakerSecure</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085071"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">IO (IO (Connection, Transport), SockAddr)
</span><a href="#local-6989586621679085066"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679085066"><span class="annot"><span class="annottext">get :: IO (IO (Connection, Transport), SockAddr)
</span><a href="#local-6989586621679085066"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ServerParams
-&gt; IO (IO (Connection, Transport), SockAddr)
forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; params
-&gt; IO (IO (Connection, Transport), SockAddr)
</span><a href="Network.Wai.Handler.WarpTLS.html#getter"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085084"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085071"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085068"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679085064"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621679085064"><span class="annot"><span class="annottext">params :: ServerParams
</span><a href="#local-6989586621679085064"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerParams
forall a. Default a =&gt; a
</span><a href="../../../../data-default-class/html/src"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- TLS.ServerParams</span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">serverWantClientCert :: Bool
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverWantClientCert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679085078"><span class="hs-identifier hs-var">tlsWantClientCert</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">serverCACertificates :: [SignedCertificate]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverCACertificates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">serverDHEParams :: Maybe Params
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverDHEParams</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Params
</span><a href="#local-6989586621679085076"><span class="hs-identifier hs-var">tlsServerDHEParams</span></a></span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">serverHooks :: ServerHooks
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverHooks</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerHooks
</span><a href="#local-6989586621679085059"><span class="hs-identifier hs-var">hooks</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">serverShared :: Shared
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverShared</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shared
</span><a href="#local-6989586621679085057"><span class="hs-identifier hs-var">shared</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">serverSupported :: Supported
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverSupported</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Supported
</span><a href="#local-6989586621679085055"><span class="hs-identifier hs-var">supported</span></a></span><span class="hs-cpp">
#if MIN_VERSION_tls(1,5,0)
</span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">serverEarlyDataSize :: Int
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.serverEarlyDataSize</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2018</span></span><span class="hs-cpp">
#endif
</span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-comment">-- Adding alpn to user's tlsServerHooks.</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679085059"><span class="annot"><span class="annottext">hooks :: ServerHooks
</span><a href="#local-6989586621679085059"><span class="hs-identifier hs-var hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerHooks
</span><a href="#local-6989586621679085077"><span class="hs-identifier hs-var">tlsServerHooks</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="annottext">onALPNClientSuggest :: Maybe ([ByteString] -&gt; IO ByteString)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.onALPNClientSuggest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerHooks -&gt; Maybe ([ByteString] -&gt; IO ByteString)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var hs-var">TLS.onALPNClientSuggest</span></a></span><span> </span><span class="annot"><span class="annottext">ServerHooks
</span><a href="#local-6989586621679085077"><span class="hs-identifier hs-var">tlsServerHooks</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([ByteString] -&gt; IO ByteString)
-&gt; Maybe ([ByteString] -&gt; IO ByteString)
-&gt; Maybe ([ByteString] -&gt; IO ByteString)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Bool
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var hs-var">settingsHTTP2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085071"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; IO ByteString)
-&gt; Maybe ([ByteString] -&gt; IO ByteString)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; IO ByteString
</span><a href="Network.Wai.Handler.WarpTLS.html#alpn"><span class="hs-identifier hs-var">alpn</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe ([ByteString] -&gt; IO ByteString)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679085057"><span class="annot"><span class="annottext">shared :: Shared
</span><a href="#local-6989586621679085057"><span class="hs-identifier hs-var hs-var">shared</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shared
forall a. Default a =&gt; a
</span><a href="../../../../data-default-class/html/src"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">sharedCredentials :: Credentials
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.sharedCredentials</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679085070"><span class="hs-identifier hs-var">credentials</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sharedSessionManager :: SessionManager
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.sharedSessionManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679085069"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679085055"><span class="annot"><span class="annottext">supported :: Supported
</span><a href="#local-6989586621679085055"><span class="hs-identifier hs-var hs-var">supported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Supported
forall a. Default a =&gt; a
</span><a href="../../../../data-default-class/html/src"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- TLS.Supported</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">supportedVersions :: [Version]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedVersions</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Version]
</span><a href="#local-6989586621679085080"><span class="hs-identifier hs-var">tlsAllowedVersions</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedCiphers :: [Cipher]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedCiphers</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Cipher]
</span><a href="#local-6989586621679085079"><span class="hs-identifier hs-var">tlsCiphers</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedCompressions :: [Compression]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedCompressions</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Compression
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.nullCompression</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedSecureRenegotiation :: Bool
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedSecureRenegotiation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedClientInitiatedRenegotiation :: Bool
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedClientInitiatedRenegotiation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedSession :: Bool
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedSession</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedFallbackScsv :: Bool
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedFallbackScsv</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedHashSignatures :: [HashAndSignatureAlgorithm]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedHashSignatures</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashAndSignatureAlgorithm]
</span><a href="#local-6989586621679085072"><span class="hs-identifier hs-var">tlsSupportedHashSignatures</span></a></span><span class="hs-cpp">
#if MIN_VERSION_tls(1,5,0)
</span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">supportedGroups :: [Group]
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.supportedGroups</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Group
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.X25519</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Group
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.P256</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Group
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.P384</span></a></span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#alpn"><span class="hs-identifier hs-type">alpn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-274"></span><span id="alpn"><span class="annot"><span class="annottext">alpn :: [ByteString] -&gt; IO ByteString
</span><a href="Network.Wai.Handler.WarpTLS.html#alpn"><span class="hs-identifier hs-var hs-var">alpn</span></a></span></span><span> </span><span id="local-6989586621679085036"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085036"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h2&quot;</span></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679085036"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h2&quot;</span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;http/1.1&quot;</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span id="local-6989586621679085316"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getter"><span class="hs-identifier hs-type">getter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.TLSParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679085316"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679085316"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Transport</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">SockAddr</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-281"></span><span id="getter"><span class="annot"><span class="annottext">getter :: TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; params
-&gt; IO (IO (Connection, Transport), SockAddr)
</span><a href="Network.Wai.Handler.WarpTLS.html#getter"><span class="hs-identifier hs-var hs-var">getter</span></a></span></span><span> </span><span id="local-6989586621679085034"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085034"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span> </span><span id="local-6989586621679085033"><span class="annot"><span class="annottext">set :: Settings
</span><a href="#local-6989586621679085033"><span class="hs-identifier hs-var">set</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">settingsAccept :: Settings -&gt; Socket -&gt; IO (Socket, SockAddr)
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">settingsAccept</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679085030"><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="#local-6989586621679085030"><span class="hs-identifier hs-var">accept'</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679085029"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085029"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679085028"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679085028"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679085027"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085027"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679085026"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679085026"><span class="hs-identifier hs-var">sa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="#local-6989586621679085030"><span class="hs-identifier hs-var">accept'</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085029"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">setSocketCloseOnExec</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085027"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">(IO (Connection, Transport), SockAddr)
-&gt; IO (IO (Connection, Transport), SockAddr)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings -&gt; Socket -&gt; params -&gt; IO (Connection, Transport)
forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings -&gt; Socket -&gt; params -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#mkConn"><span class="hs-identifier hs-var">mkConn</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085034"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085033"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085027"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679085028"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679085026"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span id="local-6989586621679085304"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#mkConn"><span class="hs-identifier hs-type">mkConn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.TLSParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679085304"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679085304"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Transport</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-287"></span><span id="mkConn"><span class="annot"><span class="annottext">mkConn :: TLSSettings
-&gt; Settings -&gt; Socket -&gt; params -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#mkConn"><span class="hs-identifier hs-var hs-var">mkConn</span></a></span></span><span> </span><span id="local-6989586621679085023"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085023"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span> </span><span id="local-6989586621679085022"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085022"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679085021"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085021"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679085020"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679085020"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; Int -&gt; IO ByteString
</span><a href="../../../../streaming-commons/html/src"><span class="hs-identifier hs-var">safeRecv</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085021"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4096</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString
-&gt; (ByteString -&gt; IO (Connection, Transport))
-&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (Connection, Transport)
</span><a href="#local-6989586621679085019"><span class="hs-identifier hs-var">switch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Connection, Transport) -&gt; IO () -&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-operator hs-var">`onException`</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085021"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679085019"><span class="annot"><span class="annottext">switch :: ByteString -&gt; IO (Connection, Transport)
</span><a href="#local-6989586621679085019"><span class="hs-identifier hs-var hs-var">switch</span></a></span></span><span> </span><span id="local-6989586621679085018"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085018"><span class="hs-identifier hs-var">firstBS</span></a></span></span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085018"><span class="hs-identifier hs-var">firstBS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085021"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO (Connection, Transport) -&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WarpTLSException -&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">WarpTLSException
</span><a href="Network.Wai.Handler.WarpTLS.html#ClientClosedConnectionPrematurely"><span class="hs-identifier hs-var">ClientClosedConnectionPrematurely</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Word8
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.head</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085018"><span class="hs-identifier hs-var">firstBS</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x16</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ByteString
-&gt; params
-&gt; IO (Connection, Transport)
forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ByteString
-&gt; params
-&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#httpOverTls"><span class="hs-identifier hs-var">httpOverTls</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085023"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085022"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085021"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085018"><span class="hs-identifier hs-var">firstBS</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679085020"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings -&gt; Socket -&gt; ByteString -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#plainHTTP"><span class="hs-identifier hs-var">plainHTTP</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679085023"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085022"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679085021"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679085018"><span class="hs-identifier hs-var">firstBS</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span id="local-6989586621679085288"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#httpOverTls"><span class="hs-identifier hs-type">httpOverTls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.TLSParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679085288"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679085288"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Transport</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-297"></span><span id="httpOverTls"><span class="annot"><span class="annottext">httpOverTls :: TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ByteString
-&gt; params
-&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#httpOverTls"><span class="hs-identifier hs-var hs-var">httpOverTls</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679085001"><span id="local-6989586621679085002"><span id="local-6989586621679085003"><span id="local-6989586621679085004"><span id="local-6989586621679085005"><span id="local-6989586621679085006"><span id="local-6989586621679085007"><span id="local-6989586621679085008"><span id="local-6989586621679085009"><span id="local-6989586621679085010"><span id="local-6989586621679085011"><span id="local-6989586621679085012"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Params
Maybe Credentials
Maybe SessionManager
Maybe Config
ServerHooks
Logging
OnInsecure
CertSettings
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
tlsSessionManager :: Maybe SessionManager
tlsCredentials :: Maybe Credentials
tlsSessionManagerConfig :: Maybe Config
tlsServerDHEParams :: Maybe Params
tlsServerHooks :: ServerHooks
tlsWantClientCert :: Bool
tlsCiphers :: [Cipher]
tlsAllowedVersions :: [Version]
tlsLogging :: Logging
onInsecure :: OnInsecure
certSettings :: CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: TLSSettings -&gt; CertSettings
onInsecure :: TLSSettings -&gt; OnInsecure
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsServerDHEParams :: TLSSettings -&gt; Maybe Params
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsLogging :: TLSSettings -&gt; Logging
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="#local-6989586621679085001"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679085000"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679085000"><span class="hs-identifier hs-var">_set</span></a></span></span><span> </span><span id="local-6989586621679084999"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084999"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679084998"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084998"><span class="hs-identifier hs-var">bs0</span></a></span></span><span> </span><span id="local-6989586621679084997"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679084997"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679084996"><span class="annot"><span class="annottext">BufferPool
</span><a href="#local-6989586621679084996"><span class="hs-identifier hs-var">pool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO BufferPool
</span><a href="../../../../recv/html/src"><span class="hs-identifier hs-var">newBufferPool</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2048</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16384</span></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621679084994"><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679084994"><span class="hs-identifier hs-var">rawRecvN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString -&gt; IO (Int -&gt; IO ByteString)
</span><a href="../../../../recv/html/src"><span class="hs-identifier hs-var">makeRecvN</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084998"><span class="hs-identifier hs-var">bs0</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO (Int -&gt; IO ByteString))
-&gt; IO ByteString -&gt; IO (Int -&gt; IO ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; BufferPool -&gt; IO ByteString
</span><a href="../../../../recv/html/src"><span class="hs-identifier hs-var">receive</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084999"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">BufferPool
</span><a href="#local-6989586621679084996"><span class="hs-identifier hs-var">pool</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679084991"><span class="annot"><span class="annottext">recvN :: Int -&gt; IO ByteString
</span><a href="#local-6989586621679084991"><span class="hs-identifier hs-var hs-var">recvN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ByteString) -&gt; Int -&gt; IO ByteString
forall t. (t -&gt; IO ByteString) -&gt; t -&gt; IO ByteString
</span><a href="#local-6989586621679084990"><span class="hs-identifier hs-var">wrappedRecvN</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679084994"><span class="hs-identifier hs-var">rawRecvN</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621679084989"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084989"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; params -&gt; IO Context
forall (m :: * -&gt; *) backend params.
(MonadIO m, HasBackend backend, TLSParams params) =&gt;
backend -&gt; params -&gt; m Context
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.contextNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; IO ByteString) -&gt; Backend
</span><a href="#local-6989586621679084987"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679084991"><span class="hs-identifier hs-var">recvN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679084997"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Logging -&gt; IO ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.contextHookSetLogging</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084989"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Logging
</span><a href="#local-6989586621679085010"><span class="hs-identifier hs-var">tlsLogging</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.handshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084989"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679084984"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679084984"><span class="hs-identifier hs-var">h2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Maybe ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h2&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; Bool) -&gt; IO (Maybe ByteString) -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe ByteString)
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m (Maybe ByteString)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.getNegotiatedProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084989"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679084982"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679084982"><span class="hs-identifier hs-var">isH2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679084984"><span class="hs-identifier hs-var">h2</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span id="local-6989586621679084980"><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679084980"><span class="hs-identifier hs-var">writeBuffer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO WriteBuffer
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">createWriteBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16384</span></span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679084978"><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679084978"><span class="hs-identifier hs-var">writeBufferRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WriteBuffer -&gt; IO (IORef WriteBuffer)
forall a. a -&gt; IO (IORef a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679084980"><span class="hs-identifier hs-var">writeBuffer</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- Creating a cache for leftover input data.</span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621679084977"><span class="annot"><span class="annottext">Transport
</span><a href="#local-6989586621679084977"><span class="hs-identifier hs-var">tls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO Transport
</span><a href="Network.Wai.Handler.WarpTLS.html#getTLSinfo"><span class="hs-identifier hs-var">getTLSinfo</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084989"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><span class="annottext">(Connection, Transport) -&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IORef WriteBuffer -&gt; IORef Bool -&gt; Connection
</span><a href="#local-6989586621679084975"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084989"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679084978"><span class="hs-identifier hs-var">writeBufferRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679084982"><span class="hs-identifier hs-var">isH2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transport
</span><a href="#local-6989586621679084977"><span class="hs-identifier hs-var">tls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621679084987"><span class="annot"><span class="annottext">backend :: (Int -&gt; IO ByteString) -&gt; Backend
</span><a href="#local-6989586621679084987"><span class="hs-identifier hs-var hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621679084974"><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679084974"><span class="hs-identifier hs-var">recvN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Backend :: IO ()
-&gt; IO ()
-&gt; (ByteString -&gt; IO ())
-&gt; (Int -&gt; IO ByteString)
-&gt; Backend
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.Backend</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">backendFlush :: IO ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.backendFlush</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_network(3,1,1)
</span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendClose :: IO ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.backendClose</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; Int -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">gracefulClose</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084999"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5000</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-operator hs-var">`E.catch`</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TLS.backendClose</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">close</span><span> </span><span class="hs-identifier">s</span><span class="hs-cpp">
#endif
</span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendSend :: ByteString -&gt; IO ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.backendSend</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><a href="#local-6989586621679084967"><span class="hs-identifier hs-var">sendAll'</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084999"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendRecv :: Int -&gt; IO ByteString
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.backendRecv</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679084974"><span class="hs-identifier hs-var">recvN</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621679084967"><span class="annot"><span class="annottext">sendAll' :: Socket -&gt; ByteString -&gt; IO ()
</span><a href="#local-6989586621679084967"><span class="hs-identifier hs-var hs-var">sendAll'</span></a></span></span><span> </span><span id="local-6989586621679084965"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084965"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679084964"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084964"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IOError -&gt; Maybe InvalidRequest)
-&gt; (InvalidRequest -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) e b a.
(MonadUnliftIO m, Exception e) =&gt;
(e -&gt; Maybe b) -&gt; (b -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">E.handleJust</span></a></span><span>
</span><span id="line-323"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679084963"><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679084963"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; IOErrorType
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ioeGetErrorType</span></a></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679084963"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IOErrorType -&gt; IOErrorType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ResourceVanished</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; Maybe InvalidRequest
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">ConnectionClosedByPeer</span></a></span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe InvalidRequest
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="annottext">InvalidRequest -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">sendAll</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084965"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084964"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621679084975"><span class="annot"><span class="annottext">conn :: Context -&gt; IORef WriteBuffer -&gt; IORef Bool -&gt; Connection
</span><a href="#local-6989586621679084975"><span class="hs-identifier hs-var hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679084960"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084960"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679084959"><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679084959"><span class="hs-identifier hs-var">writeBufferRef</span></a></span></span><span> </span><span id="local-6989586621679084958"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679084958"><span class="hs-identifier hs-var">isH2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection :: ([ByteString] -&gt; IO ())
-&gt; (ByteString -&gt; IO ())
-&gt; SendFile
-&gt; IO ()
-&gt; IO ByteString
-&gt; RecvBuf
-&gt; IORef WriteBuffer
-&gt; IORef Bool
-&gt; Connection
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">connSendMany :: [ByteString] -&gt; IO ()
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connSendMany</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ByteString -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ByteString -&gt; m ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.sendData</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084960"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ())
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">L.fromChunks</span></a></span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connSendAll :: ByteString -&gt; IO ()
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connSendAll</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679084951"><span class="hs-identifier hs-var">sendall</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connSendFile :: SendFile
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connSendFile</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SendFile
</span><a href="#local-6989586621679084949"><span class="hs-identifier hs-var">sendfile</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connClose :: IO ()
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connClose</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679084947"><span class="hs-identifier hs-var">close'</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRecv :: IO ByteString
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connRecv</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679084945"><span class="hs-identifier hs-var">recv</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRecvBuf :: RecvBuf
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connRecvBuf</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Buffer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-comment">-- obsoleted</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connWriteBuffer :: IORef WriteBuffer
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connWriteBuffer</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679084959"><span class="hs-identifier hs-var">writeBufferRef</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connHTTP2 :: IORef Bool
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connHTTP2</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679084958"><span class="hs-identifier hs-var">isH2</span></a></span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>        </span><span id="local-6989586621679084951"><span class="annot"><span class="annottext">sendall :: ByteString -&gt; IO ()
</span><a href="#local-6989586621679084951"><span class="hs-identifier hs-var hs-var">sendall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ByteString -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ByteString -&gt; m ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.sendData</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084960"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ())
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">L.fromChunks</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span id="local-6989586621679084945"><span class="annot"><span class="annottext">recv :: IO ByteString
</span><a href="#local-6989586621679084945"><span class="hs-identifier hs-var hs-var">recv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ByteString) -&gt; IO ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; SomeException -&gt; m ByteString
</span><a href="#local-6989586621679084941"><span class="hs-identifier hs-var">onEOF</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO ByteString) -&gt; IO ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.recvData</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084960"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-341"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-342"></span><span>            </span><span id="local-6989586621679084941"><span class="annot"><span class="annottext">onEOF :: SomeException -&gt; m ByteString
</span><a href="#local-6989586621679084941"><span class="hs-identifier hs-var hs-var">onEOF</span></a></span></span><span> </span><span id="local-6989586621679084939"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679084939"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-343"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.Error_EOF</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe TLSError
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679084939"><span class="hs-identifier hs-var">e</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-344"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679084936"><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679084936"><span class="hs-identifier hs-var">ioe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe IOError
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679084939"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isEOFError</span></a></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679084936"><span class="hs-identifier hs-var">ioe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.empty</span></a></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; m ByteString
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679084939"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span id="local-6989586621679084949"><span class="annot"><span class="annottext">sendfile :: SendFile
</span><a href="#local-6989586621679084949"><span class="hs-identifier hs-var hs-var">sendfile</span></a></span></span><span> </span><span id="local-6989586621679084935"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621679084935"><span class="hs-identifier hs-var">fid</span></a></span></span><span> </span><span id="local-6989586621679084934"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679084934"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679084933"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679084933"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679084932"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679084932"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679084931"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679084931"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>            </span><span id="local-6989586621679084930"><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679084930"><span class="hs-identifier hs-var">writeBuffer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer -&gt; IO WriteBuffer
forall a. IORef a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679084959"><span class="hs-identifier hs-var">writeBufferRef</span></a></span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="annottext">Buffer -&gt; Int -&gt; (ByteString -&gt; IO ()) -&gt; SendFile
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">readSendFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteBuffer -&gt; Buffer
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var hs-var">bufBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679084930"><span class="hs-identifier hs-var">writeBuffer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteBuffer -&gt; Int
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var hs-var">bufSize</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679084930"><span class="hs-identifier hs-var">writeBuffer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679084951"><span class="hs-identifier hs-var">sendall</span></a></span><span> </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621679084935"><span class="hs-identifier hs-var">fid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679084934"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679084933"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679084932"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679084931"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>        </span><span id="local-6989586621679084947"><span class="annot"><span class="annottext">close' :: IO ()
</span><a href="#local-6989586621679084947"><span class="hs-identifier hs-var hs-var">close'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either IOError ()) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO (Either IOError ())
forall a. IO a -&gt; IO (Either IOError a)
</span><a href="Network.Wai.Handler.WarpTLS.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679084925"><span class="hs-identifier hs-var">sendBye</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-operator hs-var">`finally`</span></a></span><span>
</span><span id="line-350"></span><span>                 </span><span class="annot"><span class="annottext">Context -&gt; IO ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.contextClose</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084960"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621679084925"><span class="annot"><span class="annottext">sendBye :: IO ()
</span><a href="#local-6989586621679084925"><span class="hs-identifier hs-var hs-var">sendBye</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>          </span><span class="hs-comment">-- It's fine if the connection was closed by the other side before</span><span>
</span><span id="line-354"></span><span>          </span><span class="hs-comment">-- receiving close_notify, see RFC 5246 section 7.2.1.</span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">(InvalidRequest -&gt; Maybe InvalidRequest)
-&gt; (InvalidRequest -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) e b a.
(MonadUnliftIO m, Exception e) =&gt;
(e -&gt; Maybe b) -&gt; (b -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">handleJust</span></a></span><span>
</span><span id="line-356"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679084923"><span class="annot"><span class="annottext">InvalidRequest
</span><a href="#local-6989586621679084923"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidRequest
</span><a href="#local-6989586621679084923"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; InvalidRequest -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">ConnectionClosedByPeer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe () -&gt; Maybe InvalidRequest -&gt; Maybe InvalidRequest
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; Maybe InvalidRequest
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><a href="#local-6989586621679084923"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; InvalidRequest -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.bye</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084960"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621679084990"><span class="annot"><span class="annottext">wrappedRecvN :: (t -&gt; IO ByteString) -&gt; t -&gt; IO ByteString
</span><a href="#local-6989586621679084990"><span class="hs-identifier hs-var hs-var">wrappedRecvN</span></a></span></span><span> </span><span id="local-6989586621679084920"><span class="annot"><span class="annottext">t -&gt; IO ByteString
</span><a href="#local-6989586621679084920"><span class="hs-identifier hs-var">recvN</span></a></span></span><span> </span><span id="local-6989586621679084919"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679084919"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ByteString) -&gt; IO ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
(SomeException -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">handleAny</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ByteString
</span><a href="#local-6989586621679084918"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO ByteString) -&gt; IO ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; IO ByteString
</span><a href="#local-6989586621679084920"><span class="hs-identifier hs-var">recvN</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679084919"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="#local-6989586621679084918"><span class="hs-identifier hs-type">handler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679084918"><span class="annot"><span class="annottext">handler :: SomeException -&gt; IO ByteString
</span><a href="#local-6989586621679084918"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getTLSinfo"><span class="hs-identifier hs-type">getTLSinfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Transport</span></a></span><span>
</span><span id="line-366"></span><span id="getTLSinfo"><span class="annot"><span class="annottext">getTLSinfo :: Context -&gt; IO Transport
</span><a href="Network.Wai.Handler.WarpTLS.html#getTLSinfo"><span class="hs-identifier hs-var hs-var">getTLSinfo</span></a></span></span><span> </span><span id="local-6989586621679084917"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084917"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621679084916"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679084916"><span class="hs-identifier hs-var">proto</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe ByteString)
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m (Maybe ByteString)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.getNegotiatedProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084917"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621679084915"><span class="annot"><span class="annottext">Maybe Information
</span><a href="#local-6989586621679084915"><span class="hs-identifier hs-var">minfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe Information)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.contextGetInformation</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084917"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Information
</span><a href="#local-6989586621679084915"><span class="hs-identifier hs-var">minfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><span class="annottext">Maybe Information
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transport -&gt; IO Transport
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Transport
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">TCP</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="../../../../tls/html/src"><span class="hs-identifier hs-type">TLS.Information</span></a></span><span class="hs-special">{</span><span id="local-6989586621679084902"><span id="local-6989586621679084903"><span id="local-6989586621679084904"><span id="local-6989586621679084905"><span id="local-6989586621679084906"><span id="local-6989586621679084907"><span id="local-6989586621679084908"><span id="local-6989586621679084909"><span id="local-6989586621679084910"><span id="local-6989586621679084911"><span class="annot"><span class="annottext">Bool
Maybe ByteString
Maybe HandshakeMode13
Maybe ServerRandom
Maybe ClientRandom
Maybe Group
Cipher
Compression
Version
infoVersion :: Information -&gt; Version
infoCipher :: Information -&gt; Cipher
infoCompression :: Information -&gt; Compression
infoMasterSecret :: Information -&gt; Maybe ByteString
infoExtendedMasterSec :: Information -&gt; Bool
infoClientRandom :: Information -&gt; Maybe ClientRandom
infoServerRandom :: Information -&gt; Maybe ServerRandom
infoNegotiatedGroup :: Information -&gt; Maybe Group
infoTLS13HandshakeMode :: Information -&gt; Maybe HandshakeMode13
infoIsEarlyDataAccepted :: Information -&gt; Bool
infoIsEarlyDataAccepted :: Bool
infoTLS13HandshakeMode :: Maybe HandshakeMode13
infoNegotiatedGroup :: Maybe Group
infoServerRandom :: Maybe ServerRandom
infoClientRandom :: Maybe ClientRandom
infoExtendedMasterSec :: Bool
infoMasterSecret :: Maybe ByteString
infoCompression :: Compression
infoCipher :: Cipher
infoVersion :: Version
</span><a href="../../../../tls/html/src"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679084891"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679084891"><span class="hs-identifier hs-var">major</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679084890"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679084890"><span class="hs-identifier hs-var">minor</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679084911"><span class="hs-identifier hs-var">infoVersion</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.SSL2</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.SSL3</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS10</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS11</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS12</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_tls(1,5,0)
</span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.TLS13</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>            </span><span id="local-6989586621679084887"><span class="annot"><span class="annottext">Maybe CertificateChain
</span><a href="#local-6989586621679084887"><span class="hs-identifier hs-var">clientCert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe CertificateChain)
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var">TLS.getClientCertificateChain</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679084917"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-382"></span><span>            </span><span class="annot"><span class="annottext">Transport -&gt; IO Transport
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TLS :: Int
-&gt; Int
-&gt; Maybe ByteString
-&gt; Word16
-&gt; Maybe CertificateChain
-&gt; Transport
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">TLS</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-383"></span><span>                </span><span class="annot"><span class="annottext">tlsMajorVersion :: Int
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">tlsMajorVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679084891"><span class="hs-identifier hs-var">major</span></a></span><span>
</span><span id="line-384"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsMinorVersion :: Int
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">tlsMinorVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679084890"><span class="hs-identifier hs-var">minor</span></a></span><span>
</span><span id="line-385"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsNegotiatedProtocol :: Maybe ByteString
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">tlsNegotiatedProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679084916"><span class="hs-identifier hs-var">proto</span></a></span><span>
</span><span id="line-386"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsChiperID :: Word16
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">tlsChiperID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cipher -&gt; Word16
</span><a href="../../../../tls/html/src"><span class="hs-identifier hs-var hs-var">TLS.cipherID</span></a></span><span> </span><span class="annot"><span class="annottext">Cipher
</span><a href="#local-6989586621679084910"><span class="hs-identifier hs-var">infoCipher</span></a></span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsClientCertificate :: Maybe CertificateChain
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">tlsClientCertificate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CertificateChain
</span><a href="#local-6989586621679084887"><span class="hs-identifier hs-var">clientCert</span></a></span><span>
</span><span id="line-388"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span id="local-6989586621679085245"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tryIO"><span class="hs-identifier hs-type">tryIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679085245"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679085245"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-391"></span><span id="tryIO"><span class="annot"><span class="annottext">tryIO :: IO a -&gt; IO (Either IOError a)
</span><a href="Network.Wai.Handler.WarpTLS.html#tryIO"><span class="hs-identifier hs-var hs-var">tryIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either IOError a)
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">try</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#plainHTTP"><span class="hs-identifier hs-type">plainHTTP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../network/html/src"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../warp/html/src"><span class="hs-identifier hs-type">Transport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span id="plainHTTP"><span class="annot"><span class="annottext">plainHTTP :: TLSSettings
-&gt; Settings -&gt; Socket -&gt; ByteString -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#plainHTTP"><span class="hs-identifier hs-var hs-var">plainHTTP</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679084867"><span id="local-6989586621679084868"><span id="local-6989586621679084869"><span id="local-6989586621679084870"><span id="local-6989586621679084871"><span id="local-6989586621679084872"><span id="local-6989586621679084873"><span id="local-6989586621679084874"><span id="local-6989586621679084875"><span id="local-6989586621679084876"><span id="local-6989586621679084877"><span id="local-6989586621679084878"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Params
Maybe Credentials
Maybe SessionManager
Maybe Config
ServerHooks
Logging
OnInsecure
CertSettings
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
tlsSessionManager :: Maybe SessionManager
tlsCredentials :: Maybe Credentials
tlsSessionManagerConfig :: Maybe Config
tlsServerDHEParams :: Maybe Params
tlsServerHooks :: ServerHooks
tlsWantClientCert :: Bool
tlsCiphers :: [Cipher]
tlsAllowedVersions :: [Version]
tlsLogging :: Logging
onInsecure :: OnInsecure
certSettings :: CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: TLSSettings -&gt; CertSettings
onInsecure :: TLSSettings -&gt; OnInsecure
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsServerDHEParams :: TLSSettings -&gt; Maybe Params
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsLogging :: TLSSettings -&gt; Logging
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="#local-6989586621679084867"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679084866"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679084866"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679084865"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084865"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679084864"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084864"><span class="hs-identifier hs-var">bs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OnInsecure
</span><a href="#local-6989586621679084877"><span class="hs-identifier hs-var">onInsecure</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><span class="annottext">OnInsecure
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#AllowInsecure"><span class="hs-identifier hs-var">AllowInsecure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>        </span><span id="local-6989586621679084862"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679084862"><span class="hs-identifier hs-var">conn'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Socket -&gt; IO Connection
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">socketConnection</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679084866"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084865"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-399"></span><span>        </span><span id="local-6989586621679084860"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679084860"><span class="hs-identifier hs-var">cachedRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (IORef ByteString)
forall a. a -&gt; IO (IORef a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084864"><span class="hs-identifier hs-var">bs0</span></a></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679084859"><span class="annot"><span class="annottext">conn'' :: Connection
</span><a href="#local-6989586621679084859"><span class="hs-identifier hs-var hs-var">conn''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679084862"><span class="hs-identifier hs-var">conn'</span></a></span><span>
</span><span id="line-401"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connRecv :: IO ByteString
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">connRecv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString -&gt; IO ByteString
</span><a href="Network.Wai.Handler.WarpTLS.html#recvPlain"><span class="hs-identifier hs-var">recvPlain</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679084860"><span class="hs-identifier hs-var">cachedRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; IO ByteString
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var hs-var">connRecv</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679084862"><span class="hs-identifier hs-var">conn'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-403"></span><span>        </span><span class="annot"><span class="annottext">(Connection, Transport) -&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679084859"><span class="hs-identifier hs-var">conn''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transport
</span><a href="../../../../warp/html/src"><span class="hs-identifier hs-var">TCP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#DenyInsecure"><span class="hs-identifier hs-type">DenyInsecure</span></a></span><span> </span><span id="local-6989586621679084857"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084857"><span class="hs-identifier hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-comment">-- Listening port 443 but TLS records do not arrive.</span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-comment">-- We want to let the browser know that TLS is required.</span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-comment">-- So, we use 426.</span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-comment">--     http://tools.ietf.org/html/rfc2817#section-4.2</span><span>
</span><span id="line-409"></span><span>        </span><span class="hs-comment">--     https://tools.ietf.org/html/rfc7231#section-6.5.15</span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-comment">-- FIXME: should we distinguish HTTP/1.1 and HTTP/2?</span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-comment">--        In the case of HTTP/2, should we send</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-comment">--        GOAWAY + INADEQUATE_SECURITY?</span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-comment">-- FIXME: Content-Length:</span><span>
</span><span id="line-414"></span><span>        </span><span class="hs-comment">-- FIXME: TLS/&lt;version&gt;</span><span>
</span><span id="line-415"></span><span>        </span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">sendAll</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084865"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-string">&quot;HTTP/1.1 426 Upgrade Required\
        \r\nUpgrade: TLS/1.0, HTTP/1.1\
        \r\nConnection: Upgrade\
        \r\nContent-Type: text/plain\r\n\r\n&quot;</span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; [ByteString] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">sendAll</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084865"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; IO ()) -&gt; [ByteString] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">L.toChunks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084857"><span class="hs-identifier hs-var">lbs</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="../../../../network/html/src"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679084865"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="annottext">WarpTLSException -&gt; IO (Connection, Transport)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">WarpTLSException
</span><a href="Network.Wai.Handler.WarpTLS.html#InsecureConnectionDenied"><span class="hs-identifier hs-var">InsecureConnectionDenied</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-comment">-- | Modify the given receive function to first check the given @IORef@ for a</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- chunk of data. If present, takes the chunk of data from the @IORef@ and</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- empties out the @IORef@. Otherwise, calls the supplied receive function.</span><span>
</span><span id="line-428"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#recvPlain"><span class="hs-identifier hs-type">recvPlain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-429"></span><span id="recvPlain"><span class="annot"><span class="annottext">recvPlain :: IORef ByteString -&gt; IO ByteString -&gt; IO ByteString
</span><a href="Network.Wai.Handler.WarpTLS.html#recvPlain"><span class="hs-identifier hs-var hs-var">recvPlain</span></a></span></span><span> </span><span id="local-6989586621679084853"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679084853"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679084852"><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679084852"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679084851"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084851"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679084853"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084851"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679084852"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>            </span><span class="annot"><span class="annottext">IORef ByteString -&gt; ByteString -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">I.writeIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679084853"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-435"></span><span>            </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679084851"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-keyword">data</span><span> </span><span id="WarpTLSException"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#WarpTLSException"><span class="hs-identifier hs-var">WarpTLSException</span></a></span></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="InsecureConnectionDenied"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#InsecureConnectionDenied"><span class="hs-identifier hs-var">InsecureConnectionDenied</span></a></span></span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ClientClosedConnectionPrematurely"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#ClientClosedConnectionPrematurely"><span class="hs-identifier hs-var">ClientClosedConnectionPrematurely</span></a></span></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679084844"><span id="local-6989586621679084846"><span id="local-6989586621679084848"><span class="annot"><span class="annottext">Int -&gt; WarpTLSException -&gt; ShowS
[WarpTLSException] -&gt; ShowS
WarpTLSException -&gt; FilePath
(Int -&gt; WarpTLSException -&gt; ShowS)
-&gt; (WarpTLSException -&gt; FilePath)
-&gt; ([WarpTLSException] -&gt; ShowS)
-&gt; Show WarpTLSException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WarpTLSException] -&gt; ShowS
$cshowList :: [WarpTLSException] -&gt; ShowS
show :: WarpTLSException -&gt; FilePath
$cshow :: WarpTLSException -&gt; FilePath
showsPrec :: Int -&gt; WarpTLSException -&gt; ShowS
$cshowsPrec :: Int -&gt; WarpTLSException -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679084835"><span id="local-6989586621679084837"><span id="local-6989586621679084839"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#WarpTLSException"><span class="hs-identifier hs-type">WarpTLSException</span></a></span></span></span></span><span>
</span><span id="line-444"></span></pre></body></html>